import{r as t,w as i,h as s,H as e,a as r}from"./p-aff91b47.js";import{b as a}from"./p-a58f1780.js";import"./p-a03d57a1.js";import{d as n}from"./p-5a97005d.js";import"./p-a6712bf4.js";import"./p-e497ad6d.js";import{S as o}from"./p-dc76fcea.js";import{c as d}from"./p-c15d924f.js";import"./p-ae02fe11.js";import"./p-bf38ee7f.js";import"./p-46923b34.js";import"./p-2c3cda13.js";var p=function(t,i,s,e){var r,a=arguments.length,n=a<3?i:null===e?e=Object.getOwnPropertyDescriptor(i,s):e;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,i,s,e);else for(var o=t.length-1;o>=0;o--)(r=t[o])&&(n=(a<3?r(n):a>3?r(i,s,n):r(i,s))||n);return a>3&&n&&Object.defineProperty(i,s,n),n};const c=class{constructor(i){t(this,i),this.config=n,this.t=a(),this.transcripts=[],this.listenerAttached=!1,this.onTranscript=t=>{t.transcript&&this.add(t)}}connectedCallback(){this.meetingChanged(this.meeting)}addListener(t){var i;null===(i=null==t?void 0:t.ai)||void 0===i||i.addListener("transcript",this.onTranscript),this.listenerAttached=!0}clearListeners(t){var i;this.onTranscript&&(null===(i=null==t?void 0:t.ai)||void 0===i||i.removeListener("transcript",this.onTranscript)),this.listenerAttached=!1,clearTimeout(this.disconnectTimeout),this.transcripts=[]}disconnectedCallback(){null!=this.meeting&&this.clearListeners(this.meeting)}meetingChanged(t,i){clearTimeout(this.disconnectTimeout),void 0!==i&&this.clearListeners(i),null!=t&&this.states.activeCaptions&&this.addListener(t)}statesChanged(t){t&&(t.activeCaptions&&!this.listenerAttached&&this.addListener(this.meeting),!t.activeCaptions&&this.listenerAttached&&this.clearListeners(this.meeting))}transcriptionsReducer(t,i){if(!t.length)return[i];let s=t[t.length-1];return s.peerId!==i.peerId?t.concat(i):s.id===i.id?(s.transcript=i.transcript,t.pop(),t.concat(d(s))):t.concat(i)}add(t){this.transcripts=this.transcriptionsReducer(this.transcripts,t)}remove(t){this.transcripts=this.transcripts.filter((i=>i.renderedId!==t))}handleDismiss(t){t.stopPropagation();const{id:s,renderedId:e}=t.detail,r=this.host.shadowRoot.querySelector(`[data-id="${s}"]`);null==r||r.classList.add("exit"),setTimeout((()=>{i((()=>{this.remove(e)}))}),400)}renderTranscripts(){const t=[];return this.transcripts.forEach((i=>{const s={name:i.name,date:i.date,peerId:i.peerId,transcript:i.transcript,id:i.id,renderedId:i.id};if(!t.length)return i.renderedId=s.renderedId,void t.push(s);const e=t[t.length-1];if(e.transcript.length+s.transcript.length>400||e.peerId!==i.peerId)return i.renderedId=s.renderedId,void t.push(s);e.transcript+=" "+i.transcript,i.renderedId=e.renderedId})),t.splice(0,t.length-2),null==t?void 0:t.map((t=>s("dyte-transcript",{key:t.id,"data-id":t.id,transcript:t,onDyteTranscriptDismiss:t=>this.handleDismiss(t),t:this.t})))}render(){if(this.states.activeCaptions)return s(e,null,this.renderTranscripts())}get host(){return r(this)}static get watchers(){return{meeting:["meetingChanged"],states:["statesChanged"]}}};p([o()],c.prototype,"meeting",void 0),p([o()],c.prototype,"states",void 0),p([o()],c.prototype,"t",void 0),c.style=":host{line-height:initial;font-family:var(--dyte-font-family, sans-serif);font-feature-settings:normal;font-variation-settings:normal}p{margin:var(--dyte-space-0, 0px);padding:var(--dyte-space-0, 0px)}:host{position:absolute;top:var(--dyte-space-4, 16px);right:var(--dyte-space-4, 16px);bottom:var(--dyte-space-4, 16px);left:var(--dyte-space-4, 16px);top:auto;display:flex;flex-direction:column;pointer-events:none;justify-content:center;width:100%;z-index:5}dyte-transcript{margin-top:var(--dyte-space-2, 8px)}";export{c as dyte_transcripts}