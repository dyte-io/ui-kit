import{c as t}from"./p-e497ad6d.js";const n=t=>{let n=null;try{const e=JSON.parse(t.message),{target:s,message:r}=e;n=void 0===s||void 0===r?t:Object.assign(Object.assign({},t),{targetUserIds:s,message:r})}catch(e){n=t}return n};function e(t,n){return t.localeCompare(n)}function s(t){return t.sort(((t,n)=>t.localeCompare(n))).join("_")}function r(t,n){if(null==t)return!0;for(const e of t)if("file"===e.kind){const t=e.getAsFile();e.type.startsWith("image/")?n("image",t):n("file",t)}}function o({messages:t,participants:e,selfUserId:r}){const o={};for(const t of e)o[s([t.userId,r])]=[];return t.forEach((t=>{var e;const r=n(t);let c="everyone";if((null===(e=r.targetUserIds)||void 0===e?void 0:e.length)>0){const t=new Set([r.userId,...r.targetUserIds]);c=s(Array.from(t))}o[c]||(o[c]=[]),o[c].push({type:"chat",message:r})})),o}function c({messages:n,selfUserId:e,selectedGroupId:s,participants:r}){var c;const a=o({messages:n,selfUserId:e,participants:r}),i={};for(const n in a){const r=null!==(c=t[n])&&void 0!==c?c:0;n===s?(i[n]=0,t[n]=new Date):i[n]=a[n].filter((t=>"chat"==t.type&&t.message.time>r&&t.message.userId!==e)).length}return i}function a({groupId:t,selfUserId:n}){return t.split("_").find((t=>t!=n))}const i="dm__";function u(t){return t.isDirectMessage}function f(t){return[...new Set(t)].sort(e).join("<>")}function l(t){return t.split("").reverse().join("")}const p=/^\*([^*\s]+)\*/,d=/^_([^_\s]+)_/,g=/^~([^~\s]+)~/,m=/https?:\/\/(www\.)?[-a-zA-Z0-9@:%._\+~#=]{1,256}\.[a-zA-Z0-9()]{1,6}\b([-a-zA-Z0-9()@:%_\+.,~#?&//=]*)/,_=/<blockquote>[.\s\S]*<\/blockquote>\n\n/m;function b(t,n=!1){if(!_.test(t))return"";let e=0,s=13;return n&&(e=12,s=0),t.substring(t.indexOf("<blockquote>")+e,t.indexOf("</blockquote>")+s)}function v(t){return t.replace(_,"")}const q=2e3,I=["<a>","<b>","<i>","<q>","<s>"];function w(t){t=(t=t.split(" ").map((t=>{if(m.test(t)){const n=m.exec(t);t=t.replace(n[0],`<a>${n[0]}</a>`)}else{if(p.test(t)){const n=p.exec(t);t=t.replace(n[0],`<b>${n[1]}</b>`)}if(d.test(t)){const n=d.exec(t);t=t.replace(n[0],`<i>${n[1]}</i>`)}if(g.test(t)){const n=g.exec(t);t=t.replace(n[0],`<s>${n[1]}</s>`)}}return t})).join(" ")).split(" ").map(((t,n)=>">"!==t||0!==n&&">"!==t[n-1]?t:"<q></q>")).join(" ");const[n]=y(t);return n}function y(t,n=""){const e=[];if(0===t.length)return[e,0];let s=0;for(;s<t.length;){if(n.length&&n===t.substring(s,s+n.length))return[e,s+n.length];if(I.includes(t.substring(s,s+3))){const[n,r]=y(t.substring(s+3),`</${t[s+1]}>`);e.push({type:t[s+1],content:1===n.length&&"plain_text"===n[0].type?n[0].content:n}),s+=r+3}else{let n=e[e.length-1];n&&"plain_text"===n.type||(e.push({type:"plain_text",content:""}),n=e[e.length-1]),n.content+=t[s],s++}}return[e,s]}export{q as M,i as T,o as a,c as b,a as c,e as d,b as e,f,s as g,r as h,u as i,n as j,_ as k,w as p,l as r,v as s}