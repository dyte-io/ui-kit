import{c as t,i,p as s,s as e}from"./p-ae02fe11.js";var n,r,h,a,f,o,c,p,u,d,w,g,m,M,l,b=function(t,i,s,e,n){if("m"===e)throw new TypeError("Private method is not writable");if("a"===e&&!n)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof i?t!==i||!n:!i.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===e?n.call(t,s):n?n.value=s:i.set(t,s),s},y=function(t,i,s,e){if("a"===s&&!e)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof i?t!==i||!e:!i.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===s?e:"a"===s?e.call(t):e?e.value:i.get(t)};class v{constructor(){n.add(this),r.set(this,!1),h.set(this,void 0),a.set(this,void 0),f.set(this,void 0),o.set(this,void 0),c.set(this,void 0),p.set(this,void 0),u.set(this,void 0),d.set(this,void 0)}get hasLocalChanges(){return y(this,r,"f")}get currentState(){let t,i=[];return Array.from(y(this,o,"f").keys()).forEach((s=>{const e=y(this,p,"f").get(s);e.isParent?t=Object.assign(Object.assign({},e),{participants:y(this,n,"m",l).call(this,s)}):i.push(Object.assign(Object.assign({},e),{participants:y(this,n,"m",l).call(this,s)}))})),{parentMeeting:t,meetings:i}}get allConnectedMeetings(){return this.currentState.meetings.sort(((t,i)=>t.title.localeCompare(i.title)))}get allParticipants(){return Array.from(y(this,c,"f").values())}get unassignedParticipants(){return y(this,n,"m",l).call(this,y(this,h,"f").parentMeeting.id)}getParticipantsForMeeting(t){return y(this,n,"m",l).call(this,t)}addNewMeeting(){b(this,r,!0,"f");const i=function(t,i){var s={};for(var e in t)Object.prototype.hasOwnProperty.call(t,e)&&i.indexOf(e)<0&&(s[e]=t[e]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(e=Object.getOwnPropertySymbols(t);n<e.length;n++)i.indexOf(e[n])<0&&Object.prototype.propertyIsEnumerable.call(t,e[n])&&(s[e[n]]=t[e[n]])}return s}(t(),["participants"]);return y(this,n,"m",g).call(this,Object.assign(Object.assign({},i),{isParent:!1})),i}addNewMeetings(t){return Array.from({length:t}).map((()=>this.addNewMeeting()))}updateMeetingTitle(t,s){y(this,p,"f").get(t).title=s,i(t)||y(this,u,"f").add(t)}deleteMeeting(t){b(this,r,!0,"f");const e=y(this,p,"f").get(t),a=y(this,n,"m",l).call(this,e.id).map(s);this.assignParticipantsToMeeting(a,y(this,h,"f").parentMeeting.id),y(this,p,"f").delete(e.id),y(this,o,"f").delete(e.id),i(e.id)||y(this,d,"f").add(e.id)}assignParticipantsToMeeting(t,i){return b(this,r,!0,"f"),t.forEach((t=>{const s=y(this,a,"f").get(t);y(this,o,"f").get(s).delete(t),y(this,o,"f").get(i).add(t),y(this,a,"f").set(t,i)})),this.currentState}assignParticipantsRandomly(){const t=e(this.unassignedParticipants,this.allConnectedMeetings.length);return this.allConnectedMeetings.forEach(((i,s)=>{const e=t[s];e&&0!==e.length&&this.assignParticipantsToMeeting(e.map((t=>t.customParticipantId)),i.id)})),this.currentState}unassignParticipants(t){const i=y(this,h,"f").parentMeeting.id;return this.assignParticipantsToMeeting(t,i)}unassignAllParticipants(){const t=y(this,h,"f").parentMeeting.id,i=this.allParticipants.map(s);return this.assignParticipantsToMeeting(i,t)}updateCurrentState(t){y(this,r,"f")||y(this,n,"m",w).call(this,t),[t.parentMeeting,...t.meetings].forEach(((t,i)=>{const s=Object.assign(Object.assign({},t),{isParent:0===i});y(this,n,"m",g).call(this,s),t.participants.forEach((t=>{y(this,n,"m",m).call(this,t,s)}))}))}get meetingsToCreate(){return this.allConnectedMeetings.filter((t=>i(t.id))).map((({id:t,title:i})=>({id:t,title:i})))}get meetingsToUpdate(){return this.allConnectedMeetings.filter((t=>y(this,u,"f").has(t.id))).map((({id:t,title:i})=>({id:t,title:i})))}get meetingsToDelete(){return Array.from(y(this,d,"f"))}get participantsToMove(){const t=new Map;return Array.from(y(this,a,"f").keys()).forEach((i=>{const s=y(this,f,"f").get(i),e=y(this,a,"f").get(i);if(s===e)return;const n=`${s}__${e}`;t.has(n)||t.set(n,[]);const r=y(this,c,"f").get(i);t.get(n).push(r.id)})),Array.from(t.keys()).map((i=>{const[s,e]=i.split("__");return{sourceMeetingId:s,destinationMeetingId:e,participantIds:t.get(i)}}))}async applyChanges(t){const i=0!==this.meetingsToCreate.length?t.connectedMeetings.createMeetings(this.meetingsToCreate):Promise.resolve([]),s=0!==this.meetingsToUpdate.length?t.connectedMeetings.updateMeetings(this.meetingsToUpdate):Promise.resolve(),[e]=await Promise.all([i,s]);e&&e.forEach((t=>{this.meetingsToCreate.forEach((i=>{i.title===t.title&&y(this,n,"m",M).call(this,y(this,p,"f").get(i.id),t.id)}))})),0!==this.participantsToMove.length&&this.participantsToMove.forEach((({sourceMeetingId:i,destinationMeetingId:s,participantIds:e})=>{t.connectedMeetings.moveParticipants(i,s,e)})),0!==this.meetingsToDelete.length&&t.connectedMeetings.deleteMeetings(this.meetingsToDelete)}discardChanges(){return b(this,r,!1,"f"),this.updateCurrentState(y(this,h,"f")),this.currentState}}r=new WeakMap,h=new WeakMap,a=new WeakMap,f=new WeakMap,o=new WeakMap,c=new WeakMap,p=new WeakMap,u=new WeakMap,d=new WeakMap,n=new WeakSet,w=function(t){b(this,h,t,"f"),b(this,p,new Map,"f"),b(this,c,new Map,"f"),b(this,u,new Set,"f"),b(this,d,new Set,"f"),b(this,o,new Map,"f"),b(this,a,new Map,"f"),b(this,f,new Map,"f"),b(this,f,new Map,"f"),y(this,h,"f").parentMeeting.participants.forEach((t=>{y(this,f,"f").set(s(t),y(this,h,"f").parentMeeting.id)})),y(this,h,"f").meetings.forEach((t=>{t.participants.forEach((i=>{y(this,f,"f").set(s(i),t.id)}))}))},g=function(t){y(this,p,"f").has(t.id)||(y(this,p,"f").set(t.id,t),y(this,o,"f").set(t.id,new Set))},m=function(t,i){y(this,c,"f").has(s(t))||(y(this,c,"f").set(s(t),t),y(this,a,"f").set(s(t),i.id),y(this,o,"f").get(i.id).add(s(t)))},M=function(t,i){const s=t.id;y(this,n,"m",g).call(this,Object.assign(Object.assign({},t),{id:i})),y(this,p,"f").delete(s);const e=y(this,o,"f").get(s);y(this,o,"f").set(i,e),y(this,o,"f").delete(s),Array.from(y(this,a,"f").keys()).forEach((t=>{y(this,a,"f").get(t)===s&&y(this,a,"f").set(t,i)}))},l=function(t){return Array.from(y(this,o,"f").get(t)).map((t=>y(this,c,"f").get(t)))};export{v as B}