import{r as t,c as e,h as i,H as a,a as n,w as s}from"./p-aff91b47.js";import{a as o,c as r,d,s as c}from"./p-c3bc6145.js";import{a as l,c as h}from"./p-e497ad6d.js";import{S as p}from"./p-75fa9e17.js";import{d as b}from"./p-a08b5a59.js";import{M as g,j as y}from"./p-83da1e09.js";import{d as v,f as u,e as f}from"./p-382270d8.js";import{s as m}from"./p-0752f2ba.js";import{R as x}from"./p-fd4b6d8b.js";import{D as w}from"./p-baa8e936.js";import{f as k}from"./p-338c7261.js";import"./p-2c3cda13.js";import"./p-5605a420.js";var _=function(t,e,i,a){var n,s=arguments.length,o=s<3?e:null===a?a=Object.getOwnPropertyDescriptor(e,i):a;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,a);else for(var r=t.length-1;r>=0;r--)(n=t[r])&&(o=(s<3?n(o):s>3?n(e,i,o):n(e,i))||o);return s>3&&o&&Object.defineProperty(e,i,o),o};const j=class{constructor(i){t(this,i),this.search=e(this,"search",7),this.searchDismissed=e(this,"searchDismissed",7),this.back=e(this,"back",7),this.iconPack=o,this.t=r(),this.showChannelDetailsDialog=!1,this.showSearchBar=!1,this.members=[],this.showBackButton=!1}onChannelChanged(){this.$searchInput&&(this.$searchInput.value=""),this.showSearchBar=!1,this.channel.isDirectMessage||this.meeting.chat.getChannelMembers(this.channel.id).then((t=>{this.members=t}))}connectedCallback(){this.onChannelChanged()}renderChannelDetails(){return i("dyte-dialog",{open:!0,onDyteDialogClose:()=>{this.showChannelDetailsDialog=!1},iconPack:this.iconPack,t:this.t},i("dyte-channel-details",{members:this.members,channel:this.channel}))}render(){return this.channel?i(a,null,this.showChannelDetailsDialog&&this.renderChannelDetails(),i("header",{class:{searching:this.showSearchBar}},this.showBackButton&&i("dyte-button",{kind:"icon",variant:"secondary",class:"back-btn",onClick:()=>{this.back.emit()}},i("dyte-icon",{icon:this.iconPack.chevron_left})),i("div",{class:"channel-details"},i("span",{class:"name"},this.channel.displayName),!this.channel.isDirectMessage&&i("span",{class:"members"},this.members.map((t=>t.name)).join(", "))),i("div",{class:"channel-tools"},!this.channel.isDirectMessage&&i("dyte-tooltip",{label:this.t("chat.channel_members"),variant:"primary"},i("dyte-button",{kind:"button",variant:"secondary",size:"md",onClick:()=>{this.showChannelDetailsDialog=!this.showChannelDetailsDialog},class:"br-primary-btn"},i("dyte-icon",{icon:this.iconPack.people})))))):null}static get watchers(){return{channel:["onChannelChanged"]}}};_([p()],j.prototype,"meeting",void 0),_([p()],j.prototype,"iconPack",void 0),_([p()],j.prototype,"t",void 0),j.style="header{box-sizing:border-box;height:var(--dyte-space-16, 64px);width:100%;padding:var(--dyte-space-4, 16px);display:flex;justify-content:space-between;--tw-bg-opacity:1;background-color:rgba(var(--dyte-colors-background-1000, 8 8 8) / var(--tw-bg-opacity));border-left-width:var(--dyte-border-width-none, 0);border-right-width:var(--dyte-border-width-none, 0);border-bottom-width:var(--dyte-border-width-sm, 1px);border-top-width:var(--dyte-border-width-none, 0);border-style:solid;--tw-border-opacity:1;border-bottom-color:rgba(var(--dyte-colors-background-800, 30 30 30) / var(--tw-border-opacity))}header.searching{justify-content:flex-end}header.searching .channel-details{display:none}header .channel-details{display:flex;flex-grow:1;flex-direction:column;justify-content:center;height:var(--dyte-space-9, 36px);width:var(--dyte-space-1, 4px)}header .channel-details .name{font-weight:500}header .channel-details .members{margin-top:var(--dyte-space-0\\.5, 2px);overflow:hidden;text-overflow:ellipsis;white-space:nowrap;font-size:12px;color:rgb(var(--dyte-colors-text-600, 255 255 255 / 0.52))}header .channel-tools{display:flex;flex-shrink:0;justify-content:flex-end;gap:var(--dyte-space-1, 4px);min-width:var(--dyte-space-24, 96px)}header .channel-tools dyte-tooltip{height:var(--dyte-space-8, 32px);width:var(--dyte-space-10, 40px);display:flex}header .search-input{height:var(--dyte-space-8, 32px);width:var(--dyte-space-48, 192px);padding-left:var(--dyte-space-2, 8px);padding-right:var(--dyte-space-2, 8px);border-width:var(--dyte-border-width-none, 0);border-style:none;outline:2px solid transparent;outline-offset:2px;border-radius:var(--dyte-border-radius-sm, 4px);--tw-bg-opacity:1;background-color:rgba(var(--dyte-colors-background-800, 30 30 30) / var(--tw-bg-opacity));color:rgb(var(--dyte-colors-text-1000, 255 255 255))}header .name{font-size:16px}header .br-primary-btn{background-color:transparent}header .br-primary-btn:hover{--tw-bg-opacity:1;background-color:rgba(var(--dyte-colors-background-800, 30 30 30) / var(--tw-bg-opacity))}@media (orientation: landscape) and (min-width: 400px){header.searching .channel-details{display:flex}}.back-btn{margin-right:var(--dyte-space-3, 12px)}";var C=function(t,e,i,a){var n,s=arguments.length,o=s<3?e:null===a?a=Object.getOwnPropertyDescriptor(e,i):a;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,a);else for(var r=t.length-1;r>=0;r--)(n=t[r])&&(o=(s<3?n(o):s>3?n(e,i,o):n(e,i))||o);return s>3&&o&&Object.defineProperty(e,i,o),o};const D=class{constructor(i){t(this,i),this.channelChange=e(this,"channelChange",7),this.disableSearch=!1,this.hideAvatar=!1,this.iconPack=o,this.t=r(),this.viewAs="list",this.searchQuery="",this.showDropdown=!1,this.calculateListHeight=b((()=>{if("list"===this.viewAs&&this.$listEl){let t=0;const e=this.$el.shadowRoot.querySelector('slot[name="header"]');e&&e.assignedElements().forEach((e=>t+=e.offsetHeight)),this.$searchEl&&(t+=this.$searchEl.offsetHeight),this.$listEl.style.height=window.innerHeight-t-16+"px"}}),60),this.getFilteredChannels=()=>""===this.searchQuery.trim()?this.channels:this.channels.filter((t=>t.name.toLowerCase().includes(this.searchQuery.toLowerCase()))),this.toggleDropdown=()=>{this.showDropdown=!this.showDropdown},this.getChannelById=t=>this.channels.find((e=>e.id===t)),this.getTotalUnreads=()=>this.channels.reduce(((t,e)=>t+e.unreadCount),0),this.onChannelClickHandler=t=>{this.channelChange.emit(t),"dropdown"===this.viewAs&&(this.showDropdown=!1)}}connectedCallback(){this.resizeObserver=new ResizeObserver(this.calculateListHeight)}componentDidLoad(){this.resizeObserver.observe(this.$el),this.calculateListHeight()}disconnectedCallback(){var t;null===(t=this.resizeObserver)||void 0===t||t.disconnect(),this.calculateListHeight.cancel()}getTimeLabel(t){const e=new Date,i=new Date(e);i.setDate(e.getDate()-1);const a=new Date(e);return a.setDate(e.getDate()-e.getDay()-1),t.toDateString()===e.toDateString()?t.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):t.toDateString()===i.toDateString()?this.t("date.yesteday"):t>a?this.t(["date.sunday","date.monday","date.tuesday","date.wednesday","date.thursday","date.friday","date.saturday"][t.getDay()]):Intl.DateTimeFormat([],{day:"2-digit",month:"2-digit",year:"2-digit"}).format(t)}render(){const t=this.getFilteredChannels(),e="list"===this.viewAs||"dropdown"===this.viewAs&&this.showDropdown;return i(a,{key:"ade72de18b78275705bb0b39f9923977b8ef479e"},"list"===this.viewAs&&i("slot",{key:"879f77f7f57896e2ef37ba1abfede94bbdd66b8c",name:"header"}),e&&i("div",{key:"a0d9818c26533cf1a65ec70cb385d6ac33ad6c6f",class:{dropdown:"dropdown"===this.viewAs,scrollbar:"dropdown"===this.viewAs,list:"list"===this.viewAs}},!this.disableSearch&&i("div",{key:"428ca579360c29a390084c8f1969091c6b904a5a",class:"search-container",ref:t=>this.$searchEl=t},i("input",{key:"255cbcd3cda43fd2fd8bd3a65cda1f6271476fb9",type:"text",placeholder:this.t("chat.search_conversations"),value:this.searchQuery,onInput:t=>this.searchQuery=t.target.value}),i("dyte-icon",{key:"e85c4413dcd97df62fc96cf23aab4c0ef7276d79",icon:this.iconPack.search})),i("div",{key:"a09eb0f58d6341be68cfc52832e84048f11946be",class:"channels-container scrollbar",ref:t=>this.$listEl=t},t.map((t=>i("button",{class:{channel:!0,active:this.selectedChannelId===t.id},onClick:()=>this.onChannelClickHandler(t)},!this.hideAvatar&&i("div",null,t.icon?i("dyte-icon",{class:"avatar-icon",icon:this.iconPack[t.icon]}):i("dyte-avatar",{participant:{name:t.name,picture:t.avatarUrl}})),i("div",{class:"channel-data"},i("div",{class:"col"},i("div",{class:"name"},t.name),t.latestMessage&&i("div",{class:{"last-message":!0,"no-message":!t.latestMessage}},i("dyte-text-message-view",{isMarkdown:!0,text:t.latestMessage}))),i("div",{class:"col channel-meta"},t.latestMessageTime&&i("time",{class:"time"},this.getTimeLabel(t.latestMessageTime)),t.unreadCount>0&&i("div",{class:"unread-count"},t.unreadCount)))))))),"dropdown"===this.viewAs&&i("button",{key:"af78d56510b62beeee9e17162a0fbe5a75b0b1af",class:"dropdown-trigger",onClick:this.toggleDropdown},i("span",{key:"10c170707e3c084d4a0a1a322128f6e685c075ed"},this.selectedChannelId&&`${this.t("to")} ${this.getChannelById(this.selectedChannelId).name}`,this.getTotalUnreads()>0&&i("div",{key:"b45263bedbb36f6b25cb595067a2418a110e9e45",class:"unread-count"},this.getTotalUnreads())),i("dyte-icon",{key:"ca61473ab2f859378fea75468dbf194a137ceba0",icon:this.showDropdown?this.iconPack.chevron_up:this.iconPack.chevron_down})))}get $el(){return n(this)}};C([p()],D.prototype,"iconPack",void 0),C([p()],D.prototype,"t",void 0),D.style=".scrollbar {\n  /* For Firefox */\n  scrollbar-width: thin;\n  scrollbar-color: var(--dyte-scrollbar-color, rgb(var(--dyte-colors-background-600, 60 60 60)))\n    var(--dyte-scrollbar-background, transparent);\n}\n\n/* For WebKit */\n.scrollbar::-webkit-scrollbar {\n  height: var(--dyte-space-1\\.5, 6px);\n  width: var(--dyte-space-1\\.5, 6px);\n  border-radius: 9999px;\n  background-color: var(--dyte-scrollbar-background, transparent);\n}\n\n.scrollbar::-webkit-scrollbar-thumb {\n  border-radius: 9999px;\n  background-color: var(--dyte-scrollbar-color, rgb(var(--dyte-colors-background-600, 60 60 60)));\n}\n\n\n:host {\n  display: flex;\n  flex-direction: column;\n  width: 100%;\n  --tw-bg-opacity: 1;\n  background-color: rgba(var(--dyte-colors-background-900, 26 26 26) / var(--tw-bg-opacity));\n  position: relative;\n  z-index: 10;\n  height: var(--dyte-space-12, 48px);\n  min-height: 48px;\n}\n\n.dropdown-trigger {\n  height: 100%;\n  width: 100%;\n  border-width: var(--dyte-border-width-none, 0);\n  border-style: none;\n  padding: var(--dyte-space-4, 16px);\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  --tw-bg-opacity: 1;\n  background-color: rgba(var(--dyte-colors-background-700, 44 44 44) / var(--tw-bg-opacity));\n  font-size: 14px;\n  color: rgb(var(--dyte-colors-text-1000, 255 255 255));\n  cursor: pointer;\n  position: absolute;\n  z-index: 20;\n}\n\n.dropdown-trigger span {\n  display: flex;\n  flex: 1 1 0%;\n  align-items: center;\n  justify-content: space-between;\n}\n\n.dropdown-trigger dyte-icon {\n  margin-left: var(--dyte-space-1, 4px);\n  height: var(--dyte-space-5, 20px);\n  width: var(--dyte-space-5, 20px);\n  flex-shrink: 0;\n}\n\n@container chatcontainer (height < 360px) {\n  .dropdown-trigger {\n    padding: var(--dyte-space-2, 8px);\n  }\n  .dropdown {\n    top: var(--dyte-space-8, 32px) !important;\n  }\n  .search-container {\n    padding-left: var(--dyte-space-0, 0px) !important;\n    padding-right: var(--dyte-space-0, 0px) !important;\n    padding-top: var(--dyte-space-0, 0px) !important;\n    padding-bottom: var(--dyte-space-0, 0px) !important;\n  }\n  input {\n    height: var(--dyte-space-8, 32px) !important;\n    border-radius: var(--dyte-border-radius-none, 0) !important;\n  }\n  .channel {\n    height: var(--dyte-space-8, 32px) !important;\n    border-radius: var(--dyte-border-radius-sm, 4px) !important;\n  }\n  .avatar-icon {\n    height: var(--dyte-space-3, 12px) !important;\n    width: var(--dyte-space-3, 12px) !important;\n    padding: var(--dyte-space-1, 4px) !important;\n  }\n\n  dyte-avatar {\n    height: var(--dyte-space-5, 20px) !important;\n    width: var(--dyte-space-5, 20px) !important;\n  }\n}\n\n.dropdown {\n  position: absolute;\n  width: 100%;\n  --tw-bg-opacity: 1;\n  background-color: rgba(var(--dyte-colors-background-900, 26 26 26) / var(--tw-bg-opacity));\n  top: var(--dyte-space-12, 48px);\n  z-index: 10;\n  animation: 0.3s slide-down ease;\n}\n\n.dropdown .channels-container {\n  max-height: var(--dyte-space-80, 320px);\n}\n\n.list {\n  display: flex;\n  flex-direction: column;\n}\n\n.list .channel .channel-data {\n  align-items: flex-start;\n}\n\n.unread-count {\n  display: flex;\n  justify-content: center;\n  height: var(--dyte-space-5, 20px);\n  min-width: var(--dyte-space-3, 12px);\n  border-radius: 9999px;\n  padding-left: var(--dyte-space-1, 4px);\n  padding-right: var(--dyte-space-1, 4px);\n  font-size: 12px;\n  line-height: 1.25rem;\n  --tw-bg-opacity: 1;\n  background-color: rgba(var(--dyte-colors-brand-500, 33 96 253) / var(--tw-bg-opacity));\n  color: rgb(var(--dyte-colors-text-on-brand-1000, var(--dyte-colors-text-1000, 255 255 255)));\n}\n\ninput {\n  height: var(--dyte-space-9, 36px);\n  width: 100%;\n  padding-left: var(--dyte-space-3, 12px);\n  padding-right: var(--dyte-space-3, 12px);\n  box-sizing: border-box;\n  border-width: var(--dyte-border-width-none, 0);\n  border-style: none;\n  outline: 2px solid transparent;\n  outline-offset: 2px;\n  border-radius: var(--dyte-border-radius-sm, 4px);\n  --tw-bg-opacity: 1;\n  background-color: rgba(var(--dyte-colors-background-600, 60 60 60) / var(--tw-bg-opacity));\n  color: rgb(var(--dyte-colors-text-1000, 255 255 255));\n}\n\n.search-container {\n  display: flex;\n  flex-shrink: 0;\n  flex-grow: 0;\n  flex-basis: auto;\n  align-items: center;\n  padding-top: var(--dyte-space-3, 12px);\n  padding-bottom: var(--dyte-space-3, 12px);\n  padding-left: var(--dyte-space-2, 8px);\n  padding-right: var(--dyte-space-2, 8px);\n  border-bottom: var(--dyte-border-width-sm, 1px) solid rgb(var(--dyte-colors-background-700, 44 44 44));\n}\n\n.search-container dyte-icon {\n  margin-left: calc(var(--dyte-space-8, 32px) * -1);\n  height: var(--dyte-space-5, 20px);\n  width: var(--dyte-space-5, 20px);\n  color: rgb(var(--dyte-colors-text-800, 255 255 255 / 0.76));\n}\n\n.channels-container {\n  display: flex;\n  flex-direction: column;\n  gap: var(--dyte-space-1, 4px);\n  padding: var(--dyte-space-2, 8px);\n  flex: 1 1 auto;\n  overflow-y: auto;\n}\n\n.channel {\n  flex-shrink: 0;\n  box-sizing: border-box;\n  border-width: var(--dyte-border-width-none, 0);\n  border-style: none;\n  background-color: transparent;\n  outline: 2px solid transparent;\n  outline-offset: 2px;\n  cursor: pointer;\n  border-radius: var(--dyte-border-radius-md, 8px);\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  gap: var(--dyte-space-2, 8px);\n  height: var(--dyte-space-16, 64px);\n  width: 100%;\n  padding-left: var(--dyte-space-2, 8px);\n  padding-right: var(--dyte-space-3, 12px);\n  color: rgb(var(--dyte-colors-text-1000, 255 255 255));\n  transition-property: color, background-color, border-color, text-decoration-color, fill, stroke;\n  transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);\n  transition-duration: 150ms;\n}\n\n.channel:hover {\n  --tw-bg-opacity: 1;\n  background-color: rgba(var(--dyte-colors-background-600, 60 60 60) / var(--tw-bg-opacity));\n}\n\n.channel .channel-data {\n  flex: 1 1 0%;\n  align-items: center;\n  justify-content: space-between;\n  display: flex;\n  gap: var(--dyte-space-2, 8px);\n}\n\n.channel .name {\n  font-size: 16px;\n}\n\n.channel .name, \n  .channel .last-message {\n  max-width: var(--dyte-space-40, 160px);\n  text-align: left;\n  overflow: hidden;\n  display: -webkit-box;\n  -webkit-box-orient: vertical;\n  -webkit-line-clamp: 1;\n}\n\n.channel .no-message {\n  font-style: italic;\n}\n\n.channel dyte-avatar {\n  height: var(--dyte-space-12, 48px);\n  width: var(--dyte-space-12, 48px);\n  overflow: clip;\n  border-radius: 9999px;\n  font-size: 14px;\n}\n\n.channel .avatar-icon {\n  height: var(--dyte-space-6, 24px);\n  width: var(--dyte-space-6, 24px);\n  padding: var(--dyte-space-3, 12px);\n  color: rgb(var(--dyte-colors-text-on-brand-1000, var(--dyte-colors-text-1000, 255 255 255)));\n  overflow: clip;\n  border-radius: 9999px;\n  --tw-bg-opacity: 1;\n  background-color: rgba(var(--dyte-colors-brand-500, 33 96 253) / var(--tw-bg-opacity));\n}\n\n.channel time, \n  .channel .last-message {\n  font-size: 12px;\n  color: rgb(var(--dyte-colors-text-800, 255 255 255 / 0.76));\n}\n\n.channel.active {\n  --tw-bg-opacity: 1;\n  background-color: rgba(var(--dyte-colors-brand-300, 73 124 253) / var(--tw-bg-opacity));\n  color: rgb(var(--dyte-colors-text-on-brand-1000, var(--dyte-colors-text-1000, 255 255 255)));\n}\n\n.channel.active .unread-count {\n  background-color: rgb(var(--dyte-colors-text-on-brand-800, var(--dyte-colors-text-800, 255 255 255 / 0.76)));\n  --tw-text-opacity: 1;\n  color: rgba(var(--dyte-colors-brand-500, 33 96 253) / var(--tw-text-opacity));\n}\n\n.channel.active time {\n  color: rgb(var(--dyte-colors-text-on-brand-800, var(--dyte-colors-text-800, 255 255 255 / 0.76)));\n}\n\n.channel.active .last-message {\n  color: rgb(var(--dyte-colors-text-on-brand-700, var(--dyte-colors-text-700, 255 255 255 / 0.64)));\n}\n\n.channel.active dyte-avatar {\n  --tw-bg-opacity: 1;\n  background-color: rgba(var(--dyte-colors-brand-500, 33 96 253) / var(--tw-bg-opacity));\n  color: rgb(var(--dyte-colors-text-on-brand-1000, var(--dyte-colors-text-1000, 255 255 255)));\n}\n\n.col {\n  gap: var(--dyte-space-1, 4px);\n  display: flex;\n  flex-direction: column;\n}\n\n.channel-meta {\n  flex-shrink: 0;\n  align-items: flex-end;\n}\n\n@keyframes slide-down {\n  from {\n    transform: translateY(-50px);\n  }\n  to {\n    transform: translateY(0%);\n  }\n}\n";var R=function(t,e,i,a){var n,s=arguments.length,o=s<3?e:null===a?a=Object.getOwnPropertyDescriptor(e,i):a;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,a);else for(var r=t.length-1;r>=0;r--)(n=t[r])&&(o=(s<3?n(o):s>3?n(e,i,o):n(e,i))||o);return s>3&&o&&Object.defineProperty(e,i,o),o};const z={messagesSent:0,startTime:0},O=class{constructor(i){t(this,i),this.onNewMessage=e(this,"newMessage",7),this.onEditMessage=e(this,"editMessage",7),this.onEditCancel=e(this,"editCancel",7),this.onQuotedMessageDismiss=e(this,"quotedMessageDismiss",7),this.canSendTextMessage=!0,this.canSendFiles=!0,this.message="",this.quotedMessage="",this.storageKey="dyte-text-message",this.inputTextPlaceholder="Enter your message",this.isEditing=!1,this.iconPack=o,this.t=r(),this.disableEmojiPicker=!1,this.rateLimits={period:60,maxInvocations:60},this.fileToUpload=null,this.isEmojiPickerOpen=!1,this.disableSendButton=!1,this.rateLimitsBreached=!1,this.textMessage="",this.sendFile=()=>{this.canSendFiles&&(this.onNewMessage.emit("image"===this.fileToUpload.type?{type:"image",image:this.fileToUpload.file}:{type:"file",file:this.fileToUpload.file}),this.fileToUpload=null)},this.handleSendMessage=()=>{if(!this.canSendTextMessage||this.rateLimitsBreached)return;if(null!==this.fileToUpload)return void this.sendFile();const t=this.textMessage,e=Date.now();e-z.startTime>1e3*this.rateLimits.period&&(z.startTime=e,z.messagesSent=0),z.messagesSent+=1,this.checkRateLimitBreached(e),t.length>0&&(this.onNewMessage.emit({type:"text",message:t}),this.cleanup())},this.handleEditMessage=()=>{this.onEditMessage.emit(this.textMessage),this.cleanup()},this.handleEditCancel=()=>{this.onEditCancel.emit(),this.cleanup()},this.onTextChangeHandler=t=>{var e;this.textMessage=t.detail,this.textMessage.length>=(null!==(e=this.maxLength)&&void 0!==e?e:g)?this.disableSendButton=!0:this.disableSendButton&&(this.disableSendButton=!1),l.setItem(this.storageKey,t.detail)},this.onKeyDownHandler=t=>{"Enter"===t.key&&t.shiftKey||this.disableSendButton||"Enter"===t.key&&(t.preventDefault(),this.isEditing?this.handleEditMessage():this.handleSendMessage())},this.onFileUploadHandler=(t,e)=>{this.fileToUpload={type:t,file:e}},this.onQuotedMessageDismissHandler=()=>{this.onQuotedMessageDismiss.emit()},this.cleanup=()=>{this.textMessage="",this.fileToUpload=null,l.setItem(this.storageKey,""),this.$textComposer.setText("",!0),this.isEmojiPickerOpen=!1},this.onKeyDownHandler=this.onKeyDownHandler.bind(this)}connectedCallback(){this.textMessage=this.message||l.getItem(this.storageKey)||"",this.checkRateLimitBreached(Date.now())}componentWillUpdate(){this.textMessage=this.message||l.getItem(this.storageKey)||""}componentDidLoad(){this.message&&s((()=>this.$textComposer.setText(this.message,!0)))}checkRateLimitBreached(t){z.messagesSent>=this.rateLimits.maxInvocations&&(this.disableSendButton=!0,this.rateLimitsBreached=!0,setTimeout((()=>{z.messagesSent=0,z.startTime=Date.now(),this.disableSendButton=!1,this.rateLimitsBreached=!1}),t-z.startTime+1e3*this.rateLimits.period))}render(){var t;const e={iconPack:this.iconPack,t:this.t};return i(a,{key:"d0cb57c1d3b74db36e3ddfa5453a960de7968a1b"},this.canSendTextMessage&&this.isEmojiPickerOpen&&i("dyte-emoji-picker",Object.assign({key:"d26c303b8d1e460eabe0fdbadb4f1ab3381b16cc",part:"emoji-picker",onPickerClose:()=>{this.isEmojiPickerOpen=!1},onDyteEmojiClicked:t=>{this.textMessage+=t.detail,this.$textComposer.setText(this.textMessage,!0)}},e)),i("slot",{key:"93a6e0c49183a080be84172ce0a69b0d0a9b274a",name:"chat-addon"}),this.quotedMessage&&0!==this.quotedMessage.length&&i("div",{key:"9b235c2f65766cc80f40091b6d4e01f614f910f3",class:"quoted-message-container",part:"quoted-message-container"},i("div",{key:"3e2582d7ccc9747be95f140ea0f3c9151b5fc365",class:"quoted-message scrollbar"},i("dyte-text-message-view",{key:"d5ef25a57bf0f2a026c5fd92b202e0d337a3e52a",text:this.quotedMessage,isMarkdown:!0})),i("div",{key:"c0d69d22711c6dd7e9a84f18f3bdb2f4e0b60a20"},i("dyte-icon",{key:"9a9b6cd5df08157b411cbcbfb628a714f04cd291","aria-label":this.t("dismiss"),class:"dismiss",icon:this.iconPack.dismiss,onClick:this.onQuotedMessageDismissHandler}))),i("div",{key:"9dc15207103dceeded2a03c69a75bfa7919b98eb",class:"composer-container"},i("div",{key:"f456c8bd28ee60155b3735458aa172aa55b574f8",class:"composers"},this.fileToUpload&&i("dyte-draft-attachment-view",Object.assign({key:"0417d1e33ac0e4fc0df52bdc0a04661701c4efcf"},e,{attachment:this.fileToUpload,onDeleteAttachment:()=>this.fileToUpload=null})),!this.fileToUpload&&i("dyte-text-composer-view",{key:"83b68d635390774b5f931f5e00e0caa8f8b739d9",value:this.textMessage,placeholder:this.inputTextPlaceholder,onTextChange:this.onTextChangeHandler,keyDownHandler:this.onKeyDownHandler,maxLength:null!==(t=this.maxLength)&&void 0!==t?t:g,rateLimitBreached:this.rateLimitsBreached,t:this.t,iconPack:this.iconPack,ref:t=>this.$textComposer=t})),i("div",{key:"033cfe3365464c83af8d0ef0b590c0ffa900c146",class:"chat-buttons",part:"chat-buttons"},i("div",{key:"fcc9ae557a0f31c15611694a6073486fa6b22986",class:"left",part:"chat-buttons-left"},!this.fileToUpload&&!this.isEditing&&i("div",{key:"d9b9f602c036d8dec831daec2065097a987fa213"},this.canSendFiles&&[i("dyte-file-picker-button",Object.assign({key:"31270adc1fb72d8817e3218d596823cbffd0b032"},e,{onFileChange:t=>this.onFileUploadHandler("file",t.detail)})),i("dyte-file-picker-button",Object.assign({key:"1168afc0827bc2b63463c1eaf1e805abea7388d7",filter:"image/*",label:this.t("chat.send_img"),icon:"image",onFileChange:t=>this.onFileUploadHandler("image",t.detail)},e))],this.canSendTextMessage&&!this.disableEmojiPicker&&i("dyte-emoji-picker-button",Object.assign({key:"ef781c8e02daadede1ddc1eab5ef52598484b6d0",isActive:this.isEmojiPickerOpen,onClick:()=>{this.isEmojiPickerOpen=!this.isEmojiPickerOpen}},e)),i("slot",{key:"e80c453df4dcd546e804ea68ad9e5a783048662d",name:"chat-buttons"}))),i("div",{key:"e76f5c295316bc20e52d150f3a005cd91c90e210",class:"right",part:"chat-buttons-right"},!this.isEditing&&i("dyte-tooltip",{key:"d26dee018b74152225a19258165534ed7f793066",variant:"primary",label:this.t("chat.send_msg"),delay:2e3},i("dyte-button",{key:"5ad58b3709f82d11006bbc05a80c9c74134fe598",kind:"icon",disabled:this.disableSendButton,onClick:()=>this.handleSendMessage(),title:this.t("chat.send_msg")},i("dyte-icon",{key:"785be312a087790413e75151d352085585f8be31",icon:this.iconPack.send}))),this.isEditing&&i("div",{key:"5ee9a079da42dd6ef58d39dd611a170d324d1783",class:"edit-buttons"},i("dyte-tooltip",{key:"35ed375683386ff3a411e84b0bff663fd2d9cdfd",variant:"secondary",label:this.t("cancel"),delay:2e3},i("dyte-button",{key:"80b21a18537664018306abf9b8b099d2b1ec354f",kind:"icon",variant:"secondary",onClick:()=>this.handleEditCancel(),title:this.t("cancel")},i("dyte-icon",{key:"d65f2a1c97cd5c36effcfa78fcd7ebe42b095be8",icon:this.iconPack.dismiss}))),i("dyte-tooltip",{key:"56ff8d5fd854720ec93f65d5bdcb88b4e2621e12",variant:"primary",label:this.t("chat.update_msg"),delay:2e3},i("dyte-button",{key:"81eb4a8f97baa957bfe718720fedbb8504010dae",kind:"icon",onClick:()=>this.handleEditMessage(),title:this.t("chat.send_msg")},i("dyte-icon",{key:"3fc29bac3ee52f825de73e81b19c49d92981dd4a",icon:this.iconPack.checkmark}))))))))}};R([p()],O.prototype,"iconPack",void 0),R([p()],O.prototype,"t",void 0),O.style=":host {\n  display: flex;\n  flex-direction: column;\n  font-family: var(--dyte-font-family, sans-serif);\n  font-size: 14px;\n  position: relative;\n}\n\n.quoted-message-container {\n  margin-bottom: var(--dyte-space-2, 8px);\n  display: flex;\n  justify-content: space-between;\n  --tw-bg-opacity: 1;\n  background-color: rgba(var(--dyte-colors-background-800, 30 30 30) / var(--tw-bg-opacity));\n  color: rgb(var(--dyte-colors-text-1000, 255 255 255));\n  border-radius: var(--dyte-border-radius-md, 8px);\n  border: var(--dyte-border-width-sm, 1px) solid rgb(var(--dyte-colors-background-600, 60 60 60));\n}\n\n.quoted-message-container .quoted-message {\n  flex: 1 1 0%;\n  padding: var(--dyte-space-2, 8px);\n  border-radius: var(--dyte-border-radius-md, 8px);\n  max-height: var(--dyte-space-24, 96px);\n  overflow-y: auto;\n  word-break: break-all;\n}\n\n.quoted-message-container .quoted-message blockquote {\n  display: none;\n}\n\n.quoted-message-container dyte-icon.dismiss {\n  margin-left: auto;\n  height: var(--dyte-space-5, 20px);\n  width: var(--dyte-space-5, 20px);\n  padding: var(--dyte-space-2, 8px);\n  border-radius: var(--dyte-border-radius-md, 8px);\n  color: rgb(var(--dyte-colors-text-600, 255 255 255 / 0.52));\n}\n\n.quoted-message-container dyte-icon.dismiss:hover {\n  cursor: pointer;\n  color: rgb(var(--dyte-colors-text-1000, 255 255 255));\n}\n\n.quoted-message-container dyte-icon.dismiss {\n  transition-property: color, background-color, border-color, text-decoration-color, fill, stroke;\n  transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);\n  transition-duration: 150ms;\n}\n\n.composer-container {\n  position: relative;\n  --tw-bg-opacity: 1;\n  background-color: rgba(var(--dyte-colors-background-800, 30 30 30) / var(--tw-bg-opacity));\n  border-radius: var(--dyte-border-radius-md, 8px);\n  overflow: hidden;\n  border: var(--dyte-border-width-sm, 1px) solid rgb(var(--dyte-colors-background-600, 60 60 60));\n}\n\n.composer-container > .composers {\n    min-height: 60px;\n  }\n\n@container chatcontainer (height < 360px) {\n    .composer-container > .composers {\n      min-height: 30px;\n    }\n}\n\n.chat-buttons {\n  padding: var(--dyte-space-3, 12px);\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  --tw-bg-opacity: 1;\n  background-color: rgba(var(--dyte-colors-background-800, 30 30 30) / var(--tw-bg-opacity));\n  color: rgb(var(--dyte-colors-text-1000, 255 255 255));\n}\n\n.chat-buttons .right {\n  z-index: 10;\n}\n\n.chat-buttons .right .edit-buttons {\n  display: flex;\n  gap: var(--dyte-space-2, 8px);\n}\n\n.chat-buttons > div {\n  display: flex;\n  align-items: center;\n}\n\ndyte-emoji-picker {\n  z-index: 20;\n  position: absolute;\n  top: calc(var(--dyte-space-72, 288px) * -1);\n  border-top: var(--dyte-border-width-sm, 1px) solid rgb(var(--dyte-colors-background-600, 60 60 60));\n  animation: 0.3s slide-up ease;\n}\n\n@keyframes slide-up {\n  from {\n    transform: translateY(100%);\n  }\n  to {\n    transform: translateY(0%);\n  }\n}\n";var $=function(t,e,i,a){var n,s=arguments.length,o=s<3?e:null===a?a=Object.getOwnPropertyDescriptor(e,i):a;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,a);else for(var r=t.length-1;r>=0;r--)(n=t[r])&&(o=(s<3?n(o):s>3?n(e,i,o):n(e,i))||o);return s>3&&o&&Object.defineProperty(e,i,o),o};const P=class{constructor(i){t(this,i),this.onPinMessage=e(this,"pinMessage",7),this.stateUpdate=e(this,"dyteStateUpdate",7),this.observingEl=[],this.autoScrollEnabled=!0,this.messages=[],this.canPinMessages=!1,this.iconPack=o,this.t=r(),this.now=new Date,this.showLatestMessageButton=!1,this.onScroll=t=>{const e=t.target;s((()=>{const{scrollTop:t,clientHeight:i,scrollHeight:a}=e;t+i+10>=a?(this.autoScrollEnabled=!0,this.showLatestMessageButton=!1):this.autoScrollEnabled=!1}))},this.scrollToBottom=()=>{m(this.$chat)},this.observeMessage=t=>{t&&this.observingEl.push(t);try{this.intersectionObserver.observe(t)}catch(t){}},this.getMessageActions=t=>{const e=[];return!t.pinned&&this.canPinMessages&&e.push({id:"pin_message",label:this.t("pin"),icon:this.iconPack.pin}),e},this.onMessageActionHandler=(t,e)=>{"pin_message"===t&&this.onPinMessage.emit(e)}}connectedCallback(){var t;this.lastReadTimestamp=null!==(t=h.everyone)&&void 0!==t?t:new Date("0001-01-01T00:00:00Z"),this.intersectionObserver=new IntersectionObserver((t=>{document.hasFocus()&&s((()=>{for(const e of t)e.isIntersecting&&parseInt(e.target.getAttribute("data-timestamp"))>this.lastReadTimestamp.getTime()&&(h[this.selectedGroup]=new Date)}))}));const e=()=>{this.now=new Date,this.timeout=setTimeout((()=>{null!=this.request&&(this.request=requestAnimationFrame(e))}),6e4)};this.request=requestAnimationFrame(e),this.chatChanged(this.messages)}componentDidLoad(){this.$chat.addEventListener("scroll",this.onScroll),this.$chat.scrollTop=this.$chat.scrollHeight}componentDidRender(){this.autoScrollEnabled?m(this.$chat):null==this.autoScrollEnabled&&m(this.$chat,!1)}chatChanged(t){if(null!=this.$chat&&!this.autoScrollEnabled&&this.$chat.clientHeight!==this.$chat.scrollHeight)for(let e=t.length-1;e>=0;e--)if(t[e].message.time>this.lastReadTimestamp&&t[e].message.userId!==this.selfUserId){this.showLatestMessageButton=!0;break}}selectedBucketChanged(){this.autoScrollEnabled=void 0,this.observingEl.forEach((t=>{this.intersectionObserver.unobserve(t)})),this.observingEl=[]}disconnectedCallback(){this.$chat.removeEventListener("scroll",this.onScroll),this.intersectionObserver.disconnect(),clearTimeout(this.timeout),cancelAnimationFrame(this.request)}render(){var t;let e=null,n=!1;return i(a,{key:"01c61fd2a60ca11df413406967eb80af92d07de0"},i("div",{key:"b1a6ad7904236a7fdb50034f33de979faa080ef6",class:"chat-container scrollbar",ref:t=>this.$chat=t,part:"container"},i("div",{key:"95664e4f9b8faae0c31c128abc6f54cf5bcd6acf",class:"spacer",part:"spacer"}),i("div",{key:"e0c40200e05026bb748e608ba6abb6f02b5a701c",class:"chat",part:"chat"},null===(t=this.messages)||void 0===t?void 0:t.map((t=>{if("chat"===t.type){const{message:a}=t,s=!(a.userId===this.selfUserId)&&!this.autoScrollEnabled&&!n&&a.time>this.lastReadTimestamp;s&&(n=s);const o=!s&&a.userId===(null==e?void 0:e.userId)&&v(a.time,null==e?void 0:e.time)<2;return e=a,i("div",{"is-continued":o,key:t.message.id,ref:this.observeMessage,"data-timestamp":a.time.getTime(),class:a.pinned?"pinned":""},s&&i("div",{class:"new-chat-marker",part:"new-chat-marker"},this.t("chat.new")),i("div",{class:"message-wrapper"},i("dyte-message-view",{time:a.time,actions:this.getMessageActions(a),authorName:a.displayName,hideAuthorName:!0,hideAvatar:!0,hideMetadata:!0,viewType:"incoming",variant:"bubble",onAction:t=>this.onMessageActionHandler(t.detail,a)},i("div",null,!o&&i("div",{class:"head"},i("div",{class:"name"},a.displayName),!!a.time&&i("div",{class:"time",title:u(a.time)},f(a.time,new Date(Date.now())))),i("div",{class:"body"},"text"===a.type&&i("dyte-text-message-view",{text:a.message,isMarkdown:!0}),"file"===a.type&&i("dyte-file-message-view",{name:a.name,url:a.link,size:a.size}),"image"===a.type&&i("dyte-image-message-view",{url:a.link,onPreview:()=>{this.stateUpdate.emit({image:a})}})))),a.pinned&&i("div",{class:"pin-button",part:"pin-button"},i("dyte-tooltip",{label:this.t("unpin")},i("dyte-button",{kind:"icon",variant:"ghost",onClick:()=>this.onMessageActionHandler("pin_message",a),disabled:!this.canPinMessages},i("dyte-icon",{icon:this.iconPack.pin,size:"sm"}))))))}return null})))),i("div",{key:"518df977aebf5ecfc26a3f93904e24f92f607fc4",class:"show-new-messages-ctr"},i("dyte-button",{key:"7b6f0a1461957ec5947e4976d6457125e1096f16",class:{"show-new-messages":!0,active:this.showLatestMessageButton},kind:"icon",part:"show-new-messages",onClick:this.scrollToBottom},i("dyte-icon",{key:"0af3acc46412913b7555d8e2256ad2840c6f6226",icon:this.iconPack.chevron_down}))))}static get watchers(){return{messages:["chatChanged"],selectedGroup:["selectedBucketChanged"]}}};$([p()],P.prototype,"size",void 0),$([p()],P.prototype,"iconPack",void 0),$([p()],P.prototype,"t",void 0),P.style=":host{line-height:initial;font-family:var(--dyte-font-family, sans-serif);font-feature-settings:normal;font-variation-settings:normal}p{margin:var(--dyte-space-0, 0px);padding:var(--dyte-space-0, 0px)}.scrollbar{scrollbar-width:thin;scrollbar-color:var(--dyte-scrollbar-color, rgb(var(--dyte-colors-background-600, 60 60 60)))\n    var(--dyte-scrollbar-background, transparent)}.scrollbar::-webkit-scrollbar{height:var(--dyte-space-1\\.5, 6px);width:var(--dyte-space-1\\.5, 6px);border-radius:9999px;background-color:var(--dyte-scrollbar-background, transparent)}.scrollbar::-webkit-scrollbar-thumb{border-radius:9999px;background-color:var(--dyte-scrollbar-color, rgb(var(--dyte-colors-background-600, 60 60 60)))}:host{position:relative;display:flex;flex-direction:column;--tw-bg-opacity:1;background-color:rgba(var(--dyte-colors-background-900, 26 26 26) / var(--tw-bg-opacity));word-break:break-word}.chat-container{box-sizing:border-box;display:flex;flex-direction:column;padding-top:var(--dyte-space-4, 16px);padding-bottom:var(--dyte-space-4, 16px);flex:1 0 0px;overflow-y:scroll}.chat-container .spacer{flex:1 1 auto}.chat-container .chat{flex:0 0 auto}.file-picker{display:none}.chat .head{display:flex;align-items:center}.chat .head .name{margin-right:var(--dyte-space-4, 16px);font-size:12px;font-weight:700}.chat .head .time{font-size:12px;color:rgb(var(--dyte-colors-text-800, 255 255 255 / 0.76))}.chat .body{margin-top:var(--dyte-space-2, 8px);overflow-wrap:break-word;line-height:1.375}.chat .body .emoji{font-size:24px}p{margin-top:var(--dyte-space-0, 0px);margin-bottom:var(--dyte-space-3, 12px)}dyte-message-view{margin-top:var(--dyte-space-4, 16px);display:block;padding-left:var(--dyte-space-2, 8px);padding-right:var(--dyte-space-2, 8px);color:rgb(var(--dyte-colors-text-900, 255 255 255 / 0.88));box-sizing:border-box}dyte-message-view::part(message){flex-grow:1}*[is-continued] dyte-message-view{margin-top:var(--dyte-space-1, 4px)}.pinned .message-wrapper{position:relative}.pinned .pin-button{position:absolute;right:var(--dyte-space-4, 16px);top:calc(var(--dyte-space-4, 16px) * -1);display:flex;border-radius:var(--dyte-border-radius-sm, 4px);--tw-bg-opacity:1;background-color:rgba(var(--dyte-colors-background-600, 60 60 60) / var(--tw-bg-opacity))}.pinned .pin-button:hover dyte-button{--tw-bg-opacity:1;background-color:rgba(var(--dyte-colors-brand-600, 13 81 253) / var(--tw-bg-opacity))}.pinned dyte-message-view{--tw-bg-opacity:1;background-color:rgba(var(--dyte-colors-background-700, 44 44 44) / var(--tw-bg-opacity));padding-top:var(--dyte-space-1, 4px);padding-bottom:var(--dyte-space-1, 4px)}a{--tw-text-opacity:1;color:rgba(var(--dyte-colors-brand-300, 73 124 253) / var(--tw-text-opacity));text-decoration-line:none}a:hover{text-decoration-line:underline}.new-chat-marker{display:flex;width:100%;align-items:center;gap:var(--dyte-space-2, 8px);--tw-text-opacity:1;color:rgba(var(--dyte-colors-brand-300, 73 124 253) / var(--tw-text-opacity))}.new-chat-marker::before{content:'';height:1px;flex:1 1 0%;background-color:rgba(var(--dyte-colors-brand-300, 73 124 253) / 0.5)}.show-new-messages-ctr{pointer-events:none;display:flex;justify-content:flex-end;padding:var(--dyte-space-3, 12px);z-index:0;margin-top:calc(var(--dyte-space-14, 56px) * -1)}.show-new-messages{pointer-events:auto;--tw-translate-y:var(--dyte-space-16, 64px);transform:translate(var(--tw-translate-x), var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y));opacity:0;transition-property:color, background-color, border-color, text-decoration-color, fill, stroke, opacity, box-shadow, transform, filter, -webkit-backdrop-filter;transition-property:color, background-color, border-color, text-decoration-color, fill, stroke, opacity, box-shadow, transform, filter, backdrop-filter;transition-property:color, background-color, border-color, text-decoration-color, fill, stroke, opacity, box-shadow, transform, filter, backdrop-filter, -webkit-backdrop-filter;transition-timing-function:cubic-bezier(0.4, 0, 0.2, 1);transition-duration:150ms}.show-new-messages.active{--tw-translate-y:var(--dyte-space-0, 0px);transform:translate(var(--tw-translate-x), var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y));opacity:1}";var q=function(t,e,i,a){var n,s=arguments.length,o=s<3?e:null===a?a=Object.getOwnPropertyDescriptor(e,i):a;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,a);else for(var r=t.length-1;r>=0;r--)(n=t[r])&&(o=(s<3?n(o):s>3?n(e,i,o):n(e,i))||o);return s>3&&o&&Object.defineProperty(e,i,o),o};const S=class{constructor(a){t(this,a),this.editMessageInit=e(this,"editMessageInit",7),this.onPinMessage=e(this,"pinMessage",7),this.onDeleteMessage=e(this,"deleteMessage",7),this.stateUpdate=e(this,"dyteStateUpdate",7),this.iconPack=o,this.t=r(),this.leftAlign=!1,this.permissionsChanged=!1,this.pageSize=25,this.lastReadMessageIndex=-1,this.permissionsUpdateListener=()=>{this.permissionsChanged=!this.permissionsChanged},this.maybeMarkChannelAsRead=t=>{if(!this.selectedChannelId)return;if(0===t.length)return;if(-1!==this.lastReadMessageIndex)return;const e=t.at(0).time>t.at(-1).time?t.at(0):t.at(-1);e.channelIndex&&(this.lastReadMessageIndex=parseInt(e.channelIndex,10),this.meeting.chat.markLastReadMessage(this.selectedChannelId,e))},this.getChatMessages=async(t,e,i)=>{const{messages:a}=await this.meeting.chat.getMessages(t,e,i,void 0,this.selectedChannelId);return this.maybeMarkChannelAsRead(a),a},this.createChatNodes=t=>t.map(((e,i)=>{var a;const n=e.userId===(null===(a=t[i-1])||void 0===a?void 0:a.userId);return this.createChatNode(e,n)})),this.disconnectMeeting=t=>{var e,i;null===(e=null==t?void 0:t.chat)||void 0===e||e.removeListener("chatUpdate",this.chatUpdateListener),null===(i=this.meeting)||void 0===i||i.self.permissions.removeListener("permissionsUpdate",this.permissionsUpdateListener)},this.getMessageActions=t=>{const e=[];return this.meeting.self.permissions.pinParticipant&&e.push({id:"pin_message",label:this.t(t.pinned?"unpin":"pin"),icon:this.iconPack.pin}),e},this.onMessageActionHandler=(t,e)=>{switch(t){case"pin_message":this.onPinMessage.emit(e);break;case"delete_message":this.onDeleteMessage.emit(e)}},this.createChatNode=(t,e)=>{var a,n,s,o;if(0!==t.targetUserIds.length)return null;let r;return r="CHAT"===this.meeting.meta.viewType?null===(a=this.meeting.participants.all.toArray().find((e=>e.userId===t.userId)))||void 0===a?void 0:a.picture:this.meeting.self.userId===t.userId?this.meeting.self.picture:null!==(s=null===(n=this.meeting.participants.joined.toArray().find((e=>e.userId===t.userId)))||void 0===n?void 0:n.picture)&&void 0!==s?s:null===(o=this.meeting.participants.waitlisted.toArray().find((e=>e.userId===t.userId)))||void 0===o?void 0:o.picture,i("div",{class:{pinned:t.pinned}},i("div",{class:"message-wrapper"},i("dyte-message-view",{time:t.time,actions:this.getMessageActions(t),authorName:t.displayName,avatarUrl:r,hideAuthorName:e,viewType:"incoming",variant:"bubble",onAction:e=>this.onMessageActionHandler(e.detail,t)},i("div",null,i("div",{class:"body"},"text"===t.type&&i("dyte-text-message-view",{text:t.message,isMarkdown:!0}),"file"===t.type&&i("dyte-file-message-view",{name:t.name,url:t.link,size:t.size}),"image"===t.type&&i("dyte-image-message-view",{url:t.link,onPreview:()=>{this.stateUpdate.emit({image:t})}})),t.pinned&&i("div",{class:"pin-icon",part:"pin-icon"},i("dyte-icon",{icon:this.iconPack.pin,size:"sm"}))))))},this.chatUpdateListener=t=>{this.selectedChannelId&&t.message.channelId!==this.selectedChannelId||("add"===t.action?(this.$paginatedListRef.onNewNode(t.message),this.lastReadMessageIndex=-1,this.maybeMarkChannelAsRead([t.message])):"delete"===t.action?this.$paginatedListRef.onNodeDelete(t.message.id):"edit"===t.action&&this.$paginatedListRef.onNodeUpdate(t.message.id,t.message))}}componentDidLoad(){const t=this.host.shadowRoot.querySelector("slot");t&&(this.children=t.assignedElements()[0])}connectedCallback(){this.meetingChanged(this.meeting)}disconnectedCallback(){this.disconnectMeeting(this.meeting)}meetingChanged(t,e){var i;null!=e&&this.disconnectMeeting(e),t&&!t.chat||(null!=t&&(null===(i=t.chat)||void 0===i||i.addListener("chatUpdate",this.chatUpdateListener),t.self.permissions.addListener("permissionsUpdate",this.permissionsUpdateListener)),this.permissionsUpdateListener())}channelChanged(){this.lastReadMessageIndex=-1}render(){return i(a,{key:"0f87ae87443f5ebcb771924591c9b9d30af425f6"},i("dyte-paginated-list",{key:"f3a82fc12cf42265eb838da5d3bd36e2e3402fae",ref:t=>this.$paginatedListRef=t,pageSize:this.pageSize,pagesAllowed:3,fetchData:this.getChatMessages,createNodes:this.createChatNodes,selectedItemId:this.selectedChannelId,emptyListLabel:this.t("chat.empty_channel")},i("slot",{key:"89d54672424cfff5fe73d8ece157cdcf5534fa30"})))}get host(){return n(this)}static get watchers(){return{meeting:["meetingChanged"],selectedChannelId:["channelChanged"]}}};q([p()],S.prototype,"meeting",void 0),q([p()],S.prototype,"size",void 0),q([p()],S.prototype,"iconPack",void 0),q([p()],S.prototype,"t",void 0),S.style=":host{display:flex;flex-direction:column;--tw-bg-opacity:1;background-color:rgba(var(--dyte-colors-background-900, 26 26 26) / var(--tw-bg-opacity));flex:1 0 0px}";var T=function(t,e,i,a){var n,s=arguments.length,o=s<3?e:null===a?a=Object.getOwnPropertyDescriptor(e,i):a;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,a);else for(var r=t.length-1;r>=0;r--)(n=t[r])&&(o=(s<3?n(o):s>3?n(e,i,o):n(e,i))||o);return s>3&&o&&Object.defineProperty(e,i,o),o};const A=class{constructor(e){t(this,e),this.iconPack=o,this.t=r(),this.pageSize=50,this.searchMessages=async(t,e,i)=>this.meeting.chat.searchMessages(this.query,{channelId:this.channelId,timestamp:t,size:e,reversed:i}),this.nodeRenderer=t=>t.map((t=>i("dyte-chat-message",{key:t.id,message:t,disableControls:!0})))}render(){return i(a,{key:"984a388e6c194e27c5cb7918806bd9f156220ec7"},i("dyte-paginated-list",{key:"444fa000de6428b4c0c6e0c829eb4ef944d2a211",pageSize:this.pageSize,pagesAllowed:3,fetchData:this.searchMessages,createNodes:this.nodeRenderer,selectedItemId:this.query}))}};T([p()],A.prototype,"meeting",void 0),T([p()],A.prototype,"iconPack",void 0),T([p()],A.prototype,"t",void 0),A.style=":host{line-height:initial;font-family:var(--dyte-font-family, sans-serif);font-feature-settings:normal;font-variation-settings:normal}p{margin:var(--dyte-space-0, 0px);padding:var(--dyte-space-0, 0px)}:host{display:flex;height:100%;flex-direction:column;position:relative;--tw-bg-opacity:1;background-color:rgba(var(--dyte-colors-background-900, 26 26 26) / var(--tw-bg-opacity))}";var U=function(t,e,i,a){var n,s=arguments.length,o=s<3?e:null===a?a=Object.getOwnPropertyDescriptor(e,i):a;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,a);else for(var r=t.length-1;r>=0;r--)(n=t[r])&&(o=(s<3?n(o):s>3?n(e,i,o):n(e,i))||o);return s>3&&o&&Object.defineProperty(e,i,o),o};const M=class{constructor(i){t(this,i),this.stateUpdate=e(this,"dyteStateUpdate",7),this.config=d,this.iconPack=o,this.t=r(),this.updateStoreState=(t,e)=>{this.stateUpdate.emit({[t]:e})},this.cancelJoinStage=async()=>{var t,e,i;"ACCEPTED_TO_JOIN_STAGE"===(null===(t=this.meeting.stage)||void 0===t?void 0:t.status)&&await(null===(i=null===(e=this.meeting)||void 0===e?void 0:e.stage)||void 0===i?void 0:i.leave()),this.updateStoreState("activeJoinStage",!1)},this.joinStage=async()=>{await this.meeting.stage.join()},this.stageStatusUpdateListener=t=>{var e;(null===(e=this.states)||void 0===e?void 0:e.activeJoinStage)&&"ON_STAGE"===t&&this.updateStoreState("activeJoinStage",!1)}}connectedCallback(){this.meetingChanged(this.meeting)}disconnectedCallback(){var t;null===(t=this.meeting.stage)||void 0===t||t.removeListener("stageStatusUpdate",this.stageStatusUpdateListener)}meetingChanged(t){if(null==t)return;const{stage:e}=t;null==e||e.addListener("stageStatusUpdate",this.stageStatusUpdateListener)}render(){var t,e,n,s;const o={meeting:this.meeting,states:this.states,config:this.config,size:this.size,iconPack:this.iconPack,t:this.t},r=this.states;if(null!=(null==r?void 0:r.image)){const t=()=>{this.stateUpdate.emit({image:null})};return i(a,null,i("dyte-dialog",{open:!0,onDyteDialogClose:t,hideCloseButton:!0,iconPack:this.iconPack,t:this.t},i(x,{element:"dyte-image-viewer",defaults:o,props:{image:r.image,onClose:t}})))}if(!0===(null==r?void 0:r.activeSettings))return i(a,null,i("dyte-dialog",{open:!0,onDyteDialogClose:()=>this.updateStoreState("activeSettings",!1),iconPack:this.iconPack,t:this.t},i(x,{element:"dyte-settings",defaults:o})));if(!0===(null==r?void 0:r.activeDebugger))return i(a,null,i("dyte-dialog",{open:!0,onDyteDialogClose:()=>this.updateStoreState("activeDebugger",!1),iconPack:this.iconPack,t:this.t},i(x,{element:"dyte-debugger",defaults:o})));if(!0===(null==r?void 0:r.activeLeaveConfirmation))return i(a,null,i("dyte-dialog",{open:!0,onDyteDialogClose:()=>this.updateStoreState("activeLeaveConfirmation",!1),iconPack:this.iconPack,t:this.t},i(x,{element:"dyte-leave-meeting",defaults:o})));if(!0===(null===(t=null==r?void 0:r.activePermissionsMessage)||void 0===t?void 0:t.enabled))return i(a,null,i("dyte-dialog",{open:!0,hideCloseButton:!0,iconPack:this.iconPack,t:this.t},i(x,{element:"dyte-permissions-message",defaults:o})));if(!0===(null==r?void 0:r.activeRemoteAccessManager))return i(a,null,i("dyte-dialog",{open:!0,onDyteDialogClose:()=>this.updateStoreState("activeRemoteAccessManager",!1),iconPack:this.iconPack,t:this.t},i(x,{element:"dyte-remote-access-manager",defaults:o})));if(!0===(null===(e=null==r?void 0:r.activeBreakoutRoomsManager)||void 0===e?void 0:e.active))return i(a,null,i("dyte-dialog",{open:!0,onDyteDialogClose:()=>this.updateStoreState("activeBreakoutRoomsManager",{active:!1,data:void 0}),iconPack:this.iconPack,t:this.t},i(x,{element:"dyte-breakout-rooms-manager",defaults:o,props:{mode:this.meeting.connectedMeetings.isActive?"view":"create"}})));if(!0===(null===(n=null==r?void 0:r.activeConfirmationModal)||void 0===n?void 0:n.active))return i(a,null,i("dyte-dialog",{open:!0,onDyteDialogClose:()=>this.updateStoreState("activeConfirmationModal",!1),iconPack:this.iconPack,t:this.t},i(x,{element:"dyte-confirmation-modal",defaults:o})));if(!0===(null===(s=null==r?void 0:r.activeOverlayModal)||void 0===s?void 0:s.active))return i(a,null,i("dyte-overlay-modal",{meeting:this.meeting,states:this.states,iconPack:this.iconPack,t:this.t}));if(null==r?void 0:r.activeBroadcastMessageModal)return i(a,null,i("dyte-dialog",{open:!0,onDyteDialogClose:()=>this.updateStoreState("activeBroadcastMessageModal",!1),iconPack:this.iconPack,t:this.t},i(x,{element:"dyte-broadcast-message-modal",defaults:o})));if(!0===(null==r?void 0:r.activeJoinStage)){const t={title:this.t("stage.join_title"),label:{accept:this.t("stage.join_confirm"),reject:this.t("stage.join_cancel")},description:this.t("stage.join_summary")};return i(a,null,i("dyte-dialog",{open:!0,onDyteDialogClose:this.cancelJoinStage,iconPack:this.iconPack,t:this.t},i("dyte-join-stage",Object.assign({dataConfig:t,onDyteJoinStage:this.joinStage,onDyteLeaveStage:this.cancelJoinStage},o))))}return!0===(null==r?void 0:r.activeMuteAllConfirmation)?i(a,null,i("dyte-dialog",{open:!0,onDyteDialogClose:()=>{this.updateStoreState("activeMuteAllConfirmation",!1)},iconPack:this.iconPack,t:this.t},i(x,{element:"dyte-mute-all-confirmation",defaults:o}))):(null==r?void 0:r.activeChannelCreator)?i(a,null,i("dyte-dialog",{open:!0,onDyteDialogClose:()=>{this.updateStoreState("activeChannelCreator",!1)},iconPack:this.iconPack,t:this.t},i(x,{element:"dyte-channel-creator",defaults:o}))):null}static get watchers(){return{meeting:["meetingChanged"]}}};U([p()],M.prototype,"meeting",void 0),U([p()],M.prototype,"states",void 0),U([p()],M.prototype,"size",void 0),U([p()],M.prototype,"iconPack",void 0),U([p()],M.prototype,"t",void 0),M.style=":host{line-height:initial;font-family:var(--dyte-font-family, sans-serif);font-feature-settings:normal;font-variation-settings:normal}p{margin:var(--dyte-space-0, 0px);padding:var(--dyte-space-0, 0px)}:host{display:block}";const E=2e3,L=Object.freeze({notifications:{participant_joined:!0,participant_left:!0,participant_joined_waitlist:!0,chat:!0,polls:!0,webinar:!0,tab_sync:!0,recording_started:!0,recording_stopped:!0},notification_sounds:{participant_joined:!0,participant_left:!0,chat:!0,polls:!0,webinar:!0,participant_joined_waitlist:!0},notification_duration:{participant_joined:2100,participant_left:2100,participant_joined_waitlist:4e3,chat:E,polls:E,webinar:E,tab_sync:E,recording_started:E,recording_stopped:E},participant_joined_sound_notification_limit:10,participant_chat_message_sound_notification_limit:10});var I=function(t,e,i,a){var n,s=arguments.length,o=s<3?e:null===a?a=Object.getOwnPropertyDescriptor(e,i):a;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,a);else for(var r=t.length-1;r>=0;r--)(n=t[r])&&(o=(s<3?n(o):s>3?n(e,i,o):n(e,i))||o);return s>3&&o&&Object.defineProperty(e,i,o),o};function N(t){return Object.keys(t).filter((e=>t[e]))}const J=class{constructor(e){t(this,e),this.permissions=L,this.enabledSounds=N(L.notification_sounds),this.config=d,this.t=r(),this.iconPack=o,this.notifications=[],this.addStagePeersListeners=t=>{t.participants.joined.addListener("participantJoined",this.participantJoinedListener),t.participants.joined.addListener("participantLeft",this.participantLeftListener)},this.removeStagePeersListeners=t=>{t.participants.joined.removeListener("participantJoined",this.participantJoinedListener),t.participants.joined.removeListener("participantLeft",this.participantLeftListener)},this.onDyteNotification=t=>{this.add(t.detail);const e=t.detail.playSound;null!=e&&this.audio.play(e)},this.onRecordingUpdate=t=>{var e,i;"RECORDING"===t&&!1!==this.permissions.notifications.recording_started?this.add({id:"recording-started",icon:this.iconPack.recording,message:this.t("recording.started"),duration:null!==(e=this.permissions.notification_duration.recording_started)&&void 0!==e?e:E}):"STOPPING"===t&&!1!==this.permissions.notifications.recording_stopped&&this.add({id:"recording-stopped",icon:this.iconPack.stop_recording,message:this.t("recording.stopped"),duration:null!==(i=this.permissions.notification_duration.recording_stopped)&&void 0!==i?i:E})}}connectedCallback(){"undefined"!=typeof document&&(null===document||void 0===document||document.addEventListener("dyteNotification",this.onDyteNotification)),this.meetingChanged(this.meeting),this.configChanged(this.config),this.statesChanged(this.states)}clearListeners(t){var e,i,a,n,s,o,r,d;const c="LIVESTREAM"===t.meta.viewType;(c&&"ON_STAGE"===(null===(e=t.stage)||void 0===e?void 0:e.status)||!c)&&this.removeStagePeersListeners(t),this.chatUpdateListener&&(null===(i=t.chat)||void 0===i||i.removeListener("chatUpdate",this.chatUpdateListener)),this.pollUpdateListener&&(null===(a=t.polls)||void 0===a||a.removeListener("pollsUpdate",this.pollUpdateListener)),t.meta.removeListener("socketConnectionUpdate",this.socketConnectionUpdateListener),this.stageRequestAccepted&&(null===(n=t.stage)||void 0===n||n.removeListener("stageRequestApproved",this.stageRequestAccepted)),this.stageRequestRejected&&(null===(s=t.stage)||void 0===s||s.removeListener("stageRequestRejected",this.stageRequestRejected)),this.newStageRequests&&(null===(o=t.stage)||void 0===o||o.removeListener("newStageRequest",this.newStageRequests)),this.stageStatusUpdateListener&&(null===(r=t.stage)||void 0===r||r.removeListener("stageStatusUpdate",this.stageStatusUpdateListener)),null===(d=t.recording)||void 0===d||d.removeListener("recordingUpdate",this.onRecordingUpdate),clearTimeout(this.disconnectTimeout),t.self.removeListener("deviceUpdate",this.deviceUpdateListener)}disconnectedCallback(){var t;"undefined"!=typeof document&&(null===document||void 0===document||document.removeEventListener("dyteNotification",this.onDyteNotification)),null!=this.meeting&&(this.clearListeners(this.meeting),this.waitlistedParticipantJoinedListener&&this.meeting.participants.waitlisted.removeListener("participantJoined",this.waitlistedParticipantJoinedListener),this.waitlistedParticipantLeftListener&&this.meeting.participants.waitlisted.removeListener("participantLeft",this.waitlistedParticipantLeftListener),this.activeTabUpdateListener&&(null===(t=this.meeting.meta)||void 0===t||t.removeListener("activeTabUpdate",this.activeTabUpdateListener)),this.peerStageStatusListener&&this.meeting.participants.joined.removeListener("stageStatusUpdate",this.peerStageStatusListener))}meetingChanged(t,e){var i,a,n,s,o,r,d,l,h;if(clearTimeout(this.disconnectTimeout),void 0!==e&&this.clearListeners(e),null==t)return;const p="LIVESTREAM"===t.meta.viewType;this.audio=new w(t);const{notifications:b,notification_duration:g,notification_sounds:v}=this.permissions;if(this.participantJoinedListener=t=>{b.participant_joined&&this.add({id:`${t.id}-joined`,message:`${k(t.name)} ${this.t("notifications.joined")}`,image:t.picture,duration:g.participant_joined}),v.participant_joined&&this.canPlayParticipantJoinedSound()&&this.audio.play("joined")},this.participantLeftListener=t=>{const{socketState:{state:e}}=this.meeting.meta;b.participant_left&&"connected"!==e&&this.add({id:`${t.id}-left`,message:`${k(t.name)} ${this.t("notifications.left")}`,image:t.picture,duration:g.participant_left}),v.participant_left&&this.canPlayParticipantJoinedSound()&&this.audio.play("left")},this.waitlistedParticipantJoinedListener=t=>{if(!this.canAcceptWaitingRequests())return;const e=`${t.id}-joined-waitlist`;this.add({id:e,message:`${k(t.name)} ${this.t("notifications.requesting_to_join_meeting")}`,image:t.picture,duration:g.participant_joined_waitlist,button:{text:this.t("notifications.accept"),variant:"primary",onClick:async()=>{await this.meeting.participants.acceptWaitingRoomRequest(t.id),this.remove(e)}}}),v.participant_joined_waitlist&&this.canPlayParticipantJoinedSound()&&this.audio.play("message")},this.waitlistedParticipantLeftListener=t=>{this.remove(`${t.id}-joined-waitlist`)},this.chatUpdateListener=({message:e})=>{const i=y(e);if(null!=i){if(i.userId===t.self.userId)return;"text"===i.type&&(b.chat&&this.add({id:`message-${Math.random().toString(36)}`,icon:this.iconPack.chat,message:`${i.displayName}: ${i.message}`,duration:g.chat}),v.chat&&this.canPlayChatSound()&&this.audio.play("message"))}},this.pollUpdateListener=({polls:t,newPoll:e})=>{!1!==e&&(b.polls&&this.meeting.self.userId!==t[t.length-1].createdByUserId&&this.add({id:`poll-${Math.random().toString(36)}`,icon:this.iconPack.poll,message:`${this.t("notifications.new_poll_created_by")} ${t[t.length-1].createdBy}`,duration:g.polls}),v.polls&&this.meeting.self.userId!==t[t.length-1].createdByUserId&&this.canPlayChatSound()&&this.audio.play("message"))},this.deviceUpdateListener=({device:t,preview:e})=>{e||("audiooutput"===t.kind&&(this.audio.setDevice(t.deviceId),this.remove("speaker-switched"),this.add({id:"speaker-switched",message:`${this.t("notifications.connected_to")} ${t.label}`,icon:this.iconPack.speaker,duration:5e3})),"videoinput"===t.kind&&(this.remove("camera-switched"),this.add({id:"camera-switched",message:`${this.t("notifications.connected_to")} ${t.label}`,icon:this.meeting.self.videoEnabled?this.iconPack.video_on:this.iconPack.video_off,iconVariant:this.meeting.self.videoEnabled?"primary":"danger",duration:5e3})),"audioinput"===t.kind&&(this.remove("mic-switched"),this.add({id:"mic-switched",message:`${this.t("notifications.connected_to")} ${t.label}`,icon:this.meeting.self.audioEnabled?this.iconPack.mic_on:this.iconPack.mic_off,iconVariant:this.meeting.self.audioEnabled?"primary":"danger",duration:5e3})))},this.socketConnectionUpdateListener=({state:t,reconnectionAttempt:e,reconnected:i})=>{switch(t){case"connected":this.remove("socket"),i&&this.add({id:"socket",icon:this.iconPack.wifi,message:this.t("network.restored"),duration:3e3});break;case"disconnected":this.remove("socket"),this.add({id:"socket",icon:this.iconPack.disconnected,message:this.t("network.reconnecting")});break;case"reconnecting":e>=6?(this.remove("socket"),this.add({id:"socket",icon:this.iconPack.disconnected,message:this.t("network.disconnected"),button:{text:this.t("end"),variant:"danger",onClick:()=>{var t;return null===(t=this.meeting)||void 0===t?void 0:t.leaveRoom()}}})):e>=4&&(this.remove("socket"),this.add({id:"socket",icon:this.iconPack.disconnected,message:this.t("network.delay_extended")}));break;case"failed":this.remove("socket"),this.add({id:"socket",icon:this.iconPack.disconnected,message:this.t("network.leaving"),button:{text:this.t("end"),variant:"danger",onClick:()=>{var t;return null===(t=this.meeting)||void 0===t?void 0:t.leaveRoom()}}})}},this.activeTabUpdateListener=e=>{if(b.tab_sync)switch(e.type){case"plugin":const i=t.plugins.active.toArray().find((t=>t.id==e.id));null!=i&&this.add({id:"activeTab",message:`${this.t("notifications.plugin_switched_to")} ${i.name}`,duration:g.participant_joined});break;case"screenshare":const a=t.participants.joined.toArray().filter((t=>t.screenShareEnabled)).find((t=>t.id==e.id));null!=a&&this.add({id:"spotlight",message:`Now watching ${a.name}'s screen`,duration:g.webinar})}},this.peerStageStatusListener=t=>{"REQUESTED_TO_JOIN_STAGE"===t.stageStatus&&(this.add({id:`stage-request-${t.id}`,message:`${t.name} ${this.t("notifications.requested_to_join_stage")}`,duration:g.webinar,button:{text:this.t("notifications.accept"),variant:"primary",onClick:async()=>{await this.meeting.stage.grantAccess([t.userId]),this.remove(`stage-request-${t.id}`)}}}),v.webinar&&this.audio.play("joined")),"ON_STAGE"===t.stageStatus&&(this.add({id:`stage-joined-${t.id}`,message:`${t.name} ${this.t("notifications.joined_stage")}`,duration:g.webinar}),v.webinar&&this.audio.play("joined"))},this.stageRequestAccepted=()=>{this.add({id:"stage-request-accepted",message:this.t("notifications.request_to_join_accepted"),duration:3e3})},this.stageRequestRejected=()=>{this.add({id:"stage-request-rejected",message:this.t("notifications.request_to_join_rejected"),duration:3e3})},this.newStageRequests=({count:t})=>{this.add({id:"new-stage-request",message:`You have ${t<0?"new stage":`${t} pending`} request${1===t?"":"s"}`,duration:3e3})},this.stageStatusUpdateListener=e=>{"ON_STAGE"===e?this.addStagePeersListeners(t):this.removeStagePeersListeners(t)},!c(t)&&(null===(i=t.chat)||void 0===i||i.addListener("chatUpdate",this.chatUpdateListener)),"CHAT"===(null===(a=t.self.config.viewType)||void 0===a?void 0:a.toString()))return;const u=t.self.getCurrentDevices();null!=u.speaker&&this.audio.setDevice(u.speaker.deviceId),p?null===(n=t.stage)||void 0===n||n.on("stageStatusUpdate",this.stageStatusUpdateListener):this.addStagePeersListeners(t),this.canAcceptWaitingRequests()&&(t.participants.waitlisted.addListener("participantJoined",this.waitlistedParticipantJoinedListener),t.participants.waitlisted.addListener("participantLeft",this.waitlistedParticipantLeftListener)),null===(s=t.polls)||void 0===s||s.addListener("pollsUpdate",this.pollUpdateListener),t.self.addListener("deviceUpdate",this.deviceUpdateListener),t.meta.addListener("socketConnectionUpdate",this.socketConnectionUpdateListener),null===(o=t.meta)||void 0===o||o.addListener("activeTabUpdate",this.activeTabUpdateListener),null===(r=t.recording)||void 0===r||r.addListener("recordingUpdate",this.onRecordingUpdate),null===(d=t.stage)||void 0===d||d.addListener("stageRequestApproved",this.stageRequestAccepted),null===(l=t.stage)||void 0===l||l.addListener("stageRequestRejected",this.stageRequestRejected),t.self.permissions.stageEnabled&&t.self.permissions.acceptStageRequests&&(null===(h=t.stage)||void 0===h||h.addListener("newStageRequest",this.newStageRequests))}configChanged(t){null!=t&&null!=(null==t?void 0:t.config)&&(this.permissions=function(t){const e=Object.assign({},L);return null==t||(Object.assign(e.notification_sounds,t.notification_sounds),Object.assign(e.notifications,t.notifications),Object.assign(e.notification_duration,t.notification_duration),e.participant_chat_message_sound_notification_limit=t.participant_chat_message_sound_notification_limit,e.participant_joined_sound_notification_limit=t.participant_joined_sound_notification_limit),e}(t.config),this.enabledSounds=N(this.permissions.notification_sounds))}statesChanged(t){var e;if(null!=t){const i=!(null===(e=null==t?void 0:t.prefs)||void 0===e?void 0:e.muteNotificationSounds);for(const t of this.enabledSounds)t in this.permissions.notification_sounds&&(this.permissions.notification_sounds[t]=i)}}apiErrorListener({detail:t}){const{trace:e,message:i}=t;this.add({id:e,message:i,duration:E,icon:this.iconPack.warning})}sendNotificationListener({detail:t}){const{trace:e,message:i}=t;this.add({id:e,message:i,duration:E})}add(t){"visible"===document.visibilityState&&this.notifications.length<5&&(this.notifications=[...this.notifications,t])}remove(t){this.notifications=this.notifications.filter((e=>e.id!==t))}handleDismiss(t){t.stopPropagation();const e=t.detail,i=this.host.shadowRoot.querySelector(`[data-id="${e}"]`);null==i||i.classList.add("exit"),setTimeout((()=>{s((()=>{this.remove(e)}))}),400)}canPlayParticipantJoinedSound(){return null==this.permissions.participant_joined_sound_notification_limit||this.permissions.participant_joined_sound_notification_limit<=0||this.meeting.participants.count<=this.permissions.participant_joined_sound_notification_limit}canPlayChatSound(){return null==this.permissions.participant_chat_message_sound_notification_limit||this.permissions.participant_chat_message_sound_notification_limit<=0||this.meeting.participants.count<=this.permissions.participant_chat_message_sound_notification_limit}canAcceptWaitingRequests(){return this.permissions.notifications.participant_joined_waitlist&&this.meeting.self.permissions.acceptWaitingRequests}render(){return i(a,{key:"1e122b16897a90f7c7900057849e89d5152f477f"},this.notifications.map((t=>i("dyte-notification",{size:this.size,key:t.id,"data-id":t.id,notification:t,onDyteNotificationDismiss:t=>this.handleDismiss(t),iconPack:this.iconPack,t:this.t}))))}get host(){return n(this)}static get watchers(){return{meeting:["meetingChanged"],config:["configChanged"],states:["statesChanged"]}}};I([p()],J.prototype,"meeting",void 0),I([p()],J.prototype,"states",void 0),I([p()],J.prototype,"t",void 0),I([p()],J.prototype,"size",void 0),I([p()],J.prototype,"iconPack",void 0),J.style=":host{line-height:initial;font-family:var(--dyte-font-family, sans-serif);font-feature-settings:normal;font-variation-settings:normal}p{margin:var(--dyte-space-0, 0px);padding:var(--dyte-space-0, 0px)}:host{position:absolute;top:var(--dyte-space-4, 16px);right:var(--dyte-space-4, 16px);bottom:var(--dyte-space-4, 16px);left:var(--dyte-space-4, 16px);top:auto;display:flex;flex-direction:column;pointer-events:none;z-index:100}dyte-notification{margin-top:var(--dyte-space-2, 8px)}";export{j as dyte_channel_header,D as dyte_channel_selector_view,O as dyte_chat_composer_view,P as dyte_chat_messages_ui,S as dyte_chat_messages_ui_paginated,A as dyte_chat_search_results,M as dyte_dialog_manager,J as dyte_notifications}