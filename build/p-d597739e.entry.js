import{r as t,c as i,h as e,H as s,a as h}from"./p-aff91b47.js";import{d as n,l as o,u as a}from"./p-8e40fcf4.js";import{g as d,p as r,d as c}from"./p-229a22c8.js";import{g}from"./p-96be234f.js";import"./p-46923b34.js";import"./p-2c3cda13.js";const m=class{constructor(e){t(this,e),this.statesUpdate=i(this,"dyteStatesUpdate",7),this.config=n,this.showSetupScreen=!1,this.noRenderUntilMeeting=!1,this.handleResize=()=>{this.size=g(this.host.clientWidth)},this.loadTheme=()=>{var t;if(this.config===n){const{config:t}=d(this.meeting.self.config,this.meeting);this.config=t}(null===(t=this.config)||void 0===t?void 0:t.designTokens)&&r(document.documentElement,this.config.designTokens)},this.roomJoinedListener=()=>{this.updateStates({meeting:"joined"})},this.waitlistedListener=()=>{this.updateStates({meeting:"waiting"})},this.roomLeftListener=({state:t})=>{"disconnected"!==t&&"failed"!==t&&this.updateStates({meeting:"ended",roomLeftState:t})},this.mediaPermissionUpdateListener=({kind:t,message:i})=>{!["audio","video"].includes(t)||"DENIED"!==i&&"SYSTEM_DENIED"!==i||!0===o.states.activeDebugger||this.updateStates({activePermissionsMessage:{enabled:!0,kind:t}})},this.socketConnectionUpdateListener=({state:t})=>{"failed"===t&&setTimeout((()=>{this.meeting.leave("disconnected")}),1e4)},this.handleChangingMeeting=t=>{this.updateStates({activeBreakoutRoomsManager:Object.assign(Object.assign({},o.states.activeBreakoutRoomsManager),{destinationMeetingId:t})})}}listenState(t){this.updateStates(t.detail)}updateStates(t){const i=Object.assign({},o.states);o.states=c(i,t),this.statesUpdate.emit(o.states)}connectedCallback(){"undefined"!=typeof window&&(this.authErrorListener=t=>{t.detail.message.includes("401")&&this.updateStates({meeting:"ended",roomLeftState:"unauthorized"})},window.addEventListener("dyteError",this.authErrorListener)),this.onMeetingChange(this.meeting),this.onIconPackChange(this.iconPack),this.onTChange(this.t),this.onConfigChange(this.config),this.onSizeChange(this.size),this.resizeObserver=new ResizeObserver((()=>this.handleResize())),this.resizeObserver.observe(this.host)}disconnectedCallback(){this.resizeObserver.disconnect(),window.removeEventListener("dyteError",this.authErrorListener),this.meeting&&(this.meeting.self.removeListener("roomLeft",this.roomLeftListener),this.meeting.self.removeListener("roomJoined",this.roomJoinedListener),this.meeting.self.removeListener("waitlisted",this.waitlistedListener),this.meeting.self.removeListener("mediaPermissionUpdate",this.mediaPermissionUpdateListener),this.meeting.meta.removeListener("socketConnectionUpdate",this.socketConnectionUpdateListener))}onMeetingChange(t){a.state.meeting=t,t&&(this.updateStates({viewType:t.meta.viewType}),this.loadTheme(),t.self.addListener("roomJoined",this.roomJoinedListener),t.self.addListener("waitlisted",this.waitlistedListener),t.self.addListener("roomLeft",this.roomLeftListener),t.self.addListener("mediaPermissionUpdate",this.mediaPermissionUpdateListener),t.meta.addListener("socketConnectionUpdate",this.socketConnectionUpdateListener),t.connectedMeetings.supportsConnectedMeetings&&t.connectedMeetings.once("changingMeeting",this.handleChangingMeeting),t.self.roomJoined?this.updateStates({meeting:"joined"}):this.showSetupScreen?this.updateStates({meeting:"setup"}):t.joinRoom(),window.removeEventListener("dyteError",this.authErrorListener))}onIconPackChange(t){a.state.iconPack=t}onTChange(t){a.state.t=t}onConfigChange(t){a.state.config=t}onSizeChange(t){a.state.size=t}render(){return e(s,{key:"aa4172c4b0395a5262697346a2731c1829edb369"},this.noRenderUntilMeeting&&!this.meeting?null:e("slot",null))}get host(){return h(this)}static get watchers(){return{meeting:["onMeetingChange"],iconPack:["onIconPackChange"],t:["onTChange"],config:["onConfigChange"],size:["onSizeChange"]}}};m.style="dyte-ui-provider{display:block;width:100%;height:100%}";export{m as dyte_ui_provider}