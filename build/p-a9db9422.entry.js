import{r as t,c as i,h as a,H as s}from"./p-aff91b47.js";import{b as e,d as o,u as d,g as r}from"./p-9362c375.js";import{l as h}from"./p-5605a420.js";import{S as n}from"./p-2fbb888d.js";import"./p-e497ad6d.js";class c{constructor(t,i){this.meeting=t,this.audio=null!=i?i:document.createElement("audio"),this.audio.autoplay=!0,this.audioStream=new MediaStream,this.audio.srcObject=this.audioStream,this.audioTracks=[]}addTrack(t,i){this.audioTracks.some((i=>i.id===t))||(this.audioTracks.push({id:t,track:i}),this.audioStream.addTrack(i),this.play())}removeTrack(t){const i=this.audioTracks.find((i=>i.id===t));null!=i&&(this.audioStream.removeTrack(i.track),this.audioTracks=this.audioTracks.filter((i=>i.id!==t)))}async play(){var t;this.audio.srcObject=this.audioStream,await(null===(t=this.audio.play())||void 0===t?void 0:t.catch((t=>{"NotAllowedError"===t.name?null!=this._onError&&this._onError():"AbortError"!==t.name&&h.error("[dyte-audio] play() error\n",t)})))}async setDevice(t){var i,a,s;e(this.meeting)||await(null===(s=null===(a=(i=this.audio).setSinkId)||void 0===a?void 0:a.call(i,t))||void 0===s?void 0:s.catch((t=>{h.error("[dyte-audio] setSinkId() error\n",t)})))}onError(t){this._onError=t}}var l=function(t,i,a,s){var e,o=arguments.length,d=o<3?i:null===s?s=Object.getOwnPropertyDescriptor(i,a):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)d=Reflect.decorate(t,i,a,s);else for(var r=t.length-1;r>=0;r--)(e=t[r])&&(d=(o<3?e(d):o>3?e(i,a,d):e(i,a))||d);return o>3&&d&&Object.defineProperty(i,a,d),d};const p=class{constructor(a){t(this,a),this.dialogClose=i(this,"dialogClose",7),this.iconPack=o,this.t=d(),this.preloadedAudioElem=void 0,this.showPlayDialog=!1,this.onDyteDialogClose=()=>{this.showPlayDialog=!1,this.dialogClose.emit()}}componentDidLoad(){this.meetingChanged(this.meeting)}disconnectedCallback(){var t;null!=this.meeting&&(this.audioUpdateListener&&this.meeting.participants.joined.removeListener("audioUpdate",this.audioUpdateListener),this.screenShareUpdateListener&&this.meeting.participants.joined.removeListener("screenShareUpdate",this.screenShareUpdateListener),this.participantLeftListener&&this.meeting.participants.joined.removeListener("participantLeft",this.participantLeftListener),this.deviceUpdateListener&&this.meeting.self.removeListener("deviceUpdate",this.deviceUpdateListener),this.stageStatusUpdateListener&&(null===(t=this.meeting.stage)||void 0===t||t.removeListener("stageStatusUpdate",this.stageStatusUpdateListener)))}async setupAudio(){this.audio=new c(this.meeting,this.preloadedAudioElem);const t=this.meeting.self.getCurrentDevices();null!=t.speaker&&await this.audio.setDevice(t.speaker.deviceId)}async handleAutoPlayError(){this.audio||await this.setupAudio(),this.audio.onError((()=>{this.showPlayDialog=!0})),this.audio.play()}async handleEvents(t){this.audioUpdateListener=({id:t,audioEnabled:i,audioTrack:a})=>{const s=`audio-${t}`;i&&null!=a?this.audio.addTrack(s,a):this.audio.removeTrack(s)};const i=t.participants.joined.toArray();for(const t of i)this.audioUpdateListener(t);this.participantLeftListener=({id:t})=>{this.audio.removeTrack(`audio-${t}`),this.audio.removeTrack(`screenshare-${t}`)},this.screenShareUpdateListener=({id:t,screenShareEnabled:i,screenShareTracks:a})=>{const s=`screenshare-${t}`;i&&null!=a.audio?this.audio.addTrack(s,a.audio):this.audio.removeTrack(s)},this.deviceUpdateListener=({device:t,preview:i})=>{i||"audiooutput"===t.kind&&this.audio.setDevice(t.deviceId)},t.participants.joined.addListener("audioUpdate",this.audioUpdateListener),t.participants.joined.addListener("screenShareUpdate",this.screenShareUpdateListener),t.participants.joined.addListener("participantLeft",this.participantLeftListener),t.self.addListener("deviceUpdate",this.deviceUpdateListener)}async meetingChanged(t){var i;null!=t&&(this.setupAudio(),r(t)?(this.stageStatusUpdateListener=async t=>{"ON_STAGE"===t&&await this.handleAutoPlayError()},null===(i=t.stage)||void 0===i||i.on("stageStatusUpdate",this.stageStatusUpdateListener)):await this.handleAutoPlayError(),await this.handleEvents(t))}render(){return a(s,{key:"686dd5d973d48f75d6f64501157cfa16c1fe8c3b"},this.showPlayDialog&&a("dyte-dialog",{key:"e6af98511b4c4d515a2557d0c418fc840c124524",open:!0,onDyteDialogClose:this.onDyteDialogClose,hideCloseButton:!0,disableEscapeKey:!0,iconPack:this.iconPack,t:this.t},a("div",{key:"4f9f78a61f7107a948f88cbe2b155c99c7e1fa1c",class:"modal"},a("h3",{key:"d181292438a3a03b4b2b9a002a1dfa6007af70ee"},this.t("audio_playback.title")),a("p",{key:"f4f3b1b586b799c352c67bbc0938590281164a75"},this.t("audio_playback.description")),a("dyte-button",{key:"2f545adf8a46b10724f469270c7f05c77b8144ff",kind:"wide",onClick:()=>{this.audio.play(),this.onDyteDialogClose()},title:this.t("audio_playback"),iconPack:this.iconPack,t:this.t},this.t("audio_playback")))))}static get watchers(){return{meeting:["meetingChanged"]}}};l([n()],p.prototype,"meeting",void 0),l([n()],p.prototype,"iconPack",void 0),l([n()],p.prototype,"t",void 0),p.style=":host{line-height:initial;font-family:var(--dyte-font-family, sans-serif);font-feature-settings:normal;font-variation-settings:normal}p{margin:var(--dyte-space-0, 0px);padding:var(--dyte-space-0, 0px)}:host{display:block;overflow-wrap:break-word;color:rgb(var(--dyte-colors-text-1000, 255 255 255));word-wrap:break-word}.modal{box-sizing:border-box;width:100%;max-width:var(--dyte-space-96, 384px);padding:var(--dyte-space-4, 16px);border-radius:var(--dyte-border-radius-md, 8px);--tw-bg-opacity:1;background-color:rgba(var(--dyte-colors-background-1000, 8 8 8) / var(--tw-bg-opacity))}.modal h3{margin:var(--dyte-space-0, 0px);padding:var(--dyte-space-0, 0px);font-size:24px;font-weight:500}.modal p{margin-top:var(--dyte-space-4, 16px);margin-bottom:var(--dyte-space-6, 24px)}.modal dyte-button{width:100%}";export{p as dyte_participants_audio}