import{r as t,h as i,H as e,c as s}from"./p-f3ae5269.js";import"./p-e0d02dd9.js";import"./p-cca264b9.js";import{s as a,P as r,b as n,c as o,d}from"./p-83bfbad3.js";import{d as l}from"./p-cadf534b.js";import{u as h}from"./p-93bcbced.js";import"./p-57e22a58.js";import"./p-a41f3a8c.js";import"./p-02af26e9.js";const p=class{constructor(i){t(this,i),this.setIsLivestreaming=t=>{this.isLivestreaming="LIVESTREAMING"===t},this.meeting=void 0,this.size=void 0,this.t=h(),this.isLivestreaming=void 0,this.iconPack=l}connectedCallback(){this.meetingChanged(this.meeting)}disconnectedCallback(){var t,i;null===(i=null===(t=this.meeting)||void 0===t?void 0:t.livestream)||void 0===i||i.removeListener("livestreamUpdate",this.setIsLivestreaming)}meetingChanged(t){var i,e;null!=t&&(this.setIsLivestreaming(null===(i=this.meeting.livestream)||void 0===i?void 0:i.state),null===(e=this.meeting.livestream)||void 0===e||e.on("livestreamUpdate",this.setIsLivestreaming))}render(){if(a(this.meeting)&&this.isLivestreaming)return i(e,null,i("div",{class:"indicator","aria-label":this.t("livestream.indicator"),part:"indicator"},i("dyte-icon",{icon:this.iconPack.start_livestream,size:this.size}),i("span",null,this.t("LIVE"))))}static get watchers(){return{meeting:["meetingChanged"]}}};p.style=":host{line-height:initial;font-family:var(--dyte-font-family, sans-serif);font-feature-settings:normal;font-variation-settings:normal}p{margin:var(--dyte-space-0, 0px);padding:var(--dyte-space-0, 0px)}:host{margin-left:var(--dyte-space-2, 8px);margin-right:var(--dyte-space-2, 8px);display:flex}:host[size='sm']{margin-left:var(--dyte-space-1, 4px);margin-right:var(--dyte-space-1, 4px)}.indicator{display:flex;flex-direction:row;align-items:center;font-size:14px;--tw-text-opacity:1;color:rgba(var(--dyte-colors-danger, 255 45 45) / var(--tw-text-opacity))}dyte-icon{margin-right:var(--dyte-space-1, 4px);height:var(--dyte-space-5, 20px);width:var(--dyte-space-5, 20px);animation:blink 4s linear infinite}:host([size='sm']) dyte-icon{height:var(--dyte-space-4, 16px);width:var(--dyte-space-4, 16px)}:host([size='sm']) .indicator span{display:none}@keyframes blink{0%,10%{opacity:0}11%,100%{opacity:1}}";const c=class{constructor(i){t(this,i),this.dyteAPIError=s(this,"dyteAPIError",7),this.showLatencyIndicator=!1,this.LoadPlayer=(t=this.ivsPlayer)=>{this.player&&t&&(t.attachHTMLVideoElement(this.player),t.setAutoplay(!0),t.setVolume(1))},this.livestreamUpdateListener=t=>{var i,e,s,a;this.livestreamState=t,"LIVESTREAMING"===t?(this.LoadPlayer(),this.getPlaybackUrl(),(null===(e=null===(i=this.meeting.__internals__)||void 0===i?void 0:i.browserSpecs)||void 0===e?void 0:e.isIOSMobile())||(this.fetchLatency(),this.updateLatency=setInterval(this.fetchLatency,2e3)),null===(s=this.meeting.participants.pip)||void 0===s||s.enableSource("livestream-player")):(this.showLatencyIndicator=!1,this.updateLatency&&clearInterval(this.updateLatency),null===(a=this.meeting.participants.pip)||void 0===a||a.disableSource("livestream-player"))},this.getLoadingState=()=>{let t="",i=!1,e=!1;switch(this.livestreamState){case"IDLE":t=this.t("livestream.idle"),i=!0,e=!1;break;case"STARTING":t=this.t("livestream.starting"),i=!0,e=!0;break;case"STOPPING":t=this.t("livestream.stopping"),i=!0,e=!0;break;case"LIVESTREAMING":this.playerState!==r.PLAYING&&(t=this.t("livestream.starting"),e=!0,i=!0);break;default:i=!1,t=this.t(""),e=!0}return{isLoading:i,loadingMessage:t,showIcon:e}},this.getErrorState=()=>{var t,i;let e=!1,s="";return"LIVESTREAMING"!==this.livestreamState?(e=!1,s=this.t(""),{isError:e,errorMessage:s}):(this.isSupported||(e=!0,s=this.t("livestream.error.not_supported")),this.playbackUrl||(e=!0,s=this.t("livestream.error.not_found")),this.playerError&&(e=!0,s=this.t(null!==(i=null===(t=this.playerError)||void 0===t?void 0:t.message)&&void 0!==i?i:"livestream.error.unknown")),{isError:e,errorMessage:s})},this.fetchLatency=()=>{this.ivsPlayer&&(this.latency=this.ivsPlayer.getLiveLatency(),this.meeting.__internals__.logger.info("IVS.Player.LivestreamLatency",{livestream:{latency:this.latency}}))},this.meeting=void 0,this.size=void 0,this.t=h(),this.iconPack=l,this.playbackUrl=void 0,this.isSupported=!0,this.playerState=r.IDLE,this.livestreamState="IDLE",this.playerError=void 0,this.latency=0,this.audioPlaybackError=!1}AddPlayerListeners(t=this.ivsPlayer){Object.values(Object.assign(Object.assign({},n),r)).forEach((i=>{o.includes(i)||null==t||t.addEventListener(i,(e=>{var s,a,o;i!==r.IDLE&&i!==r.PLAYING&&i!==n.ERROR&&i!==r.READY||(this.playerState=i),i===n.ERROR&&(this.playerError=e),i===r.IDLE&&t.isPaused()&&t.play(),i===n.AUDIO_BLOCKED&&(this.audioPlaybackError=!0),this.showLatencyIndicator=this.playerState===r.PLAYING&&!(null===(a=null===(s=this.meeting.__internals__)||void 0===s?void 0:s.browserSpecs)||void 0===a?void 0:a.isIOSMobile()),this.meeting.__internals__.logger.info(`IVS.Player.${i}`,e),d.includes(i)&&(null===(o=this.meeting.__internals__.callStats)||void 0===o||o.ivsPlayerEvent(i,e))}))}))}getPlaybackUrl(t=this.ivsPlayer){this.playbackUrl=this.meeting.livestream.playbackUrl,this.playbackUrl&&t&&(t.load(this.playbackUrl),t.play())}onPlayerRef(t){var i,e;this.player=t,null===(i=this.meeting.participants.pip)||void 0===i||i.addSource("livestream-player",this.player,!!this.playbackUrl),this.playbackUrl&&(null===(e=this.meeting.participants.pip)||void 0===e||e.enableSource("livestream-player"))}connectedCallback(){this.meetingChanged(this.meeting),window.onDyteLivestreamPlayer=t=>{t?(this.isSupported=!0,this.ivsPlayer=t,this.AddPlayerListeners(t),this.LoadPlayer(t),this.getPlaybackUrl(t)):this.isSupported=!1},this.sendLatencyToCallStats=setInterval((()=>{var t;this.fetchLatency(),null===(t=this.meeting.__internals__.callStats)||void 0===t||t.livestreamLatency(this.latency)}),1e4)}disconnectedCallback(){window.onDyteLivestreamPlayer=void 0,this.meeting.livestream.removeListener("livestreamUpdate",this.livestreamUpdateListener),clearInterval(this.sendLatencyToCallStats),this.ivsPlayer.load(""),this.ivsPlayer=void 0,this.player=void 0}async componentDidLoad(){const t=document.createElement("script");t.type="module",t.innerHTML="\n    import IVSPlayer from 'https://cdn.jsdelivr.net/npm/amazon-ivs-player@1.16.0/+esm'\n    let player = undefined;\n    if (IVSPlayer.isPlayerSupported) {\n      player = IVSPlayer.create({\n        wasmBinary:\n          'https://unpkg.com/amazon-ivs-player@1.11.0/dist/assets/amazon-ivs-wasmworker.min.wasm',\n        wasmWorker:\n          'https://unpkg.com/amazon-ivs-player@1.11.0/dist/assets/amazon-ivs-wasmworker.min.js',\n      });\n    }\n    window.onDyteLivestreamPlayer && window.onDyteLivestreamPlayer(player);\n    ",document.body.appendChild(t)}meetingChanged(t){var i;null!=t&&(this.livestreamState=this.meeting.livestream.state,"LIVESTREAMING"===this.livestreamState&&(this.LoadPlayer(),this.getPlaybackUrl(),null===(i=this.meeting.participants.pip)||void 0===i||i.enableSource("livestream-player")),this.meeting.livestream.on("livestreamUpdate",this.livestreamUpdateListener))}render(){if(!a(this.meeting))return;const{isError:t,errorMessage:s}=this.getErrorState(),{isLoading:r,loadingMessage:n,showIcon:o}=this.getLoadingState();return i(e,null,i("div",{class:"player-container"},i("video",{ref:t=>this.onPlayerRef(t),playsInline:!0}),this.audioPlaybackError&&i("div",{class:"unmute-popup"},i("h3",null,this.t("audio_playback.title")),i("p",null,this.t("audio_playback.description")),i("dyte-button",{kind:"wide",onClick:()=>{this.player.muted=!1,this.audioPlaybackError=!1},title:this.t("audio_playback"),iconPack:this.iconPack,t:this.t},this.t("audio_playback"))),"LIVESTREAMING"===this.livestreamState&&this.showLatencyIndicator&&i("div",{class:"latency-controls"}),t&&i("div",{class:"loader"},i("dyte-icon",{icon:this.iconPack.warning,t:this.t}),i("p",null,s)),!t&&r&&i("div",{class:"loader"},o&&i("dyte-spinner",{id:"icon",part:"spinner",iconPack:this.iconPack,t:this.t,size:"md"}),i("p",null,n))))}static get watchers(){return{meeting:["meetingChanged"]}}};c.style=":host{line-height:initial;font-family:var(--dyte-font-family, sans-serif);font-feature-settings:normal;font-variation-settings:normal}p{margin:var(--dyte-space-0, 0px);padding:var(--dyte-space-0, 0px)}:host{margin-left:var(--dyte-space-2, 8px);margin-right:var(--dyte-space-2, 8px);display:flex;height:100%;width:100%;border-radius:var(--dyte-border-radius-md, 8px);--tw-bg-opacity:1;background-color:rgba(var(--dyte-colors-background-900, 26 26 26) / var(--tw-bg-opacity))}.player-container{position:relative;margin:var(--dyte-space-4, 16px);display:flex;flex-grow:1;align-items:center;justify-content:center;overflow:hidden;border-radius:var(--dyte-border-radius-md, 8px)}video{z-index:0;height:100%;width:100%;border-radius:var(--dyte-border-radius-md, 8px);border-width:var(--dyte-border-width-none, 0);border-style:none;--tw-bg-opacity:1;background-color:rgba(var(--dyte-colors-background-1000, 8 8 8) / var(--tw-bg-opacity))}.loader{position:absolute;z-index:10;height:100%;width:100%;--tw-bg-opacity:1;background-color:rgba(var(--dyte-colors-background-900, 26 26 26) / var(--tw-bg-opacity));display:flex;flex-direction:column;align-items:center;justify-content:center}p{margin-top:var(--dyte-space-1, 4px);margin-bottom:var(--dyte-space-1, 4px);font-size:16px;color:rgb(var(--dyte-colors-text-700, 255 255 255 / 0.64))}.latency-controls{position:absolute;bottom:var(--dyte-space-4, 16px);right:var(--dyte-space-4, 16px);z-index:20;display:flex;flex-direction:row;align-items:center}.sync-live-stream{cursor:pointer;border-radius:var(--dyte-border-radius-sm, 4px);--tw-bg-opacity:1;background-color:rgba(var(--dyte-colors-brand-500, 33 96 253) / var(--tw-bg-opacity));padding-left:var(--dyte-space-2, 8px);padding-right:var(--dyte-space-2, 8px);padding-top:var(--dyte-space-1, 4px);padding-bottom:var(--dyte-space-1, 4px);font-size:12px}.unmute-popup{position:absolute;z-index:30 !important;display:flex;width:var(--dyte-space-72, 288px);flex-direction:column;border-radius:var(--dyte-border-radius-md, 8px);--tw-bg-opacity:1;background-color:rgba(var(--dyte-colors-background-800, 30 30 30) / var(--tw-bg-opacity));padding:var(--dyte-space-4, 16px);text-align:center;max-width:70%}.unmute-popup h3{margin:var(--dyte-space-0, 0px);font-size:16px;font-weight:500}.unmute-popup p{margin-top:var(--dyte-space-3, 12px);margin-bottom:var(--dyte-space-3, 12px);font-size:14px}";const v=class{constructor(i){t(this,i),this.disconnectMeeting=t=>{var i;null!=t&&null!=this.countListener&&(null===(i=t.livestream)||void 0===i||i.removeListener("viewerCountUpdate",this.countListener))},this.meeting=void 0,this.variant="primary",this.iconPack=l,this.t=h(),this.viewerCount=0}connectedCallback(){this.meetingChanged(this.meeting)}disconnectedCallback(){this.disconnectMeeting(this.meeting)}meetingChanged(t,i){var e;this.disconnectMeeting(i),null!=t&&(this.countListener=()=>{var i;this.viewerCount=null===(i=t.livestream)||void 0===i?void 0:i.viewerCount},this.countListener(),null===(e=t.livestream)||void 0===e||e.addListener("viewerCountUpdate",this.countListener))}render(){return a(this.meeting)?i(e,{tabIndex:0,role:"log","aria-label":`${this.viewerCount} ${this.t("viewers")}`},i("dyte-icon",{icon:this.iconPack.viewers,tabIndex:-1,"aria-hidden":!0,part:"icon",iconPack:this.iconPack,t:this.t}),this.viewerCount," ",this.t("viewers")):null}static get watchers(){return{meeting:["meetingChanged"]}}};v.style=":host{line-height:initial;font-family:var(--dyte-font-family, sans-serif);font-feature-settings:normal;font-variation-settings:normal}p{margin:var(--dyte-space-0, 0px);padding:var(--dyte-space-0, 0px)}:host{margin-left:var(--dyte-space-2, 8px);margin-right:var(--dyte-space-2, 8px);display:inline-flex;height:var(--dyte-space-10, 40px);-webkit-user-select:none;-moz-user-select:none;user-select:none;align-items:center;font-size:14px}:host([size='sm']){margin-left:var(--dyte-space-1, 4px);margin-right:var(--dyte-space-1, 4px);font-size:12px}dyte-icon{margin-right:var(--dyte-space-1, 4px);height:var(--dyte-space-5, 20px);width:var(--dyte-space-5, 20px)}:host([size='sm']) dyte-icon{height:var(--dyte-space-4, 16px);width:var(--dyte-space-4, 16px)}:host([variant='embedded']){--tw-bg-opacity:1;background-color:rgba(var(--dyte-colors-background-1000, 8 8 8) / var(--tw-bg-opacity));opacity:0.5;margin-top:var(--dyte-space-1, 4px);margin-left:var(--dyte-space-1, 4px);height:var(--dyte-space-5, 20px);border-radius:var(--dyte-border-radius-sm, 4px);padding-left:var(--dyte-space-2, 8px);padding-right:var(--dyte-space-2, 8px);font-size:12px}:host([variant='embedded']) dyte-icon{height:var(--dyte-space-4, 16px);width:var(--dyte-space-4, 16px)}";export{p as dyte_livestream_indicator,c as dyte_livestream_player,v as dyte_viewer_count}