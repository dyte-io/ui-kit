import{r as t,c as i,h as e,H as s}from"./p-aff91b47.js";import{d as a,a as n,c as h,m as r,f as d}from"./p-c3bc6145.js";import{d as o}from"./p-cbdd7a99.js";import{R as p}from"./p-fd4b6d8b.js";import{S as c}from"./p-75fa9e17.js";import{d as l}from"./p-b13ddb7d.js";import"./p-e497ad6d.js";var g=function(t,i,e,s){var a,n=arguments.length,h=n<3?i:null===s?s=Object.getOwnPropertyDescriptor(i,e):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)h=Reflect.decorate(t,i,e,s);else for(var r=t.length-1;r>=0;r--)(a=t[r])&&(h=(n<3?a(h):n>3?a(i,e,h):a(i,e))||h);return n>3&&h&&Object.defineProperty(i,e,h),h};const v=class{constructor(e){t(this,e),this.stateUpdate=i(this,"dyteStateUpdate",7),this.hideSelf=!1,this.participants=[],this.pinnedParticipants=[],this.screenShareParticipants=[],this.plugins=[],this.emptyStage=!1,this.showLiveStreamPlayer=!1,this.canCurrentPeerHost=!1,this.pipSupported=!1,this.pipEnabled=!1,this.hidden=!1,this.layout="row",this.aspectRatio="16:9",this.gap=8,this.config=a,this.iconPack=n,this.t=h(),this.gridSize=l,this.overrides={},this.invalidRoomStates=["init","waitlisted","ended","kicked","rejected"],this.filterParticipants=t=>{var i;if(this.overrides&&(null===(i=this.overrides)||void 0===i?void 0:i.videoUnsubscribed)){const i=this.overrides.videoUnsubscribed.preset;i.length>0&&(t=t.filter((t=>!i.some((i=>void 0!==t.presetName&&t.presetName.match(i))))))}return t},this.onViewModeChanged=()=>{null!=this.meeting&&this.updateActiveParticipants()},this.onParticipantJoined=o((()=>{this.updateActiveParticipants()}),50),this.onParticipantLeft=o((()=>{this.updateActiveParticipants()}),50),this.stageStatusListener=()=>{this.updateActiveParticipants(),this.showLiveStreamPlayer=r(this.meeting),"ON_STAGE"!==this.meeting.stage.status&&this.removeScreenShare(this.meeting.self)},this.peerStageStatusListener=t=>{this.updateActiveParticipants(),"ON_STAGE"!==this.meeting.stage.status&&(this.removePinned(t),this.removeScreenShare(t))},this.onScreenShareUpdate=t=>{t.screenShareEnabled?this.addScreenShare(t):this.removeScreenShare(t)},this.onSelfScreenShareUpdate=({screenShareEnabled:t})=>{t?this.addScreenShare(this.meeting.self):this.removeScreenShare(this.meeting.self)},this.toggleTileListener=({hidden:t})=>{this.hidden=t,this.updateActiveParticipants()},this.onPluginStateUpdate=(t,{active:i})=>{i?this.plugins.some((i=>i.id===t.id))||(this.plugins=[...this.plugins,t]):this.plugins=this.plugins.filter((i=>i.id!==t.id))},this.onParticipantPinned=()=>{this.updateActiveParticipants()},this.onParticipantUnpinned=()=>{this.updateActiveParticipants()},this.updateRoomStateListener=()=>{this.roomState=this.meeting.self.roomState}}connectedCallback(){this.meetingChanged(this.meeting)}disconnectedCallback(){this.disconnectMeeting(this.meeting)}disconnectMeeting(t){var i;if(null==t)return;this.participants=[],this.plugins=[];const{self:e,participants:s,plugins:a}=t;e.removeListener("pinned",this.onParticipantPinned),e.removeListener("unpinned",this.onParticipantUnpinned),e.removeListener("roomLeft",this.updateRoomStateListener),e.removeListener("roomJoined",this.updateRoomStateListener),e.removeListener("screenShareUpdate",this.onSelfScreenShareUpdate),e.removeListener("toggleTile",this.toggleTileListener),null==a||a.all.removeListener("stateUpdate",this.onPluginStateUpdate),null===(i=t.stage)||void 0===i||i.removeListener("stageStatusUpdate",this.stageStatusListener),s.removeListener("viewModeChanged",this.onViewModeChanged),s.active.removeListener("participantLeft",this.onParticipantLeft),s.active.removeListener("participantJoined",this.onParticipantJoined),s.pinned.removeListener("participantJoined",this.onParticipantPinned),s.pinned.removeListener("participantLeft",this.onParticipantUnpinned),s.joined.removeListener("screenShareUpdate",this.onScreenShareUpdate),s.joined.removeListener("stageStatusUpdate",this.peerStageStatusListener)}meetingChanged(t,i){var e,s,a,n;if(null!==i&&this.disconnectMeeting(i),null!=t){const{self:i,participants:h,plugins:r,stage:d}=t;this.pipSupported=(null===(e=this.meeting.participants.pip)||void 0===e?void 0:e.isSupported())&&(null===(s=t.self.config)||void 0===s?void 0:s.pipMode),this.pipSupported&&this.meeting.participants.pip.init();const{permissions:o}=i;this.roomState=i.roomState,this.hideSelf="ON_STAGE"!==this.meeting.stage.status||(null==o?void 0:o.isRecorder)||o.hiddenParticipant,this.participants=this.filterParticipants([...h.active.toArray(),...i.isPinned||this.hideSelf?[]:[i]]),this.pinnedParticipants=[...h.pinned.toArray(),...i.isPinned&&!this.hideSelf?[i]:[]],this.screenShareParticipants=h.joined.toArray().filter((t=>t.screenShareEnabled)),this.plugins=(null==r?void 0:r.active.toArray())||[],(null==o?void 0:o.stageEnabled)&&(this.canCurrentPeerHost=o.acceptStageRequests||o.canPresent,this.updateStage()),this.hidden=t.self.hidden,i.addListener("roomLeft",this.updateRoomStateListener),i.addListener("roomJoined",this.updateRoomStateListener),i.addListener("screenShareUpdate",this.onSelfScreenShareUpdate),i.addListener("pinned",this.onParticipantPinned),i.addListener("unpinned",this.onParticipantUnpinned),i.addListener("toggleTile",this.toggleTileListener),null==d||d.addListener("stageStatusUpdate",this.stageStatusListener),null==r||r.all.addListener("stateUpdate",this.onPluginStateUpdate),h.addListener("viewModeChanged",this.onViewModeChanged),h.active.addListener("participantLeft",this.onParticipantLeft),null===(a=null==h?void 0:h.joined)||void 0===a||a.on("stageStatusUpdate",this.peerStageStatusListener),h.joined.addListener("screenShareUpdate",this.onScreenShareUpdate),h.active.addListener("participantJoined",this.onParticipantJoined),h.pinned.addListener("participantJoined",this.onParticipantPinned),h.pinned.addListener("participantLeft",this.onParticipantUnpinned),(null===(n=t.stage)||void 0===n?void 0:n.status)&&this.stageStatusListener()}}overridesChanged(t){this.updateActiveParticipants()}screenShareParticipantsChanged(t){const i=t.length>0;!!d.states.activeScreenShare!==i&&(this.stateUpdate.emit({activeScreenShare:i}),d.states.activeScreenShare=i)}pluginsChanged(t){const i=t.length>0;!!d.states.activePlugin!==i&&(this.stateUpdate.emit({activePlugin:i}),d.states.activePlugin=i)}pinnedParticipantsChanged(t){const i=t.length>0;!!d.states.activeSpotlight!==i&&(this.stateUpdate.emit({activeSpotlight:i}),d.states.activeSpotlight=i)}updateActiveParticipants(){var t;const{self:i,participants:e,stage:s}=this.meeting;this.hideSelf=this.hidden||"ON_STAGE"!==s.status||(null===(t=i.permissions)||void 0===t?void 0:t.isRecorder)||i.permissions.hiddenParticipant,this.participants=this.filterParticipants([...e.active.toArray().filter((t=>t.id!==i.id)),..."ACTIVE_GRID"!==e.viewMode||i.isPinned||this.hideSelf?[]:[i]]),this.pinnedParticipants=[...e.pinned.toArray().filter((t=>t.id!==i.id)),...i.isPinned&&!this.hideSelf?[i]:[]],this.screenShareParticipants=e.joined.toArray().filter((t=>t.screenShareEnabled)),i.screenShareEnabled&&(this.screenShareParticipants=this.screenShareParticipants.concat([i])),this.updateStage()}updateStage(){var t;const{self:i}=this.meeting;this.meeting&&(this.emptyStage=!!(null===(t=null==i?void 0:i.permissions)||void 0===t?void 0:t.stageEnabled)&&0===this.participants.length&&0===this.pinnedParticipants.length)}addScreenShare(t){this.screenShareParticipants.some((i=>i.id===t.id))||(this.screenShareParticipants=[...this.screenShareParticipants,t])}removeScreenShare(t){this.screenShareParticipants=this.screenShareParticipants.filter((i=>i.id!==t.id))}removePinned(t){this.pinnedParticipants=this.pinnedParticipants.filter((i=>i.id!==t.id))}render(){const t={meeting:this.meeting,size:this.size,states:this.states,config:this.config,iconPack:this.iconPack,t:this.t};return this.invalidRoomStates.includes(this.roomState)?e(s,null,e("div",{class:"offline-grid"},e("dyte-icon",{icon:this.iconPack.join_stage,size:"xl"}),e("h3",null,this.t("disconnected")),e("p",null,this.t("disconnected.description")))):"disconnected"===this.roomState?e(s,null,e("div",{class:"offline-grid"},e("dyte-icon",{icon:this.iconPack.disconnected,size:"xl"}),e("h3",null,this.t("offline")),e("p",null,this.t("offline.description")))):"failed"===this.roomState?e(s,null,e("div",{class:"offline-grid"},e("dyte-icon",{icon:this.iconPack.disconnected,size:"xl"}),e("h3",null,this.t("failed")),e("p",null,this.t("failed.description")))):this.showLiveStreamPlayer?e(s,null,e("dyte-livestream-player",{meeting:this.meeting,size:this.size}),e("dyte-livestream-indicator",{meeting:this.meeting,size:"sm",t:this.t}),e("dyte-viewer-count",{meeting:this.meeting,variant:"embedded",t:this.t})):this.emptyStage?e(s,null,e("div",{class:"webinar-stage"},e("div",{class:"center"},this.canCurrentPeerHost&&e("div",{class:"ctr",part:"container"},e("p",{class:"message",part:"message"},this.t("stage.empty_host")),e("span",{class:"description",part:"description"},this.t("stage.empty_host_summary"))),!this.canCurrentPeerHost&&e("div",{class:"ctr",part:"container"},e("p",{class:"message",part:"message"},this.t("stage.empty_viewer")))))):e(s,null,e(p,{element:"dyte-grid",defaults:t,childProps:{participants:this.participants,screenShareParticipants:this.screenShareParticipants,plugins:this.plugins,pinnedParticipants:this.pinnedParticipants,aspectRatio:this.aspectRatio,gap:this.gap,layout:this.layout,gridSize:this.gridSize},onlyChildren:!0}),e("dyte-livestream-indicator",{meeting:this.meeting,size:"sm",t:this.t}),e("dyte-viewer-count",{meeting:this.meeting,variant:"embedded"}))}static get watchers(){return{meeting:["meetingChanged"],overrides:["overridesChanged"],screenShareParticipants:["screenShareParticipantsChanged"],plugins:["pluginsChanged"],pinnedParticipants:["pinnedParticipantsChanged"]}}};g([c()],v.prototype,"meeting",void 0),g([c()],v.prototype,"size",void 0),g([c()],v.prototype,"states",void 0),g([c()],v.prototype,"iconPack",void 0),g([c()],v.prototype,"t",void 0),v.style=":host{line-height:initial;font-family:var(--dyte-font-family, sans-serif);font-feature-settings:normal;font-variation-settings:normal}p{margin:var(--dyte-space-0, 0px);padding:var(--dyte-space-0, 0px)}:host{display:block;height:100%;width:100%}.offline-grid{display:flex;height:100%;width:100%;flex-direction:column;align-items:center;justify-content:center}.offline-grid h3{margin-top:var(--dyte-space-2, 8px);margin-bottom:var(--dyte-space-2, 8px);margin-left:var(--dyte-space-0, 0px);margin-right:var(--dyte-space-0, 0px);font-size:20px;font-weight:500;color:rgb(var(--dyte-colors-text-900, 255 255 255 / 0.88))}.offline-grid p{margin-top:var(--dyte-space-1, 4px);margin-bottom:var(--dyte-space-1, 4px);margin-left:var(--dyte-space-0, 0px);margin-right:var(--dyte-space-0, 0px);text-align:center;font-size:16px;font-weight:400;color:rgb(var(--dyte-colors-text-700, 255 255 255 / 0.64))}.offline-grid dyte-icon{margin-bottom:var(--dyte-space-2, 8px)}.webinar-stage{box-sizing:border-box;height:100%;display:flex;align-content:center;align-items:center;justify-content:center;text-align:center}.webinar-stage h2{margin:var(--dyte-space-0, 0px);font-weight:normal}dyte-viewer-count{display:none}.ctr{display:flex;flex-direction:column;align-items:center}.message{font-size:16px;border-radius:var(--dyte-border-radius-lg, 12px);--tw-bg-opacity:1;background-color:rgba(var(--dyte-colors-background-800, 30 30 30) / var(--tw-bg-opacity));padding-left:var(--dyte-space-8, 32px);padding-right:var(--dyte-space-8, 32px);padding-top:var(--dyte-space-4, 16px);padding-bottom:var(--dyte-space-4, 16px);color:rgb(var(--dyte-colors-text-1000, 255 255 255))}.description{margin-top:var(--dyte-space-4, 16px);margin-bottom:var(--dyte-space-4, 16px);font-size:14px}dyte-livestream-indicator{display:none}@media only screen and (max-device-height: 480px) and (orientation: landscape){dyte-viewer-count[variant='embedded']{position:absolute;top:var(--dyte-space-0, 0px);right:var(--dyte-space-2, 8px);z-index:20;margin-top:var(--dyte-space-0, 0px);margin-left:var(--dyte-space-0, 0px);display:flex}dyte-livestream-indicator{position:absolute;top:var(--dyte-space-0, 0px);left:var(--dyte-space-2, 8px);z-index:20;margin-top:var(--dyte-space-0, 0px);margin-left:var(--dyte-space-0, 0px);display:flex}}";export{v as dyte_grid}