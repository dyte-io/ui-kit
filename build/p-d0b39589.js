import{c as t}from"./p-57e22a58.js";const e=t=>{let e=null;try{const n=JSON.parse(t.message),{target:s,message:o}=n;e=void 0===s||void 0===o?t:Object.assign(Object.assign({},t),{targetUserIds:s,message:o})}catch(n){e=t}return e};function n(t,e){return t.localeCompare(e)}function s(t){return t.sort(((t,e)=>t.localeCompare(e))).join("_")}function o(t,e){if(null==t)return!0;for(const n of t)if("file"===n.kind){const t=n.getAsFile();n.type.startsWith("image/")?e("image",t):e("file",t)}}function r({messages:t,participants:n,selfUserId:o}){const r={};for(const t of n)r[s([t.userId,o])]=[];return t.forEach((t=>{var n;const o=e(t);let c="everyone";if((null===(n=o.targetUserIds)||void 0===n?void 0:n.length)>0){const t=new Set([o.userId,...o.targetUserIds]);c=s(Array.from(t))}r[c]||(r[c]=[]),r[c].push({type:"chat",message:o})})),r}function c({messages:e,selfUserId:n,selectedGroupId:s,participants:o}){var c;const a=r({messages:e,selfUserId:n,participants:o}),i={};for(const e in a){const o=null!==(c=t[e])&&void 0!==c?c:0;e===s?(i[e]=0,t[e]=new Date):i[e]=a[e].filter((t=>"chat"==t.type&&t.message.time>o&&t.message.userId!==n)).length}return i}function a({groupId:t,selfUserId:e}){return t.split("_").find((t=>t!=e))}const i="dm__";function u(t){return t.isDirectMessage}function f(t){return[...new Set(t)].sort(n).join("<>")}function l(t){return t.split("").reverse().join("")}const p=/^\*([^*\s]+)\*/,d=/^_([^_\s]+)_/,b=/^~([^~\s]+)~/,g=/https?:\/\/(www\.)?[-a-zA-Z0-9@:%._\+~#=]{1,256}\.[a-zA-Z0-9()]{1,6}\b([-a-zA-Z0-9()@:%_\+.,~#?&//=]*)/,m=/<blockquote>[.\s\S]*<\/blockquote>\n\n/m;function _(t,e=!1){if(!m.test(t))return"";let n=0,s="</blockquote>".length;return e&&(n="<blockquote>".length,s=0),t.substring(t.indexOf("<blockquote>")+n,t.indexOf("</blockquote>")+s)}function q(t){return t.replace(m,"")}const v=2e3,k=["<a>","<b>","<i>","<q>","<s>"];function I(t){t=(t=t.split(" ").map((t=>{if(g.test(t)){const e=g.exec(t);t=t.replace(e[0],`<a>${e[0]}</a>`)}else{if(p.test(t)){const e=p.exec(t);t=t.replace(e[0],`<b>${e[1]}</b>`)}if(d.test(t)){const e=d.exec(t);t=t.replace(e[0],`<i>${e[1]}</i>`)}if(b.test(t)){const e=b.exec(t);t=t.replace(e[0],`<s>${e[1]}</s>`)}}return t})).join(" ")).split(" ").map(((t,e)=>">"!==t||0!==e&&">"!==t[e-1]?t:"<q></q>")).join(" ");const[e]=w(t);return e}function w(t,e=""){const n=[];if(0===t.length)return[n,0];let s=0;for(;s<t.length;){if(e.length&&e===t.substring(s,s+e.length))return[n,s+e.length];if(k.includes(t.substring(s,s+3))){const[e,o]=w(t.substring(s+3),`</${t[s+1]}>`);n.push({type:t[s+1],content:1===e.length&&"plain_text"===e[0].type?e[0].content:e}),s+=o+3}else{let e=n[n.length-1];e&&"plain_text"===e.type||(n.push({type:"plain_text",content:""}),e=n[n.length-1]),e.content+=t[s],s++}}return[n,s]}export{v as M,i as T,r as a,c as b,a as c,n as d,_ as e,f,s as g,o as h,u as i,e as j,m as k,I as p,l as r,q as s}