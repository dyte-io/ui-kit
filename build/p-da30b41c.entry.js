import{r as t,h as i,H as e,c as a}from"./p-69f2ebde.js";import"./p-1210aa77.js";import"./p-26e8d50e.js";import{s,P as r}from"./p-799d72ea.js";import{d as n}from"./p-cadf534b.js";import{u as o}from"./p-f9791180.js";import"./p-57e22a58.js";import"./p-aafa2ac8.js";import"./p-19c79157.js";const d=class{constructor(i){t(this,i),this.setIsLivestreaming=t=>{this.isLivestreaming="LIVESTREAMING"===t},this.meeting=void 0,this.size=void 0,this.t=o(),this.isLivestreaming=void 0,this.iconPack=n}connectedCallback(){this.meetingChanged(this.meeting)}disconnectedCallback(){var t,i;null===(i=null===(t=this.meeting)||void 0===t?void 0:t.livestream)||void 0===i||i.removeListener("livestreamUpdate",this.setIsLivestreaming)}meetingChanged(t){var i,e;null!=t&&(this.setIsLivestreaming(null===(i=this.meeting.livestream)||void 0===i?void 0:i.state),null===(e=this.meeting.livestream)||void 0===e||e.on("livestreamUpdate",this.setIsLivestreaming))}render(){if(s(this.meeting)&&this.isLivestreaming)return i(e,null,i("div",{class:"indicator","aria-label":this.t("livestream.indicator"),part:"indicator"},i("dyte-icon",{icon:this.iconPack.start_livestream,size:this.size}),i("span",null,this.t("LIVE"))))}static get watchers(){return{meeting:["meetingChanged"]}}};d.style=":host{line-height:initial;font-family:var(--dyte-font-family, sans-serif);font-feature-settings:normal;font-variation-settings:normal}p{margin:var(--dyte-space-0, 0px);padding:var(--dyte-space-0, 0px)}:host{margin-left:var(--dyte-space-2, 8px);margin-right:var(--dyte-space-2, 8px);display:flex}:host[size='sm']{margin-left:var(--dyte-space-1, 4px);margin-right:var(--dyte-space-1, 4px)}.indicator{display:flex;flex-direction:row;align-items:center;font-size:14px;--tw-text-opacity:1;color:rgba(var(--dyte-colors-danger, 255 45 45) / var(--tw-text-opacity))}dyte-icon{margin-right:var(--dyte-space-1, 4px);height:var(--dyte-space-5, 20px);width:var(--dyte-space-5, 20px);animation:blink 4s linear infinite}:host([size='sm']) dyte-icon{height:var(--dyte-space-4, 16px);width:var(--dyte-space-4, 16px)}:host([size='sm']) .indicator span{display:none}@keyframes blink{0%,10%{opacity:0}11%,100%{opacity:1}}";const p=class{constructor(i){t(this,i),this.dyteAPIError=a(this,"dyteAPIError",7),this.livestreamUpdateListener=t=>{this.livestreamState=t,this.playbackUrl=this.meeting.livestream.playbackUrl},this.getLoadingState=()=>{let t="",i=!1,e=!1;switch(this.livestreamState){case"IDLE":t=this.t("livestream.idle"),i=!0,e=!1;break;case"STARTING":t=this.t("livestream.starting"),i=!0,e=!0;break;case"STOPPING":t=this.t("livestream.stopping"),i=!0,e=!0;break;case"LIVESTREAMING":this.playerState!==r.PLAYING&&(t=this.t("livestream.starting"),e=!0,i=!0);break;default:i=!1,t=this.t(""),e=!0}return{isLoading:i,loadingMessage:t,showIcon:e}},this.getErrorState=()=>{var t,i;let e=!1,a="";return"LIVESTREAMING"!==this.livestreamState?(e=!1,a=this.t(""),{isError:e,errorMessage:a}):(this.isSupported||(e=!0,a=this.t("livestream.error.not_supported")),this.playbackUrl||(e=!0,a=this.t("livestream.error.not_found")),this.playerError&&(e=!0,a=this.t(null!==(i=null===(t=this.playerError)||void 0===t?void 0:t.message)&&void 0!==i?i:"livestream.error.unknown")),{isError:e,errorMessage:a})},this.startLivestreamPlayer=async()=>{try{this.meeting.__internals__.logger.info("dyte-livestream-player:: Initialising player element."),await window.__stream.initElement(this.player),this.meeting.__internals__.logger.info("dyte-livestream-player:: About to start player."),await window.dyte_hls.play(),this.playerState=r.PLAYING,this.audioPlaybackError=!1,this.meeting.__internals__.logger.info("dyte-livestream-player:: Player has started playing.")}catch(t){this.meeting.__internals__.logger.error("dyte-livestream-player:: Player couldn't start.",{error:t}),this.audioPlaybackError=!0}},this.loadLivestreamPlayer=async()=>{const t="https://cdn.dyte.in/streams/script.js";return!(!window.__stream&&this.isScriptWithSrcPresent(t))&&(!!window.__stream||new Promise((i=>{const e=document.createElement("script");e.src=t,e.onload=()=>{setTimeout((()=>{if(window.__stream)return this.meeting.__internals__.logger.info("dyte-livestream-player:: Finished script load. Added window._stream."),void i(!0);this.meeting.__internals__.logger.error("dyte-livestream-player:: onLoad didn't add window._stream in time."),i(!1)}),1e3)},e.onerror=t=>{this.meeting.__internals__.logger.error("dyte-livestream-player:: CDN script didn't load.",{error:t}),i(!1)},document.head.appendChild(e)})))},this.meeting=void 0,this.size=void 0,this.t=o(),this.iconPack=n,this.playbackUrl=void 0,this.isSupported=!0,this.playerState=r.IDLE,this.livestreamState="IDLE",this.playerError=void 0,this.latency=0,this.livestreamId=null,this.audioPlaybackError=!1}updateLivestreamId(){const t=this.meeting.livestream.playbackUrl;if(!t||"LIVESTREAMING"!==this.livestreamState)return this.livestreamId=null,this.player=null,void(window.dyteLivestreamPlayerElement=null);const i=t.split("/"),e=i.findIndex((t=>"manifest"===t));this.livestreamId=i[e-1]}isScriptWithSrcPresent(t){const i=document.querySelectorAll("script");for(let e of i)if(e.src===t)return!0;return!1}async connectedCallback(){this.meetingChanged(this.meeting)}disconnectedCallback(){this.meeting.livestream.removeListener("livestreamUpdate",this.livestreamUpdateListener),this.player=null,window.dyteLivestreamPlayerElement=null}meetingChanged(t){null!=t&&(this.livestreamState=this.meeting.livestream.state,this.playbackUrl=this.meeting.livestream.playbackUrl,this.meeting.livestream.on("livestreamUpdate",this.livestreamUpdateListener))}render(){if(!s(this.meeting))return;const{isError:t,errorMessage:a}=this.getErrorState(),{isLoading:r,loadingMessage:n,showIcon:o}=this.getLoadingState();return i(e,null,i("div",{class:"player-container"},"LIVESTREAMING"===this.livestreamState&&this.livestreamId&&i("div",{class:"flex h-full w-full items-start justify-center pb-20"},i("stream",{width:"100%",height:"80vh",className:"overflow-hidden rounded-lg",src:this.livestreamId,ref:async t=>{this.player=t,window.dyteLivestreamPlayerElement=t,await this.loadLivestreamPlayer()&&await this.startLivestreamPlayer()},cmcd:!0,autoplay:!0,"force-flavor":"llhls","customer-domain-prefix":"customer-s8oj0c1n5ek8ah1e"})),this.audioPlaybackError&&i("div",{class:"unmute-popup"},i("h3",null,this.t("audio_playback.title")),i("p",null,this.t("audio_playback.description")),i("dyte-button",{kind:"wide",onClick:()=>{this.player&&(this.player.muted=!1),this.audioPlaybackError=!1},title:this.t("audio_playback"),iconPack:this.iconPack,t:this.t},this.t("audio_playback"))),t&&i("div",{class:"loader"},i("dyte-icon",{icon:this.iconPack.warning,t:this.t}),i("p",null,a)),!t&&r&&i("div",{class:"loader"},o&&i("dyte-spinner",{id:"icon",part:"spinner",iconPack:this.iconPack,t:this.t,size:"md"}),i("p",null,n))))}static get watchers(){return{livestreamState:["updateLivestreamId"],meeting:["meetingChanged"]}}};p.style=":host{line-height:initial;font-family:var(--dyte-font-family, sans-serif);font-feature-settings:normal;font-variation-settings:normal}p{margin:var(--dyte-space-0, 0px);padding:var(--dyte-space-0, 0px)}:host{margin-left:var(--dyte-space-2, 8px);margin-right:var(--dyte-space-2, 8px);display:flex;height:100%;width:100%;border-radius:var(--dyte-border-radius-md, 8px);--tw-bg-opacity:1;background-color:rgba(var(--dyte-colors-background-900, 26 26 26) / var(--tw-bg-opacity))}.player-container{position:relative;margin:var(--dyte-space-4, 16px);display:flex;flex-grow:1;align-items:center;justify-content:center;overflow:hidden;border-radius:var(--dyte-border-radius-md, 8px)}.player{left:var(--dyte-space-0, 0px);z-index:20;aspect-ratio:16 / 9;height:100%;width:auto;border-radius:var(--dyte-border-radius-md, 8px);border-width:0px;--tw-bg-opacity:1;background-color:rgba(var(--dyte-colors-background-1000, 8 8 8) / var(--tw-bg-opacity))}.loader{position:absolute;z-index:10;height:100%;width:100%;--tw-bg-opacity:1;background-color:rgba(var(--dyte-colors-background-900, 26 26 26) / var(--tw-bg-opacity));display:flex;flex-direction:column;align-items:center;justify-content:center}p{margin-top:var(--dyte-space-1, 4px);margin-bottom:var(--dyte-space-1, 4px);font-size:16px;color:rgb(var(--dyte-colors-text-700, 255 255 255 / 0.64))}.latency-controls{position:absolute;bottom:var(--dyte-space-4, 16px);right:var(--dyte-space-4, 16px);z-index:20;display:flex;flex-direction:row;align-items:center}.sync-live-stream{cursor:pointer;border-radius:var(--dyte-border-radius-sm, 4px);--tw-bg-opacity:1;background-color:rgba(var(--dyte-colors-brand-500, 33 96 253) / var(--tw-bg-opacity));padding-left:var(--dyte-space-2, 8px);padding-right:var(--dyte-space-2, 8px);padding-top:var(--dyte-space-1, 4px);padding-bottom:var(--dyte-space-1, 4px);font-size:12px}.unmute-popup{position:absolute;z-index:30 !important;display:flex;width:var(--dyte-space-72, 288px);flex-direction:column;border-radius:var(--dyte-border-radius-md, 8px);--tw-bg-opacity:1;background-color:rgba(var(--dyte-colors-background-800, 30 30 30) / var(--tw-bg-opacity));padding:var(--dyte-space-4, 16px);text-align:center;max-width:70%}.unmute-popup h3{margin:var(--dyte-space-0, 0px);font-size:16px;font-weight:500}.unmute-popup p{margin-top:var(--dyte-space-3, 12px);margin-bottom:var(--dyte-space-3, 12px);font-size:14px}";const l=class{constructor(i){t(this,i),this.disconnectMeeting=t=>{var i;null!=t&&null!=this.countListener&&(null===(i=t.livestream)||void 0===i||i.removeListener("viewerCountUpdate",this.countListener))},this.meeting=void 0,this.variant="primary",this.iconPack=n,this.t=o(),this.viewerCount=0}connectedCallback(){this.meetingChanged(this.meeting)}disconnectedCallback(){this.disconnectMeeting(this.meeting)}meetingChanged(t,i){var e;this.disconnectMeeting(i),null!=t&&(this.countListener=()=>{var i;this.viewerCount=null===(i=t.livestream)||void 0===i?void 0:i.viewerCount},this.countListener(),null===(e=t.livestream)||void 0===e||e.addListener("viewerCountUpdate",this.countListener))}render(){return s(this.meeting)?i(e,{tabIndex:0,role:"log","aria-label":`${this.viewerCount} ${this.t("viewers")}`},i("dyte-icon",{icon:this.iconPack.viewers,tabIndex:-1,"aria-hidden":!0,part:"icon",iconPack:this.iconPack,t:this.t}),this.viewerCount," ",this.t("viewers")):null}static get watchers(){return{meeting:["meetingChanged"]}}};l.style=":host{line-height:initial;font-family:var(--dyte-font-family, sans-serif);font-feature-settings:normal;font-variation-settings:normal}p{margin:var(--dyte-space-0, 0px);padding:var(--dyte-space-0, 0px)}:host{margin-left:var(--dyte-space-2, 8px);margin-right:var(--dyte-space-2, 8px);display:inline-flex;height:var(--dyte-space-10, 40px);-webkit-user-select:none;-moz-user-select:none;user-select:none;align-items:center;font-size:14px}:host([size='sm']){margin-left:var(--dyte-space-1, 4px);margin-right:var(--dyte-space-1, 4px);font-size:12px}dyte-icon{margin-right:var(--dyte-space-1, 4px);height:var(--dyte-space-5, 20px);width:var(--dyte-space-5, 20px)}:host([size='sm']) dyte-icon{height:var(--dyte-space-4, 16px);width:var(--dyte-space-4, 16px)}:host([variant='embedded']){--tw-bg-opacity:1;background-color:rgba(var(--dyte-colors-background-1000, 8 8 8) / var(--tw-bg-opacity));opacity:0.5;margin-top:var(--dyte-space-1, 4px);margin-left:var(--dyte-space-1, 4px);height:var(--dyte-space-5, 20px);border-radius:var(--dyte-border-radius-sm, 4px);padding-left:var(--dyte-space-2, 8px);padding-right:var(--dyte-space-2, 8px);font-size:12px}:host([variant='embedded']) dyte-icon{height:var(--dyte-space-4, 16px);width:var(--dyte-space-4, 16px)}";export{d as dyte_livestream_indicator,p as dyte_livestream_player,l as dyte_viewer_count}