var DyteClient=function(){var ry,sr,rr,rs,Li,gt,ns,Ve,ws,nr,Rt,Je,xi,Vi,ir,Ui,Ur,ny,vt,te,Nn,Ke,Ln,_o,ol,_y,iy,cl,ay,dl,by,Fi,Bi,bo,oy,$i,xn,cy,Hi,wo,sp,Vn,Po,dy,Fr,qi,ll,ly,is,ji,le,Co,Vs,Ps,Ro,rp,Gi,jl,Br,Un,$r,ko,ar,yt,zt,Wi,Ji,or,Ki,Fn,zi,uy,$e,Bn,as,Yi,Io,hy,Qi,Ao,Xi,Gl,py,ul,Qe,He,Pe,Us,os,Mo,hl,$n,Hn,pl,Zi,cs,ml,my,ea,ta,Do,Ut,qn,Oo,sa,na,ia,aa,cr,Tt,Hr,qr,fl,wy,jn,Gn,No,np,Lo,jr,gl,Py,oa,ca,Gr,Wn,Dc,dr,xo,Wr,da,Wl,lr,vl,Vo,ip,fy,Jr,Fs,ur,ui,Jn,Ft,gy,q,la,ua,yl,kt,Xt,Xh,pa,It,ma,Bs,Kr,Ba,Xe,ut,qe,et,fa,ga,Uo,ap,vy,Fo,yy,ot,Bo,Kn,$s,Hs,dn,$o,op,Tl,Cy,Sl,Ry,Cs,va,ya,zn,ds,ct,zr,Ta,Yt,As,Yr,Ea,Ho,hr,_a,At,Mt,Yn,ba,wa,Pa,Qn,Qr,qo,Ca,Jl,jo,cp,El,ky,_l,Iy,bl,Ay,wl,My,Pl,Dy,Go,dp,Wo,lp,Cl,Oy,Ra,Xn,Xr,ka,Jo,qs,Ko,Rl,Ny,kl,Ly,Il,xy,Al,Vy,zo,up,Yo,hp,Ml,Uy,Qo,Xo,Zo,Ia,Aa,Ma,ec,tc,Zn,Bt,Rs,ks,ei,ti,pr,sc,Dl,Fy,Ol,By,Nl,$y,Ll,Hy,Zr,en,si,Da,tn,Oa,Na,rc,sn,ri,La,Vl,qy,nc,pp,Ul,jy,Fl,Gy,Bl,Wy,ic,ac,St,j,Va,ni,Dt,ii,ai,rn,oc,mr,Ua,oi,ci,di,ls,nn,$a,dt,Nt,li,Oc,cc,mp,dc,fp,an,Is,lt,$t,ps,Ty,lc,uc,fr,Ht,Ze,on,Me,De,Ge,us,gr,hc,gp,pc,vp,Sy,mc,$l,Fa,hs,Zh,Hl,nt,fc,gc,ql,Jy,Ey;"use strict";var qN=Object.defineProperty;var jN=(Ie,re,We)=>re in Ie?qN(Ie,re,{enumerable:!0,configurable:!0,writable:!0,value:We}):Ie[re]=We;var m=(Ie,re,We)=>(jN(Ie,typeof re!="symbol"?re+"":re,We),We),tp=(Ie,re,We)=>{if(!re.has(Ie))throw TypeError("Cannot "+We)};var o=(Ie,re,We)=>(tp(Ie,re,"read from private field"),We?We.call(Ie):re.get(Ie)),g=(Ie,re,We)=>{if(re.has(Ie))throw TypeError("Cannot add the same private member more than once");re instanceof WeakSet?re.add(Ie):re.set(Ie,We)},v=(Ie,re,We,js)=>(tp(Ie,re,"write to private field"),js?js.call(Ie,We):re.set(Ie,We),We);var $=(Ie,re,We)=>(tp(Ie,re,"access private method"),We);function Ie(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}var re={},We={get exports(){return re},set exports(s){re=s}},js=typeof Reflect=="object"?Reflect:null,yp=js&&typeof js.apply=="function"?js.apply:function(e,t,r){return Function.prototype.apply.call(e,t,r)},Nc;js&&typeof js.ownKeys=="function"?Nc=js.ownKeys:Object.getOwnPropertySymbols?Nc=function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:Nc=function(e){return Object.getOwnPropertyNames(e)};function Ky(s){console&&console.warn&&console.warn(s)}var Tp=Number.isNaN||function(e){return e!==e};function pe(){pe.init.call(this)}We.exports=pe,re.once=Xy,pe.EventEmitter=pe,pe.prototype._events=void 0,pe.prototype._eventsCount=0,pe.prototype._maxListeners=void 0;var Sp=10;function Lc(s){if(typeof s!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof s)}Object.defineProperty(pe,"defaultMaxListeners",{enumerable:!0,get:function(){return Sp},set:function(s){if(typeof s!="number"||s<0||Tp(s))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+s+".");Sp=s}}),pe.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},pe.prototype.setMaxListeners=function(e){if(typeof e!="number"||e<0||Tp(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this};function Ep(s){return s._maxListeners===void 0?pe.defaultMaxListeners:s._maxListeners}pe.prototype.getMaxListeners=function(){return Ep(this)},pe.prototype.emit=function(e){for(var t=[],r=1;r<arguments.length;r++)t.push(arguments[r]);var n=e==="error",i=this._events;if(i!==void 0)n=n&&i.error===void 0;else if(!n)return!1;if(n){var a;if(t.length>0&&(a=t[0]),a instanceof Error)throw a;var c=new Error("Unhandled error."+(a?" ("+a.message+")":""));throw c.context=a,c}var d=i[e];if(d===void 0)return!1;if(typeof d=="function")yp(d,this,t);else for(var l=d.length,h=Cp(d,l),r=0;r<l;++r)yp(h[r],this,t);return!0};function _p(s,e,t,r){var n,i,a;if(Lc(t),i=s._events,i===void 0?(i=s._events=Object.create(null),s._eventsCount=0):(i.newListener!==void 0&&(s.emit("newListener",e,t.listener?t.listener:t),i=s._events),a=i[e]),a===void 0)a=i[e]=t,++s._eventsCount;else if(typeof a=="function"?a=i[e]=r?[t,a]:[a,t]:r?a.unshift(t):a.push(t),n=Ep(s),n>0&&a.length>n&&!a.warned){a.warned=!0;var c=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");c.name="MaxListenersExceededWarning",c.emitter=s,c.type=e,c.count=a.length,Ky(c)}return s}pe.prototype.addListener=function(e,t){return _p(this,e,t,!1)},pe.prototype.on=pe.prototype.addListener,pe.prototype.prependListener=function(e,t){return _p(this,e,t,!0)};function zy(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function bp(s,e,t){var r={fired:!1,wrapFn:void 0,target:s,type:e,listener:t},n=zy.bind(r);return n.listener=t,r.wrapFn=n,n}pe.prototype.once=function(e,t){return Lc(t),this.on(e,bp(this,e,t)),this},pe.prototype.prependOnceListener=function(e,t){return Lc(t),this.prependListener(e,bp(this,e,t)),this},pe.prototype.removeListener=function(e,t){var r,n,i,a,c;if(Lc(t),n=this._events,n===void 0)return this;if(r=n[e],r===void 0)return this;if(r===t||r.listener===t)--this._eventsCount===0?this._events=Object.create(null):(delete n[e],n.removeListener&&this.emit("removeListener",e,r.listener||t));else if(typeof r!="function"){for(i=-1,a=r.length-1;a>=0;a--)if(r[a]===t||r[a].listener===t){c=r[a].listener,i=a;break}if(i<0)return this;i===0?r.shift():Yy(r,i),r.length===1&&(n[e]=r[0]),n.removeListener!==void 0&&this.emit("removeListener",e,c||t)}return this},pe.prototype.off=pe.prototype.removeListener,pe.prototype.removeAllListeners=function(e){var t,r,n;if(r=this._events,r===void 0)return this;if(r.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):r[e]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete r[e]),this;if(arguments.length===0){var i=Object.keys(r),a;for(n=0;n<i.length;++n)a=i[n],a!=="removeListener"&&this.removeAllListeners(a);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(t=r[e],typeof t=="function")this.removeListener(e,t);else if(t!==void 0)for(n=t.length-1;n>=0;n--)this.removeListener(e,t[n]);return this};function wp(s,e,t){var r=s._events;if(r===void 0)return[];var n=r[e];return n===void 0?[]:typeof n=="function"?t?[n.listener||n]:[n]:t?Qy(n):Cp(n,n.length)}pe.prototype.listeners=function(e){return wp(this,e,!0)},pe.prototype.rawListeners=function(e){return wp(this,e,!1)},pe.listenerCount=function(s,e){return typeof s.listenerCount=="function"?s.listenerCount(e):Pp.call(s,e)},pe.prototype.listenerCount=Pp;function Pp(s){var e=this._events;if(e!==void 0){var t=e[s];if(typeof t=="function")return 1;if(t!==void 0)return t.length}return 0}pe.prototype.eventNames=function(){return this._eventsCount>0?Nc(this._events):[]};function Cp(s,e){for(var t=new Array(e),r=0;r<e;++r)t[r]=s[r];return t}function Yy(s,e){for(;e+1<s.length;e++)s[e]=s[e+1];s.pop()}function Qy(s){for(var e=new Array(s.length),t=0;t<e.length;++t)e[t]=s[t].listener||s[t];return e}function Xy(s,e){return new Promise(function(t,r){function n(a){s.removeListener(e,i),r(a)}function i(){typeof s.removeListener=="function"&&s.removeListener("error",n),t([].slice.call(arguments))}Rp(s,e,i,{once:!0}),e!=="error"&&Zy(s,n,{once:!0})})}function Zy(s,e,t){typeof s.on=="function"&&Rp(s,"error",e,t)}function Rp(s,e,t,r){if(typeof s.on=="function")r.once?s.once(e,t):s.on(e,t);else if(typeof s.addEventListener=="function")s.addEventListener(e,function n(i){r.once&&s.removeEventListener(e,n),t(i)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof s)}var Y;(function(s){s[s.MAJOR_EVENT=0]="MAJOR_EVENT",s[s.MINOR_EVENT=1]="MINOR_EVENT"})(Y||(Y={}));var L;(function(s){s.PRECALL_TEST_BEGIN="precall_begin",s.PRECALL_TEST_COMPLETE="precall_end",s.CALL_JOIN_BEGIN="call_join",s.NET_QUALITY_TEST_BEGIN="net_quality_test_begin",s.NET_QUALITY_TEST_END="net_quality_test_end",s.WEBSOCKET_CONNECTED="websocket_connected",s.TRANSPORT_CONNECTED="transport_connected",s.AUDIO_ON="audio_on",s.AUDIO_OFF="audio_off",s.VIDEO_ON="video_on",s.VIDEO_OFF="video_off",s.PARTICIPANT_ROLE="participant_role",s.PING_STAT="ping_stat",s.DISCONNECT="disconnect",s.RECONNECT_ATTEMPT="reconnect_attempt",s.SCREENSHARE_START_REQUESTED="screenshare_start_requested",s.SCREENSHARE_STARTED="screenshare_started",s.SCREENSHARE_STOPPED="screenshare_stopped",s.TAB_CHANGE="tab_change",s.BROWSER_BACKGROUNDED="browser_backgrounded",s.BROWSER_FOREGROUNDED="browser_foregrounded",s.DOMINANT_SPEAKER="dominant_speaker",s.AUDIO_DEVICES_UPDATES="audio_devices_updates",s.VIDEO_DEVICES_UPDATES="video_devices_updates",s.SPEAKER_DEVICES_UPDATES="speaker_devices_updates",s.SELECTED_MICROHPONE_UPDATE="selected_microphone_update",s.SELECTED_CAMERA_UPDATE="selected_camera_update",s.SELECTED_SPEAKER_UPDATE="selected_speaker_update",s.EXPECTED_VIDEO_RESOLUTION="expected_video_resolution",s.EXPECTED_SCREENSHARE_RESOLUTION="expected_screenshare_resolution",s.MEDIA_PERMISSION="media_permission",s.LEGACY_SWITCH="legacy_switch",s.AUDIO_PLAY_FAILED="audio_play_failed",s.VIDEO_PLAY_FAILED="video_play_failed",s.AUDIO_TRACK_MUTED="audio_track_muted",s.VIDEO_TRACK_MUTED="video_track_muted",s.IVS_PLAYER_REBUFFERING="ivs_player_rebuffering",s.IVS_PLAYER_AUDIO_BLOCKED="ivs_player_audio_blocked",s.IVS_PLAYER_PLAYBACK_BLOCKED="ivs_player_playback_blocked",s.IVS_PLAYER_ERROR="ivs_player_error",s.IVS_PLAYER_RECOVERABLE_ERROR="ivs_player_recoverable_error",s.IVS_PLAYER_WORKER_ERROR="ivs_player_worker_error",s.IVS_PLAYER_NETWORK_UNAVAILABLE="ivs_player_network_unavailable",s.LIVESTREAM_LATENCY="livestream_latency",s.IVS_PLAYER_ANALYTICS_EVENT="ivs_player_analytics_event",s.IVS_PLAYER_PLAYBACK_RATE_CHANGED="ivs_player_playback_rate_changed",s.IVS_PLAYER_QUALITY_CHANGED="ivs_player_quality_changed",s.IVS_PLAYER_INITIALIZED="ivs_player_initialized"})(L||(L={}));const eT=new Map([[L.PRECALL_TEST_BEGIN,Y.MINOR_EVENT],[L.PRECALL_TEST_COMPLETE,Y.MINOR_EVENT],[L.CALL_JOIN_BEGIN,Y.MAJOR_EVENT],[L.NET_QUALITY_TEST_BEGIN,Y.MINOR_EVENT],[L.NET_QUALITY_TEST_END,Y.MINOR_EVENT],[L.WEBSOCKET_CONNECTED,Y.MINOR_EVENT],[L.TRANSPORT_CONNECTED,Y.MAJOR_EVENT],[L.AUDIO_ON,Y.MINOR_EVENT],[L.AUDIO_OFF,Y.MINOR_EVENT],[L.VIDEO_ON,Y.MINOR_EVENT],[L.VIDEO_OFF,Y.MINOR_EVENT],[L.PARTICIPANT_ROLE,Y.MINOR_EVENT],[L.PING_STAT,Y.MAJOR_EVENT],[L.DISCONNECT,Y.MAJOR_EVENT],[L.RECONNECT_ATTEMPT,Y.MAJOR_EVENT],[L.SCREENSHARE_START_REQUESTED,Y.MINOR_EVENT],[L.SCREENSHARE_STARTED,Y.MINOR_EVENT],[L.SCREENSHARE_STOPPED,Y.MINOR_EVENT],[L.TAB_CHANGE,Y.MINOR_EVENT],[L.BROWSER_BACKGROUNDED,Y.MINOR_EVENT],[L.BROWSER_FOREGROUNDED,Y.MINOR_EVENT],[L.DOMINANT_SPEAKER,Y.MINOR_EVENT],[L.AUDIO_DEVICES_UPDATES,Y.MINOR_EVENT],[L.VIDEO_DEVICES_UPDATES,Y.MINOR_EVENT],[L.SPEAKER_DEVICES_UPDATES,Y.MINOR_EVENT],[L.SELECTED_MICROHPONE_UPDATE,Y.MINOR_EVENT],[L.SELECTED_CAMERA_UPDATE,Y.MINOR_EVENT],[L.SELECTED_SPEAKER_UPDATE,Y.MINOR_EVENT],[L.MEDIA_PERMISSION,Y.MINOR_EVENT],[L.LEGACY_SWITCH,Y.MINOR_EVENT],[L.AUDIO_PLAY_FAILED,Y.MINOR_EVENT],[L.VIDEO_PLAY_FAILED,Y.MINOR_EVENT],[L.AUDIO_TRACK_MUTED,Y.MINOR_EVENT],[L.VIDEO_TRACK_MUTED,Y.MINOR_EVENT],[L.IVS_PLAYER_REBUFFERING,Y.MAJOR_EVENT],[L.IVS_PLAYER_AUDIO_BLOCKED,Y.MAJOR_EVENT],[L.IVS_PLAYER_PLAYBACK_BLOCKED,Y.MAJOR_EVENT],[L.IVS_PLAYER_ERROR,Y.MAJOR_EVENT],[L.IVS_PLAYER_RECOVERABLE_ERROR,Y.MAJOR_EVENT],[L.IVS_PLAYER_WORKER_ERROR,Y.MAJOR_EVENT],[L.IVS_PLAYER_NETWORK_UNAVAILABLE,Y.MAJOR_EVENT],[L.LIVESTREAM_LATENCY,Y.MAJOR_EVENT],[L.IVS_PLAYER_ANALYTICS_EVENT,Y.MINOR_EVENT],[L.IVS_PLAYER_PLAYBACK_RATE_CHANGED,Y.MINOR_EVENT],[L.IVS_PLAYER_QUALITY_CHANGED,Y.MINOR_EVENT],[L.IVS_PLAYER_INITIALIZED,Y.MINOR_EVENT],[L.EXPECTED_VIDEO_RESOLUTION,Y.MINOR_EVENT],[L.EXPECTED_SCREENSHARE_RESOLUTION,Y.MINOR_EVENT]]);class tT{constructor(){m(this,"events");this.events=[]}add(e){this.events.push(e)}flush(){return{entries:this.events.splice(0,25)}}}class sT extends re{constructor({logger:t,peerId:r,apiHostnames:n}){super();m(this,"logger");m(this,"peerId");m(this,"eventStore");m(this,"apiEndpoint");this.logger=t,this.peerId=r,this.apiEndpoint=`https://${n.daCollector}/api/v1/message`,this.eventStore=new tT}async sendEventsChunkToServer(t){var n;const r={payload:t,peerId:this.peerId};try{return await fetch(this.apiEndpoint,{method:"POST",body:JSON.stringify(r)}),!0}catch(i){return this.logger.error("callStats::sendEventsChunkToServer::catch",{error:i}),(n=t.entries)==null||n.forEach(a=>{this.eventStore.add(a)}),!1}}callEvent(t){t.timestamp=new Date,this.eventStore.add(t),this.emit(t.event,t.metaData),eT.get(t.event)===Y.MAJOR_EVENT&&this.flush()}async flush(){var r;const t=this.eventStore.flush();return(r=t==null?void 0:t.entries)!=null&&r.length?(await this.sendEventsChunkToServer(t),!0):!1}}var kp;(function(s){s.CHROMIUM="chromum",s.FIREFOX="firefox",s.SAFARI="safari"})(kp||(kp={}));const Ha={DEVEL:"devel",PREPROD:"preprod",PROD:"prod"};var Zt;(function(s){s.AUDIO="AUDIO",s.VIDEO="VIDEO",s.SPEAKER="SPEAKER",s.SCREENSHARE="SCREENSHARE"})(Zt||(Zt={}));var Ip;(function(s){s[s.INIT=0]="INIT",s[s.ACCEPTED=1]="ACCEPTED",s[s.DENIED=2]="DENIED",s[s.SYS_DENIED=3]="SYS_DENIED",s[s.FAILED=4]="FAILED",s[s.NOTFOUND=5]="NOTFOUND",s[s.NOT_APPLICABLE=6]="NOT_APPLICABLE"})(Ip||(Ip={}));function yr(s){return s?s.split(".").slice(0,2).concat(["0","0"]).join("."):""}function xc({packetsLost:s,packetsSent:e}){return e>0?s*100/e:0}function Vc({packetsLost:s,packetsReceived:e}){return e+s>0?s*100/(e+s):0}const Ap=240,Mp=720,Dp=8,Op=3,Uc=10,Fc=.02,Bc=.03;function Gs({stat:s,weight:e,rangeMin:t,rangeMax:r,rangeRankingDirection:n}){return s==null?e:t===r?n==="UP"?s<=t?e:0:s>=r?e:0:n==="UP"?(1-Math.max(Math.min(r,Math.abs(s))-t,0)/(r-t))*e:n==="DOWN"?Math.max(Math.min(r,Math.abs(s))-t,0)/(r-t)*e:e}function Np({isLowQualityVideo:s,isVideoStuck:e,isVideoLagging:t,jitterQuality:r,packetsLostQuality:n}){const i=.8*((s?.85:1)*(t?.7:1)*(e?.5:1))+.2*(r*n);return Math.round((i+Number.EPSILON)*100)/100}function Lp({packetsLost:s,packetsSent:e}){return e>0?s*100/e:0}function xp({packetsLost:s,packetsSent:e,jitter:t}){const n=Gs({stat:Lp({packetsLost:s,packetsSent:e}),weight:.7,rangeMin:0,rangeMax:Uc,rangeRankingDirection:"UP"}),a=Gs({stat:t,weight:.3,rangeMin:Fc,rangeMax:Bc,rangeRankingDirection:"UP"});return n+a}function rT({frameWidth:s,isScreenShare:e}){return s<(e?Mp:Ap)}function nT({framesPerSecond:s,isScreenShare:e}){return s<(e?Op:Dp)}function iT({framesEncoded:s}){return s===0}function Vp({frameWidth:s,framesPerSecond:e,packetsLost:t,packetsSent:r,jitter:n,isScreenShare:i,framesEncoded:a}){const c=Gs({stat:Lp({packetsLost:t,packetsSent:r}),weight:1,rangeMin:0,rangeMax:Uc,rangeRankingDirection:"UP"}),d=Gs({stat:n,weight:1,rangeMin:Fc,rangeMax:Bc,rangeRankingDirection:"UP"}),l=rT({frameWidth:s,isScreenShare:i}),h=nT({framesPerSecond:e,isScreenShare:i}),p=iT({framesEncoded:a,isScreenShare:i});return Np({isLowQualityVideo:l,isVideoLagging:h,isVideoStuck:p,jitterQuality:d,packetsLostQuality:c})}function Up({packetsLost:s,packetsReceived:e}){return e+s>0?s*100/(e+s):0}function Fp({concealmentEvents:s,packetsLost:e,packetsReceived:t,jitter:r}){const i=Gs({stat:s,weight:.2,rangeMin:0,rangeMax:3,rangeRankingDirection:"UP"}),a=.5,c=Gs({stat:Up({packetsLost:e,packetsReceived:t}),weight:a,rangeMin:0,rangeMax:Uc,rangeRankingDirection:"UP"}),l=Gs({stat:r,weight:.3,rangeMin:Fc,rangeMax:Bc,rangeRankingDirection:"UP"});return i+c+l}function aT({framesDecoded:s}){return s===0}function oT({framesPerSecond:s,isScreenShare:e}){return s<(e?Op:Dp)}function cT({frameWidth:s,isScreenShare:e}){return s<(e?Mp:Ap)}function Bp({frameWidth:s,framesPerSecond:e,packetsLost:t,packetsReceived:r,jitter:n,isScreenShare:i,framesDecoded:a}){const c=Gs({stat:Up({packetsLost:t,packetsReceived:r}),weight:1,rangeMin:0,rangeMax:Uc,rangeRankingDirection:"UP"}),d=Gs({stat:n,weight:1,rangeMin:Fc,rangeMax:Bc,rangeRankingDirection:"UP"}),l=cT({frameWidth:s,isScreenShare:i}),h=oT({framesPerSecond:e,isScreenShare:i}),p=aT({framesDecoded:a,isScreenShare:i});return Np({isLowQualityVideo:l,isVideoLagging:h,isVideoStuck:p,jitterQuality:d,packetsLostQuality:c})}class Ws{constructor(e){m(this,"pc1");m(this,"pc2");m(this,"constrainVideoBitrateKbps");m(this,"constrainOfferToRemoveVideoFec",!1);m(this,"iceCandidateFilter");const t=new RTCPeerConnection(e),r=new RTCPeerConnection(e);this.pc1=t,this.pc2=r,this.iceCandidateFilter=Ws.noFilter,this.pc1.addEventListener("icecandidate",this.onIceCandidate.bind(this,this.pc2)),this.pc2.addEventListener("icecandidate",this.onIceCandidate.bind(this,this.pc1))}static parseCandidate(e){const t="candidate:",r=e.indexOf(t)+t.length,n=e.substr(r).split(" ");return{type:n[7],protocol:n[2],address:n[4]}}static isNotHostCandidate(e){return e.type!=="host"}static isHost(e){return e.type==="host"}static isRelay(e){return e.type==="relay"}static isReflexive(e){return e.type==="srflx"}static noFilter(e){return!0}onIceCandidate(e,t){if(t.candidate){const r=Ws.parseCandidate(t.candidate.candidate);this.iceCandidateFilter(r)&&e.addIceCandidate(t.candidate)}}setIceCandidateFilter(e){this.iceCandidateFilter=e}constrainVideoBitrate(e){this.constrainVideoBitrateKbps=e}disableVideoFec(){this.constrainOfferToRemoveVideoFec=!0}gotOffer(e){this.constrainOfferToRemoveVideoFec&&(e.sdp=e.sdp.replace(/(m=video 1 [^\r]+)(116 117)(\r\n)/g,`$1\r
`),e.sdp=e.sdp.replace(/a=rtpmap:116 red\/90000\r\n/g,""),e.sdp=e.sdp.replace(/a=rtpmap:117 ulpfec\/90000\r\n/g,""),e.sdp=e.sdp.replace(/a=rtpmap:98 rtx\/90000\r\n/g,""),e.sdp=e.sdp.replace(/a=fmtp:98 apt=116\r\n/g,"")),this.pc1.setLocalDescription(e),this.pc2.setRemoteDescription(e),this.pc2.createAnswer().then(this.gotAnswer.bind(this),this.reportFatal.bind(this))}gotAnswer(e){this.constrainVideoBitrateKbps&&(e.sdp=e.sdp.replace(/a=mid:video\r\n/g,`a=mid:video\r
b=AS:${this.constrainVideoBitrateKbps}\r
`)),this.pc2.setLocalDescription(e),this.pc1.setRemoteDescription(e)}establishConnection(){this.pc1.createOffer().then(this.gotOffer.bind(this),this.reportFatal.bind(this))}reportFatal(e){console.error("Error:",e)}async getRoundTripTime(){const[e,t]=await Promise.all([this.pc1.getStats(),this.pc2.getStats()]);let r,n;if(e.forEach(i=>{i.type==="candidate-pair"&&i.nominated===!0&&i.bytesSent>0&&(r=i)}),t.forEach(i=>{i.type==="candidate-pair"&&i.nominated===!0&&i.bytesReceived>0&&(n=i)}),r&&n)try{if(r.currentRoundTripTime&&n.currentRoundTripTime)return{rtt:r.currentRoundTripTime,backendRTT:n.currentRoundTripTime};const i=(n.lastPacketReceivedTimestamp-r.lastPacketSentTimestamp)/1e3;return{rtt:i,backendRTT:i}}catch(i){return}}close(){this.pc1.close(),this.pc2.close()}}class $p extends re{constructor(t){super();m(this,"call");m(this,"timeOut");this.call=new Ws(t)}start(t=1e4){this.call.establishConnection(),this.timeOut=setTimeout(this.testFailed.bind(this),t)}testComplete(t){clearTimeout(this.timeOut),this.call.close(),this.emit("done",t)}testFailed(t){this.call.close(),this.emit("failed",t)}}const dT=8,lT=1/1e3;class uT extends $p{constructor(t){super(t);m(this,"senderChannel");m(this,"recieveChannel");m(this,"startTime");m(this,"lastBitrateMeasureTime");m(this,"sentPayloadBytes",0);m(this,"recievedPayloadBytes",0);m(this,"lastReceivedPayloadBytes",0);m(this,"stopSending",!1);m(this,"testProgress",0);m(this,"samplePacket","");m(this,"finalBitrateSum",0);m(this,"bitRateSampels",0);m(this,"maxNumberOfPacketsToSend",0);m(this,"bytesToKeepBuffered",0);m(this,"testDurationSeconds",5);this.call.setIceCandidateFilter(Ws.isNotHostCandidate),this.senderChannel=this.call.pc1.createDataChannel(null);for(let r=0;r<262144;r+=1)this.samplePacket+="h";this.maxNumberOfPacketsToSend=1,this.bytesToKeepBuffered=1024*this.maxNumberOfPacketsToSend,this.testDurationSeconds=4,this.senderChannel.addEventListener("open",this.sendingStep.bind(this)),this.call.pc2.addEventListener("datachannel",this.onRecieverChannel.bind(this))}sendingStep(){const t=new Date;this.startTime||(this.startTime=t,this.lastBitrateMeasureTime=t);for(let n=0;n!==this.maxNumberOfPacketsToSend&&!(this.senderChannel.bufferedAmount>=this.bytesToKeepBuffered);n+=1){this.sentPayloadBytes+=this.samplePacket.length;try{this.senderChannel.send(this.samplePacket)}catch(i){}}const r=t.getTime()-this.startTime.getTime();r>=1e3*this.testDurationSeconds?(this.stopSending=!0,this.testProgress=100):(this.testProgress=r/(10*this.testDurationSeconds),setTimeout(this.sendingStep.bind(this),1))}onMessageRecieved(t){this.recievedPayloadBytes+=t.data.length;const r=new Date,n=r.getTime()-this.lastBitrateMeasureTime.getTime();if(n>=1e3){const a=(this.recievedPayloadBytes-this.lastReceivedPayloadBytes)*dT/(n/1e3);this.finalBitrateSum+=a,this.bitRateSampels+=1,this.lastReceivedPayloadBytes=this.recievedPayloadBytes,this.lastBitrateMeasureTime=r}if(this.stopSending&&this.sentPayloadBytes===this.recievedPayloadBytes){const i=this.finalBitrateSum/this.bitRateSampels;this.testComplete({throughput:Math.round(i*lT)})}}testComplete(t){this.call.getRoundTripTime().then(({rtt:r,backendRTT:n})=>super.testComplete({RTT:r,backendRTT:n,throughput:t.throughput}))}onRecieverChannel(t){this.recieveChannel=t.channel,this.recieveChannel.addEventListener("message",this.onMessageRecieved.bind(this))}}class Kl extends $p{constructor(t,r=Ws.noFilter){super(t);m(this,"ch1");m(this,"ch2");this.call.setIceCandidateFilter(r);const n=this.call.pc1.createDataChannel(null);this.ch1=n,n.addEventListener("open",()=>{n.send("hello")}),n.addEventListener("message",this.onCh1Recieve.bind(this)),this.call.pc2.addEventListener("datachannel",this.dataChannelHandler.bind(this))}onCh1Recieve(t){t.data!=="world"?this.hangup("Invalid data transmitted."):this.testComplete({connectivity:!0})}onCh2Recieve(t){if(t.data!=="hello")this.hangup("Invalid data transmitted.");else try{this.ch2.send("world")}catch(r){}}dataChannelHandler(t){const r=t.channel;this.ch2=r,r.addEventListener("message",this.onCh2Recieve.bind(this))}hangup(t){this.testFailed(t)}}class hT extends Kl{constructor(e){super(e,Ws.isHost)}}class pT extends Kl{constructor(e){super(e,Ws.isRelay)}}class mT extends Kl{constructor(e){super(e,Ws.isReflexive)}}class fT{constructor(){m(this,"ipInformation",null)}async getIPDetails({peerId:e,apiHostnames:t,logger:r}){var n,i,a;if(!this.ipInformation){try{const c=`https://${t.location}`,l=await(await fetch(c)).json();if(((n=l.loc)==null?void 0:n.length)>5)return this.ipInformation=l,(i=this.ipInformation)!=null&&i.ip&&(this.ipInformation.ip=yr(this.ipInformation.ip)),l;throw Error("Insufficient data")}catch(c){r.error("callstats::ipDetails:: failed to fetch ip using location service",{error:c})}try{const c=await fetch(`https://${t.locationLegacy}/?token=3c493932b0624c&peerId=${e}`,{method:"POST"});this.ipInformation=await c.json(),(a=this.ipInformation)!=null&&a.ip&&(this.ipInformation.ip=yr(this.ipInformation.ip))}catch(c){r.error("callstats::ipDetails:: failed to fetch ip using legacy location service",{error:c})}}return this.ipInformation}resetCache(){this.ipInformation=null}}const zl=new fT,Hp=[{urls:"turn:turn.dyte.in:443?transport=tcp",username:"dyte",credential:"dytein",credentialType:"password"},{urls:"turn:turn.dyte.in:3478?transport=udp",username:"dyte",credential:"dytein",credentialType:"password"}];function qp(s){const[e,t]=s.split(",");return{coords:{latitude:Number(e),longitude:Number(t)}}}class jp{constructor(){m(this,"transport");m(this,"candidatePair");m(this,"outboundVideoRtp",new Map);m(this,"inboundVideoRtp",new Map);m(this,"outboundAudioRtp",new Map);m(this,"inboundAudioRtp",new Map);m(this,"remoteInboundRtp",new Map);m(this,"producerStreamMap",new Map);m(this,"consumerStreamMap",new Map);m(this,"staleProducerStreamMap",!1);m(this,"staleConsumerStreamMap",!1)}}class Gp extends re{constructor(){super();m(this,"observer");m(this,"outboundProducerMap",new Map);m(this,"inboundConsumerMap",new Map);m(this,"consumerPeerIdMap",new Map);m(this,"pausedConsumerMap",new Map);m(this,"pausedProducerMap",new Map);m(this,"overallProducingTransportsStatsMap",{});m(this,"overallConsumingTransportsStatsMap",{});m(this,"overallConsumersStatsMap",{});m(this,"overallProducersStatsMap",{});m(this,"videoProducerToStatsMap",new Map);m(this,"audioProducerToStatsMap",new Map);m(this,"videoConsumerToStatsMap",new Map);m(this,"audioConsumerToStatsMap",new Map);m(this,"consumerIdsWithFreezedVideo",new Set);m(this,"consumerIdsWithFreezedAudio",new Set);m(this,"producerIdsWithFreezedVideo",new Set);m(this,"producerIdsWithFreezedAudio",new Set);m(this,"freezedProducingTransportIds",new Set);m(this,"freezedConsumingTransportIds",new Set);m(this,"screenShareProducers",new Set);m(this,"screenShareConsumers",new Set);m(this,"ipDetails");m(this,"callStatsInstance");this.observer=new re}async registerProducer(t){await this.generateProducerStreamMap(t),t.on("close",this.deregisterProducer.bind(this,t)),t.on("pause",this.pauseProducer.bind(this,t.id)),t.on("resume",this.resumeProducer.bind(this,t.id)),t.appData.screenShare===!0&&this.screenShareProducers.add(t.id)}pauseProducer(t){this.pausedProducerMap.set(t,{lastReportCalculated:!1})}resumeProducer(t){this.pausedProducerMap.delete(t)}processInboundConsumerVideoStats(t,r,n){var a,c;const i=((c=(a=this==null?void 0:this.callStatsInstance)==null?void 0:a.consumerSharedMediaStatesMap)==null?void 0:c.get(t))||{};r.totalVideoPacketsReceived===n.packetsReceived?(this.consumerIdsWithFreezedVideo.add(t),this.callStatsInstance&&i.video&&(this.callStatsInstance.logger.debug("callstats::measurements::consumerVideoFreezed",{consumerId:t}),this.callStatsInstance.eventHandler.emit("consumer_video_status","pause",t))):(r.totalVideoPacketsReceived=n.packetsReceived,this.consumerIdsWithFreezedVideo.has(t)&&(this.consumerIdsWithFreezedVideo.delete(t),this.callStatsInstance&&i.video&&(this.callStatsInstance.logger.debug("callstats::measurements::consumerVideoDefreezed",{consumerId:t}),this.callStatsInstance.eventHandler.emit("consumer_video_status","resume",t))))}processInboundConsumerAudioStats(t,r,n){var a,c;const i=((c=(a=this==null?void 0:this.callStatsInstance)==null?void 0:a.consumerSharedMediaStatesMap)==null?void 0:c.get(t))||{};r.totalAudioPacketsReceived===n.packetsReceived?(this.consumerIdsWithFreezedAudio.add(t),this.callStatsInstance&&i.audio&&(this.callStatsInstance.logger.debug("callStats::measurements::consumerAudioFreezed",{consumerId:t}),this.callStatsInstance.eventHandler.emit("consumer_audio_status","pause",t))):(r.totalAudioPacketsReceived=n.packetsReceived,this.consumerIdsWithFreezedAudio.has(t)&&(this.consumerIdsWithFreezedAudio.delete(t),this.callStatsInstance&&i.audio&&(this.callStatsInstance.logger.debug("callStats::measurements::consumerAudioDefreezed",{consumerId:t}),this.callStatsInstance.eventHandler.emit("consumer_audio_status","resume",t))))}processOutboundProducerVideoStats(t,r,n){var a;const i=((a=this==null?void 0:this.callStatsInstance)==null?void 0:a.currentUserMediaStates)||{};r.totalVideoPacketsSent===n.packetsSent?(this.producerIdsWithFreezedVideo.add(t),this.callStatsInstance&&i.video&&(this.callStatsInstance.logger.debug("callStats::measurements::producerVideoFreezed",{producerId:t}),this.callStatsInstance.eventHandler.emit("producer_video_status","pause",t))):(r.totalVideoPacketsSent=n.packetsSent,this.producerIdsWithFreezedVideo.has(t)&&(this.producerIdsWithFreezedVideo.delete(t),this.callStatsInstance&&i.video&&(this.callStatsInstance.logger.debug("callStats::measurements::producerVideoDefreezed",{producerId:t}),this.callStatsInstance.eventHandler.emit("producer_video_status","resume",t))))}processOutboundProducerAudioStats(t,r,n){var a;const i=((a=this==null?void 0:this.callStatsInstance)==null?void 0:a.currentUserMediaStates)||{};r.totalAudioPacketsSent===n.packetsSent?(this.producerIdsWithFreezedAudio.add(t),this.callStatsInstance&&i.audio&&(this.callStatsInstance.logger.debug("callStats::measurements::producerAudioFreezed",{producerId:t}),this.callStatsInstance.eventHandler.emit("producer_audio_status","pause",t))):(r.totalAudioPacketsSent=n.packetsSent,this.producerIdsWithFreezedAudio.has(t)&&(this.producerIdsWithFreezedAudio.delete(t),this.callStatsInstance&&i.audio&&(this.callStatsInstance.logger.debug("callStats::measurements::producerAudioDefreezed",{producerId:t}),this.callStatsInstance.eventHandler.emit("producer_audio_status","resume",t))))}processProducingTransportStats(t,r,n){var h;const i=((h=this==null?void 0:this.callStatsInstance)==null?void 0:h.currentUserMediaStates)||{},{audio:a,video:c,screen:d}=i,l=a||c||d;r.totalPacketsSent===n.packetsSent?(this.freezedProducingTransportIds.add(t),this.callStatsInstance&&l&&(this.callStatsInstance.logger.debug("callStats::measurements::producingTransportFreezed",{transportId:t}),this.callStatsInstance.eventHandler.emit("producing_transport_status","pause",t))):(r.totalPacketsSent=n.packetsSent,this.freezedProducingTransportIds.has(t)&&(this.freezedProducingTransportIds.delete(t),this.callStatsInstance&&l&&(this.callStatsInstance.logger.debug("callStats::measurements::producingTransportDefreezed",{transportId:t}),this.callStatsInstance.eventHandler.emit("producing_transport_status","resume",t))))}processConsumingTransportStats(t,r,n){var c,d;const a=!!Array.from(((d=(c=this==null?void 0:this.callStatsInstance)==null?void 0:c.consumerSharedMediaStatesMap)==null?void 0:d.values())||[]).reduce((l,h)=>l||h.audio||h.video||h.screen,!1);r.totalPacketsReceived===n.packetsSent?(this.freezedConsumingTransportIds.add(t),this.callStatsInstance&&a&&(this.callStatsInstance.logger.debug("callStats::measurements::consumingTransportFreezed",{transportId:t}),this.callStatsInstance.eventHandler.emit("consuming_transport_status","pause",t))):(r.totalPacketsReceived=n.packetsSent,this.freezedConsumingTransportIds.has(t)&&(this.freezedConsumingTransportIds.delete(t),this.callStatsInstance&&a&&(this.callStatsInstance.logger.debug("callStats::measurements::consumingTransportDefreezed",{transportId:t}),this.callStatsInstance.eventHandler.emit("consuming_transport_status","resume",t))))}async registerConsumer(t){await this.generateConsumerStreamMap(t),this.consumerPeerIdMap.set(t.id,{producerId:t.producerId,peerId:t.appData.peerId,appData:t.appData}),t.on("close",this.deregisterConsumer.bind(this,t)),t.on("pause",this.pauseConsumer.bind(this,t.id)),t.on("resume",this.resumeConsumer.bind(this,t.id)),t.appData.screenShare===!0&&this.screenShareConsumers.add(t.id)}pauseConsumer(t){this.pausedConsumerMap.set(t,{lastReportCalculated:!1})}resumeConsumer(t){this.pausedConsumerMap.delete(t)}async generateProducerStreamMap(t,r=!1){const n=await t.getStats(),i=r?this.getProducerStatsFromReport(this.parseRTCReport(n,["outbound-rtp","remote-inbound-rtp"],!1,t.id))[0]:void 0;for(const a of n.values())switch(a.type){case"outbound-rtp":{this.outboundProducerMap.set(a.id,t.id);break}}return i}async generateConsumerStreamMap(t,r=!1){const n=await t.getStats(),i=r?this.getConsumerStatsFromReport(this.parseRTCReport(n,["inbound-rtp"],!1,t.id))[0]:void 0;for(const a of n.values())switch(a.type){case"inbound-rtp":{this.inboundConsumerMap.set(a.id,t.id);break}}return i}deregisterProducer(t){this.outboundProducerMap.forEach((r,n)=>{r===t.id&&this.outboundProducerMap.delete(n)}),this.pausedProducerMap.delete(t.id),this.screenShareProducers.delete(t.id)}deregisterConsumer(t){this.inboundConsumerMap.forEach((r,n)=>{r===t.id&&this.inboundConsumerMap.delete(n)}),this.consumerPeerIdMap.delete(t.id),this.pausedConsumerMap.delete(t.id),this.screenShareConsumers.delete(t.id)}getIceCandidateStats(t){var r;return{id:t.id,type:t.candidateType||t.type,address:t.address,port:t.port,url:t.url,protocol:(r=t.relayProtocol)!=null?r:t.protocol,networkType:t.networkType,relatedAddress:t.relatedAddress,relatedPort:t.relatedPort}}getWorkingSimulcastVideoStats(t){return t.find(n=>{const i=n.framesEncoded>0,a=n.packetsSent>0,c=n.frameWidth&&n.frameHeight;return i&&a&&!!c})||t[t.length-1]}parseRTCReport(t,r=[],n=!1,i=void 0,a=void 0){var b,I,x,B,H,M,z,ne,ue,ze,Qt,Oe,Ot;const c=t,d=new jp,l=r.length?new Set(r):void 0,h=[],p=[],f=[],y=new Map,_=new Map;for(const A of c.values()){if(l){if(l.size===0)break;if(l.has(A.type))n&&l.delete(A.type);else continue}switch(A.type){case"local-candidate":{h.push(this.getIceCandidateStats(A));break}case"remote-candidate":{p.push(this.getIceCandidateStats(A));break}case"candidate-pair":{const{nominated:E}=A,{selected:w}=A,F=A,ke={nominated:E!=null?E:w,currentRoundTripTime:F.currentRoundTripTime,totalRoundTripTime:F.totalRoundTripTime,bytesReceived:F.bytesReceived,bytesSent:F.bytesSent,availableOutgoingBitrate:F.availableOutgoingBitrate,availableIncomingBitrate:F.availableIncomingBitrate,lastPacketReceivedTimestamp:F.lastPacketReceivedTimestamp,lastPacketSentTimestamp:F.lastPacketSentTimestamp,localCandidateId:F.localCandidateId,remoteCandidateId:F.remoteCandidateId,bytesDiscardedOnSend:F.bytesDiscardedOnSend,packetsSent:F.packetsSent,packetsReceived:F.packetsReceived,packetsDiscardedOnSend:F.packetsDiscardedOnSend};f.push(ke),(A.nominated===!0||A.selected===!0)&&(d.candidatePair=ke);break}case"transport":{const E=A;a&&(a.producing&&(this.overallProducingTransportsStatsMap[a.id]||(this.overallProducingTransportsStatsMap[a.id]={totalPacketsSent:0})),a.consuming&&(this.overallConsumingTransportsStatsMap[a.id]||(this.overallConsumingTransportsStatsMap[a.id]={totalPacketsReceived:0})));const w={bytesReceived:E.bytesReceived,bytesSent:E.bytesSent,packetsSent:E.packetsSent,packetsReceived:E.packetsReceived,dtlsCipher:E.dtlsCipher,dtlsState:E.dtlsState,iceRole:E.iceRole};if(d.transport=w,a){if(a.producing){const F=this.overallProducingTransportsStatsMap[a.id];this.processProducingTransportStats(a.id,F,w)}if(a.consuming){const F=this.overallConsumingTransportsStatsMap[a.id];this.processConsumingTransportStats(a.id,F,w)}}break}case"remote-inbound-rtp":{const E=A,w={jitter:E.jitter,fractionLost:E.fractionLost,roundTripTime:E.roundTripTime,roundTripTimeMeasurements:E.roundTripTimeMeasurements,totalRoundTripTime:E.totalRoundTripTime,packetsLost:E.packetsLost};d.remoteInboundRtp.set(E.localId,w);break}case"outbound-rtp":{const E=A,w=i||this.outboundProducerMap.get(A.id),F=this.pausedProducerMap.get(w);if(F){if(F.lastReportCalculated===!0)break;this.pausedProducerMap.set(w,{lastReportCalculated:!0})}this.overallProducersStatsMap[w]||(this.overallProducersStatsMap[w]={totalVideoPacketsSent:0,totalAudioPacketsSent:0});const ke=this.overallProducersStatsMap[w];if(["video","audio"].includes(E.mediaType)||["video","audio"].includes(E.kind)){if(!this.outboundProducerMap.has(A.id)){d.staleProducerStreamMap=!0;break}const je=this.callStatsInstance.producers.get(w);if(((b=je==null?void 0:je.track)==null?void 0:b.readyState)==="ended")break;d.producerStreamMap.has(w)||d.producerStreamMap.set(w,{outboundVideoRtpId:[],outboundAudioRtpId:[]});const V={bytesSent:E.bytesSent,packetsSent:E.packetsSent,nackCount:E.nackCount,ssrc:E.ssrc,mid:E.mid,active:E.active,codecId:E.codecId,headerBytesSent:E.headerBytesSent||0,totalPacketSendDelay:E.totalPacketSendDelay||0};if(E.mediaType==="video"||E.kind==="video"){const C=E,Ye={frameHeight:C.frameHeight,frameWidth:C.frameWidth,framesEncoded:C.framesEncoded,framesDropped:C.framesDropped,framesPerSecond:C.framesPerSecond,framesSent:C.framesSent,keyFramesEncoded:C.keyFramesEncoded,firCount:C.firCount,encoderImplementation:C.encoderImplementation,hugeFramesSent:C.hugeFramesSent,pliCount:C.pliCount,qpSum:C.qpSum,qualityLimitationDurations:C.qualityLimitationDurations,qualityLimitationReason:C.qualityLimitationReason,qualityLimitationResolutionChanges:C.qualityLimitationResolutionChanges,totalEncodeTime:C.targetBitrate,totalPacketSendDelay:C.totalPacketSendDelay,retransmittedBytesSent:C.retransmittedBytesSent,retransmittedPacketsSent:C.retransmittedPacketsSent,scalabilityMode:C.scalabilityMode,powerEfficientEncoder:C.powerEfficientEncoder,...V};d.outboundVideoRtp.set(A.id,Ye),d.producerStreamMap.get(w).outboundVideoRtpId.push(A.id),this.processOutboundProducerVideoStats(w,ke,Ye)}else if(E.mediaType==="audio"||E.kind==="audio"){const C=E,Ye={retransmittedBytesSent:C.retransmittedBytesSent,retransmittedPacketsSent:C.retransmittedPacketsSent,...V};d.outboundAudioRtp.set(A.id,Ye),d.producerStreamMap.get(w).outboundAudioRtpId.push(A.id),this.processOutboundProducerAudioStats(w,ke,Ye)}}else this.callStatsInstance.logger.error(`Callstats: Unknown Outbound-rtp. mediatype: ${E.mediaType} kind: ${E.kind}`);break}case"inbound-rtp":{const E=A,w=i||this.inboundConsumerMap.get(A.id),F=this.pausedConsumerMap.get(w);if(F){if(F.lastReportCalculated===!0)break;this.pausedConsumerMap.set(w,{lastReportCalculated:!0})}if(E.ssrc===1234)break;this.overallConsumersStatsMap[w]||(this.overallConsumersStatsMap[w]={totalVideoPacketsReceived:0,totalAudioPacketsReceived:0});const ke=this.overallConsumersStatsMap[w];if(["video","audio"].includes(E.mediaType)||["video","audio"].includes(E.kind)){if(!this.inboundConsumerMap.has(A.id)){d.staleConsumerStreamMap=!0;break}d.consumerStreamMap.has(w)||d.consumerStreamMap.set(w,{inboundVideoRtpId:[],inboundAudioRtpId:[]});const je={bytesReceived:E.bytesReceived,packetsReceived:E.packetsReceived,packetsLost:E.packetsLost>=0?E.packetsLost:0,jitter:E.jitter,nackCount:E.nackCount,jitterBufferDelay:E.jitterBufferDelay,jitterBufferEmittedCount:E.jitterBufferEmittedCount,lastPacketReceivedTimestamp:E.lastPacketReceivedTimestamp,ssrc:E.ssrc,mid:E.mid,codecId:E.codecId,headerBytesReceived:E.headerBytesReceived||0,packetsDiscarded:E.packetsDiscarded||0,jitterBufferMinimumDelay:E.jitterBufferMinimumDelay||0,jitterBufferTargetDelay:E.jitterBufferTargetDelay||0};if(E.mediaType==="video"||E.kind==="video"){const V=E,C={frameHeight:V.frameHeight,frameWidth:V.frameWidth,framesDecoded:V.framesDecoded,framesDropped:V.framesDropped,framesPerSecond:V.framesPerSecond,framesReceived:V.framesReceived,keyFramesDecoded:V.keyFramesDecoded,firCount:V.firCount,decoderImplementation:V.decoderImplementation,pliCount:V.pliCount,totalProcessingDelay:V.totalProcessingDelay,qpSum:V.qpSum||0,totalAssemblyTime:V.totalAssemblyTime||0,totalDecodeTime:V.totalDecodeTime||0,totalFreezesDuration:V.totalFreezesDuration||0,totalInterFrameDelay:V.totalInterFrameDelay||0,totalPausesDuration:V.totalPausesDuration||0,totalSquaredInterFrameDelay:V.totalSquaredInterFrameDelay||0,freezeCount:V.freezeCount||0,pauseCount:V.pauseCount||0,powerEfficientDecoder:V.powerEfficientDecoder,...je};C.score=Bp({frameWidth:C.frameWidth||0,framesDecoded:(C.framesDecoded||0)-(((I=this.videoConsumerToStatsMap.get(w))==null?void 0:I.framesDecoded)||0),framesPerSecond:C.framesPerSecond||0,packetsLost:(C.packetsLost||0)-(((x=this.videoConsumerToStatsMap.get(w))==null?void 0:x.packetsLost)||0),packetsReceived:(C.packetsReceived||0)-(((B=this.videoConsumerToStatsMap.get(w))==null?void 0:B.packetsReceived)||0),jitter:C.jitter||0,isScreenShare:this.screenShareConsumers.has(w)}),_.set(w,{score:+(C.score*10).toFixed(),frameWidth:C.frameWidth||0,frameHeight:C.frameHeight||0,framesPerSecond:C.framesPerSecond||0,packetsLostPercentage:Vc({packetsLost:(C.packetsLost||0)-(((H=this.videoConsumerToStatsMap.get(w))==null?void 0:H.packetsLost)||0),packetsReceived:(C.packetsReceived||0)-(((M=this.videoConsumerToStatsMap.get(w))==null?void 0:M.packetsReceived)||0)}),jitter:C.jitter||0,isScreenShare:this.screenShareConsumers.has(w),bitrate:((C.bytesReceived||0)-(((z=this.videoConsumerToStatsMap.get(w))==null?void 0:z.bytesReceived)||0))*8/7}),this.videoConsumerToStatsMap.set(w,C),d.inboundVideoRtp.set(A.id,C),d.consumerStreamMap.get(w).inboundVideoRtpId.push(A.id),this.processInboundConsumerVideoStats(w,ke,C)}else if(E.mediaType==="audio"||E.kind==="audio"){const V=E,C={audioLevel:V.audioLevel,concealedSamples:V.concealedSamples,concealmentEvents:V.concealmentEvents,totalAudioEnergy:V.totalAudioEnergy,totalSamplesDuration:V.totalSamplesDuration,totalSamplesReceived:V.totalSamplesReceived,fecPacketsDiscarded:V.fecPacketsDiscarded||0,fecPacketsReceived:V.fecPacketsReceived||0,insertedSamplesForDeceleration:V.insertedSamplesForDeceleration||0,removedSamplesForAcceleration:V.removedSamplesForAcceleration||0,silentConcealedSamples:V.silentConcealedSamples||0,playoutId:V.playoutId,...je};C.score=Fp({concealmentEvents:(C.concealmentEvents||0)-(((ne=this.audioConsumerToStatsMap.get(w))==null?void 0:ne.concealmentEvents)||0),packetsLost:(C.packetsLost||0)-(((ue=this.audioConsumerToStatsMap.get(w))==null?void 0:ue.packetsLost)||0),packetsReceived:(C.packetsReceived||0)-(((ze=this.audioConsumerToStatsMap.get(w))==null?void 0:ze.packetsReceived)||0),jitter:C.jitter||0}),_.set(w,{score:+(C.score*10).toFixed(),packetsLostPercentage:Vc({packetsLost:(C.packetsLost||0)-(((Qt=this.audioConsumerToStatsMap.get(w))==null?void 0:Qt.packetsLost)||0),packetsReceived:(C.packetsReceived||0)-(((Oe=this.audioConsumerToStatsMap.get(w))==null?void 0:Oe.packetsReceived)||0)}),jitter:C.jitter||0,isScreenShare:this.screenShareConsumers.has(w),bitrate:((C.bytesReceived||0)-(((Ot=this.audioConsumerToStatsMap.get(w))==null?void 0:Ot.bytesReceived)||0))*8/7}),this.audioConsumerToStatsMap.set(w,C),d.inboundAudioRtp.set(A.id,C),d.consumerStreamMap.get(w).inboundAudioRtpId.push(A.id),this.processInboundConsumerAudioStats(w,ke,C)}}else this.callStatsInstance.logger.error(`Callstats: Unknown Inbound-rtp. mediatype: ${E.mediaType} kind: ${E.kind}`);break}}}if(d.producerStreamMap.forEach((A,E)=>{var w,F,ke,je,V,C,Ye,vr,vc,yc,Tc,Sc,Ec,_c,bc,wc,Pc,Cc,Rc,kc,Ic,Ac,Mc;if(A.outboundVideoRtpId.length>0){const ye=[];A.outboundVideoRtpId.forEach(ep=>{ye.push(d.outboundVideoRtp.get(ep))});const ie=this.getWorkingSimulcastVideoStats(ye);ie.score=Vp({frameWidth:ie.frameWidth||0,framesPerSecond:ie.framesPerSecond||0,jitter:((w=ie.remoteData)==null?void 0:w.jitter)||0,isScreenShare:this.screenShareProducers.has(E),packetsSent:(ie.packetsSent||0)-(((F=this.videoProducerToStatsMap.get(E))==null?void 0:F.packetsSent)||0),packetsLost:(((ke=ie.remoteData)==null?void 0:ke.packetsLost)||0)-(((V=(je=this.videoProducerToStatsMap.get(E))==null?void 0:je.remoteData)==null?void 0:V.packetsLost)||0),framesEncoded:(ie.framesEncoded||0)-(((C=this.videoProducerToStatsMap.get(E))==null?void 0:C.framesEncoded)||0)}),y.set(E,{score:+(ie.score*10).toFixed(),frameWidth:ie.frameWidth||0,frameHeight:ie.frameHeight||0,framesPerSecond:ie.framesPerSecond||0,jitter:((Ye=ie.remoteData)==null?void 0:Ye.jitter)||0,isScreenShare:this.screenShareProducers.has(E),packetsLostPercentage:xc({packetsSent:(ie.packetsSent||0)-(((vr=this.videoProducerToStatsMap.get(E))==null?void 0:vr.packetsSent)||0),packetsLost:(((vc=ie.remoteData)==null?void 0:vc.packetsLost)||0)-(((Tc=(yc=this.videoProducerToStatsMap.get(E))==null?void 0:yc.remoteData)==null?void 0:Tc.packetsLost)||0)}),bitrate:((ie.bytesSent||0)-(((Sc=this.videoProducerToStatsMap.get(E))==null?void 0:Sc.bytesSent)||0))*8/7,cpuLimitations:ie.qualityLimitationReason==="cpu",bandwidthLimitations:ie.qualityLimitationReason==="bandwidth"}),this.videoProducerToStatsMap.set(E,ie)}else if(A.outboundAudioRtpId.length>0){const ye=d.outboundAudioRtp.get(A.outboundAudioRtpId[0]);ye.score=xp({packetsSent:(ye.packetsSent||0)-(((Ec=this.audioProducerToStatsMap.get(E))==null?void 0:Ec.packetsSent)||0),packetsLost:(((_c=ye.remoteData)==null?void 0:_c.packetsLost)||0)-(((wc=(bc=this.audioProducerToStatsMap.get(E))==null?void 0:bc.remoteData)==null?void 0:wc.packetsLost)||0),jitter:((Pc=ye.remoteData)==null?void 0:Pc.jitter)||0}),y.set(E,{score:+(ye.score*10).toFixed(),bitrate:((ye.bytesSent||0)-(((Cc=this.audioProducerToStatsMap.get(E))==null?void 0:Cc.bytesSent)||0))*8/7,packetsLostPercentage:xc({packetsSent:(ye.packetsSent||0)-(((Rc=this.audioProducerToStatsMap.get(E))==null?void 0:Rc.packetsSent)||0),packetsLost:(((kc=ye.remoteData)==null?void 0:kc.packetsLost)||0)-(((Ac=(Ic=this.audioProducerToStatsMap.get(E))==null?void 0:Ic.remoteData)==null?void 0:Ac.packetsLost)||0)}),jitter:((Mc=ye.remoteData)==null?void 0:Mc.jitter)||0,isScreenShare:this.screenShareProducers.has(E)}),this.audioProducerToStatsMap.set(E,ye)}}),f.forEach(A=>{const E=h.find(F=>F.id===A.localCandidateId?(A.localCandidateId=F.id,F):null),w=p.find(F=>F.id===A.remoteCandidateId?(A.remoteCandidateId=F.id,F):null);E&&(A.localCandidateType=E.type,A.localCandidateAddress=yr(E.address),A.localCandidatePort=E.port,A.localCandidateProtocol=E.protocol,A.localCandidateUrl=E.url,A.localCandidateNetworkType=E.networkType,A.localCandidateRelatedAddress=yr(E.relatedAddress),A.localCandidateRelatedPort=E.relatedPort),w&&(A.remoteCandidateType=w.type,A.remoteCandidateAddress=yr(w.address),A.remoteCandidatePort=w.port,A.remoteCandidateProtocol=w.protocol,A.remoteCandidateUrl=w.url)}),d.candidatePair&&(d.transport?(d.transport.totalRoundTripTime=d.candidatePair.totalRoundTripTime,d.transport.availableOutgoingBitrate=d.candidatePair.availableOutgoingBitrate,d.transport.availableIncomingBitrate=d.candidatePair.availableIncomingBitrate,d.transport.roundTripTime=d.candidatePair.currentRoundTripTime):d.transport={bytesReceived:d.candidatePair.bytesReceived,bytesSent:d.candidatePair.bytesSent,totalRoundTripTime:d.candidatePair.totalRoundTripTime,availableOutgoingBitrate:d.candidatePair.availableOutgoingBitrate,availableIncomingBitrate:d.candidatePair.availableIncomingBitrate,roundTripTime:d.candidatePair.currentRoundTripTime}),d.transport&&(d.transport.candidatePairs=f),d.transport&&!d.transport.roundTripTime){let A=0,E=0;d.remoteInboundRtp.forEach((w,F)=>{w.roundTripTime&&w.roundTripTime>A&&(A=w.roundTripTime,E=w.totalRoundTripTime)}),d.transport.roundTripTime=A,d.transport.totalRoundTripTime=E}if(_.size>0)try{this.observer.emit("consumer_score",_)}catch(A){}if(y.size>0)try{this.observer.emit("producer_score",y)}catch(A){}return d}async getProducersReport(t){const r=t.map(n=>this.generateProducerStreamMap(n,!0));return r.length>0?Promise.all(r):void 0}async getConsumersReport(t){const r=t.map(n=>this.generateConsumerStreamMap(n,!0));return r.length>0?Promise.all(r):void 0}async getTransportReport(t){return t.getStats()}async getProcessedStats(t,r,n){const i=await this.getTransportReport(t),a={producing:n,consuming:r,id:t.id},c=i,d=this.parseRTCReport(c,["transport","candidate-pair","inbound-rtp","outbound-rtp","remote-inbound-rtp","local-candidate","remote-candidate"],!1,void 0,a);if(!d)return;const l={stats:d.transport,transportId:t.id,consuming:r,producing:n},h=d.staleProducerStreamMap?void 0:this.getProducerStatsFromReport(d),p=d.staleConsumerStreamMap?void 0:this.getConsumerStatsFromReport(d);return{transportReport:l,producerReport:h,consumerReport:p}}getProducerStatsFromReport(t){const r=[];try{t.producerStreamMap.forEach((n,i)=>{var a,c;r.push({producerId:i,videoStats:n.outboundVideoRtpId.map(d=>t.outboundVideoRtp.get(d)),audioStats:n.outboundAudioRtpId.map(d=>t.outboundAudioRtp.get(d)),appData:((c=(a=this.callStatsInstance.producers)==null?void 0:a.get(i))==null?void 0:c.appData)||null})})}catch(n){this.callStatsInstance.logger.error("callStats::measurements::getProducerStatsFromReport",{error:{reason:n.reason,message:n.message}})}return r}getConsumerStatsFromReport(t){const r=[];try{t.consumerStreamMap.forEach((n,i)=>{const{peerId:a,producerId:c,appData:d}=this.consumerPeerIdMap.get(i);r.push({consumerId:i,peerId:a,producerId:c,appData:d,videoStats:n.inboundVideoRtpId.map(l=>t.inboundVideoRtp.get(l)),audioStats:n.inboundAudioRtpId.map(l=>t.inboundAudioRtp.get(l))})})}catch(n){console.error("getConsumersReport: ",n,t)}return r}async getUserLocation(){return new Promise((t,r)=>{try{navigator.geolocation?navigator.geolocation.getCurrentPosition(n=>{t(n)}):r()}catch(n){r(n)}})}async getConnectivity(t){try{const r={iceServers:t||Hp},n=new Promise((h,p)=>{try{const f=new hT(r);f.addListener("done",h),f.addListener("failed",()=>{h({connectivity:!1})}),f.start(2e3)}catch(f){p(f)}}),i=new Promise((h,p)=>{try{const f=new pT(r);f.addListener("done",h),f.addListener("failed",()=>{h({connectivity:!1})}),f.start(2e3)}catch(f){p(f)}}),a=new Promise((h,p)=>{try{const f=new mT(r);f.addListener("done",h),f.addListener("failed",()=>{h({connectivity:!1})}),f.start(2e3)}catch(f){p(f)}}),[c,d,l]=await Promise.all([n,i,a]);return{host:c==null?void 0:c.connectivity,relay:d==null?void 0:d.connectivity,reflexive:l==null?void 0:l.connectivity}}catch(r){return{host:!1,relay:!1,reflexive:!1}}}async getThroughput(t){try{const n=await new Promise((i,a)=>{try{const c={iceServers:t||Hp},d=new uT(c);d.addListener("done",i),d.addListener("failed",a),d.start(1e4)}catch(c){a(c)}});return{throughput:n.throughput,fractionalLoss:0,RTT:n.RTT,jitter:0,backendRTT:n.backendRTT}}catch(r){return}}async getIPDetails(){var t,r;try{return this.ipDetails||(this.ipDetails=await zl.getIPDetails({peerId:(t=this.callStatsInstance)==null?void 0:t.peerId,apiHostnames:(r=this.callStatsInstance)==null?void 0:r.apiHostnames,logger:this.callStatsInstance.logger})),this.ipDetails}catch(n){return}}async getNetworkQuality(t){const[r,n]=await Promise.all([this.getConnectivity(t),this.getThroughput(t)]);return{connectivity:r,throughput:n==null?void 0:n.throughput,fractionalLoss:n==null?void 0:n.fractionalLoss,RTT:n==null?void 0:n.RTT,jitter:n==null?void 0:n.jitter,backendRTT:n==null?void 0:n.backendRTT}}async getNetworkInfo(t,r=!1){var c,d;if(r){const l=await this.getIPDetails();return{ipDetails:l,effectiveNetworkType:(c=navigator.connection)==null?void 0:c.effectiveType,location:l!=null&&l.loc?qp(l==null?void 0:l.loc):void 0}}const[n,i,a]=await Promise.all([this.getConnectivity(t),this.getThroughput(t),this.getIPDetails()]);return{ipDetails:a,effectiveNetworkType:(d=navigator.connection)==null?void 0:d.effectiveType,location:a!=null&&a.loc?qp(a==null?void 0:a.loc):void 0,turnConnectivity:n?n.host||n.relay||n.reflexive:!1,connectivity:n,throughput:i==null?void 0:i.throughput,fractionalLoss:i==null?void 0:i.fractionalLoss,RTT:i==null?void 0:i.RTT,jitter:i==null?void 0:i.jitter,backendRTT:i==null?void 0:i.backendRTT}}}class gT extends Gp{}class Wp extends Gp{constructor(){super(...arguments);m(this,"producerMap",new Map);m(this,"consumerMap",new Map)}async registerProducer(t){this.producerMap.set(t.id,t),await this.generateProducerStreamMap(t),t.on("close",this.deregisterProducer.bind(this,t)),t.on("pause",this.pauseProducer.bind(this,t.id)),t.on("resume",this.resumeProducer.bind(this,t.id)),t.appData.screenShare===!0&&this.screenShareProducers.add(t.id)}async registerConsumer(t){this.consumerMap.set(t.id,t),await this.generateConsumerStreamMap(t),this.consumerPeerIdMap.set(t.id,{producerId:t.producerId,peerId:t.appData.peerId,appData:t.appData}),t.on("close",this.deregisterConsumer.bind(this,t)),t.on("pause",this.pauseConsumer.bind(this,t.id)),t.on("resume",this.resumeConsumer.bind(this,t.id)),t.appData.screenShare===!0&&this.screenShareConsumers.add(t.id)}async generateConsumerStreamMap(t,r=!1){const n=await t.getStats(),i=this.parseRTCReport(n,["inbound-rtp"],!1,t.id),a=[...i.consumerStreamMap.values()][0],c=r?this.getConsumerStatsFromParsedConsumerStats(i,a,t.id):void 0;for(const d of n.values())switch(d.type){case"inbound-rtp":{this.inboundConsumerMap.set(d.id,t.id);break}}return c}deregisterProducer(t){this.producerMap.delete(t.id),this.outboundProducerMap.forEach((r,n)=>{r===t.id&&this.outboundProducerMap.delete(n)}),this.pausedProducerMap.delete(t.id),this.screenShareProducers.delete(t.id)}deregisterConsumer(t){this.consumerMap.delete(t.id),this.inboundConsumerMap.forEach((r,n)=>{r===t.id&&this.inboundConsumerMap.delete(n)}),this.consumerPeerIdMap.delete(t.id),this.pausedConsumerMap.delete(t.id),this.screenShareConsumers.delete(t.id)}getIceCandidateStats(t){var r;return{id:t.id,type:t.candidateType||t.type,address:t.address,port:t.port,url:t.url,protocol:(r=t.relayProtocol)!=null?r:t.protocol,networkType:t.networkType,relatedAddress:t.relatedAddress,relatedPort:t.relatedPort}}parseRTCReport(t,r=[],n=!1,i=void 0,a=void 0){var b,I,x,B,H,M,z,ne,ue,ze,Qt,Oe,Ot;const c=t,d=new jp,l=r.length?new Set(r):void 0,h=[],p=[],f=[],y=new Map,_=new Map;for(const A of c.values()){if(l){if(l.size===0)break;if(l.has(A.type))n&&l.delete(A.type);else continue}switch(A.type){case"local-candidate":{h.push(this.getIceCandidateStats(A));break}case"remote-candidate":{p.push(this.getIceCandidateStats(A));break}case"candidate-pair":{const{nominated:E}=A,{selected:w}=A,F=A,ke={nominated:E!=null?E:w,currentRoundTripTime:F.currentRoundTripTime,totalRoundTripTime:F.totalRoundTripTime,bytesReceived:F.bytesReceived,bytesSent:F.bytesSent,availableOutgoingBitrate:F.availableOutgoingBitrate,availableIncomingBitrate:F.availableIncomingBitrate,lastPacketReceivedTimestamp:F.lastPacketReceivedTimestamp,lastPacketSentTimestamp:F.lastPacketSentTimestamp,localCandidateId:F.localCandidateId,remoteCandidateId:F.remoteCandidateId,bytesDiscardedOnSend:F.bytesDiscardedOnSend,packetsSent:F.packetsSent,packetsReceived:F.packetsReceived,packetsDiscardedOnSend:F.packetsDiscardedOnSend};f.push(ke),(A.nominated===!0||A.selected===!0)&&(d.candidatePair=ke);break}case"transport":{const E=A;a&&(a.producing&&(this.overallProducingTransportsStatsMap[a.id]||(this.overallProducingTransportsStatsMap[a.id]={totalPacketsSent:0})),a.consuming&&(this.overallConsumingTransportsStatsMap[a.id]||(this.overallConsumingTransportsStatsMap[a.id]={totalPacketsReceived:0})));const w={bytesReceived:E.bytesReceived,bytesSent:E.bytesSent,packetsSent:E.packetsSent,packetsReceived:E.packetsReceived,dtlsCipher:E.dtlsCipher,dtlsState:E.dtlsState,iceRole:E.iceRole};if(d.transport=w,a){if(a.producing){const F=this.overallProducingTransportsStatsMap[a.id];this.processProducingTransportStats(a.id,F,w)}if(a.consuming){const F=this.overallConsumingTransportsStatsMap[a.id];this.processConsumingTransportStats(a.id,F,w)}}break}case"remote-inbound-rtp":{const E=A,w={jitter:E.jitter,fractionLost:E.fractionLost,roundTripTime:E.roundTripTime,roundTripTimeMeasurements:E.roundTripTimeMeasurements,totalRoundTripTime:E.totalRoundTripTime,packetsLost:E.packetsLost};d.remoteInboundRtp.set(E.localId,w);break}case"outbound-rtp":{const E=A,w=i||this.outboundProducerMap.get(A.id),F=this.pausedProducerMap.get(w);if(F){if(F.lastReportCalculated===!0)break;this.pausedProducerMap.set(w,{lastReportCalculated:!0})}this.overallProducersStatsMap[w]||(this.overallProducersStatsMap[w]={totalVideoPacketsSent:0,totalAudioPacketsSent:0});const ke=this.overallProducersStatsMap[w];if(["video","audio"].includes(E.mediaType)||["video","audio"].includes(E.kind)){if(!this.outboundProducerMap.has(A.id)){d.staleProducerStreamMap=!0;break}const je=this.callStatsInstance.producers.get(w);if(((b=je==null?void 0:je.track)==null?void 0:b.readyState)==="ended")break;d.producerStreamMap.has(w)||d.producerStreamMap.set(w,{outboundVideoRtpId:[],outboundAudioRtpId:[]});const V={bytesSent:E.bytesSent,packetsSent:E.packetsSent,nackCount:E.nackCount,ssrc:E.ssrc,mid:E.mid,active:E.active,codecId:E.codecId,headerBytesSent:E.headerBytesSent||0,totalPacketSendDelay:E.totalPacketSendDelay||0};if(E.mediaType==="video"||E.kind==="video"){const C=E,Ye={frameHeight:C.frameHeight,frameWidth:C.frameWidth,framesEncoded:C.framesEncoded,framesDropped:C.framesDropped?C.framesDropped:C.droppedFrames,framesPerSecond:C.framesPerSecond?C.framesPerSecond:C.framerateMean,framesSent:C.framesSent,keyFramesEncoded:C.keyFramesEncoded,firCount:C.firCount,encoderImplementation:C.encoderImplementation,hugeFramesSent:C.hugeFramesSent,pliCount:C.pliCount,qpSum:C.qpSum,qualityLimitationReason:C.qualityLimitationReason,qualityLimitationDurations:C.qualityLimitationDurations,qualityLimitationResolutionChanges:C.qualityLimitationResolutionChanges,totalEncodeTime:C.totalEncodeTime,totalPacketSendDelay:C.totalEncodeTime,retransmittedBytesSent:C.retransmittedBytesSent,retransmittedPacketsSent:C.retransmittedPacketsSent,scalabilityMode:C.scalabilityMode,powerEfficientEncoder:C.powerEfficientEncoder,...V};d.outboundVideoRtp.set(A.id,Ye),d.producerStreamMap.get(w).outboundVideoRtpId.push(A.id),this.processOutboundProducerVideoStats(w,ke,Ye)}else if(E.mediaType==="audio"||E.kind==="audio"){const C=E,Ye={retransmittedBytesSent:C.retransmittedBytesSent,retransmittedPacketsSent:C.retransmittedPacketsSent,...V};d.outboundAudioRtp.set(A.id,Ye),d.producerStreamMap.get(w).outboundAudioRtpId.push(A.id),this.processOutboundProducerAudioStats(w,ke,Ye)}}else this.callStatsInstance.logger.error(`Callstats: Unknown Outbound-rtp. mediatype: ${E.mediaType} kind: ${E.kind}`);break}case"inbound-rtp":{const E=A,w=i||this.inboundConsumerMap.get(A.id),F=this.pausedConsumerMap.get(w);if(F){if(F.lastReportCalculated===!0)break;this.pausedConsumerMap.set(w,{lastReportCalculated:!0})}if(E.ssrc===1234)break;this.overallConsumersStatsMap[w]||(this.overallConsumersStatsMap[w]={totalVideoPacketsReceived:0,totalAudioPacketsReceived:0});const ke=this.overallConsumersStatsMap[w];if(["video","audio"].includes(E.mediaType)||["video","audio"].includes(E.kind)){if(!this.inboundConsumerMap.has(A.id)){d.staleConsumerStreamMap=!0;break}d.consumerStreamMap.has(w)||d.consumerStreamMap.set(w,{inboundVideoRtpId:[],inboundAudioRtpId:[]});const je={bytesReceived:E.bytesReceived,packetsReceived:E.packetsReceived,packetsLost:E.packetsLost>=0?E.packetsLost:0,jitter:E.jitter,nackCount:E.nackCount,jitterBufferDelay:E.jitterBufferDelay,jitterBufferEmittedCount:E.jitterBufferEmittedCount,lastPacketReceivedTimestamp:E.lastPacketReceivedTimestamp,ssrc:E.ssrc,mid:E.mid,codecId:E.codecId,headerBytesReceived:E.headerBytesReceived||0,packetsDiscarded:E.packetsDiscarded||0,jitterBufferMinimumDelay:E.jitterBufferMinimumDelay||0,jitterBufferTargetDelay:E.jitterBufferTargetDelay||0};if(E.mediaType==="video"||E.kind==="video"){const V=E,C={frameHeight:V.frameHeight,frameWidth:V.frameWidth,framesDecoded:V.framesDecoded,framesDropped:V.framesDropped?V.framesDropped:V.droppedFrames,framesPerSecond:V.framesPerSecond?V.framesPerSecond:V.framerateMean,framesReceived:V.framesReceived,keyFramesDecoded:V.keyFramesDecoded,firCount:V.firCount,decoderImplementation:V.decoderImplementation,pliCount:V.pliCount,totalProcessingDelay:V.totalProcessingDelay,qpSum:V.qpSum||0,totalAssemblyTime:V.totalAssemblyTime||0,totalDecodeTime:V.totalDecodeTime||0,totalFreezesDuration:V.totalFreezesDuration||0,totalInterFrameDelay:V.totalInterFrameDelay||0,totalPausesDuration:V.totalPausesDuration||0,totalSquaredInterFrameDelay:V.totalSquaredInterFrameDelay||0,freezeCount:V.freezeCount||0,pauseCount:V.pauseCount||0,powerEfficientDecoder:V.powerEfficientDecoder,...je};C.score=Bp({frameWidth:C.frameWidth||0,framesDecoded:(C.framesDecoded||0)-(((I=this.videoConsumerToStatsMap.get(w))==null?void 0:I.framesDecoded)||0),framesPerSecond:C.framesPerSecond||0,packetsLost:(C.packetsLost||0)-(((x=this.videoConsumerToStatsMap.get(w))==null?void 0:x.packetsLost)||0),packetsReceived:(C.packetsReceived||0)-(((B=this.videoConsumerToStatsMap.get(w))==null?void 0:B.packetsReceived)||0),jitter:C.jitter||0,isScreenShare:this.screenShareConsumers.has(w)}),_.set(w,{score:+(C.score*10).toFixed(),frameWidth:C.frameWidth||0,frameHeight:C.frameHeight||0,framesPerSecond:C.framesPerSecond||0,packetsLostPercentage:Vc({packetsLost:(C.packetsLost||0)-(((H=this.videoConsumerToStatsMap.get(w))==null?void 0:H.packetsLost)||0),packetsReceived:(C.packetsReceived||0)-(((M=this.videoConsumerToStatsMap.get(w))==null?void 0:M.packetsReceived)||0)}),jitter:C.jitter||0,isScreenShare:this.screenShareConsumers.has(w),bitrate:((C.bytesReceived||0)-(((z=this.videoConsumerToStatsMap.get(w))==null?void 0:z.bytesReceived)||0))*8/7}),this.videoConsumerToStatsMap.set(w,C),d.inboundVideoRtp.set(A.id,C),d.consumerStreamMap.get(w).inboundVideoRtpId.push(A.id),this.processInboundConsumerVideoStats(w,ke,C)}else if(E.mediaType==="audio"||E.kind==="audio"){const V=E,C={audioLevel:V.audioLevel,concealedSamples:V.concealedSamples,concealmentEvents:V.concealmentEvents,totalAudioEnergy:V.totalAudioEnergy,totalSamplesDuration:V.totalSamplesDuration,totalSamplesReceived:V.totalSamplesReceived,fecPacketsDiscarded:V.fecPacketsDiscarded||0,fecPacketsReceived:V.fecPacketsReceived||0,insertedSamplesForDeceleration:V.insertedSamplesForDeceleration||0,removedSamplesForAcceleration:V.removedSamplesForAcceleration||0,silentConcealedSamples:V.silentConcealedSamples||0,playoutId:V.playoutId,...je};C.score=Fp({concealmentEvents:(C.concealmentEvents||0)-(((ne=this.audioConsumerToStatsMap.get(w))==null?void 0:ne.concealmentEvents)||0),packetsLost:(C.packetsLost||0)-(((ue=this.audioConsumerToStatsMap.get(w))==null?void 0:ue.packetsLost)||0),packetsReceived:(C.packetsReceived||0)-(((ze=this.audioConsumerToStatsMap.get(w))==null?void 0:ze.packetsReceived)||0),jitter:C.jitter||0}),_.set(w,{score:+(C.score*10).toFixed(),packetsLostPercentage:Vc({packetsLost:(C.packetsLost||0)-(((Qt=this.audioConsumerToStatsMap.get(w))==null?void 0:Qt.packetsLost)||0),packetsReceived:(C.packetsReceived||0)-(((Oe=this.audioConsumerToStatsMap.get(w))==null?void 0:Oe.packetsReceived)||0)}),jitter:C.jitter||0,isScreenShare:this.screenShareConsumers.has(w),bitrate:((C.bytesReceived||0)-(((Ot=this.audioConsumerToStatsMap.get(w))==null?void 0:Ot.bytesReceived)||0))*8/7}),this.audioConsumerToStatsMap.set(w,C),d.inboundAudioRtp.set(A.id,C),d.consumerStreamMap.get(w).inboundAudioRtpId.push(A.id),this.processInboundConsumerAudioStats(w,ke,C)}}else this.callStatsInstance.logger.error(`Callstats: Unknown Inbound-rtp. mediatype: ${E.mediaType} kind: ${E.kind}`);break}}}if(d.producerStreamMap.forEach((A,E)=>{var w,F,ke,je,V,C,Ye,vr,vc,yc,Tc,Sc,Ec,_c,bc,wc,Pc,Cc,Rc,kc,Ic,Ac,Mc;if(A.outboundVideoRtpId.length>0){const ye=[];A.outboundVideoRtpId.forEach(ep=>{ye.push(d.outboundVideoRtp.get(ep))});const ie=this.getWorkingSimulcastVideoStats(ye);ie.score=Vp({frameWidth:ie.frameWidth||0,framesPerSecond:ie.framesPerSecond||0,jitter:((w=ie.remoteData)==null?void 0:w.jitter)||0,isScreenShare:this.screenShareProducers.has(E),packetsSent:(ie.packetsSent||0)-(((F=this.videoProducerToStatsMap.get(E))==null?void 0:F.packetsSent)||0),packetsLost:(((ke=ie.remoteData)==null?void 0:ke.packetsLost)||0)-(((V=(je=this.videoProducerToStatsMap.get(E))==null?void 0:je.remoteData)==null?void 0:V.packetsLost)||0),framesEncoded:(ie.framesEncoded||0)-(((C=this.videoProducerToStatsMap.get(E))==null?void 0:C.framesEncoded)||0)}),y.set(E,{score:+(ie.score*10).toFixed(),frameWidth:ie.frameWidth||0,frameHeight:ie.frameHeight||0,framesPerSecond:ie.framesPerSecond||0,jitter:((Ye=ie.remoteData)==null?void 0:Ye.jitter)||0,isScreenShare:this.screenShareProducers.has(E),packetsLostPercentage:xc({packetsSent:(ie.packetsSent||0)-(((vr=this.videoProducerToStatsMap.get(E))==null?void 0:vr.packetsSent)||0),packetsLost:(((vc=ie.remoteData)==null?void 0:vc.packetsLost)||0)-(((Tc=(yc=this.videoProducerToStatsMap.get(E))==null?void 0:yc.remoteData)==null?void 0:Tc.packetsLost)||0)}),bitrate:((ie.bytesSent||0)-(((Sc=this.videoProducerToStatsMap.get(E))==null?void 0:Sc.bytesSent)||0))*8/7,cpuLimitations:ie.qualityLimitationReason==="cpu",bandwidthLimitations:ie.qualityLimitationReason==="bandwidth"}),this.videoProducerToStatsMap.set(E,ie)}else if(A.outboundAudioRtpId.length>0){const ye=d.outboundAudioRtp.get(A.outboundAudioRtpId[0]);ye.score=xp({packetsSent:(ye.packetsSent||0)-(((Ec=this.audioProducerToStatsMap.get(E))==null?void 0:Ec.packetsSent)||0),packetsLost:(((_c=ye.remoteData)==null?void 0:_c.packetsLost)||0)-(((wc=(bc=this.audioProducerToStatsMap.get(E))==null?void 0:bc.remoteData)==null?void 0:wc.packetsLost)||0),jitter:((Pc=ye.remoteData)==null?void 0:Pc.jitter)||0}),y.set(E,{score:+(ye.score*10).toFixed(),bitrate:((ye.bytesSent||0)-(((Cc=this.audioProducerToStatsMap.get(E))==null?void 0:Cc.bytesSent)||0))*8/7,packetsLostPercentage:xc({packetsSent:(ye.packetsSent||0)-(((Rc=this.audioProducerToStatsMap.get(E))==null?void 0:Rc.packetsSent)||0),packetsLost:(((kc=ye.remoteData)==null?void 0:kc.packetsLost)||0)-(((Ac=(Ic=this.audioProducerToStatsMap.get(E))==null?void 0:Ic.remoteData)==null?void 0:Ac.packetsLost)||0)}),jitter:((Mc=ye.remoteData)==null?void 0:Mc.jitter)||0,isScreenShare:this.screenShareProducers.has(E)}),this.audioProducerToStatsMap.set(E,ye)}}),f.forEach(A=>{const E=h.find(F=>F.id===A.localCandidateId?(A.localCandidateId=F.id,F):null),w=p.find(F=>F.id===A.remoteCandidateId?(A.remoteCandidateId=F.id,F):null);E&&(A.localCandidateType=E.type,A.localCandidateAddress=yr(E.address),A.localCandidatePort=E.port,A.localCandidateProtocol=E.protocol,A.localCandidateUrl=E.url,A.localCandidateNetworkType=E.networkType,A.localCandidateRelatedAddress=yr(E.relatedAddress),A.localCandidateRelatedPort=E.relatedPort),w&&(A.remoteCandidateType=w.type,A.remoteCandidateAddress=yr(w.address),A.remoteCandidatePort=w.port,A.remoteCandidateProtocol=w.protocol,A.remoteCandidateUrl=w.url)}),d.candidatePair&&(d.transport?(d.transport.bytesReceived=d.candidatePair.bytesReceived,d.transport.bytesSent=d.candidatePair.bytesSent,d.transport.totalRoundTripTime=d.candidatePair.totalRoundTripTime,d.transport.availableOutgoingBitrate=d.candidatePair.availableOutgoingBitrate,d.transport.availableIncomingBitrate=d.candidatePair.availableIncomingBitrate,d.transport.roundTripTime=d.candidatePair.currentRoundTripTime):d.transport={bytesReceived:d.candidatePair.bytesReceived,bytesSent:d.candidatePair.bytesSent,totalRoundTripTime:d.candidatePair.totalRoundTripTime,availableOutgoingBitrate:d.candidatePair.availableOutgoingBitrate,availableIncomingBitrate:d.candidatePair.availableIncomingBitrate,roundTripTime:d.candidatePair.currentRoundTripTime}),d.transport&&(d.transport.candidatePairs=f),d.transport&&!d.transport.roundTripTime){let A=0,E=0;d.remoteInboundRtp.forEach((w,F)=>{w.roundTripTime&&w.roundTripTime>A&&(A=w.roundTripTime,E=w.totalRoundTripTime)}),d.transport.roundTripTime=A,d.transport.totalRoundTripTime=E}if(_.size>0)try{this.observer.emit("consumer_score",_)}catch(A){}if(y.size>0)try{this.observer.emit("producer_score",y)}catch(A){}return d}getProducerStatsFromReport(t){const r=[];try{t.producerStreamMap.forEach((n,i)=>{const a=this.producerMap.get(i),c=a.track.getSettings(),d=n.outboundVideoRtpId.map(h=>{const p=t.outboundVideoRtp.get(h);return p.frameHeight||(p.frameHeight=c.height,p.frameWidth=c.width,p.framesPerSecond=c.frameRate),p}),l={producerId:i,appData:a.appData,videoStats:d,audioStats:n.outboundAudioRtpId.map(h=>t.outboundAudioRtp.get(h))};r.push(l)})}catch(n){console.error("getProducersReport: ",n,t)}return r}getConsumerStatsFromParsedConsumerStats(t,r,n){let i;try{const{peerId:a,producerId:c,appData:d}=this.consumerPeerIdMap.get(n),l=r==null?void 0:r.inboundVideoRtpId.map(h=>{const f=this.consumerMap.get(n).track.getSettings(),y=t.inboundVideoRtp.get(h);return y.frameHeight||(y.frameHeight=f.height,y.frameWidth=f.width,y.framesPerSecond=f.frameRate),y});i={consumerId:n,peerId:a,producerId:c,appData:d,videoStats:l,audioStats:r==null?void 0:r.inboundAudioRtpId.map(h=>t.inboundAudioRtp.get(h))}}catch(a){console.error("getConsumerStatsFromParsedConsumerStats: ",a,t)}return i}getConsumerStatsFromReport(t){const r=[];try{t.consumerStreamMap.forEach((n,i)=>{r.push(this.getConsumerStatsFromParsedConsumerStats(t,n,i))})}catch(n){console.error("getConsumerStatsFromReport: ",n,t)}return r}}class vT extends Wp{}function $c(s,e,t,r){if(s!=null&&s.logger&&s.logger.error("Callstats::handleError",{error:r}),typeof t=="function"&&r instanceof e)t.call(null,r,s);else throw r}function Jp(s,e,t){const r=s.value;return s.value=function(...n){try{const i=r.apply(this,n);return i&&i instanceof Promise?i.catch(a=>{$c(this,e,t,a)}):i}catch(i){$c(this,e,t,i)}return null},s}const Z=(s,e)=>(t,r,n)=>{const i=n.value;return n.value=function(...a){try{const c=i.apply(this,a);return c&&c instanceof Promise?c.catch(d=>{$c(this,s,e,d)}):c}catch(c){$c(this,s,e,c)}return null},n},yT=(s,e)=>(t,r,n)=>{if(n)return Jp(n,s,e);for(const i of Reflect.ownKeys(t.prototype).filter(a=>a!=="constructor")){const a=Object.getOwnPropertyDescriptor(t.prototype,i);a.value instanceof Function&&Object.defineProperty(t.prototype,i,Jp(a,s,e))}};var Q=globalThis&&globalThis.__decorate||function(s,e,t,r){var n=arguments.length,i=n<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,t):r,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(s,e,t,r);else for(var c=s.length-1;c>=0;c--)(a=s[c])&&(i=(n<3?a(i):n>3?a(e,t,i):a(e,t))||i);return n>3&&i&&Object.defineProperty(e,t,i),i};const X=console;let K=class extends re{constructor(t="https://api.testingv3.dyte.in",r="Blink",n=Ha.PROD,i,a,c,d){super();m(this,"observer");m(this,"eventHandler");m(this,"measurements");m(this,"producingTransport");m(this,"consumingTransport");m(this,"producers",new Map);m(this,"consumers",new Map);m(this,"iceServers");m(this,"connectionInfoPromise");m(this,"pingStatsTimeout");m(this,"logger");m(this,"env");m(this,"apiHostnames");m(this,"peerId");m(this,"consumerSharedMediaStatesMap",new Map);m(this,"currentUserMediaStates",{});switch(this.env=n,this.apiHostnames=d,this.logger=a,this.peerId=c,this.eventHandler=new sT({logger:a,peerId:c,apiHostnames:d}),this.logger.debug("callStats::engineName: ",{engineName:r}),r){case"Blink":this.measurements=new gT;break;case"Gecko":this.measurements=new Wp;break;case"WebKit":this.measurements=new vT;break;default:throw Error(`Unknown engineName! ${r}`)}this.measurements.callStatsInstance=this,this.registerProducer=this.registerProducer.bind(this),this.registerConsumer=this.registerConsumer.bind(this),this.observer=new re,this.measurements.observer.on("consumer_score",l=>{a.debug(`callStats::consumer_score ${[...l.entries()]}`),this.eventHandler.emit("consumer_score",l)}),this.measurements.observer.on("producer_score",l=>{a.debug(`callStats::producer_score ${[...l.entries()]}`),this.eventHandler.emit("producer_score",l)})}registerIceServers(t){this.iceServers=t}registerConsumer(t){var r;this.consumerSharedMediaStatesMap.has(t.id)||this.consumerSharedMediaStatesMap.set(t.id,{}),this.consumers.set(t.id,t),this.measurements.registerConsumer(t),this.logger.debug("callStats::registerConsumer",{consumerId:t.id,consumerkind:t.kind,isScreenShare:!!((r=t.appData)!=null&&r.screenShare)}),t.on("close",this.deRegisterConsumer.bind(this,t))}registerProducer(t){var r;this.producers.set(t.id,t),this.measurements.registerProducer(t),this.logger.debug("callStats::registerProducer",{producerId:t.id,producerKind:t.kind,isScreenShare:!!((r=t.appData)!=null&&r.screenShare)}),t.on("close",this.deRegisterProducer.bind(this,t))}sendConsumerSharedMediaStateEvent(t,r){this.consumerSharedMediaStatesMap.has(t)||this.consumerSharedMediaStatesMap.set(t,{});const n=this.consumerSharedMediaStatesMap.get(t);this.consumerSharedMediaStatesMap.set(t,Object.assign(n,r))}registerProducingTransport(t){var n;this.producingTransport=t,t.observer.on("close",this.disconnectProducingTransport.bind(this,t)),t.observer.on("disconnect",this.disconnectProducingTransport.bind(this,t)),Array.from(((n=t._producers)==null?void 0:n.values())||[]).forEach(i=>{this.registerProducer(i)}),t.observer.on("newproducer",this.registerProducer)}registerConsumingTransport(t){var n;this.consumingTransport=t,t.observer.on("close",this.disconnectConsumingTransport.bind(this,t)),t.observer.on("disconnect",this.disconnectConsumingTransport.bind(this,t)),Array.from(((n=t._consumers)==null?void 0:n.values())||[]).forEach(i=>{this.registerConsumer(i)}),t.observer.on("newconsumer",this.registerConsumer)}deRegisterConsumer(t){this.consumers.delete(t.id)}deRegisterProducer(t){var r;this.producers.delete(t.id),this.logger.debug("callStats::deRegisterProducer",{producerId:t.id,producerKind:t.kind,isScreenShare:!!((r=t.appData)!=null&&r.screenShare)})}disconnectConsumingTransport(){this.consumingTransport=void 0}disconnectProducingTransport(){this.producingTransport=void 0}callEvent(t){this.eventHandler.callEvent(t)}sendPreCallTestBeginEvent(t=!1,r){this.connectionInfoPromise=this.measurements.getNetworkInfo(this.iceServers,t),this.eventHandler.callEvent({event:L.PRECALL_TEST_BEGIN,timestamp:r}),this.connectionInfoPromise&&this.connectionInfoPromise.then(n=>{this.eventHandler.callEvent({event:L.PRECALL_TEST_COMPLETE,metaData:{connectionInfo:n},timestamp:r})})}sendScreenShareToggleEvent(t,r=null,n){this.currentUserMediaStates.screen=t,this.eventHandler.callEvent({event:t?L.SCREENSHARE_STARTED:L.SCREENSHARE_STOPPED,metaData:{ssrc:r},timestamp:n})}sendScreenShareRequestedEvent(t){this.eventHandler.callEvent({event:L.SCREENSHARE_START_REQUESTED,timestamp:t})}sendActiveSpeakerEvent(t,r){this.eventHandler.callEvent({event:L.DOMINANT_SPEAKER,metaData:{peerId:t},timestamp:r})}devices(t,r,n){this.eventHandler.callEvent({event:t===Zt.AUDIO&&L.AUDIO_DEVICES_UPDATES||t===Zt.VIDEO&&L.VIDEO_DEVICES_UPDATES||t===Zt.SPEAKER&&L.SPEAKER_DEVICES_UPDATES,metaData:{deviceList:r},timestamp:n})}selectedDevice(t,r,n){this.eventHandler.callEvent({event:t===Zt.AUDIO&&L.SELECTED_MICROHPONE_UPDATE||t===Zt.VIDEO&&L.SELECTED_CAMERA_UPDATE||t===Zt.SPEAKER&&L.SELECTED_SPEAKER_UPDATE,metaData:{device:r},timestamp:n})}mediaPermission(t,r,n){this.eventHandler.callEvent({event:L.MEDIA_PERMISSION,metaData:{deviceType:t,permission:r},timestamp:n})}mediaPlaybackFailed(t,r){this.eventHandler.callEvent({event:t===Zt.AUDIO&&L.AUDIO_PLAY_FAILED||t===Zt.VIDEO&&L.VIDEO_PLAY_FAILED,metaData:{deviceType:t},timestamp:r})}mediaTrackMuted(t,r){this.eventHandler.callEvent({event:t===Zt.AUDIO&&L.AUDIO_TRACK_MUTED||t===Zt.VIDEO&&L.VIDEO_TRACK_MUTED,metaData:{deviceType:t},timestamp:r})}tabChanged(t,r){this.eventHandler.callEvent({event:L.TAB_CHANGE,metaData:{isMeetingsTabActive:t},timestamp:r})}browserBackgrounded(t){this.eventHandler.callEvent({event:L.BROWSER_BACKGROUNDED,timestamp:t})}browserForegrounded(t){this.eventHandler.callEvent({event:L.BROWSER_FOREGROUNDED,timestamp:t})}legacySwitch(t,r){this.eventHandler.callEvent({event:L.LEGACY_SWITCH,metadata:{on:t},timestamp:r})}async getPreCallTestResults(){return this.connectionInfoPromise}sendCallJoinBeginEvent(t,r){t={...t,meetingEnv:this.env},t.deviceInfo={...t.deviceInfo,userAgent:navigator.userAgent,cpus:navigator.hardwareConcurrency,memory:navigator.deviceMemory},this.eventHandler.callEvent({event:L.CALL_JOIN_BEGIN,metaData:{peerMetaData:t},timestamp:r})}sendNetworkQualityTestBeginEvent(t,r){this.eventHandler.callEvent({event:L.NET_QUALITY_TEST_BEGIN,timestamp:r}),new Promise(async(i,a)=>{const c=[];try{for(const d of t)try{if(d.iceServers&&d.iceServers.length>0){const l=await this.measurements.getNetworkQuality(d.iceServers);c.push({...d,networkResults:l})}}catch(l){console.warn("Error handling ",l)}i({regionData:c})}catch(d){console.warn("Error in callstats, ",d),a(d)}}).then(i=>{this.eventHandler.callEvent({event:L.NET_QUALITY_TEST_END,timestamp:r,metaData:i})})}sendWebSocketConnectedEvent(t){this.eventHandler.callEvent({event:L.WEBSOCKET_CONNECTED,timestamp:t})}sendTransportConnectedEvent(t){this.eventHandler.callEvent({event:L.TRANSPORT_CONNECTED,timestamp:t})}sendAudioToggleEvent(t,r){this.currentUserMediaStates.audio=t;let n;t?n=L.AUDIO_ON:n=L.AUDIO_OFF,this.eventHandler.callEvent({event:n,timestamp:r})}sendVideoToggleEvent(t,r){this.currentUserMediaStates.video=t;let n;t?n=L.VIDEO_ON:n=L.VIDEO_OFF,this.eventHandler.callEvent({event:n,timestamp:r})}sendParticipantRoleToggleEvent(t,r){this.eventHandler.callEvent({event:L.PARTICIPANT_ROLE,timestamp:r,metaData:t})}startPingStats(t=7e3){this.sendPingStatsEvent(!1,new Date),this.pingStatsTimeout=setInterval(this.sendPingStatsEvent.bind(this),t)}stopPingStats(){clearInterval(this.pingStatsTimeout)}async sendPingStatsEvent(t=!0,r){let n,i;if(this.producingTransport&&(n=await this.measurements.getProcessedStats(this.producingTransport,!1,!0),!n||!(n!=null&&n.producerReport))){this.logger.debug("callStats::sendPingStatsEvent::staleProducingTransport",{disclaimer:"Stale producer? Regenerating Stream Maps!"});const c=await this.measurements.getProducersReport([...this.producers.values()]);n&&c?n.producerReport=c:(n=await this.measurements.getProcessedStats(this.producingTransport,!1,!0),(!n||!(n!=null&&n.producerReport))&&this.logger.debug("callStats::sendPingStatsEvent::noProducingTransportReport",{disclaimer:"Stream maps invalid despite regenerating!"}))}if(this.consumingTransport&&(i=await this.measurements.getProcessedStats(this.consumingTransport,!0,!1),!i||!i.consumerReport)){this.logger.debug("callStats::sendPingStatsEvent::staleConsumingTransport",{disclaimer:"Stale consumer? Regenerating Stream Maps!"});const c=await this.measurements.getConsumersReport([...this.consumers.values()]);i&&c?i.consumerReport=c:(i=await this.measurements.getProcessedStats(this.consumingTransport,!0,!1),(!i||!i.consumerReport)&&this.logger.debug("callStats::sendPingStatsEvent::noConsumingTransportReport",{disclaimer:"Stream maps invalid despite regenerating!"}))}const a={producingTransportStats:n?n==null?void 0:n.transportReport:void 0,consumingTransportStats:i?i==null?void 0:i.transportReport:void 0,producerStats:[].concat((n==null?void 0:n.producerReport)||[]).concat((i==null?void 0:i.producerReport)||[]),consumerStats:[].concat((i==null?void 0:i.consumerReport)||[]).concat((n==null?void 0:n.consumerReport)||[])};if(t&&a.producerStats.length===0&&a.consumerStats.length===0){await this.eventHandler.flush();return}this.eventHandler.callEvent({event:L.PING_STAT,metaData:a,timestamp:r})}sendIVSPlayerRebufferEvent(t){this.eventHandler.callEvent({event:L.IVS_PLAYER_REBUFFERING,timestamp:t})}sendIVSPlayerAudioBlockEvent(t){this.eventHandler.callEvent({event:L.IVS_PLAYER_AUDIO_BLOCKED,timestamp:t})}sendIVSPlayerPlaybackBlockedEvent(t){this.eventHandler.callEvent({event:L.IVS_PLAYER_PLAYBACK_BLOCKED,timestamp:t})}sendIVSPlayerNetworkUnavailableEvent(t){this.eventHandler.callEvent({event:L.IVS_PLAYER_NETWORK_UNAVAILABLE,timestamp:t})}sendIVSPlayerInitializedEvent(t){this.eventHandler.callEvent({event:L.IVS_PLAYER_INITIALIZED,timestamp:t})}sendIVSPlayerWorkerErrorEvent(t){this.eventHandler.callEvent({event:L.IVS_PLAYER_WORKER_ERROR,timestamp:t})}sendIVSPlayerErrorEvent(t,r){this.eventHandler.callEvent({event:L.IVS_PLAYER_ERROR,timestamp:r,metaData:t})}sendIVSPlayerRecoverableErrorEvent(t,r){this.eventHandler.callEvent({event:L.IVS_PLAYER_RECOVERABLE_ERROR,timestamp:r,metaData:t})}sendIVSPlayerAnalyticsEvent(t,r){this.eventHandler.callEvent({event:L.IVS_PLAYER_ANALYTICS_EVENT,timestamp:r,metaData:t})}sendIVSPlayerPlaybackRateChangedEvent(t,r){this.eventHandler.callEvent({event:L.IVS_PLAYER_PLAYBACK_RATE_CHANGED,timestamp:r,metaData:{updatedPlaybackRate:t}})}sendIVSPlayerQualityChanged(t,r){this.eventHandler.callEvent({event:L.IVS_PLAYER_QUALITY_CHANGED,timestamp:r,metaData:t})}sendPlayerLiveLatency(t,r){this.eventHandler.callEvent({event:L.LIVESTREAM_LATENCY,timestamp:r,metaData:{latency:t}})}sendDisconnectEvent(t){this.eventHandler.callEvent({event:L.DISCONNECT,timestamp:t})}sendReconnectEvent(t){this.eventHandler.callEvent({event:L.RECONNECT_ATTEMPT,timestamp:t})}expectedVideoResolution(t,r,n){this.eventHandler.callEvent({event:L.EXPECTED_VIDEO_RESOLUTION,timestamp:n,metaData:{frameWidth:t,frameHeight:r}})}expectedScreenshareResolution(t,r,n){this.eventHandler.callEvent({event:L.EXPECTED_SCREENSHARE_RESOLUTION,timestamp:n,metaData:{frameWidth:t,frameHeight:r}})}};Q([Z(TypeError,(s,e)=>X.error(e,s))],K.prototype,"registerIceServers",null),Q([Z(TypeError,(s,e)=>X.error(e,s))],K.prototype,"registerConsumer",null),Q([Z(TypeError,(s,e)=>X.error(e,s))],K.prototype,"registerProducer",null),Q([Z(TypeError,(s,e)=>X.error(e,s))],K.prototype,"sendConsumerSharedMediaStateEvent",null),Q([Z(TypeError,(s,e)=>X.error(e,s))],K.prototype,"registerProducingTransport",null),Q([Z(TypeError,(s,e)=>X.error(e,s))],K.prototype,"registerConsumingTransport",null),Q([Z(TypeError,(s,e)=>X.error(e,s))],K.prototype,"deRegisterConsumer",null),Q([Z(TypeError,(s,e)=>X.error(e,s))],K.prototype,"deRegisterProducer",null),Q([Z(TypeError,(s,e)=>X.error(e,s))],K.prototype,"disconnectConsumingTransport",null),Q([Z(TypeError,(s,e)=>X.error(e,s))],K.prototype,"disconnectProducingTransport",null),Q([Z(TypeError,(s,e)=>X.error(e,s))],K.prototype,"sendPreCallTestBeginEvent",null),Q([Z(TypeError,(s,e)=>X.error(e,s))],K.prototype,"sendScreenShareToggleEvent",null),Q([Z(TypeError,(s,e)=>X.error(e,s))],K.prototype,"sendScreenShareRequestedEvent",null),Q([Z(TypeError,(s,e)=>X.error(e,s))],K.prototype,"sendActiveSpeakerEvent",null),Q([Z(TypeError,(s,e)=>X.error(e,s))],K.prototype,"devices",null),Q([Z(TypeError,(s,e)=>X.error(e,s))],K.prototype,"selectedDevice",null),Q([Z(TypeError,(s,e)=>X.error(e,s))],K.prototype,"mediaPermission",null),Q([Z(TypeError,(s,e)=>X.error(e,s))],K.prototype,"mediaPlaybackFailed",null),Q([Z(TypeError,(s,e)=>X.error(e,s))],K.prototype,"mediaTrackMuted",null),Q([Z(TypeError,(s,e)=>X.error(e,s))],K.prototype,"tabChanged",null),Q([Z(TypeError,(s,e)=>X.error(e,s))],K.prototype,"browserBackgrounded",null),Q([Z(TypeError,(s,e)=>X.error(e,s))],K.prototype,"browserForegrounded",null),Q([Z(TypeError,(s,e)=>X.error(e,s))],K.prototype,"legacySwitch",null),Q([Z(TypeError,(s,e)=>X.error(e,s))],K.prototype,"getPreCallTestResults",null),Q([Z(TypeError,(s,e)=>X.error(e,s))],K.prototype,"sendCallJoinBeginEvent",null),Q([Z(TypeError,(s,e)=>X.error(e,s))],K.prototype,"sendNetworkQualityTestBeginEvent",null),Q([Z(TypeError,(s,e)=>X.error(e,s))],K.prototype,"sendWebSocketConnectedEvent",null),Q([Z(TypeError,(s,e)=>X.error(e,s))],K.prototype,"sendTransportConnectedEvent",null),Q([Z(TypeError,(s,e)=>X.error(e,s))],K.prototype,"sendAudioToggleEvent",null),Q([Z(TypeError,(s,e)=>X.error(e,s))],K.prototype,"sendVideoToggleEvent",null),Q([Z(TypeError,(s,e)=>X.error(e,s))],K.prototype,"sendParticipantRoleToggleEvent",null),Q([Z(TypeError,(s,e)=>X.error(e,s))],K.prototype,"startPingStats",null),Q([Z(TypeError,(s,e)=>X.error(e,s))],K.prototype,"stopPingStats",null),Q([Z(TypeError,(s,e)=>X.error(e,s))],K.prototype,"sendPingStatsEvent",null),Q([Z(TypeError,(s,e)=>X.error(e,s))],K.prototype,"sendIVSPlayerRebufferEvent",null),Q([Z(TypeError,(s,e)=>X.error(e,s))],K.prototype,"sendIVSPlayerAudioBlockEvent",null),Q([Z(TypeError,(s,e)=>X.error(e,s))],K.prototype,"sendIVSPlayerPlaybackBlockedEvent",null),Q([Z(TypeError,(s,e)=>X.error(e,s))],K.prototype,"sendIVSPlayerNetworkUnavailableEvent",null),Q([Z(TypeError,(s,e)=>X.error(e,s))],K.prototype,"sendIVSPlayerInitializedEvent",null),Q([Z(TypeError,(s,e)=>X.error(e,s))],K.prototype,"sendIVSPlayerWorkerErrorEvent",null),Q([Z(TypeError,(s,e)=>X.error(e,s))],K.prototype,"sendIVSPlayerErrorEvent",null),Q([Z(TypeError,(s,e)=>X.error(e,s))],K.prototype,"sendIVSPlayerRecoverableErrorEvent",null),Q([Z(TypeError,(s,e)=>X.error(e,s))],K.prototype,"sendIVSPlayerAnalyticsEvent",null),Q([Z(TypeError,(s,e)=>X.error(e,s))],K.prototype,"sendIVSPlayerPlaybackRateChangedEvent",null),Q([Z(TypeError,(s,e)=>X.error(e,s))],K.prototype,"sendIVSPlayerQualityChanged",null),Q([Z(TypeError,(s,e)=>X.error(e,s))],K.prototype,"sendPlayerLiveLatency",null),Q([Z(TypeError,(s,e)=>X.error(e,s))],K.prototype,"sendDisconnectEvent",null),Q([Z(TypeError,(s,e)=>X.error(e,s))],K.prototype,"sendReconnectEvent",null),Q([Z(TypeError,(s,e)=>X.error(e,s))],K.prototype,"expectedVideoResolution",null),Q([Z(TypeError,(s,e)=>X.error(e,s))],K.prototype,"expectedScreenshareResolution",null),K=Q([yT(TypeError,(s,e)=>X.error(e,s))],K);const TT=K;class ST extends re{constructor(){super(...arguments);m(this,"stats");m(this,"peerId");m(this,"backend");m(this,"iceServers");m(this,"initialized",!1);m(this,"stalled",!1);m(this,"ipInformation");m(this,"logger")}async initialize({peerId:t,engineName:r,env:n=Ha.PROD,iceServers:i,apiBase:a="https://api.cluster.dyte.in",flags:c,logger:d=console,apiHostnames:l,skipConnectivityChecks:h=!1}){var p,f,y;try{this.peerId=t,this.logger=d,this.ipInformation=await zl.getIPDetails({peerId:t,apiHostnames:l,logger:d}),this.backend=new TT(a,r,n,c,d,t,l),this.iceServers=i,(p=this.backend)==null||p.registerIceServers(this.iceServers),this.initialized=!0,(y=(f=this.backend)==null?void 0:f.eventHandler)==null||y.emit("initialized",this.ipInformation),this.emit("initialized",this.ipInformation),this.startPreCallTest(h)}catch(_){this.logger.error("callStats::CallStatsIntegration: ",{error:_}),this.stallCallStats()}}configureSendTransport(t){this.onSafeInitialization(()=>{var r;(r=this.backend)==null||r.registerProducingTransport(t)})}configureRecvTransport(t){this.onSafeInitialization(()=>{var r;(r=this.backend)==null||r.registerConsumingTransport(t)})}async candidateRegionalNetworkQualityTest(t){const r=new Date;this.onSafeInitialization(()=>{var n;try{(n=this.backend)==null||n.sendNetworkQualityTestBeginEvent(t,r)}catch(i){this.logger.error("callStats::sendNetworkQualityTestBeginEvent",{error:{reason:i.reason}})}})}async roomJoined(t){const r=new Date;this.onSafeInitialization(()=>{var n,i;(n=this.backend)==null||n.sendCallJoinBeginEvent(t,r),this.backend,(i=this.backend)==null||i.startPingStats()})}audioOff(){const t=new Date;this.onSafeInitialization(()=>{var r;(r=this.backend)==null||r.sendAudioToggleEvent(!1,t)})}audioOn(){const t=new Date;this.onSafeInitialization(()=>{var r;(r=this.backend)==null||r.sendAudioToggleEvent(!0,t)})}videoOff(){const t=new Date;this.onSafeInitialization(()=>{var r;(r=this.backend)==null||r.sendVideoToggleEvent(!1,t)})}videoOn(){const t=new Date;this.onSafeInitialization(()=>{var r;(r=this.backend)==null||r.sendVideoToggleEvent(!0,t)})}callEnded(){const t=new Date;this.onSafeInitialization(()=>{var r,n;(r=this.backend)==null||r.stopPingStats(),(n=this.backend)==null||n.sendDisconnectEvent(t)})}screenShareStart(t){const r=new Date;this.onSafeInitialization(()=>{var n;(n=this.backend)==null||n.sendScreenShareToggleEvent(!0,t,r)})}consumerSharedMediaState(t,r){this.onSafeInitialization(()=>{var n;(n=this.backend)==null||n.sendConsumerSharedMediaStateEvent(t,r)})}screenShareStop(t){const r=new Date;this.onSafeInitialization(()=>{var n;(n=this.backend)==null||n.sendScreenShareToggleEvent(!1,t,r)})}screenShareRequested(){const t=new Date;this.onSafeInitialization(()=>{var r;(r=this.backend)==null||r.sendScreenShareRequestedEvent(t)})}activeSpeaker(t){if(t!==this.peerId)return;const r=new Date;this.onSafeInitialization(()=>{var n;(n=this.backend)==null||n.sendActiveSpeakerEvent(t,r)})}devices(t,r){const n=new Date;this.onSafeInitialization(()=>{var i;(i=this.backend)==null||i.devices(t,r,n)})}selectedDevice(t,r){const n=new Date;this.onSafeInitialization(()=>{var i;(i=this.backend)==null||i.selectedDevice(t,r,n)})}mediaPermission(t,r){const n=new Date;this.onSafeInitialization(()=>{var i;(i=this.backend)==null||i.mediaPermission(t,r,n)})}mediaPlaybackFailed(t){const r=new Date;this.onSafeInitialization(()=>{var n;(n=this.backend)==null||n.mediaPlaybackFailed(t,r)})}mediaTrackMuted(t){const r=new Date;this.onSafeInitialization(()=>{var n;(n=this.backend)==null||n.mediaTrackMuted(t,r)})}tabChanged(t=!1){const r=new Date;this.onSafeInitialization(()=>{var n;(n=this.backend)==null||n.tabChanged(t,r)})}browserBackgrounded(){const t=new Date;this.onSafeInitialization(()=>{var r;(r=this.backend)==null||r.browserBackgrounded(t)})}browserForegrounded(){const t=new Date;this.onSafeInitialization(()=>{var r;(r=this.backend)==null||r.browserForegrounded(t)})}legacySwitch(t){const r=new Date;this.onSafeInitialization(()=>{var n;(n=this.backend)==null||n.legacySwitch(t,r)})}async startPreCallTest(t=!1){const r=new Date;this.onSafeInitialization(()=>{var n;(n=this.backend)==null||n.sendPreCallTestBeginEvent(t,r)})}onPreCallTestResults(t){return this.onSafeInitialization(()=>{var r;(r=this.backend)==null||r.eventHandler.once("precall_end",t)}),t}onReceivingConsumerAudioStatus(t){this.onSafeInitialization(()=>{var r;(r=this.backend)==null||r.eventHandler.on("consumer_audio_status",t)})}onReceivingConsumerVideoStatus(t){this.onSafeInitialization(()=>{var r;(r=this.backend)==null||r.eventHandler.on("consumer_video_status",t)})}onReceivingProducerAudioStatus(t){this.onSafeInitialization(()=>{var r;(r=this.backend)==null||r.eventHandler.on("producer_audio_status",t)})}onReceivingProducerVideoStatus(t){this.onSafeInitialization(()=>{var r;(r=this.backend)==null||r.eventHandler.on("producer_video_status",t)})}onReceivingProducingTransportStatus(t){this.onSafeInitialization(()=>{var r;(r=this.backend)==null||r.eventHandler.on("producing_transport_status",t)})}onReceivingConsumingTransportStatus(t){this.onSafeInitialization(()=>{var r;(r=this.backend)==null||r.eventHandler.on("consuming_transport_status",t)})}onProducerScore(t){this.onSafeInitialization(()=>{var r;(r=this.backend)==null||r.eventHandler.on("producer_score",t)})}onConsumerScore(t){this.onSafeInitialization(()=>{var r;(r=this.backend)==null||r.eventHandler.on("consumer_score",t)})}onSafeInitialization(t){if(this.initialized)t(this.ipInformation,!1);else if(!this.stalled){const r=n=>{t(n,!0)};return this.once("initialized",r),r}return()=>{}}removeInitializationListener(t){this.removeListener("initialized",t)}stallCallStats(){this.stalled=!0,this.removeAllListeners("initialized")}ivsPlayerEvent(t,r){const n=new Date;this.onSafeInitialization(()=>{var i,a,c,d,l,h,p,f,y,_,b;switch(t){case"PlayerRebuffering":(i=this.backend)==null||i.sendIVSPlayerRebufferEvent(n);break;case"PlayerAudioBlocked":(a=this.backend)==null||a.sendIVSPlayerAudioBlockEvent(n);break;case"PlayerPlaybackBlocked":(c=this.backend)==null||c.sendIVSPlayerPlaybackBlockedEvent(n);break;case"PlayerNetworkUnavailable":(d=this.backend)==null||d.sendIVSPlayerNetworkUnavailableEvent(n);break;case"PlayerInitialized":(l=this.backend)==null||l.sendIVSPlayerInitializedEvent(n);break;case"PlayerWorkerError":(h=this.backend)==null||h.sendIVSPlayerWorkerErrorEvent(n);break;case"PlayerError":(p=this.backend)==null||p.sendIVSPlayerErrorEvent(r,n);break;case"PlayerRecoverableError":(f=this.backend)==null||f.sendIVSPlayerRecoverableErrorEvent(r,n);break;case"PlayerAnalyticsEvent":(y=this.backend)==null||y.sendIVSPlayerAnalyticsEvent(r,n);break;case"PlayerPlaybackRateChanged":(_=this.backend)==null||_.sendIVSPlayerPlaybackRateChangedEvent(r,n);break;case"PlayerQualityChanged":(b=this.backend)==null||b.sendIVSPlayerQualityChanged(r,n);break}})}livestreamLatency(t){const r=new Date;this.onSafeInitialization(()=>{var n;(n=this.backend)==null||n.sendPlayerLiveLatency(t,r)})}expectedVideoResolution(t,r){const n=new Date;this.onSafeInitialization(()=>{var i;(i=this.backend)==null||i.expectedVideoResolution(t,r,n)})}expectedScreenshareResolution(t,r){const n=new Date;this.onSafeInitialization(()=>{var i;(i=this.backend)==null||i.expectedScreenshareResolution(t,r,n)})}}const G=new ST;G.setMaxListeners(30);function ET(s){const{length:e}=this,t=s>=0?s:e+s;return t<0||t>=e?void 0:this[t]}Array.prototype.at||Object.assign(Array.prototype,{at:ET});function _T(s){const{length:e}=this,t=s>=0?s:e+s;return t<0||t>=e?void 0:this[t]}String.prototype.at||Object.assign(String.prototype,{at:_T});var Hc,bT=new Uint8Array(16);function wT(){if(!Hc&&(Hc=typeof crypto!="undefined"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto!="undefined"&&typeof msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto),!Hc))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Hc(bT)}const PT=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function Yl(s){return typeof s=="string"&&PT.test(s)}for(var it=[],Ql=0;Ql<256;++Ql)it.push((Ql+256).toString(16).substr(1));function CT(s){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,t=(it[s[e+0]]+it[s[e+1]]+it[s[e+2]]+it[s[e+3]]+"-"+it[s[e+4]]+it[s[e+5]]+"-"+it[s[e+6]]+it[s[e+7]]+"-"+it[s[e+8]]+it[s[e+9]]+"-"+it[s[e+10]]+it[s[e+11]]+it[s[e+12]]+it[s[e+13]]+it[s[e+14]]+it[s[e+15]]).toLowerCase();if(!Yl(t))throw TypeError("Stringified UUID is invalid");return t}function hi(s,e,t){s=s||{};var r=s.random||(s.rng||wT)();if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,e){t=t||0;for(var n=0;n<16;++n)e[t+n]=r[n];return e}return CT(r)}var Xl={},RT={get exports(){return Xl},set exports(s){Xl=s}},qc={},kT={get exports(){return qc},set exports(s){qc=s}},Kp=function(e,t){return function(){for(var n=new Array(arguments.length),i=0;i<n.length;i++)n[i]=arguments[i];return e.apply(t,n)}},IT=Kp,Tr=Object.prototype.toString;function Zl(s){return Array.isArray(s)}function eu(s){return typeof s=="undefined"}function AT(s){return s!==null&&!eu(s)&&s.constructor!==null&&!eu(s.constructor)&&typeof s.constructor.isBuffer=="function"&&s.constructor.isBuffer(s)}function zp(s){return Tr.call(s)==="[object ArrayBuffer]"}function MT(s){return Tr.call(s)==="[object FormData]"}function DT(s){var e;return typeof ArrayBuffer!="undefined"&&ArrayBuffer.isView?e=ArrayBuffer.isView(s):e=s&&s.buffer&&zp(s.buffer),e}function OT(s){return typeof s=="string"}function NT(s){return typeof s=="number"}function Yp(s){return s!==null&&typeof s=="object"}function jc(s){if(Tr.call(s)!=="[object Object]")return!1;var e=Object.getPrototypeOf(s);return e===null||e===Object.prototype}function LT(s){return Tr.call(s)==="[object Date]"}function xT(s){return Tr.call(s)==="[object File]"}function VT(s){return Tr.call(s)==="[object Blob]"}function Qp(s){return Tr.call(s)==="[object Function]"}function UT(s){return Yp(s)&&Qp(s.pipe)}function FT(s){return Tr.call(s)==="[object URLSearchParams]"}function BT(s){return s.trim?s.trim():s.replace(/^\s+|\s+$/g,"")}function $T(){return typeof navigator!="undefined"&&(navigator.product==="ReactNative"||navigator.product==="NativeScript"||navigator.product==="NS")?!1:typeof window!="undefined"&&typeof document!="undefined"}function tu(s,e){if(!(s===null||typeof s=="undefined"))if(typeof s!="object"&&(s=[s]),Zl(s))for(var t=0,r=s.length;t<r;t++)e.call(null,s[t],t,s);else for(var n in s)Object.prototype.hasOwnProperty.call(s,n)&&e.call(null,s[n],n,s)}function su(){var s={};function e(n,i){jc(s[i])&&jc(n)?s[i]=su(s[i],n):jc(n)?s[i]=su({},n):Zl(n)?s[i]=n.slice():s[i]=n}for(var t=0,r=arguments.length;t<r;t++)tu(arguments[t],e);return s}function HT(s,e,t){return tu(e,function(n,i){t&&typeof n=="function"?s[i]=IT(n,t):s[i]=n}),s}function qT(s){return s.charCodeAt(0)===65279&&(s=s.slice(1)),s}var Lt={isArray:Zl,isArrayBuffer:zp,isBuffer:AT,isFormData:MT,isArrayBufferView:DT,isString:OT,isNumber:NT,isObject:Yp,isPlainObject:jc,isUndefined:eu,isDate:LT,isFile:xT,isBlob:VT,isFunction:Qp,isStream:UT,isURLSearchParams:FT,isStandardBrowserEnv:$T,forEach:tu,merge:su,extend:HT,trim:BT,stripBOM:qT},pi=Lt;function Xp(s){return encodeURIComponent(s).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}var Zp=function(e,t,r){if(!t)return e;var n;if(r)n=r(t);else if(pi.isURLSearchParams(t))n=t.toString();else{var i=[];pi.forEach(t,function(d,l){d===null||typeof d=="undefined"||(pi.isArray(d)?l=l+"[]":d=[d],pi.forEach(d,function(p){pi.isDate(p)?p=p.toISOString():pi.isObject(p)&&(p=JSON.stringify(p)),i.push(Xp(l)+"="+Xp(p))}))}),n=i.join("&")}if(n){var a=e.indexOf("#");a!==-1&&(e=e.slice(0,a)),e+=(e.indexOf("?")===-1?"?":"&")+n}return e},jT=Lt;function Gc(){this.handlers=[]}Gc.prototype.use=function(e,t,r){return this.handlers.push({fulfilled:e,rejected:t,synchronous:r?r.synchronous:!1,runWhen:r?r.runWhen:null}),this.handlers.length-1},Gc.prototype.eject=function(e){this.handlers[e]&&(this.handlers[e]=null)},Gc.prototype.forEach=function(e){jT.forEach(this.handlers,function(r){r!==null&&e(r)})};var GT=Gc,WT=Lt,JT=function(e,t){WT.forEach(e,function(n,i){i!==t&&i.toUpperCase()===t.toUpperCase()&&(e[t]=n,delete e[i])})},em=function(e,t,r,n,i){return e.config=t,r&&(e.code=r),e.request=n,e.response=i,e.isAxiosError=!0,e.toJSON=function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code,status:this.response&&this.response.status?this.response.status:null}},e},ru,tm;function sm(){if(tm)return ru;tm=1;var s=em;return ru=function(t,r,n,i,a){var c=new Error(t);return s(c,r,n,i,a)},ru}var nu,rm;function KT(){if(rm)return nu;rm=1;var s=sm();return nu=function(t,r,n){var i=n.config.validateStatus;!n.status||!i||i(n.status)?t(n):r(s("Request failed with status code "+n.status,n.config,null,n.request,n))},nu}var iu,nm;function zT(){if(nm)return iu;nm=1;var s=Lt;return iu=s.isStandardBrowserEnv()?function(){return{write:function(r,n,i,a,c,d){var l=[];l.push(r+"="+encodeURIComponent(n)),s.isNumber(i)&&l.push("expires="+new Date(i).toGMTString()),s.isString(a)&&l.push("path="+a),s.isString(c)&&l.push("domain="+c),d===!0&&l.push("secure"),document.cookie=l.join("; ")},read:function(r){var n=document.cookie.match(new RegExp("(^|;\\s*)("+r+")=([^;]*)"));return n?decodeURIComponent(n[3]):null},remove:function(r){this.write(r,"",Date.now()-864e5)}}}():function(){return{write:function(){},read:function(){return null},remove:function(){}}}(),iu}var au,im;function YT(){return im||(im=1,au=function(e){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(e)}),au}var ou,am;function QT(){return am||(am=1,ou=function(e,t){return t?e.replace(/\/+$/,"")+"/"+t.replace(/^\/+/,""):e}),ou}var cu,om;function XT(){if(om)return cu;om=1;var s=YT(),e=QT();return cu=function(r,n){return r&&!s(n)?e(r,n):n},cu}var du,cm;function ZT(){if(cm)return du;cm=1;var s=Lt,e=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"];return du=function(r){var n={},i,a,c;return r&&s.forEach(r.split(`
`),function(l){if(c=l.indexOf(":"),i=s.trim(l.substr(0,c)).toLowerCase(),a=s.trim(l.substr(c+1)),i){if(n[i]&&e.indexOf(i)>=0)return;i==="set-cookie"?n[i]=(n[i]?n[i]:[]).concat([a]):n[i]=n[i]?n[i]+", "+a:a}}),n},du}var lu,dm;function eS(){if(dm)return lu;dm=1;var s=Lt;return lu=s.isStandardBrowserEnv()?function(){var t=/(msie|trident)/i.test(navigator.userAgent),r=document.createElement("a"),n;function i(a){var c=a;return t&&(r.setAttribute("href",c),c=r.href),r.setAttribute("href",c),{href:r.href,protocol:r.protocol?r.protocol.replace(/:$/,""):"",host:r.host,search:r.search?r.search.replace(/^\?/,""):"",hash:r.hash?r.hash.replace(/^#/,""):"",hostname:r.hostname,port:r.port,pathname:r.pathname.charAt(0)==="/"?r.pathname:"/"+r.pathname}}return n=i(window.location.href),function(c){var d=s.isString(c)?i(c):c;return d.protocol===n.protocol&&d.host===n.host}}():function(){return function(){return!0}}(),lu}var uu,lm;function Wc(){if(lm)return uu;lm=1;function s(e){this.message=e}return s.prototype.toString=function(){return"Cancel"+(this.message?": "+this.message:"")},s.prototype.__CANCEL__=!0,uu=s,uu}var hu,um;function hm(){if(um)return hu;um=1;var s=Lt,e=KT(),t=zT(),r=Zp,n=XT(),i=ZT(),a=eS(),c=sm(),d=Jc(),l=Wc();return hu=function(p){return new Promise(function(y,_){var b=p.data,I=p.headers,x=p.responseType,B;function H(){p.cancelToken&&p.cancelToken.unsubscribe(B),p.signal&&p.signal.removeEventListener("abort",B)}s.isFormData(b)&&delete I["Content-Type"];var M=new XMLHttpRequest;if(p.auth){var z=p.auth.username||"",ne=p.auth.password?unescape(encodeURIComponent(p.auth.password)):"";I.Authorization="Basic "+btoa(z+":"+ne)}var ue=n(p.baseURL,p.url);M.open(p.method.toUpperCase(),r(ue,p.params,p.paramsSerializer),!0),M.timeout=p.timeout;function ze(){if(M){var Oe="getAllResponseHeaders"in M?i(M.getAllResponseHeaders()):null,Ot=!x||x==="text"||x==="json"?M.responseText:M.response,A={data:Ot,status:M.status,statusText:M.statusText,headers:Oe,config:p,request:M};e(function(w){y(w),H()},function(w){_(w),H()},A),M=null}}if("onloadend"in M?M.onloadend=ze:M.onreadystatechange=function(){!M||M.readyState!==4||M.status===0&&!(M.responseURL&&M.responseURL.indexOf("file:")===0)||setTimeout(ze)},M.onabort=function(){M&&(_(c("Request aborted",p,"ECONNABORTED",M)),M=null)},M.onerror=function(){_(c("Network Error",p,null,M)),M=null},M.ontimeout=function(){var Ot=p.timeout?"timeout of "+p.timeout+"ms exceeded":"timeout exceeded",A=p.transitional||d.transitional;p.timeoutErrorMessage&&(Ot=p.timeoutErrorMessage),_(c(Ot,p,A.clarifyTimeoutError?"ETIMEDOUT":"ECONNABORTED",M)),M=null},s.isStandardBrowserEnv()){var Qt=(p.withCredentials||a(ue))&&p.xsrfCookieName?t.read(p.xsrfCookieName):void 0;Qt&&(I[p.xsrfHeaderName]=Qt)}"setRequestHeader"in M&&s.forEach(I,function(Ot,A){typeof b=="undefined"&&A.toLowerCase()==="content-type"?delete I[A]:M.setRequestHeader(A,Ot)}),s.isUndefined(p.withCredentials)||(M.withCredentials=!!p.withCredentials),x&&x!=="json"&&(M.responseType=p.responseType),typeof p.onDownloadProgress=="function"&&M.addEventListener("progress",p.onDownloadProgress),typeof p.onUploadProgress=="function"&&M.upload&&M.upload.addEventListener("progress",p.onUploadProgress),(p.cancelToken||p.signal)&&(B=function(Oe){M&&(_(!Oe||Oe&&Oe.type?new l("canceled"):Oe),M.abort(),M=null)},p.cancelToken&&p.cancelToken.subscribe(B),p.signal&&(p.signal.aborted?B():p.signal.addEventListener("abort",B))),b||(b=null),M.send(b)})},hu}var pu,pm;function Jc(){if(pm)return pu;pm=1;var s=Lt,e=JT,t=em,r={"Content-Type":"application/x-www-form-urlencoded"};function n(d,l){!s.isUndefined(d)&&s.isUndefined(d["Content-Type"])&&(d["Content-Type"]=l)}function i(){var d;return(typeof XMLHttpRequest!="undefined"||typeof process!="undefined"&&Object.prototype.toString.call(process)==="[object process]")&&(d=hm()),d}function a(d,l,h){if(s.isString(d))try{return(l||JSON.parse)(d),s.trim(d)}catch(p){if(p.name!=="SyntaxError")throw p}return(h||JSON.stringify)(d)}var c={transitional:{silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},adapter:i(),transformRequest:[function(l,h){return e(h,"Accept"),e(h,"Content-Type"),s.isFormData(l)||s.isArrayBuffer(l)||s.isBuffer(l)||s.isStream(l)||s.isFile(l)||s.isBlob(l)?l:s.isArrayBufferView(l)?l.buffer:s.isURLSearchParams(l)?(n(h,"application/x-www-form-urlencoded;charset=utf-8"),l.toString()):s.isObject(l)||h&&h["Content-Type"]==="application/json"?(n(h,"application/json"),a(l)):l}],transformResponse:[function(l){var h=this.transitional||c.transitional,p=h&&h.silentJSONParsing,f=h&&h.forcedJSONParsing,y=!p&&this.responseType==="json";if(y||f&&s.isString(l)&&l.length)try{return JSON.parse(l)}catch(_){if(y)throw _.name==="SyntaxError"?t(_,this,"E_JSON_PARSE"):_}return l}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,validateStatus:function(l){return l>=200&&l<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};return s.forEach(["delete","get","head"],function(l){c.headers[l]={}}),s.forEach(["post","put","patch"],function(l){c.headers[l]=s.merge(r)}),pu=c,pu}var tS=Lt,sS=Jc(),rS=function(e,t,r){var n=this||sS;return tS.forEach(r,function(a){e=a.call(n,e,t)}),e},mu,mm;function fm(){return mm||(mm=1,mu=function(e){return!!(e&&e.__CANCEL__)}),mu}var gm=Lt,fu=rS,nS=fm(),iS=Jc(),aS=Wc();function gu(s){if(s.cancelToken&&s.cancelToken.throwIfRequested(),s.signal&&s.signal.aborted)throw new aS("canceled")}var oS=function(e){gu(e),e.headers=e.headers||{},e.data=fu.call(e,e.data,e.headers,e.transformRequest),e.headers=gm.merge(e.headers.common||{},e.headers[e.method]||{},e.headers),gm.forEach(["delete","get","head","post","put","patch","common"],function(n){delete e.headers[n]});var t=e.adapter||iS.adapter;return t(e).then(function(n){return gu(e),n.data=fu.call(e,n.data,n.headers,e.transformResponse),n},function(n){return nS(n)||(gu(e),n&&n.response&&(n.response.data=fu.call(e,n.response.data,n.response.headers,e.transformResponse))),Promise.reject(n)})},qt=Lt,vm=function(e,t){t=t||{};var r={};function n(h,p){return qt.isPlainObject(h)&&qt.isPlainObject(p)?qt.merge(h,p):qt.isPlainObject(p)?qt.merge({},p):qt.isArray(p)?p.slice():p}function i(h){if(qt.isUndefined(t[h])){if(!qt.isUndefined(e[h]))return n(void 0,e[h])}else return n(e[h],t[h])}function a(h){if(!qt.isUndefined(t[h]))return n(void 0,t[h])}function c(h){if(qt.isUndefined(t[h])){if(!qt.isUndefined(e[h]))return n(void 0,e[h])}else return n(void 0,t[h])}function d(h){if(h in t)return n(e[h],t[h]);if(h in e)return n(void 0,e[h])}var l={url:a,method:a,data:a,baseURL:c,transformRequest:c,transformResponse:c,paramsSerializer:c,timeout:c,timeoutMessage:c,withCredentials:c,adapter:c,responseType:c,xsrfCookieName:c,xsrfHeaderName:c,onUploadProgress:c,onDownloadProgress:c,decompress:c,maxContentLength:c,maxBodyLength:c,transport:c,httpAgent:c,httpsAgent:c,cancelToken:c,socketPath:c,responseEncoding:c,validateStatus:d};return qt.forEach(Object.keys(e).concat(Object.keys(t)),function(p){var f=l[p]||i,y=f(p);qt.isUndefined(y)&&f!==d||(r[p]=y)}),r},vu,ym;function Tm(){return ym||(ym=1,vu={version:"0.25.0"}),vu}var cS=Tm().version,yu={};["object","boolean","number","function","string","symbol"].forEach(function(s,e){yu[s]=function(r){return typeof r===s||"a"+(e<1?"n ":" ")+s}});var Sm={};yu.transitional=function(e,t,r){function n(i,a){return"[Axios v"+cS+"] Transitional option '"+i+"'"+a+(r?". "+r:"")}return function(i,a,c){if(e===!1)throw new Error(n(a," has been removed"+(t?" in "+t:"")));return t&&!Sm[a]&&(Sm[a]=!0,console.warn(n(a," has been deprecated since v"+t+" and will be removed in the near future"))),e?e(i,a,c):!0}};function dS(s,e,t){if(typeof s!="object")throw new TypeError("options must be an object");for(var r=Object.keys(s),n=r.length;n-- >0;){var i=r[n],a=e[i];if(a){var c=s[i],d=c===void 0||a(c,i,s);if(d!==!0)throw new TypeError("option "+i+" must be "+d);continue}if(t!==!0)throw Error("Unknown option "+i)}}var lS={assertOptions:dS,validators:yu},Em=Lt,uS=Zp,_m=GT,bm=oS,Kc=vm,wm=lS,mi=wm.validators;function qa(s){this.defaults=s,this.interceptors={request:new _m,response:new _m}}qa.prototype.request=function(e,t){if(typeof e=="string"?(t=t||{},t.url=e):t=e||{},!t.url)throw new Error("Provided config url is not valid");t=Kc(this.defaults,t),t.method?t.method=t.method.toLowerCase():this.defaults.method?t.method=this.defaults.method.toLowerCase():t.method="get";var r=t.transitional;r!==void 0&&wm.assertOptions(r,{silentJSONParsing:mi.transitional(mi.boolean),forcedJSONParsing:mi.transitional(mi.boolean),clarifyTimeoutError:mi.transitional(mi.boolean)},!1);var n=[],i=!0;this.interceptors.request.forEach(function(y){typeof y.runWhen=="function"&&y.runWhen(t)===!1||(i=i&&y.synchronous,n.unshift(y.fulfilled,y.rejected))});var a=[];this.interceptors.response.forEach(function(y){a.push(y.fulfilled,y.rejected)});var c;if(!i){var d=[bm,void 0];for(Array.prototype.unshift.apply(d,n),d=d.concat(a),c=Promise.resolve(t);d.length;)c=c.then(d.shift(),d.shift());return c}for(var l=t;n.length;){var h=n.shift(),p=n.shift();try{l=h(l)}catch(f){p(f);break}}try{c=bm(l)}catch(f){return Promise.reject(f)}for(;a.length;)c=c.then(a.shift(),a.shift());return c},qa.prototype.getUri=function(e){if(!e.url)throw new Error("Provided config url is not valid");return e=Kc(this.defaults,e),uS(e.url,e.params,e.paramsSerializer).replace(/^\?/,"")},Em.forEach(["delete","get","head","options"],function(e){qa.prototype[e]=function(t,r){return this.request(Kc(r||{},{method:e,url:t,data:(r||{}).data}))}}),Em.forEach(["post","put","patch"],function(e){qa.prototype[e]=function(t,r,n){return this.request(Kc(n||{},{method:e,url:t,data:r}))}});var hS=qa,Tu,Pm;function pS(){if(Pm)return Tu;Pm=1;var s=Wc();function e(t){if(typeof t!="function")throw new TypeError("executor must be a function.");var r;this.promise=new Promise(function(a){r=a});var n=this;this.promise.then(function(i){if(n._listeners){var a,c=n._listeners.length;for(a=0;a<c;a++)n._listeners[a](i);n._listeners=null}}),this.promise.then=function(i){var a,c=new Promise(function(d){n.subscribe(d),a=d}).then(i);return c.cancel=function(){n.unsubscribe(a)},c},t(function(a){n.reason||(n.reason=new s(a),r(n.reason))})}return e.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},e.prototype.subscribe=function(r){if(this.reason){r(this.reason);return}this._listeners?this._listeners.push(r):this._listeners=[r]},e.prototype.unsubscribe=function(r){if(this._listeners){var n=this._listeners.indexOf(r);n!==-1&&this._listeners.splice(n,1)}},e.source=function(){var r,n=new e(function(a){r=a});return{token:n,cancel:r}},Tu=e,Tu}var Su,Cm;function mS(){return Cm||(Cm=1,Su=function(e){return function(r){return e.apply(null,r)}}),Su}var Eu,Rm;function fS(){if(Rm)return Eu;Rm=1;var s=Lt;return Eu=function(t){return s.isObject(t)&&t.isAxiosError===!0},Eu}var km=Lt,gS=Kp,zc=hS,vS=vm,yS=Jc();function Im(s){var e=new zc(s),t=gS(zc.prototype.request,e);return km.extend(t,zc.prototype,e),km.extend(t,e),t.create=function(n){return Im(vS(s,n))},t}var Ms=Im(yS);Ms.Axios=zc,Ms.Cancel=Wc(),Ms.CancelToken=pS(),Ms.isCancel=fm(),Ms.VERSION=Tm().version,Ms.all=function(e){return Promise.all(e)},Ms.spread=mS(),Ms.isAxiosError=fS(),kT.exports=Ms,qc.default=Ms,function(s){s.exports=qc}(RT);const TS=Ie(Xl);function SS(){this.__data__=[],this.size=0}function ja(s,e){return s===e||s!==s&&e!==e}function Yc(s,e){for(var t=s.length;t--;)if(ja(s[t][0],e))return t;return-1}var ES=Array.prototype,_S=ES.splice;function bS(s){var e=this.__data__,t=Yc(e,s);if(t<0)return!1;var r=e.length-1;return t==r?e.pop():_S.call(e,t,1),--this.size,!0}function wS(s){var e=this.__data__,t=Yc(e,s);return t<0?void 0:e[t][1]}function PS(s){return Yc(this.__data__,s)>-1}function CS(s,e){var t=this.__data__,r=Yc(t,s);return r<0?(++this.size,t.push([s,e])):t[r][1]=e,this}function Js(s){var e=-1,t=s==null?0:s.length;for(this.clear();++e<t;){var r=s[e];this.set(r[0],r[1])}}Js.prototype.clear=SS,Js.prototype.delete=bS,Js.prototype.get=wS,Js.prototype.has=PS,Js.prototype.set=CS;function RS(){this.__data__=new Js,this.size=0}function kS(s){var e=this.__data__,t=e.delete(s);return this.size=e.size,t}function IS(s){return this.__data__.get(s)}function AS(s){return this.__data__.has(s)}var MS=typeof global=="object"&&global&&global.Object===Object&&global;const Am=MS;var DS=typeof self=="object"&&self&&self.Object===Object&&self,OS=Am||DS||Function("return this")();const ms=OS;var NS=ms.Symbol;const Sr=NS;var Mm=Object.prototype,LS=Mm.hasOwnProperty,xS=Mm.toString,Ga=Sr?Sr.toStringTag:void 0;function VS(s){var e=LS.call(s,Ga),t=s[Ga];try{s[Ga]=void 0;var r=!0}catch(i){}var n=xS.call(s);return r&&(e?s[Ga]=t:delete s[Ga]),n}var US=Object.prototype,FS=US.toString;function BS(s){return FS.call(s)}var $S="[object Null]",HS="[object Undefined]",Dm=Sr?Sr.toStringTag:void 0;function ln(s){return s==null?s===void 0?HS:$S:Dm&&Dm in Object(s)?VS(s):BS(s)}function fs(s){var e=typeof s;return s!=null&&(e=="object"||e=="function")}var qS="[object AsyncFunction]",jS="[object Function]",GS="[object GeneratorFunction]",WS="[object Proxy]";function _u(s){if(!fs(s))return!1;var e=ln(s);return e==jS||e==GS||e==qS||e==WS}var JS=ms["__core-js_shared__"];const bu=JS;var Om=function(){var s=/[^.]+$/.exec(bu&&bu.keys&&bu.keys.IE_PROTO||"");return s?"Symbol(src)_1."+s:""}();function KS(s){return!!Om&&Om in s}var zS=Function.prototype,YS=zS.toString;function un(s){if(s!=null){try{return YS.call(s)}catch(e){}try{return s+""}catch(e){}}return""}var QS=/[\\^$.*+?()[\]{}|]/g,XS=/^\[object .+?Constructor\]$/,ZS=Function.prototype,eE=Object.prototype,tE=ZS.toString,sE=eE.hasOwnProperty,rE=RegExp("^"+tE.call(sE).replace(QS,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function nE(s){if(!fs(s)||KS(s))return!1;var e=_u(s)?rE:XS;return e.test(un(s))}function iE(s,e){return s==null?void 0:s[e]}function hn(s,e){var t=iE(s,e);return nE(t)?t:void 0}var aE=hn(ms,"Map");const Wa=aE;var oE=hn(Object,"create");const Ja=oE;function cE(){this.__data__=Ja?Ja(null):{},this.size=0}function dE(s){var e=this.has(s)&&delete this.__data__[s];return this.size-=e?1:0,e}var lE="__lodash_hash_undefined__",uE=Object.prototype,hE=uE.hasOwnProperty;function pE(s){var e=this.__data__;if(Ja){var t=e[s];return t===lE?void 0:t}return hE.call(e,s)?e[s]:void 0}var mE=Object.prototype,fE=mE.hasOwnProperty;function gE(s){var e=this.__data__;return Ja?e[s]!==void 0:fE.call(e,s)}var vE="__lodash_hash_undefined__";function yE(s,e){var t=this.__data__;return this.size+=this.has(s)?0:1,t[s]=Ja&&e===void 0?vE:e,this}function pn(s){var e=-1,t=s==null?0:s.length;for(this.clear();++e<t;){var r=s[e];this.set(r[0],r[1])}}pn.prototype.clear=cE,pn.prototype.delete=dE,pn.prototype.get=pE,pn.prototype.has=gE,pn.prototype.set=yE;function TE(){this.size=0,this.__data__={hash:new pn,map:new(Wa||Js),string:new pn}}function SE(s){var e=typeof s;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?s!=="__proto__":s===null}function Qc(s,e){var t=s.__data__;return SE(e)?t[typeof e=="string"?"string":"hash"]:t.map}function EE(s){var e=Qc(this,s).delete(s);return this.size-=e?1:0,e}function _E(s){return Qc(this,s).get(s)}function bE(s){return Qc(this,s).has(s)}function wE(s,e){var t=Qc(this,s),r=t.size;return t.set(s,e),this.size+=t.size==r?0:1,this}function mn(s){var e=-1,t=s==null?0:s.length;for(this.clear();++e<t;){var r=s[e];this.set(r[0],r[1])}}mn.prototype.clear=TE,mn.prototype.delete=EE,mn.prototype.get=_E,mn.prototype.has=bE,mn.prototype.set=wE;var PE=200;function CE(s,e){var t=this.__data__;if(t instanceof Js){var r=t.__data__;if(!Wa||r.length<PE-1)return r.push([s,e]),this.size=++t.size,this;t=this.__data__=new mn(r)}return t.set(s,e),this.size=t.size,this}function Ds(s){var e=this.__data__=new Js(s);this.size=e.size}Ds.prototype.clear=RS,Ds.prototype.delete=kS,Ds.prototype.get=IS,Ds.prototype.has=AS,Ds.prototype.set=CE;function RE(s,e){for(var t=-1,r=s==null?0:s.length;++t<r&&e(s[t],t,s)!==!1;);return s}var kE=function(){try{var s=hn(Object,"defineProperty");return s({},"",{}),s}catch(e){}}();const Xc=kE;function wu(s,e,t){e=="__proto__"&&Xc?Xc(s,e,{configurable:!0,enumerable:!0,value:t,writable:!0}):s[e]=t}var IE=Object.prototype,AE=IE.hasOwnProperty;function Nm(s,e,t){var r=s[e];(!(AE.call(s,e)&&ja(r,t))||t===void 0&&!(e in s))&&wu(s,e,t)}function Ka(s,e,t,r){var n=!t;t||(t={});for(var i=-1,a=e.length;++i<a;){var c=e[i],d=r?r(t[c],s[c],c,t,s):void 0;d===void 0&&(d=s[c]),n?wu(t,c,d):Nm(t,c,d)}return t}function ME(s,e){for(var t=-1,r=Array(s);++t<s;)r[t]=e(t);return r}function Os(s){return s!=null&&typeof s=="object"}var DE="[object Arguments]";function Lm(s){return Os(s)&&ln(s)==DE}var xm=Object.prototype,OE=xm.hasOwnProperty,NE=xm.propertyIsEnumerable,LE=Lm(function(){return arguments}())?Lm:function(s){return Os(s)&&OE.call(s,"callee")&&!NE.call(s,"callee")};const Zc=LE;var xE=Array.isArray;const Er=xE;function VE(){return!1}var Vm=typeof exports=="object"&&exports&&!exports.nodeType&&exports,Um=Vm&&typeof module=="object"&&module&&!module.nodeType&&module,UE=Um&&Um.exports===Vm,Fm=UE?ms.Buffer:void 0,FE=Fm?Fm.isBuffer:void 0,BE=FE||VE;const fi=BE;var $E=9007199254740991,HE=/^(?:0|[1-9]\d*)$/;function Bm(s,e){var t=typeof s;return e=e==null?$E:e,!!e&&(t=="number"||t!="symbol"&&HE.test(s))&&s>-1&&s%1==0&&s<e}var qE=9007199254740991;function $m(s){return typeof s=="number"&&s>-1&&s%1==0&&s<=qE}var jE="[object Arguments]",GE="[object Array]",WE="[object Boolean]",JE="[object Date]",KE="[object Error]",zE="[object Function]",YE="[object Map]",QE="[object Number]",XE="[object Object]",ZE="[object RegExp]",e_="[object Set]",t_="[object String]",s_="[object WeakMap]",r_="[object ArrayBuffer]",n_="[object DataView]",i_="[object Float32Array]",a_="[object Float64Array]",o_="[object Int8Array]",c_="[object Int16Array]",d_="[object Int32Array]",l_="[object Uint8Array]",u_="[object Uint8ClampedArray]",h_="[object Uint16Array]",p_="[object Uint32Array]",Ee={};Ee[i_]=Ee[a_]=Ee[o_]=Ee[c_]=Ee[d_]=Ee[l_]=Ee[u_]=Ee[h_]=Ee[p_]=!0,Ee[jE]=Ee[GE]=Ee[r_]=Ee[WE]=Ee[n_]=Ee[JE]=Ee[KE]=Ee[zE]=Ee[YE]=Ee[QE]=Ee[XE]=Ee[ZE]=Ee[e_]=Ee[t_]=Ee[s_]=!1;function m_(s){return Os(s)&&$m(s.length)&&!!Ee[ln(s)]}function Pu(s){return function(e){return s(e)}}var Hm=typeof exports=="object"&&exports&&!exports.nodeType&&exports,za=Hm&&typeof module=="object"&&module&&!module.nodeType&&module,f_=za&&za.exports===Hm,Cu=f_&&Am.process,g_=function(){try{var s=za&&za.require&&za.require("util").types;return s||Cu&&Cu.binding&&Cu.binding("util")}catch(e){}}();const gi=g_;var qm=gi&&gi.isTypedArray,v_=qm?Pu(qm):m_;const ed=v_;var y_=Object.prototype,T_=y_.hasOwnProperty;function jm(s,e){var t=Er(s),r=!t&&Zc(s),n=!t&&!r&&fi(s),i=!t&&!r&&!n&&ed(s),a=t||r||n||i,c=a?ME(s.length,String):[],d=c.length;for(var l in s)(e||T_.call(s,l))&&!(a&&(l=="length"||n&&(l=="offset"||l=="parent")||i&&(l=="buffer"||l=="byteLength"||l=="byteOffset")||Bm(l,d)))&&c.push(l);return c}var S_=Object.prototype;function td(s){var e=s&&s.constructor,t=typeof e=="function"&&e.prototype||S_;return s===t}function Gm(s,e){return function(t){return s(e(t))}}var E_=Gm(Object.keys,Object);const __=E_;var b_=Object.prototype,w_=b_.hasOwnProperty;function Wm(s){if(!td(s))return __(s);var e=[];for(var t in Object(s))w_.call(s,t)&&t!="constructor"&&e.push(t);return e}function Ya(s){return s!=null&&$m(s.length)&&!_u(s)}function Ru(s){return Ya(s)?jm(s):Wm(s)}function P_(s,e){return s&&Ka(e,Ru(e),s)}function C_(s){var e=[];if(s!=null)for(var t in Object(s))e.push(t);return e}var R_=Object.prototype,k_=R_.hasOwnProperty;function I_(s){if(!fs(s))return C_(s);var e=td(s),t=[];for(var r in s)r=="constructor"&&(e||!k_.call(s,r))||t.push(r);return t}function Qa(s){return Ya(s)?jm(s,!0):I_(s)}function A_(s,e){return s&&Ka(e,Qa(e),s)}var Jm=typeof exports=="object"&&exports&&!exports.nodeType&&exports,Km=Jm&&typeof module=="object"&&module&&!module.nodeType&&module,M_=Km&&Km.exports===Jm,zm=M_?ms.Buffer:void 0,Ym=zm?zm.allocUnsafe:void 0;function Qm(s,e){if(e)return s.slice();var t=s.length,r=Ym?Ym(t):new s.constructor(t);return s.copy(r),r}function Xm(s,e){var t=-1,r=s.length;for(e||(e=Array(r));++t<r;)e[t]=s[t];return e}function D_(s,e){for(var t=-1,r=s==null?0:s.length,n=0,i=[];++t<r;){var a=s[t];e(a,t,s)&&(i[n++]=a)}return i}function Zm(){return[]}var O_=Object.prototype,N_=O_.propertyIsEnumerable,ef=Object.getOwnPropertySymbols,L_=ef?function(s){return s==null?[]:(s=Object(s),D_(ef(s),function(e){return N_.call(s,e)}))}:Zm;const ku=L_;function x_(s,e){return Ka(s,ku(s),e)}function tf(s,e){for(var t=-1,r=e.length,n=s.length;++t<r;)s[n+t]=e[t];return s}var V_=Gm(Object.getPrototypeOf,Object);const Iu=V_;var U_=Object.getOwnPropertySymbols,F_=U_?function(s){for(var e=[];s;)tf(e,ku(s)),s=Iu(s);return e}:Zm;const sf=F_;function B_(s,e){return Ka(s,sf(s),e)}function rf(s,e,t){var r=e(s);return Er(s)?r:tf(r,t(s))}function Au(s){return rf(s,Ru,ku)}function $_(s){return rf(s,Qa,sf)}var H_=hn(ms,"DataView");const Mu=H_;var q_=hn(ms,"Promise");const Du=q_;var j_=hn(ms,"Set");const Ou=j_;var G_=hn(ms,"WeakMap");const Nu=G_;var nf="[object Map]",W_="[object Object]",af="[object Promise]",of="[object Set]",cf="[object WeakMap]",df="[object DataView]",J_=un(Mu),K_=un(Wa),z_=un(Du),Y_=un(Ou),Q_=un(Nu),fn=ln;(Mu&&fn(new Mu(new ArrayBuffer(1)))!=df||Wa&&fn(new Wa)!=nf||Du&&fn(Du.resolve())!=af||Ou&&fn(new Ou)!=of||Nu&&fn(new Nu)!=cf)&&(fn=function(s){var e=ln(s),t=e==W_?s.constructor:void 0,r=t?un(t):"";if(r)switch(r){case J_:return df;case K_:return nf;case z_:return af;case Y_:return of;case Q_:return cf}return e});const vi=fn;var X_=Object.prototype,Z_=X_.hasOwnProperty;function eb(s){var e=s.length,t=new s.constructor(e);return e&&typeof s[0]=="string"&&Z_.call(s,"index")&&(t.index=s.index,t.input=s.input),t}var tb=ms.Uint8Array;const sd=tb;function Lu(s){var e=new s.constructor(s.byteLength);return new sd(e).set(new sd(s)),e}function sb(s,e){var t=e?Lu(s.buffer):s.buffer;return new s.constructor(t,s.byteOffset,s.byteLength)}var rb=/\w*$/;function nb(s){var e=new s.constructor(s.source,rb.exec(s));return e.lastIndex=s.lastIndex,e}var lf=Sr?Sr.prototype:void 0,uf=lf?lf.valueOf:void 0;function ib(s){return uf?Object(uf.call(s)):{}}function hf(s,e){var t=e?Lu(s.buffer):s.buffer;return new s.constructor(t,s.byteOffset,s.length)}var ab="[object Boolean]",ob="[object Date]",cb="[object Map]",db="[object Number]",lb="[object RegExp]",ub="[object Set]",hb="[object String]",pb="[object Symbol]",mb="[object ArrayBuffer]",fb="[object DataView]",gb="[object Float32Array]",vb="[object Float64Array]",yb="[object Int8Array]",Tb="[object Int16Array]",Sb="[object Int32Array]",Eb="[object Uint8Array]",_b="[object Uint8ClampedArray]",bb="[object Uint16Array]",wb="[object Uint32Array]";function Pb(s,e,t){var r=s.constructor;switch(e){case mb:return Lu(s);case ab:case ob:return new r(+s);case fb:return sb(s,t);case gb:case vb:case yb:case Tb:case Sb:case Eb:case _b:case bb:case wb:return hf(s,t);case cb:return new r;case db:case hb:return new r(s);case lb:return nb(s);case ub:return new r;case pb:return ib(s)}}var pf=Object.create,Cb=function(){function s(){}return function(e){if(!fs(e))return{};if(pf)return pf(e);s.prototype=e;var t=new s;return s.prototype=void 0,t}}();const Rb=Cb;function mf(s){return typeof s.constructor=="function"&&!td(s)?Rb(Iu(s)):{}}var kb="[object Map]";function Ib(s){return Os(s)&&vi(s)==kb}var ff=gi&&gi.isMap,Ab=ff?Pu(ff):Ib;const Mb=Ab;var Db="[object Set]";function Ob(s){return Os(s)&&vi(s)==Db}var gf=gi&&gi.isSet,Nb=gf?Pu(gf):Ob;const Lb=Nb;var xb=1,Vb=2,Ub=4,vf="[object Arguments]",Fb="[object Array]",Bb="[object Boolean]",$b="[object Date]",Hb="[object Error]",yf="[object Function]",qb="[object GeneratorFunction]",jb="[object Map]",Gb="[object Number]",Tf="[object Object]",Wb="[object RegExp]",Jb="[object Set]",Kb="[object String]",zb="[object Symbol]",Yb="[object WeakMap]",Qb="[object ArrayBuffer]",Xb="[object DataView]",Zb="[object Float32Array]",ew="[object Float64Array]",tw="[object Int8Array]",sw="[object Int16Array]",rw="[object Int32Array]",nw="[object Uint8Array]",iw="[object Uint8ClampedArray]",aw="[object Uint16Array]",ow="[object Uint32Array]",Te={};Te[vf]=Te[Fb]=Te[Qb]=Te[Xb]=Te[Bb]=Te[$b]=Te[Zb]=Te[ew]=Te[tw]=Te[sw]=Te[rw]=Te[jb]=Te[Gb]=Te[Tf]=Te[Wb]=Te[Jb]=Te[Kb]=Te[zb]=Te[nw]=Te[iw]=Te[aw]=Te[ow]=!0,Te[Hb]=Te[yf]=Te[Yb]=!1;function rd(s,e,t,r,n,i){var a,c=e&xb,d=e&Vb,l=e&Ub;if(t&&(a=n?t(s,r,n,i):t(s)),a!==void 0)return a;if(!fs(s))return s;var h=Er(s);if(h){if(a=eb(s),!c)return Xm(s,a)}else{var p=vi(s),f=p==yf||p==qb;if(fi(s))return Qm(s,c);if(p==Tf||p==vf||f&&!n){if(a=d||f?{}:mf(s),!c)return d?B_(s,A_(a,s)):x_(s,P_(a,s))}else{if(!Te[p])return n?s:{};a=Pb(s,p,c)}}i||(i=new Ds);var y=i.get(s);if(y)return y;i.set(s,a),Lb(s)?s.forEach(function(I){a.add(rd(I,e,t,I,s,i))}):Mb(s)&&s.forEach(function(I,x){a.set(x,rd(I,e,t,x,s,i))});var _=l?d?$_:Au:d?Qa:Ru,b=h?void 0:_(s);return RE(b||s,function(I,x){b&&(x=I,I=s[x]),Nm(a,x,rd(I,e,t,x,s,i))}),a}var cw=1,dw=4;function xu(s){return rd(s,cw|dw)}var lw="[object Symbol]";function uw(s){return typeof s=="symbol"||Os(s)&&ln(s)==lw}var hw=Object.defineProperty,pw=(s,e)=>{for(var t in e)hw(s,t,{get:e[t],enumerable:!0})},mw={};pw(mw,{permissions:()=>fw,theme:()=>gw});var Et=(s=>(s.GroupCall="GROUP_CALL",s.Webinar="WEBINAR",s.AudioRoom="AUDIO_ROOM",s.Livestream="LIVESTREAM",s.Chat="CHAT",s))(Et||{}),W=(s=>(s.Allowed="ALLOWED",s.NotAllowed="NOT_ALLOWED",s.CanRequest="CAN_REQUEST",s))(W||{}),fw={view_type:"GROUP_CALL",accept_waiting_requests:!1,accept_present_requests:!1,request_produce:!1,can_allow_participant_audio:!1,can_allow_participant_screensharing:!1,can_allow_participant_video:!1,can_spotlight:!1,request_kick_participant:!1,kick_participant:!1,pin_participant:!1,can_edit_display_name:!1,can_record:!1,can_livestream:!1,can_present:!0,waiting_room_type:"SKIP_ON_ACCEPT",recorder_type:"NONE",plugins:{can_close:!0,can_start:!0},polls:{can_create:!0,can_vote:!0,can_view:!0},produce:{video:{allow:!0,quality:"vga",frame_rate:24},audio:!0,screenshare:{allow:!0,quality:"hd",frame_rate:5}},chat:{public:{can_send:!0,text:!0,files:!0},private:{can_send:!1,can_receive:!1,text:!1,files:!1}},connected_meetings:{can_alter_connected_meetings:!1,can_switch_connected_meetings:!1,can_switch_to_parent_meeting:!1},reactions:!1,hidden_participant:!1,is_recorder:!1,show_participant_list:!0,can_change_participant_role:!1,can_change_theme:!1,max_screenshare_count:1},gw={setup_screen:{is_enabled:!0},alone_here:{is_enabled:!0},waiting_room:{is_enabled:!1,enable_preview:!0},control_bar:{is_enabled:!0,elements:{plugins:!0,screenshare:!0,invite:!0,participants:!0,chat:!0,reactions:!1,polls:!0,fullscreen:!0,layout:!0}},header:{is_enabled:!0,elements:{timer:!0,title:!0,participant_count:!0,change_layout:!0}},pip_mode:!0,auto_tune:!0,grid:{multi:{maxVideoCount:6,videoFit:"cover"},single:{maxVideoCount:6,videoFit:"cover"},defaultView:"multi"},controls:{pip_toggle:!1}},Sf="hXgU8Wc8pwuGNq9ms5q9Hh";typeof process!="undefined"&&(ry=process==null?void 0:process.env)!=null&&ry.FLAGSMITH_ENVIRONMENT_KEY&&(Sf=process.env.FLAGSMITH_ENVIRONMENT_KEY);function vw(s=[]){const e={};return s.forEach(t=>{e[t.feature.name]={enabled:t.enabled,value:t.feature_state_value}}),e}var yw=class{constructor(s=Sf){m(this,"flags",{});m(this,"environmentKey",null);this.environmentKey=s}async identifyAndFetchFlagsWithRetry({primaryEndpoint:s,secondaryEndpoint:e,forceEvaluate:t,timeout:r,uniqueIdentifier:n,traitsObj:i,logger:a}){const c=JSON.parse(JSON.stringify(i)),d=Object.entries(c).map(h=>({trait_key:h[0],trait_value:h[1]})),l=[s,e,e];for(const h of l)try{const p="_"+(Math.random()+1).toString(36).substring(2),f=await TS.post(`https://${h}/api/v1/identities/`,{identifier:n+(t?p:""),traits:d},{headers:{"Content-Type":"application/json","X-Environment-Key":this.environmentKey},timeout:r});return vw(f.data.flags||[])}catch(p){a.error("Flagsmith identify failed!!",{error:p,url:h})}return{}}async identify(s,e={},t=!1,r=5e3,n="edge.api.flagsmith.com",i=console){return this.flags=await this.identifyAndFetchFlagsWithRetry({traitsObj:e,uniqueIdentifier:s,forceEvaluate:t,timeout:r,primaryEndpoint:n,secondaryEndpoint:"edge.api.flagsmith.com",logger:i}),this.flags}getValue(s){return this.flags&&this.flags[s]&&this.flags[s].value}hasFeature(s){return this.flags&&this.flags[s]&&this.flags[s].enabled}getAllFlags(){return this.flags}},ee=new yw,Ef=[-2,-1,0,1,2],Tw=[0,1,2,3,4];function Sw(s){s=s.trim();let e="0",t="0",r="0";return s.length==4?(e="0x"+s[1]+s[1],t="0x"+s[2]+s[2],r="0x"+s[3]+s[3]):s.length>6&&(e="0x"+s[1]+s[2],t="0x"+s[3]+s[4],r="0x"+s[5]+s[6]),[+e,+t,+r]}var Ew=(s,e,t)=>{let r,n,i;if(e==0)r=n=i=t;else{const a=(l,h,p)=>(p<0&&(p+=1),p>1&&(p-=1),p<.16666666666666666?l+(h-l)*6*p:p<.5?h:p<.6666666666666666?l+(h-l)*(.6666666666666666-p)*6:l),c=t<.5?t*(1+e):t+e-t*e,d=2*t-c;r=a(d,c,s+1/3),n=a(d,c,s),i=a(d,c,s-1/3)}return[Math.round(r*255),Math.round(n*255),Math.round(i*255)]},_w=(s,e,t)=>{s/=255,e/=255,t/=255;const r=Math.max(s,e,t),n=Math.min(s,e,t);let i,a;const c=(r+n)/2;if(r==n)i=a=0;else{const d=r-n;switch(a=c>.5?d/(2-r-n):d/(r+n),r){case s:i=(e-t)/d+(e<t?6:0);break;case e:i=(t-s)/d+2;break;case t:i=(s-e)/d+4;break}i/=6}return[i,a,c]},bw=(s,e,t)=>{const r=n=>n.toString(16).padStart(2,"0");return`#${r(s)}${r(e)}${r(t)}`},_f=(s,e=Ef,t=.4)=>{const r=[],[n,i,a]=Sw(s),[c,d,l]=_w(n,i,a),h=Math.round(l*100);h>70?t=.8:h>60?t=.9:h<10?t=.075:h<42&&(t=.3);const p=e.findIndex(I=>I===0);if(p===-1)throw new Error("Invalid reducer provided, it must contain atleast one zero");const f=5-p,y=p+1,_=(100-h)/f,b=h/y;for(const I of e){let x;I<0?x=h+I*b*t:I>0?x=h+I*_*t:x=h;const[B,H,M]=Ew(c,d,x/100);r.push(bw(B,H,M))}return r},bf={dark:{background:{1e3:"#252525",900:"#2F2F2F",800:"#323232",700:"#3E3E3E",600:"#4A4A4A"},text:"#F5F5F5","video-bg":"#1C1C1C"},light:{background:{1e3:"#FFFFFF",900:"#F5F5F5",800:"#EBEBEB",700:"#E0E0E0",600:"#D6D6D6"},text:"#111111","text-on-brand":"#ffffff","video-bg":"#DADADA"}},ww=s=>{const[e,t,r,n,i]=_f(s,Ef);return{300:e,400:t,500:r,600:n,700:i}},Pw=s=>{if(s==="#FFFFFF")return bf.light.background;if(s==="#000000")return bf.dark.background;const[e,t,r,n,i]=_f(s,Tw);return{1e3:e,900:t,800:r,700:n,600:i}},Cw={border_radius:"rounded",border_width:"thin",spacing_base:4,theme:"dark",colors:{brand:ww("#2160FD"),background:Pw("#141414"),danger:"#FF2D2D",text:"#EEEEEE",text_on_brand:"#EEEEEE",success:"#62A504",video_bg:"#191919",warning:"#FFCD07"}};function wf(){return xu(Cw)}var Rw={permissions:{can_accept_production_requests:!1,can_edit_display_name:!0,accept_waiting_requests:!1,disable_participant_audio:!1,disable_participant_screensharing:!1,disable_participant_video:!1,can_spotlight:!1,kick_participant:!1,pin_participant:!1,can_record:!1,can_livestream:!1,waiting_room_type:"SKIP",plugins:{can_close:!0,can_start:!0,can_edit_config:!1,config:{}},polls:{can_create:!0,can_vote:!0,can_view:!0},media:{video:{can_produce:"ALLOWED",can_consume:"ALLOWED"},audio:{can_produce:"ALLOWED"},screenshare:{can_produce:"ALLOWED",can_consume:"ALLOWED"}},chat:{public:{can_send:!0,text:!0,files:!0},private:{can_send:!1,can_receive:!1,text:!1,files:!1},channel:{can_create:"ALL",can_delete:"ALL",can_update:"ALL",can_read_all:!1},message:{can_delete:"ALL",can_edit:"ALL",delete_cutoff_time_seconds:0,edit_cutoff_time_seconds:0}},hidden_participant:!1,is_recorder:!1,recorder_type:"NONE",show_participant_list:!0,transcription_enabled:!1,can_change_participant_permissions:!1,connected_meetings:{can_alter_connected_meetings:!1,can_switch_connected_meetings:!1,can_switch_to_parent_meeting:!1},stage_enabled:!1,stage_access:void 0,accept_stage_requests:!1},ui:{oldTheme:{setup_screen:{is_enabled:!1},alone_here:{is_enabled:!1},waiting_room:{is_enabled:!1,enable_preview:!0},control_bar:{is_enabled:!0,elements:{plugins:!0,screenshare:!0,invite:!1,participants:!0,chat:!0,reactions:!1,polls:!0,fullscreen:!0,layout:!0}},header:{is_enabled:!0,elements:{timer:!0,title:!0,participant_count:!0,change_layout:!0}},pip_mode:!0,auto_tune:!0,colors:{primary:"#2160FD",secondary:"#1A1A1A",text:"#EEEEEE",background:"#1A1A1A",textPrimary:"#EEEEEE",videoBackground:"#1A1A1A"},dimensions:{mode:"fillParent"},grid:{multi:{maxVideoCount:6,videoFit:"cover"},single:{maxVideoCount:6,videoFit:"cover"},defaultView:"MULTI"},controls:{pip_toggle:!1},plugins:[]},design_tokens:wf(),config_diff:{}},config:{view_type:"GROUP_CALL",media:{audio:{enable_stereo:!1,enable_high_bitrate:!1},video:{quality:"vga",frame_rate:24},screenshare:{quality:"hd",frame_rate:5}},max_video_streams:{mobile:6,desktop:6},max_screenshare_count:1},version:"hybrid"};function kw(){return xu(Rw)}var Iw={permissions:{can_accept_production_requests:!1,can_edit_display_name:!0,accept_waiting_requests:!1,disable_participant_audio:!1,disable_participant_screensharing:!1,disable_participant_video:!1,can_spotlight:!1,kick_participant:!1,pin_participant:!1,can_record:!1,can_livestream:!1,waiting_room_type:"SKIP",plugins:{can_close:!0,can_start:!0,can_edit_config:!1,config:{}},polls:{can_create:!0,can_vote:!0,can_view:!0},media:{video:{can_produce:"ALLOWED"},audio:{can_produce:"ALLOWED"},screenshare:{can_produce:"ALLOWED"}},chat:{public:{can_send:!0,text:!0,files:!0},private:{can_send:!1,can_receive:!1,text:!1,files:!1}},hidden_participant:!1,is_recorder:!1,recorder_type:"NONE",show_participant_list:!0,transcription_enabled:!1,can_change_participant_permissions:!1,connected_meetings:{can_alter_connected_meetings:!1,can_switch_connected_meetings:!1,can_switch_to_parent_meeting:!1},stage_enabled:!1,stage_access:void 0,accept_stage_requests:!1},ui:{design_tokens:wf(),config_diff:{}},config:{view_type:"GROUP_CALL",media:{audio:{enable_stereo:!1,enable_high_bitrate:!1},video:{quality:"vga",frame_rate:24},screenshare:{quality:"hd",frame_rate:5}},max_video_streams:{mobile:6,desktop:6},max_screenshare_count:1},version:"2.0.0"};function Vu(){return xu(Iw)}var Aw=/\s/;function Mw(s){for(var e=s.length;e--&&Aw.test(s.charAt(e)););return e}var Dw=/^\s+/;function Ow(s){return s&&s.slice(0,Mw(s)+1).replace(Dw,"")}var Pf=0/0,Nw=/^[-+]0x[0-9a-f]+$/i,Lw=/^0b[01]+$/i,xw=/^0o[0-7]+$/i,Vw=parseInt;function Cf(s){if(typeof s=="number")return s;if(uw(s))return Pf;if(fs(s)){var e=typeof s.valueOf=="function"?s.valueOf():s;s=fs(e)?e+"":e}if(typeof s!="string")return s===0?s:+s;s=Ow(s);var t=Lw.test(s);return t||xw.test(s)?Vw(s.slice(2),t?2:8):Nw.test(s)?Pf:+s}function Rf(s){return s}function Uw(s,e,t){switch(t.length){case 0:return s.call(e);case 1:return s.call(e,t[0]);case 2:return s.call(e,t[0],t[1]);case 3:return s.call(e,t[0],t[1],t[2])}return s.apply(e,t)}var Fw=800,Bw=16,$w=Date.now;function Hw(s){var e=0,t=0;return function(){var r=$w(),n=Bw-(r-t);if(t=r,n>0){if(++e>=Fw)return arguments[0]}else e=0;return s.apply(void 0,arguments)}}function qw(s){return function(){return s}}var jw=Xc?function(s,e){return Xc(s,"toString",{configurable:!0,enumerable:!1,value:qw(e),writable:!0})}:Rf,Gw=Hw(jw);const Ww=Gw;var kf=Math.max;function Jw(s,e,t){return e=kf(e===void 0?s.length-1:e,0),function(){for(var r=arguments,n=-1,i=kf(r.length-e,0),a=Array(i);++n<i;)a[n]=r[e+n];n=-1;for(var c=Array(e+1);++n<e;)c[n]=r[n];return c[e]=t(a),Uw(s,this,c)}}function Kw(s,e){return Ww(Jw(s,e,Rf),s+"")}function zw(s,e,t){if(!fs(t))return!1;var r=typeof e;return(r=="number"?Ya(t)&&Bm(e,t.length):r=="string"&&e in t)?ja(t[e],s):!1}function Yw(s){return Kw(function(e,t){var r=-1,n=t.length,i=n>1?t[n-1]:void 0,a=n>2?t[2]:void 0;for(i=s.length>3&&typeof i=="function"?(n--,i):void 0,a&&zw(t[0],t[1],a)&&(i=n<3?void 0:i,n=1),e=Object(e);++r<n;){var c=t[r];c&&s(e,c,r,i)}return e})}var Qw="[object Object]",Xw=Function.prototype,Zw=Object.prototype,If=Xw.toString,eP=Zw.hasOwnProperty,tP=If.call(Object);function sP(s){if(!Os(s)||ln(s)!=Qw)return!1;var e=Iu(s);if(e===null)return!0;var t=eP.call(e,"constructor")&&e.constructor;return typeof t=="function"&&t instanceof t&&If.call(t)==tP}var rP="__lodash_hash_undefined__";function nP(s){return this.__data__.set(s,rP),this}function iP(s){return this.__data__.has(s)}function nd(s){var e=-1,t=s==null?0:s.length;for(this.__data__=new mn;++e<t;)this.add(s[e])}nd.prototype.add=nd.prototype.push=nP,nd.prototype.has=iP;function aP(s,e){for(var t=-1,r=s==null?0:s.length;++t<r;)if(e(s[t],t,s))return!0;return!1}function oP(s,e){return s.has(e)}var cP=1,dP=2;function Af(s,e,t,r,n,i){var a=t&cP,c=s.length,d=e.length;if(c!=d&&!(a&&d>c))return!1;var l=i.get(s),h=i.get(e);if(l&&h)return l==e&&h==s;var p=-1,f=!0,y=t&dP?new nd:void 0;for(i.set(s,e),i.set(e,s);++p<c;){var _=s[p],b=e[p];if(r)var I=a?r(b,_,p,e,s,i):r(_,b,p,s,e,i);if(I!==void 0){if(I)continue;f=!1;break}if(y){if(!aP(e,function(x,B){if(!oP(y,B)&&(_===x||n(_,x,t,r,i)))return y.push(B)})){f=!1;break}}else if(!(_===b||n(_,b,t,r,i))){f=!1;break}}return i.delete(s),i.delete(e),f}function lP(s){var e=-1,t=Array(s.size);return s.forEach(function(r,n){t[++e]=[n,r]}),t}function uP(s){var e=-1,t=Array(s.size);return s.forEach(function(r){t[++e]=r}),t}var hP=1,pP=2,mP="[object Boolean]",fP="[object Date]",gP="[object Error]",vP="[object Map]",yP="[object Number]",TP="[object RegExp]",SP="[object Set]",EP="[object String]",_P="[object Symbol]",bP="[object ArrayBuffer]",wP="[object DataView]",Mf=Sr?Sr.prototype:void 0,Uu=Mf?Mf.valueOf:void 0;function PP(s,e,t,r,n,i,a){switch(t){case wP:if(s.byteLength!=e.byteLength||s.byteOffset!=e.byteOffset)return!1;s=s.buffer,e=e.buffer;case bP:return!(s.byteLength!=e.byteLength||!i(new sd(s),new sd(e)));case mP:case fP:case yP:return ja(+s,+e);case gP:return s.name==e.name&&s.message==e.message;case TP:case EP:return s==e+"";case vP:var c=lP;case SP:var d=r&hP;if(c||(c=uP),s.size!=e.size&&!d)return!1;var l=a.get(s);if(l)return l==e;r|=pP,a.set(s,e);var h=Af(c(s),c(e),r,n,i,a);return a.delete(s),h;case _P:if(Uu)return Uu.call(s)==Uu.call(e)}return!1}var CP=1,RP=Object.prototype,kP=RP.hasOwnProperty;function IP(s,e,t,r,n,i){var a=t&CP,c=Au(s),d=c.length,l=Au(e),h=l.length;if(d!=h&&!a)return!1;for(var p=d;p--;){var f=c[p];if(!(a?f in e:kP.call(e,f)))return!1}var y=i.get(s),_=i.get(e);if(y&&_)return y==e&&_==s;var b=!0;i.set(s,e),i.set(e,s);for(var I=a;++p<d;){f=c[p];var x=s[f],B=e[f];if(r)var H=a?r(B,x,f,e,s,i):r(x,B,f,s,e,i);if(!(H===void 0?x===B||n(x,B,t,r,i):H)){b=!1;break}I||(I=f=="constructor")}if(b&&!I){var M=s.constructor,z=e.constructor;M!=z&&"constructor"in s&&"constructor"in e&&!(typeof M=="function"&&M instanceof M&&typeof z=="function"&&z instanceof z)&&(b=!1)}return i.delete(s),i.delete(e),b}var AP=1,Df="[object Arguments]",Of="[object Array]",id="[object Object]",MP=Object.prototype,Nf=MP.hasOwnProperty;function DP(s,e,t,r,n,i){var a=Er(s),c=Er(e),d=a?Of:vi(s),l=c?Of:vi(e);d=d==Df?id:d,l=l==Df?id:l;var h=d==id,p=l==id,f=d==l;if(f&&fi(s)){if(!fi(e))return!1;a=!0,h=!1}if(f&&!h)return i||(i=new Ds),a||ed(s)?Af(s,e,t,r,n,i):PP(s,e,d,t,r,n,i);if(!(t&AP)){var y=h&&Nf.call(s,"__wrapped__"),_=p&&Nf.call(e,"__wrapped__");if(y||_){var b=y?s.value():s,I=_?e.value():e;return i||(i=new Ds),n(b,I,t,r,i)}}return f?(i||(i=new Ds),IP(s,e,t,r,n,i)):!1}function Lf(s,e,t,r,n){return s===e?!0:s==null||e==null||!Os(s)&&!Os(e)?s!==s&&e!==e:DP(s,e,t,r,Lf,n)}function OP(s){return function(e,t,r){for(var n=-1,i=Object(e),a=r(e),c=a.length;c--;){var d=a[s?c:++n];if(t(i[d],d,i)===!1)break}return e}}var NP=OP();const LP=NP;var xP=function(){return ms.Date.now()};const Fu=xP;var VP="Expected a function",UP=Math.max,FP=Math.min;function ad(s,e,t){var r,n,i,a,c,d,l=0,h=!1,p=!1,f=!0;if(typeof s!="function")throw new TypeError(VP);e=Cf(e)||0,fs(t)&&(h=!!t.leading,p="maxWait"in t,i=p?UP(Cf(t.maxWait)||0,e):i,f="trailing"in t?!!t.trailing:f);function y(ne){var ue=r,ze=n;return r=n=void 0,l=ne,a=s.apply(ze,ue),a}function _(ne){return l=ne,c=setTimeout(x,e),h?y(ne):a}function b(ne){var ue=ne-d,ze=ne-l,Qt=e-ue;return p?FP(Qt,i-ze):Qt}function I(ne){var ue=ne-d,ze=ne-l;return d===void 0||ue>=e||ue<0||p&&ze>=i}function x(){var ne=Fu();if(I(ne))return B(ne);c=setTimeout(x,b(ne))}function B(ne){return c=void 0,f&&r?y(ne):(r=n=void 0,a)}function H(){c!==void 0&&clearTimeout(c),l=0,r=d=n=c=void 0}function M(){return c===void 0?a:B(Fu())}function z(){var ne=Fu(),ue=I(ne);if(r=arguments,n=this,d=ne,ue){if(c===void 0)return _(d);if(p)return clearTimeout(c),c=setTimeout(x,e),y(d)}return c===void 0&&(c=setTimeout(x,e)),a}return z.cancel=H,z.flush=M,z}function Bu(s,e,t){(t!==void 0&&!ja(s[e],t)||t===void 0&&!(e in s))&&wu(s,e,t)}function BP(s){return Os(s)&&Ya(s)}function $u(s,e){if(!(e==="constructor"&&typeof s[e]=="function")&&e!="__proto__")return s[e]}function $P(s){return Ka(s,Qa(s))}function HP(s,e,t,r,n,i,a){var c=$u(s,t),d=$u(e,t),l=a.get(d);if(l){Bu(s,t,l);return}var h=i?i(c,d,t+"",s,e,a):void 0,p=h===void 0;if(p){var f=Er(d),y=!f&&fi(d),_=!f&&!y&&ed(d);h=d,f||y||_?Er(c)?h=c:BP(c)?h=Xm(c):y?(p=!1,h=Qm(d,!0)):_?(p=!1,h=hf(d,!0)):h=[]:sP(d)||Zc(d)?(h=c,Zc(c)?h=$P(c):(!fs(c)||_u(c))&&(h=mf(d))):p=!1}p&&(a.set(d,h),n(h,d,r,i,a),a.delete(d)),Bu(s,t,h)}function xf(s,e,t,r,n){s!==e&&LP(e,function(i,a){if(n||(n=new Ds),fs(i))HP(s,e,a,t,xf,r,n);else{var c=r?r($u(s,a),i,a+"",s,e,n):void 0;c===void 0&&(c=i),Bu(s,a,c)}},Qa)}var qP="[object Map]",jP="[object Set]",GP=Object.prototype,WP=GP.hasOwnProperty;function JP(s){if(s==null)return!0;if(Ya(s)&&(Er(s)||typeof s=="string"||typeof s.splice=="function"||fi(s)||ed(s)||Zc(s)))return!s.length;var e=vi(s);if(e==qP||e==jP)return!s.size;if(td(s))return!Wm(s).length;for(var t in s)if(WP.call(s,t))return!1;return!0}function KP(s,e){return Lf(s,e)}var zP=Yw(function(s,e,t){xf(s,e,t)});const _r=zP;var Hu=(s=>(s.PARTICIPANT="PARTICIPANT",s.PEER="PEER",s.CLIENT="CLIENT",s))(Hu||{});const se={PROPAGATE_KICK_ALL:"propagate_kick_across_rooms",REFRESH_ID_ON_DISCONNECTION:"refresh_id_on_disconnection",SIMULCAST:"simulcast",CHAT_SOCKET_SERVER:"chat_socket_server",POLL_SOCKET_SERVER:"poll_socket_server",PLUGIN_SOCKET_SERVER:"plugin_socket_server",NR_OTEL_WEB:"nr_otel_web",ICE_RESTART_ON_FAILED_STATE:"ice_restart_on_failed_state",ICE_RESTART_ON_DISCONNECTED_STATE:"ice_restart_on_disconnected_state",ENABLE_ICE_STATE_LOGGING:"enable_ice_state_logging",SUPPRESS_PEER_MUTE_UNMUTE_EMITS:"web_core_suppress_peer_mute_unmute_emits",SKIP_OTEL_TRACES:"skip_otel_traces",USE_USERIDS_IN_CHAT:"use_userids_in_chat",CUSTOM_PING_PONG:"custom_ping_pong",ENABLE_HIVE_SIMULCAST:"enable_hive_simulcast",ENABLE_HIVE_TRANSPORT_RECONNECTION_ON_ICE_FAILED:"enable_hive_transport_reconnection_on_ice_failed",ENABLE_HIVE_EXPERIMENTAL_FAIL_RECOVERY:"enable_hive_fail_recovery",ENABLE_HIVE_INFINITE_RETRIES:"enable_hive_infinite_retries",HIVE_TRANSPORT_FORCE_RELAY_ON_ICE_FAILED:"hive_transport_force_relay_on_ice_failed",ENABLE_HIVE_CONSUME_OVER_DC:"enable_hive_consume_over_dc",ENABLE_CF_SIMULCAST:"enable_cf_simulcast",ENABLE_CF_TRANSPORT_RECONNECTION_ON_ICE_FAILED:"enable_cf_transport_reconnection_on_ice_failed",ENABLE_CF_EXPERIMENTAL_FAIL_RECOVERY:"enable_cf_fail_recovery",ENABLE_CF_INFINITE_RETRIES:"enable_cf_infinite_retries",CF_TRANSPORT_FORCE_RELAY_ON_ICE_FAILED:"cf_transport_force_relay_on_ice_failed",BYPASS_LOG_EXCLUSION_LIST:"bypass_log_exclusion_list",LOG_LEVEL:"log_level",V1_PLUGINS:"v1_plugins",SCREENSHARE_DTX:"screenshare_dtx",SCREENSHARE_PRIORITY:"screenshare_priority",SCREENSHARE_MIN_BITRATE:"screenshare_minbitrate",SCREENSHARE_SIMULCAST:"screenshare_simulcast",DISABLE_WEBCAM_LAYERS_ON_SCREENSHARE:"disable_webcam_layers_on_screenshare",SCREENSHARE_FORCE_GOOG_CONFERENCE:"screenshare_force_goog_conference",LIVESTREAM:"feat_livestream",FETCH_RETRY:"fetch_retry",DISABLE_WEBCAM_SIMULCAST:"webcore_disable_webcam_simulcast",OVERRIDE_WEBCAM_SIMULCAST:"override_webcam_simulcast",SOCKET_POLLING:"socket_polling",FEAT_PAGINATED_CHAT:"feat_paginated_chat",VAL_MIN_FRAMERATE:"val_min_framerate",SCREEENSHARE_ERR_HACK:"screenshare_err_hack",SCREEENSHARE_CONSTRAINTS_RETRY:"screenshare_constraints_retry",TROUBLESHOOTING:"feat_troubleshooting",VIDEO_CONSTRAINTS:"video_constraints",SCREENSHARE_CONSTRAINTS:"screenshare_constraints",FEAT_CHAT_SDK:"feat_chat_sdk",FEAT_CHAT_SDK_SEARCH:"chat_search",OBS_QUALITY:"obs_quality",ALLOW_SAFARI_MEDIA_MIDDLEWARES:"allow_safari_media_middlewares",DYNAMIC_VIDEO_QUALITY:"dynamic_video_quality",EXP_RESHARE:"exp_reshare",LEAVE_STAGE_ON_END:"leave_stage_on_end",SKIP_SETTING_IN_USE_DEVICE:"skip_setting_in_use_device",PRECALL_BANDWIDTH_TEST:"precall_bandwidth_test",CONSUMER_BIND_NO_RETRY:"consumer_bind_no_retry",DEBUG_SOCKET_JOIN:"debug_socket_join",FORCE_RELAY:"force_relay",FORCE_VIDEO_CODEC:"force_video_codec",USE_EXPERIMENTAL_SFU_HANDLER:"use_experimental_sfu_handler",TRACK_HINT:"track_hint",OVERRIDE_HIVE_SIMULCAST_DYNAMIC:"override_hive_simulcast_dynamic",PRECREATE_PRODUCERS:"precreate_producers"};function od(s){const e={};return typeof(s==null?void 0:s.code)=="number"&&(e.code=s.code),typeof(s==null?void 0:s.code)=="string"&&(e.code=s.code.substring(0,100)),typeof(s==null?void 0:s.name)=="string"&&(e.name=s.name.substring(0,500)),typeof(s==null?void 0:s.message)=="string"&&(e.message=s.message.substring(0,500)),typeof(s==null?void 0:s.reason)=="string"&&(e.reason=s.reason.substring(0,500)),typeof(s==null?void 0:s.stack)=="string"&&(e.stack=s.stack.substring(0,500)),e}function Vf(s){var r,n,i,a;const e=typeof navigator!="undefined"&&!navigator.isReactNative&&typeof window!="undefined"&&((r=window.location.host)==null?void 0:r.includes("devel"))&&((n=window.location.host)==null?void 0:n.includes("dyte.io")),t=!!((a=(i=s==null?void 0:s.getValue("modules"))==null?void 0:i.devTools)!=null&&a.logs);return e||t}function YP(s){var e;if(ee.hasFeature(se.LOG_LEVEL)){let t=((e=ee.getValue(se.LOG_LEVEL))==null?void 0:e.toString())||"all";if(t=t.toLowerCase().trim(),t==="off")return!1;if(t!=="all"){const r=["debug","log","info","warn","error"],n=r.indexOf(s),i=r.indexOf(t);if(n<i)return!1}}return!0}function Uf(s,e,t={}){return Object.getOwnPropertyNames(s).forEach(r=>{var i;if([null,void 0,NaN].includes(s[r])||e&&(((i=e.match(/\./g))==null?void 0:i.length)||0)>=10)return;const n=e?`${e}.${r}`:r;typeof s[r]=="object"?Uf(s[r],n,t):["number","string","boolean"].includes(typeof s[r])&&(t[n]=s[r])}),t}function Ff(s,e,t={},r=""){const n={};try{const i=JSON.stringify(t),a=JSON.parse(i),c=Uf(a,r),d=JSON.stringify(c);if(d.length>5e3){const l=`Log named: "${e}" is trying to log an flattened object of size
${d.length} chars that is beyond permitted limit of 5000 chars. Please optimize.`;throw Vf(s)&&console.error(l,{log:t,flattened:d}),new Error(l)}return JSON.parse(d)}catch(i){const a=od(i);n[`${r}.error.message`]=a.message||"",n[`${r}.error.stack`]=a.stack||"",n[`${r}.error.reason`]=a.reason||"",n[`${r}.error.source`]="safelyFlattenObjForOpenTelemetry"}return n}const QP={"Amazon Silk":"amazon_silk","Android Browser":"android",Bada:"bada",BlackBerry:"blackberry",Chrome:"chrome",Chromium:"chromium",Electron:"electron",Epiphany:"epiphany",Firefox:"firefox",Focus:"focus",Generic:"generic","Google Search":"google_search",Googlebot:"googlebot","Internet Explorer":"ie","K-Meleon":"k_meleon",Maxthon:"maxthon","Microsoft Edge":"edge","MZ Browser":"mz","NAVER Whale Browser":"naver",Opera:"opera","Opera Coast":"opera_coast",PhantomJS:"phantomjs",Puffin:"puffin",QupZilla:"qupzilla",QQ:"qq",QQLite:"qqlite",Safari:"safari",Sailfish:"sailfish","Samsung Internet for Android":"samsung_internet",SeaMonkey:"seamonkey",Sleipnir:"sleipnir",Swing:"swing",Tizen:"tizen","UC Browser":"uc",Vivaldi:"vivaldi","WebOS Browser":"webos",WeChat:"wechat","Yandex Browser":"yandex",Roku:"roku"},Bf={amazon_silk:"Amazon Silk",android:"Android Browser",bada:"Bada",blackberry:"BlackBerry",chrome:"Chrome",chromium:"Chromium",electron:"Electron",epiphany:"Epiphany",firefox:"Firefox",focus:"Focus",generic:"Generic",googlebot:"Googlebot",google_search:"Google Search",ie:"Internet Explorer",k_meleon:"K-Meleon",maxthon:"Maxthon",edge:"Microsoft Edge",mz:"MZ Browser",naver:"NAVER Whale Browser",opera:"Opera",opera_coast:"Opera Coast",phantomjs:"PhantomJS",puffin:"Puffin",qupzilla:"QupZilla",qq:"QQ Browser",qqlite:"QQ Browser Lite",safari:"Safari",sailfish:"Sailfish",samsung_internet:"Samsung Internet for Android",seamonkey:"SeaMonkey",sleipnir:"Sleipnir",swing:"Swing",tizen:"Tizen",uc:"UC Browser",vivaldi:"Vivaldi",webos:"WebOS Browser",wechat:"WeChat",yandex:"Yandex Browser"},Ue={tablet:"tablet",mobile:"mobile",desktop:"desktop",tv:"tv"},_t={WindowsPhone:"Windows Phone",Windows:"Windows",MacOS:"macOS",iOS:"iOS",Android:"Android",WebOS:"WebOS",BlackBerry:"BlackBerry",Bada:"Bada",Tizen:"Tizen",Linux:"Linux",ChromeOS:"Chrome OS",PlayStation4:"PlayStation 4",Roku:"Roku"},br={EdgeHTML:"EdgeHTML",Blink:"Blink",Trident:"Trident",Presto:"Presto",Gecko:"Gecko",WebKit:"WebKit"};class O{static getFirstMatch(e,t){const r=t.match(e);return r&&r.length>0&&r[1]||""}static getSecondMatch(e,t){const r=t.match(e);return r&&r.length>1&&r[2]||""}static matchAndReturnConst(e,t,r){if(e.test(t))return r}static getWindowsVersionName(e){switch(e){case"NT":return"NT";case"XP":return"XP";case"NT 5.0":return"2000";case"NT 5.1":return"XP";case"NT 5.2":return"2003";case"NT 6.0":return"Vista";case"NT 6.1":return"7";case"NT 6.2":return"8";case"NT 6.3":return"8.1";case"NT 10.0":return"10";default:return}}static getMacOSVersionName(e){const t=e.split(".").splice(0,2).map(r=>parseInt(r,10)||0);if(t.push(0),t[0]===10)switch(t[1]){case 5:return"Leopard";case 6:return"Snow Leopard";case 7:return"Lion";case 8:return"Mountain Lion";case 9:return"Mavericks";case 10:return"Yosemite";case 11:return"El Capitan";case 12:return"Sierra";case 13:return"High Sierra";case 14:return"Mojave";case 15:return"Catalina";default:return}}static getAndroidVersionName(e){const t=e.split(".").splice(0,2).map(r=>parseInt(r,10)||0);if(t.push(0),!(t[0]===1&&t[1]<5)){if(t[0]===1&&t[1]<6)return"Cupcake";if(t[0]===1&&t[1]>=6)return"Donut";if(t[0]===2&&t[1]<2)return"Eclair";if(t[0]===2&&t[1]===2)return"Froyo";if(t[0]===2&&t[1]>2)return"Gingerbread";if(t[0]===3)return"Honeycomb";if(t[0]===4&&t[1]<1)return"Ice Cream Sandwich";if(t[0]===4&&t[1]<4)return"Jelly Bean";if(t[0]===4&&t[1]>=4)return"KitKat";if(t[0]===5)return"Lollipop";if(t[0]===6)return"Marshmallow";if(t[0]===7)return"Nougat";if(t[0]===8)return"Oreo";if(t[0]===9)return"Pie"}}static getVersionPrecision(e){return e.split(".").length}static compareVersions(e,t,r=!1){const n=O.getVersionPrecision(e),i=O.getVersionPrecision(t);let a=Math.max(n,i),c=0;const d=O.map([e,t],l=>{const h=a-O.getVersionPrecision(l),p=l+new Array(h+1).join(".0");return O.map(p.split("."),f=>new Array(20-f.length).join("0")+f).reverse()});for(r&&(c=a-Math.min(n,i)),a-=1;a>=c;){if(d[0][a]>d[1][a])return 1;if(d[0][a]===d[1][a]){if(a===c)return 0;a-=1}else if(d[0][a]<d[1][a])return-1}}static map(e,t){const r=[];let n;if(Array.prototype.map)return Array.prototype.map.call(e,t);for(n=0;n<e.length;n+=1)r.push(t(e[n]));return r}static find(e,t){let r,n;if(Array.prototype.find)return Array.prototype.find.call(e,t);for(r=0,n=e.length;r<n;r+=1){const i=e[r];if(t(i,r))return i}}static assign(e,...t){const r=e;let n,i;if(Object.assign)return Object.assign(e,...t);for(n=0,i=t.length;n<i;n+=1){const a=t[n];typeof a=="object"&&a!==null&&Object.keys(a).forEach(d=>{r[d]=a[d]})}return e}static getBrowserAlias(e){return QP[e]}static getBrowserTypeByAlias(e){return Bf[e]||""}}const fe=/version\/(\d+(\.?_?\d+)+)/i,XP=[{test:[/googlebot/i],describe(s){const e={name:"Googlebot"},t=O.getFirstMatch(/googlebot\/(\d+(\.\d+))/i,s)||O.getFirstMatch(fe,s);return t&&(e.version=t),e}},{test:[/opera/i],describe(s){const e={name:"Opera"},t=O.getFirstMatch(fe,s)||O.getFirstMatch(/(?:opera)[\s/](\d+(\.?_?\d+)+)/i,s);return t&&(e.version=t),e}},{test:[/opr\/|opios/i],describe(s){const e={name:"Opera"},t=O.getFirstMatch(/(?:opr|opios)[\s/](\S+)/i,s)||O.getFirstMatch(fe,s);return t&&(e.version=t),e}},{test:[/SamsungBrowser/i],describe(s){const e={name:"Samsung Internet for Android"},t=O.getFirstMatch(fe,s)||O.getFirstMatch(/(?:SamsungBrowser)[\s/](\d+(\.?_?\d+)+)/i,s);return t&&(e.version=t),e}},{test:[/Whale/i],describe(s){const e={name:"NAVER Whale Browser"},t=O.getFirstMatch(fe,s)||O.getFirstMatch(/(?:whale)[\s/](\d+(?:\.\d+)+)/i,s);return t&&(e.version=t),e}},{test:[/MZBrowser/i],describe(s){const e={name:"MZ Browser"},t=O.getFirstMatch(/(?:MZBrowser)[\s/](\d+(?:\.\d+)+)/i,s)||O.getFirstMatch(fe,s);return t&&(e.version=t),e}},{test:[/focus/i],describe(s){const e={name:"Focus"},t=O.getFirstMatch(/(?:focus)[\s/](\d+(?:\.\d+)+)/i,s)||O.getFirstMatch(fe,s);return t&&(e.version=t),e}},{test:[/swing/i],describe(s){const e={name:"Swing"},t=O.getFirstMatch(/(?:swing)[\s/](\d+(?:\.\d+)+)/i,s)||O.getFirstMatch(fe,s);return t&&(e.version=t),e}},{test:[/coast/i],describe(s){const e={name:"Opera Coast"},t=O.getFirstMatch(fe,s)||O.getFirstMatch(/(?:coast)[\s/](\d+(\.?_?\d+)+)/i,s);return t&&(e.version=t),e}},{test:[/opt\/\d+(?:.?_?\d+)+/i],describe(s){const e={name:"Opera Touch"},t=O.getFirstMatch(/(?:opt)[\s/](\d+(\.?_?\d+)+)/i,s)||O.getFirstMatch(fe,s);return t&&(e.version=t),e}},{test:[/yabrowser/i],describe(s){const e={name:"Yandex Browser"},t=O.getFirstMatch(/(?:yabrowser)[\s/](\d+(\.?_?\d+)+)/i,s)||O.getFirstMatch(fe,s);return t&&(e.version=t),e}},{test:[/ucbrowser/i],describe(s){const e={name:"UC Browser"},t=O.getFirstMatch(fe,s)||O.getFirstMatch(/(?:ucbrowser)[\s/](\d+(\.?_?\d+)+)/i,s);return t&&(e.version=t),e}},{test:[/Maxthon|mxios/i],describe(s){const e={name:"Maxthon"},t=O.getFirstMatch(fe,s)||O.getFirstMatch(/(?:Maxthon|mxios)[\s/](\d+(\.?_?\d+)+)/i,s);return t&&(e.version=t),e}},{test:[/epiphany/i],describe(s){const e={name:"Epiphany"},t=O.getFirstMatch(fe,s)||O.getFirstMatch(/(?:epiphany)[\s/](\d+(\.?_?\d+)+)/i,s);return t&&(e.version=t),e}},{test:[/puffin/i],describe(s){const e={name:"Puffin"},t=O.getFirstMatch(fe,s)||O.getFirstMatch(/(?:puffin)[\s/](\d+(\.?_?\d+)+)/i,s);return t&&(e.version=t),e}},{test:[/sleipnir/i],describe(s){const e={name:"Sleipnir"},t=O.getFirstMatch(fe,s)||O.getFirstMatch(/(?:sleipnir)[\s/](\d+(\.?_?\d+)+)/i,s);return t&&(e.version=t),e}},{test:[/k-meleon/i],describe(s){const e={name:"K-Meleon"},t=O.getFirstMatch(fe,s)||O.getFirstMatch(/(?:k-meleon)[\s/](\d+(\.?_?\d+)+)/i,s);return t&&(e.version=t),e}},{test:[/micromessenger/i],describe(s){const e={name:"WeChat"},t=O.getFirstMatch(/(?:micromessenger)[\s/](\d+(\.?_?\d+)+)/i,s)||O.getFirstMatch(fe,s);return t&&(e.version=t),e}},{test:[/qqbrowser/i],describe(s){const e={name:/qqbrowserlite/i.test(s)?"QQ Browser Lite":"QQ Browser"},t=O.getFirstMatch(/(?:qqbrowserlite|qqbrowser)[/](\d+(\.?_?\d+)+)/i,s)||O.getFirstMatch(fe,s);return t&&(e.version=t),e}},{test:[/msie|trident/i],describe(s){const e={name:"Internet Explorer"},t=O.getFirstMatch(/(?:msie |rv:)(\d+(\.?_?\d+)+)/i,s);return t&&(e.version=t),e}},{test:[/\sedg\//i],describe(s){const e={name:"Microsoft Edge"},t=O.getFirstMatch(/\sedg\/(\d+(\.?_?\d+)+)/i,s);return t&&(e.version=t),e}},{test:[/edg([ea]|ios)/i],describe(s){const e={name:"Microsoft Edge"},t=O.getSecondMatch(/edg([ea]|ios)\/(\d+(\.?_?\d+)+)/i,s);return t&&(e.version=t),e}},{test:[/vivaldi/i],describe(s){const e={name:"Vivaldi"},t=O.getFirstMatch(/vivaldi\/(\d+(\.?_?\d+)+)/i,s);return t&&(e.version=t),e}},{test:[/seamonkey/i],describe(s){const e={name:"SeaMonkey"},t=O.getFirstMatch(/seamonkey\/(\d+(\.?_?\d+)+)/i,s);return t&&(e.version=t),e}},{test:[/sailfish/i],describe(s){const e={name:"Sailfish"},t=O.getFirstMatch(/sailfish\s?browser\/(\d+(\.\d+)?)/i,s);return t&&(e.version=t),e}},{test:[/silk/i],describe(s){const e={name:"Amazon Silk"},t=O.getFirstMatch(/silk\/(\d+(\.?_?\d+)+)/i,s);return t&&(e.version=t),e}},{test:[/phantom/i],describe(s){const e={name:"PhantomJS"},t=O.getFirstMatch(/phantomjs\/(\d+(\.?_?\d+)+)/i,s);return t&&(e.version=t),e}},{test:[/slimerjs/i],describe(s){const e={name:"SlimerJS"},t=O.getFirstMatch(/slimerjs\/(\d+(\.?_?\d+)+)/i,s);return t&&(e.version=t),e}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe(s){const e={name:"BlackBerry"},t=O.getFirstMatch(fe,s)||O.getFirstMatch(/blackberry[\d]+\/(\d+(\.?_?\d+)+)/i,s);return t&&(e.version=t),e}},{test:[/(web|hpw)[o0]s/i],describe(s){const e={name:"WebOS Browser"},t=O.getFirstMatch(fe,s)||O.getFirstMatch(/w(?:eb)?[o0]sbrowser\/(\d+(\.?_?\d+)+)/i,s);return t&&(e.version=t),e}},{test:[/bada/i],describe(s){const e={name:"Bada"},t=O.getFirstMatch(/dolfin\/(\d+(\.?_?\d+)+)/i,s);return t&&(e.version=t),e}},{test:[/tizen/i],describe(s){const e={name:"Tizen"},t=O.getFirstMatch(/(?:tizen\s?)?browser\/(\d+(\.?_?\d+)+)/i,s)||O.getFirstMatch(fe,s);return t&&(e.version=t),e}},{test:[/qupzilla/i],describe(s){const e={name:"QupZilla"},t=O.getFirstMatch(/(?:qupzilla)[\s/](\d+(\.?_?\d+)+)/i,s)||O.getFirstMatch(fe,s);return t&&(e.version=t),e}},{test:[/firefox|iceweasel|fxios/i],describe(s){const e={name:"Firefox"},t=O.getFirstMatch(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,s);return t&&(e.version=t),e}},{test:[/electron/i],describe(s){const e={name:"Electron"},t=O.getFirstMatch(/(?:electron)\/(\d+(\.?_?\d+)+)/i,s);return t&&(e.version=t),e}},{test:[/MiuiBrowser/i],describe(s){const e={name:"Miui"},t=O.getFirstMatch(/(?:MiuiBrowser)[\s/](\d+(\.?_?\d+)+)/i,s);return t&&(e.version=t),e}},{test:[/chromium/i],describe(s){const e={name:"Chromium"},t=O.getFirstMatch(/(?:chromium)[\s/](\d+(\.?_?\d+)+)/i,s)||O.getFirstMatch(fe,s);return t&&(e.version=t),e}},{test:[/chrome|crios|crmo/i],describe(s){const e={name:"Chrome"},t=O.getFirstMatch(/(?:chrome|crios|crmo)\/(\d+(\.?_?\d+)+)/i,s);return t&&(e.version=t),e}},{test:[/GSA/i],describe(s){const e={name:"Google Search"},t=O.getFirstMatch(/(?:GSA)\/(\d+(\.?_?\d+)+)/i,s);return t&&(e.version=t),e}},{test(s){const e=!s.test(/like android/i),t=s.test(/android/i);return e&&t},describe(s){const e={name:"Android Browser"},t=O.getFirstMatch(fe,s);return t&&(e.version=t),e}},{test:[/playstation 4/i],describe(s){const e={name:"PlayStation 4"},t=O.getFirstMatch(fe,s);return t&&(e.version=t),e}},{test:[/safari|applewebkit/i],describe(s){const e={name:"Safari"},t=O.getFirstMatch(fe,s);return t&&(e.version=t),e}},{test:[/.*/i],describe(s){const e=/^(.*)\/(.*) /,t=/^(.*)\/(.*)[ \t]\((.*)/,n=s.search("\\(")!==-1?t:e;return{name:O.getFirstMatch(n,s),version:O.getSecondMatch(n,s)}}}],ZP=[{test:[/Roku\/DVP/],describe(s){const e=O.getFirstMatch(/Roku\/DVP-(\d+\.\d+)/i,s);return{name:_t.Roku,version:e}}},{test:[/windows phone/i],describe(s){const e=O.getFirstMatch(/windows phone (?:os)?\s?(\d+(\.\d+)*)/i,s);return{name:_t.WindowsPhone,version:e}}},{test:[/windows /i],describe(s){const e=O.getFirstMatch(/Windows ((NT|XP)( \d\d?.\d)?)/i,s),t=O.getWindowsVersionName(e);return{name:_t.Windows,version:e,versionName:t}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe(s){const e={name:_t.iOS},t=O.getSecondMatch(/(Version\/)(\d[\d.]+)/,s);return t&&(e.version=t),e}},{test:[/macintosh/i],describe(s){const e=O.getFirstMatch(/mac os x (\d+(\.?_?\d+)+)/i,s).replace(/[_\s]/g,"."),t=O.getMacOSVersionName(e),r={name:_t.MacOS,version:e};return t&&(r.versionName=t),r}},{test:[/(ipod|iphone|ipad)/i],describe(s){const e=O.getFirstMatch(/os (\d+([_\s]\d+)*) like mac os x/i,s).replace(/[_\s]/g,".");return{name:_t.iOS,version:e}}},{test(s){const e=!s.test(/like android/i),t=s.test(/android/i);return e&&t},describe(s){const e=O.getFirstMatch(/android[\s/-](\d+(\.\d+)*)/i,s),t=O.getAndroidVersionName(e),r={name:_t.Android,version:e};return t&&(r.versionName=t),r}},{test:[/(web|hpw)[o0]s/i],describe(s){const e=O.getFirstMatch(/(?:web|hpw)[o0]s\/(\d+(\.\d+)*)/i,s),t={name:_t.WebOS};return e&&e.length&&(t.version=e),t}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe(s){const e=O.getFirstMatch(/rim\stablet\sos\s(\d+(\.\d+)*)/i,s)||O.getFirstMatch(/blackberry\d+\/(\d+([_\s]\d+)*)/i,s)||O.getFirstMatch(/\bbb(\d+)/i,s);return{name:_t.BlackBerry,version:e}}},{test:[/bada/i],describe(s){const e=O.getFirstMatch(/bada\/(\d+(\.\d+)*)/i,s);return{name:_t.Bada,version:e}}},{test:[/tizen/i],describe(s){const e=O.getFirstMatch(/tizen[/\s](\d+(\.\d+)*)/i,s);return{name:_t.Tizen,version:e}}},{test:[/linux/i],describe(){return{name:_t.Linux}}},{test:[/CrOS/],describe(){return{name:_t.ChromeOS}}},{test:[/PlayStation 4/],describe(s){const e=O.getFirstMatch(/PlayStation 4[/\s](\d+(\.\d+)*)/i,s);return{name:_t.PlayStation4,version:e}}}],eC=[{test:[/googlebot/i],describe(){return{type:"bot",vendor:"Google"}}},{test:[/huawei/i],describe(s){const e=O.getFirstMatch(/(can-l01)/i,s)&&"Nova",t={type:Ue.mobile,vendor:"Huawei"};return e&&(t.model=e),t}},{test:[/nexus\s*(?:7|8|9|10).*/i],describe(){return{type:Ue.tablet,vendor:"Nexus"}}},{test:[/ipad/i],describe(){return{type:Ue.tablet,vendor:"Apple",model:"iPad"}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe(){return{type:Ue.tablet,vendor:"Apple",model:"iPad"}}},{test:[/kftt build/i],describe(){return{type:Ue.tablet,vendor:"Amazon",model:"Kindle Fire HD 7"}}},{test:[/silk/i],describe(){return{type:Ue.tablet,vendor:"Amazon"}}},{test:[/tablet(?! pc)/i],describe(){return{type:Ue.tablet}}},{test(s){const e=s.test(/ipod|iphone/i),t=s.test(/like (ipod|iphone)/i);return e&&!t},describe(s){const e=O.getFirstMatch(/(ipod|iphone)/i,s);return{type:Ue.mobile,vendor:"Apple",model:e}}},{test:[/nexus\s*[0-6].*/i,/galaxy nexus/i],describe(){return{type:Ue.mobile,vendor:"Nexus"}}},{test:[/[^-]mobi/i],describe(){return{type:Ue.mobile}}},{test(s){return s.getBrowserName(!0)==="blackberry"},describe(){return{type:Ue.mobile,vendor:"BlackBerry"}}},{test(s){return s.getBrowserName(!0)==="bada"},describe(){return{type:Ue.mobile}}},{test(s){return s.getBrowserName()==="windows phone"},describe(){return{type:Ue.mobile,vendor:"Microsoft"}}},{test(s){const e=Number(String(s.getOSVersion()).split(".")[0]);return s.getOSName(!0)==="android"&&e>=3},describe(){return{type:Ue.tablet}}},{test(s){return s.getOSName(!0)==="android"},describe(){return{type:Ue.mobile}}},{test(s){return s.getOSName(!0)==="macos"},describe(){return{type:Ue.desktop,vendor:"Apple"}}},{test(s){return s.getOSName(!0)==="windows"},describe(){return{type:Ue.desktop}}},{test(s){return s.getOSName(!0)==="linux"},describe(){return{type:Ue.desktop}}},{test(s){return s.getOSName(!0)==="playstation 4"},describe(){return{type:Ue.tv}}},{test(s){return s.getOSName(!0)==="roku"},describe(){return{type:Ue.tv}}}],tC=[{test(s){return s.getBrowserName(!0)==="microsoft edge"},describe(s){if(/\sedg\//i.test(s))return{name:br.Blink};const t=O.getFirstMatch(/edge\/(\d+(\.?_?\d+)+)/i,s);return{name:br.EdgeHTML,version:t}}},{test:[/trident/i],describe(s){const e={name:br.Trident},t=O.getFirstMatch(/trident\/(\d+(\.?_?\d+)+)/i,s);return t&&(e.version=t),e}},{test(s){return s.test(/presto/i)},describe(s){const e={name:br.Presto},t=O.getFirstMatch(/presto\/(\d+(\.?_?\d+)+)/i,s);return t&&(e.version=t),e}},{test(s){const e=s.test(/gecko/i),t=s.test(/like gecko/i);return e&&!t},describe(s){const e={name:br.Gecko},t=O.getFirstMatch(/gecko\/(\d+(\.?_?\d+)+)/i,s);return t&&(e.version=t),e}},{test:[/(apple)?webkit\/537\.36/i],describe(){return{name:br.Blink}}},{test:[/(apple)?webkit/i],describe(s){const e={name:br.WebKit},t=O.getFirstMatch(/webkit\/(\d+(\.?_?\d+)+)/i,s);return t&&(e.version=t),e}}];class $f{constructor(e,t=!1){if(e==null||e==="")throw new Error("UserAgent parameter can't be empty");this._ua=e,this.parsedResult={},t!==!0&&this.parse()}getUA(){return this._ua}test(e){return e.test(this._ua)}parseBrowser(){this.parsedResult.browser={};const e=O.find(XP,t=>{if(typeof t.test=="function")return t.test(this);if(t.test instanceof Array)return t.test.some(r=>this.test(r));throw new Error("Browser's test function is not valid")});return e&&(this.parsedResult.browser=e.describe(this.getUA())),this.parsedResult.browser}getBrowser(){return this.parsedResult.browser?this.parsedResult.browser:this.parseBrowser()}getBrowserName(e){return e?String(this.getBrowser().name).toLowerCase()||"":this.getBrowser().name||""}getBrowserVersion(){return this.getBrowser().version}getOS(){return this.parsedResult.os?this.parsedResult.os:this.parseOS()}parseOS(){this.parsedResult.os={};const e=O.find(ZP,t=>{if(typeof t.test=="function")return t.test(this);if(t.test instanceof Array)return t.test.some(r=>this.test(r));throw new Error("Browser's test function is not valid")});return e&&(this.parsedResult.os=e.describe(this.getUA())),this.parsedResult.os}getOSName(e){const{name:t}=this.getOS();return e?String(t).toLowerCase()||"":t||""}getOSVersion(){return this.getOS().version}getPlatform(){return this.parsedResult.platform?this.parsedResult.platform:this.parsePlatform()}getPlatformType(e=!1){const{type:t}=this.getPlatform();return e?String(t).toLowerCase()||"":t||""}parsePlatform(){this.parsedResult.platform={};const e=O.find(eC,t=>{if(typeof t.test=="function")return t.test(this);if(t.test instanceof Array)return t.test.some(r=>this.test(r));throw new Error("Browser's test function is not valid")});return e&&(this.parsedResult.platform=e.describe(this.getUA())),this.parsedResult.platform}getEngine(){return this.parsedResult.engine?this.parsedResult.engine:this.parseEngine()}getEngineName(e){return e?String(this.getEngine().name).toLowerCase()||"":this.getEngine().name||""}parseEngine(){this.parsedResult.engine={};const e=O.find(tC,t=>{if(typeof t.test=="function")return t.test(this);if(t.test instanceof Array)return t.test.some(r=>this.test(r));throw new Error("Browser's test function is not valid")});return e&&(this.parsedResult.engine=e.describe(this.getUA())),this.parsedResult.engine}parse(){return this.parseBrowser(),this.parseOS(),this.parsePlatform(),this.parseEngine(),this}getResult(){return O.assign({},this.parsedResult)}satisfies(e){const t={};let r=0;const n={};let i=0;if(Object.keys(e).forEach(c=>{const d=e[c];typeof d=="string"?(n[c]=d,i+=1):typeof d=="object"&&(t[c]=d,r+=1)}),r>0){const c=Object.keys(t),d=O.find(c,h=>this.isOS(h));if(d){const h=this.satisfies(t[d]);if(h!==void 0)return h}const l=O.find(c,h=>this.isPlatform(h));if(l){const h=this.satisfies(t[l]);if(h!==void 0)return h}}if(i>0){const c=Object.keys(n),d=O.find(c,l=>this.isBrowser(l,!0));if(d!==void 0)return this.compareVersion(n[d])}}isBrowser(e,t=!1){const r=this.getBrowserName().toLowerCase();let n=e.toLowerCase();const i=O.getBrowserTypeByAlias(n);return t&&i&&(n=i.toLowerCase()),n===r}compareVersion(e){let t=[0],r=e,n=!1;const i=this.getBrowserVersion();if(typeof i=="string")return e[0]===">"||e[0]==="<"?(r=e.substr(1),e[1]==="="?(n=!0,r=e.substr(2)):t=[],e[0]===">"?t.push(1):t.push(-1)):e[0]==="="?r=e.substr(1):e[0]==="~"&&(n=!0,r=e.substr(1)),t.indexOf(O.compareVersions(i,r,n))>-1}isOS(e){return this.getOSName(!0)===String(e).toLowerCase()}isPlatform(e){return this.getPlatformType(!0)===String(e).toLowerCase()}isEngine(e){return this.getEngineName(!0)===String(e).toLowerCase()}is(e,t=!1){return this.isBrowser(e,t)||this.isOS(e)||this.isPlatform(e)}some(e=[]){return e.some(t=>this.is(t))}}/*!
 * Bowser - a browser detector
 * https://github.com/lancedikson/bowser
 * MIT License | (c) Dustin Diaz 2012-2015
 * MIT License | (c) Denis Demchenko 2015-2019
 */class Hf{static getParser(e,t=!1){if(typeof e!="string")throw new Error("UserAgent should be a string");return new $f(e,t)}static parse(e){return new $f(e).getResult()}static get BROWSER_MAP(){return Bf}static get ENGINE_MAP(){return br}static get OS_MAP(){return _t}static get PLATFORMS_MAP(){return Ue}}const Xa="chrome",qf="opera",jf="firefox",Gf="iexplorer",Wf="safari",Jf="nwjs",Kf="electron",zf="react-native",qu="unknown",cd={Chrome:Xa,Chromium:Xa,Opera:qf,Firefox:jf,"Internet Explorer":Gf,Safari:Wf};function sC(){const{userAgent:s}=navigator,e={name:qu,version:void 0};if(s.match(/Chrome/)&&!s.match(/Edge/))if(s.match(/Edg(A?)/)){const t=s.match(/Chrome\/([\d.]+)/)[1];Number.parseInt(t,10)>72&&(e.name=Xa,e.version=t)}else e.name=Xa,e.version=s.match(/Chrome\/([\d.]+)/)[1];return e}function rC(){const{userAgent:s}=navigator;if(s.match(/Electron/)){const e=s.match(/Electron\/([\d.]+)/)[1];return{name:Kf,version:e}}return null}function nC(){const{userAgent:s}=navigator;if(s.match(/JitsiMeetNW/)){const e=s.match(/JitsiMeetNW\/([\d.]+)/)[1];return{name:Jf,version:e}}}function iC(){const s=navigator.userAgent.match(/\b(react[ \t_-]*native)(?:\/(\S+))?/i);let e;if(s||navigator.product==="ReactNative")return s&&s.length>2&&(s[1],e=s[2]),e||(e="unknown"),{name:zf,version:e}}function aC(s){let e;const t=[iC,rC,nC];for(let n=0;n<t.length;n+=1)if(e=t[n](),e)return e;const r=s.getBrowserName();return r in cd?{name:cd[r],version:s.getBrowserVersion()}:(e=sC(),e||{name:qu,version:void 0})}class oC{constructor(){m(this,"_bowser");m(this,"_name");m(this,"_version");m(this,"getDeviceInfo",()=>({isMobile:this.isMobile(),browserName:this._bowser.getBrowserName(),osName:this._bowser.getOSName(),browserVersion:this._bowser.getBrowserVersion(),osVersionName:this._bowser.getOSVersion(),engineName:this._bowser.getEngineName()}))}init(e){let t,r;if(this._bowser=Hf.getParser(navigator.userAgent),typeof e=="undefined"){const n=aC(this._bowser);t=n.name,r=n.version}else e.name in cd?(t=cd[e.name],r=e.version):(t=qu,r=void 0);this._name=t,this._version=r}getName(){return this._name}isChrome(){return this._name===Xa}isOpera(){return this._name===qf}isFirefox(){return this._name===jf}isIExplorer(){return this._name===Gf}isSafari(){return this._name===Wf}isNWJS(){return this._name===Jf}isElectron(){return this._name===Kf}isReactNative(){return this._name===zf||navigator.isReactNative===!0}getVersion(){return this._version}isMobile(){return this._bowser.getPlatformType()==="mobile"}_checkCondition(e){if(this._version)return this._bowser.satisfies(e)}isVersionGreaterThan(e){return this._checkCondition({[this._name]:`>${e}`})}isVersionLessThan(e){return this._checkCondition({[this._name]:`<${e}`})}isVersionEqualTo(e){return this._checkCondition({[this._name]:`~${e}`})}}class cC extends oC{doesVideoMuteByStreamRemove(){return this.isChromiumBased()||this.isWebKitBased()}supportsP2P(){return!this.usesUnifiedPlan()}isChromiumBased(){return this.isChrome()||this.isElectron()||this.isNWJS()||this.isOpera()}isWebKitBased(){return this._bowser.isEngine("webkit")&&typeof navigator.mediaDevices!="undefined"&&typeof navigator.mediaDevices.getUserMedia!="undefined"&&typeof window.RTCRtpTransceiver!="undefined"&&Object.keys(RTCRtpTransceiver.prototype).indexOf("currentDirection")>-1}isSupported(){return typeof RTCPeerConnection!="undefined"}isUserInteractionRequiredForUnmute(){return this.isFirefox()&&this.isVersionLessThan("68")}supportsVideoMuteOnConnInterrupted(){return this.isChromiumBased()||this.isReactNative()||this.isWebKitBased()}supportsBandwidthStatistics(){return!this.isFirefox()&&!this.isWebKitBased()}supportsCodecPreferences(){return this.usesUnifiedPlan()&&typeof window.RTCRtpTransceiver!="undefined"&&Object.keys(window.RTCRtpTransceiver.prototype).indexOf("setCodecPreferences")>-1&&Object.keys(RTCRtpSender.prototype).indexOf("getCapabilities")>-1&&!this.isWebKitBased()}supportsDeviceChangeEvent(){return navigator.mediaDevices&&typeof navigator.mediaDevices.ondevicechange!="undefined"&&typeof navigator.mediaDevices.addEventListener!="undefined"}supportsLocalCandidateRttStatistics(){return this.isChromiumBased()||this.isReactNative()||this.isWebKitBased()}supportsPerformanceObserver(){return typeof window.PerformanceObserver!="undefined"&&PerformanceObserver.supportedEntryTypes.indexOf("longtask")>-1}supportsReceiverStats(){return typeof window.RTCRtpReceiver!="undefined"&&Object.keys(RTCRtpReceiver.prototype).indexOf("getSynchronizationSources")>-1}supportsRTTStatistics(){return!this.isFirefox()}usesPlanB(){return!this.usesUnifiedPlan()}usesSdpMungingForSimulcast(){return this.isChromiumBased()||this.isReactNative()||this.isWebKitBased()}usesUnifiedPlan(){return!!(this.isFirefox()||this.isWebKitBased())}usesNewGumFlow(){return!!(this.isChromiumBased()||this.isFirefox()||this.isWebKitBased())}usesAdapter(){return this.usesNewGumFlow()}usesRidsForSimulcast(){return!1}supportsGetDisplayMedia(){return typeof navigator.getDisplayMedia!="undefined"||typeof navigator.mediaDevices!="undefined"&&typeof navigator.mediaDevices.getDisplayMedia!="undefined"}supportsInsertableStreams(){if(!(typeof window.RTCRtpSender!="undefined"&&(window.RTCRtpSender.prototype.createEncodedStreams||window.RTCRtpSender.prototype.createEncodedVideoStreams)))return!1;const e=new ReadableStream;try{return window.postMessage(e,"*",[e]),!0}catch(t){return!1}}supportsAudioRed(){return Boolean(window.RTCRtpSender&&window.RTCRtpSender.getCapabilities&&window.RTCRtpSender.getCapabilities("audio").codecs.some(e=>e.mimeType==="audio/red")&&window.RTCRtpReceiver&&window.RTCRtpReceiver.getCapabilities&&window.RTCRtpReceiver.getCapabilities("audio").codecs.some(e=>e.mimeType==="audio/red"))}supportsSdpSemantics(){return this.isChromiumBased()}_getChromiumBasedVersion(){if(this.isChromiumBased()){if(this.isNWJS())return Number.parseInt(process.versions.chromium,10);const e=navigator.userAgent;if(e.match(/Chrome/))return Number.parseInt(e.match(/Chrome\/([\d.]+)/)[1],10)}return-1}isIOSMobile(){return this.isMobile&&this._bowser.getOSName()==="iOS"}}const _e=new cC,dC={audio:!0,video:!0,screenshareAudio:!0,screenshareVideo:!0},Za={baseURL:"http://localhost:5000",createdAt:"2021-08-05T10:49:56.602Z",description:"Develop plugins locally",id:"09259e3b-7be8-46f6-9801-106bf1866e1c",name:"Localhost Dev",organizationId:"4ad15a19-80e2-4105-bf43-48039fd2963e",picture:"https://dyte-uploads.s3.ap-south-1.amazonaws.com/dyte.png",private:!1,published:!0,staggered:!1,tags:["#localhost","#dev"],type:"self_hosted",updatedAt:"2021-08-05T10:50:07.681Z"},lC={pip:!0,poll:!0,chat:!0,stage:!0,theme:!0,plugin:!0,tracing:!0,internals:!0,recording:!0,livestream:!0,participant:!0,devTools:{logs:!1}};function dd(s,e){const t=s.getValue("overrides");return t&&t[e]?t[e]:!1}function uC({baseURI:s}){return s!=null&&s.includes("preprod.dyte")?Ha.PREPROD:s!=null&&s.includes("devel.dyte")?Ha.DEVEL:Ha.PROD}function yi({servicePrefix:s,baseURI:e}){return`${s}.${e}`}function Yf(s){const e=s.getValue("baseURI");return{location:yi({servicePrefix:"location",baseURI:e}),locationLegacy:yi({servicePrefix:"location-legacy",baseURI:e}),daCollector:yi({servicePrefix:"da-collector",baseURI:e})}}const hC='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m16.242 2.932 4.826 4.826a2.75 2.75 0 0 1-.715 4.404l-4.87 2.435a.75.75 0 0 0-.374.426l-1.44 4.166a1.25 1.25 0 0 1-2.065.476L8.5 16.561 4.06 21H3v-1.06l4.44-4.44-3.105-3.104a1.25 1.25 0 0 1 .476-2.066l4.166-1.44a.75.75 0 0 0 .426-.373l2.435-4.87a2.75 2.75 0 0 1 4.405-.715Zm3.766 5.886-4.826-4.826a1.25 1.25 0 0 0-2.002.325l-2.435 4.871a2.25 2.25 0 0 1-1.278 1.12l-3.789 1.31 6.705 6.704 1.308-3.789a2.25 2.25 0 0 1 1.12-1.277l4.872-2.436a1.25 1.25 0 0 0 .325-2.002Z" fill="currentColor"/></svg>',pC='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M4 12.02c0 1.06.2 2.1.6 3.08l.6 1.42c.22.55.64 1.01 1.17 1.29.27.14.56.21.86.21h2.55c.77 0 1.49-.41 1.87-1.08.5-.87 1.02-1.7 1.72-2.43l1.32-1.39c.44-.46.97-.84 1.49-1.23l.59-.45a.6.6 0 0 0 .23-.47c0-.75-.54-1.57-1.22-1.79a3.34 3.34 0 0 0-2.78.29V4.5a1.5 1.5 0 0 0-2.05-1.4 1.5 1.5 0 0 0-2.9 0A1.5 1.5 0 0 0 6 4.5v.09A1.5 1.5 0 0 0 4 6v6.02ZM8 4.5v4a.5.5 0 0 0 1 0v-5a.5.5 0 0 1 1 0v5a.5.5 0 0 0 1 0v-4a.5.5 0 0 1 1 0v6a.5.5 0 0 0 .85.37h.01c.22-.22.44-.44.72-.58.7-.35 2.22-.57 2.4.5l-.53.4c-.52.4-1.04.78-1.48 1.24l-1.33 1.38c-.75.79-1.31 1.7-1.85 2.63-.21.36-.6.58-1.01.58H7.23a.87.87 0 0 1-.4-.1 1.55 1.55 0 0 1-.71-.78l-.59-1.42a7.09 7.09 0 0 1-.53-2.7V6a.5.5 0 0 1 1 0v3.5a.5.5 0 0 0 1 0v-5a.5.5 0 0 1 1 0Z" fill="currentColor"></path></svg>',ld=s=>{if(!s)return;if(!s.startsWith("<svg"))return new Promise(i=>{i(s)});const t=new Blob([s],{type:"image/svg+xml"}),r=new Image,n=window.URL.createObjectURL(t);return new Promise((i,a)=>{r.onload=()=>{i(r),window.URL.revokeObjectURL(n)},r.onerror=()=>{a(),window.URL.revokeObjectURL(n)},r.src=n})};function mC(s){const e={...s},t=new Map,r=(l,h)=>(t.has(l)||t.set(l,new Set),t.get(l).add(h),()=>{var p;return(p=t.get(l))==null?void 0:p.delete(h)}),n=(l,h)=>{var p;(p=t.get(l))==null||p.delete(h)},i=l=>{var h;(h=t.get(l))==null||h.forEach(p=>{try{p(e[l])}catch(f){u.error(`Error in notifying for "${l.toString()}"`,f)}})};return{subscribe:r,unsubscribe:n,notify:i,setValue:(l,h,p=!0)=>{e[l]=h,p&&i(l)},getValue:l=>e[l],getAllValues:()=>e}}class fC{constructor(){m(this,"contexts",new Map);m(this,"mostRecentPeerId",null)}createContext(e,t){return this.contexts.has(e)?this.contexts.get(e):(this.contexts.set(e,mC(t)),this.mostRecentPeerId=e,this.contexts.get(e))}remapContext(e,t){const r=t.getValue("peerId");r!==e&&(t.setValue("peerId",e),this.mostRecentPeerId=e,this.contexts.set(e,t),this.contexts.delete(r))}getContext(e){return this.contexts.get(e)}getMostRecentPeerId(){return this.mostRecentPeerId}}const gn=new fC,ae=class{static get logsEndpoint(){const e=gn.getContext(ae.meetingMetadata.peerId);return`https://${yi({servicePrefix:"api-silos",baseURI:e.getValue("baseURI")})}/otel/logs`}static resetPeerId(e){ae.meetingMetadata.peerId=e}static init(e,t){const r=e.getValue("peerId");ae.tracingEnabled=t,ae.meetingMetadata.peerId=r,ae.meetingMetadata.sdkVersion=e.getValue("sdkVersion"),ae.meetingMetadata.deviceInfo=_e.getDeviceInfo(),ae.meetingMetadata.visitedUrl=!navigator.isReactNative&&typeof window!="undefined"&&window.location.href,navigator.isReactNative||document.addEventListener("visibilitychange",ae.processCachedLogs),ae.logsProcessorTimer=setInterval(ae.processCachedLogs,ae.logsProcessingInterval),t&&(ae.initialized=!0)}static trace(e,t=void 0){return(r,n,i)=>{const a=i.value;return i.value=function(...d){if(!ae.initialized||navigator.isReactNative||!ae.tracingEnabled||ee.hasFeature(se.SKIP_OTEL_TRACES))return a.apply(this,d);ae.addLogInCurrentSpan("info",e,t);const l=performance.now(),h=a.apply(this,d);return Promise.resolve(h).then(()=>{const p=performance.now();p-l>10&&ae.addLogInCurrentSpan("info",`${e}_timing`,{execTime:p-l,country:ae.location.country})}).catch(()=>{const p=performance.now();ae.addLogInCurrentSpan("info",`${e}_timing`,{execTime:p-l})}),h},i}}static injectContext(e){var n;const t=hi().replace(/-/g,"").substring(0,16),r=(n=ae.meetingMetadata.peerId)==null?void 0:n.replace(/-/g,"");e.TRACEPARENT=`00-${r}-${t}-01`}static addLogInCurrentSpan(e,t,r={},n=!1){r!=null&&r.error&&Object.assign(r,{error:od(r.error)});const i=gn.getContext(ae.meetingMetadata.peerId);if(Vf(i)&&(JP(r)?console[e]("DyteInternalLogs:: ",e,t):console[e]("DyteInternalLogs:: ",e,t,r)),!!YP(e))try{const c=Ff(i,t,r,"metadata"),d=new Date,l={message:t,level:e,...c,loggedAt:d.toISOString(),loggedAtTzOffset:d.getTimezoneOffset()};n?ae.sendOtelLogsToNewRelic([l]):ae.logsCache.push(l)}catch(c){ae.addLogInCurrentSpan("error","opentelemetry::addLogInCurrentSpan_failed",{error:od(c)})}}static sendOtelLogsToNewRelic(e){const t=gn.getContext(ae.meetingMetadata.peerId);fetch(ae.logsEndpoint,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({meetingMetadata:Ff(t,"sendOtelLogsToNewRelic",ae.meetingMetadata,"meetingMetadata"),serviceName:t.getValue("sdkName"),logs:e})}).catch(r=>{ae.addLogInCurrentSpan("error","opentelemetry::sendOtelLogToNewRelic_failed",{error:od(r)}),ae.logsCache.push(...e)})}static processCachedLogs(){const e=ae.logsCache.splice(0,25);e!=null&&e.length&&ae.sendOtelLogsToNewRelic(e)}static destruct(){clearInterval(ae.logsProcessorTimer),ae.processCachedLogs(),navigator.isReactNative||document.removeEventListener("visibilitychange",ae.processCachedLogs)}};let T=ae;m(T,"logsCache",[]),m(T,"logsProcessorTimer"),m(T,"location",{country:void 0}),m(T,"tracingEnabled",!0),m(T,"initialized",!1),m(T,"logsProcessingInterval",7e3),m(T,"logExclusionList",["message","websocket/message","roomMessage","websocket/room-message","websocket/room-legacy-mode","chatMessage","websocket/new-chat-message","websocket/no-active-speaker","websocket/selected-peers","websocket/active-speaker","ping","websocket/new-consumer","websocket/producer-score","websocket/consumer-score","websocket/plugin-event","websocket/plugin-data","websocket/plugin-internal-data"]),m(T,"meetingMetadata",{});class u{static info(e,t,r){T.addLogInCurrentSpan("info",e,t,r)}static error(e,t,r){T.addLogInCurrentSpan("error",e,t,r)}static debug(e,t,r){T.addLogInCurrentSpan("debug",e,t,r)}static log(e,t,r){T.addLogInCurrentSpan("log",e,t,r)}static warn(e,t,r){T.addLogInCurrentSpan("warn",e,t,r)}}const gC=()=>{!navigator.isReactNative&&typeof window!="undefined"&&(window.addEventListener("error",s=>{var e;!((e=s.filename)!=null&&e.includes("localhost"))&&s.lineno!==0&&u.error("window::error",{error:s.error},!0)}),window.addEventListener("unhandledrejection",s=>{var e,t,r,n,i,a,c,d;u.error("window::unhandledrejection",{error:s==null?void 0:s.reason,networkCall:{url:(t=(e=s==null?void 0:s.reason)==null?void 0:e.config)==null?void 0:t.url,baseURL:(n=(r=s==null?void 0:s.reason)==null?void 0:r.config)==null?void 0:n.baseURL,method:(a=(i=s==null?void 0:s.reason)==null?void 0:i.config)==null?void 0:a.method,status:(c=s==null?void 0:s.reason)==null?void 0:c.status,statusText:(d=s==null?void 0:s.reason)==null?void 0:d.statusText}},!0)}),window.addEventListener("offline",()=>{u.info("window::offline")}),window.addEventListener("online",()=>{u.info("window::online")}))},vC={"00":"DyteClient","01":"Controller","02":"RoomNodeClient","03":"HiveNodeClient","04":"SocketService","05":"Chat","06":"Plugin","07":"Polls","08":"Meta","09":"Preset",10:"Recording",11:"Self",12:"Participant",13:"Spotlight",14:"Remote Request",15:"Webinar",16:"LocalMediaHandler",17:"End-End Encryption",18:"AI",19:"Livestream",20:"Stage"},ud={"0000":"Internal exception.","0001":"Failed to initialize.","0002":"Failed to join room.","0003":"Failed to leave room.","0004":"Invalid auth token","0010":"Browser not supported","0011":"HTTP Network Error","0012":"Websocket Network Error","0013":"Rate Limited","0100":"Internal exception","0101":"Permission denied","0102":"Prerequisite module missing","0200":"Internal exception.","0300":"Internal exception","0400":"Internal exception","0404":"Missing prerequisites to establish a websocket connection","0500":"Internal exception","0501":"Permission denied.","0502":"Invalid message body.","0503":"Text Message is too large","0504":"Message not found by the given id","0505":"Action not permitted without joining room","0506":"Message search is disabled","0510":"Invalid channel name.","0600":"Internal exception","0601":"Permission denied.","0602":"Auth token not set for plugin","0603":"Iframe was not provided","0700":"Internal exception","0705":"Action not permitted without joining room","0800":"Internal exception","0801":"Permission denied","0900":"Internal exception","0904":"Could not load preset",1e3:"Internal exception",1001:"Permission denied",1004:"Could not find specified recording",1005:"Action not permitted in given recording state",1100:"Internal exception",1101:"Permission denied",1102:"Unsupported",1103:"Name cannot be empty",1104:"No device selected while calling meeting.self.setDevice",1105:"Action not permitted without joining room",1106:"Can't set currently used device",1200:"Internal exception",1201:"Permission denied",1202:"Invalid page number was requested",1203:"Invalid participant count per page was requested",1204:"No participants exists with the given UserIds",1205:"Action not permitted without joining room",1206:"Manual Subscription Mode was not ACTIVATED",1207:"Invalid view mode",1208:"Manual Subscription not enabled for organization",1209:"Broadcast message type must be a non-empty string",1300:"Internal exception",1400:"Internal exception",1402:"No existing remote requests",1403:"No peer exists with given id",1500:"Internal exception",1600:"Internal exception",1601:"Failed to get audio track",1602:"Failed to get video track",1603:"Incorrect device",1604:"Failed to change device",1605:"Failed to get audio & video track",1606:"No audio input devices are available",1607:"No video input devices are available",1608:"No audio output devices (speakers) are available",1609:"Failed to fetch list of media devices",1610:"No media track exists",1611:"Failed to unmute track",1612:"Failed to get screenshare tracks",1701:"Crypto error",1800:"Internal exception",1801:"Can't fetch transcript file",1900:"Internal exception",1901:"Permission denied.",1902:"Livestream that has not yet started, can't be stopped",2e3:"Internal exception",2001:"Permission denied",2002:"Unsupported",2003:"Stage is disabled",2004:"Method not implemented",2005:"Action not permitted without joining room",2006:"Action not permitted in current stage status",9900:"Internal exception"};Object.keys(ud).forEach(s=>{ud[s]=`{${vC[s.slice(0,2)]}} ${ud[s]}`});class P extends Error{constructor(t,r,n=!1){super(t);m(this,"code");this.code=r,this.name="DyteError",this.message=`[ERR${this.code}]: ${ud[this.code]}
${this.message}`;try{let i=n;r&&r.endsWith("00")&&(i=!0),i&&u.error("DyteError",{error:{message:this.message,name:this.name,code:r}});const a=gn.getContext(gn.getMostRecentPeerId());if(a){const c=a.getValue("onError");try{c(this)}catch(d){}}typeof window!="undefined"&&window.dispatchEvent(new CustomEvent("dyteError",{detail:this}))}catch(i){}}}function hd(s,e,t,r){if(r instanceof P)throw r;if(r instanceof e){const n=new P(r.message,t);throw n.stack=r.stack,n}else throw r}function Qf(s,e,t){if(!s.value){const n=s.get,i=s.set;return n&&(s.get=function(){try{return n.apply(this)}catch(a){hd(this,e,t,a)}}),i&&(s.set=function(a){try{return i.apply(this,[a])}catch(c){hd(this,e,t,c)}}),s}const r=s.value;return s.value=function(...n){try{const i=r.apply(this,n);return i&&i instanceof Promise?i.catch(a=>{hd(this,e,t,a)}):i}catch(i){hd(this,e,t,i)}},s}function yC(s,e){return(t,r,n)=>{if(n)return Qf(n,s,e);for(const i of Reflect.ownKeys(t.prototype).filter(a=>a!=="constructor")){const a=Object.getOwnPropertyDescriptor(t.prototype,i);(a.value instanceof Function||a.get instanceof Function||a.set instanceof Function)&&Object.defineProperty(t.prototype,i,Qf(a,s,e))}}}const ht=s=>yC(Error,s);function TC(s){let e=0,t,r;if(!s)return e;for(t=0;t<s.length;t+=1)r=s.charCodeAt(t),e=(e<<5)-e+r,e|=0;return Math.abs(e)%100+1}class SC extends re.EventEmitter{constructor(){super();g(this,sr,void 0);g(this,rr,void 0);m(this,"asyncPromiseTimeout");v(this,sr,new Map),v(this,rr,new Map),this.asyncPromiseTimeout=8e3}async emitAsync(t,...r){o(this,sr).set(t,[]);const n=o(this,rr).get(t).map(()=>new Promise(i=>{o(this,sr).get(t).push(i)}));super.emit(t,...r),await Promise.race([Promise.all(n),new Promise((i,a)=>setTimeout(()=>a(new Error(`emitAsync failed to resolve for event ${t}.`)),this.asyncPromiseTimeout))]),o(this,sr).delete(t)}onAsync(t,r){const n=o(this,sr),i=async(...a)=>{var d;try{await r(...a)}catch(l){u.error("[onAsync]",{error:l})}const c=(d=n.get(t))==null?void 0:d.shift();c==null||c()};return o(this,rr).get(t)||o(this,rr).set(t,[]),o(this,rr).get(t).push(i),super.on(t,i)}reset(){v(this,sr,new Map),v(this,rr,new Map),super.removeAllListeners()}}sr=new WeakMap,rr=new WeakMap;const R=new SC;function EC(){_e.isElectron()&&window.dyteElectronGetDisplayMediaSource&&(navigator.mediaDevices.getDisplayMedia=async()=>{const s=await window.dyteElectronGetDisplayMediaSource({types:["window","screen"]});let e=[];if(s&&(Array.isArray(s)?e=s:e=[s]),!(e!=null&&e.length))throw new Error("Couldn't find any media source for screen share.");let t=e.find(i=>{var a;return(a=i.id)==null?void 0:a.includes("screen")});t=t!=null?t:e[0];const r={audio:!1,video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:t.id}}};return await navigator.mediaDevices.getUserMedia(r)})}var k=(s=>(s.NEW_PRODUCER="NEW_PRODUCER",s.PRODUCER_TRACK_ENDED="PRODUCER_TRACK_ENDED",s.ROOM_NODE_CONNECTION_ERROR="ROOM_NODE_CONNECTION_ERROR",s.SOCKET_SERVICE_ROOM_JOINED="SOCKET_SERVICE_ROOM_JOINED",s.SOCKET_SERVICE_RECONNECTED="SOCKET_SERVICE_RECONNECTED",s.SOCKET_SERVICE_DISCONNECTED="SOCKET_SERVICE_DISCONNECTED",s.SOCKET_SERVICE_FAILED="SOCKET_SERVICE_FAILED",s.SOCKET_STATE_UPDATE="SOCKET_STATE_UPDATE",s.ROOM_NODE_RECONNECTED="ROOM_NODE_RECONNECTED",s.ROOM_NODE_DISCONNECTED="ROOM_NODE_DISCONNECTED",s.ROOM_NODE_FAILED="ROOM_NODE_FAILED",s.TRANSPORT_STATE_UPDATE="TRANSPORT_STATE_UPDATE",s.PRODUCER_SCORE_UPDATE="PRODUCER_SCORE_UPDATE",s.CONSUMER_SCORE_UPDATE="CONSUMER_SCORE_UPDATE",s.PRODUCER_STATUS_UPDATE="PRODUCER_STATUS_UPDATE",s.CONSUMER_STATUS_UPDATE="CONSUMER_STATUS_UPDATE",s.LOW_PRODUCER_SCORE="LOW_PRODUCER_SCORE",s.LOW_CONSUMER_SCORE="LOW_CONSUMER_SCORE",s.MEDIA_PERMISSION_ERROR="MEDIA_PERMISSION_ERROR",s.MEDIA_PERMISSION_UPDATE="MEDIA_PERMISSION_UPDATE",s.WAITLISTED="WAIT_LISTED",s.MESSAGE="websocket/message",s.ROOM_MESSAGE="websocket/room-message",s.PEER_JOINED_INTERNAL="peer/joined-internal",s.PEER_CLOSED="websocket/peer-closed",s.CONSUMER_CLOSED="websocket/consumer-closed",s.CONSUMER_PAUSED="websocket/consumer-paused",s.CONSUMER_RESUMED="websocket/consumer-resumed",s.PRODUCER_CLOSED="websocket/producer-closed",s.NEW_CONSUMER="websocket/new-consumer",s.PRODUCER_SCORE="websocket/producer-score",s.CONSUMER_SCORE="websocket/consumer-score",s.PRODUCER_TOGGLE="hive/producer-toggle",s.CONSUMER_TOGGLE="hive/consumer-toggle",s.SELECTED_PEERS_DIFF="hive/selected-peers-diff",s.UPDATE_ACTIVE="media/update-active",s.RESET_PRODUCER_STATE="hive/reset-producer-state",s.CF_TRANSPORT_STATE_CHANGED="cf/transport-state-changed",s.CF_ROOM_REJOINING="cf/room-rejoining",s.CF_ROOM_REJOIN_FAILED="cf/room-rejoining-failed",s.CF_ROOM_REJOINED="cf/room-rejoined",s.CF_TRANPSORT_RECONNECTING="cf/transport-reconnecting",s.ROOM_STATE="sockethub/room-state",s.PEER_DISPLAY_NAME_CHANGED="hive/display-name-changed",s.GET_STAGE_REQUESTS="GET_STAGE_REQUESTS",s.UPDATE_STAGE_REQUESTS="UPDATE_STAGE_REQUESTS",s.KICK_PEER="KICK_PEER",s.UPDATE_PEER_STAGE_STATUS="UPDATE_PEER_STAGE_STATUS",s.JOIN_MEDIA_ROOM="JOIN_MEDIA_ROOM",s.LEAVE_MEDIA_ROOM="LEAVE_MEDIA_ROOM",s.PIP_HANGUP="PIP_HANGUP",s.E2EE_ACTIVE_PRODUCER="E2EE_ACTIVE_PRODUCER",s.E2EE_INACTIVE_PRODUCER="E2EE_INACTIVE_PRODUCER",s.E2EE_ACTIVE_CONSUMER="E2EE_ACTIVE_CONSUMER",s.E2EE_INACTIVE_CONSUMER="E2EE_INACTIVE_CONSUMER",s.SOCKET_PEERS="SOCKET_PEERS",s.UPDATE_PERMISSIONS="UPDATE_PERMISSIONS",s.MAX_SPATIAL_LAYER_CHANGE="MAX_SPATIAL_LAYER_CHANGE",s.MUTE_SELF="MUTE_SELF",s.MUTE_SELF_VIDEO="MUTE_SELF_VIDEO",s))(k||{});class Ti extends re.EventEmitter{constructor(){super(),super.setMaxListeners(25)}emit(e,...t){return super.emit("*",e,...t),super.emit(e,...t)}on(e,t){try{const r=this.listenerCount(e);r>25&&r%25===0&&u.warn("DyteEventEmitter::maxListenersExceeded",{eventListener:{eventName:e.toString(),listenerCount:this.listenerCount(e)}})}catch(r){}return super.on(e,t)}addListener(e,t){try{const r=this.listenerCount(e);r>25&&r%25===0&&u.warn("DyteEventEmitter::maxListenersExceeded",{eventListener:{eventName:e.toString(),listenerCount:this.listenerCount(e)}})}catch(r){}return super.addListener(e,t)}off(e,t){return super.off(e,t)}once(e,t){return super.once(e,t)}prependListener(e,t){return super.prependListener(e,t)}prependOnceListener(e,t){return super.prependOnceListener(e,t)}removeListener(e,t){return super.removeListener(e,t)}removeAllListeners(e){return super.removeAllListeners(e)}listeners(e){return super.listeners(e)}listenerCount(e){return super.listenerCount(e)}}class jt extends re.EventEmitter{constructor(){super(),super.setMaxListeners(25)}emit(e,...t){return super.emit("*",e,...t),super.emit(e,...t)}on(e,t){try{const r=this.listenerCount(e);r>25&&r%25===0&&u.warn("DyteEventEmitter::maxListenersExceeded",{eventListener:{eventName:e.toString(),listenerCount:this.listenerCount(e)}})}catch(r){}return super.on(e,t)}addListener(e,t){try{const r=this.listenerCount(e);r>25&&r%25===0&&u.warn("DyteEventEmitter::maxListenersExceeded",{eventListener:{eventName:e.toString(),listenerCount:this.listenerCount(e)}})}catch(r){}return super.addListener(e,t)}off(e,t){return super.off(e,t)}once(e,t){return super.once(e,t)}prependListener(e,t){return super.prependListener(e,t)}prependOnceListener(e,t){return super.prependOnceListener(e,t)}removeListener(e,t){return super.removeListener(e,t)}removeAllListeners(e){return super.removeAllListeners(e)}listeners(e){return super.listeners(e)}listenerCount(e){return super.listenerCount(e)}}function _C(s,e=2){return s.replace(/[^\u00BF-\u1FFF\u2C00-\uD7FF\w\s]/g,"").trim().split(/\s+/).slice(0,e).map(n=>n.charAt(0)).join("").toUpperCase()}const Xf=1080,Zf=1920,bC=(s,e,t,r,n,i)=>{let a=.5,c=.5;const d=n,l=i,h=Math.min(t/d,r/l);let p=d*h,f=l*h,y,_,b,I,x=1;return p<t&&(x=t/p),Math.abs(x-1)<1e-14&&f<r&&(x=r/f),p*=x,f*=x,b=d/(p/t),I=l/(f/r),y=(d-b)*a,_=(l-I)*c,y<0&&(y=0),_<0&&(_=0),b>d&&(b=d),I>l&&(I=l),[y,_,b,I,s,e,t,r]},Qh=class extends jt{constructor(t,r,n,i){super();g(this,rs,void 0);g(this,Li,void 0);g(this,gt,void 0);g(this,ns,void 0);g(this,Ve,{height:Xf,width:Zf});g(this,ws,{brand:"#2160FD",background:"#141414",text:"#000000",videoBackground:"#191919",textOnBrand:"#EEEEEE"});g(this,nr,void 0);g(this,Rt,{});g(this,Je,void 0);g(this,xi,void 0);g(this,Vi,void 0);g(this,ir,void 0);g(this,Ui,!1);m(this,"cleanupEventListeners",()=>{o(this,Li).unsubscribe("stageStatus",this.handlePipMediaControls),o(this,Je).removeListener("videoUpdate",this.onSelfVideoUpdateListener),o(this,Je).removeListener("audioUpdate",this.onSelfAudioUpdateListener),o(this,Je).removeListener("roomLeft",()=>this.disable())});m(this,"enablePipMediaControls",()=>{this.mountAudioEvents(),this.mountVideoEvents()});m(this,"onSelfVideoUpdateListener",({videoEnabled:t})=>{this.updateMediaSession("CAMERA",t)});m(this,"onSelfAudioUpdateListener",({audioEnabled:t})=>{this.updateMediaSession("MIC",t)});m(this,"handlePipMediaControls",t=>{t==="ON_STAGE"?this.enablePipMediaControls():this.unmountEvents()});m(this,"eventCallback",t=>{t==="CAMERA"&&(o(this,Je).videoEnabled?o(this,Je).disableVideo():o(this,Je).enableVideo(),this.emit("cameraToggled")),t==="MIC"&&(o(this,Je).audioEnabled?o(this,Je).disableAudio():o(this,Je).enableAudio(),this.emit("micToggled")),t==="END"&&(R.emit(k.PIP_HANGUP),this.cleanupEventListeners(),this.emit("hangup"),this.cleanup())});m(this,"unmountEvents",()=>{navigator.mediaSession===void 0||navigator.mediaSession.setCameraActive===void 0||(navigator.mediaSession.setActionHandler("togglemicrophone",void 0),navigator.mediaSession.setActionHandler("togglecamera",void 0))});m(this,"animate",()=>{if(!this.isActive&&o(this,ir)==="active"){this.disable(!0);return}o(this,Rt)!==void 0&&this.paintCanvas(),o(this,nr)!==void 0&&v(this,nr,requestAnimationFrame(()=>this.animate()))});m(this,"disable",(t=!1)=>{v(this,ir,"idle"),this.cleanupEventListeners(),cancelAnimationFrame(o(this,nr)),t!==!0&&document.body.removeChild(o(this,gt)),v(this,nr,void 0),document.pictureInPictureElement&&document.exitPictureInPicture()});v(this,Li,t),v(this,ir,"idle"),v(this,Je,r),v(this,ws,{brand:r.config.designTokens.colors.brand[500],background:r.config.designTokens.colors.background[1e3],text:r.config.designTokens.colors.text,videoBackground:r.config.designTokens.colors.videoBg,textOnBrand:r.config.designTokens.colors.textOnBrand}),n&&this.setupIcon("pin",n),i&&this.setupIcon("handRaise",i)}static async _init(t,r){let n,i;try{n=await ld(hC),i=await ld(pC)}catch(a){}return new Qh(t,r,n,i)}async setupIcon(t,r){switch(t){case"handRaise":v(this,Vi,r);break;case"pin":v(this,xi,r);break}}async overrideIcon(t,r){switch(t){case"handRaise":v(this,Vi,await ld(r));break;case"pin":v(this,xi,await ld(r));break}}constructImage(t){const r=new Image,n=new Blob([t],{type:"image/svg+xml"}),i=window.URL.createObjectURL(n);return new Promise(a=>{r.onload=()=>{a(r),window.URL.revokeObjectURL(i)},r.src=i})}createVideoContainer(){v(this,gt,document.createElement("div")),o(this,gt).style.width="0.1px",o(this,gt).style.height="0.1px",o(this,gt).style.overflow="hidden",o(this,gt).style.position="absolute",o(this,gt).style.bottom="0",o(this,gt).style.right="0",o(this,gt).style.opacity="0",o(this,gt).appendChild(o(this,ns))}setupEventListeners(){o(this,Li).subscribe("stageStatus",this.handlePipMediaControls),o(this,Je).addListener("videoUpdate",this.onSelfVideoUpdateListener),o(this,Je).addListener("audioUpdate",this.onSelfAudioUpdateListener),o(this,Je).addListener("roomLeft",()=>this.disable())}createCanvas(){const t=document.createElement("canvas");t.height=o(this,Ve).height,t.width=o(this,Ve).width,v(this,rs,t)}setupMediaSessionEvents(){navigator.mediaSession===void 0||navigator.mediaSession.setCameraActive===void 0||(navigator.mediaSession.setActionHandler("hangup",()=>{this.eventCallback("END")}),this.mountAudioEvents(),this.mountVideoEvents())}mountAudioEvents(){navigator.mediaSession===void 0||navigator.mediaSession.setMicrophoneActive===void 0||o(this,Je).permissions.canProduceAudio&&navigator.mediaSession.setActionHandler("togglemicrophone",()=>{this.eventCallback("MIC")})}mountVideoEvents(){navigator.mediaSession===void 0||navigator.mediaSession.setCameraActive===void 0||o(this,Je).permissions.canProduceVideo&&navigator.mediaSession.setActionHandler("togglecamera",()=>{this.eventCallback("CAMERA")})}getSources(){const r=Object.values(o(this,Rt)).reduce((n,i)=>(n[i.pinned?"pinned":"regular"].push(i),n),{pinned:[],regular:[]});return[...r.pinned,...r.regular]}drawEmptyTile(t,r,n,i){if(o(this,rs)===void 0)return;const a=o(this,rs).getContext("2d"),c=o(this,rs).width,d=0,l=0,h=r-d*2,p=n-d*2,f=Math.floor(c/h),y=Math.floor(t/f),b=t%f*(h+d)+d,I=y*(p+d)+d,{displayText:x,image:B}=i!=null?i:{};a.fillStyle=x||B?o(this,ws).videoBackground:o(this,ws).background,a.strokeStyle=o(this,ws).brand,a.beginPath(),a.moveTo(b+l,I),a.arcTo(b+h,I,b+h,I+l,l),a.arcTo(b+h,I+p,b+h-l,I+p,l),a.arcTo(b,I+p,b,I+p-l,l),a.arcTo(b,I,b+l,I,l),a.closePath(),a.fill(),a.stroke();const H=h/6,M=h/2+b,z=p/2+I;a.save(),(x||B)&&(a.beginPath(),a.arc(M,z,H,0,Math.PI*2),a.fillStyle=o(this,ws).brand,a.fill(),B?(a.clip(),a.drawImage(B,M-H,z-H,H*2,H*2),a.restore()):x&&(a.fillStyle=o(this,ws).textOnBrand,a.font=`${H/2}px sans-serif`,a.textAlign="center",a.textBaseline="middle",a.fillText(x,M,z)),this.drawIcons(i,b,I,Math.max(h,p)))}drawIcons(t,r,n,i){const a=Math.min(Math.max(i*.15,100),200),c=a*.2,d=a*.2;let l=r+c;const h=n+c,p=f=>{const y=o(this,rs).getContext("2d");y.save(),y.fillStyle=o(this,ws).background,y.beginPath(),y.moveTo(l+d,h),y.arcTo(l+a,h,l+a,h+d,d),y.arcTo(l+a,h+a,l+a-d,h+a,d),y.arcTo(l,h+a,l,h+a-d,d),y.arcTo(l,h,l+d,h,d),y.closePath(),y.fill(),typeof f=="string"?(y.font=`${a/1.5}px sans-serif`,y.fillStyle=o(this,ws).text,y.textAlign="center",y.textBaseline="top",y.fillText(f,a/2+l,h+c)):y.drawImage(f,l+c,h+c,a-c*2,a-c*2),l+=a+c,y.restore()};t.pinned&&p(o(this,xi)),t.handRaised&&p(o(this,Vi))}drawTile(t,r,n){var l,h;if(o(this,rs)===void 0)return;const i=o(this,rs).getContext("2d"),a=this.getSources();let c=0,d=0;for(;c<o(this,Ve).height-5;){let p=0;for(;p<o(this,Ve).width-5&&d<n;){if((l=a[d])!=null&&l.enabled){const f=a[d].element,[y,_,b,I,x,B,H,M]=bC(p,c,t,r,f.videoWidth,f.videoHeight);((h=f==null?void 0:f.classList)==null?void 0:h.contains("mirror"))?(i.save(),i.scale(-1,1),i.drawImage(f,y,_,b,I,-1*x,B,-1*H,M),i.restore()):i.drawImage(f,y,_,b,I,x,B,H,M),this.drawIcons(a[d],x,B,Math.max(H,M))}else this.drawEmptyTile(d,t,r,a[d]);d+=1,p+=t}c+=r}}calcGridElemSize(t){switch(t){case 0:case 1:return[o(this,Ve).width,o(this,Ve).height];case 2:return[Math.floor(o(this,Ve).width/2),o(this,Ve).height];case 3:case 4:return[Math.floor(o(this,Ve).width/2),Math.floor(o(this,Ve).height/2)];case 5:case 6:return[Math.floor(o(this,Ve).width/3),Math.floor(o(this,Ve).height/2)];case 7:case 8:case 9:return[Math.floor(o(this,Ve).width/3),Math.floor(o(this,Ve).height/3)];default:return[Math.floor(o(this,Ve).width/3),Math.floor(o(this,Ve).height/2)]}}paintCanvas(){let t=this.getSources().length;t!==1&&(t=t%2>0?t+1:t);const[r,n]=this.calcGridElemSize(t);this.drawTile(r,n,t)}isSupported(){return!!window.chrome&&document.pictureInPictureEnabled}get isActive(){return document.pictureInPictureElement!==null}cleanup(){if(v(this,Ui,!1),this.isSupported()&&document.exitPictureInPicture!==void 0&&document.pictureInPictureElement!==null&&document.exitPictureInPicture(),o(this,gt))try{document.body.removeChild(o(this,gt))}catch(t){}this.removeAllSources(),v(this,rs,void 0),v(this,ns,void 0),v(this,nr,void 0)}init({height:t,width:r}={}){if(o(this,Ui))return;v(this,Ui,!0),this.createCanvas(),this.setupMediaSessionEvents();const n=document.createElement("video");v(this,Ve,{height:t!=null?t:Xf,width:r!=null?r:Zf}),n.height=o(this,Ve).height,n.width=o(this,Ve).width,n.autoplay=!0,n.muted=!0,n.srcObject=o(this,rs).captureStream(24),v(this,ns,n),o(this,ns).onloadedmetadata=()=>{try{this.emit("pipStarted"),o(this,ns).onleavepictureinpicture=()=>{this.emit("pipEnded")}}catch(i){this.emit("pipEnded")}},this.createVideoContainer(),this.paintCanvas()}updateMediaSession(t,r){navigator.mediaSession!==void 0&&(t==="CAMERA"&&navigator.mediaSession.setCameraActive!==void 0&&navigator.mediaSession.setCameraActive(r),t==="MIC"&&navigator.mediaSession.setMicrophoneActive!==void 0&&navigator.mediaSession.setMicrophoneActive(r))}enableSource(t){o(this,Rt)[t]!==void 0&&(o(this,Rt)[t].enabled=!0)}disableSource(t){o(this,Rt)[t]!==void 0&&(o(this,Rt)[t].enabled=!1)}async generateAvatar(t,r){if(!r)return;const n=new Image;try{const i=await(await fetch(r)).blob(),a=window.URL.createObjectURL(i);n.onload=()=>{this.updateSource(t,{image:n}),window.URL.revokeObjectURL(a)},n.src=a}catch(i){u.error("DytePip::GenerateAvatar",{error:i})}}addSource(t,r,n,i=!1,a=void 0,c=void 0,d=!1){u.debug("DytePIP::AddSource",{pip:{id:t,handRaised:d}}),o(this,Rt)[t]={id:t,element:r,enabled:n,pinned:i,displayText:a?_C(a):void 0,imageUrl:c,handRaised:d},c&&this.generateAvatar(t,c)}updateSource(t,r){u.info("DytePIP::UpdateSource",{pip:{id:t,handRaised:r.handRaised}});const n=o(this,Rt)[t];n&&(o(this,Rt)[t]={...n,...r})}removeSource(t){delete o(this,Rt)[t]}removePinnedSource(){Object.values(o(this,Rt)).forEach(r=>{r.pinned&&this.removeSource(r.id)})}removeAllSources(){v(this,Rt,{})}enable(){v(this,ir,"activating"),this.setupEventListeners(),this.updateMediaSession("CAMERA",o(this,Je).videoEnabled),this.updateMediaSession("MIC",o(this,Je).audioEnabled),document.body.appendChild(o(this,gt)),v(this,nr,requestAnimationFrame(()=>this.animate())),o(this,ns).onloadedmetadata=()=>{o(this,ns).requestPictureInPicture().then(()=>{v(this,ir,"active")})},o(this,ns).readyState===4&&o(this,ns).requestPictureInPicture().then(()=>{v(this,ir,"active")})}};let ju=Qh;rs=new WeakMap,Li=new WeakMap,gt=new WeakMap,ns=new WeakMap,Ve=new WeakMap,ws=new WeakMap,nr=new WeakMap,Rt=new WeakMap,Je=new WeakMap,xi=new WeakMap,Vi=new WeakMap,ir=new WeakMap,Ui=new WeakMap;function Gu(s){let e=typeof s;if(e=="object"){if(Array.isArray(s))return"array";if(s===null)return"null"}return e}function wC(s){return s!==null&&typeof s=="object"&&!Array.isArray(s)}let Ks="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split(""),pd=[];for(let s=0;s<Ks.length;s++)pd[Ks[s].charCodeAt(0)]=s;pd["-".charCodeAt(0)]=Ks.indexOf("+"),pd["_".charCodeAt(0)]=Ks.indexOf("/");function PC(s){let e=s.length*3/4;s[s.length-2]=="="?e-=2:s[s.length-1]=="="&&(e-=1);let t=new Uint8Array(e),r=0,n=0,i,a=0;for(let c=0;c<s.length;c++){if(i=pd[s.charCodeAt(c)],i===void 0)switch(s[c]){case"=":n=0;case`
`:case"\r":case"	":case" ":continue;default:throw Error("invalid base64 string.")}switch(n){case 0:a=i,n=1;break;case 1:t[r++]=a<<2|(i&48)>>4,a=i,n=2;break;case 2:t[r++]=(a&15)<<4|(i&60)>>2,a=i,n=3;break;case 3:t[r++]=(a&3)<<6|i,n=0;break}}if(n==1)throw Error("invalid base64 string.");return t.subarray(0,r)}function CC(s){let e="",t=0,r,n=0;for(let i=0;i<s.length;i++)switch(r=s[i],t){case 0:e+=Ks[r>>2],n=(r&3)<<4,t=1;break;case 1:e+=Ks[n|r>>4],n=(r&15)<<2,t=2;break;case 2:e+=Ks[n|r>>6],e+=Ks[r&63],t=0;break}return t&&(e+=Ks[n],e+="=",t==1&&(e+="=")),e}var md;(function(s){s.symbol=Symbol.for("protobuf-ts/unknown"),s.onRead=(t,r,n,i,a)=>{(e(r)?r[s.symbol]:r[s.symbol]=[]).push({no:n,wireType:i,data:a})},s.onWrite=(t,r,n)=>{for(let{no:i,wireType:a,data:c}of s.list(r))n.tag(i,a).raw(c)},s.list=(t,r)=>{if(e(t)){let n=t[s.symbol];return r?n.filter(i=>i.no==r):n}return[]},s.last=(t,r)=>s.list(t,r).slice(-1)[0];const e=t=>t&&Array.isArray(t[s.symbol])})(md||(md={}));var Fe;(function(s){s[s.Varint=0]="Varint",s[s.Bit64=1]="Bit64",s[s.LengthDelimited=2]="LengthDelimited",s[s.StartGroup=3]="StartGroup",s[s.EndGroup=4]="EndGroup",s[s.Bit32=5]="Bit32"})(Fe||(Fe={}));function RC(){let s=0,e=0;for(let r=0;r<28;r+=7){let n=this.buf[this.pos++];if(s|=(n&127)<<r,!(n&128))return this.assertBounds(),[s,e]}let t=this.buf[this.pos++];if(s|=(t&15)<<28,e=(t&112)>>4,!(t&128))return this.assertBounds(),[s,e];for(let r=3;r<=31;r+=7){let n=this.buf[this.pos++];if(e|=(n&127)<<r,!(n&128))return this.assertBounds(),[s,e]}throw new Error("invalid varint")}function Wu(s,e,t){for(let i=0;i<28;i=i+7){const a=s>>>i,c=!(!(a>>>7)&&e==0),d=(c?a|128:a)&255;if(t.push(d),!c)return}const r=s>>>28&15|(e&7)<<4,n=!!(e>>3);if(t.push((n?r|128:r)&255),!!n){for(let i=3;i<31;i=i+7){const a=e>>>i,c=!!(a>>>7),d=(c?a|128:a)&255;if(t.push(d),!c)return}t.push(e>>>31&1)}}const fd=(1<<16)*(1<<16);function eg(s){let e=s[0]=="-";e&&(s=s.slice(1));const t=1e6;let r=0,n=0;function i(a,c){const d=Number(s.slice(a,c));n*=t,r=r*t+d,r>=fd&&(n=n+(r/fd|0),r=r%fd)}return i(-24,-18),i(-18,-12),i(-12,-6),i(-6),[e,r,n]}function Ju(s,e){if(e>>>0<=2097151)return""+(fd*e+(s>>>0));let t=s&16777215,r=(s>>>24|e<<8)>>>0&16777215,n=e>>16&65535,i=t+r*6777216+n*6710656,a=r+n*8147497,c=n*2,d=1e7;i>=d&&(a+=Math.floor(i/d),i%=d),a>=d&&(c+=Math.floor(a/d),a%=d);function l(h,p){let f=h?String(h):"";return p?"0000000".slice(f.length)+f:f}return l(c,0)+l(a,c)+l(i,1)}function tg(s,e){if(s>=0){for(;s>127;)e.push(s&127|128),s=s>>>7;e.push(s)}else{for(let t=0;t<9;t++)e.push(s&127|128),s=s>>7;e.push(1)}}function kC(){let s=this.buf[this.pos++],e=s&127;if(!(s&128))return this.assertBounds(),e;if(s=this.buf[this.pos++],e|=(s&127)<<7,!(s&128))return this.assertBounds(),e;if(s=this.buf[this.pos++],e|=(s&127)<<14,!(s&128))return this.assertBounds(),e;if(s=this.buf[this.pos++],e|=(s&127)<<21,!(s&128))return this.assertBounds(),e;s=this.buf[this.pos++],e|=(s&15)<<28;for(let t=5;s&128&&t<10;t++)s=this.buf[this.pos++];if(s&128)throw new Error("invalid varint");return this.assertBounds(),e>>>0}let ge;function IC(){const s=new DataView(new ArrayBuffer(8));ge=globalThis.BigInt!==void 0&&typeof s.getBigInt64=="function"&&typeof s.getBigUint64=="function"&&typeof s.setBigInt64=="function"&&typeof s.setBigUint64=="function"?{MIN:BigInt("-9223372036854775808"),MAX:BigInt("9223372036854775807"),UMIN:BigInt("0"),UMAX:BigInt("18446744073709551615"),C:BigInt,V:s}:void 0}IC();function sg(s){if(!s)throw new Error("BigInt unavailable, see https://github.com/timostamm/protobuf-ts/blob/v1.0.8/MANUAL.md#bigint-support")}const rg=/^-?[0-9]+$/,gd=4294967296,vd=2147483648;class ng{constructor(e,t){this.lo=e|0,this.hi=t|0}isZero(){return this.lo==0&&this.hi==0}toNumber(){let e=this.hi*gd+(this.lo>>>0);if(!Number.isSafeInteger(e))throw new Error("cannot convert to safe number");return e}}class pt extends ng{static from(e){if(ge)switch(typeof e){case"string":if(e=="0")return this.ZERO;if(e=="")throw new Error("string is no integer");e=ge.C(e);case"number":if(e===0)return this.ZERO;e=ge.C(e);case"bigint":if(!e)return this.ZERO;if(e<ge.UMIN)throw new Error("signed value for ulong");if(e>ge.UMAX)throw new Error("ulong too large");return ge.V.setBigUint64(0,e,!0),new pt(ge.V.getInt32(0,!0),ge.V.getInt32(4,!0))}else switch(typeof e){case"string":if(e=="0")return this.ZERO;if(e=e.trim(),!rg.test(e))throw new Error("string is no integer");let[t,r,n]=eg(e);if(t)throw new Error("signed value for ulong");return new pt(r,n);case"number":if(e==0)return this.ZERO;if(!Number.isSafeInteger(e))throw new Error("number is no integer");if(e<0)throw new Error("signed value for ulong");return new pt(e,e/gd)}throw new Error("unknown value "+typeof e)}toString(){return ge?this.toBigInt().toString():Ju(this.lo,this.hi)}toBigInt(){return sg(ge),ge.V.setInt32(0,this.lo,!0),ge.V.setInt32(4,this.hi,!0),ge.V.getBigUint64(0,!0)}}pt.ZERO=new pt(0,0);class Se extends ng{static from(e){if(ge)switch(typeof e){case"string":if(e=="0")return this.ZERO;if(e=="")throw new Error("string is no integer");e=ge.C(e);case"number":if(e===0)return this.ZERO;e=ge.C(e);case"bigint":if(!e)return this.ZERO;if(e<ge.MIN)throw new Error("signed long too small");if(e>ge.MAX)throw new Error("signed long too large");return ge.V.setBigInt64(0,e,!0),new Se(ge.V.getInt32(0,!0),ge.V.getInt32(4,!0))}else switch(typeof e){case"string":if(e=="0")return this.ZERO;if(e=e.trim(),!rg.test(e))throw new Error("string is no integer");let[t,r,n]=eg(e);if(t){if(n>vd||n==vd&&r!=0)throw new Error("signed long too small")}else if(n>=vd)throw new Error("signed long too large");let i=new Se(r,n);return t?i.negate():i;case"number":if(e==0)return this.ZERO;if(!Number.isSafeInteger(e))throw new Error("number is no integer");return e>0?new Se(e,e/gd):new Se(-e,-e/gd).negate()}throw new Error("unknown value "+typeof e)}isNegative(){return(this.hi&vd)!==0}negate(){let e=~this.hi,t=this.lo;return t?t=~t+1:e+=1,new Se(t,e)}toString(){if(ge)return this.toBigInt().toString();if(this.isNegative()){let e=this.negate();return"-"+Ju(e.lo,e.hi)}return Ju(this.lo,this.hi)}toBigInt(){return sg(ge),ge.V.setInt32(0,this.lo,!0),ge.V.setInt32(4,this.hi,!0),ge.V.getBigInt64(0,!0)}}Se.ZERO=new Se(0,0);const ig={readUnknownField:!0,readerFactory:s=>new MC(s)};function AC(s){return s?Object.assign(Object.assign({},ig),s):ig}class MC{constructor(e,t){this.varint64=RC,this.uint32=kC,this.buf=e,this.len=e.length,this.pos=0,this.view=new DataView(e.buffer,e.byteOffset,e.byteLength),this.textDecoder=t!=null?t:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0})}tag(){let e=this.uint32(),t=e>>>3,r=e&7;if(t<=0||r<0||r>5)throw new Error("illegal tag: field no "+t+" wire type "+r);return[t,r]}skip(e){let t=this.pos;switch(e){case Fe.Varint:for(;this.buf[this.pos++]&128;);break;case Fe.Bit64:this.pos+=4;case Fe.Bit32:this.pos+=4;break;case Fe.LengthDelimited:let r=this.uint32();this.pos+=r;break;case Fe.StartGroup:let n;for(;(n=this.tag()[1])!==Fe.EndGroup;)this.skip(n);break;default:throw new Error("cant skip wire type "+e)}return this.assertBounds(),this.buf.subarray(t,this.pos)}assertBounds(){if(this.pos>this.len)throw new RangeError("premature EOF")}int32(){return this.uint32()|0}sint32(){let e=this.uint32();return e>>>1^-(e&1)}int64(){return new Se(...this.varint64())}uint64(){return new pt(...this.varint64())}sint64(){let[e,t]=this.varint64(),r=-(e&1);return e=(e>>>1|(t&1)<<31)^r,t=t>>>1^r,new Se(e,t)}bool(){let[e,t]=this.varint64();return e!==0||t!==0}fixed32(){return this.view.getUint32((this.pos+=4)-4,!0)}sfixed32(){return this.view.getInt32((this.pos+=4)-4,!0)}fixed64(){return new pt(this.sfixed32(),this.sfixed32())}sfixed64(){return new Se(this.sfixed32(),this.sfixed32())}float(){return this.view.getFloat32((this.pos+=4)-4,!0)}double(){return this.view.getFloat64((this.pos+=8)-8,!0)}bytes(){let e=this.uint32(),t=this.pos;return this.pos+=e,this.assertBounds(),this.buf.subarray(t,t+e)}string(){return this.textDecoder.decode(this.bytes())}}function oe(s,e){if(!s)throw new Error(e)}const DC=34028234663852886e22,OC=-34028234663852886e22,NC=4294967295,LC=2147483647,xC=-2147483648;function eo(s){if(typeof s!="number")throw new Error("invalid int 32: "+typeof s);if(!Number.isInteger(s)||s>LC||s<xC)throw new Error("invalid int 32: "+s)}function yd(s){if(typeof s!="number")throw new Error("invalid uint 32: "+typeof s);if(!Number.isInteger(s)||s>NC||s<0)throw new Error("invalid uint 32: "+s)}function Ku(s){if(typeof s!="number")throw new Error("invalid float 32: "+typeof s);if(Number.isFinite(s)&&(s>DC||s<OC))throw new Error("invalid float 32: "+s)}const ag={writeUnknownFields:!0,writerFactory:()=>new UC};function VC(s){return s?Object.assign(Object.assign({},ag),s):ag}class UC{constructor(e){this.stack=[],this.textEncoder=e!=null?e:new TextEncoder,this.chunks=[],this.buf=[]}finish(){this.chunks.push(new Uint8Array(this.buf));let e=0;for(let n=0;n<this.chunks.length;n++)e+=this.chunks[n].length;let t=new Uint8Array(e),r=0;for(let n=0;n<this.chunks.length;n++)t.set(this.chunks[n],r),r+=this.chunks[n].length;return this.chunks=[],t}fork(){return this.stack.push({chunks:this.chunks,buf:this.buf}),this.chunks=[],this.buf=[],this}join(){let e=this.finish(),t=this.stack.pop();if(!t)throw new Error("invalid state, fork stack empty");return this.chunks=t.chunks,this.buf=t.buf,this.uint32(e.byteLength),this.raw(e)}tag(e,t){return this.uint32((e<<3|t)>>>0)}raw(e){return this.buf.length&&(this.chunks.push(new Uint8Array(this.buf)),this.buf=[]),this.chunks.push(e),this}uint32(e){for(yd(e);e>127;)this.buf.push(e&127|128),e=e>>>7;return this.buf.push(e),this}int32(e){return eo(e),tg(e,this.buf),this}bool(e){return this.buf.push(e?1:0),this}bytes(e){return this.uint32(e.byteLength),this.raw(e)}string(e){let t=this.textEncoder.encode(e);return this.uint32(t.byteLength),this.raw(t)}float(e){Ku(e);let t=new Uint8Array(4);return new DataView(t.buffer).setFloat32(0,e,!0),this.raw(t)}double(e){let t=new Uint8Array(8);return new DataView(t.buffer).setFloat64(0,e,!0),this.raw(t)}fixed32(e){yd(e);let t=new Uint8Array(4);return new DataView(t.buffer).setUint32(0,e,!0),this.raw(t)}sfixed32(e){eo(e);let t=new Uint8Array(4);return new DataView(t.buffer).setInt32(0,e,!0),this.raw(t)}sint32(e){return eo(e),e=(e<<1^e>>31)>>>0,tg(e,this.buf),this}sfixed64(e){let t=new Uint8Array(8),r=new DataView(t.buffer),n=Se.from(e);return r.setInt32(0,n.lo,!0),r.setInt32(4,n.hi,!0),this.raw(t)}fixed64(e){let t=new Uint8Array(8),r=new DataView(t.buffer),n=pt.from(e);return r.setInt32(0,n.lo,!0),r.setInt32(4,n.hi,!0),this.raw(t)}int64(e){let t=Se.from(e);return Wu(t.lo,t.hi,this.buf),this}sint64(e){let t=Se.from(e),r=t.hi>>31,n=t.lo<<1^r,i=(t.hi<<1|t.lo>>>31)^r;return Wu(n,i,this.buf),this}uint64(e){let t=pt.from(e);return Wu(t.lo,t.hi,this.buf),this}}const og={emitDefaultValues:!1,enumAsInteger:!1,useProtoFieldName:!1,prettySpaces:0},cg={ignoreUnknownFields:!1};function FC(s){return s?Object.assign(Object.assign({},cg),s):cg}function BC(s){return s?Object.assign(Object.assign({},og),s):og}const dg=Symbol.for("protobuf-ts/message-type");function lg(s){let e=!1;const t=[];for(let r=0;r<s.length;r++){let n=s.charAt(r);n=="_"?e=!0:/\d/.test(n)?(t.push(n),e=!0):e?(t.push(n.toUpperCase()),e=!1):r==0?t.push(n.toLowerCase()):t.push(n)}return t.join("")}var D;(function(s){s[s.DOUBLE=1]="DOUBLE",s[s.FLOAT=2]="FLOAT",s[s.INT64=3]="INT64",s[s.UINT64=4]="UINT64",s[s.INT32=5]="INT32",s[s.FIXED64=6]="FIXED64",s[s.FIXED32=7]="FIXED32",s[s.BOOL=8]="BOOL",s[s.STRING=9]="STRING",s[s.BYTES=12]="BYTES",s[s.UINT32=13]="UINT32",s[s.SFIXED32=15]="SFIXED32",s[s.SFIXED64=16]="SFIXED64",s[s.SINT32=17]="SINT32",s[s.SINT64=18]="SINT64"})(D||(D={}));var Ns;(function(s){s[s.BIGINT=0]="BIGINT",s[s.STRING=1]="STRING",s[s.NUMBER=2]="NUMBER"})(Ns||(Ns={}));var Td;(function(s){s[s.NO=0]="NO",s[s.PACKED=1]="PACKED",s[s.UNPACKED=2]="UNPACKED"})(Td||(Td={}));function $C(s){var e,t,r,n;return s.localName=(e=s.localName)!==null&&e!==void 0?e:lg(s.name),s.jsonName=(t=s.jsonName)!==null&&t!==void 0?t:lg(s.name),s.repeat=(r=s.repeat)!==null&&r!==void 0?r:Td.NO,s.opt=(n=s.opt)!==null&&n!==void 0?n:s.repeat||s.oneof?!1:s.kind=="message",s}function HC(s){if(typeof s!="object"||s===null||!s.hasOwnProperty("oneofKind"))return!1;switch(typeof s.oneofKind){case"string":return s[s.oneofKind]===void 0?!1:Object.keys(s).length==2;case"undefined":return Object.keys(s).length==1;default:return!1}}class qC{constructor(e){var t;this.fields=(t=e.fields)!==null&&t!==void 0?t:[]}prepare(){if(this.data)return;const e=[],t=[],r=[];for(let n of this.fields)if(n.oneof)r.includes(n.oneof)||(r.push(n.oneof),e.push(n.oneof),t.push(n.oneof));else switch(t.push(n.localName),n.kind){case"scalar":case"enum":(!n.opt||n.repeat)&&e.push(n.localName);break;case"message":n.repeat&&e.push(n.localName);break;case"map":e.push(n.localName);break}this.data={req:e,known:t,oneofs:Object.values(r)}}is(e,t,r=!1){if(t<0)return!0;if(e==null||typeof e!="object")return!1;this.prepare();let n=Object.keys(e),i=this.data;if(n.length<i.req.length||i.req.some(a=>!n.includes(a))||!r&&n.some(a=>!i.known.includes(a)))return!1;if(t<1)return!0;for(const a of i.oneofs){const c=e[a];if(!HC(c))return!1;if(c.oneofKind===void 0)continue;const d=this.fields.find(l=>l.localName===c.oneofKind);if(!d||!this.field(c[c.oneofKind],d,r,t))return!1}for(const a of this.fields)if(a.oneof===void 0&&!this.field(e[a.localName],a,r,t))return!1;return!0}field(e,t,r,n){let i=t.repeat;switch(t.kind){case"scalar":return e===void 0?t.opt:i?this.scalars(e,t.T,n,t.L):this.scalar(e,t.T,t.L);case"enum":return e===void 0?t.opt:i?this.scalars(e,D.INT32,n):this.scalar(e,D.INT32);case"message":return e===void 0?!0:i?this.messages(e,t.T(),r,n):this.message(e,t.T(),r,n);case"map":if(typeof e!="object"||e===null)return!1;if(n<2)return!0;if(!this.mapKeys(e,t.K,n))return!1;switch(t.V.kind){case"scalar":return this.scalars(Object.values(e),t.V.T,n,t.V.L);case"enum":return this.scalars(Object.values(e),D.INT32,n);case"message":return this.messages(Object.values(e),t.V.T(),r,n)}break}return!0}message(e,t,r,n){return r?t.isAssignable(e,n):t.is(e,n)}messages(e,t,r,n){if(!Array.isArray(e))return!1;if(n<2)return!0;if(r){for(let i=0;i<e.length&&i<n;i++)if(!t.isAssignable(e[i],n-1))return!1}else for(let i=0;i<e.length&&i<n;i++)if(!t.is(e[i],n-1))return!1;return!0}scalar(e,t,r){let n=typeof e;switch(t){case D.UINT64:case D.FIXED64:case D.INT64:case D.SFIXED64:case D.SINT64:switch(r){case Ns.BIGINT:return n=="bigint";case Ns.NUMBER:return n=="number"&&!isNaN(e);default:return n=="string"}case D.BOOL:return n=="boolean";case D.STRING:return n=="string";case D.BYTES:return e instanceof Uint8Array;case D.DOUBLE:case D.FLOAT:return n=="number"&&!isNaN(e);default:return n=="number"&&Number.isInteger(e)}}scalars(e,t,r,n){if(!Array.isArray(e))return!1;if(r<2)return!0;if(Array.isArray(e)){for(let i=0;i<e.length&&i<r;i++)if(!this.scalar(e[i],t,n))return!1}return!0}mapKeys(e,t,r){let n=Object.keys(e);switch(t){case D.INT32:case D.FIXED32:case D.SFIXED32:case D.SINT32:case D.UINT32:return this.scalars(n.slice(0,r).map(i=>parseInt(i)),t,r);case D.BOOL:return this.scalars(n.slice(0,r).map(i=>i=="true"?!0:i=="false"?!1:i),t,r);default:return this.scalars(n,t,r,Ns.STRING)}}}function gs(s,e){switch(e){case Ns.BIGINT:return s.toBigInt();case Ns.NUMBER:return s.toNumber();default:return s.toString()}}class jC{constructor(e){this.info=e}prepare(){var e;if(this.fMap===void 0){this.fMap={};const t=(e=this.info.fields)!==null&&e!==void 0?e:[];for(const r of t)this.fMap[r.name]=r,this.fMap[r.jsonName]=r,this.fMap[r.localName]=r}}assert(e,t,r){if(!e){let n=Gu(r);throw(n=="number"||n=="boolean")&&(n=r.toString()),new Error(`Cannot parse JSON ${n} for ${this.info.typeName}#${t}`)}}read(e,t,r){this.prepare();const n=[];for(const[i,a]of Object.entries(e)){const c=this.fMap[i];if(!c){if(!r.ignoreUnknownFields)throw new Error(`Found unknown field while reading ${this.info.typeName} from JSON format. JSON key: ${i}`);continue}const d=c.localName;let l;if(c.oneof){if(a===null&&(c.kind!=="enum"||c.T()[0]!=="google.protobuf.NullValue"))continue;if(n.includes(c.oneof))throw new Error(`Multiple members of the oneof group "${c.oneof}" of ${this.info.typeName} are present in JSON.`);n.push(c.oneof),l=t[c.oneof]={oneofKind:d}}else l=t;if(c.kind=="map"){if(a===null)continue;this.assert(wC(a),c.name,a);const h=l[d];for(const[p,f]of Object.entries(a)){this.assert(f!==null,c.name+" map value",null);let y;switch(c.V.kind){case"message":y=c.V.T().internalJsonRead(f,r);break;case"enum":if(y=this.enum(c.V.T(),f,c.name,r.ignoreUnknownFields),y===!1)continue;break;case"scalar":y=this.scalar(f,c.V.T,c.V.L,c.name);break}this.assert(y!==void 0,c.name+" map value",f);let _=p;c.K==D.BOOL&&(_=_=="true"?!0:_=="false"?!1:_),_=this.scalar(_,c.K,Ns.STRING,c.name).toString(),h[_]=y}}else if(c.repeat){if(a===null)continue;this.assert(Array.isArray(a),c.name,a);const h=l[d];for(const p of a){this.assert(p!==null,c.name,null);let f;switch(c.kind){case"message":f=c.T().internalJsonRead(p,r);break;case"enum":if(f=this.enum(c.T(),p,c.name,r.ignoreUnknownFields),f===!1)continue;break;case"scalar":f=this.scalar(p,c.T,c.L,c.name);break}this.assert(f!==void 0,c.name,a),h.push(f)}}else switch(c.kind){case"message":if(a===null&&c.T().typeName!="google.protobuf.Value"){this.assert(c.oneof===void 0,c.name+" (oneof member)",null);continue}l[d]=c.T().internalJsonRead(a,r,l[d]);break;case"enum":let h=this.enum(c.T(),a,c.name,r.ignoreUnknownFields);if(h===!1)continue;l[d]=h;break;case"scalar":l[d]=this.scalar(a,c.T,c.L,c.name);break}}}enum(e,t,r,n){if(e[0]=="google.protobuf.NullValue"&&oe(t===null||t==="NULL_VALUE",`Unable to parse field ${this.info.typeName}#${r}, enum ${e[0]} only accepts null.`),t===null)return 0;switch(typeof t){case"number":return oe(Number.isInteger(t),`Unable to parse field ${this.info.typeName}#${r}, enum can only be integral number, got ${t}.`),t;case"string":let i=t;e[2]&&t.substring(0,e[2].length)===e[2]&&(i=t.substring(e[2].length));let a=e[1][i];return typeof a=="undefined"&&n?!1:(oe(typeof a=="number",`Unable to parse field ${this.info.typeName}#${r}, enum ${e[0]} has no value for "${t}".`),a)}oe(!1,`Unable to parse field ${this.info.typeName}#${r}, cannot parse enum value from ${typeof t}".`)}scalar(e,t,r,n){let i;try{switch(t){case D.DOUBLE:case D.FLOAT:if(e===null)return 0;if(e==="NaN")return Number.NaN;if(e==="Infinity")return Number.POSITIVE_INFINITY;if(e==="-Infinity")return Number.NEGATIVE_INFINITY;if(e===""){i="empty string";break}if(typeof e=="string"&&e.trim().length!==e.length){i="extra whitespace";break}if(typeof e!="string"&&typeof e!="number")break;let a=Number(e);if(Number.isNaN(a)){i="not a number";break}if(!Number.isFinite(a)){i="too large or small";break}return t==D.FLOAT&&Ku(a),a;case D.INT32:case D.FIXED32:case D.SFIXED32:case D.SINT32:case D.UINT32:if(e===null)return 0;let c;if(typeof e=="number"?c=e:e===""?i="empty string":typeof e=="string"&&(e.trim().length!==e.length?i="extra whitespace":c=Number(e)),c===void 0)break;return t==D.UINT32?yd(c):eo(c),c;case D.INT64:case D.SFIXED64:case D.SINT64:if(e===null)return gs(Se.ZERO,r);if(typeof e!="number"&&typeof e!="string")break;return gs(Se.from(e),r);case D.FIXED64:case D.UINT64:if(e===null)return gs(pt.ZERO,r);if(typeof e!="number"&&typeof e!="string")break;return gs(pt.from(e),r);case D.BOOL:if(e===null)return!1;if(typeof e!="boolean")break;return e;case D.STRING:if(e===null)return"";if(typeof e!="string"){i="extra whitespace";break}try{encodeURIComponent(e)}catch(d){d="invalid UTF8";break}return e;case D.BYTES:if(e===null||e==="")return new Uint8Array(0);if(typeof e!="string")break;return PC(e)}}catch(a){i=a.message}this.assert(!1,n+(i?" - "+i:""),e)}}class GC{constructor(e){var t;this.fields=(t=e.fields)!==null&&t!==void 0?t:[]}write(e,t){const r={},n=e;for(const i of this.fields){if(!i.oneof){let l=this.field(i,n[i.localName],t);l!==void 0&&(r[t.useProtoFieldName?i.name:i.jsonName]=l);continue}const a=n[i.oneof];if(a.oneofKind!==i.localName)continue;const c=i.kind=="scalar"||i.kind=="enum"?Object.assign(Object.assign({},t),{emitDefaultValues:!0}):t;let d=this.field(i,a[i.localName],c);oe(d!==void 0),r[t.useProtoFieldName?i.name:i.jsonName]=d}return r}field(e,t,r){let n;if(e.kind=="map"){oe(typeof t=="object"&&t!==null);const i={};switch(e.V.kind){case"scalar":for(const[d,l]of Object.entries(t)){const h=this.scalar(e.V.T,l,e.name,!1,!0);oe(h!==void 0),i[d.toString()]=h}break;case"message":const a=e.V.T();for(const[d,l]of Object.entries(t)){const h=this.message(a,l,e.name,r);oe(h!==void 0),i[d.toString()]=h}break;case"enum":const c=e.V.T();for(const[d,l]of Object.entries(t)){oe(l===void 0||typeof l=="number");const h=this.enum(c,l,e.name,!1,!0,r.enumAsInteger);oe(h!==void 0),i[d.toString()]=h}break}(r.emitDefaultValues||Object.keys(i).length>0)&&(n=i)}else if(e.repeat){oe(Array.isArray(t));const i=[];switch(e.kind){case"scalar":for(let d=0;d<t.length;d++){const l=this.scalar(e.T,t[d],e.name,e.opt,!0);oe(l!==void 0),i.push(l)}break;case"enum":const a=e.T();for(let d=0;d<t.length;d++){oe(t[d]===void 0||typeof t[d]=="number");const l=this.enum(a,t[d],e.name,e.opt,!0,r.enumAsInteger);oe(l!==void 0),i.push(l)}break;case"message":const c=e.T();for(let d=0;d<t.length;d++){const l=this.message(c,t[d],e.name,r);oe(l!==void 0),i.push(l)}break}(r.emitDefaultValues||i.length>0||r.emitDefaultValues)&&(n=i)}else switch(e.kind){case"scalar":n=this.scalar(e.T,t,e.name,e.opt,r.emitDefaultValues);break;case"enum":n=this.enum(e.T(),t,e.name,e.opt,r.emitDefaultValues,r.enumAsInteger);break;case"message":n=this.message(e.T(),t,e.name,r);break}return n}enum(e,t,r,n,i,a){if(e[0]=="google.protobuf.NullValue")return!i&&!n?void 0:null;if(t===void 0){oe(n);return}if(!(t===0&&!i&&!n))return oe(typeof t=="number"),oe(Number.isInteger(t)),a||!e[1].hasOwnProperty(t)?t:e[2]?e[2]+e[1][t]:e[1][t]}message(e,t,r,n){return t===void 0?n.emitDefaultValues?null:void 0:e.internalJsonWrite(t,n)}scalar(e,t,r,n,i){if(t===void 0){oe(n);return}const a=i||n;switch(e){case D.INT32:case D.SFIXED32:case D.SINT32:return t===0?a?0:void 0:(eo(t),t);case D.FIXED32:case D.UINT32:return t===0?a?0:void 0:(yd(t),t);case D.FLOAT:Ku(t);case D.DOUBLE:return t===0?a?0:void 0:(oe(typeof t=="number"),Number.isNaN(t)?"NaN":t===Number.POSITIVE_INFINITY?"Infinity":t===Number.NEGATIVE_INFINITY?"-Infinity":t);case D.STRING:return t===""?a?"":void 0:(oe(typeof t=="string"),t);case D.BOOL:return t===!1?a?!1:void 0:(oe(typeof t=="boolean"),t);case D.UINT64:case D.FIXED64:oe(typeof t=="number"||typeof t=="string"||typeof t=="bigint");let c=pt.from(t);return c.isZero()&&!a?void 0:c.toString();case D.INT64:case D.SFIXED64:case D.SINT64:oe(typeof t=="number"||typeof t=="string"||typeof t=="bigint");let d=Se.from(t);return d.isZero()&&!a?void 0:d.toString();case D.BYTES:return oe(t instanceof Uint8Array),t.byteLength?CC(t):a?"":void 0}}}function zu(s,e=Ns.STRING){switch(s){case D.BOOL:return!1;case D.UINT64:case D.FIXED64:return gs(pt.ZERO,e);case D.INT64:case D.SFIXED64:case D.SINT64:return gs(Se.ZERO,e);case D.DOUBLE:case D.FLOAT:return 0;case D.BYTES:return new Uint8Array(0);case D.STRING:return"";default:return 0}}class WC{constructor(e){this.info=e}prepare(){var e;if(!this.fieldNoToField){const t=(e=this.info.fields)!==null&&e!==void 0?e:[];this.fieldNoToField=new Map(t.map(r=>[r.no,r]))}}read(e,t,r,n){this.prepare();const i=n===void 0?e.len:e.pos+n;for(;e.pos<i;){const[a,c]=e.tag(),d=this.fieldNoToField.get(a);if(!d){let f=r.readUnknownField;if(f=="throw")throw new Error(`Unknown field ${a} (wire type ${c}) for ${this.info.typeName}`);let y=e.skip(c);f!==!1&&(f===!0?md.onRead:f)(this.info.typeName,t,a,c,y);continue}let l=t,h=d.repeat,p=d.localName;switch(d.oneof&&(l=l[d.oneof],l.oneofKind!==p&&(l=t[d.oneof]={oneofKind:p})),d.kind){case"scalar":case"enum":let f=d.kind=="enum"?D.INT32:d.T,y=d.kind=="scalar"?d.L:void 0;if(h){let I=l[p];if(c==Fe.LengthDelimited&&f!=D.STRING&&f!=D.BYTES){let x=e.uint32()+e.pos;for(;e.pos<x;)I.push(this.scalar(e,f,y))}else I.push(this.scalar(e,f,y))}else l[p]=this.scalar(e,f,y);break;case"message":if(h){let I=l[p],x=d.T().internalBinaryRead(e,e.uint32(),r);I.push(x)}else l[p]=d.T().internalBinaryRead(e,e.uint32(),r,l[p]);break;case"map":let[_,b]=this.mapEntry(d,e,r);l[p][_]=b;break}}}mapEntry(e,t,r){let n=t.uint32(),i=t.pos+n,a,c;for(;t.pos<i;){let[d,l]=t.tag();switch(d){case 1:e.K==D.BOOL?a=t.bool().toString():a=this.scalar(t,e.K,Ns.STRING);break;case 2:switch(e.V.kind){case"scalar":c=this.scalar(t,e.V.T,e.V.L);break;case"enum":c=t.int32();break;case"message":c=e.V.T().internalBinaryRead(t,t.uint32(),r);break}break;default:throw new Error(`Unknown field ${d} (wire type ${l}) in map entry for ${this.info.typeName}#${e.name}`)}}if(a===void 0){let d=zu(e.K);a=e.K==D.BOOL?d.toString():d}if(c===void 0)switch(e.V.kind){case"scalar":c=zu(e.V.T,e.V.L);break;case"enum":c=0;break;case"message":c=e.V.T().create();break}return[a,c]}scalar(e,t,r){switch(t){case D.INT32:return e.int32();case D.STRING:return e.string();case D.BOOL:return e.bool();case D.DOUBLE:return e.double();case D.FLOAT:return e.float();case D.INT64:return gs(e.int64(),r);case D.UINT64:return gs(e.uint64(),r);case D.FIXED64:return gs(e.fixed64(),r);case D.FIXED32:return e.fixed32();case D.BYTES:return e.bytes();case D.UINT32:return e.uint32();case D.SFIXED32:return e.sfixed32();case D.SFIXED64:return gs(e.sfixed64(),r);case D.SINT32:return e.sint32();case D.SINT64:return gs(e.sint64(),r)}}}class JC{constructor(e){this.info=e}prepare(){if(!this.fields){const e=this.info.fields?this.info.fields.concat():[];this.fields=e.sort((t,r)=>t.no-r.no)}}write(e,t,r){this.prepare();for(const i of this.fields){let a,c,d=i.repeat,l=i.localName;if(i.oneof){const h=e[i.oneof];if(h.oneofKind!==l)continue;a=h[l],c=!0}else a=e[l],c=!1;switch(i.kind){case"scalar":case"enum":let h=i.kind=="enum"?D.INT32:i.T;if(d)if(oe(Array.isArray(a)),d==Td.PACKED)this.packed(t,h,i.no,a);else for(const p of a)this.scalar(t,h,i.no,p,!0);else a===void 0?oe(i.opt):this.scalar(t,h,i.no,a,c||i.opt);break;case"message":if(d){oe(Array.isArray(a));for(const p of a)this.message(t,r,i.T(),i.no,p)}else this.message(t,r,i.T(),i.no,a);break;case"map":oe(typeof a=="object"&&a!==null);for(const[p,f]of Object.entries(a))this.mapEntry(t,r,i,p,f);break}}let n=r.writeUnknownFields;n!==!1&&(n===!0?md.onWrite:n)(this.info.typeName,e,t)}mapEntry(e,t,r,n,i){e.tag(r.no,Fe.LengthDelimited),e.fork();let a=n;switch(r.K){case D.INT32:case D.FIXED32:case D.UINT32:case D.SFIXED32:case D.SINT32:a=Number.parseInt(n);break;case D.BOOL:oe(n=="true"||n=="false"),a=n=="true";break}switch(this.scalar(e,r.K,1,a,!0),r.V.kind){case"scalar":this.scalar(e,r.V.T,2,i,!0);break;case"enum":this.scalar(e,D.INT32,2,i,!0);break;case"message":this.message(e,t,r.V.T(),2,i);break}e.join()}message(e,t,r,n,i){i!==void 0&&(r.internalBinaryWrite(i,e.tag(n,Fe.LengthDelimited).fork(),t),e.join())}scalar(e,t,r,n,i){let[a,c,d]=this.scalarInfo(t,n);(!d||i)&&(e.tag(r,a),e[c](n))}packed(e,t,r,n){if(!n.length)return;oe(t!==D.BYTES&&t!==D.STRING),e.tag(r,Fe.LengthDelimited),e.fork();let[,i]=this.scalarInfo(t);for(let a=0;a<n.length;a++)e[i](n[a]);e.join()}scalarInfo(e,t){let r=Fe.Varint,n,i=t===void 0,a=t===0;switch(e){case D.INT32:n="int32";break;case D.STRING:a=i||!t.length,r=Fe.LengthDelimited,n="string";break;case D.BOOL:a=t===!1,n="bool";break;case D.UINT32:n="uint32";break;case D.DOUBLE:r=Fe.Bit64,n="double";break;case D.FLOAT:r=Fe.Bit32,n="float";break;case D.INT64:a=i||Se.from(t).isZero(),n="int64";break;case D.UINT64:a=i||pt.from(t).isZero(),n="uint64";break;case D.FIXED64:a=i||pt.from(t).isZero(),r=Fe.Bit64,n="fixed64";break;case D.BYTES:a=i||!t.byteLength,r=Fe.LengthDelimited,n="bytes";break;case D.FIXED32:r=Fe.Bit32,n="fixed32";break;case D.SFIXED32:r=Fe.Bit32,n="sfixed32";break;case D.SFIXED64:a=i||Se.from(t).isZero(),r=Fe.Bit64,n="sfixed64";break;case D.SINT32:n="sint32";break;case D.SINT64:a=i||Se.from(t).isZero(),n="sint64";break}return[r,n,i||a]}}function KC(s){const e=s.messagePrototype?Object.create(s.messagePrototype):Object.defineProperty({},dg,{value:s});for(let t of s.fields){let r=t.localName;if(!t.opt)if(t.oneof)e[t.oneof]={oneofKind:void 0};else if(t.repeat)e[r]=[];else switch(t.kind){case"scalar":e[r]=zu(t.T,t.L);break;case"enum":e[r]=0;break;case"map":e[r]={};break}}return e}function Yu(s,e,t){let r,n=t,i;for(let a of s.fields){let c=a.localName;if(a.oneof){const d=n[a.oneof];if((d==null?void 0:d.oneofKind)==null)continue;if(r=d[c],i=e[a.oneof],i.oneofKind=d.oneofKind,r==null){delete i[c];continue}}else if(r=n[c],i=e,r==null)continue;switch(a.repeat&&(i[c].length=r.length),a.kind){case"scalar":case"enum":if(a.repeat)for(let l=0;l<r.length;l++)i[c][l]=r[l];else i[c]=r;break;case"message":let d=a.T();if(a.repeat)for(let l=0;l<r.length;l++)i[c][l]=d.create(r[l]);else i[c]===void 0?i[c]=d.create(r):d.mergePartial(i[c],r);break;case"map":switch(a.V.kind){case"scalar":case"enum":Object.assign(i[c],r);break;case"message":let l=a.V.T();for(let h of Object.keys(r))i[c][h]=l.create(r[h]);break}break}}}function zC(s,e,t){if(e===t)return!0;if(!e||!t)return!1;for(let r of s.fields){let n=r.localName,i=r.oneof?e[r.oneof][n]:e[n],a=r.oneof?t[r.oneof][n]:t[n];switch(r.kind){case"enum":case"scalar":let c=r.kind=="enum"?D.INT32:r.T;if(!(r.repeat?hg(c,i,a):ug(c,i,a)))return!1;break;case"map":if(!(r.V.kind=="message"?pg(r.V.T(),Sd(i),Sd(a)):hg(r.V.kind=="enum"?D.INT32:r.V.T,Sd(i),Sd(a))))return!1;break;case"message":let d=r.T();if(!(r.repeat?pg(d,i,a):d.equals(i,a)))return!1;break}}return!0}const Sd=Object.values;function ug(s,e,t){if(e===t)return!0;if(s!==D.BYTES)return!1;let r=e,n=t;if(r.length!==n.length)return!1;for(let i=0;i<r.length;i++)if(r[i]!=n[i])return!1;return!0}function hg(s,e,t){if(e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(!ug(s,e[r],t[r]))return!1;return!0}function pg(s,e,t){if(e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(!s.equals(e[r],t[r]))return!1;return!0}const YC=Object.getOwnPropertyDescriptors(Object.getPrototypeOf({}));class S{constructor(e,t,r){this.defaultCheckDepth=16,this.typeName=e,this.fields=t.map($C),this.options=r!=null?r:{},this.messagePrototype=Object.create(null,Object.assign(Object.assign({},YC),{[dg]:{value:this}})),this.refTypeCheck=new qC(this),this.refJsonReader=new jC(this),this.refJsonWriter=new GC(this),this.refBinReader=new WC(this),this.refBinWriter=new JC(this)}create(e){let t=KC(this);return e!==void 0&&Yu(this,t,e),t}clone(e){let t=this.create();return Yu(this,t,e),t}equals(e,t){return zC(this,e,t)}is(e,t=this.defaultCheckDepth){return this.refTypeCheck.is(e,t,!1)}isAssignable(e,t=this.defaultCheckDepth){return this.refTypeCheck.is(e,t,!0)}mergePartial(e,t){Yu(this,e,t)}fromBinary(e,t){let r=AC(t);return this.internalBinaryRead(r.readerFactory(e),e.byteLength,r)}fromJson(e,t){return this.internalJsonRead(e,FC(t))}fromJsonString(e,t){let r=JSON.parse(e);return this.fromJson(r,t)}toJson(e,t){return this.internalJsonWrite(e,BC(t))}toJsonString(e,t){var r;let n=this.toJson(e,t);return JSON.stringify(n,null,(r=t==null?void 0:t.prettySpaces)!==null&&r!==void 0?r:0)}toBinary(e,t){let r=VC(t);return this.internalBinaryWrite(e,r.writerFactory(),r).finish()}internalJsonRead(e,t,r){if(e!==null&&typeof e=="object"&&!Array.isArray(e)){let n=r!=null?r:this.create();return this.refJsonReader.read(e,n,t),n}throw new Error(`Unable to parse message ${this.typeName} from JSON ${Gu(e)}.`)}internalJsonWrite(e,t){return this.refJsonWriter.write(e,t)}internalBinaryWrite(e,t,r){return this.refBinWriter.write(e,t,r),t}internalBinaryRead(e,t,r,n){let i=n!=null?n:this.create();return this.refBinReader.read(e,i,r,t),i}}var wr;(function(s){s[s.PUBLISHER=0]="PUBLISHER",s[s.SUBSCRIBER=1]="SUBSCRIBER"})(wr||(wr={}));var Ls;(function(s){s[s.AUDIO=0]="AUDIO",s[s.VIDEO=1]="VIDEO"})(Ls||(Ls={}));class QC extends S{constructor(){super("media.Codec",[{no:1,name:"channels",kind:"scalar",opt:!0,T:5},{no:2,name:"clock_rate",kind:"scalar",T:5},{no:3,name:"mime_type",kind:"scalar",T:9},{no:4,name:"sdp_fmtp_line",kind:"scalar",opt:!0,T:9}])}}const XC=new QC;class ZC extends S{constructor(){super("media.HeaderExtension",[{no:1,name:"direction",kind:"scalar",opt:!0,T:9},{no:2,name:"uri",kind:"scalar",T:9}])}}const eR=new ZC;class tR extends S{constructor(){super("media.Fingerprint",[{no:1,name:"algorithm",kind:"scalar",T:9},{no:2,name:"value",kind:"scalar",T:9}])}}new tR;class sR extends S{constructor(){super("media.SessionDescription",[{no:1,name:"target",kind:"enum",T:()=>["media.Target",wr]},{no:2,name:"type",kind:"scalar",T:9},{no:3,name:"sdp",kind:"scalar",T:9}])}}const vs=new sR;class rR extends S{constructor(){super("media.ProducerPayload",[{no:1,name:"kind",kind:"scalar",T:9},{no:2,name:"paused",kind:"scalar",T:8},{no:3,name:"screen_share",kind:"scalar",T:8},{no:4,name:"msid",kind:"scalar",T:9},{no:5,name:"app_data",kind:"scalar",opt:!0,T:9},{no:6,name:"mime_type",kind:"scalar",opt:!0,T:9}])}}const nR=new rR;class iR extends S{constructor(){super("media.CreateTransportRequest",[{no:1,name:"consuming",kind:"scalar",T:8},{no:2,name:"force_tcp",kind:"scalar",opt:!0,T:8},{no:3,name:"description",kind:"message",T:()=>vs},{no:4,name:"private_ice",kind:"scalar",opt:!0,T:8},{no:5,name:"producers",kind:"message",repeat:1,T:()=>nR}])}}const aR=new iR;class oR extends S{constructor(){super("media.AudioActivityRequest",[{no:1,name:"producer_id",kind:"scalar",T:9},{no:2,name:"energy",kind:"scalar",T:5},{no:3,name:"silent",kind:"scalar",T:8}])}}const cR=new oR;class dR extends S{constructor(){super("media.CreateTransportResponse",[{no:1,name:"transport_id",kind:"scalar",T:9},{no:2,name:"description",kind:"message",T:()=>vs},{no:3,name:"transcription_enabled",kind:"scalar",opt:!0,T:8},{no:4,name:"producer_ids",kind:"scalar",repeat:2,T:9}])}}const mg=new dR;class lR extends S{constructor(){super("media.RenegotiateRequest",[{no:1,name:"transport_id",kind:"scalar",T:9},{no:2,name:"description",kind:"message",T:()=>vs}])}}const uR=new lR;class hR extends S{constructor(){super("media.RenegotiateResponse",[{no:1,name:"transport_id",kind:"scalar",T:9},{no:2,name:"description",kind:"message",T:()=>vs}])}}new hR;class pR extends S{constructor(){super("media.NestedScore",[{no:1,name:"encoding_idx",kind:"scalar",T:5},{no:2,name:"rid",kind:"scalar",T:9},{no:3,name:"score",kind:"scalar",T:5},{no:4,name:"ssrc",kind:"scalar",T:3,L:0}])}}const mR=new pR;class fR extends S{constructor(){super("media.ProducerTrack",[{no:1,name:"track_id",kind:"scalar",T:9},{no:2,name:"producer_id",kind:"scalar",T:9},{no:3,name:"stream_id",kind:"scalar",T:9}])}}const gR=new fR;class vR extends S{constructor(){super("media.ProducerEntry",[{no:1,name:"producing_transport_id",kind:"scalar",T:9},{no:2,name:"producer_id",kind:"scalar",T:9}])}}new vR;class yR extends S{constructor(){super("media.ConsumerEntry",[{no:1,name:"consuming_transport_id",kind:"scalar",T:9},{no:2,name:"consumer_id",kind:"scalar",T:9}])}}new yR;class TR extends S{constructor(){super("media.ProducerState",[{no:1,name:"producer_id",kind:"scalar",T:9},{no:2,name:"kind",kind:"enum",T:()=>["media.ProducerKind",Ls]},{no:3,name:"pause",kind:"scalar",T:8},{no:4,name:"screen_share",kind:"scalar",T:8},{no:5,name:"app_data",kind:"scalar",opt:!0,T:9},{no:6,name:"producing_transport_id",kind:"scalar",opt:!0,T:9},{no:7,name:"mime_type",kind:"scalar",opt:!0,T:9}])}}const to=new TR;class SR extends S{constructor(){super("media.ConsumerState",[{no:1,name:"consumer_id",kind:"scalar",T:9},{no:2,name:"producer_state",kind:"message",T:()=>to},{no:3,name:"producer_track",kind:"message",T:()=>gR}])}}const ER=new SR;class _R extends S{constructor(){super("media.ProducerIdToConsumerMap",[{no:1,name:"map",kind:"map",K:9,V:{kind:"message",T:()=>ER}}])}}const fg=new _R;class bR extends S{constructor(){super("media.PeerRtpCapabilitites",[{no:1,name:"sender",kind:"message",T:()=>yg},{no:2,name:"receiver",kind:"message",T:()=>yg}])}}const gg=new bR;class wR extends S{constructor(){super("media.RtpCapability",[{no:1,name:"codecs",kind:"message",repeat:1,T:()=>XC},{no:2,name:"header_extensions",kind:"message",repeat:1,T:()=>eR}])}}const vg=new wR;class PR extends S{constructor(){super("media.RtpCapabilitites",[{no:1,name:"audio",kind:"message",T:()=>vg},{no:2,name:"video",kind:"message",T:()=>vg}])}}const yg=new PR;class CR extends S{constructor(){super("media.PreferredCodec",[{no:1,name:"audio",kind:"scalar",opt:!0,T:9},{no:2,name:"video",kind:"scalar",opt:!0,T:9}])}}const RR=new CR;class kR extends S{constructor(){super("media.edge.GeoLocation",[{no:1,name:"latitude",kind:"scalar",T:2},{no:2,name:"longitude",kind:"scalar",T:2},{no:3,name:"region",kind:"scalar",opt:!0,T:9}])}}const IR=new kR;class AR extends S{constructor(){super("media.edge.PeerJoinRequest",[{no:1,name:"display_name",kind:"scalar",opt:!0,T:9},{no:2,name:"prejoined",kind:"scalar",T:8},{no:3,name:"room_uuid",kind:"scalar",T:9},{no:4,name:"meeting_id",kind:"scalar",opt:!0,T:9},{no:5,name:"preset",kind:"scalar",opt:!0,T:12},{no:6,name:"user_id",kind:"scalar",opt:!0,T:9},{no:7,name:"organization_id",kind:"scalar",opt:!0,T:9},{no:8,name:"location",kind:"message",T:()=>IR},{no:9,name:"capabilities",kind:"message",T:()=>gg}])}}const MR=new AR;class DR extends S{constructor(){super("media.edge.PeerJoinCompleteRequest",[])}}const OR=new DR;class NR extends S{constructor(){super("media.edge.PeerLeaveRequest",[{no:1,name:"close_room",kind:"scalar",T:8}])}}const LR=new NR;class xR extends S{constructor(){super("media.edge.ConsumeMultipleProducerRequest",[{no:1,name:"producer_ids",kind:"scalar",repeat:2,T:9},{no:2,name:"paused",kind:"scalar",opt:!0,T:8}])}}new xR;class VR extends S{constructor(){super("media.edge.ConsumePeerRequest",[{no:1,name:"producing_peer_id",kind:"scalar",T:9},{no:2,name:"paused",kind:"scalar",opt:!0,T:8},{no:3,name:"producer_id",kind:"scalar",opt:!0,T:9},{no:4,name:"preferred_codec",kind:"message",T:()=>RR},{no:5,name:"producing_transport_id",kind:"scalar",opt:!0,T:9}])}}const UR=new VR;class FR extends S{constructor(){super("media.edge.ConsumePeersRequest",[{no:1,name:"requests",kind:"message",repeat:1,T:()=>UR},{no:2,name:"consuming_transport_id",kind:"scalar",opt:!0,T:9}])}}const BR=new FR;class $R extends S{constructor(){super("media.edge.ProducerCreateRequest",[{no:1,name:"kind",kind:"scalar",T:9},{no:2,name:"paused",kind:"scalar",T:8},{no:3,name:"screen_share",kind:"scalar",T:8},{no:4,name:"description",kind:"message",T:()=>vs},{no:5,name:"msid",kind:"scalar",T:9},{no:6,name:"app_data",kind:"scalar",opt:!0,T:9},{no:7,name:"mime_type",kind:"scalar",opt:!0,T:9},{no:8,name:"producing_transport_id",kind:"scalar",opt:!0,T:9}])}}const HR=new $R;class qR extends S{constructor(){super("media.edge.SelectedPeersRequest",[])}}new qR;class jR extends S{constructor(){super("media.edge.GlobalPeerPinningRequest",[{no:1,name:"participant_id",kind:"scalar",T:9}])}}const GR=new jR;class WR extends S{constructor(){super("media.edge.ProducerToggleRequest",[{no:1,name:"producer_id",kind:"scalar",T:9},{no:2,name:"pause",kind:"scalar",T:8}])}}const Ed=new WR;class JR extends S{constructor(){super("media.edge.ConsumerToggleRequest",[{no:1,name:"consumer_id",kind:"scalar",T:9},{no:2,name:"pause",kind:"scalar",T:8}])}}new JR;class KR extends S{constructor(){super("media.edge.ProducerCloseRequest",[{no:1,name:"producer_id",kind:"scalar",T:9},{no:2,name:"description",kind:"message",T:()=>vs},{no:3,name:"producing_transport_id",kind:"scalar",opt:!0,T:9}])}}const zR=new KR;class YR extends S{constructor(){super("media.edge.ConsumerCloseRequest",[{no:1,name:"consumer_ids",kind:"scalar",repeat:2,T:9},{no:2,name:"description",kind:"message",T:()=>vs},{no:3,name:"consuming_transport_id",kind:"scalar",opt:!0,T:9}])}}const QR=new YR;class XR extends S{constructor(){super("media.edge.KickPeerRequest",[{no:1,name:"participant_id",kind:"scalar",T:9}])}}const ZR=new XR;class ek extends S{constructor(){super("media.edge.KickAllPeersRequest",[{no:1,name:"propagate_kick_across_rooms",kind:"scalar",T:8}])}}const Tg=new ek;class tk extends S{constructor(){super("media.edge.PeerDisplayNameEditRequest",[{no:1,name:"participant_id",kind:"scalar",T:9},{no:2,name:"display_name",kind:"scalar",T:9}])}}const sk=new tk;class rk extends S{constructor(){super("media.edge.HostMediaControlForPeerRequest",[{no:1,name:"participant_id",kind:"scalar",T:9},{no:2,name:"audio",kind:"scalar",T:8},{no:3,name:"video",kind:"scalar",T:8},{no:4,name:"scree_share",kind:"scalar",T:8}])}}const nk=new rk;class ik extends S{constructor(){super("media.edge.HostMediaControlForAllPeerRequest",[{no:1,name:"audio",kind:"scalar",T:8},{no:2,name:"video",kind:"scalar",T:8},{no:3,name:"screen_share",kind:"scalar",T:8}])}}const ak=new ik;class ok extends S{constructor(){super("media.edge.GetRoomStateResponse",[{no:1,name:"display_title",kind:"scalar",T:9},{no:2,name:"locked_mode",kind:"scalar",T:8},{no:3,name:"room_uuid",kind:"scalar",T:9},{no:4,name:"room_name",kind:"scalar",T:9},{no:5,name:"current_peer_id",kind:"scalar",T:9},{no:6,name:"is_recording",kind:"scalar",opt:!0,T:8},{no:7,name:"recorder_participant_id",kind:"scalar",opt:!0,T:9},{no:8,name:"pinned_peer_ids",kind:"scalar",repeat:2,T:9}])}}const ck=new ok;class dk extends S{constructor(){super("media.edge.ErrorResponse",[{no:1,name:"error_message",kind:"scalar",T:9},{no:2,name:"event_id",kind:"scalar",T:5}])}}const lk=new dk;class uk extends S{constructor(){super("media.edge.EmptyResponse",[])}}new uk;class hk extends S{constructor(){super("media.edge.RoomParticipants",[{no:1,name:"peer_id",kind:"scalar",T:9},{no:2,name:"producer_states",kind:"message",repeat:1,T:()=>to},{no:3,name:"display_name",kind:"scalar",T:9},{no:4,name:"user_id",kind:"scalar",opt:!0,T:9},{no:5,name:"capabilities",kind:"message",T:()=>gg}])}}const Sg=new hk;class pk extends S{constructor(){super("media.edge.SelectedPeersResponse",[{no:1,name:"audio_peers",kind:"scalar",repeat:2,T:9},{no:2,name:"compulsory_peers",kind:"scalar",repeat:2,T:9}])}}const Qu=new pk;class mk extends S{constructor(){super("media.edge.SelectedPeersDiffEntry",[{no:1,name:"peer_id",kind:"scalar",T:9},{no:2,name:"priority",kind:"scalar",T:5}])}}const fk=new mk;class gk extends S{constructor(){super("media.edge.SelectedPeersDiffResponse",[{no:1,name:"entries",kind:"message",repeat:1,T:()=>fk}])}}const Eg=new gk;class vk extends S{constructor(){super("media.edge.PeerJoinResponse",[])}}new vk;class yk extends S{constructor(){super("media.edge.PeerJoinCompleteResponse",[{no:1,name:"room_state",kind:"message",T:()=>ck},{no:2,name:"participants",kind:"message",repeat:1,T:()=>Sg},{no:3,name:"selected_peers",kind:"message",T:()=>Qu},{no:4,name:"max_preferred_streams",kind:"scalar",T:5}])}}const Xu=new yk;class Tk extends S{constructor(){super("media.edge.PeerLeaveResponse",[{no:1,name:"closed",kind:"scalar",T:8}])}}const Sk=new Tk;class Ek extends S{constructor(){super("media.edge.ConsumeMultipleProducerResponse",[{no:1,name:"status",kind:"scalar",T:8},{no:2,name:"consumer_ids_map",kind:"message",T:()=>fg}])}}new Ek;class _k extends S{constructor(){super("media.edge.ConsumePeerResponse",[{no:1,name:"status",kind:"scalar",T:8},{no:2,name:"consumer_ids_map",kind:"message",T:()=>fg},{no:3,name:"description",kind:"message",T:()=>vs}])}}const bk=new _k;class wk extends S{constructor(){super("media.edge.ProducerCreateResponse",[{no:1,name:"status",kind:"scalar",T:8},{no:2,name:"producer_id",kind:"scalar",T:9},{no:4,name:"description",kind:"message",T:()=>vs}])}}const Pk=new wk;class Ck extends S{constructor(){super("media.edge.ProducerScoreResponse",[{no:1,name:"responseid",kind:"scalar",T:9},{no:2,name:"score",kind:"message",T:()=>mR}])}}new Ck;class Rk extends S{constructor(){super("media.edge.ActiveSpeakerResponse",[{no:1,name:"responsepeer_id",kind:"scalar",T:9},{no:2,name:"volume",kind:"scalar",T:5}])}}new Rk;class kk extends S{constructor(){super("media.edge.NoActiveSpeakerResponse",[])}}new kk;class Ik extends S{constructor(){super("media.edge.ProducerToggleResponse",[])}}new Ik;class Ak extends S{constructor(){super("media.edge.ConsumerToggleResponse",[])}}new Ak;class Mk extends S{constructor(){super("media.edge.ProducerClosingResponse",[{no:1,name:"description",kind:"message",T:()=>vs}])}}const Dk=new Mk;class Ok extends S{constructor(){super("media.edge.ConsumerClosingResponse",[{no:1,name:"description",kind:"message",T:()=>vs}])}}new Ok;class Nk extends S{constructor(){super("media.edge.GlobalPeerPinningResponse",[])}}new Nk;class Lk extends S{constructor(){super("media.edge.KickPeerResponse",[{no:1,name:"status",kind:"scalar",T:9}])}}const xk=new Lk;class Vk extends S{constructor(){super("media.edge.KickAllPeersResponse",[{no:1,name:"status",kind:"scalar",T:9}])}}const Uk=new Vk;class Fk extends S{constructor(){super("media.edge.HostMediaControlForPeerResponse",[{no:1,name:"status",kind:"scalar",T:9}])}}const Bk=new Fk;class $k extends S{constructor(){super("media.edge.HostMediaControlForAllPeerResponse",[{no:1,name:"status",kind:"scalar",T:9}])}}const Hk=new $k;class qk extends S{constructor(){super("media.edge.PeerDisplayNameEditResponse",[{no:1,name:"status",kind:"scalar",T:9}])}}const jk=new qk;class Gk extends S{constructor(){super("media.edge.PeerJoinBroadcastResponse",[{no:1,name:"participant",kind:"message",T:()=>Sg}])}}const _g=new Gk;class Wk extends S{constructor(){super("media.edge.TrackSubscriptionKind",[{no:1,name:"audio",kind:"scalar",T:8},{no:2,name:"video",kind:"scalar",T:8}])}}const bg=new Wk;class Jk extends S{constructor(){super("media.edge.TrackSubscription",[{no:1,name:"label",kind:"scalar",T:9},{no:2,name:"webcam",kind:"message",T:()=>bg},{no:3,name:"screenshare",kind:"message",T:()=>bg}])}}const Kk=new Jk;class zk extends S{constructor(){super("media.edge.PeerProducingTransportCreateBroadcastResponse",[{no:1,name:"participant_id",kind:"scalar",T:9},{no:2,name:"transport_details",kind:"message",T:()=>mg},{no:3,name:"track_subscriptions",kind:"message",repeat:1,T:()=>Kk}])}}new zk;class Yk extends S{constructor(){super("media.edge.PeerProducerCreateBroadcastResponse",[{no:1,name:"participant_id",kind:"scalar",T:9},{no:2,name:"producer_state",kind:"message",T:()=>to}])}}const Qk=new Yk;class Xk extends S{constructor(){super("media.edge.PeerProducerToggleBroadcastResponse",[{no:1,name:"participant_id",kind:"scalar",T:9},{no:2,name:"producer_state",kind:"message",T:()=>to},{no:3,name:"initiator_participant_id",kind:"scalar",opt:!0,T:9}])}}const wg=new Xk;class Zk extends S{constructor(){super("media.edge.PeerProducerCloseBroadcastResponse",[{no:1,name:"participant_id",kind:"scalar",T:9},{no:2,name:"producer_state",kind:"message",T:()=>to}])}}const eI=new Zk;class tI extends S{constructor(){super("media.edge.PeerLeaveBroadcastResponse",[{no:1,name:"participant_id",kind:"scalar",T:9}])}}const Zu=new tI;class sI extends S{constructor(){super("media.edge.GlobalPeerPinningBroadcastResponse",[{no:1,name:"participant_id",kind:"scalar",T:9}])}}const Pg=new sI;class rI extends S{constructor(){super("media.edge.GlobalPeerUnPinningBroadcastResponse",[{no:1,name:"participant_id",kind:"scalar",T:9}])}}new rI;class nI extends S{constructor(){super("media.edge.RecordingStartedBroadcastResponse",[{no:1,name:"participant_id",kind:"scalar",T:9}])}}new nI;class iI extends S{constructor(){super("media.edge.RecordingStoppedBroadcastResponse",[{no:1,name:"participant_id",kind:"scalar",T:9}])}}new iI;class aI extends S{constructor(){super("media.edge.PeerDisplayNameEditBroadcastResponse",[{no:1,name:"participant_id",kind:"scalar",T:9},{no:2,name:"display_name",kind:"scalar",T:9}])}}new aI;class oI extends S{constructor(){super("media.edge.PeerPingRequestBroadcastResponse",[{no:1,name:"password",kind:"scalar",T:9}])}}new oI;class cI extends S{constructor(){super("media.edge.MediaRoomTerminationBroadcastResponse",[{no:1,name:"reason",kind:"scalar",T:9}])}}new cI;class dI extends S{constructor(){super("socket.ai.MeetingTranscript",[{no:1,name:"meeting_id",kind:"scalar",T:9},{no:2,name:"transcript",kind:"scalar",T:9},{no:3,name:"is_partial",kind:"scalar",T:8}])}}const eh=new dI;class lI extends S{constructor(){super("socket.api.BaseSocketHubMessage",[{no:1,name:"event",kind:"scalar",T:5},{no:2,name:"id",kind:"scalar",T:9},{no:3,name:"peer_id",kind:"scalar",T:9},{no:4,name:"room_id",kind:"scalar",T:9},{no:5,name:"user_id",kind:"scalar",T:9},{no:6,name:"payload",kind:"scalar",T:12},{no:7,name:"error",kind:"scalar",opt:!0,T:8},{no:8,name:"sid",kind:"scalar",opt:!0,T:9}])}}new lI;class uI extends S{constructor(){super("socket.api.ErrorMessage",[{no:1,name:"code",kind:"scalar",opt:!0,T:5},{no:2,name:"message",kind:"scalar",T:9}])}}const hI=new uI;var vn;(function(s){s[s.BROWSER=0]="BROWSER",s[s.TRACK=1]="TRACK",s[s.COMPOSITE=2]="COMPOSITE"})(vn||(vn={}));var zs;(function(s){s[s.UNSPECIFIED=0]="UNSPECIFIED",s[s.ON_STAGE=1]="ON_STAGE",s[s.APPROVED_STAGE=2]="APPROVED_STAGE",s[s.REQUESTED_STAGE=3]="REQUESTED_STAGE",s[s.OFF_STAGE=4]="OFF_STAGE"})(zs||(zs={}));var th;(function(s){s[s.NONE=0]="NONE",s[s.RECORDER=1]="RECORDER",s[s.LIVESTREAMER=2]="LIVESTREAMER"})(th||(th={}));var sh;(function(s){s[s.PEERS=0]="PEERS",s[s.ROOMS=1]="ROOMS"})(sh||(sh={}));var _d;(function(s){s[s.HIVE=0]="HIVE",s[s.CHAT=1]="CHAT",s[s.PING=2]="PING"})(_d||(_d={}));class pI extends S{constructor(){super("socket.room.PeerFlags",[{no:1,name:"preset_name",kind:"scalar",T:9},{no:2,name:"recorder_type",kind:"scalar",T:9},{no:3,name:"hidden_participant",kind:"scalar",T:8}])}}const mI=new pI;class fI extends S{constructor(){super("socket.room.Peer",[{no:1,name:"peer_id",kind:"scalar",T:9},{no:2,name:"user_id",kind:"scalar",T:9},{no:3,name:"display_name",kind:"scalar",T:9},{no:4,name:"stage_type",kind:"enum",opt:!0,T:()=>["socket.room.StageType",zs,"STAGE_TYPE_"]},{no:5,name:"custom_participant_id",kind:"scalar",opt:!0,T:9},{no:6,name:"preset_id",kind:"scalar",opt:!0,T:9},{no:7,name:"display_picture_url",kind:"scalar",opt:!0,T:9},{no:8,name:"waitlisted",kind:"scalar",T:8},{no:9,name:"flags",kind:"message",T:()=>mI}])}}const bd=new fI;class gI extends S{constructor(){super("socket.room.PeerInfoResponse",[{no:1,name:"peer",kind:"message",T:()=>bd}])}}const Si=new gI;class vI extends S{constructor(){super("socket.room.PeerStatusUpdate",[{no:1,name:"peer_id",kind:"scalar",T:9},{no:2,name:"user_id",kind:"scalar",T:9},{no:3,name:"stage_type",kind:"enum",opt:!0,T:()=>["socket.room.StageType",zs,"STAGE_TYPE_"]}])}}const Cg=new vI;class yI extends S{constructor(){super("socket.room.RoomPeersInfoRequest",[{no:1,name:"seach_query",kind:"scalar",T:9},{no:2,name:"limit",kind:"scalar",T:5},{no:3,name:"offset",kind:"scalar",T:5}])}}const TI=new yI;class SI extends S{constructor(){super("socket.room.RoomPeersInfoResponse",[{no:1,name:"peers",kind:"message",repeat:1,T:()=>bd}])}}const rh=new SI;class EI extends S{constructor(){super("socket.room.RoomPeerCountResponse",[{no:1,name:"count",kind:"scalar",T:4,L:2}])}}const Rg=new EI;class _I extends S{constructor(){super("socket.room.Room",[{no:1,name:"room_id",kind:"scalar",T:9},{no:2,name:"title",kind:"scalar",T:9},{no:4,name:"created_at",kind:"scalar",T:4,L:2},{no:5,name:"active_recordings",kind:"message",repeat:1,T:()=>wI},{no:6,name:"room_uuid",kind:"scalar",opt:!0,T:9}])}}const kg=new _I;class bI extends S{constructor(){super("socket.room.ActiveRecording",[{no:1,name:"recording_id",kind:"scalar",T:9},{no:2,name:"recording_type",kind:"enum",T:()=>["common.RecordingType",vn]},{no:3,name:"recording_status",kind:"scalar",T:9}])}}const wI=new bI;class PI extends S{constructor(){super("socket.room.RoomInfoResponse",[{no:1,name:"room",kind:"message",T:()=>kg}])}}const Ig=new PI;class CI extends S{constructor(){super("socket.room.GetPeerInfoRequest",[{no:1,name:"peer_id",kind:"scalar",T:9}])}}const Ag=new CI;class RI extends S{constructor(){super("socket.room.UpdatePeerInfoRequest",[{no:1,name:"peer_id",kind:"scalar",T:9},{no:2,name:"display_name",kind:"scalar",opt:!0,T:9}])}}new RI;class kI extends S{constructor(){super("socket.room.JoinRoomRequest",[{no:1,name:"peer",kind:"message",T:()=>bd},{no:3,name:"room_uuid",kind:"scalar",T:9},{no:4,name:"organization_id",kind:"scalar",opt:!0,T:9},{no:5,name:"use_hive",kind:"scalar",opt:!0,T:8},{no:6,name:"preset",kind:"scalar",opt:!0,T:12},{no:7,name:"capabilities",kind:"enum",repeat:1,T:()=>["socket.room.Capabilities",_d,"CAPABILITIES_"]},{no:8,name:"timestamp",kind:"scalar",opt:!0,T:4,L:2}])}}const II=new kI;class AI extends S{constructor(){super("socket.room.LeaveRoomRequest",[{no:1,name:"peer",kind:"message",T:()=>bd},{no:2,name:"timestamp",kind:"scalar",opt:!0,T:4,L:2}])}}const MI=new AI;class DI extends S{constructor(){super("socket.room.UpdateRoomInfoRequest",[{no:1,name:"room",kind:"message",T:()=>kg}])}}new DI;class OI extends S{constructor(){super("socket.room.GetConnectedRoomsDumpRequest",[])}}new OI;class NI extends S{constructor(){super("socket.room.ServiceError",[{no:1,name:"message",kind:"scalar",opt:!0,T:9},{no:2,name:"code",kind:"scalar",opt:!0,T:9}])}}const nh=new NI;class LI extends S{constructor(){super("socket.room.ConnectedMeetingPeer",[{no:1,name:"id",kind:"scalar",opt:!0,T:9},{no:2,name:"display_name",kind:"scalar",opt:!0,T:9},{no:3,name:"custom_participant_id",kind:"scalar",opt:!0,T:9},{no:4,name:"preset_id",kind:"scalar",opt:!0,T:9},{no:5,name:"display_picture_url",kind:"scalar",opt:!0,T:9}])}}const xI=new LI;class VI extends S{constructor(){super("socket.room.ConnectedMeetingDump",[{no:1,name:"id",kind:"scalar",opt:!0,T:9},{no:2,name:"title",kind:"scalar",opt:!0,T:9},{no:3,name:"participants",kind:"message",repeat:1,T:()=>xI}])}}const Mg=new VI;class UI extends S{constructor(){super("socket.room.GetConnectedRoomsDumpResponse",[{no:1,name:"parent_meeting",kind:"message",T:()=>Mg},{no:2,name:"meetings",kind:"message",repeat:1,T:()=>Mg}])}}const FI=new UI;class BI extends S{constructor(){super("socket.room.CreateRoomRequestPayload",[{no:1,name:"title",kind:"scalar",opt:!0,T:9}])}}const $I=new BI;class HI extends S{constructor(){super("socket.room.CreateConnectedRoomsRequest",[{no:1,name:"payloads",kind:"message",repeat:1,T:()=>$I}])}}const qI=new HI;class jI extends S{constructor(){super("socket.room.CreateRoomResponsePayload",[{no:1,name:"id",kind:"scalar",opt:!0,T:9},{no:2,name:"title",kind:"scalar",opt:!0,T:9},{no:3,name:"error",kind:"message",T:()=>nh}])}}const GI=new jI;class WI extends S{constructor(){super("socket.room.CreateConnectedRoomsResponse",[{no:1,name:"payloads",kind:"message",repeat:1,T:()=>GI}])}}const Dg=new WI;class JI extends S{constructor(){super("socket.room.UpdateRoomRequestPayload",[{no:1,name:"meeting_id",kind:"scalar",opt:!0,T:9},{no:2,name:"title",kind:"scalar",opt:!0,T:9}])}}const KI=new JI;class zI extends S{constructor(){super("socket.room.UpdateConnectedRoomsRequest",[{no:1,name:"payloads",kind:"message",repeat:1,T:()=>KI}])}}new zI;class YI extends S{constructor(){super("socket.room.DisableRoomPayload",[{no:1,name:"id",kind:"scalar",opt:!0,T:9}])}}const QI=new YI;class XI extends S{constructor(){super("socket.room.DisableConnectedRoomsRequest",[{no:1,name:"payloads",kind:"message",repeat:1,T:()=>QI}])}}const ZI=new XI;class eA extends S{constructor(){super("socket.room.DisableConnectedRoomsResponse",[{no:1,name:"payloads",kind:"message",repeat:1,T:()=>rA}])}}const tA=new eA;class sA extends S{constructor(){super("socket.room.DisableConnectedRoomPayload",[{no:1,name:"id",kind:"scalar",opt:!0,T:9},{no:2,name:"status",kind:"scalar",opt:!0,T:9},{no:3,name:"title",kind:"scalar",opt:!0,T:9},{no:4,name:"error",kind:"message",T:()=>nh}])}}const rA=new sA;class nA extends S{constructor(){super("socket.room.MovePeerPayload",[{no:1,name:"id",kind:"scalar",opt:!0,T:9},{no:2,name:"preset_id",kind:"scalar",opt:!0,T:9}])}}const iA=new nA;class aA extends S{constructor(){super("socket.room.MovePeersBetweenRoomsRequest",[{no:1,name:"source_meeting_id",kind:"scalar",opt:!0,T:9},{no:2,name:"destination_meeting_id",kind:"scalar",opt:!0,T:9},{no:3,name:"participants",kind:"message",repeat:1,T:()=>iA}])}}const oA=new aA;class cA extends S{constructor(){super("socket.room.MovedPeer",[{no:1,name:"meeting_id",kind:"scalar",opt:!0,T:9},{no:2,name:"custom_participant_id",kind:"scalar",opt:!0,T:9},{no:3,name:"error",kind:"message",T:()=>nh}])}}const Og=new cA;class dA extends S{constructor(){super("socket.room.MovePeersBetweenRoomsResponse",[{no:1,name:"payloads",kind:"message",repeat:1,T:()=>Og}])}}new dA;class lA extends S{constructor(){super("socket.room.TransferPeer",[{no:1,name:"meeting_id",kind:"scalar",opt:!0,T:9},{no:2,name:"auth_token",kind:"scalar",opt:!0,T:9}])}}const uA=new lA;class hA extends S{constructor(){super("socket.room.GetAllAddedParticipantsResponse",[{no:1,name:"participants",kind:"message",repeat:1,T:()=>fA}])}}const pA=new hA;class mA extends S{constructor(){super("socket.room.AddedParticipant",[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",opt:!0,T:9},{no:3,name:"picture",kind:"scalar",opt:!0,T:9},{no:4,name:"custom_participant_id",kind:"scalar",T:9}])}}const fA=new mA;class gA extends S{constructor(){super("socket.room.RemoveParticipantsRequest",[{no:1,name:"peer_ids",kind:"scalar",repeat:2,T:9}])}}const vA=new gA;class yA extends S{constructor(){super("socket.room.BroadcastMessage",[{no:1,name:"type",kind:"scalar",T:9},{no:2,name:"payload",kind:"scalar",T:12},{no:3,name:"timestamp",kind:"scalar",T:4,L:2},{no:4,name:"ids",kind:"scalar",repeat:2,T:9},{no:5,name:"broadcast_type",kind:"enum",opt:!0,T:()=>["socket.room.BroadcastType",sh,"BROADCAST_TYPE_"]}])}}const so=new yA;class TA extends S{constructor(){super("socket.room.AcceptWaitingRoomRequests",[{no:1,name:"user_ids",kind:"scalar",repeat:2,T:9}])}}const SA=new TA;class EA extends S{constructor(){super("socket.room.DenyWaitingRoomRequests",[{no:1,name:"user_ids",kind:"scalar",repeat:2,T:9}])}}const _A=new EA;class bA extends S{constructor(){super("socket.room.WaitingRoomRequest",[{no:1,name:"peer_id",kind:"scalar",T:9},{no:2,name:"user_id",kind:"scalar",T:9},{no:3,name:"display_name",kind:"scalar",T:9},{no:4,name:"picture",kind:"scalar",opt:!0,T:9},{no:5,name:"custom_participant_id",kind:"scalar",opt:!0,T:9},{no:6,name:"preset_name",kind:"scalar",opt:!0,T:9}])}}const wA=new bA;class PA extends S{constructor(){super("socket.room.GetWaitingRoomRequests",[{no:1,name:"requests",kind:"message",repeat:1,T:()=>wA}])}}const Ng=new PA;class CA extends S{constructor(){super("socket.room.GetRoomStageStateResponse",[{no:1,name:"on_stage_peers",kind:"scalar",repeat:2,T:9},{no:2,name:"approved_stage_peers",kind:"scalar",repeat:2,T:9},{no:3,name:"requested_stage_peers",kind:"scalar",repeat:2,T:9}])}}const Lg=new CA;var ih;(function(s){s[s.NONE=0]="NONE",s[s.SKIP=1]="SKIP",s[s.ON_PRIVILEGED_USER_ENTRY=2]="ON_PRIVILEGED_USER_ENTRY",s[s.SKIP_ON_ACCEPT=3]="SKIP_ON_ACCEPT"})(ih||(ih={}));var Pr;(function(s){s[s.NONE=0]="NONE",s[s.ALLOWED=1]="ALLOWED",s[s.NOT_ALLOWED=2]="NOT_ALLOWED",s[s.CAN_REQUEST=3]="CAN_REQUEST"})(Pr||(Pr={}));class RA extends S{constructor(){super("socket.preset.PollsPermissionUpdate",[{no:1,name:"can_create",kind:"scalar",opt:!0,T:8},{no:2,name:"can_vote",kind:"scalar",opt:!0,T:8},{no:3,name:"can_view",kind:"scalar",opt:!0,T:8}])}}const kA=new RA;class IA extends S{constructor(){super("socket.preset.PluginsPermissionsUpdate",[{no:1,name:"can_close",kind:"scalar",opt:!0,T:8},{no:2,name:"can_start",kind:"scalar",opt:!0,T:8}])}}const AA=new IA;class MA extends S{constructor(){super("socket.preset.PublicChatPermission",[{no:1,name:"can_send",kind:"scalar",opt:!0,T:8},{no:2,name:"text",kind:"scalar",opt:!0,T:8},{no:3,name:"files",kind:"scalar",opt:!0,T:8}])}}const DA=new MA;class OA extends S{constructor(){super("socket.preset.PrivateChatPermission",[{no:1,name:"can_send",kind:"scalar",opt:!0,T:8},{no:2,name:"can_receive",kind:"scalar",opt:!0,T:8},{no:3,name:"text",kind:"scalar",opt:!0,T:8},{no:4,name:"files",kind:"scalar",opt:!0,T:8}])}}const NA=new OA;class LA extends S{constructor(){super("socket.preset.ChatPermissionUpdate",[{no:1,name:"public",kind:"message",T:()=>DA},{no:2,name:"private",kind:"message",T:()=>NA}])}}const xA=new LA;class VA extends S{constructor(){super("socket.preset.ConnectedMeetingPermissionUpdate",[{no:1,name:"can_alter_connected_meetings",kind:"scalar",opt:!0,T:8},{no:2,name:"can_switch_to_parent_meeting",kind:"scalar",opt:!0,T:8},{no:3,name:"can_switch_connected_meetings",kind:"scalar",opt:!0,T:8}])}}const UA=new VA;class FA extends S{constructor(){super("socket.preset.StreamPermission",[{no:1,name:"can_produce",kind:"enum",opt:!0,T:()=>["socket.preset.StreamPermissionType",Pr,"STREAM_PERMISSION_TYPE_"]},{no:2,name:"can_consume",kind:"enum",opt:!0,T:()=>["socket.preset.StreamPermissionType",Pr,"STREAM_PERMISSION_TYPE_"]}])}}const ah=new FA;class BA extends S{constructor(){super("socket.preset.MediaPermissionUpdate",[{no:1,name:"video",kind:"message",T:()=>ah},{no:2,name:"audio",kind:"message",T:()=>ah},{no:3,name:"screenshare",kind:"message",T:()=>ah}])}}const $A=new BA;class HA extends S{constructor(){super("socket.preset.PresetUpdates",[{no:1,name:"polls",kind:"message",T:()=>kA},{no:2,name:"plugins",kind:"message",T:()=>AA},{no:3,name:"chat",kind:"message",T:()=>xA},{no:4,name:"accept_waiting_requests",kind:"scalar",opt:!0,T:8},{no:5,name:"can_accept_production_requests",kind:"scalar",opt:!0,T:8},{no:6,name:"can_edit_display_name",kind:"scalar",opt:!0,T:8},{no:7,name:"can_record",kind:"scalar",opt:!0,T:8},{no:8,name:"can_livestream",kind:"scalar",opt:!0,T:8},{no:9,name:"can_spotlight",kind:"scalar",opt:!0,T:8},{no:10,name:"disable_participant_audio",kind:"scalar",opt:!0,T:8},{no:11,name:"disable_participant_screensharing",kind:"scalar",opt:!0,T:8},{no:12,name:"disable_participant_video",kind:"scalar",opt:!0,T:8},{no:13,name:"kick_participant",kind:"scalar",opt:!0,T:8},{no:14,name:"pin_participant",kind:"scalar",opt:!0,T:8},{no:15,name:"transcription_enabled",kind:"scalar",opt:!0,T:8},{no:16,name:"waiting_room_type",kind:"enum",opt:!0,T:()=>["socket.preset.WaitingRoomType",ih,"WAITING_ROOM_TYPE_"]},{no:17,name:"is_recorder",kind:"scalar",opt:!0,T:8},{no:18,name:"recorder_type",kind:"enum",opt:!0,T:()=>["socket.room.RecorderType",th,"RECORDER_TYPE_"]},{no:19,name:"hidden_participant",kind:"scalar",opt:!0,T:8},{no:20,name:"show_participant_list",kind:"scalar",opt:!0,T:8},{no:21,name:"can_change_participant_permissions",kind:"scalar",opt:!0,T:8},{no:22,name:"connected_meetings",kind:"message",T:()=>UA},{no:23,name:"media",kind:"message",T:()=>$A}])}}const oh=new HA;class qA extends S{constructor(){super("socket.preset.ReadPeersPresetRequest",[{no:1,name:"user_ids",kind:"scalar",repeat:2,T:9}])}}const jA=new qA;class GA extends S{constructor(){super("socket.preset.PeerPreset",[{no:1,name:"user_id",kind:"scalar",T:9},{no:2,name:"peer_id",kind:"scalar",T:9},{no:3,name:"preset",kind:"scalar",T:12}])}}const WA=new GA;class JA extends S{constructor(){super("socket.preset.ReadPeersPresetResponse",[{no:1,name:"peer_presets",kind:"message",repeat:1,T:()=>WA}])}}const KA=new JA;class zA extends S{constructor(){super("socket.preset.UpdatePeerPreset",[{no:1,name:"user_ids",kind:"scalar",T:9},{no:2,name:"patch",kind:"message",T:()=>oh}])}}const xg=new zA;class YA extends S{constructor(){super("socket.preset.UpdatePeersPresetRequest",[{no:1,name:"update_peers_presets",kind:"message",repeat:1,T:()=>xg}])}}const QA=new YA;class XA extends S{constructor(){super("socket.preset.UpdatePeersPresetResponse",[{no:1,name:"update_peers_presets",kind:"message",repeat:1,T:()=>xg}])}}const Vg=new XA;class ZA extends S{constructor(){super("socket.preset.PeerUserIDMap",[{no:1,name:"peer_id",kind:"scalar",T:9},{no:2,name:"user_id",kind:"scalar",T:9}])}}const e0=new ZA;class t0 extends S{constructor(){super("socket.preset.BulkUpdatePeerPresetRequest",[{no:1,name:"peers",kind:"message",repeat:1,T:()=>e0},{no:2,name:"patch",kind:"message",T:()=>oh}])}}new t0;class s0 extends S{constructor(){super("socket.preset.BulkUpdatePeerPresetResponse",[{no:2,name:"patch",kind:"message",T:()=>oh}])}}new s0;class r0 extends S{constructor(){super("socket.chat.ChatMessage",[{no:1,name:"chat_id",kind:"scalar",T:9},{no:2,name:"peer_id",kind:"scalar",T:9},{no:3,name:"user_id",kind:"scalar",T:9},{no:4,name:"display_name",kind:"scalar",T:9},{no:5,name:"pinned",kind:"scalar",T:8},{no:6,name:"is_edited",kind:"scalar",T:8},{no:7,name:"payload_type",kind:"scalar",T:5},{no:8,name:"payload",kind:"scalar",T:9},{no:10,name:"target_user_ids",kind:"scalar",repeat:2,T:9},{no:11,name:"created_at",kind:"scalar",T:4,L:2},{no:12,name:"created_at_ms",kind:"scalar",opt:!0,T:4,L:2},{no:13,name:"channel_id",kind:"scalar",opt:!0,T:9},{no:14,name:"channel_index",kind:"scalar",opt:!0,T:9}])}}const yn=new r0;class n0 extends S{constructor(){super("socket.chat.GetPaginatedChatMessageRoomRequest",[{no:1,name:"time_stamp",kind:"scalar",T:4,L:2},{no:2,name:"size",kind:"scalar",T:5},{no:3,name:"from",kind:"scalar",T:5},{no:4,name:"reversed",kind:"scalar",T:8},{no:5,name:"channel_id",kind:"scalar",opt:!0,T:9}])}}const i0=new n0;class a0 extends S{constructor(){super("socket.chat.GetPaginatedChatMessageRoomResponse",[{no:1,name:"messages",kind:"message",repeat:1,T:()=>yn},{no:2,name:"next",kind:"scalar",T:8}])}}const o0=new a0;class c0 extends S{constructor(){super("socket.chat.GetChatMessagesResponse",[{no:1,name:"messages",kind:"message",repeat:1,T:()=>yn}])}}const Ug=new c0;class d0 extends S{constructor(){super("socket.chat.SendChatMessageToRoomRequest",[{no:1,name:"payload_type",kind:"scalar",T:5},{no:2,name:"payload",kind:"scalar",T:9}])}}const l0=new d0;class u0 extends S{constructor(){super("socket.chat.SendChatMessageToRoomResponse",[{no:1,name:"message",kind:"message",T:()=>yn}])}}const ch=new u0;class h0 extends S{constructor(){super("socket.chat.SendChatMessageToPeersRequest",[{no:1,name:"peer_ids",kind:"scalar",repeat:2,T:9},{no:2,name:"payload_type",kind:"scalar",T:5},{no:3,name:"payload",kind:"scalar",T:9}])}}const p0=new h0;class m0 extends S{constructor(){super("socket.chat.SendChatMessageToPeersResponse",[{no:1,name:"message",kind:"message",T:()=>yn}])}}const dh=new m0;class f0 extends S{constructor(){super("socket.chat.SendChatMessageToChannelRequest",[{no:1,name:"channel_id",kind:"scalar",T:9},{no:2,name:"payload_type",kind:"scalar",T:5},{no:3,name:"payload",kind:"scalar",T:9}])}}const g0=new f0;class v0 extends S{constructor(){super("socket.chat.SendChatMessageToChannelResponse",[{no:1,name:"message",kind:"message",T:()=>yn}])}}new v0;class y0 extends S{constructor(){super("socket.chat.EditChatMessageRequest",[{no:1,name:"chat_id",kind:"scalar",T:9},{no:2,name:"payload_type",kind:"scalar",opt:!0,T:5},{no:3,name:"payload",kind:"scalar",opt:!0,T:9},{no:4,name:"pinned",kind:"scalar",opt:!0,T:8},{no:5,name:"channel_id",kind:"scalar",opt:!0,T:9}])}}const T0=new y0;class S0 extends S{constructor(){super("socket.chat.PinChatMessageRequest",[{no:1,name:"chat_id",kind:"scalar",T:9},{no:2,name:"pinned",kind:"scalar",T:8},{no:3,name:"channel_id",kind:"scalar",opt:!0,T:9}])}}const E0=new S0;class _0 extends S{constructor(){super("socket.chat.PinChatMessageResponse",[{no:1,name:"chat_id",kind:"scalar",T:9},{no:2,name:"pinned",kind:"scalar",T:8},{no:3,name:"channel_id",kind:"scalar",opt:!0,T:9}])}}const wd=new _0;class b0 extends S{constructor(){super("socket.chat.EditChatMessageResponse",[{no:1,name:"message",kind:"message",T:()=>yn}])}}const Pd=new b0;class w0 extends S{constructor(){super("socket.chat.DeleteChatMessageRequest",[{no:1,name:"chat_id",kind:"scalar",T:9},{no:2,name:"channel_id",kind:"scalar",opt:!0,T:9}])}}const P0=new w0;class C0 extends S{constructor(){super("socket.chat.DeleteChatMessageResponse",[{no:1,name:"chat_id",kind:"scalar",T:9},{no:2,name:"channel_id",kind:"scalar",opt:!0,T:9}])}}const Cd=new C0;class R0 extends S{constructor(){super("socket.chat.SearchChatMessagesRequest",[{no:1,name:"time_stamp",kind:"scalar",T:4,L:2},{no:2,name:"size",kind:"scalar",T:5},{no:3,name:"from",kind:"scalar",T:5},{no:4,name:"reversed",kind:"scalar",T:8},{no:5,name:"channel_id",kind:"scalar",opt:!0,T:9},{no:6,name:"search_term",kind:"scalar",T:9}])}}const k0=new R0;class I0 extends S{constructor(){super("socket.chat.MarkChannelIndexAsReadRequest",[{no:1,name:"channel_id",kind:"scalar",T:9},{no:2,name:"user_id",kind:"scalar",T:9},{no:3,name:"channel_index",kind:"scalar",T:9}])}}const A0=new I0;class M0 extends S{constructor(){super("socket.chat.MarkChannelIndexAsReadResponse",[{no:1,name:"channel_index",kind:"scalar",T:9}])}}const D0=new M0;class O0 extends S{constructor(){super("socket.chat.CreateChatChannelRequest",[{no:1,name:"display_name",kind:"scalar",T:9},{no:2,name:"target_user_ids",kind:"scalar",repeat:2,T:9},{no:3,name:"display_picture_url",kind:"scalar",opt:!0,T:9},{no:4,name:"visibility",kind:"scalar",T:9},{no:5,name:"is_direct_message",kind:"scalar",T:8}])}}const N0=new O0;class L0 extends S{constructor(){super("socket.chat.UpdateChatChannelRequest",[{no:1,name:"chat_channel_id",kind:"scalar",T:9},{no:2,name:"display_name",kind:"scalar",opt:!0,T:9},{no:3,name:"target_user_ids",kind:"scalar",repeat:2,T:9},{no:4,name:"display_picture_url",kind:"scalar",opt:!0,T:9},{no:5,name:"visibility",kind:"scalar",opt:!0,T:9},{no:6,name:"is_direct_message",kind:"scalar",opt:!0,T:8}])}}const x0=new L0;class V0 extends S{constructor(){super("socket.chat.CreateChatChannelResponse",[{no:1,name:"chat_channel_id",kind:"scalar",T:9}])}}new V0;class U0 extends S{constructor(){super("socket.chat.GetChatChannelRequest",[{no:1,name:"chat_channel_id",kind:"scalar",T:9}])}}const F0=new U0;class B0 extends S{constructor(){super("socket.chat.LatestMessageAndUnreadCount",[{no:1,name:"message",kind:"message",T:()=>yn},{no:2,name:"unread_count",kind:"scalar",T:4,L:2}])}}const $0=new B0;class H0 extends S{constructor(){super("socket.chat.ChatChannel",[{no:1,name:"chat_channel_id",kind:"scalar",T:9},{no:2,name:"display_name",kind:"scalar",T:9},{no:3,name:"display_picture_url",kind:"scalar",opt:!0,T:9},{no:4,name:"visibility",kind:"scalar",T:9},{no:5,name:"is_direct_message",kind:"scalar",T:8},{no:6,name:"latest_message_and_unread_count",kind:"message",T:()=>$0},{no:7,name:"target_user_ids",kind:"scalar",repeat:2,T:9}])}}const q0=new H0;class j0 extends S{constructor(){super("socket.chat.GetChatChannelResponse",[{no:1,name:"chat_channels",kind:"message",repeat:1,T:()=>q0}])}}const Ys=new j0;class G0 extends S{constructor(){super("socket.chat.ChannelMember",[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",opt:!0,T:9},{no:3,name:"picture",kind:"scalar",opt:!0,T:9},{no:4,name:"custom_participant_id",kind:"scalar",T:9}])}}const W0=new G0;class J0 extends S{constructor(){super("socket.chat.GetChatChannelMembersResponse",[{no:1,name:"channel_members",kind:"message",repeat:1,T:()=>W0}])}}const K0=new J0;class z0 extends S{constructor(){super("socket.plugin.AddPluginRequest",[{no:1,name:"plugin_id",kind:"scalar",T:9},{no:2,name:"staggered",kind:"scalar",T:8}])}}const Y0=new z0;class Q0 extends S{constructor(){super("socket.plugin.RemovePluginRequest",[{no:1,name:"plugin_id",kind:"scalar",T:9},{no:2,name:"staggered",kind:"scalar",T:8}])}}const X0=new Q0;class Z0 extends S{constructor(){super("socket.plugin.EnablePluginForRoomRequest",[{no:1,name:"plugin_id",kind:"scalar",T:9}])}}const eM=new Z0;class tM extends S{constructor(){super("socket.plugin.DisablePluginForRoomRequest",[{no:1,name:"plugin_id",kind:"scalar",T:9}])}}const sM=new tM;class rM extends S{constructor(){super("socket.plugin.EnablePluginForPeersRequest",[{no:1,name:"plugin_id",kind:"scalar",T:9},{no:2,name:"peer_ids",kind:"scalar",repeat:2,T:9}])}}const nM=new rM;class iM extends S{constructor(){super("socket.plugin.DisablePluginForPeersRequest",[{no:1,name:"plugin_id",kind:"scalar",T:9},{no:2,name:"peer_ids",kind:"scalar",repeat:2,T:9}])}}const aM=new iM;class oM extends S{constructor(){super("socket.plugin.PluginEventToRoomRequest",[{no:1,name:"plugin_id",kind:"scalar",T:9},{no:2,name:"plugin_data",kind:"scalar",T:12}])}}const cM=new oM;class dM extends S{constructor(){super("socket.plugin.PluginEventToPeersRequest",[{no:1,name:"plugin_id",kind:"scalar",T:9},{no:2,name:"peer_ids",kind:"scalar",repeat:2,T:9},{no:3,name:"plugin_data",kind:"scalar",T:12}])}}const lM=new dM;class uM extends S{constructor(){super("socket.plugin.StoreKeys",[{no:1,name:"store_key",kind:"scalar",T:9},{no:2,name:"payload",kind:"scalar",opt:!0,T:12}])}}const lh=new uM;class hM extends S{constructor(){super("socket.plugin.PluginStoreInsertKeysRequest",[{no:1,name:"plugin_id",kind:"scalar",T:9},{no:2,name:"store_name",kind:"scalar",T:9},{no:3,name:"insert_keys",kind:"message",repeat:1,T:()=>lh}])}}const Fg=new hM;class pM extends S{constructor(){super("socket.plugin.PluginStoreGetKeysRequest",[{no:1,name:"plugin_id",kind:"scalar",T:9},{no:2,name:"store_name",kind:"scalar",T:9},{no:3,name:"get_keys",kind:"message",repeat:1,T:()=>lh}])}}const mM=new pM;class fM extends S{constructor(){super("socket.plugin.PluginStoreDeleteKeysRequest",[{no:1,name:"plugin_id",kind:"scalar",T:9},{no:2,name:"store_name",kind:"scalar",T:9},{no:3,name:"delete_keys",kind:"message",repeat:1,T:()=>lh}])}}const gM=new fM;class vM extends S{constructor(){super("socket.plugin.PluginStoreDeleteRequest",[{no:1,name:"plugin_id",kind:"scalar",T:9},{no:2,name:"store_name",kind:"scalar",T:9}])}}const yM=new vM;class TM extends S{constructor(){super("socket.plugin.EnablePluginResponse",[{no:1,name:"plugin_id",kind:"scalar",T:9},{no:2,name:"enabled_by",kind:"scalar",T:9}])}}const uh=new TM;class SM extends S{constructor(){super("socket.plugin.EnablePluginsResponse",[{no:1,name:"plugins",kind:"message",repeat:1,T:()=>uh}])}}const EM=new SM;class _M extends S{constructor(){super("socket.plugin.DisablePluginResponse",[{no:1,name:"plugin_id",kind:"scalar",T:9},{no:2,name:"disabled_by",kind:"scalar",T:9}])}}const Bg=new _M;class bM extends S{constructor(){super("socket.plugin.PluginStoreItem",[{no:1,name:"timestamp",kind:"scalar",T:9},{no:2,name:"peer_id",kind:"scalar",T:9},{no:3,name:"store_key",kind:"scalar",T:9},{no:4,name:"payload",kind:"scalar",T:12}])}}const wM=new bM;class PM extends S{constructor(){super("socket.plugin.PluginStoreResponse",[{no:1,name:"plugin_id",kind:"scalar",T:9},{no:2,name:"store_name",kind:"scalar",T:9},{no:3,name:"store_items",kind:"message",repeat:1,T:()=>wM}])}}const $g=new PM;class CM extends S{constructor(){super("socket.plugin.PluginEventResponse",[{no:1,name:"plugin_id",kind:"scalar",T:9},{no:2,name:"plugin_data",kind:"scalar",T:12}])}}const Hg=new CM;class RM extends S{constructor(){super("socket.livestreaming.LiveStreamingEvent",[{no:1,name:"livestream_id",kind:"scalar",T:9},{no:2,name:"err_message",kind:"scalar",T:9},{no:3,name:"name",kind:"scalar",T:9},{no:4,name:"meeting_id",kind:"scalar",T:9},{no:5,name:"playback_url",kind:"scalar",T:9},{no:6,name:"org_id",kind:"scalar",T:9},{no:7,name:"room_name",kind:"scalar",T:9},{no:8,name:"room_uuid",kind:"scalar",T:9},{no:9,name:"status",kind:"scalar",T:9},{no:10,name:"manual_ingest",kind:"scalar",opt:!0,T:8}])}}const qg=new RM;class kM extends S{constructor(){super("socket.livestreaming.GetStagePeersResponse",[{no:1,name:"stage_peers",kind:"scalar",repeat:2,T:9}])}}const jg=new kM;class IM extends S{constructor(){super("socket.livestreaming.StageRequest",[{no:1,name:"display_name",kind:"scalar",T:9},{no:2,name:"user_id",kind:"scalar",T:9},{no:3,name:"peer_id",kind:"scalar",T:9}])}}const AM=new IM;class MM extends S{constructor(){super("socket.livestreaming.GetStageRequestsResponse",[{no:1,name:"stage_requests",kind:"message",repeat:1,T:()=>AM}])}}const hh=new MM;class DM extends S{constructor(){super("socket.livestreaming.GrantStageAccessRequest",[{no:1,name:"user_ids",kind:"scalar",repeat:2,T:9}])}}const OM=new DM;class NM extends S{constructor(){super("socket.livestreaming.DenyStageAccessRequest",[{no:1,name:"user_ids",kind:"scalar",repeat:2,T:9}])}}const LM=new NM;class xM extends S{constructor(){super("socket.livestreaming.LeaveStageRequest",[{no:1,name:"user_ids",kind:"scalar",repeat:2,T:9}])}}const Gg=new xM;class VM extends S{constructor(){super("socket.polls.Poll",[{no:1,name:"poll_id",kind:"scalar",T:9},{no:2,name:"created_by",kind:"scalar",T:9},{no:3,name:"created_by_user_id",kind:"scalar",T:9},{no:4,name:"question",kind:"scalar",T:9},{no:5,name:"options",kind:"message",repeat:1,T:()=>FM},{no:6,name:"hide_votes",kind:"scalar",T:8},{no:7,name:"anonymous",kind:"scalar",T:8},{no:8,name:"votes",kind:"scalar",repeat:2,T:9}])}}const Wg=new VM;class UM extends S{constructor(){super("socket.polls.PollOption",[{no:1,name:"text",kind:"scalar",T:9},{no:2,name:"count",kind:"scalar",opt:!0,T:4,L:2},{no:3,name:"votes",kind:"message",repeat:1,T:()=>$M}])}}const FM=new UM;class BM extends S{constructor(){super("socket.polls.PollVote",[{no:1,name:"user_id",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9}])}}const $M=new BM;class HM extends S{constructor(){super("socket.polls.NewPollRequest",[{no:1,name:"question",kind:"scalar",T:9},{no:2,name:"options",kind:"scalar",repeat:2,T:9},{no:3,name:"anonymous",kind:"scalar",T:8},{no:4,name:"hide_votes",kind:"scalar",T:8},{no:5,name:"created_by",kind:"scalar",opt:!0,T:9},{no:6,name:"created_by_user_id",kind:"scalar",opt:!0,T:9}])}}const qM=new HM;class jM extends S{constructor(){super("socket.polls.VotePollRequest",[{no:1,name:"poll_id",kind:"scalar",T:9},{no:2,name:"index",kind:"scalar",T:4,L:2}])}}const GM=new jM;class WM extends S{constructor(){super("socket.polls.UpdatePollResponse",[{no:1,name:"poll",kind:"message",T:()=>Wg}])}}const ph=new WM;class JM extends S{constructor(){super("socket.polls.GetPollsResponse",[{no:1,name:"polls",kind:"message",repeat:1,T:()=>Wg}])}}const KM=new JM;class zM extends S{constructor(){super("socket.recording.RecordingEvent",[{no:1,name:"recording_id",kind:"scalar",T:9},{no:2,name:"err_message",kind:"scalar",T:9},{no:3,name:"recording_type",kind:"enum",T:()=>["common.RecordingType",vn]}])}}const Jg=new zM;class YM extends S{constructor(){super("google.protobuf.Timestamp",[{no:1,name:"seconds",kind:"scalar",T:3,L:0},{no:2,name:"nanos",kind:"scalar",T:5}])}now(){const e=this.create(),t=Date.now();return e.seconds=Se.from(Math.floor(t/1e3)).toBigInt(),e.nanos=t%1e3*1e6,e}toDate(e){return new Date(Se.from(e.seconds).toNumber()*1e3+Math.ceil(e.nanos/1e6))}fromDate(e){const t=this.create(),r=e.getTime();return t.seconds=Se.from(Math.floor(r/1e3)).toBigInt(),t.nanos=r%1e3*1e6,t}internalJsonWrite(e,t){let r=Se.from(e.seconds).toNumber()*1e3;if(r<Date.parse("0001-01-01T00:00:00Z")||r>Date.parse("9999-12-31T23:59:59Z"))throw new Error("Unable to encode Timestamp to JSON. Must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive.");if(e.nanos<0)throw new Error("Unable to encode invalid Timestamp to JSON. Nanos must not be negative.");let n="Z";if(e.nanos>0){let i=(e.nanos+1e9).toString().substring(1);i.substring(3)==="000000"?n="."+i.substring(0,3)+"Z":i.substring(6)==="000"?n="."+i.substring(0,6)+"Z":n="."+i+"Z"}return new Date(r).toISOString().replace(".000Z",n)}internalJsonRead(e,t,r){if(typeof e!="string")throw new Error("Unable to parse Timestamp from JSON "+Gu(e)+".");let n=e.match(/^([0-9]{4})-([0-9]{2})-([0-9]{2})T([0-9]{2}):([0-9]{2}):([0-9]{2})(?:Z|\.([0-9]{3,9})Z|([+-][0-9][0-9]:[0-9][0-9]))$/);if(!n)throw new Error("Unable to parse Timestamp from JSON. Invalid format.");let i=Date.parse(n[1]+"-"+n[2]+"-"+n[3]+"T"+n[4]+":"+n[5]+":"+n[6]+(n[8]?n[8]:"Z"));if(Number.isNaN(i))throw new Error("Unable to parse Timestamp from JSON. Invalid value.");if(i<Date.parse("0001-01-01T00:00:00Z")||i>Date.parse("9999-12-31T23:59:59Z"))throw new globalThis.Error("Unable to parse Timestamp from JSON. Must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive.");return r||(r=this.create()),r.seconds=Se.from(i/1e3).toBigInt(),r.nanos=0,n[7]&&(r.nanos=parseInt("1"+n[7]+"0".repeat(9-n[7].length))-1e9),r}}new YM;class QM extends S{constructor(){super("common.BaseHubMessage",[{no:1,name:"event",kind:"scalar",T:5},{no:2,name:"id",kind:"scalar",T:9},{no:3,name:"peer_id",kind:"scalar",T:9},{no:4,name:"room_id",kind:"scalar",T:9},{no:5,name:"user_id",kind:"scalar",T:9},{no:6,name:"payload",kind:"scalar",T:12},{no:7,name:"error",kind:"scalar",opt:!0,T:8},{no:8,name:"sid",kind:"scalar",opt:!0,T:9},{no:9,name:"room_object_id",kind:"scalar",opt:!0,T:9},{no:10,name:"preset",kind:"scalar",opt:!0,T:9}])}}const mh=new QM;class XM extends S{constructor(){super("common.BulkedHubMessage",[{no:1,name:"messages",kind:"message",repeat:1,T:()=>mh}])}}new XM;class ZM extends S{constructor(){super("common.CFWorkersResponse",[{no:1,name:"response",kind:"message",T:()=>mh},{no:2,name:"broadcast_responses",kind:"message",repeat:1,T:()=>mh}])}}new ZM;const eD=0,tD=1,sD=2,rD=3,nD=4,iD=5,aD={getPeerInfo:0,updatePeerInfo:1,getRoomPeersInfo:2,joinRoom:3,leaveRoom:4,getRoomInfo:5,updateRoomInfo:6,closeRoom:7,startedLivestream:8,stoppedLivestream:9,erroredLivestream:10,getStagePeers:11,getStageRequests:12,requestStageAccess:13,cancelStageRequest:14,grantStageAccess:15,denyStageAccess:16,roomPeerCount:17,joinStage:18,leaveStage:19,getConnectedRoomsDump:20,createConnectedRooms:21,deleteConnectedRooms:22,movePeers:23,transferPeer:24,movedPeer:25,connectedRoomsUpdated:26,connectedRoomsDeleted:27,getAllAddedParticipants:28,broadcastMessage:29,kick:30,kickAll:31,transcript:32,getWaitingRoomRequests:33,acceptWaitingRoomRequests:34,waitingRoomRequestAccepted:35,denyWaitingRoomRequests:36,waitingRoomRequestDenied:37,peerStageStatusUpdate:38,broadcastToEntity:39,recordingStarted:40,recordingStopped:41,recordingPaused:42,getRoomStageState:43,livestreamingInvoked:44},oD={getMessages:0,sendMessageToRoom:1,sendMessageToPeers:2,editMessage:3,deleteMessage:4,getPaginatedMessages:5,sendMessageToChannel:6,searchChannelMessages:7,getAllChatChannels:8,markChannelIndexAsRead:9,pinMessage:10},cD={getPlugins:0,addPlugin:1,enablePluginForRoom:2,disablePluginForPeers:3,enablePluginForPeers:4,disablePluginForRoom:5,removePlugin:6,customPluginEventToRoom:7,customPluginEventToPeers:8,storeInsertKeys:9,storeGetKeys:10,storeDeleteKeys:11,storeDelete:12},dD={createPoll:0,getPolls:1,votePoll:2,updatePoll:3},Kg={unknown:0,createWebRTCTransport:1,produce:2,consume:3,toggleProducer:4,toggleConsumer:5,closeProducer:6,closeConsumer:7,joinRoom:16,leaveRoom:17,selectedPeer:18,globalPinPeer:19,selfJoinComplete:20,peerJoinedBroadcast:25,peerLeaveBroadcast:26,peerProducerCreateBroadcast:27,peerProducerToggleBroadcast:28,peerProducerCloseBroadcast:29,globalPeerPinBroadcast:30,recordingStartedBroadcast:31,recordingStoppedBroadcast:32,peerDisplayNameEditBroadcast:33,mediaRoomTerminationBroadcastResponse:36,selectedPeerDiff:40,renegotiateSessionDescription:50,errorResponse:60,kickPeer:90,kickAll:91,changeDisplayName:92,hostControlPeer:93,hostControlAllPeers:94,audioActivity:100},lD={createChatChannel:0,getChatChannel:1,deprecatedGetAllChatChannels:2,getChannelMembers:3,updateChatChannel:4},uD={getUserPresets:0,updateUserPreset:1};function Ei(s,e){return Object.keys(e).reduce((t,r)=>(t[r]=(s<<16)+e[r],t),{})}function zg(s,e){return Object.keys(s).reduce((t,r)=>(t[r]=e|s[r],t),{})}const U=Ei(eD,aD),Ae=Ei(tD,oD),J=Ei(sD,cD),Qs=Ei(rD,dD),Tn=Ei(nD,lD),es=zg(Kg,16777216),ys=zg(Kg,50331648),Rd=Ei(iD,uD);var hD=Object.defineProperty,pD=Object.getOwnPropertyDescriptor,fh=(s,e,t,r)=>{for(var n=r>1?void 0:r?pD(e,t):e,i=s.length-1,a;i>=0;i--)(a=s[i])&&(n=(r?a(e,t,n):a(n))||n);return r&&n&&hD(e,t,n),n};const gh=(ny=class{constructor(s){g(this,Ur,void 0);v(this,Ur,s)}async createChannel(s,e,t,r="public",n=!1){const i={displayName:s,targetUserIds:e,displayPictureUrl:t,visibility:r,isDirectMessage:n};n&&(i.visibility="private");const a=await o(this,Ur).sendMessagePromise(Tn.createChatChannel,N0.toBinary(i)),c=Ys.fromBinary(a.payload).chatChannels;return gh.formatChannel(c[0])}async updateChannel(s,e){const t=await o(this,Ur).sendMessagePromise(Tn.updateChatChannel,x0.toBinary({chatChannelId:s,targetUserIds:e.memberIds,displayName:e.displayName,displayPictureUrl:e.displayPictureUrl,visibility:e.visibility})),r=Ys.fromBinary(t.payload).chatChannels;return gh.formatChannel(r[0])}static formatChannel(s){var r;const{latestMessageAndUnreadCount:e}=s,t={...s,id:s.chatChannelId,memberIds:s.targetUserIds,unreadCount:(r=e==null?void 0:e.unreadCount)!=null?r:0};return e!=null&&e.message&&(t.latestMessage=Es.formatSocketServiceMessage(e.message)),delete t.chatChannelId,delete t.targetUserIds,delete t.latestMessageAndUnreadCount,t}async getChannelMembers(s){try{const e=await o(this,Ur).sendMessagePromise(Tn.getChannelMembers,F0.toBinary({chatChannelId:s}));return K0.fromBinary(e.payload).channelMembers.map(({id:t,...r})=>({...r,userId:t}))}catch(e){return[]}}on(s,e){let t,r;switch(s){case Tn.createChatChannel:{t=Ys.fromBinary.bind(Ys),r=Ys.create();break}case Tn.updateChatChannel:{t=Ys.fromBinary.bind(Ys),r=Ys.create();break}}if(!t){u.warn(`ChatChannelSocketHandler::Event ${s} is not recognized`);return}o(this,Ur).on(s,({payload:n})=>{let i=r;try{i=t(n)}catch(a){u.error("ChatChannelSocketHandler::on::binary_decode_error",{error:a})}return e(i)})}},Ur=new WeakMap,ny);let Sn=gh;fh([T.trace("ChatChannelHandler.createChannel")],Sn.prototype,"createChannel",1),fh([T.trace("ChatChannelHandler.updateChannel")],Sn.prototype,"updateChannel",1),fh([T.trace("ChatChannelHandler.getChannelMembers")],Sn.prototype,"getChannelMembers",1);var mD=Object.defineProperty,fD=Object.getOwnPropertyDescriptor,Ts=(s,e,t,r)=>{for(var n=r>1?void 0:r?fD(e,t):e,i=s.length-1,a;i>=0;i--)(a=s[i])&&(n=(r?a(e,t,n):a(n))||n);return r&&n&&mD(e,t,n),n},bt=(s=>(s[s.TEXT=0]="TEXT",s[s.IMAGE=1]="IMAGE",s[s.FILE=2]="FILE",s[s.CUSTOM=3]="CUSTOM",s))(bt||{});class ts{constructor(e){g(this,vt,void 0);v(this,vt,e)}getChatMessages(){return o(this,vt).sendMessagePromise(Ae.getMessages)}async getChatMessagesPaginated(e,t,r,n=0,i=""){const a={timeStamp:e,size:t,from:n,reversed:r,channelId:i},c=await o(this,vt).sendMessagePromise(Ae.getPaginatedMessages,i0.toBinary(a));return c.payload?o0.fromBinary(c.payload):{messages:[],next:!1}}sendMessageToRoom(e,t){const r={payloadType:t,payload:e};o(this,vt).sendMessage(Ae.sendMessageToRoom,l0.toBinary(r))}sendMessageToPeers(e,t,r){const n={payloadType:t,peerIds:r,payload:e};o(this,vt).sendMessage(Ae.sendMessageToPeers,p0.toBinary(n))}sendMessageToChannel(e,t,r){const n={payloadType:t,channelId:r,payload:e};o(this,vt).sendMessage(Ae.sendMessageToChannel,g0.toBinary(n))}sendMessage(e,t,r,n){if(n&&this.sendMessageToChannel(e,t,n),r&&r.length>0){this.sendMessageToPeers(e,t,r);return}this.sendMessageToRoom(e,t)}async editMessage(e,t,r,n,i){const a={chatId:e,payloadType:r,payload:t};n&&(a.channelId=n),i!==void 0&&(a.pinned=i);const c=await o(this,vt).sendMessagePromise(Ae.editMessage,T0.toBinary(a));return Pd.fromBinary(c.payload).message}async deleteMessage(e,t){const r={chatId:e};t&&(r.channelId=t);const n=await o(this,vt).sendMessagePromise(Ae.deleteMessage,P0.toBinary(r)),i=Cd.fromBinary(n.payload);return{id:i.chatId,...i.channelId?{channelId:i.channelId}:{}}}async searchMessages(e,t){var n,i,a;const r={searchTerm:e,timeStamp:(n=t.timestamp)!=null?n:Date.now(),size:(i=t.size)!=null?i:75,from:0,reversed:(a=t.reversed)!=null?a:!0};t.channelId&&(r.channelId=t.channelId);try{const c=await o(this,vt).sendMessagePromise(Ae.searchChannelMessages,k0.toBinary(r));return Ug.fromBinary(c.payload).messages}catch(c){return[]}}async getAllChannels(){try{const e=await o(this,vt).sendMessagePromise(Ae.getAllChatChannels);return Ys.fromBinary(e.payload).chatChannels.map(Sn.formatChannel)}catch(e){return[]}}async markLastReadMessage(e,t){const r=await o(this,vt).sendMessagePromise(Ae.markChannelIndexAsRead,A0.toBinary({channelId:e,userId:t.userId,channelIndex:t.channelIndex}));return D0.fromBinary(r.payload).channelIndex}async setPinState(e,t){const r={chatId:e.id,pinned:t,channelId:e.channelId},n=await o(this,vt).sendMessagePromise(Ae.pinMessage,E0.toBinary(r));return wd.fromBinary(n.payload)}on(e,t){let r,n;switch(e){case Ae.sendMessageToRoom:{r=ch.fromBinary.bind(ch),n=ch.create();break}case Ae.sendMessageToPeers:{r=dh.fromBinary.bind(dh),n=dh.create();break}case Ae.editMessage:{r=Pd.fromBinary.bind(Pd),n=Pd.create();break}case Ae.pinMessage:{r=wd.fromBinary.bind(wd),n=wd.create();break}case Ae.deleteMessage:{r=Cd.fromBinary.bind(Cd),n=Cd.create();break}}if(!r){u.warn(`ChatSocketHandler::Event ${e} is not recognized`);return}o(this,vt).on(e,({payload:i})=>{let a=n;try{a=r(i)}catch(c){u.error("chatSocketHandler::on::binary_decode_error",{error:c})}return t(a)})}}vt=new WeakMap,Ts([T.trace("SocketService.getChatMessages")],ts.prototype,"getChatMessages",1),Ts([T.trace("SocketService.getChatMessagesPaginated")],ts.prototype,"getChatMessagesPaginated",1),Ts([T.trace("SocketService.sendMessageToRoom")],ts.prototype,"sendMessageToRoom",1),Ts([T.trace("SocketService.sendMessageToPeers")],ts.prototype,"sendMessageToPeers",1),Ts([T.trace("SocketService.sendMessageToChannel")],ts.prototype,"sendMessageToChannel",1),Ts([T.trace("SocketService.sendMessage")],ts.prototype,"sendMessage",1),Ts([T.trace("SocketService.editMessage")],ts.prototype,"editMessage",1),Ts([T.trace("SocketService.deleteMessage")],ts.prototype,"deleteMessage",1),Ts([T.trace("SocketService.searchMessages")],ts.prototype,"searchMessages",1),Ts([T.trace("SocketService.getAllChannels")],ts.prototype,"getAllChannels",1),Ts([T.trace("SocketService.markLastReadMessage")],ts.prototype,"markLastReadMessage",1);function gD(s){return s.replace(/([-_]\w)/g,e=>e[1].toUpperCase())}function Ss(s){if(!s||typeof s!="object")return s;if(Array.isArray(s))return s.map(t=>Ss(t));const e={};return Object.keys(s).forEach(t=>{const r=Yl(t)?t:gD(t);e[r]=Ss(s[t])}),e}function vD(s){return s.replace(/[A-Z]/g,e=>`_${e.toLowerCase()}`)}function Yg(s){if(!s||typeof s!="object")return s;if(Array.isArray(s))return s.map(t=>Yg(t));const e={};return Object.keys(s).forEach(t=>{const r=Yl(t)?t:vD(t);e[r]=s[t]}),e}function kd(s,e={}){return s==null?{}:(Object.getOwnPropertyNames(s).forEach(t=>{if(typeof s[t]!="function"){if(typeof s[t]=="object"){kd(s[t],e[t]={});return}e[t]=s[t]}}),e)}class Qg{constructor(e){m(this,"defaults");this.defaults={baseURL:e.baseURL,headers:{common:{}},timeout:e.timeout,retry:e.retry,retryDelay:e.retryDelay}}buildURL(e,t){const{baseURL:r}=this.defaults,n=e.startsWith("http")?e:`${r}${e.startsWith("/")?e:`/${e}`}`;if(t){const i=new URLSearchParams;return Object.entries(t).forEach(([a,c])=>{i.append(a,c)}),`${n}${n.includes("?")?"&":"?"}${i.toString()}`}return n}async request(e){var l;const t=((l=e.method)==null?void 0:l.toUpperCase())||"GET",r=this.buildURL(e.url||"",e.params),n={...this.defaults.headers.common,...e.headers};t!=="GET"&&t!=="HEAD"&&e.data&&!n["Content-Type"]&&(n["Content-Type"]="application/json");const i={method:t,headers:n,body:t!=="GET"&&t!=="HEAD"&&e.data?JSON.stringify(e.data):void 0},a=e.timeout||this.defaults.timeout,c=e.retry!==void 0?e.retry:this.defaults.retry,d=e.retryDelay||this.defaults.retryDelay;try{const h=new AbortController,p=setTimeout(()=>h.abort(),a);i.signal=h.signal;const f=await fetch(r,i);clearTimeout(p);let y=null;const _=f.headers.get("content-type");_&&_.includes("application/json")?y=await f.json():y=await f.text();const b={};f.headers.forEach((x,B)=>{b[B]=x});const I={data:y,status:f.status,statusText:f.statusText,headers:b,config:e};if(!f.ok)throw I;return I}catch(h){if(h instanceof Error&&c>0)return await new Promise(p=>setTimeout(p,d)),this.defaults.baseURL==="https://api.dyte.io"?this.defaults.baseURL="https://api.cluster.dyte.in":this.defaults.baseURL==="https://api.cluster.dyte.in"&&(this.defaults.baseURL="https://api.dyte.io"),this.request({...e,retry:c-1});throw h}}async get(e,t={}){return this.request({...t,method:"GET",url:e})}async post(e,t,r={}){return this.request({...r,method:"POST",url:e,data:t})}async put(e,t,r={}){return this.request({...r,method:"PUT",url:e,data:t})}}const yD=3,TD=30,SD=8e3;class ED{constructor(e,t){m(this,"ipInfo");m(this,"fetchClient");m(this,"requests");m(this,"roomName");m(this,"roomUUID");m(this,"authToken");m(this,"organizationId");m(this,"iceServers");m(this,"pluginInformation");m(this,"userDetails");m(this,"roomDetails");m(this,"context");this.context=e;const{timeout:r=SD,retry:n=yD,retryDelay:i=TD,baseURL:a="https://api.dyte.io",authToken:c,cachedUserDetails:d}=t||{};this.iceServers=d==null?void 0:d.iceServers,this.pluginInformation=d==null?void 0:d.pluginInformation,this.userDetails=d==null?void 0:d.userDetails,this.roomDetails=d==null?void 0:d.roomDetails,this.requests=new Qg({baseURL:a,timeout:r,retry:n,retryDelay:i,responseType:"json"}),this.fetchClient=new Qg({baseURL:"",timeout:r,retry:n,retryDelay:i,responseType:"json"}),this.setAuthToken(c,{bearer:!0});const l=this.requests.request.bind(this.requests);this.requests.request=async h=>{var p,f,y,_,b;try{T.injectContext(this.requests.defaults.headers.common);const I=await l(h);return h.url!==T.logsEndpoint&&u.debug("xhr::fetch",{networkCall:{status:I.status,statusText:I.statusText,baseURL:h.baseURL||this.requests.defaults.baseURL,url:h.url,method:h.method}}),I}catch(I){throw I?(((p=I.config)==null?void 0:p.url)!==T.logsEndpoint&&u.error("xhr::fetch",{error:I,networkCall:{status:I.status,statusText:I.statusText,baseURL:((f=I.config)==null?void 0:f.baseURL)||this.requests.defaults.baseURL,url:(y=I.config)==null?void 0:y.url,retries:(_=I.config)==null?void 0:_.retry,method:(b=I.config)==null?void 0:b.method,isOnline:navigator.onLine?"online":"offline"}}),new P(I.message||"Network request failed","0011")):new P("Unknown network error occurred","0011")}}}get peerId(){return this.context.getValue("peerId")}setAuthToken(e,t){const{bearer:r}=t||{};this.authToken=e,this.requests.defaults.headers.common.Authorization=r?`Bearer ${e}`:e}setHeader(e,t){this.requests.defaults.headers.common[e]=t}setRoomName(e){this.roomName=e}setRoomUUID(e){this.roomUUID=e}setOrganizationId(e){this.organizationId=e}}var _D=Object.defineProperty,bD=Object.getOwnPropertyDescriptor,ss=(s,e,t,r)=>{for(var n=r>1?void 0:r?bD(e,t):e,i=s.length-1,a;i>=0;i--)(a=s[i])&&(n=(r?a(e,t,n):a(n))||n);return r&&n&&_D(e,t,n),n};class Gt extends ED{constructor(e,t){super(e,t),this.setHeader("x-dyte-web-core-version",e.getValue("sdkVersion"))}async getIPDetails(){var t;const{peerId:e}=this;try{const r=await zl.getIPDetails({peerId:e,apiHostnames:Yf(this.context),logger:u});if(u.log("ipInfo",{ipInfo:r}),((t=r==null?void 0:r.loc)==null?void 0:t.length)>5)return r;throw Error("Insufficient data")}catch(r){u.warn("ApiClient.getRoomNodeLinkAndTitleV1 Failed to get ip details",{error:{name:r.name,message:r.message}});return}}async getICEServers(){if(this.iceServers)return this.iceServers;const{success:e,iceServers:t}=(await this.requests.get("/iceservers")).data;if(e)return(t==null?void 0:t.length)>0&&(this.iceServers=t),t}async getPlugins(){var n,i,a,c,d,l,h;if(this.pluginInformation)return this.pluginInformation;const{plugins:e}=(await this.requests.get("/v2/plugins/user")).data.data,t=((i=(n=ee.getValue(se.V1_PLUGINS))==null?void 0:n.toString())==null?void 0:i.split(","))||[],r=e.reduce((p,f)=>(p[t.includes(f.id)?"v1":"v2"].push({...f,name:f.name.replace("v2","")}),p),{v1:[],v2:[]});return(d=(c=(a=this.context.getValue("modules"))==null?void 0:a.devTools)==null?void 0:c.plugins)!=null&&d.length&&((h=(l=this.context.getValue("modules"))==null?void 0:l.devTools)==null||h.plugins.forEach(p=>{var y,_,b;const f={...Za,tags:[...Za.tags],baseUrl:`http://localhost:${p.port}`,name:p.name,picture:(y=p.picture)!=null?y:Za.picture,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),id:p.id,organizationId:this.organizationId,description:(_=p.description)!=null?_:Za.description,staggered:(b=p.staggered)!=null?b:Za.staggered};r.v2.push(f)})),r.v2}async getPluginDetails(e){const{plugin:t}=(await this.requests.get(`/v2/plugins/view/${e}`)).data.data;return t}async getPluginConfig(e){return(await this.fetchClient.get(`${e}/dyte-config.json`)).data}async authorizePlugin(e){const t={peerId:this.peerId},{token:r}=(await this.requests.post(`/v2/plugins/authorize/${e}`,t)).data.data;return r}async getPresignedUrls(e,t){const r=dd(this.context,"chat_upload_expiry"),n={roomUUID:this.roomUUID,filename:e,expiry:typeof r=="number"?r:void 0};ee.hasFeature(se.FEAT_CHAT_SDK)&&(n.viewType=t);const{getLocation:i,putLocation:a}=(await this.requests.post("/v1/meetings/genPreSignedUploadUrl",n)).data.data;return{getLocation:i,putLocation:a}}async uploadFile(e,t){if(navigator.isReactNative&&"uri"in e)try{await fetch(t,{method:"PUT",headers:{"Content-Type":"application/octet-stream"},body:{uri:e.uri,name:e.name}})}catch(r){u.error(`sendFileMessage::${r}`)}else await this.fetchClient.put(t,e,{headers:{"Content-Type":e.type}})}async startLivestreaming({manualIngestion:e}){const t=Ss(await this.requests.post(`/v2/meetings/${this.context.getValue("meetingId")}/livestreams`,{manual_ingest:!!e})).data.data;return{playbackUrl:t.playbackUrl,status:t.status,manualIngest:t.manualIngest,ingestionCredentials:t.streamKey?{ingestionServer:t.ingestServer,streamKey:t.streamKey}:null}}async stopLivestreaming(){return this.requests.post(`/v2/meetings/${this.context.getValue("meetingId")}/active-livestream/stop`)}async getActiveLivestream(){const e=Ss((await this.requests.get(`/v2/meetings/${this.context.getValue("meetingId")}/active-livestream`)).data.data);return{playbackUrl:e.playbackUrl,status:e.status,manualIngest:e.manualIngest,ingestionCredentials:e.streamKey?{ingestionServer:e.ingestServer,streamKey:e.streamKey}:null}}async getUserDetails(){if(this.userDetails)return this.userDetails;const e=(await this.requests.get("v2/internals/participant-details")).data.data;return Ss(e)}async startRecording(e,t){return(await this.requests.post("/v2/recordings",{...Yg(e),meeting_id:this.context.getValue("meetingId"),allow_multiple_recordings:!!t})).data.data.id}async updateRecording(e,t){return this.requests.put(`v2/recordings/${e}`,{action:t})}async getActiveRecording(){const{status:e,id:t}=(await this.requests.get(`v2/recordings/active-recording/${this.context.getValue("meetingId")}`)).data.data;return{status:e,id:t}}async getActiveTranscript(){const{transcript_download_url:e}=(await this.requests.get(`v2/meetings/${this.context.getValue("meetingId")}/active-transcript`)).data.data;try{return{transcript:(await this.fetchClient.get(e)).data}}catch(t){throw new P("Cant fetch transcript s3 url","1801")}}async getRoomNodeData(){const e=await this.getIPDetails();if(this.ipInfo=e,this.roomDetails)return this.roomDetails;const{roomNodeLink:t,title:r,useHiveMedia:n,sfu:i}=Ss((await this.requests.post("v2/internals/rooms",{ip_information:e})).data.data);return{roomNodeUrl:t,meetingTitle:r,useHiveMedia:n!=null?n:!1,sfu:i}}}ss([T.trace("APIClient.getIPDetails")],Gt.prototype,"getIPDetails",1),ss([T.trace("APIClient.getICEServers")],Gt.prototype,"getICEServers",1),ss([T.trace("APIClient.getPlugins")],Gt.prototype,"getPlugins",1),ss([T.trace("APIClient.startLivestreaming")],Gt.prototype,"startLivestreaming",1),ss([T.trace("APIClient.stopLivestreaming")],Gt.prototype,"stopLivestreaming",1),ss([T.trace("APIClient.getActiveLivestream")],Gt.prototype,"getActiveLivestream",1),ss([T.trace("APIClient.getUserDetails")],Gt.prototype,"getUserDetails",1),ss([T.trace("APIClient.startRecording")],Gt.prototype,"startRecording",1),ss([T.trace("APIClient.stopRecording")],Gt.prototype,"updateRecording",1),ss([T.trace("APIClient.getActiveRecording")],Gt.prototype,"getActiveRecording",1),ss([T.trace("APIClient.getActiveTranscript")],Gt.prototype,"getActiveTranscript",1),ss([T.trace("APIClient.getRoomNodeData")],Gt.prototype,"getRoomNodeData",1);let vh;function wD(s,e){return vh=new Gt(s,e),vh}function at(){return vh}function PD(s,e){return`<blockquote>${e.replace(/<blockquote>[.\s\S]*<\/blockquote>\n\n/m,"")}</blockquote>

${s}`}const _i={maxInvocations:5,period:1};function xt(s,e){return function(t,r,n){const i=n.value;let a=0,c=Date.now();return n.value=function(...d){const l=Date.now(),h=e?this[e]:s;if(l-c>h.period*1e3&&(c=l,a=0),a>=h.maxInvocations)throw new P(`Method rate limit ${h.maxInvocations} invocations/${h.period}sec exceeded`,"0013");return a+=1,i.apply(this,d)},n}}var CD=Object.defineProperty,RD=Object.getOwnPropertyDescriptor,mt=(s,e,t,r)=>{for(var n=r>1?void 0:r?RD(e,t):e,i=s.length-1,a;i>=0;i--)(a=s[i])&&(n=(r?a(e,t,n):a(n))||n);return r&&n&&CD(e,t,n),n};const kD=["text","image","file","custom","poll"],Id={maxInvocations:180,period:60};let tt=(iy=class extends jt{constructor(e,t,r,n,i){super();g(this,ol);m(this,"messages");m(this,"channels",[]);g(this,te,void 0);g(this,Nn,void 0);g(this,Ke,void 0);g(this,Ln,void 0);g(this,_o,void 0);m(this,"maxTextLimit",2e3);v(this,_o,e),v(this,Ke,t),v(this,Ln,r),v(this,te,n),v(this,Nn,i),this.messages=[]}setMaxTextLimit(e){this.maxTextLimit=e}get socketJoined(){return o(this,ol,_y).socketJoined===!0}async sendMessageInternal(e,t,r,n={}){switch(e.type){case"text":{const i=n.replyTo&&n.replyTo.type==="text"?PD(e.message,n.replyTo.message):e.message;await this.sendTextMessageInternal(i,t,r);break}case"image":await this.sendImageMessageInternal(e.image,t,r);break;case"file":await this.sendFileMessageInternal(e.file,t,r);break;default:u.error("sendMessage::message_type_not_supported",{dyteChat:{messageType:e.type}});break}}async sendTextMessageInternal(e,t,r){var i,a,c,d,l,h;if(e.length>this.maxTextLimit)throw new P("Max character limit breached","0503");if(t&&t.length>0){if(!((i=o(this,te).permissions)!=null&&i.chatPrivate.canSend)||!((a=o(this,te).permissions)!=null&&a.chatPrivate.text))throw u.error("sendTextMessage::private_chat_permission_denied"),new P("Could not send message to private chat.","0501")}else if(!((d=(c=o(this,te).permissions)==null?void 0:c.chatPublic)!=null&&d.canSend)||!((h=(l=o(this,te).permissions)==null?void 0:l.chatPublic)!=null&&h.text))throw u.error("sendTextMessage::public_chat_permission_denied"),new P("Could not send message to public chat.","0501");if(!e)throw u.error("sendTextMessage::message_can_not_be_empty"),new P("Message can not be empty.","0502");if(r){o(this,Ke).sendMessageToChannel(e,bt.TEXT,r);return}let n=[];t&&t.length>0&&(t.push(o(this,te).id),n=o(this,Nn).joined.toArray().filter(p=>t.includes(p.id)).map(p=>p.userId),n.push(o(this,te).userId)),o(this,Ke).sendMessage(e,bt.TEXT,t)}async sendImageMessageInternal(e,t,r){var i,a,c,d,l,h;if(t&&t.length>0){if(!((i=o(this,te).permissions)!=null&&i.chatPrivate.canSend)||!((a=o(this,te).permissions)!=null&&a.chatPrivate.files)){u.error("sendImageMessage::private_chat_permission_denied");return}}else if(!((d=(c=o(this,te).permissions)==null?void 0:c.chatPublic)!=null&&d.canSend)||!((h=(l=o(this,te).permissions)==null?void 0:l.chatPublic)!=null&&h.files)){u.error("sendImageMessage::permission_denied");return}if(!e){u.error("sendImageMessage::required_argument_image_can_not_be_empty");return}if(!["image/gif","image/jpeg","image/png"].includes(e.type)){u.error("sendImageMessage::image_type_not_supported",{dyteChat:{imageType:e.type}});return}try{const p=at(),{getLocation:f,putLocation:y}=await p.getPresignedUrls(e.name,o(this,te).config.viewType);if(await p.uploadFile(e,y),r){o(this,Ke).sendMessageToChannel(f,bt.IMAGE,r);return}let _=[];t&&t.length>0&&(t.push(o(this,te).id),_=o(this,Nn).joined.toArray().filter(b=>t.includes(b.id)).map(b=>b.userId),_.push(o(this,te).userId)),o(this,Ke).sendMessage(f,bt.IMAGE,t)}catch(p){throw new P("Error sending image message.","0500")}}async sendFileMessageInternal(e,t,r){var n,i,a,c,d,l;if(t&&t.length>0){if(!((n=o(this,te).permissions)!=null&&n.chatPrivate.canSend)||!((i=o(this,te).permissions)!=null&&i.chatPrivate.files)){u.error("sendFileMessage::private_chat_permission_denied");return}}else if(!((c=(a=o(this,te).permissions)==null?void 0:a.chatPublic)!=null&&c.canSend)||!((l=(d=o(this,te).permissions)==null?void 0:d.chatPublic)!=null&&l.files)){u.error("sendFileMessage::permission_denied");return}if(!e){u.error("sendFileMessage::required_argument_file_can_not_be_empty");return}try{const h=at(),{getLocation:p,putLocation:f}=await h.getPresignedUrls(e.name,o(this,te).config.viewType);if(await h.uploadFile(e,f),r){o(this,Ke).sendMessageToChannel(JSON.stringify({link:p,name:e.name,size:"size"in e?e.size:0}),bt.FILE,r);return}let y=[];t&&t.length>0&&(t.push(o(this,te).id),y=o(this,Nn).joined.toArray().filter(b=>t.includes(b.id)).map(b=>b.userId),y.push(o(this,te).userId));const _=JSON.stringify({link:p,name:e.name,size:"size"in e?e.size:0});o(this,Ke).sendMessage(_,bt.FILE,t)}catch(h){throw new P("Error sending file message.","0500")}}get rateLimits(){return Id}updateRateLimits(e,t){Id.maxInvocations=e,Id.period=t}async sendTextMessage(e,t){return this.sendTextMessageInternal(e,t)}async sendCustomMessage(e,t){var i,a,c,d,l,h,p,f,y,_,b,I,x,B,H;if(t&&t.length>0){if(!((i=o(this,te).permissions)!=null&&i.chatPrivate.canSend)||!((a=o(this,te).permissions)!=null&&a.chatPrivate.files)||!((c=o(this,te).permissions)!=null&&c.chatPrivate.text)){u.error("sendCustomMessage::private_chat_permission_denied");return}}else if(!((l=(d=o(this,te).permissions)==null?void 0:d.chatPublic)!=null&&l.canSend)||!((p=(h=o(this,te).permissions)==null?void 0:h.chatPublic)!=null&&p.files)||!((y=(f=o(this,te).permissions)==null?void 0:f.chatPublic)!=null&&y.text)){u.error("sendCustomMessage::permission_denied");return}const r=async M=>{try{if(typeof M=="string")return{link:M};const z=at(),{getLocation:ne,putLocation:ue}=await z.getPresignedUrls(M.name,o(this,te).config.viewType);return await z.uploadFile(M,ue),{link:ne,type:M.type,name:M.name,size:M.size}}catch(z){throw new P("Error sending image message.","0500")}},n={...e,files:await Promise.all((b=(_=e.files)!=null?_:[])==null?void 0:b.map(async M=>r(M))),images:await Promise.all((x=(I=e.images)!=null?I:[])==null?void 0:x.map(async M=>r(M))),videos:await Promise.all((H=(B=e.videos)!=null?B:[])==null?void 0:H.map(async M=>r(M)))};o(this,Ke).sendMessage(JSON.stringify(n),bt.CUSTOM,t)}async sendImageMessage(e,t){return this.sendImageMessageInternal(e,t)}async sendFileMessage(e,t){return this.sendFileMessageInternal(e,t)}async sendMessage(e,t){return this.sendMessageInternal(e,t)}async editTextMessage(e,t,r){var n,i,a,c,d,l;if(((i=(n=o(this,te).permissions)==null?void 0:n.chatMessage)==null?void 0:i.canEdit)==="NONE")throw new P("Not permitted to edit messages","0501");if(!((c=(a=o(this,te).permissions)==null?void 0:a.chatPublic)!=null&&c.canSend)||!((l=(d=o(this,te).permissions)==null?void 0:d.chatPublic)!=null&&l.text)){u.error("editTextMessage::permission_denied");return}if(!t){u.error("editTextMessage::message_can_not_be_empty");return}o(this,Ke).editMessage(e,t,bt.TEXT,r)}async editImageMessage(e,t,r){var i,a,c,d;if(!((a=(i=o(this,te).permissions)==null?void 0:i.chatPublic)!=null&&a.canSend)||!((d=(c=o(this,te).permissions)==null?void 0:c.chatPublic)!=null&&d.files)){u.error("editImageMessage::permission_denied");return}if(!t){u.error("editImageMessage::required_argument_image_can_not_be_empty");return}if(!["image/gif","image/jpeg","image/png"].includes(t.type)){u.error("sendImageMessage::image_type_not_supported",{dyteChat:{imageType:t.type}});return}try{const l=at(),{getLocation:h,putLocation:p}=await l.getPresignedUrls(t.name,o(this,te).config.viewType);await l.uploadFile(t,p),o(this,Ke).editMessage(e,h,bt.IMAGE,r)}catch(l){throw new P("Error editing image message.","0500")}}async editFileMessage(e,t,r){var n,i,a,c;if(!((i=(n=o(this,te).permissions)==null?void 0:n.chatPublic)!=null&&i.canSend)||!((c=(a=o(this,te).permissions)==null?void 0:a.chatPublic)!=null&&c.files)){u.error("sendFileMessage::permission_denied");return}if(!t){u.error("sendFileMessage::required_argument_file_can_not_be_empty");return}try{const d=at(),{getLocation:l,putLocation:h}=await d.getPresignedUrls(t.name,o(this,te).config.viewType);await d.uploadFile(t,h),o(this,Ke).editMessage(e,JSON.stringify({link:l,name:t.name,size:"size"in t?t.size:0}),bt.FILE,r)}catch(d){throw new P("Error editing file message.","0500")}}async editMessage(e,t,r){switch(t.type){case"text":{this.editTextMessage(e,t.message,r);break}case"image":{this.editImageMessage(e,t.image,r);break}case"file":{this.editFileMessage(e,t.file,r);break}default:{u.error("editMessage::message_type_not_supported",{dyteChat:{messageType:t.type}});break}}}async deleteMessage(e,t){var r,n;if(((n=(r=o(this,te).permissions)==null?void 0:r.chatMessage)==null?void 0:n.canDelete)==="NONE")throw new P("Not permitted to delete messages","0501");o(this,Ke).deleteMessage(e,t)}getMessagesByUser(e){return this.messages.filter(t=>t.userId===e)}getMessagesByType(e){return this.messages.filter(t=>t.type===e)}async pin(e){if(!this.socketJoined)throw new P("Can`t pin message without joining room","0505");if(!o(this,te).permissions.pinParticipant)throw new P("You do not have permission to pin messages.","0501");const t=this.messages.find(r=>r.id===e);if(t){o(this,Ke).setPinState(t,!0);return}throw new P(`No message found with id: ${e}`,"0504")}async unpin(e){if(!this.socketJoined)throw new P("Can`t unpin message without joining room","0505");if(!o(this,te).permissions.pinParticipant)throw new P("You do not have permission to unpin messages.","0501");const t=this.messages.find(r=>r.id===e);if(t){o(this,Ke).setPinState(t,!1);return}throw new P(`No message found with id: ${e}`,"0504")}async getMessages(e,t,r,n=0,i=void 0){const a=await o(this,Ke).getChatMessagesPaginated(e,t,r,n,i);return{messages:a.messages.map(c=>Es.formatSocketServiceMessage(c)),next:a.next}}async createChannel(e,t,r={}){var c;const n=(c=o(this,te).permissions)==null?void 0:c.chatChannel;if(n){if(n.canCreate==="NONE")throw new P("Not permitted to create channels","0501");if(r.visibility==="public"&&!(n.canCreate==="PUBLIC"||n.canCreate==="ALL"))throw new P("Not permitted to create public channels","0501");if(r.visibility==="private"&&!(n.canCreate==="PRIVATE"||n.canCreate==="ALL"))throw new P("Not permitted to create private channels","0501")}if(!e||e.trim().length===0)throw new P("channel name cannot be empty.","0510");const i=[...new Set([...t,o(this,te).userId])];return await o(this,Ln).createChannel(e.trim(),i,r.displayPictureUrl,r.visibility,r.isDirectMessage)}updateChannel(e,t){var a,c,d,l,h;const r=this.channels.find(p=>p.id===e),n=(a=o(this,te).permissions)==null?void 0:a.chatChannel;if(n){if(n.canUpdate==="NONE")throw new P("Not permitted to update channels","0501");if(r.visibility==="public"&&!(n.canUpdate==="PUBLIC"||n.canUpdate==="ALL"))throw new P("Not permitted to update public channels","0501");if(r.visibility==="private"&&!(n.canUpdate==="PRIVATE"||n.canUpdate==="ALL"))throw new P("Not permitted to update private channels","0501")}const i={memberIds:(c=t.memberIds)!=null?c:r.memberIds,displayName:(d=t.displayName)!=null?d:r.displayName,displayPictureUrl:(l=t.displayPictureUrl)!=null?l:r.displayPictureUrl,visibility:(h=t.visibility)!=null?h:r.visibility};return o(this,Ln).updateChannel(e,i)}async sendMessageToChannel(e,t,r={}){return this.sendMessageInternal(e,null,t,r)}async getChannelMembers(e){return o(this,Ln).getChannelMembers(e)}async searchMessages(e,t={}){if(!ee.hasFeature(se.FEAT_CHAT_SDK_SEARCH))throw new P("searchMessages is temporarily disabled!","0506");return(await o(this,Ke).searchMessages(e,t)).map(Es.formatSocketServiceMessage)}async markLastReadMessage(e,t){await o(this,Ke).markLastReadMessage(e,t);const r=this.channels.find(n=>n.id===e);if(r){const n={...r,unreadCount:0};this.channels=this.channels.map(i=>i.id===e?n:i),this.emit("channelMessageUpdate",n)}}get pinned(){return this.messages.filter(e=>e.pinned)}},te=new WeakMap,Nn=new WeakMap,Ke=new WeakMap,Ln=new WeakMap,_o=new WeakMap,ol=new WeakSet,_y=function(){return o(this,_o).getValue("connectionHandler")},iy);mt([T.trace("DyteChat.sendTextMessage"),xt(Id)],tt.prototype,"sendTextMessage",1),mt([T.trace("DyteChat.sendImageMessage"),xt({maxInvocations:20,period:60})],tt.prototype,"sendImageMessage",1),mt([T.trace("DyteChat.sendFileMessage"),xt({maxInvocations:20,period:60})],tt.prototype,"sendFileMessage",1),mt([T.trace("DyteChat.sendMessage"),xt({maxInvocations:180,period:60})],tt.prototype,"sendMessage",1),mt([T.trace("DyteChat.editTextMessage")],tt.prototype,"editTextMessage",1),mt([T.trace("DyteChat.editImageMessage")],tt.prototype,"editImageMessage",1),mt([T.trace("DyteChat.editFileMessage")],tt.prototype,"editFileMessage",1),mt([T.trace("DyteChat.editMessage")],tt.prototype,"editMessage",1),mt([T.trace("DyteChat.deleteMessage")],tt.prototype,"deleteMessage",1),mt([T.trace("DyteChat.createChannel")],tt.prototype,"createChannel",1),mt([T.trace("DyteChat.updateChannel")],tt.prototype,"updateChannel",1),mt([T.trace("DyteChat.sendMessageToChannel")],tt.prototype,"sendMessageToChannel",1),mt([T.trace("DyteChat.getChannelMembers")],tt.prototype,"getChannelMembers",1),mt([T.trace("DyteChat.searchMessages")],tt.prototype,"searchMessages",1),mt([T.trace("DyteChat.markLastReadMessage")],tt.prototype,"markLastReadMessage",1),tt=mt([ht("0500")],tt);var ID=Object.defineProperty,AD=Object.getOwnPropertyDescriptor,MD=(s,e,t,r)=>{for(var n=r>1?void 0:r?AD(e,t):e,i=s.length-1,a;i>=0;i--)(a=s[i])&&(n=(r?a(e,t,n):a(n))||n);return r&&n&&ID(e,t,n),n};const En=(ay=class{constructor(s,e,t,r,n){m(this,"chat");m(this,"chatSocketHandler");m(this,"chatChannelSocketHandler");m(this,"self");g(this,cl,void 0);v(this,cl,s),this.chatSocketHandler=e,this.chatChannelSocketHandler=t,this.chat=new tt(s,e,t,r,n),this.self=r,this.setupEvents()}static async init(s,e,t,r,n){return new En(s,e,t,r,n)}static formatMessage(s){return{...s,time:new Date(s.time),type:kD[s.type]}}static formatSocketServiceMessage(s){const e=s.createdAt*1e3,t={displayName:s.displayName,id:s.chatId,time:e,timeMs:s.createdAtMs,type:s.payloadType,isEdited:s.isEdited,userId:s.userId,targetUserIds:s.targetUserIds,channelId:s.channelId,channelIndex:s.channelIndex,message:"",link:"",name:"",html:"",images:[],videos:[],files:[],size:0,pinned:s.pinned};switch(t.type){case bt.TEXT:{t.message=s.payload;break}case bt.IMAGE:{t.link=s.payload;break}case bt.FILE:{const{link:r,name:n,size:i}=JSON.parse(s.payload);t.link=r,t.name=n,t.size=i;break}case bt.CUSTOM:{const{html:r,images:n,message:i,videos:a,files:c}=JSON.parse(s.payload);t.message=i,t.html=r,t.images=n,t.videos=a,t.files=c;break}}return En.formatMessage(t)}async getChatMessages(){if(this.self.config.viewType==="LIVESTREAM"||this.self.config.viewType==="CHAT"||ee.hasFeature(se.FEAT_PAGINATED_CHAT))return;const s=await this.chatSocketHandler.getChatMessages();if(!(s!=null&&s.payload))return;const e=Ug.fromBinary(s.payload).messages;this.chat.messages=e.map(t=>En.formatSocketServiceMessage(t))}setupEvents(){R.on(k.SOCKET_SERVICE_ROOM_JOINED,async()=>{this.getChatMessages()}),this.chatSocketHandler.on(Ae.sendMessageToRoom,s=>{const e=En.formatSocketServiceMessage(s.message);if(!e.channelId)this.chat.messages=[...this.chat.messages,e];else{const t=this.chat.channels.find(r=>r.id===e.channelId);t&&(t.latestMessage=e,t.unreadCount+=1,this.chat.emit("channelMessageUpdate",t))}this.chat.emit("chatUpdate",{action:"add",message:e,messages:this.chat.messages})}),this.chatSocketHandler.on(Ae.sendMessageToPeers,s=>{const e=En.formatSocketServiceMessage(s.message);this.chat.messages=[...this.chat.messages,e],this.chat.emit("chatUpdate",{action:"add",message:e,messages:this.chat.messages})}),this.chatSocketHandler.on(Ae.editMessage,s=>{const e=En.formatSocketServiceMessage(s.message);if(e.channelId){this.chat.emit("chatUpdate",{action:"edit",message:e,messages:this.chat.messages});return}const t=this.chat.messages.findIndex(r=>r.id===e.id);t!==-1&&(this.chat.messages[t]=e,this.chat.emit("chatUpdate",{action:"edit",message:e,messages:this.chat.messages}))}),this.chatSocketHandler.on(Ae.deleteMessage,s=>{if(s.channelId){this.chat.emit("chatUpdate",{action:"delete",message:{id:s.chatId,channelId:s.channelId},messages:this.chat.messages});return}const e=this.chat.messages.findIndex(r=>r.id===s.chatId);if(e===-1)return;const[t]=this.chat.messages.splice(e,1);this.chat.emit("chatUpdate",{action:"delete",message:t,messages:this.chat.messages})}),this.chatChannelSocketHandler.on(Tn.createChatChannel,s=>{const[e]=s.chatChannels,t=Sn.formatChannel(e);this.chat.channels.push(t),this.chat.emit("channelCreate",t)}),this.chatSocketHandler.on(Ae.pinMessage,s=>{const e=this.chat.messages.findIndex(r=>r.id===s.chatId);if(e===-1)return;const t=this.chat.messages[e];t.pinned=s.pinned,this.chat.messages[e]=t,this.chat.emit("chatUpdate",{action:"edit",message:t,messages:this.chat.messages})}),this.chatChannelSocketHandler.on(Tn.updateChatChannel,s=>{const[e]=s.chatChannels,t=Sn.formatChannel(e);this.chat.channels=this.chat.channels.map(r=>r.id===t.id?t:r),this.chat.emit("channelUpdate",t)})}},cl=new WeakMap,ay);let Es=En;MD([T.trace("ChatController.setupEvents")],Es.prototype,"setupEvents",1);var DD=Object.defineProperty,OD=Object.getOwnPropertyDescriptor,ND=(s,e,t,r)=>{for(var n=r>1?void 0:r?OD(e,t):e,i=s.length-1,a;i>=0;i--)(a=s[i])&&(n=(r?a(e,t,n):a(n))||n);return r&&n&&DD(e,t,n),n};let yh=(oy=class extends jt{constructor(e,t,r){super();g(this,dl);m(this,"items");g(this,Fi,void 0);g(this,Bi,void 0);g(this,bo,void 0);v(this,bo,e),v(this,Fi,t),v(this,Bi,r),this.items=[]}get socketJoined(){var e;return((e=o(this,dl,by))==null?void 0:e.socketJoined)===!0}async create(e,t,r=!1,n=!1){if(!this.socketJoined)throw new P("Can't create polls without joining room","0705");if(!o(this,Fi).permissions.polls.canCreate){u.error("DytePolls::create::permission_denied");return}if(!e||!t){u.error("DytePolls::question_and_options_can_not_be_empty",{dytePolls:{hasQuestion:!!e,optionsLength:t==null?void 0:t.length}});return}if(t.length<2){u.error("DytePolls::there_must_be_at_least_two_options",{dytePolls:{hasQuestion:!!e,optionsLength:t.length}});return}await o(this,Bi).createPoll(e,t,r,n)}async vote(e,t){if(!o(this,Fi).permissions.polls.canVote){u.error("DytePolls::vote::permission_denied");return}await o(this,Bi).votePoll(e,t)}},dl=new WeakSet,by=function(){return o(this,bo).getValue("connectionHandler")},Fi=new WeakMap,Bi=new WeakMap,bo=new WeakMap,oy);yh=ND([ht("0700")],yh);var LD=Object.defineProperty,xD=Object.getOwnPropertyDescriptor,VD=(s,e,t,r)=>{for(var n=r>1?void 0:r?xD(e,t):e,i=s.length-1,a;i>=0;i--)(a=s[i])&&(n=(r?a(e,t,n):a(n))||n);return r&&n&&LD(e,t,n),n};const bi=(cy=class{constructor(s,e,t){m(this,"polls");g(this,$i,void 0);g(this,xn,void 0);this.polls=new yh(s,e,t),v(this,$i,e),v(this,xn,t),this.setupEvents()}static async init(s,e,t){return new bi(s,e,t)}canViewPolls(){return o(this,$i).permissions.polls.canView}setupEvents(){const s={[Qs.createPoll]:r=>{r.poll&&this.updatePoll(bi.formatSocketServicePoll(r.poll))},[Qs.updatePoll]:r=>{r.poll&&this.updatePoll(bi.formatSocketServicePoll(r.poll))},[Qs.votePoll]:r=>{r.poll&&this.updatePoll(bi.formatSocketServicePoll(r.poll))}},e=()=>{R.on(k.SOCKET_SERVICE_ROOM_JOINED,()=>{this.getPolls()}),Object.keys(s).map(Number).forEach(r=>{o(this,xn).on(r,s[r])})},t=()=>{R.on(k.SOCKET_SERVICE_ROOM_JOINED,()=>{this.getPolls()}),Object.keys(s).map(Number).forEach(r=>{o(this,xn).removeListeners(r)})};o(this,$i).permissions.on("permissionsUpdate",async r=>{var n;(n=r==null?void 0:r.polls)!=null&&n.canView?(await this.getPolls(),e()):(this.polls.items=[],t())}),this.canViewPolls()&&e()}updatePoll(s){if(!this.canViewPolls())return;const e=this.polls.items.findIndex(t=>t.id===s.id);if(e>-1){const t=JSON.stringify(this.polls.items[e]);this.polls.items[e]=s,t!==JSON.stringify(s)&&this.polls.emit("pollsUpdate",{polls:this.polls.items,newPoll:!1});return}this.polls.items=[...this.polls.items,s],this.polls.emit("pollsUpdate",{polls:this.polls.items,newPoll:!0})}async getPolls(){const s=await o(this,xn).getPolls();if(!(s!=null&&s.payload))return;const{polls:e}=KM.fromBinary(s.payload);this.polls.items=e.map(t=>bi.formatSocketServicePoll(t))}static formatSocketServicePoll(s){const e=s.options.map(t=>({count:t.count,text:t.text,votes:t.votes.map(r=>({id:r.userId,name:r.name}))}));return{anonymous:s.anonymous,createdBy:s.createdBy,createdByUserId:s.createdByUserId,hideVotes:s.hideVotes,id:s.pollId,options:e,question:s.question,voted:s.votes}}},$i=new WeakMap,xn=new WeakMap,cy);let Xg=bi;VD([T.trace("PollController.setupEvents")],Xg.prototype,"setupEvents",1);var UD=Object.defineProperty,FD=Object.getOwnPropertyDescriptor,BD=(s,e,t,r)=>{for(var n=r>1?void 0:r?FD(e,t):e,i=s.length-1,a;i>=0;i--)(a=s[i])&&(n=(r?a(e,t,n):a(n))||n);return r&&n&&UD(e,t,n),n},Zg=(s=>(s[s.User=0]="User",s[s.Meeting=1]="Meeting",s))(Zg||{});let Th=(dy=class extends jt{constructor(e,t,r,n,i){super();g(this,wo);m(this,"selfActiveTab");m(this,"broadcastTabChanges");g(this,Hi,void 0);g(this,Vn,void 0);g(this,Po,void 0);m(this,"viewType");m(this,"meetingStartedTimestamp");m(this,"meetingTitle");m(this,"sessionId");v(this,Hi,e),v(this,Vn,t),this.viewType=r,v(this,Po,n),this.meetingTitle=i,this.broadcastTabChanges=t.permissions.canSpotlight}get socketState(){return o(this,wo,sp).socketState}get mediaState(){return o(this,wo,sp).mediaState}get meetingId(){return o(this,Hi).getValue("meetingId")}setBroadcastTabChanges(e){if(!o(this,Vn).permissions.canSpotlight)throw u.error("DyteSpotlight::setSpotlighted::permission_denied"),new P("User does not have permission to toggle spotlight","0801");this.broadcastTabChanges=e,this.emit("broadcastTabChangesUpdate",this.broadcastTabChanges),this.broadcastTabChanges&&this.assertActiveTabToRoom()}setSelfActiveTab(e,t){var r;u.info("DyteSpotlight::setActiveTab",{spotlight:{currentTab:{id:e.id,type:e.type}}}),this.selfActiveTab=e,t===0&&this.emit("selfTabUpdate",e),(r=o(this,Vn).permissions)!=null&&r.canSpotlight&&this.broadcastTabChanges&&t===0&&this.assertActiveTabToRoom()}assertActiveTabToRoom(){o(this,Po).broadcastMessage("spotlight",{userId:o(this,Vn).userId,currentTab:this.selfActiveTab})}},Hi=new WeakMap,wo=new WeakSet,sp=function(){return o(this,Hi).getValue("connectionHandler")},Vn=new WeakMap,Po=new WeakMap,dy);Th=BD([ht("0800")],Th);function $D(s){let e="",t=[""];const r=[t];let n=0,i=0,a=!0,c;for(c of s)c==='"'?(a&&c===e&&(t[n]+=c),a=!a):c===","&&a?c=t[++n]="":c===`
`&&a?(e==="\r"&&(t[n]=t[n].slice(0,-1)),t=r[++i]=[c=""],n=0):t[n]+=c,e=c;return r}var HD=Object.defineProperty,qD=Object.getOwnPropertyDescriptor,ev=(s,e,t,r)=>{for(var n=r>1?void 0:r?qD(e,t):e,i=s.length-1,a;i>=0;i--)(a=s[i])&&(n=(r?a(e,t,n):a(n))||n);return r&&n&&HD(e,t,n),n};let Cr=class extends jt{constructor(){super();m(this,"transcripts");this.transcripts=[]}static async init(e){const t=new Cr;try{e&&t.getActiveTranscript()}catch(r){u.error("Error fetching active transcriptions ",r)}return t}static parseTranscript(e,t=!1){try{if(!e)return;const[[r,n,i,a,c,d]]=$D(e);return{id:hi(),name:c,peerId:n,userId:i,customParticipantId:a,transcript:d,isPartialTranscript:t,date:new Date(parseInt(r,10)*1e3)}}catch(r){u.error(`Failed to parse transcript: ${e}`,r);return}}static parseTranscripts(e){return e?e.split(`
`).map(t=>Cr.parseTranscript(t,!1)).filter(Boolean):[]}async getActiveTranscript(){try{const e=at(),{transcript:t}=await e.getActiveTranscript();this.transcripts=Cr.parseTranscripts(t)}catch(e){}}async onTranscript(e){var r;const t=this.transcripts.filter(({peerId:n})=>n===e.peerId);if((r=t==null?void 0:t.at(-1))!=null&&r.isPartialTranscript){const n=t.at(-1);n.transcript=e.transcript,n.isPartialTranscript=e.isPartialTranscript,this.emit("transcript",n);return}this.transcripts=[...this.transcripts,e],this.emit("transcript",e)}};ev([T.trace("DyteAi.getActiveTranscript")],Cr.prototype,"getActiveTranscript",1),Cr=ev([ht("0000")],Cr);var jD=Object.defineProperty,GD=Object.getOwnPropertyDescriptor,WD=(s,e,t,r)=>{for(var n=r>1?void 0:r?GD(e,t):e,i=s.length-1,a;i>=0;i--)(a=s[i])&&(n=(r?a(e,t,n):a(n))||n);return r&&n&&jD(e,t,n),n};const tv=(ly=class{constructor(s,e,t,r,n,i){m(this,"meta");m(this,"ai");g(this,Fr,void 0);g(this,qi,void 0);m(this,"aiSocketHandler");g(this,ll,void 0);v(this,ll,s),this.meta=new Th(s,e,e.config.viewType,t,i),this.ai=r,v(this,Fr,e),v(this,qi,t),this.aiSocketHandler=n,e.config.viewType!==Et.Chat&&this.setupEvents()}static async init(s,e,t,r,n){const i=await Cr.init(e.permissions.transcriptionEnabled);return new tv(s,e,t,i,r,n)}conditionallySetActiveTab(s){var e;s!=null&&s.currentTab&&((e=this.meta.selfActiveTab)==null?void 0:e.id)!==s.currentTab.id&&(this.meta.setSelfActiveTab(s.currentTab,Zg.Meeting),this.meta.emit("activeTabUpdate",s.currentTab))}setupEvents(){R.on(k.TRANSPORT_STATE_UPDATE,s=>{this.meta.emit("mediaConnectionUpdate",s)}),R.on(k.SOCKET_STATE_UPDATE,s=>{this.meta.emit("socketConnectionUpdate",s)}),R.on(k.ROOM_STATE,({createdAt:s,roomUuid:e})=>{const t=this.meta.meetingStartedTimestamp;if(e&&(this.meta.sessionId=e),s&&!t){const r=new Date(s*1e3);this.meta.meetingStartedTimestamp=r,this.meta.emit("meetingStartTimeUpdate",{meetingStartedTimestamp:this.meta.meetingStartedTimestamp})}}),R.on(k.PRODUCER_SCORE_UPDATE,({score:s})=>{s<5&&this.meta.emit("poorConnection",{score:s})}),o(this,Fr).permissions.canSpotlight&&(u.info("DyteMetaController::Asserting Spotlight"),this.meta.selfActiveTab&&o(this,qi).broadcastMessage("spotlight",{userId:o(this,Fr).userId,currentTab:this.meta.selfActiveTab})),R.on(k.PEER_JOINED_INTERNAL,async s=>{o(this,Fr).permissions.canSpotlight&&this.meta.selfActiveTab&&o(this,qi).broadcastToPeers("spotlight",[s.id],{userId:o(this,Fr).userId,currentTab:this.meta.selfActiveTab})}),R.on(k.ROOM_MESSAGE,s=>{var t,r;let e;if("type"in s){if(s.type!=="spotlight")return;e={...s,...s.payload}}else if("roomMessageType"in s){if(s.roomMessageType!=="spotlight")return;e=s}else return;u.info("Spotlight Assertion Received",{spotlight:{spotlighter:{id:e.userId},currentTab:{id:(t=e.currentTab)==null?void 0:t.id,type:(r=e.currentTab)==null?void 0:r.type}}}),this.conditionallySetActiveTab(e)}),R.on(k.MESSAGE,s=>{var t,r;let e;if("type"in s){if(s.type!=="spotlight")return;e={...s,...s.payload}}else if("roomMessageType"in s){if(s.roomMessageType!=="spotlight")return;e=s}else return;u.info("Spotlight Assertion Received",{spotlight:{spotlighter:{id:e.userId},currentTab:{id:(t=e.currentTab)==null?void 0:t.id,type:(r=e.currentTab)==null?void 0:r.type}}}),this.conditionallySetActiveTab(e)}),this.aiSocketHandler.on(U.transcript,s=>{const{meetingId:e,transcript:t,isPartial:r}=s,n=Cr.parseTranscript(t,r);if(!n){u.warn("Received empty transcript data");return}this.ai.onTranscript(n),this.meta.emit("transcript",n);const{peerId:i,name:a,transcript:c}=n;u.debug(`${e} Received transcript for peer ${i} - ${a}: ${c}`)})}},Fr=new WeakMap,qi=new WeakMap,ll=new WeakMap,ly);let sv=tv;WD([T.trace("MetaController.setupEvents")],sv.prototype,"setupEvents",1);var JD=Object.defineProperty,KD=Object.getOwnPropertyDescriptor,_n=(s,e,t,r)=>{for(var n=r>1?void 0:r?KD(e,t):e,i=s.length-1,a;i>=0;i--)(a=s[i])&&(n=(r?a(e,t,n):a(n))||n);return r&&n&&JD(e,t,n),n};class Rr extends jt{constructor(t,r,n,i,a){super();g(this,Ro);g(this,Gi);g(this,is,void 0);g(this,ji,void 0);g(this,le,void 0);g(this,Co,void 0);g(this,Vs,void 0);g(this,Ps,void 0);v(this,Ps,t),v(this,is,i),v(this,ji,a),v(this,le,r),v(this,Co,n),v(this,Vs,[]),this.setupEvents()}get status(){return o(this,Ps).getValue("stageStatus")}setupEvents(){const t={[k.GET_STAGE_REQUESTS]:async i=>{v(this,Vs,i)},[k.UPDATE_STAGE_REQUESTS]:async({add:i})=>{const a=o(this,Vs).length,{stageRequests:c}=this.getAccessRequests();(i||c.length>a)&&this.emit("newStageRequest",{count:c.length}),this.emit("stageAccessRequestUpdate",c)}},r=()=>{Object.entries(t).forEach(([i,a])=>{R.onAsync(i,a)})},n=()=>{Object.entries(t).forEach(([i,a])=>{R.removeListener(i,a)})};o(this,le).permissions.on("permissionsUpdate",i=>{const{canAcceptProductionRequests:a}=i;a!==void 0&&(o(this,le).permissions.acceptStageRequests?(r(),o(this,is).getStageRequests()):(n(),v(this,Vs,[]),this.emit("stageAccessRequestUpdate",o(this,Vs))))}),o(this,le).permissions.acceptStageRequests&&r()}getAccessRequests(){if(!o(this,le).permissions.stageEnabled)throw u.error("DyteStage::stage_disabled"),new P("Stage is disabled","2003");if(!o(this,le).permissions.acceptStageRequests)throw u.error("DyteStage::get_access_request::permission_denied"),new P("You do not have permission to perform this action","2001");const t=o(this,Co).joined.toArray().filter(r=>r.stageStatus==="REQUESTED_TO_JOIN_STAGE").map(r=>({displayName:r.name,userId:r.userId,peerId:r.id}));return v(this,Vs,t),{stageRequests:o(this,Vs)}}async requestAccess(){if(!o(this,le).permissions.stageEnabled)throw u.error("DyteStage::stage_disabled"),new P("Stage is disabled","2003");if(this.status!=="OFF_STAGE")throw new P(`Unable to request access you are currently ${this.status}`,"2006");if(o(this,le).permissions.stageAccess===W.Allowed){$(this,Gi,jl).call(this,"ACCEPTED_TO_JOIN_STAGE");return}o(this,is).requestAccess(),$(this,Gi,jl).call(this,"REQUESTED_TO_JOIN_STAGE")}async cancelRequestAccess(){if(!o(this,le).permissions.stageEnabled)throw u.error("DyteStage::stage_disabled"),new P("Stage is disabled","2003");o(this,is).cancelRequestAccess(),$(this,Gi,jl).call(this,"OFF_STAGE")}grantAccess(t){if(!o(this,le).roomJoined)throw new P("Can`t grant for participant without joining room");if(!o(this,le).permissions.stageEnabled)throw u.error("DyteStage::stage_disabled"),new P("Stage is disabled","2003");if(!o(this,le).permissions.acceptStageRequests)throw u.error("DyteStage::grant_access::permission_denied"),new P("You do not have permission to perform this action","2001");return o(this,is).grantAccess(t)}denyAccess(t){if(!o(this,le).roomJoined)throw new P("Can`t rejectRequestToJoinStage for participant without joining room","2005");if(!o(this,le).permissions.stageEnabled)throw u.error("DyteStage::stage_disabled"),new P("Stage is disabled","2003");if(!o(this,le).permissions.acceptStageRequests)throw u.error("DyteStage::deny_access::permission_denied"),new P("You do not have permission to perform this action","2001");return o(this,is).denyAccess(t)}async join(){const t=o(this,Ps).getValue("viewType");if(this.status==="ON_STAGE")throw new P("You are already on stage.","2006");if(this.status!=="ACCEPTED_TO_JOIN_STAGE"||o(this,le).permissions.stageAccess===W.NotAllowed)throw new P(`Unable to join stage you are currently ${this.status}`,"2006");if(await o(this,is).joinStage(),t===Et.Livestream){await o(this,ji).joinRoom(o(this,le));const{peers:r}=await o(this,ji).getStagePeers();R.emit(k.SOCKET_PEERS,r)}o(this,Ps).setValue("stageStatus","ON_STAGE"),o(this,le).audioEnabled&&o(this,Ro,rp).shareMic(o(this,le).audioTrack),o(this,le).videoEnabled&&o(this,Ro,rp).shareWebcam(o(this,le).videoTrack)}async leave(){if(!o(this,le).permissions.stageEnabled)throw u.error("DyteStage::stage_disabled"),new P("Stage is disabled","2003");if(!(this.status==="ON_STAGE"||this.status==="ACCEPTED_TO_JOIN_STAGE"))throw new P(`Unable to leave stage you are currently ${this.status}`,"2006");o(this,le).setIsPinned(!1),await o(this,is).leaveStage(o(this,le).userId),o(this,Ps).setValue("stageStatus","OFF_STAGE",!1),await R.emitAsync(k.LEAVE_MEDIA_ROOM,"stageLeft"),o(this,Ps).notify("stageStatus")}async kick(t){if(!o(this,le).roomJoined)throw new P("Can`t kick participant without joining room","2005");if(!o(this,le).permissions.stageEnabled)throw u.error("DyteStage::stage_disabled"),new P("Stage is disabled","2003");if(!o(this,le).permissions.acceptStageRequests)throw u.error("DyteStage::kick::permission_denied"),new P("You do not have permissions for kick","2001");return o(this,is).kick(t)}}is=new WeakMap,ji=new WeakMap,le=new WeakMap,Co=new WeakMap,Vs=new WeakMap,Ps=new WeakMap,Ro=new WeakSet,rp=function(){return o(this,Ps).getValue("roomNodeClient")},Gi=new WeakSet,jl=async function(t){this.status!==t&&o(this,Ps).setValue("stageStatus",t)},_n([T.trace("DyteStage.getStageRequests")],Rr.prototype,"getAccessRequests",1),_n([T.trace("DyteStage.requestAccess")],Rr.prototype,"requestAccess",1),_n([T.trace("DyteStage.cancelRequestAccess")],Rr.prototype,"cancelRequestAccess",1),_n([T.trace("DyteStage.grantAccess")],Rr.prototype,"grantAccess",1),_n([T.trace("DyteStage.denyAccess")],Rr.prototype,"denyAccess",1),_n([T.trace("DyteStage.joinStage")],Rr.prototype,"join",1),_n([T.trace("DyteStage.leaveStage")],Rr.prototype,"leave",1);function zD(s){return!(s.viewType==="LIVESTREAM"||s.viewType==="CHAT")}function Sh(s){switch(s){case zs.UNSPECIFIED:return"OFF_STAGE";case zs.REQUESTED_STAGE:return"REQUESTED_TO_JOIN_STAGE";case zs.APPROVED_STAGE:return"ACCEPTED_TO_JOIN_STAGE";case zs.OFF_STAGE:return"OFF_STAGE";case zs.ON_STAGE:return"ON_STAGE";default:return"OFF_STAGE"}}var YD=Object.defineProperty,QD=Object.getOwnPropertyDescriptor,XD=(s,e,t,r)=>{for(var n=r>1?void 0:r?QD(e,t):e,i=s.length-1,a;i>=0;i--)(a=s[i])&&(n=(r?a(e,t,n):a(n))||n);return r&&n&&YD(e,t,n),n};class rv{constructor(e,t,r,n,i){m(this,"stage");g(this,Br,void 0);g(this,Un,void 0);g(this,$r,void 0);g(this,ko,0);g(this,ar,void 0);v(this,ar,e),this.stage=new Rr(e,n,i,t,r),v(this,$r,t),v(this,Br,n),v(this,Un,i),this.setupEvents()}setupEvents(){o(this,ar).subscribe("stageStatus",e=>{this.stage.emit("stageStatusUpdate",e)}),o(this,$r).on(U.grantStageAccess,()=>{o(this,Br).permissions.stageAccess!==W.Allowed&&(this.stage.emit("stageRequestApproved"),this.setStageStatus("ACCEPTED_TO_JOIN_STAGE"))}),o(this,$r).on(U.peerStageStatusUpdate,e=>{e!==void 0&&(e.peerId===o(this,Br).id?this.selfStageStatusHandler(e):this.peerStageStatusHandler(e))}),o(this,$r).on(U.denyStageAccess,()=>{o(this,Br).permissions.stageAccess!==W.Allowed&&(this.stage.emit("stageRequestRejected"),this.setStageStatus("OFF_STAGE"))}),o(this,$r).on(U.getStageRequests,async e=>{var r;if(o(this,Br).permissions.stageAccess!==W.Allowed)return;const t=(r=e==null?void 0:e.stageRequests)!=null?r:[];await R.emitAsync(k.GET_STAGE_REQUESTS,t),o(this,ko)<t.length&&t.length>0&&this.stage.emit("newStageRequest",{count:t.length}),v(this,ko,t.length),this.stage.emit("stageAccessRequestUpdate",t)})}getCurrentStageRequests(){return o(this,Un).joined.toArray().filter(t=>t.stageStatus==="REQUESTED_TO_JOIN_STAGE").map(t=>({displayName:t.name,userId:t.userId,peerId:t.id}))}async setStageStatus(e){this.stage.status!==e&&o(this,ar).setValue("stageStatus",e)}selfStageStatusHandler(e){const t=Sh(e.stageType),r=o(this,ar).getValue("stageStatus");if(r!==t)switch(e.stageType){case 1:o(this,ar).setValue("stageStatus","ACCEPTED_TO_JOIN_STAGE",!1),this.stage.join();break;case 2:case 3:this.setStageStatus(r);break;case 0:case 4:default:o(this,ar).setValue("stageStatus","ACCEPTED_TO_JOIN_STAGE",!1),this.stage.leave();break}}async peerStageStatusHandler(e){const t=o(this,Un).joined.get(e.peerId),r=o(this,Un).viewMode==="ACTIVE_GRID";if(!t){u.warn("err::peerStageStatusUpdate: participant not found");return}switch(e.stageType){case 1:t.setStageStatus("ON_STAGE"),r&&R.emit(k.UPDATE_ACTIVE);break;case 2:t.setStageStatus("ACCEPTED_TO_JOIN_STAGE");break;case 3:t.setStageStatus("REQUESTED_TO_JOIN_STAGE");break;case 0:case 4:default:t.setStageStatus("OFF_STAGE"),r&&R.emit(k.UPDATE_ACTIVE);break}R.emit(k.UPDATE_PEER_STAGE_STATUS,{id:t.id,status:t.stageStatus})}}Br=new WeakMap,Un=new WeakMap,$r=new WeakMap,ko=new WeakMap,ar=new WeakMap,XD([T.trace("DyteStage.setupEvents")],rv.prototype,"setupEvents",1);var ZD=Object.defineProperty,eO=Object.getOwnPropertyDescriptor,Ad=(s,e,t,r)=>{for(var n=r>1?void 0:r?eO(e,t):e,i=s.length-1,a;i>=0;i--)(a=s[i])&&(n=(r?a(e,t,n):a(n))||n);return r&&n&&ZD(e,t,n),n};const Ne={getPeer:14,getPeers:15,chatMessage:16,getRoomName:17,getDisplayTitle:18,getPluginInitiator:19,customPluginEventToParent:20,peerJoined:22,peerLeft:23,sendData:24,stageStatusUpdate:25,peerStageStatusUpdate:26};let wi=(uy=class extends Ti{constructor(e,{baseURL:t,createdAt:r,description:n,id:i,name:a,organizationId:c,picture:d,private:l,published:h,staggered:p,tags:f,type:y,updatedAt:_},b,I,x,B,H){super();g(this,yt,void 0);m(this,"baseURL");m(this,"createdAt");m(this,"description");m(this,"id");m(this,"name");g(this,zt,void 0);g(this,Wi,void 0);g(this,Ji,void 0);m(this,"organizationId");m(this,"picture");m(this,"private");m(this,"published");m(this,"staggered");m(this,"tags");m(this,"type");m(this,"updatedAt");g(this,or,void 0);m(this,"config");g(this,Ki,void 0);m(this,"active");m(this,"iframes");m(this,"enabledBy");g(this,Fn,void 0);g(this,zi,void 0);v(this,Fn,e),this.baseURL=t,this.createdAt=new Date(r),this.description=n,this.id=i,this.name=a,v(this,zt,I),this.organizationId=c,this.picture=d,this.private=l,this.published=h,this.staggered=p,this.tags=f,this.type=y,this.updatedAt=new Date(_),this.active=!1,this.iframes=new Map,v(this,yt,b),v(this,Wi,x),v(this,Ji,B),this.enabledBy="",v(this,zi,H)}sendIframeEvent(e){this.iframes.size&&this.iframes.forEach(t=>{const{iframe:r}=t;r&&(navigator.isReactNative?r.postMessage(JSON.stringify(e)):r.contentWindow.postMessage(e,"*"))})}async handleIframeMessage(e){var a;if(!this.active)return;const t=e,{payload:r,uuid:n,type:i}=t;switch(i){case J.customPluginEventToRoom:{o(this,yt).customPluginEventToRoom(this.id,r,n);break}case J.customPluginEventToPeers:{o(this,yt).customPluginEventToPeers(this.id,r.peerIds,r,n);break}case J.enablePluginForRoom:{o(this,yt).enablePluginForRoom(this.id,n);break}case J.enablePluginForPeers:{o(this,yt).enablePluginForPeers(this.id,r.peerIds,n);break}case J.disablePluginForRoom:{o(this,yt).disablePluginForRoom(this.id,n);break}case J.disablePluginForPeers:{o(this,yt).disablePluginForPeers(this.id,r.peerIds,n);break}case J.storeInsertKeys:{o(this,yt).storeInsertKeys(this.id,r.store,r.insertKeys,n);break}case J.storeGetKeys:{o(this,yt).storeGetKeys(this.id,r.store,r.getKeys,n);break}case J.storeDeleteKeys:{o(this,yt).storeDeleteKeys(this.id,r.store,r.deleteKeys,n);break}case J.storeDelete:{o(this,yt).storeDelete(this.id,r.store,n);break}case Ne.chatMessage:{const{messagePayload:c,peerIds:d}=r;if(!o(this,Ji)){this.sendIframeEvent({type:Ne.chatMessage,uuid:t.uuid,payload:{error:"Chat is disabled for this room."}});return}try{await o(this,Ji).sendMessage(c,d),this.sendIframeEvent({type:Ne.chatMessage,uuid:t.uuid,payload:{success:!0}})}catch(l){this.sendIframeEvent({type:Ne.chatMessage,uuid:t.uuid,payload:{error:l}})}break}case Ne.getPeer:{let c;const{peerId:d}=r,l={...o(this,zt),id:o(this,zt).id,isRecorder:(a=o(this,zt).permissions)==null?void 0:a.isRecorder,isHidden:o(this,zt).permissions.hiddenParticipant,stageStatus:o(this,zt).stageStatus};d?(c=o(this,Wi).joined.get(r.peerId),o(this,zt).id===d&&(c=l)):c=l,this.sendIframeEvent({type:Ne.getPeer,payload:{peer:c&&kd(c)},uuid:t.uuid});break}case Ne.getPeers:{const c=o(this,Wi).joined.toArray().map(d=>kd(d));this.sendIframeEvent({type:Ne.getPeers,payload:{peers:c},uuid:t.uuid});break}case Ne.getPluginInitiator:{this.sendIframeEvent({type:Ne.getPluginInitiator,payload:{enabledBy:this.enabledBy},uuid:t.uuid});break}case Ne.getDisplayTitle:{this.sendIframeEvent({type:Ne.getDisplayTitle,payload:{displayTitle:o(this,zi)},uuid:t.uuid});break}case Ne.getRoomName:{this.sendIframeEvent({type:Ne.getRoomName,payload:{roomName:o(this,Fn).getValue("meetingId")},uuid:t.uuid});break}case Ne.customPluginEventToParent:{this.emit(t.payload.eventName,t.payload.data);break}}}sendData(e){this.active&&(u.info("DytePlugin::SendData",{plugin:{id:this.id,name:this.name,data:{eventName:e.eventName}}}),this.sendIframeEvent({type:Ne.sendData,uuid:"",payload:e}))}removePluginView(e="default"){var n;const{iframe:t,listener:r}=(n=this.iframes.get(e))!=null?n:{};(t||r)&&(navigator.isReactNative?t.props.onMessage=void 0:window.removeEventListener("message",r),this.iframes.delete(e))}addPluginView(e,t="default"){var a;if(!o(this,Ki))throw u.error("DytePlugin::addPluginView::no_auth_token_set_for_plugin"),new P("No auth token set for plugin.","0602");if(!e)throw u.error("DytePlugin::addPluginView::iframe_was_not_provided"),new P("Iframe was not provided.","0603");this.removePluginView(t);const r=e,n=new URL(this.baseURL),i={auth:o(this,Ki),parent:navigator.isReactNative?this.baseURL:window.location.origin,backend:o(this,Fn).getValue("apiBase"),pluginId:this.id,roomName:(a=o(this,Fn).getValue("meetingId"))!=null?a:"",displayTitle:o(this,zi)};if(Object.keys(i).forEach(c=>{n.searchParams.set(c,i[c])}),r.src=n.href,r.allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",r.title=t,navigator.isReactNative)r.props.onMessage=c=>{this.handleIframeMessage(JSON.parse(c.nativeEvent.data))},this.iframes.set(t,{iframe:r});else{const c=async d=>{d.source===e.contentWindow&&await this.handleIframeMessage(d.data)};window.addEventListener("message",c),this.iframes.set(t,{iframe:r,listener:c})}}setActive(e){var t,r;if(this.active=e,e){this.emit("stateUpdate",{active:this.active,pluginId:this.id,bind:this.addPluginView.bind(this),views:(t=this.config)==null?void 0:t.views});return}this.active=!1,this.emit("stateUpdate",{active:this.active,pluginId:this.id,views:(r=this.config)==null?void 0:r.views})}async activateForSelf(){const e=at(),t=await e.authorizePlugin(this.id);v(this,Ki,t),v(this,or,new Date);try{const r=await e.getPluginConfig(this.baseURL);this.config=r}catch(r){u.error("DytePlugin::activateForSelf",{error:r})}this.setActive(!0),this.emit("enabled")}deactivateForSelf(){Array.from(this.iframes.keys()).forEach(e=>{this.removePluginView(e)}),v(this,or,void 0),this.iframes.clear(),this.setActive(!1),this.emit("closed")}async enable(){return this.activateForSelf()}disable(){return this.deactivateForSelf()}async activate(){var e,t;this.active||(t=(e=o(this,zt).permissions)==null?void 0:e.plugins)!=null&&t.canStart&&(o(this,yt).addPlugin(this.id,this.staggered),v(this,or,new Date),u.info("plugin::activated",{plugin:{id:this.id,enabledBy:this.enabledBy,name:this.name}}))}async deactivate(){var e,t;this.active&&(!((t=(e=o(this,zt).permissions)==null?void 0:e.plugins)!=null&&t.canClose)&&this.enabledBy!==o(this,zt).id||(o(this,yt).removePlugin(this.id),u.info("plugin::deactivated",{plugin:{id:this.id,name:this.name,duration:o(this,or)?new Date().getTime()-o(this,or).getTime():0}}),v(this,or,void 0)))}},yt=new WeakMap,zt=new WeakMap,Wi=new WeakMap,Ji=new WeakMap,or=new WeakMap,Ki=new WeakMap,Fn=new WeakMap,zi=new WeakMap,uy);Ad([xt({maxInvocations:5,period:1})],wi.prototype,"sendData",1),Ad([T.trace("DytePlugin.activatePlugin")],wi.prototype,"activate",1),Ad([T.trace("DytePlugin.deactivatePlugin")],wi.prototype,"deactivate",1),wi=Ad([ht("0600")],wi);class nv extends Map{constructor(t){const{onAddEvent:r,onDeleteEvent:n,onClearEvent:i}=t;super();g(this,$e,void 0);g(this,Bn,void 0);m(this,"onAddEvent");m(this,"onDeleteEvent");m(this,"onClearEvent");v(this,$e,new Ti),this.onAddEvent=r,this.onDeleteEvent=n,this.onClearEvent=i,v(this,Bn,new Map)}emit(t,...r){return o(this,$e).emit(t,...r)}on(t,r){return o(this,$e).on(t,r)}addListener(t,r){return o(this,$e).addListener(t,r)}off(t,r){return o(this,$e).off(t,r)}once(t,r){return o(this,$e).once(t,r)}prependListener(t,r){return o(this,$e).prependListener(t,r)}prependOnceListener(t,r){return o(this,$e).prependOnceListener(t,r)}removeListener(t,r){return o(this,$e).removeListener(t,r)}removeAllListeners(t){return o(this,$e).removeAllListeners(t)}listeners(t){return o(this,$e).listeners(t)}listenerCount(t){return o(this,$e).listenerCount(t)}getMaxListeners(){return o(this,$e).getMaxListeners()}setMaxListeners(t){return o(this,$e).setMaxListeners(t)}eventNames(){return o(this,$e).eventNames()}add(t,r=!0){return this.set(t.id,t,r)}set(t,r,n=!0){const i=super.set(t,r),a=(c,...d)=>{this.emit(c,r,...d)};return o(this,Bn).set(t,a),r.on("*",a),n&&o(this,$e).emit(this.onAddEvent,r),i}delete(t,r=!0,n=!1){const i=this.get(t);if(!i)return!1;i.removeListener("*",o(this,Bn).get(t));const a=super.delete(t);return n&&i.removeAllListeners(),r&&o(this,$e).emit(this.onDeleteEvent,i),a}clear(t=!0,r=!1){this.forEach(i=>{i.removeListener("*",o(this,Bn).get(i.id)),r&&i.removeAllListeners()});const n=super.clear();return t&&o(this,$e).emit(this.onClearEvent),n}toArray(){return Array.from(this.values())}}$e=new WeakMap,Bn=new WeakMap;class iv extends nv{constructor(){super({onAddEvent:"pluginAdded",onDeleteEvent:"pluginDeleted"})}add(e,t=!0){return super.add(e,t)}delete(e,t=!0,r=!1){return super.delete(e,t,r)}}var tO=Object.defineProperty,sO=Object.getOwnPropertyDescriptor,rO=(s,e,t,r)=>{for(var n=r>1?void 0:r?sO(e,t):e,i=s.length-1,a;i>=0;i--)(a=s[i])&&(n=(r?a(e,t,n):a(n))||n);return r&&n&&tO(e,t,n),n};let Eh=class{constructor(){m(this,"all");m(this,"active");this.all=new iv,this.active=new iv}};Eh=rO([ht("0600")],Eh);var nO=Object.defineProperty,iO=Object.getOwnPropertyDescriptor,Md=(s,e,t,r)=>{for(var n=r>1?void 0:r?iO(e,t):e,i=s.length-1,a;i>=0;i--)(a=s[i])&&(n=(r?a(e,t,n):a(n))||n);return r&&n&&nO(e,t,n),n};const av=(hy=class{constructor(s,e,t,r){m(this,"plugins");g(this,as,void 0);g(this,Yi,void 0);g(this,Io,void 0);v(this,as,e),v(this,Yi,t),v(this,Io,s),this.plugins=r,this.setupEvents()}static async init(s,e,t,r,n,i,a,c){const d=new Eh;return e.forEach(l=>{const h=new wi(s,l,t,i,a,n,c);d.all.add(h)}),new av(s,t,r,d)}async getRoomPlugins(){var e;const{plugins:s}=await o(this,as).getActivePlugins();(e=this.plugins.active)==null||e.toArray().forEach(t=>{this.disablePlugin({id:t.id})}),await Promise.all(s.map(t=>this.enablePlugin({id:t.pluginId,enabledBy:t.enabledBy})))}async enablePlugin({id:s,enabledBy:e}){const t=this.plugins.all.get(s);t&&(await t.activateForSelf(),t.enabledBy=e)}async disablePlugin({id:s}){const e=this.plugins.all.get(s);e&&e.deactivateForSelf()}sendIframeEvent(s,e,t,r){const n=this.plugins.all.get(e);n&&n.sendIframeEvent({type:s,uuid:t,payload:r})}broadcastIframeEvent(s,e){this.plugins.active.forEach(t=>{this.sendIframeEvent(s,t.id,"",e)})}setupEvents(){this.plugins.all.on("stateUpdate",({active:s,id:e})=>{if(s){this.plugins.active.add(this.plugins.all.get(e));return}this.plugins.active.delete(e)}),R.onAsync(k.SOCKET_SERVICE_ROOM_JOINED,async()=>{await this.getRoomPlugins(),u.debug("[SOCKET_SERVICE_ROOM_JOINED] resolved request to fetch plugins.")}),o(this,as).on(J.addPlugin,async s=>{var t;const e=s.pluginId;(t=this.plugins.all.get(e))!=null&&t.active||await this.enablePlugin({id:e,enabledBy:s.enabledBy})}),o(this,as).on(J.removePlugin,async s=>{var t;const e=s.pluginId;(t=this.plugins.all.get(e))!=null&&t.active&&await this.disablePlugin({id:e})}),[J.enablePluginForPeers,J.enablePluginForRoom].forEach(s=>{o(this,as).on(s,async(e,t)=>{this.sendIframeEvent(s,e.pluginId,t,{enabledBy:e.enabledBy})})}),[J.disablePluginForPeers,J.disablePluginForRoom].forEach(s=>{o(this,as).on(s,async(e,t)=>{this.sendIframeEvent(s,e.pluginId,t,{disabledBy:e.disabledBy})})}),[J.customPluginEventToPeers,J.customPluginEventToRoom].forEach(s=>{o(this,as).on(s,async(e,t)=>{this.sendIframeEvent(s,e.pluginId,t,{data:JSON.parse(new TextDecoder().decode(e.pluginData))})})}),[J.storeInsertKeys,J.storeGetKeys,J.storeDeleteKeys].forEach(s=>{o(this,as).on(s,async(e,t)=>{var n;const r=(n=e.storeItems)==null?void 0:n.map(i=>{var a;return{timestamp:i.timestamp,peerId:i.peerId,payload:JSON.parse((a=i.payload)!=null&&a.length?new TextDecoder().decode(i.payload):"{}"),key:i.storeKey}});this.sendIframeEvent(s,e.pluginId,t,{storeName:e.storeName,storeItems:r})})}),o(this,as).on(J.storeDelete,async(s,e)=>{this.sendIframeEvent(J.storeDelete,s.pluginId,e,{storeName:s.storeName})}),o(this,Yi).on(Ae.sendMessageToPeers,s=>{const e=Es==null?void 0:Es.formatSocketServiceMessage(s.message);this.broadcastIframeEvent(Ne.chatMessage,{message:e})}),o(this,Yi).on(Ae.sendMessageToRoom,s=>{const e=Es==null?void 0:Es.formatSocketServiceMessage(s.message);this.broadcastIframeEvent(Ne.chatMessage,{message:e})}),R.on(k.PEER_JOINED_INTERNAL,s=>{const e=kd(s);this.broadcastIframeEvent(Ne.peerJoined,e)}),R.on(k.PEER_CLOSED,s=>{this.broadcastIframeEvent(Ne.peerLeft,s)}),R.on(k.UPDATE_PEER_STAGE_STATUS,s=>{this.broadcastIframeEvent(Ne.peerStageStatusUpdate,s)}),o(this,Io).subscribe("stageStatus",s=>{this.broadcastIframeEvent(Ne.stageStatusUpdate,s)})}},as=new WeakMap,Yi=new WeakMap,Io=new WeakMap,hy);let ro=av;Md([T.trace("PluginController.getRoomPlugins")],ro.prototype,"getRoomPlugins",1),Md([T.trace("PluginController.enableForSelf")],ro.prototype,"enablePlugin",1),Md([T.trace("PluginController.disableForSelf")],ro.prototype,"disablePlugin",1),Md([T.trace("PluginController.setupEvents")],ro.prototype,"setupEvents",1);class aO{constructor(){m(this,"mediaJoined");m(this,"socketJoined");m(this,"socketJoinAttempted");m(this,"mediaJoinAttempted");m(this,"socketState");m(this,"mediaState");this.mediaJoined=!1,this.socketJoined=!1,this.socketJoinAttempted=!1,this.mediaJoinAttempted=!1,this.socketState={state:void 0,reconnected:!1,reconnectionAttempt:void 0},this.mediaState={recv:void 0,send:void 0}}get joinAttempted(){return this.mediaJoinAttempted||this.socketJoinAttempted}get roomJoined(){return this.mediaJoined&&this.socketJoined}updateSocketConnectionState(e,t){let r;const{reconnected:n}=this.socketState;switch(e){case"connected":r={state:"connected",reconnected:n,reconnectionAttempt:void 0};break;case"disconnected":r={state:"disconnected",reconnected:!1,reconnectionAttempt:0},this.socketJoined=!1;break;case"reconnected":r={state:"connected",reconnected:!0,reconnectionAttempt:void 0};break;case"reconnecting":r={state:"reconnecting",reconnected:n,reconnectionAttempt:0};break;case"reconnectAttempt":r={state:"reconnecting",reconnected:n,reconnectionAttempt:t};break;case"failed":r={state:"failed",reconnected:n,reconnectionAttempt:void 0},this.socketJoined=!1;break}r&&(R.emit(k.SOCKET_STATE_UPDATE,r),this.socketState=r)}}var oO=Object.defineProperty,cO=Object.getOwnPropertyDescriptor,no=(s,e,t,r)=>{for(var n=r>1?void 0:r?cO(e,t):e,i=s.length-1,a;i>=0;i--)(a=s[i])&&(n=(r?a(e,t,n):a(n))||n);return r&&n&&oO(e,t,n),n};let bn=(py=class extends jt{constructor(e,t){super();g(this,Xi);g(this,Qi,void 0);g(this,Ao,void 0);m(this,"recordingPeerIds",[]);m(this,"recordings",[]);v(this,Ao,e),v(this,Qi,t)}get recordingState(){return this.recordings.some(e=>e.state==="RECORDING")?"RECORDING":this.recordings.some(e=>e.state==="PAUSED")?"PAUSED":this.recordings.some(e=>e.state==="STARTING")?"STARTING":this.recordings.some(e=>e.state==="STOPPING")?"STOPPING":"IDLE"}updateRecordings(e){this.recordings=e,this.emit("recordingUpdate",this.recordingState)}async start(e){if(!o(this,Qi).permissions.canRecord)throw u.error("DyteRecording::start::permission_denied"),new P("User does not have permission to start recording","1001");if((e==null?void 0:e.allowMultiple)!==!0&&(this.recordingState==="STARTING"||this.recordingState==="RECORDING"||this.recordingState==="STOPPING"))throw u.error("DyteRecording::start::recording_in_progress",{recording:{state:this.recordingState}}),new P(`Cant start recording, recordingState irregular: ${this.recordingState}`,"1005");try{const t=at(),{recording:r={}}=o(this,Ao).getValue("defaults"),n=await t.startRecording(r,e==null?void 0:e.allowMultiple);this.updateRecordings([...this.recordings,{id:n,state:"STARTING",type:"BROWSER"}])}catch(t){throw u.error("DyteRecording::stop::recording_failed_to_start",{error:t}),new P("Error while starting recording","1000")}}async stop(e){await $(this,Xi,Gl).call(this,"stop",["RECORDING","PAUSED"],e)}async pause(e){await $(this,Xi,Gl).call(this,"pause",["RECORDING"],e)}async resume(e){await $(this,Xi,Gl).call(this,"resume",["PAUSED"],e)}},Qi=new WeakMap,Ao=new WeakMap,Xi=new WeakSet,Gl=async function(e,t,r){if(!o(this,Qi).permissions.canRecord)throw u.error("DyteRecording::stop::permission_denied"),new P("User does not have permission to stop recording","1001");let n=[];if(r!==void 0){const i=this.recordings.find(a=>a.id===r);if(i===void 0)throw new P("Could not find the specified recording","1004");if(t.includes(i.state)){u.error("DyteRecording::stop::recording_not_in_expected_state",{recording:{state:i.state}});return}n.push(i)}else n=this.recordings.filter(i=>t.includes(i.state));n.forEach(async i=>{const a=i.state;e==="stop"&&(i.state="STOPPING",this.emit("recordingUpdate","STOPPING"));try{await at().updateRecording(i.id,e)}catch(c){throw u.error("DyteRecording::stop::recording_failed_to_stop",{error:c}),i.state!==a&&(i.state=a,this.emit("recordingUpdate",a)),new P("Error while stopping recording","1000")}})},py);no([T.trace("DyteRecording.start")],bn.prototype,"start",1),no([T.trace("DyteRecording.stop")],bn.prototype,"stop",1),no([T.trace("DyteRecording.stop")],bn.prototype,"pause",1),no([T.trace("DyteRecording.stop")],bn.prototype,"resume",1),bn=no([ht("1000")],bn);var dO=Object.defineProperty,lO=Object.getOwnPropertyDescriptor,uO=(s,e,t,r)=>{for(var n=r>1?void 0:r?lO(e,t):e,i=s.length-1,a;i>=0;i--)(a=s[i])&&(n=(r?a(e,t,n):a(n))||n);return r&&n&&dO(e,t,n),n};class ov{constructor(e,t,r){m(this,"recording");m(this,"room");g(this,ul,void 0);v(this,ul,e),this.recording=new bn(e,t),this.room=r,this.setupEvents()}getRecordingTypeFromProtoType(e){let t;switch(e){case vn.BROWSER:t="BROWSER";break;case vn.COMPOSITE:t="COMPOSITE";break;case vn.TRACK:t="TRACK";break;default:t="BROWSER"}return t}setupEvents(){R.on(k.ROOM_STATE,e=>{e.activeRecordings.length!==0?this.recording.updateRecordings(e.activeRecordings.map(t=>{const r=this.getRecordingTypeFromProtoType(t.recordingType);return{id:t.recordingId,state:t.recordingStatus,type:r}})):this.recording.recordings.length&&this.recording.updateRecordings([])}),this.room.on(U.recordingStarted,e=>{let t=!1;const r=[...this.recording.recordings];if(r.forEach(n=>{n.id===e.recordingId&&(t=!0,n.state="RECORDING")}),t===!1){const n=this.getRecordingTypeFromProtoType(e.recordingType);r.push({id:e.recordingId,state:"RECORDING",type:n})}this.recording.updateRecordings(r)}),this.room.on(U.recordingPaused,e=>{const t=[...this.recording.recordings];t.forEach(r=>{r.id===e.recordingId&&(r.state="PAUSED")}),this.recording.updateRecordings(t)}),this.room.on(U.recordingStopped,e=>{const t=[...this.recording.recordings.filter(r=>r.id!==e.recordingId)];this.recording.updateRecordings(t)})}}ul=new WeakMap,uO([T.trace("RecordingController.setupEvents")],ov.prototype,"setupEvents",1);class hO{static hasFeature(e){var t;return(t=ee.hasFeature(e))!=null?t:!1}static getFeatureValue(e){return ee.getValue(e)}static getAllFeatures(){return ee.getAllFlags()}}class _h{constructor(e,t,r){m(this,"logger");m(this,"features");m(this,"browserSpecs");m(this,"callStats");this.logger=e,this.features=t,this.browserSpecs=_e,this.callStats=r}static init(e){return new _h(u,hO,e)}}class bh{constructor(e){m(this,"internals");this.internals=e}static async init(){const e=_h.init(G);return new bh(e)}}var pO=Object.defineProperty,mO=Object.getOwnPropertyDescriptor,Wt=(s,e,t,r)=>{for(var n=r>1?void 0:r?mO(e,t):e,i=s.length-1,a;i>=0;i--)(a=s[i])&&(n=(r?a(e,t,n):a(n))||n);return r&&n&&pO(e,t,n),n};class Vt extends Ti{constructor(t,r,n=wh,i=!0){super();g(this,Qe,void 0);g(this,He,void 0);g(this,Pe,void 0);g(this,Us,void 0);g(this,os,void 0);g(this,Mo,void 0);g(this,hl,void 0);m(this,"audioUpdateInProgress");m(this,"videoUpdateInProgress");v(this,hl,t),this.audioUpdateInProgress=!1,this.videoUpdateInProgress=!1,v(this,Qe,new pv(t,r)),v(this,He,new qO(o(this,Qe),void 0,n)),v(this,Pe,new YO(o(this,Qe),void 0,n)),v(this,os,new JO(o(this,Qe))),v(this,Us,new GO(o(this,Qe))),v(this,Mo,i),o(this,He).on("trackMuted",this.onAudioTrackMuted.bind(this)),o(this,He).on("trackChanged",this.onAudioTrackChanged.bind(this)),o(this,Pe).on("trackChanged",this.onVideoTrackChanged.bind(this)),o(this,Pe).on("trackEnded",this.onVideoTrackEnded.bind(this)),o(this,os).on("trackEnded",this.onScreenShareEnded.bind(this)),this.onVisibilityChange=this.onVisibilityChange.bind(this),document.addEventListener("visibilitychange",this.onVisibilityChange)}async onVisibilityChange(){G.tabChanged(document.visibilityState==="visible"),document.visibilityState!=="visible"?G.browserBackgrounded():(G.browserForegrounded(),await this.setupSpeaker())}async repopulateAvailableDevices(){return!0}async setupStreams({audio:t,video:r}){var a;t?G.audioOn():G.audioOff(),r?G.videoOn():G.videoOff();let n,i;if(t&&r)try{const c=await o(this,Qe).getAudioAndVideoTrack(o(this,He).userSelectedDevice,o(this,Pe).userSelectedDevice);n=c.audioTrack,i=c.videoTrack}catch(c){u.error("LocalMediaHandler::init::Failed to get audio video tracks",{error:c})}if(!n&&t)try{n=await o(this,Qe).getAudioTrack(!1,o(this,He).userSelectedDevice)}catch(c){u.error("LocalMediaHandler::init::Failed to get audio track",{error:c})}if(!i&&r)try{i=await o(this,Qe).getVideoTrack(o(this,Pe).userSelectedDevice)}catch(c){u.error("LocalMediaHandler::init::Failed to get video track",{error:c})}t&&!n&&G.audioOff(),r&&!i&&G.videoOff(),await o(this,He).setMediaTrack(n),await o(this,Pe).setMediaTrack(i);try{await o(this,Us).setupSpeaker()}catch(c){}if(i){const c=await this.getDeviceById(i.getSettings().deviceId);G.selectedDevice("VIDEO",c)}if(n){const c=await this.getDeviceById(n.getSettings().deviceId);G.selectedDevice("AUDIO",c)}(a=o(this,Us).currentDevice)!=null&&a.deviceId&&G.selectedDevice("SPEAKER",o(this,Us).currentDevice),o(this,Qe).onDeviceChange((c,d,l)=>{this.onDeviceChange(d,l)})}getCurrentDevices(){return{audio:o(this,He).currentDevice,video:o(this,Pe).currentDevice,speaker:o(this,Us).currentDevice}}get permissions(){return o(this,Qe).permissions}getAllDevices(){return o(this,Qe).getAvailableDevices()}getDeviceById(t,r){return o(this,Qe).getDevice(t)}onAudioTrackMuted(){this.emit("AUDIO_TRACK_SILENT")}onAudioTrackChanged(){this.emit("AUDIO_TRACK_CHANGE")}get rawAudioTrack(){return o(this,He).mediaTrack}get audioTrack(){return o(this,He).transformedMediaTrack}get audioEnabled(){return o(this,He).trackEnabled}async enableAudio(){if(!this.audioUpdateInProgress){this.audioUpdateInProgress=!0;try{await o(this,He).unmuteTrack()}catch(t){}finally{this.audioUpdateInProgress=!1}}}disableAudio(){o(this,He).muteTrack()}getAudioDevices(t){return o(this,Qe).getAudioInputDevices(t)}async setAudioDevice(t){await o(this,He).setDevice(t),t!=null&&t.deviceId&&G.selectedDevice("AUDIO",t),this.emit("AUDIO_TRACK_CHANGE"),this.emit("DEVICE_CHANGE",{device:t})}setupSpeaker(){return o(this,Us).setupSpeaker()}async setSpeakerDevice(t){await o(this,Us).setupSpeaker(t),t!=null&&t.deviceId&&G.selectedDevice("SPEAKER",t),this.emit("DEVICE_CHANGE",{device:t})}onVideoTrackChanged(){this.emit("VIDEO_TRACK_CHANGE")}onVideoTrackEnded(){this.emit("VIDEO_TRACK_CHANGE")}get rawVideoTrack(){return o(this,Pe).mediaTrack}get videoTrack(){return o(this,Pe).transformedMediaTrack}get videoEnabled(){return o(this,Pe).trackEnabled}async enableVideo(){if(!this.videoUpdateInProgress){this.videoUpdateInProgress=!0;try{await o(this,Pe).unmuteTrack()}catch(t){}finally{this.videoUpdateInProgress=!1}}}disableVideo(){o(this,Pe).disableTrack()}getVideoDevices(t){return o(this,Qe).getVideoInputDevices(t)}async setVideoDevice(t){await o(this,Pe).setDevice(t),t!=null&&t.deviceId&&G.selectedDevice("VIDEO",t),this.emit("VIDEO_TRACK_CHANGE"),this.emit("DEVICE_CHANGE",{device:t})}async updateVideoConstraints(t){await o(this,Pe).updateConstraints(t)}onScreenShareEnded(){this.emit("SCREENSHARE_ENDED")}get screenShareTracks(){return{audio:o(this,os).audioMediaTrack,video:o(this,os).videoMediaTrack}}get screenShareEnabled(){return o(this,os).trackEnabled}async enableScreenShare(){await o(this,os).enableScreenShare()}async disableScreenShare(){o(this,os).disableScreenShare()}async updateScreenshareConstraints(t){await o(this,os).updateConstraints(t)}getSpeakerDevices(t){return o(this,Qe).getAudioOutputDevices(t)}addAudioMiddleware(t){return o(this,He).addMiddleware(t)}removeAudioMiddleware(t){return o(this,He).removeMiddleware(t)}removeAllAudioMiddlewares(){return o(this,He).removeAllMiddlewares()}addVideoMiddleware(t){return o(this,Pe).addMiddleware(t)}removeVideoMiddleware(t){return o(this,Pe).removeMiddleware(t)}removeAllVideoMiddlewares(){return o(this,Pe).removeAllMiddlewares()}setVideoMiddlewareGlobalConfig(t){return o(this,Pe).setVideoMiddlewareGlobalConfig(t)}destruct(){o(this,He).disableTrack(),o(this,Pe).disableTrack(),o(this,Pe).terminateMiddlewareWebWorker(),o(this,os).disableScreenShare(),o(this,Qe).destruct()}async onDeviceChange(t,r){var n,i;this.emit("DEVICE_LIST_UPDATED",t),!(r||!o(this,Mo))&&((n=t==null?void 0:t.added)==null||n.forEach(async a=>{var c;a&&!wh(a)&&(a.kind==="audioinput"&&((c=this.audioTrack)==null?void 0:c.enabled)===!0?await this.setAudioDevice(a):a.kind==="audiooutput"&&await this.setSpeakerDevice(a))}),(i=t==null?void 0:t.removed)==null||i.forEach(async a=>{var c;if(a.kind==="audiooutput"&&((c=this.getCurrentDevices().speaker)==null?void 0:c.deviceId)===a.deviceId){const d=(await this.getSpeakerDevices()).find(l=>l.deviceId!==a.deviceId);d&&await this.setSpeakerDevice(d)}}))}removeAllTracks(){this.destruct()}removeAudioTrack(){o(this,He).disableTrack()}removeVideoTrack(){o(this,Pe).disableTrack(),o(this,Pe).terminateMiddlewareWebWorker()}async removeDocumentEventListeners(){document.removeEventListener("visibilitychange",this.onVisibilityChange)}}Qe=new WeakMap,He=new WeakMap,Pe=new WeakMap,Us=new WeakMap,os=new WeakMap,Mo=new WeakMap,hl=new WeakMap,Wt([T.trace("MediaHandler.setupStreams")],Vt.prototype,"setupStreams",1),Wt([T.trace("MediaHandler.enableAudio")],Vt.prototype,"enableAudio",1),Wt([T.trace("MediaHandler.disableAudio")],Vt.prototype,"disableAudio",1),Wt([T.trace("MediaHandler.setAudioDevice")],Vt.prototype,"setAudioDevice",1),Wt([T.trace("MediaHandler.enableVideo")],Vt.prototype,"enableVideo",1),Wt([T.trace("MediaHandler.disableVideo")],Vt.prototype,"disableVideo",1),Wt([T.trace("MediaHandler.setVideoDevice")],Vt.prototype,"setVideoDevice",1),Wt([T.trace("MediaHandler.updateVideoConstraints")],Vt.prototype,"updateVideoConstraints",1),Wt([T.trace("MediaHandler.enableScreenShare")],Vt.prototype,"enableScreenShare",1),Wt([T.trace("MediaHandler.disableScreenShare")],Vt.prototype,"disableScreenShare",1),Wt([T.trace("MediaHandler.updateScreenshareConstraints")],Vt.prototype,"updateScreenshareConstraints",1),Wt([T.trace("MediaHandler.destruct")],Vt.prototype,"destruct",1),Wt([T.trace("MediaHandler.onDeviceChange")],Vt.prototype,"onDeviceChange",1);function Dd(s,e,t){switch(!0){case _e.isChromiumBased():switch(e){case"NotAllowedError":return t.includes("by system")?"SYSTEM_DENIED":s==="screenshare"?"CANCELED":"DENIED";case"NotReadableError":default:return"COULD_NOT_START"}case _e.isSafari():switch(e){case"NotAllowedError":return"DENIED";default:return"COULD_NOT_START"}case _e.isFirefox():switch(e){case"NotFoundError":case"NotReadableError":return"SYSTEM_DENIED";case"NotAllowedError":return"DENIED";case"AbortError":default:return"COULD_NOT_START"}default:return"COULD_NOT_START"}}const fO=["virtual","emulator","krisp","solstice conference","teams","loom","zoom","manycam","blackhole","displayport","xsplit","wirecast","vMix","elgato","epiphan","voice changer","voicemod","morphvoxx"];function wh(s){var t,r;const e=(t=s.label)==null?void 0:t.toLowerCase();return((r=_e._bowser)==null?void 0:r.getOSName())==="macOS"&&e.includes("iphone")?(u.log("isVirtualDevice::ignore_macos_continuity"),!0):fO.some(n=>e==null?void 0:e.includes(n))}async function gO(s,e){if(!(s!=null&&s.length))return e;const t=new AudioContext,r=await Promise.all(s==null?void 0:s.map(a=>a(t))),n=t.createMediaStreamSource(new MediaStream([e])),i=t.createMediaStreamDestination();try{let a=n;for(let c=0;c<r.length;c+=1)a.connect(r[c]),a=r[c];a.connect(i)}catch(a){return u.error("getTransformedAudioTrack::middleware_execution_failed",{error:a}),e}return i.stream.getAudioTracks()[0]}const vO=s=>(e,t)=>(s.set(e,t),t),cv=Number.MAX_SAFE_INTEGER===void 0?9007199254740991:Number.MAX_SAFE_INTEGER,dv=536870912,lv=dv*2,yO=(s,e)=>t=>{const r=e.get(t);let n=r===void 0?t.size:r<lv?r+1:0;if(!t.has(n))return s(t,n);if(t.size<dv){for(;t.has(n);)n=Math.floor(Math.random()*lv);return s(t,n)}if(t.size>cv)throw new Error("Congratulations, you created a collection of unique numbers which uses all available integers!");for(;t.has(n);)n=Math.floor(Math.random()*cv);return s(t,n)},uv=new WeakMap,TO=vO(uv),Od=yO(TO,uv),SO=s=>s.method!==void 0&&s.method==="call",EO=s=>s.error===null&&typeof s.id=="number",Nd=((s,e)=>{let t=null;return()=>{if(t!==null)return t;const r=new Blob([e],{type:"application/javascript; charset=utf-8"}),n=URL.createObjectURL(r);return t=s(n),setTimeout(()=>URL.revokeObjectURL(n)),t}})(s=>{const e=new Map([[0,()=>{}]]),t=new Map([[0,()=>{}]]),r=new Map,n=new Worker(s);return n.addEventListener("message",({data:l})=>{if(SO(l)){const{params:{timerId:h,timerType:p}}=l;if(p==="interval"){const f=e.get(h);if(typeof f=="number"){const y=r.get(f);if(y===void 0||y.timerId!==h||y.timerType!==p)throw new Error("The timer is in an undefined state.")}else if(typeof f!="undefined")f();else throw new Error("The timer is in an undefined state.")}else if(p==="timeout"){const f=t.get(h);if(typeof f=="number"){const y=r.get(f);if(y===void 0||y.timerId!==h||y.timerType!==p)throw new Error("The timer is in an undefined state.")}else if(typeof f!="undefined")f(),t.delete(h);else throw new Error("The timer is in an undefined state.")}}else if(EO(l)){const{id:h}=l,p=r.get(h);if(p===void 0)throw new Error("The timer is in an undefined state.");const{timerId:f,timerType:y}=p;r.delete(h),y==="interval"?e.delete(f):t.delete(f)}else{const{error:{message:h}}=l;throw new Error(h)}}),{clearInterval:l=>{const h=Od(r);r.set(h,{timerId:l,timerType:"interval"}),e.set(l,h),n.postMessage({id:h,method:"clear",params:{timerId:l,timerType:"interval"}})},clearTimeout:l=>{const h=Od(r);r.set(h,{timerId:l,timerType:"timeout"}),t.set(l,h),n.postMessage({id:h,method:"clear",params:{timerId:l,timerType:"timeout"}})},setInterval:(l,h=0)=>{const p=Od(e);return e.set(p,()=>{l(),typeof e.get(p)=="function"&&n.postMessage({id:null,method:"set",params:{delay:h,now:performance.now(),timerId:p,timerType:"interval"}})}),n.postMessage({id:null,method:"set",params:{delay:h,now:performance.now(),timerId:p,timerType:"interval"}}),p},setTimeout:(l,h=0)=>{const p=Od(t);return t.set(p,l),n.postMessage({id:null,method:"set",params:{delay:h,now:performance.now(),timerId:p,timerType:"timeout"}}),p}}},`(()=>{"use strict";const e=new Map,t=new Map,r=(e,t)=>{let r,o;const i=performance.now();r=i,o=e-Math.max(0,i-t);return{expected:r+o,remainingDelay:o}},o=(e,t,r,i)=>{const s=performance.now();s>r?postMessage({id:null,method:"call",params:{timerId:t,timerType:i}}):e.set(t,setTimeout(o,r-s,e,t,r,i))};addEventListener("message",(i=>{let{data:s}=i;try{if("clear"===s.method){const{id:r,params:{timerId:o,timerType:i}}=s;if("interval"===i)(t=>{const r=e.get(t);if(void 0===r)throw new Error('There is no interval scheduled with the given id "'.concat(t,'".'));clearTimeout(r),e.delete(t)})(o),postMessage({error:null,id:r});else{if("timeout"!==i)throw new Error('The given type "'.concat(i,'" is not supported'));(e=>{const r=t.get(e);if(void 0===r)throw new Error('There is no timeout scheduled with the given id "'.concat(e,'".'));clearTimeout(r),t.delete(e)})(o),postMessage({error:null,id:r})}}else{if("set"!==s.method)throw new Error('The given method "'.concat(s.method,'" is not supported'));{const{params:{delay:i,now:n,timerId:a,timerType:d}}=s;if("interval"===d)((t,i,s)=>{const{expected:n,remainingDelay:a}=r(t,s);e.set(i,setTimeout(o,a,e,i,n,"interval"))})(i,a,n);else{if("timeout"!==d)throw new Error('The given type "'.concat(d,'" is not supported'));((e,i,s)=>{const{expected:n,remainingDelay:a}=r(e,s);t.set(i,setTimeout(o,a,t,i,n,"timeout"))})(i,a,n)}}}}catch(e){postMessage({error:{message:e.message},id:s.id,result:null})}}))})();`),Pi=s=>Nd().clearInterval(s),_O=s=>Nd().clearTimeout(s),Ld=(s,e)=>Nd().setInterval(s,e),bO=Object.freeze(Object.defineProperty({__proto__:null,clearInterval:Pi,clearTimeout:_O,setInterval:Ld,setTimeout:(s,e)=>Nd().setTimeout(s,e)},Symbol.toStringTag,{value:"Module"}));class wO{constructor(){g(this,$n,void 0)}terminateMiddlewareWebWorker(){if(o(this,$n))try{Pi(o(this,$n)),v(this,$n,void 0)}catch(e){u.debug("WorkerTimers::terminateMiddlewareWebWorker::failed")}}async getTransformedVideoTrack(e,t,r){if(!(e!=null&&e.length))return t;const n=document.createElement("canvas"),i=await Promise.all(e==null?void 0:e.map(f=>f({canvas:n,WorkerTimers:bO})));if(r.disablePerFrameCanvasRendering){const y=n.captureStream().getVideoTracks()[0];return Object.defineProperty(y,"originalSettings",{value:t.getSettings()}),y}const a=document.createElement("video"),c=new MediaStream;c.addTrack(t);const d=n.getContext("2d");a.srcObject=c,a.autoplay=!0,this.terminateMiddlewareWebWorker();const l=async()=>{if(t.enabled===!1||t.readyState==="ended"){this.terminateMiddlewareWebWorker(),a.remove(),n.remove();return}try{d.drawImage(a,0,0);for(let f=0;f<i.length;f+=1)typeof i[f]=="function"&&await i[f](n,d)}catch(f){u.error("getTransformedVideoTrack::middleware_execution_failed",{error:f})}};try{a.play()}catch(f){}a.addEventListener("play",()=>{n.width=a.width||t.getSettings().width,n.height=a.width||t.getSettings().height,v(this,$n,Ld(l,50))},!1);const p=n.captureStream().getVideoTracks()[0];return Object.defineProperty(p,"originalSettings",{value:t.getSettings()}),p}}$n=new WeakMap;const hv={gross:{width:{ideal:192},height:{ideal:144}},qvga:{width:{ideal:384},height:{ideal:288}},pvga:{width:{ideal:480},height:{ideal:360}},vga:{width:{ideal:640},height:{ideal:480}},hd:{width:{ideal:1280},height:{ideal:720}},hd_cropped:{width:{ideal:900},height:{ideal:720}},fhd:{width:{ideal:1920},height:{ideal:1080}}},PO=[[320,[{rid:"q",maxBitrate:25e4,maxFramerate:24,scalabilityMode:"L1T1"}]],[640,[{rid:"q",scaleResolutionDownBy:2,maxBitrate:25e4,maxFramerate:24,scalabilityMode:"L1T1"},{rid:"h",maxBitrate:7e5,maxFramerate:30,scalabilityMode:"L1T1"}]],[1280,[{rid:"q",scaleResolutionDownBy:2,maxBitrate:5e5,maxFramerate:24,scalabilityMode:"L1T1"},{rid:"h",maxBitrate:13e5,maxFramerate:30,scalabilityMode:"L1T1"}]],[1920,[{rid:"q",scaleResolutionDownBy:2,maxBitrate:9e5,maxFramerate:24,scalabilityMode:"L1T1"},{rid:"h",maxBitrate:15e5,maxFramerate:30,scalabilityMode:"L1T1"}]]],CO=s=>{var a;const e="getSettings"in s&&s.getSettings().width||"getConstraints"in s&&s.getConstraints().width||"originalSettings"in s&&((a=s.originalSettings)==null?void 0:a.width);let t=PO;ee.hasFeature(se.OVERRIDE_HIVE_SIMULCAST_DYNAMIC)&&(t=JSON.parse(ee.getValue(se.OVERRIDE_HIVE_SIMULCAST_DYNAMIC)));const r=t.map(([c])=>c).sort((c,d)=>c-d);let n=Number.MAX_VALUE,i=0;return r.forEach((c,d)=>{Math.abs(c-e)<n&&(n=Math.abs(c-e),i=d)}),t[i][1]};var Le=(s=>(s.WEBCAM="webcam",s.WEBCAM_BACKUP="webcam_backup",s.MIC="mic",s.SCREENSHARE_VIDEO="screenshare_video",s.SCREENSHARE_AUDIO="screenshare_audio",s))(Le||{});const RO=kw(),Ci=Ss(RO.config.media);function kO(s){var t,r;const e={};return s.audio&&(e.audio={enableStereo:(t=s.audio.enableStereo)!=null?t:!1,enableHighBitrate:(r=s.audio.enableHighBitrate)!=null?r:!1}),e.video=s.video.quality,e}class IO{constructor(e,t){g(this,Hn,void 0);g(this,pl,void 0);m(this,"getScreenShareConstraints",()=>{var l,h,p,f,y,_,b,I,x,B,H;const e=(l=o(this,Hn))==null?void 0:l.screenshare,t=(p=(h=e==null?void 0:e.width)==null?void 0:h.max)!=null?p:1920,r=(y=(f=e==null?void 0:e.height)==null?void 0:f.max)!=null?y:1080,n=(b=(_=e==null?void 0:e.frameRate)==null?void 0:_.max)!=null?b:5;let i=(x=(I=e==null?void 0:e.frameRate)==null?void 0:I.ideal)!=null?x:5;const a=e==null?void 0:e.displaySurface,c=e==null?void 0:e.selfBrowserSurface;ee.getValue(se.VAL_MIN_FRAMERATE)&&(i=parseInt((B=ee.getValue(se.VAL_MIN_FRAMERATE))==null?void 0:B.toString(),10));let d={width:{max:t},height:{max:r},frameRate:{ideal:i,max:n}};if(ee.hasFeature(se.SCREENSHARE_CONSTRAINTS)){const M=(H=ee.getValue(se.SCREENSHARE_CONSTRAINTS))==null?void 0:H.toString();d=JSON.parse(M)}return a!==void 0&&["monitor","browser","window"].includes(a)&&(d={...d,displaySurface:a}),c!==void 0&&(d={...d,selfBrowserSurface:c}),{audio:!0,video:d}});m(this,"getAudioConstraints",e=>{var i,a,c,d,l,h,p,f;const t={},r=(i=o(this,Hn))==null?void 0:i.audio,n=r!=null&&r.enableStereo?2:1;return _e.isFirefox()||_e.isWebKitBased()?(t.audio={deviceId:e,autoGainControl:(a=r==null?void 0:r.autoGainControl)!=null?a:!0,echoCancellation:(c=r==null?void 0:r.echoCancellation)!=null?c:!0,noiseSuppression:(d=r==null?void 0:r.noiseSupression)!=null?d:!0,channelCount:n},t):(t.audio={},t.audio.optional=[e?{sourceId:e}:{sourceId:"default"},{channelCount:n},{echoCancellation:(l=r==null?void 0:r.echoCancellation)!=null?l:!0},{googEchoCancellation:(h=r==null?void 0:r.echoCancellation)!=null?h:!0},{googAutoGainControl:(p=r==null?void 0:r.autoGainControl)!=null?p:!0},{googNoiseSuppression:(f=r==null?void 0:r.noiseSupression)!=null?f:!0},{googHighpassFilter:!0}],t)});m(this,"getVideoConstraints",e=>{var i,a,c,d;const t={},r=(i=o(this,Hn))==null?void 0:i.video;let n=hv.vga;if(typeof r=="string"?n=hv[r]:r!==void 0&&(n.height.ideal=r.height.ideal,n.width.ideal=r.width.ideal),n.frameRate={ideal:(c=(a=n.frameRate)==null?void 0:a.ideal)!=null?c:24},_e.isChromiumBased()&&(n.frameRate.max=30),ee.hasFeature(se.VIDEO_CONSTRAINTS)){const l=(d=ee.getValue(se.VIDEO_CONSTRAINTS))==null?void 0:d.toString();n=JSON.parse(l)}return t.video=n,typeof t.video=="boolean"||(e?t.video.deviceId={exact:e}:t.video.facingMode="user"),t});v(this,pl,e),v(this,Hn,t)}getUpdatedVideoConstraints(e){return e}}Hn=new WeakMap,pl=new WeakMap;class Ph extends Error{constructor(t,r,n){super(r);m(this,"constraints");m(this,"name");this.name=t,this.constraints=n}}class AO{constructor(){m(this,"permissions");this.permissions={audio:"NOT_REQUESTED",video:"NOT_REQUESTED",screenshare:"NOT_REQUESTED"}}async getAudioInputDevices(e){let t=e;return e||(t=await this.getAvailableDevices()),t.filter(r=>r.kind==="audioinput")}async getVideoInputDevices(e){let t=e;return e||(t=await this.getAvailableDevices()),t.filter(r=>r.kind==="videoinput")}async getAudioOutputDevices(e){let t=e;return e||(t=await this.getAvailableDevices()),t.filter(r=>r.kind==="audiooutput")}}var MO=Object.defineProperty,DO=Object.getOwnPropertyDescriptor,_s=(s,e,t,r)=>{for(var n=r>1?void 0:r?DO(e,t):e,i=s.length-1,a;i>=0;i--)(a=s[i])&&(n=(r?a(e,t,n):a(n))||n);return r&&n&&MO(e,t,n),n};let Jt=(my=class extends AO{constructor(e,t){super();m(this,"availableDevices");g(this,Zi,void 0);g(this,cs,void 0);g(this,ml,void 0);v(this,ml,e),v(this,cs,new IO(e,t)),v(this,Zi,new AbortController),this.availableDevices=[],this.getAvailableDevices()}get constraintsBuilder(){return o(this,cs)}async destruct(){var e;(e=o(this,Zi))==null||e.abort()}handlePermissionErrors(e,t){const r=Dd(e,t.name,t.message);return this.permissions[e]=r,R.emit(k.MEDIA_PERMISSION_ERROR,{message:r,constraints:t.constraints,kind:e}),r}async getAudioAndVideoTrack(e,t){const r={audio:o(this,cs).getAudioConstraints(e).audio,video:o(this,cs).getVideoConstraints(t).video};try{u.info("getUserMediaWithoutTimeout::requesting_user_media",{constraints:JSON.stringify(r)});const n=await navigator.mediaDevices.getUserMedia(r);u.info("getUserMediaWithoutTimeout::received_user_media",{constraints:JSON.stringify(r)});const i=n.getAudioTracks()[0];let a=n.getVideoTracks()[0];if(this.permissions.audio="ACCEPTED",this.permissions.video="ACCEPTED",ee.hasFeature(se.OBS_QUALITY)&&a.label.includes("OBS Virtual")){const l=(await this.getVideoInputDevices()).find(h=>h.label.includes("OBS Virtual"));a=await this.getVideoTrack(l.deviceId)}return R.emit(k.MEDIA_PERMISSION_UPDATE,{message:this.permissions.audio,kind:"audio"}),R.emit(k.MEDIA_PERMISSION_UPDATE,{message:this.permissions.video,kind:"video"}),{audioTrack:i,videoTrack:a}}catch(n){throw u.error("WebMediaInterface.getAudioAndVideoTrack",{error:n}),new P("Couldnt fetch audio and video track","1605")}}async getAudioTrack(e,t){let r=await this.getAudioInputDevices();if(r.length===0)throw this.permissions.audio="NO_DEVICES_AVAILABLE",R.emit(k.MEDIA_PERMISSION_UPDATE,{message:this.permissions.audio,kind:"audio"}),new P("No audio devices available","1606");const n=async i=>{let a;try{r=r.filter(d=>d.deviceId!==i),a=o(this,cs).getAudioConstraints(i),u.info("getUserMediaWithoutTimeout::requesting_user_media",{constraints:JSON.stringify(a)});const[c]=(await navigator.mediaDevices.getUserMedia(a)).getAudioTracks();return u.info("getUserMediaWithoutTimeout::received_user_media",{constraints:JSON.stringify(a)}),c}catch(c){const d=Dd("audio",c.name,c.message),l=new Ph(c.name,c.message,a);if(d==="COULD_NOT_START"){const h=r.shift();if(!h)throw l;u.info("getAudioTrack::gum_failed",{constraints:JSON.stringify(a),error:c});const p=o(this,cs).getAudioConstraints(h.deviceId);return u.info("getAudioTrack::retrying_gum_for_next_device",{constraints:JSON.stringify(p)}),n(h.deviceId)}throw l}};try{const i=await n(t);return i.enabled=!e,this.permissions.audio!=="ACCEPTED"&&(this.permissions.audio="ACCEPTED",R.emit(k.MEDIA_PERMISSION_UPDATE,{message:this.permissions.audio,kind:"audio"})),i}catch(i){throw i.constraints&&this.handlePermissionErrors("audio",i),new P(i.message,"1601")}}async getVideoTrack(e){var c;const t=ee.hasFeature(se.OBS_QUALITY),r=(c=await this.getCurrentDeviceLabel(e))==null?void 0:c.includes("OBS Virtual"),n=t&&r,i=await this.getVideoInputDevices();if(i.length===0)throw this.permissions.video="NO_DEVICES_AVAILABLE",R.emit(k.MEDIA_PERMISSION_UPDATE,{message:this.permissions.video,kind:"video"}),new P("No video devices available","1607");const a=async d=>{try{let l=d;const{video:h}=l;n&&typeof h!="boolean"&&(l={video:{deviceId:h.deviceId}}),u.info("getUserMediaWithoutTimeout::requesting_user_media",{constraints:JSON.stringify(l)});const[p]=(await navigator.mediaDevices.getUserMedia(l)).getVideoTracks();if(n&&typeof h!="boolean"&&typeof h.width=="object"){const{width:f,height:y}=p.getSettings(),{ideal:_}=h.width;p.applyConstraints({width:{ideal:_},height:{ideal:Math.floor(y*_/f)},frameRate:h.frameRate})}return u.info("getUserMediaWithoutTimeout::received_user_media",{constraints:JSON.stringify(l)}),p}catch(l){const h=Dd("video",l.name,l.message),p=new Ph(l.name,l.message,d);if(h==="COULD_NOT_START"){const f=i.shift();if(!f)throw p;u.info("getVideoTrack::gum_failed",{constraints:JSON.stringify(d),error:l});const y=o(this,cs).getVideoConstraints(f.deviceId);return u.info("getVideoTrack::retrying_gum_for_next_device",{constraints:JSON.stringify(y)}),a({video:y.video})}throw p}};try{const d=o(this,cs).getVideoConstraints(e),l=await a(d);return this.permissions.video!=="ACCEPTED"&&(this.permissions.video="ACCEPTED",R.emit(k.MEDIA_PERMISSION_UPDATE,{message:this.permissions.video,kind:"video"})),l}catch(d){throw d.constraints&&this.handlePermissionErrors("video",d),new P(d.message,"1602")}}async getScreenShareTracks(){const e=async t=>{try{u.info("getDisplayMediaWithoutTimeout::requesting_display_media",{constraints:JSON.stringify(t)}),G.screenShareRequested();const r=await navigator.mediaDevices.getDisplayMedia(t);return u.info("getDisplayMediaWithoutTimeout::received_display_media",{constraints:JSON.stringify(t)}),r}catch(r){const n=Dd("video",r.name,r.message),i=new Ph(r.name,r.message,t),a={video:!0};if(KP(t,a)||!ee.hasFeature(se.SCREEENSHARE_CONSTRAINTS_RETRY))throw i;if(n==="COULD_NOT_START")return e(a);throw i}};try{const t=o(this,cs).getScreenShareConstraints(),r=await e(t);return this.permissions.screenshare!=="ACCEPTED"&&(this.permissions.screenshare="ACCEPTED",R.emit(k.MEDIA_PERMISSION_UPDATE,{message:this.permissions.screenshare,kind:"screenshare"})),{audioTrack:r.getAudioTracks()[0],videoTrack:r.getVideoTracks()[0]}}catch(t){throw t.constraints&&this.handlePermissionErrors("screenshare",t),new P(t.message,"1612")}}async getCurrentDeviceLabel(e){const t=await this.getDevice(e||"default");return t==null?void 0:t.label}async getAvailableDevices(){try{const e=await navigator.mediaDevices.enumerateDevices();return this.availableDevices=e,e}catch(e){throw u.error("enumerate_devices_failed",{error:e}),new P("Failed to get available devices","1609")}}async getAvailableDevicesByKind(e){try{return(await navigator.mediaDevices.enumerateDevices()).filter(({kind:t})=>e===t)}catch(t){throw u.error("enumerate_devices_failed",{error:t}),new P("Failed to get available devices by kind","1609")}}async getDevice(e){try{return(await navigator.mediaDevices.enumerateDevices()).filter(r=>r.deviceId===e)[0]}catch(t){throw u.error("enumerate_devices_failed",{error:t}),new P("Failed to get device","1609")}}async onDeviceChange(e){_e.supportsDeviceChangeEvent()&&navigator.mediaDevices.addEventListener("devicechange",async t=>{var l,h;const r=p=>`${p.kind}-${p.deviceId}-${p.groupId}`,n=this.availableDevices,i=new Set(n.map(p=>r(p))),a=await this.getAvailableDevices(),c=new Set(a.map(p=>r(p))),d={added:a.filter(p=>!i.has(r(p))),removed:n.filter(p=>!c.has(r(p))),devices:a};if((l=d.added)!=null&&l.length||(h=d.removed)!=null&&h.length){u.info("repopulated_full_device_list",{devices:JSON.stringify(a)});const p=[...d.added,...d.removed];p.some(f=>f.kind==="audioinput")&&G.devices("AUDIO",a==null?void 0:a.filter(f=>f.kind==="audioinput")),p.some(f=>f.kind==="videoinput")&&G.devices("VIDEO",a==null?void 0:a.filter(f=>f.kind==="videoinput")),p.some(f=>f.kind==="audiooutput")&&G.devices("SPEAKER",a==null?void 0:a.filter(f=>f.kind==="audiooutput")),e(t,d,!1)}},{signal:o(this,Zi).signal})}},Zi=new WeakMap,cs=new WeakMap,ml=new WeakMap,my);_s([T.trace("WebMediaInterface.destruct")],Jt.prototype,"destruct",1),_s([T.trace("WebMediaInterface.handlePermissionErrors")],Jt.prototype,"handlePermissionErrors",1),_s([T.trace("WebMediaInterface.getAudioAndVideoTrack")],Jt.prototype,"getAudioAndVideoTrack",1),_s([T.trace("WebMediaInterface.getAudioTrack")],Jt.prototype,"getAudioTrack",1),_s([T.trace("WebMediaInterface.getVideoTrack")],Jt.prototype,"getVideoTrack",1),_s([T.trace("WebMediaInterface.getScreenShareTracks")],Jt.prototype,"getScreenShareTracks",1),_s([T.trace("WebMediaInterface.getAvailableDevices")],Jt.prototype,"getAvailableDevices",1),_s([T.trace("WebMediaInterface.getAvailableDevicesByKind")],Jt.prototype,"getAvailableDevicesByKind",1),_s([T.trace("WebMediaInterface.getDevice")],Jt.prototype,"getDevice",1),_s([T.trace("WebMediaInterface.onDeviceChange")],Jt.prototype,"onDeviceChange",1),Jt=_s([ht("1600")],Jt);const pv=Jt,io={setItem:(s,e)=>{try{localStorage.setItem(s,e)}catch(t){u.error("LocalStorage::setItem::crashed",{error:t,localStorage:{key:s,value:e}})}},getItem:s=>{try{return localStorage.getItem(s)}catch(e){u.error("LocalStorage::getItem::crashed",{error:e,localStorage:{key:s}})}return null}},OO=(s=0)=>new Promise(e=>setTimeout(e,s)),NO=(s,e,t)=>{const r=typeof t=="number"?t:250,n=s.createMediaStreamSource(e),i=s.createAnalyser();i.fftSize=2048,n.connect(i);const a=new Uint8Array(i.fftSize);let c=!1;setTimeout(()=>{c=!0},r);function d(){return c?Promise.resolve(!0):(i.getByteTimeDomainData(a),a.some(l=>l!==128&&l!==0)?Promise.resolve(!1):OO().then(d))}return d().then(l=>(n.disconnect(),l),l=>{throw n.disconnect(),l})},LO=typeof AudioContext!="undefined"?AudioContext:null;class Ch{constructor(e){m(this,"_AudioContext");m(this,"audioContext");m(this,"_audioContextRefContainers");const t={AudioContext:LO,...e};Object.defineProperties(this,{_AudioContext:{value:t.AudioContext},audioContext:{value:null,writable:!0},_audioContextRefContainers:{value:new Set},AudioContextProvider:{enumerable:!0,value:Ch}})}getOrCreate(e){if(!this._audioContextRefContainers.has(e)&&(this._audioContextRefContainers.add(e),this._AudioContext&&!this.audioContext))try{this.audioContext=new this._AudioContext}catch(t){}return this.audioContext}release(e){this._audioContextRefContainers.has(e)&&(this._audioContextRefContainers.delete(e),!this._audioContextRefContainers.size&&this.audioContext&&(this.audioContext.close(),this.audioContext=null))}}const mv=new Ch,xO=3,VO=250;function UO(s){const e={},t=mv.getOrCreate(e);let r=xO;function n(){return r-=1,NO(t,s.srcObject,VO).then(i=>i?r>0?n():!0:!1).catch(()=>!0)}return n().finally(()=>{mv.release(e)})}async function fv(s){const e=new Audio,t=new MediaStream;t.addTrack(s),e.srcObject=t;let r=!1;try{const n=e.play();n&&await n,r=await UO(e),r&&u.info("checkIfAudioTrackIsSilent::silence_detected")}catch(n){u.error("checkIfAudioTrackIsSilent::failed_to_detect_silence",{error:n})}finally{e.pause(),e.remove()}return r}var FO=Object.defineProperty,BO=Object.getOwnPropertyDescriptor,gv=(s,e,t,r)=>{for(var n=r>1?void 0:r?BO(e,t):e,i=s.length-1,a;i>=0;i--)(a=s[i])&&(n=(r?a(e,t,n):a(n))||n);return r&&n&&FO(e,t,n),n};let xd=class extends Ti{constructor(e,t,r){var n;super();m(this,"constructorName",this.constructor.name);m(this,"userSelectedDevice");m(this,"mediaInterface");m(this,"isNonPreferredDevice");m(this,"_mediaTrack");m(this,"transformedMediaTrack");m(this,"middlewares",[]);m(this,"currentDevice");m(this,"userPreferredDeviceKey",`Dyte::${this.constructorName}::UserDeviceID`);m(this,"setUserPreferredDevice",e=>io.setItem(this.userPreferredDeviceKey,e));m(this,"getUserPreferredDevice",()=>io.getItem(this.userPreferredDeviceKey));this.mediaInterface=e,t&&this.setMediaTrack(t),this.userSelectedDevice=(n=this.getUserPreferredDevice())!=null?n:void 0,this.isNonPreferredDevice=r,this.onTrackEnded=this.onTrackEnded.bind(this),this.onTrackMuted=this.onTrackMuted.bind(this)}disableTrack(){var e,t;this.removeMediaTrackListeners(),(e=this._mediaTrack)==null||e.stop(),this._mediaTrack=void 0,(t=this.transformedMediaTrack)==null||t.stop(),this.transformedMediaTrack=void 0}get mediaTrack(){return this._mediaTrack}async setMediaTrack(e){const t=r=>{u.error(`${this.constructorName}.setMediaTrack.error`,{error:r})};try{this.disableTrack()}catch(r){t(r)}this._mediaTrack=await this.conditionallyChangeTrack(e),await this.setTransformedTrack();try{this.addMediaTrackListeners(),await this.setCurrentDevice()}catch(r){t(r)}}get trackEnabled(){return!!this.mediaTrack&&this.mediaTrack.readyState==="live"&&this.mediaTrack.enabled}muteTrack(){if(!this.mediaTrack){u.warn("BaseMediaHandler.muteTrack Tried muting with no track present");return}this.transformedMediaTrack&&(this.transformedMediaTrack.enabled=!1),this.mediaTrack.enabled=!1}async unmuteTrack(){try{this.mediaTrack?this.mediaTrack.enabled=!0:await this.enableTrack(!1)}catch(e){throw u.error(`${this.constructorName}.unmuteTrack.error`,{error:e}),this.disableTrack(),new P("Failed to unmute track","1611")}}getCurrentDeviceId(){var t,r;const{kind:e}=this.mediaTrack;switch(e){case"audio":{const n=this.mediaTrack.getConstraints();return this.userSelectedDevice?(r=(t=n==null?void 0:n.deviceId)!=null?t:n==null?void 0:n.advanced[0].deviceId)!=null?r:this.mediaTrack.getSettings().deviceId:this.mediaTrack.getSettings().deviceId}default:return this.mediaTrack.getSettings().deviceId}}async setCurrentDevice(){var t;if(!this.mediaTrack){this.currentDevice=void 0;return}const e=this.getCurrentDeviceId();((t=this.currentDevice)==null?void 0:t.deviceId)!==e&&(this.currentDevice=await this.mediaInterface.getDevice(e))}async setDevice(e){if(!e)throw u.warn(`${this.constructorName}.setDevice No device received`),new P("No device received!","1603");this.userSelectedDevice=e.deviceId,this.setUserPreferredDevice(e.deviceId),this.onSetDevice(e)}async addMiddleware(e){if(_e.isWebKitBased()&&!ee.hasFeature(se.ALLOW_SAFARI_MEDIA_MIDDLEWARES))return{success:!1,message:"Middlewares are not supported in this WebKit engine based browser."};if(this.middlewares.includes(e))return{success:!1,message:"This middleware has been applied, already. Skipping."};try{return this.middlewares.push(e),this.trackEnabled&&await this.setTransformedTrack(),{success:!0,message:"Successfully added the middleware."}}catch(t){return u.error("While adding middleware",{error:t}),this.removeMiddleware(e),{success:!1,message:t==null?void 0:t.message}}}async removeMiddleware(e){const t=this.middlewares.indexOf(e,0);if(t>-1)try{return this.middlewares.splice(t,1),await this.setTransformedTrack(!0),{success:!0,message:"Successfully removed the middleware."}}catch(r){return u.error("While removing middleware",{error:r}),{success:!1,message:r==null?void 0:r.message}}return{success:!1,message:"No such middleware was found. Skipping."}}async removeAllMiddlewares(){var e;if((e=this.middlewares)!=null&&e.length)try{return this.middlewares=[],await this.setTransformedTrack(!0),{success:!0,message:"Successfully removed all the middlewares."}}catch(t){return u.error("While removing all the middlewares",{error:t}),{success:!1,message:t==null?void 0:t.message}}return{success:!1,message:"No middlewares were found. Skipping."}}addMediaTrackListeners(){var e,t,r;this.mediaTrack&&(u.info(`${this.constructorName}.addMediaTrackListeners for deviceId ${(t=(e=this.mediaTrack)==null?void 0:e.getSettings())==null?void 0:t.deviceId} of type ${(r=this.mediaTrack)==null?void 0:r.kind}`),this.mediaTrack.addEventListener("ended",this.onTrackEnded),this.mediaTrack.addEventListener("mute",this.onTrackMuted))}removeMediaTrackListeners(){var e,t,r;this.mediaTrack&&(u.info(`${this.constructorName}.removeMediaTrackListeners for deviceId ${(t=(e=this.mediaTrack)==null?void 0:e.getSettings())==null?void 0:t.deviceId} of type ${(r=this.mediaTrack)==null?void 0:r.kind}`),u.info(`${this.constructorName}.removeMediaTrackListeners`),this.mediaTrack.removeEventListener("ended",this.onTrackEnded),this.mediaTrack.removeEventListener("mute",this.onTrackMuted))}};gv([T.trace("BaseMediaHandler.unmuteTrack")],xd.prototype,"unmuteTrack",1),xd=gv([ht("1600")],xd);const vv=xd;var $O=Object.defineProperty,HO=Object.getOwnPropertyDescriptor,Rh=(s,e,t,r)=>{for(var n=r>1?void 0:r?HO(e,t):e,i=s.length-1,a;i>=0;i--)(a=s[i])&&(n=(r?a(e,t,n):a(n))||n);return r&&n&&$O(e,t,n),n};const kh="[Dyte]nonSilentDeviceLabels";class Vd extends vv{async onSetDevice(e){if(!e)throw u.warn("AudioMediaHandler.setDevice No device received"),new P("No device received!","1603");if(e.kind!=="audioinput")throw u.warn("AudioMediaHandler.setDevice Received non audio device"),new P("Non audio device received while setting device!","1603");try{const t=this.trackEnabled;await this.setMediaTrack(await this.mediaInterface.getAudioTrack(!t,this.userSelectedDevice)),this.userSelectedDevice=void 0}catch(t){throw u.error("AudioMediaHandler.setDevice.error",{error:t}),this.disableTrack(),new P(t.message,"1604")}}async enableTrack(e){if(this.trackEnabled){u.warn("AudioMediaHandler.enableTrack Track already enabled!");return}const t=await this.mediaInterface.getAudioTrack(e,this.userSelectedDevice);await this.setMediaTrack(t)}async setTransformedTrack(e){var t;if(!e&&!((t=this.middlewares)!=null&&t.length)){this.transformedMediaTrack=this.mediaTrack;return}try{this.transformedMediaTrack=await gO(this.middlewares,this.mediaTrack),this.emit("trackChanged")}catch(r){u.error("AudioMediaHandler.setTransformedTrack",{error:r}),this.transformedMediaTrack=this.mediaTrack}}async onTrackEnded(){u.info("AudioMediaHandler.TrackEnded"),this.emit("trackEnded");const e=this.mediaTrack.enabled;this.disableTrack(),await this.enableTrack(!e),await this.setTransformedTrack(),this.emit("trackChanged")}onTrackMuted(){u.info("AudioMediaHandler.TrackMuted"),this.emit("trackMuted")}async conditionallyChangeTrack(e){var c;if(!e||this.userSelectedDevice)return e;let t=e;const r=await this.mediaInterface.getAudioInputDevices(),n=this.isNonPreferredDevice?r.filter(d=>d&&!this.isNonPreferredDevice(d)):r;if(!(n!=null&&n.length))return t;n.find(d=>d.deviceId===e.getSettings().deviceId)||(t.stop(),u.info("localmediahandler::setupstreams::found_audio_non_preferred"),t=await this.mediaInterface.getAudioTrack(!1,n[0].deviceId));const i=JSON.parse(io.getItem(kh));if(i!=null&&i.devices.some(d=>d.label===t.label))return t;if(!await fv(t)){const d=(c=i==null?void 0:i.devices.concat({label:t.label}))!=null?c:[{label:t.label}];return io.setItem(kh,JSON.stringify({devices:d})),t}u.info("AudioMediaHandler.conditionallyChangeTrack.DetectedSilentTrack");const a=t.getSettings().deviceId;return n.filter(d=>d.deviceId!==a).some(async d=>{if(t=await this.mediaInterface.getAudioTrack(!1,d.deviceId),!await fv(t)){const l=i.devices.concat({label:t.label});return io.setItem(kh,JSON.stringify({devices:l})),u.info("AudioMediaHandler.conditionallyChangeTrack.SuccesfullyChangedTrack"),!0}return u.info("AudioMediaHandler.conditionallyChangeTrack.AnotherSilentTrackFound"),!1}),t}}Rh([T.trace("AudioMediaHandler.setTransformedTrack")],Vd.prototype,"setTransformedTrack",1),Rh([T.trace("AudioMediaHandler.onTrackEnded")],Vd.prototype,"onTrackEnded",1),Rh([T.trace("AudioMediaHandler.conditionallyChangeTrack")],Vd.prototype,"conditionallyChangeTrack",1);const qO=Vd;class jO{constructor(e){g(this,ea,void 0);m(this,"currentDevice");v(this,ea,e)}async setupSpeaker(e){var n,i;if(!(o(this,ea)instanceof pv))return;let t=e;if(e||([t]=(await o(this,ea).getAvailableDevicesByKind("audiooutput")).filter(c=>!wh(c))),!t)throw new P("No speaker found","1608");if(((n=this.currentDevice)==null?void 0:n.deviceId)===t.deviceId)return;this.currentDevice=t;const r=document.querySelectorAll("audio");(i=r[0])!=null&&i.setSinkId&&r.forEach(async a=>{if(typeof a.sinkId!="undefined"&&this.currentDevice.deviceId&&a.sinkId!==this.currentDevice.deviceId)try{await a.setSinkId(this.currentDevice.deviceId)}catch(c){}})}}ea=new WeakMap;const GO=jO;class WO extends Ti{constructor(t){super();m(this,"mediaInterface");m(this,"audioMediaTrack");m(this,"videoMediaTrack");this.mediaInterface=t}get trackEnabled(){return!!this.videoMediaTrack}async enableScreenShare(){var t,r;try{const{audioTrack:n,videoTrack:i}=await this.mediaInterface.getScreenShareTracks();if(this.audioMediaTrack=n,this.videoMediaTrack=i,this.addMediaTrackListeners(),((r=(t=this.mediaInterface)==null?void 0:t.permissions)==null?void 0:r.screenshare)==="ACCEPTED")return;this.mediaInterface.permissions&&(this.mediaInterface.permissions.screenshare="ACCEPTED",R.emit(k.MEDIA_PERMISSION_UPDATE,{message:this.mediaInterface.permissions.screenshare,kind:"screenshare"}))}catch(n){}}disableScreenShare(){var t,r;this.removeMediaTrackListeners(),(t=this.audioMediaTrack)==null||t.stop(),(r=this.videoMediaTrack)==null||r.stop(),this.videoMediaTrack=void 0,this.audioMediaTrack=void 0}async updateConstraints(t){if(!this.videoMediaTrack)throw new P("No media track enabled!","1610");const r=this.mediaInterface;if(!r.constraintsBuilder)throw new P("update constraints not supported for non web clients","1100");try{this.videoMediaTrack.applyConstraints(r.constraintsBuilder.getUpdatedVideoConstraints(t)),this.addMediaTrackListeners()}catch(n){u.error("ScreenShareHandler.updateConstraints.error",{error:n})}}addMediaTrackListeners(){var t,r;(t=this.videoMediaTrack)==null||t.addEventListener("ended",this.onTrackEnded.bind(this)),_e.isWebKitBased()&&((r=this.videoMediaTrack)==null||r.addEventListener("mute",this.onTrackEnded.bind(this)))}removeMediaTrackListeners(){var t,r;(t=this.videoMediaTrack)==null||t.removeEventListener("ended",this.onTrackEnded),(r=this.videoMediaTrack)==null||r.removeEventListener("mute",this.onTrackEnded)}onTrackEnded(){this.emit("trackEnded")}}const JO=WO;var KO=Object.defineProperty,zO=Object.getOwnPropertyDescriptor,Ud=(s,e,t,r)=>{for(var n=r>1?void 0:r?zO(e,t):e,i=s.length-1,a;i>=0;i--)(a=s[i])&&(n=(r?a(e,t,n):a(n))||n);return r&&n&&KO(e,t,n),n};class ao extends vv{constructor(t,r,n){super(t,r,n);g(this,ta,void 0);g(this,Do,{disablePerFrameCanvasRendering:!1});v(this,ta,new wO)}async onSetDevice(t){if(!t)throw u.warn("VideoMediaHandler.setDevice No device received"),new P("No device received!","1603");if(t.kind!=="videoinput")throw u.warn("VideoMediaHandler.setDevice Received non video device",{devices:[t]}),new P("Non video device received while setting video device!","1603");if(!(this.mediaTrack&&this.mediaTrack.enabled)){u.warn("VideoMediaHandler.setDevice Tried switching device with video disabled",{devices:[t]}),this.currentDevice=t;return}try{await this.setMediaTrack(await this.mediaInterface.getVideoTrack(this.userSelectedDevice))}catch(r){throw u.error("VideoMediaHandler.setDevice.error",{error:r}),this.disableTrack(),new P("Failed to change device","1600")}}async enableTrack(){if(this.trackEnabled){u.warn("VideoMediaHandler.enableTrack Track already enabled!");return}await this.setMediaTrack(await this.mediaInterface.getVideoTrack(this.userSelectedDevice))}async setTransformedTrack(t){var r;if(!t&&!((r=this.middlewares)!=null&&r.length)){this.transformedMediaTrack=this.mediaTrack;return}try{this.transformedMediaTrack=await o(this,ta).getTransformedVideoTrack(this.middlewares,this.mediaTrack,o(this,Do)),this.emit("trackChanged")}catch(n){u.error("VideoMediaHandler.setTransformedTrack",{error:n}),this.transformedMediaTrack=this.mediaTrack}}async setVideoMiddlewareGlobalConfig(t){v(this,Do,t)}async updateConstraints(t){if(!this._mediaTrack)throw new P("No media track enabled!","1610");const r=this.mediaInterface;if(!r.constraintsBuilder)throw new P("update constraints not supported for non web clients","1100");try{this._mediaTrack.applyConstraints(r.constraintsBuilder.getUpdatedVideoConstraints(t)),await this.setTransformedTrack(),this.addMediaTrackListeners(),await this.setCurrentDevice()}catch(n){u.error("VideoMediaHandler.updateConstraints.error",{error:n})}}terminateMiddlewareWebWorker(){o(this,ta).terminateMiddlewareWebWorker()}async onTrackEnded(){u.info("VideoMediaHandler.TrackEnded"),this.disableTrack(),this.emit("trackEnded")}onTrackMuted(){u.info("VideoMediaHandler.TrackMuted"),this.emit("trackMuted")}async conditionallyChangeTrack(t){if(!t||this.userSelectedDevice)return t;let r=t;const n=await this.mediaInterface.getVideoInputDevices(),i=this.isNonPreferredDevice?n.filter(a=>!this.isNonPreferredDevice(a)):n;return!(i!=null&&i.length)||window.FAST_DYTE||i.find(a=>a.deviceId===t.getSettings().deviceId)||(r.stop(),u.info("localmediahandler::setupstreams::found_video_non_preferred"),r=await this.mediaInterface.getVideoTrack(i[0].deviceId)),r}}ta=new WeakMap,Do=new WeakMap,Ud([T.trace("VideoMediaHandler.setTransformedTrack")],ao.prototype,"setTransformedTrack",1),Ud([T.trace("VideoMediaHandler.setVideoMiddlewareGlobalConfig")],ao.prototype,"setVideoMiddlewareGlobalConfig",1),Ud([T.trace("VideoMediaHandler.onTrackEnded")],ao.prototype,"onTrackEnded",1),Ud([T.trace("VideoMediaHandler.conditionallyChangeTrack")],ao.prototype,"conditionallyChangeTrack",1);const YO=ao,yv=Ss(Vu()),ra=class{constructor(e){g(this,Ut,void 0);g(this,qn,void 0);g(this,Oo,void 0);g(this,sa,void 0);if(!e)throw new P("Could not load preset.","0904");v(this,Ut,e.config),v(this,Oo,e.name),v(this,qn,e.ui||Ss(Vu().ui)),v(this,sa,e.permissions.plugins.config)}static fromResponse(e){return new ra(e)}static default(){return new ra(yv)}static init(e,t=!0){return!e||t?new ra(yv):new ra(e)}get setupScreen(){return{isEnabled:!0}}get waitingRoom(){return{isEnabled:!0}}get controlBar(){return{isEnabled:!0,elements:{chat:!0,fullscreen:!0,invite:!1,layout:!1,participants:!0,plugins:!0,polls:!0,reactions:!1,screenshare:!0}}}get header(){return{isEnabled:!0,elements:{logo:o(this,qn).designTokens.logo,timer:!0,title:!0,participantCount:!0,changeLayout:!1}}}get pipMode(){return!0}get viewType(){return o(this,Ut).viewType}get livestreamViewerQualities(){return o(this,Ut).livestreamViewerQualities||[]}get maxVideoStreams(){return o(this,Ut).maxVideoStreams}get maxScreenShareCount(){return o(this,Ut).maxScreenshareCount}get plugins(){return[]}get disabledPlugins(){return Object.keys(o(this,sa)).filter(e=>o(this,sa)[e].disabled)}get designTokens(){return o(this,qn).designTokens}get configDiff(){return o(this,qn).configDiff}get mediaConstraints(){var e,t,r,n,i,a,c,d,l,h,p,f,y,_,b,I,x,B,H,M,z,ne,ue,ze;return{audio:{enableStereo:(n=(r=(t=(e=o(this,Ut))==null?void 0:e.media)==null?void 0:t.audio)==null?void 0:r.enableStereo)!=null?n:Ci.audio.enableStereo,enableHighBitrate:(d=(c=(a=(i=o(this,Ut))==null?void 0:i.media)==null?void 0:a.audio)==null?void 0:c.enableHighBitrate)!=null?d:Ci.audio.enableHighBitrate},video:{quality:(f=(p=(h=(l=o(this,Ut))==null?void 0:l.media)==null?void 0:h.video)==null?void 0:p.quality)!=null?f:Ci.video.quality,frameRate:(I=(b=(_=(y=o(this,Ut))==null?void 0:y.media)==null?void 0:_.video)==null?void 0:b.frameRate)!=null?I:Ci.video.frameRate},screenshare:{quality:(M=(H=(B=(x=o(this,Ut))==null?void 0:x.media)==null?void 0:B.screenshare)==null?void 0:H.quality)!=null?M:Ci.screenshare.quality,frameRate:(ze=(ue=(ne=(z=o(this,Ut))==null?void 0:z.media)==null?void 0:ne.screenshare)==null?void 0:ue.frameRate)!=null?ze:Ci.screenshare.frameRate}}}get name(){return o(this,Oo)}};let Ih=ra;Ut=new WeakMap,qn=new WeakMap,Oo=new WeakMap,sa=new WeakMap;var QO=Object.defineProperty,XO=Object.getOwnPropertyDescriptor,Tv=(s,e,t,r)=>{for(var n=r>1?void 0:r?XO(e,t):e,i=s.length-1,a;i>=0;i--)(a=s[i])&&(n=(r?a(e,t,n):a(n))||n);return r&&n&&QO(e,t,n),n};class Ah extends jt{constructor(t){super();g(this,na,void 0);m(this,"state","IDLE");m(this,"playbackUrl");m(this,"ingestionCredentials");m(this,"viewerCount");v(this,na,t),this.viewerCount=0}setLivestreamState(t){const r=this.state;this.state=t,r!==t&&this.emitCurrentLivestreamState()}emitCurrentLivestreamState(){this.emit("livestreamUpdate",this.state)}async start(t={manualIngestion:!1}){if(!o(this,na).permissions.canLivestream)throw u.error("DyteLivestream::start::permission_denied"),new P("User does not have permission to start livestreaming","1901");this.setLivestreamState("STARTING");try{const r=at(),{playbackUrl:n,ingestionCredentials:i}=await r.startLivestreaming(t);this.playbackUrl=n,this.ingestionCredentials=i,t!=null&&t.manualIngestion&&this.setLivestreamState("WAITING_ON_MANUAL_INGESTION")}catch(r){throw u.error("DyteRecording::stop::livestream_failed_to_start",{error:r}),this.setLivestreamState("IDLE"),new P("Error while starting livestream","1900")}}async stop(){if(!o(this,na).permissions.canLivestream)throw u.error("DyteLivestream::stop::permission_denied"),new P("User does not have permission to stop livestreaming","1901");if(this.state!=="LIVESTREAMING"&&this.state!=="WAITING_ON_MANUAL_INGESTION")throw u.error("DyteLivestream::stop::inconsistent_state"),new P("Livestream not started yet","1902");try{this.setLivestreamState("STOPPING"),await at().stopLivestreaming()}catch(t){throw u.error("DyteLivestream::stop::livestream_failed_to_stop",{error:t}),this.setLivestreamState("STOPPING"),new P("Error while stopping livestream","1900")}}}na=new WeakMap,Tv([T.trace("livestream.start")],Ah.prototype,"start",1),Tv([T.trace("livestream.stop")],Ah.prototype,"stop",1);var ZO=Object.defineProperty,e1=Object.getOwnPropertyDescriptor,t1=(s,e,t,r)=>{for(var n=r>1?void 0:r?e1(e,t):e,i=s.length-1,a;i>=0;i--)(a=s[i])&&(n=(r?a(e,t,n):a(n))||n);return r&&n&&ZO(e,t,n),n};class Sv{constructor(e,t){m(this,"livestream");g(this,ia,void 0);g(this,aa,void 0);g(this,cr,void 0);v(this,aa,e),this.livestream=new Ah(e),v(this,cr,t),this.setupEvents()}async fetchInitialLivestreamingState(){const e=at(),{status:t,playbackUrl:r,manualIngest:n,ingestionCredentials:i}=await e.getActiveLivestream();this.livestream.playbackUrl=r,this.livestream.ingestionCredentials=i,t==="LIVE"&&this.livestream.setLivestreamState("LIVESTREAMING"),t==="INVOKED"&&n&&this.livestream.setLivestreamState("WAITING_ON_MANUAL_INGESTION")}setupEvents(){o(this,cr).on(U.startedLivestream,async e=>{this.livestream.playbackUrl=e.playbackUrl,this.livestream.setLivestreamState("LIVESTREAMING");try{o(this,aa).permissions.canLivestream&&await this.fetchInitialLivestreamingState()}catch(t){u.error("Error: LivestreamController.fetchLivestream during startedLivestream re-fetch")}}),o(this,cr).on(U.livestreamingInvoked,async e=>{if(e.manualIngest){this.livestream.setLivestreamState("WAITING_ON_MANUAL_INGESTION");try{o(this,aa).permissions.canLivestream&&await this.fetchInitialLivestreamingState()}catch(t){u.error("Error: LivestreamController.fetchLivestream during livestreamingInvoked re-fetch")}}}),o(this,cr).on(U.stoppedLivestream,()=>{this.livestream.setLivestreamState("IDLE"),this.livestream.playbackUrl=void 0,this.livestream.ingestionCredentials=void 0}),o(this,cr).on(U.erroredLivestream,()=>{this.livestream.setLivestreamState("IDLE"),this.livestream.playbackUrl=void 0}),o(this,cr).on(U.roomPeerCount,e=>{this.livestream.viewerCount=e.count,this.livestream.emit("viewerCountUpdate",e.count)}),R.on(k.PEER_JOINED_INTERNAL,async e=>{var t;((t=e.flags)==null?void 0:t.hiddenParticipant)===!0&&e.recorderType==="LIVESTREAMER"&&(v(this,ia,e.id),this.livestream.setLivestreamState("LIVESTREAMING"))}),R.on(k.PEER_CLOSED,e=>{e.id===o(this,ia)&&(v(this,ia,void 0),this.livestream.setLivestreamState("IDLE"))}),R.onAsync(k.LEAVE_MEDIA_ROOM,async()=>{this.livestream.playbackUrl||(u.info("Fetching livestreaming state on leave stage"),await this.fetchInitialLivestreamingState())}),R.on(k.SOCKET_SERVICE_ROOM_JOINED,async()=>{try{await this.fetchInitialLivestreamingState()}catch(e){u.error("Error: LivestreamController.fetchLivestream")}})}}ia=new WeakMap,aa=new WeakMap,cr=new WeakMap,t1([T.trace("LivestreamController.setupEvents")],Sv.prototype,"setupEvents",1);var s1=Object.defineProperty,r1=Object.getOwnPropertyDescriptor,oo=(s,e,t,r)=>{for(var n=r>1?void 0:r?r1(e,t):e,i=s.length-1,a;i>=0;i--)(a=s[i])&&(n=(r?a(e,t,n):a(n))||n);return r&&n&&s1(e,t,n),n};class Ri{constructor({name:e,socketHandler:t,meetingId:r}){g(this,fl);m(this,"name","");g(this,Tt,{});g(this,Hr,"");g(this,qr,void 0);m(this,"rateLimitConfig",{maxInvocations:5,period:1});m(this,"bulkRateLimitConfig",{maxInvocations:5,period:1});m(this,"listeners",{});this.name=e,v(this,qr,t),v(this,Hr,r)}async set(e,t,r=!0,n=!1){o(this,Tt)[e]=t,r&&this.remoteSet(e,t),n&&(this.listeners[e]&&this.listeners[e].forEach(i=>i({[e]:o(this,Tt)[e]})),this.listeners["*"]&&this.listeners["*"].forEach(i=>i({[e]:o(this,Tt)[e]})))}remoteSet(e,t){o(this,qr).storeInsertKeys(o(this,Hr),this.name,[{key:e,payload:t}])}async bulkSet(e){e.forEach(({key:t,payload:r})=>{o(this,Tt)[t]=r}),o(this,qr).storeInsertKeys(o(this,Hr),this.name,e)}async update(e,t,r=!0){$(this,fl,wy).call(this,e,t,r)}async delete(e,t=!0,r=!1){if(o(this,Tt)[e]&&delete o(this,Tt)[e],t)return o(this,qr).storeDeleteKeys(o(this,Hr),this.name,[{key:e}]);r&&(this.listeners[e]&&(this.listeners[e].forEach(n=>n({[e]:void 0})),delete this.listeners[e]),this.listeners["*"]&&this.listeners["*"].forEach(n=>n({[e]:void 0})))}async bulkDelete(e){return e.forEach(({key:t})=>{o(this,Tt)[t]&&delete o(this,Tt)[t]}),o(this,qr).storeDeleteKeys(o(this,Hr),this.name,e)}get(e){if(o(this,Tt)[e])return o(this,Tt)[e]}getAll(){return o(this,Tt)}get rateLimits(){return this.rateLimitConfig}updateRateLimits(e,t){this.rateLimitConfig.maxInvocations=e,this.rateLimitConfig.period=t}get bulkRateLimits(){return this.bulkRateLimitConfig}updateBulkRateLimits(e,t){this.bulkRateLimitConfig.maxInvocations=e,this.bulkRateLimitConfig.period=t}subscribe(e,t){if(this.listeners[e]){this.listeners[e].push(t);return}this.listeners[e]=[t]}unsubscribe(e,t){var r;if(t){this.listeners[e]=((r=this.listeners[e])==null?void 0:r.filter(n=>n!==t))||[];return}this.listeners[e]&&delete this.listeners[e]}populate(e){v(this,Tt,e)}}Tt=new WeakMap,Hr=new WeakMap,qr=new WeakMap,fl=new WeakSet,wy=function(e,t,r=!0){let n;const i=o(this,Tt)[e],a=Object.prototype.toString.call(t),c=Object.prototype.toString.call(i);if(a!==c){this.set(e,t);return}switch(c){case"[object Array]":n=[...i,...t];break;case"[object Object]":n={...i,...t};break;case"[object Map]":n=new Map([...i,...t]);break;case"[object Set]":n=new Set([...i,...t]);break;default:n=t;break}this.set(e,n,r)},oo([xt(_i,"rateLimitConfig")],Ri.prototype,"remoteSet",1),oo([xt(_i,"bulkRateLimitConfig")],Ri.prototype,"bulkSet",1),oo([xt(_i,"rateLimitConfig")],Ri.prototype,"update",1),oo([xt(_i,"rateLimitConfig")],Ri.prototype,"delete",1),oo([xt(_i,"bulkRateLimitConfig")],Ri.prototype,"bulkDelete",1);class n1{constructor(e,t){g(this,No);g(this,gl);m(this,"stores",new Map);g(this,jn,void 0);g(this,Gn,"");g(this,Lo,void 0);g(this,jr,new Map);v(this,jn,t),v(this,Gn,e.getValue("meetingId")),v(this,Lo,e),$(this,gl,Py).call(this)}create(e){const t=new Ri({name:e,socketHandler:o(this,jn),meetingId:o(this,Gn)});return o(this,jn).storeGetKeys(o(this,Gn),e,[]),new Promise((n,i)=>{const a=setTimeout(()=>i(Error("Failed")),3e3);o(this,jr).set(e,{rejectTimeout:a,resolve:n,store:t})})}}jn=new WeakMap,Gn=new WeakMap,No=new WeakSet,np=function(){return o(this,Lo).getValue("peerId")},Lo=new WeakMap,jr=new WeakMap,gl=new WeakSet,Py=function(){[J.storeInsertKeys,J.storeGetKeys,J.storeDeleteKeys].forEach(e=>{o(this,jn).on(e,async t=>{var i,a;if(t.pluginId!==o(this,Gn))return;const r=(i=t.storeItems)==null?void 0:i.map(c=>{var d;return{timestamp:c.timestamp,peerId:c.peerId,payload:JSON.parse((d=c.payload)!=null&&d.length?new TextDecoder().decode(c.payload):"{}"),key:c.storeKey}});if(e===J.storeGetKeys){const c=o(this,jr).get(t.storeName),d=this.stores.get(t.storeName)||(c==null?void 0:c.store);o(this,jr).get(t.storeName)&&(this.stores.set(t.storeName,c.store),c.resolve(d),clearTimeout(c.rejectTimeout),o(this,jr).delete(t.storeName)),r.forEach(l=>{d.set(l.key,l.payload,!1,!1)});return}const n=this.stores.get(t.storeName)||((a=o(this,jr).get(t.storeName))==null?void 0:a.store);n!==void 0&&(e===J.storeInsertKeys&&r.forEach(({key:c,peerId:d,payload:l})=>{d!==o(this,No,np)&&n.set(c,l,!1,!0)}),e===J.storeDeleteKeys&&r.forEach(({key:c,peerId:d})=>{d!==o(this,No,np)&&n.delete(c,!1,!0)}))})})};function wn(s){var e,t,r,n,i,a,c,d,l,h,p,f,y;return s?{media:{audio:{enabled:s.audioEnabled,trackId:(e=s.audioTrack)==null?void 0:e.id,permission:"mediaPermissions"in s?(t=s.mediaPermissions)==null?void 0:t.audio:null},video:{enabled:s.videoEnabled,trackId:(r=s.videoTrack)==null?void 0:r.id,permission:"mediaPermissions"in s?(n=s.mediaPermissions)==null?void 0:n.video:null},screenshare:{enabled:s.screenShareEnabled,permission:"mediaPermissions"in s?(i=s.mediaPermissions)==null?void 0:i.screenshare:null,audio:{enabled:(c=(a=s.screenShareTracks)==null?void 0:a.audio)==null?void 0:c.enabled,trackId:(l=(d=s.screenShareTracks)==null?void 0:d.audio)==null?void 0:l.id},video:{enabled:(p=(h=s.screenShareTracks)==null?void 0:h.video)==null?void 0:p.enabled,trackId:(y=(f=s.screenShareTracks)==null?void 0:f.video)==null?void 0:y.id}}}}:{}}var i1=Object.defineProperty,a1=Object.getOwnPropertyDescriptor,ki=(s,e,t,r)=>{for(var n=r>1?void 0:r?a1(e,t):e,i=s.length-1,a;i>=0;i--)(a=s[i])&&(n=(r?a(e,t,n):a(n))||n);return r&&n&&i1(e,t,n),n};const o1=.8,c1=1.2;let Xs=(fy=class extends jt{constructor(e,t,r,n){super();g(this,Wn);g(this,da);g(this,Vo);m(this,"id");m(this,"userId");m(this,"name");m(this,"picture");m(this,"isHost");m(this,"customParticipantId");m(this,"flags");m(this,"device");m(this,"videoTrack");m(this,"audioTrack");m(this,"screenShareTracks");m(this,"videoEnabled");m(this,"audioEnabled");m(this,"screenShareEnabled");m(this,"producers");m(this,"manualProducerConfig");g(this,oa,void 0);m(this,"supportsRemoteControl",!1);g(this,ca,void 0);m(this,"presetName");g(this,Gr,void 0);g(this,dr,void 0);g(this,xo,void 0);g(this,Wr,new Map);g(this,lr,1);g(this,vl,ad(e=>{if(!this.videoTrack)return;const{clientWidth:t,clientHeight:r}=e,{width:n,height:i}=this.videoTrack.getSettings();if(!n||!i)return;const a=i/r,c=n/t,d=Math.max(a,c);d>c1&&o(this,lr)===1?(v(this,lr,0),R.emit(k.MAX_SPATIAL_LAYER_CHANGE,{peerId:this.id,maxSpatialLayer:o(this,lr)})):d<o1&&o(this,lr)===0&&(v(this,lr,1),R.emit(k.MAX_SPATIAL_LAYER_CHANGE,{peerId:this.id,maxSpatialLayer:o(this,lr)}))},2e3));v(this,Gr,e);const{id:i,userId:a,displayName:c,device:d,picture:l,isHost:h,flags:p,clientSpecificId:f,stageStatus:y,customParticipantId:_,audioMuted:b,audioTrack:I,videoEnabled:x=!1,videoTrack:B,producers:H,metadata:M}=t;this.id=i,this.userId=a,this.name=c,this.device=d,this.picture=l,this.isHost=h,this.flags=p,this.manualProducerConfig=dC,v(this,ca,y!=null?y:"ON_STAGE"),this.customParticipantId=_!=null?_:f,this.audioEnabled=!b,this.audioTrack=I,this.videoEnabled=x,this.videoTrack=B,this.screenShareTracks={audio:void 0,video:void 0},this.producers=H!=null?H:[],this.presetName=M==null?void 0:M.preset_name,v(this,oa,!1),v(this,dr,r),v(this,xo,n),this.setupEvents(),this.updateVideo=this.updateVideo.bind(this),$(this,Vo,ip).call(this)}get clientSpecificId(){return this.customParticipantId}get stageStatus(){return o(this,ca)}get mediaJoined(){return o(this,Gr).getValue("connectionHandler").mediaJoined}get socketJoined(){return o(this,Gr).getValue("connectionHandler").socketJoined}setVideoEnabled(e,t=!0){this.videoEnabled=e,t&&(u.info("DyteParticipant::setVideoEnabled::videoUpdate",{...wn(this)}),this.emit("videoUpdate",{videoEnabled:this.videoEnabled,videoTrack:this.videoTrack}))}setAudioEnabled(e,t=!0){this.audioEnabled=e,t&&(u.info("DyteParticipant::setAudioEnabled::audioUpdate",{...wn(this)}),this.emit("audioUpdate",{audioEnabled:this.audioEnabled,audioTrack:this.audioTrack}))}setScreenShareEnabled(e,t=!0){this.screenShareEnabled=e,t&&this.emit("screenShareUpdate",{screenShareEnabled:this.screenShareEnabled,screenShareTracks:this.screenShareTracks})}setupEvents(){this.on("videoUpdate",$(this,Vo,ip))}async pin(){if(!this.mediaJoined)throw new P("Can`t pin participant without joining room","1205");if(!o(this,dr).permissions.pinParticipant)throw new P("You do not have permission to pin participants.","1201");return o(this,Wn,Dc).pinPeer(this.id)}async unpin(){if(!this.mediaJoined)throw new P("Can`t unpin participant without joining room","1205");if(!o(this,dr).permissions.pinParticipant)throw new P("You do not have permission to unpin participants.","1201");return o(this,Wn,Dc).pinPeer(null)}setIsPinned(e,t=!0){var n;v(this,oa,e);const r=e?"pinned":"unpinned";(n=o(this,da,Wl))==null||n.updateSource(this.id,{pinned:e}),t&&this.emit(r,this)}async disableAudio(){const e=this.id;if(u.info("DyteParticipant::disable_audio",{dyteParticipant:{id:e}}),!this.mediaJoined)throw new P("Can`t disable participant audio without joining room","1205");if(o(this,dr).permissions.canDisableParticipantAudio)return o(this,Wn,Dc).disableAudio(e);throw u.error("DyteParticipant::unauthorized_disable_audio",{dyteParticipant:{id:e}}),new P("Unauthorized: User does not have permission to disable participant audio.","1201")}async kick(){const e=this.id;if(u.info("DyteParticipant::kick",{dyteParticipant:{id:e}}),!this.socketJoined)throw new P("Can`t kick participant without joining room","1205");if(o(this,dr).permissions.kickParticipant){await R.emitAsync(k.KICK_PEER,{peerId:e});return}throw u.error("DyteParticipant::unauthorized_kick",{dyteParticipant:{id:e}}),new P("Unauthorized: User does not have permission to kick participants.","1201")}async disableVideo(){const e=this.id;if(u.info("DyteParticipant::disable_video",{dyteParticipant:{id:e}}),!this.mediaJoined)throw new P("Can`t disable participant video without joining room","1205");if(o(this,dr).permissions.canDisableParticipantVideo)return o(this,Wn,Dc).disableVideo(e);throw u.error("DyteParticipant::unauthorized_disable_video",{dyteParticipant:{id:e}}),new P("Unauthorized: User does not have permission to disable participant video.","1201")}async getPermissions(){return o(this,xo).getUserPermissions(this.userId)}setStageStatus(e){v(this,ca,e),this.emit("stageStatusUpdate",this)}get isPinned(){return o(this,oa)}registerVideoElement(e){var r,n,i,a;let t;(n=(r=o(this,Wr).get(e))==null?void 0:r.observer)==null||n.disconnect(),"ResizeObserver"in window&&(t=new ResizeObserver(()=>o(this,vl).call(this,e)),t.observe(e)),o(this,Wr).set(e,{observer:t}),this.updateVideo(e),(a=o(this,da,Wl))==null||a.addSource(this.id,e,this.videoEnabled,this.isPinned,this.name,this.picture,(i=this.raised)!=null?i:!1)}deregisterVideoElement(e){var t,r,n;e.srcObject=void 0,(r=(t=o(this,Wr).get(e))==null?void 0:t.observer)==null||r.disconnect(),o(this,Wr).delete(e),(n=o(this,da,Wl))==null||n.removeSource(this.id)}updateVideo(e){var t;if(this.videoEnabled){if(this.videoTrack==null)return;const r=(t=e.srcObject)==null?void 0:t.getTracks()[0];if((r==null?void 0:r.id)===this.videoTrack.id)return;const n=new MediaStream;n.addTrack(this.videoTrack),e.srcObject=n}else e.srcObject=void 0;e.style.display=this.videoEnabled?"block":"none"}},oa=new WeakMap,ca=new WeakMap,Gr=new WeakMap,Wn=new WeakSet,Dc=function(){return o(this,Gr).getValue("roomNodeClient")},dr=new WeakMap,xo=new WeakMap,Wr=new WeakMap,da=new WeakSet,Wl=function(){return o(this,Gr).getValue("pip")},lr=new WeakMap,vl=new WeakMap,Vo=new WeakSet,ip=function(){Array.from(o(this,Wr).keys()).forEach(this.updateVideo)},fy);ki([T.trace("DyteParticipant.disableAudio")],Xs.prototype,"disableAudio",1),ki([T.trace("DyteParticipant.kick")],Xs.prototype,"kick",1),ki([T.trace("DyteParticipant.disableVideo")],Xs.prototype,"disableVideo",1),ki([T.trace("DyteParticipant.getPermissions")],Xs.prototype,"getPermissions",1),ki([T.trace("DyteParticipant.setStageStatus")],Xs.prototype,"setStageStatus",1),Xs=ki([ht("1200")],Xs);class co extends nv{constructor(e){const{onAddEvent:t="participantJoined",onDeleteEvent:r="participantLeft",onClearEvent:n="participantsCleared"}=e!=null?e:{};super({onAddEvent:t,onDeleteEvent:r,onClearEvent:n})}add(e,t=!0){return this.has(e.id)&&Object.is(this.get(e.id),e)===!1&&this.delete(e.id),super.add(e,t)}clear(e=!0,t=!1){return super.clear(e,t)}delete(e,t=!0,r=!1){return super.delete(e,t,r)}}class d1 extends Ti{constructor(){super();g(this,Jr,void 0);v(this,Jr,new Map)}__set(t,r){return o(this,Jr).set(t,r)}__clear(){return o(this,Jr).clear()}get(t){return o(this,Jr).get(t)}toArray(){return Array.from(o(this,Jr).values())}}Jr=new WeakMap;class l1{constructor(){m(this,"_orderedArray");m(this,"_map");this._map=new Map,this._orderedArray=[]}add(e,t){if(!this._map.has(e))return this._map.set(e,{peerId:e,priority:t}),this._orderedArray.splice(Math.max(t-1,0),0,e),this.index(e);const r=this.index(e);this.delete(e);const n=this.add(e,t);return r!==n?n:-1}delete(e){if(this._map.has(e)){const t=this.index(e);this._map.delete(e),this._orderedArray.splice(t,1)}}index(e){return this._map.has(e)?this._orderedArray.indexOf(e):-1}[Symbol.iterator](){return this._orderedArray[Symbol.iterator]()}}class u1{constructor(){m(this,"_activeSpeakerPeers");m(this,"_compulsoryPeers");this._activeSpeakerPeers=new l1,this._compulsoryPeers=new Set}add(e,t){if(!e)return-1;if(t<0)return this._compulsoryPeers.add(e),0;if(this.compulsoryPeers.includes(e)&&(t>0||t===246267631)){if(u.info("DyteSelectedPeer::removing_compulsory_peer",{selectedPeer:{peerId:e}}),this._removeFromCompulsoryPeer(e),t===246267631)return-1}else if(t===229490415)return this.delete(e),-1;return this._activeSpeakerPeers.add(e,t)}delete(e){u.info("DyteSelectedPeer::deleting_peer_from_selectedPeer",{selectedPeer:{peerId:e}}),this._removeFromCompulsoryPeer(e),this._activeSpeakerPeers.delete(e)}index(e){return this._activeSpeakerPeers.index(e)}get peers(){return Array.from(new Set(this.compulsoryPeers.concat(this.activeSpeakerPeers)))}get compulsoryPeers(){return Array.from(this._compulsoryPeers.values())}get activeSpeakerPeers(){return Array.from(this._activeSpeakerPeers)}_removeFromCompulsoryPeer(e){this._compulsoryPeers.delete(e)}}const Ev=new u1;var h1=Object.defineProperty,p1=Object.getOwnPropertyDescriptor,Kt=(s,e,t,r)=>{for(var n=r>1?void 0:r?p1(e,t):e,i=s.length-1,a;i>=0;i--)(a=s[i])&&(n=(r?a(e,t,n):a(n))||n);return r&&n&&h1(e,t,n),n};const m1=["ACTIVE_GRID","PAGINATED","MANUAL"];let wt=(gy=class extends jt{constructor(e,t,r){super();g(this,ur);m(this,"waitlisted");m(this,"joined");m(this,"active");m(this,"videoSubscribed");m(this,"audioSubscribed");m(this,"pinned");m(this,"all");g(this,Fs,void 0);g(this,Jn,void 0);g(this,Ft,void 0);m(this,"rateLimitConfig",{maxInvocations:5,period:1});m(this,"viewMode");m(this,"currentPage");m(this,"lastActiveSpeaker");m(this,"selectedPeers",Ev);v(this,Fs,e),v(this,Jn,t),v(this,Ft,r),this.waitlisted=new co,this.joined=new co,this.videoSubscribed=new co,this.audioSubscribed=new co,this.active=this.videoSubscribed,this.pinned=new co,this.all=new d1,this.viewMode="ACTIVE_GRID",this.currentPage=0,this.setupEvents()}get pip(){return o(this,Fs).getValue("pip")}get socketJoined(){var e;return((e=o(this,Fs).getValue("connectionHandler"))==null?void 0:e.socketJoined)===!0}get mediaJoined(){var e;return((e=o(this,Fs).getValue("connectionHandler"))==null?void 0:e.mediaJoined)===!0}get rateLimits(){return this.rateLimitConfig}updateRateLimits(e,t){this.rateLimitConfig.maxInvocations=e,this.rateLimitConfig.period=t}setupEvents(){R.on(k.E2EE_ACTIVE_CONSUMER,({peerId:e})=>{var t;((t=o(this,Fs).getValue("modules").e2ee)==null?void 0:t.enabled)!==!0&&this.emit("media_decode_error",{reason:`Got encrypted media for participantId ${e}, but encryption wasn't enabled in init.defaults`,code:"1702"})})}get count(){return this.joined.size}get maxActiveParticipantsCount(){var e;return(e=o(this,ur,ui))==null?void 0:e.maxPreferredStreams}setMaxActiveParticipantsCount(e){if(e<0||e>24)throw new P("0 <= Max active participants count limit <= 24","1203");o(this,ur,ui).maxPreferredStreams=e,this.mediaJoined&&R.emit(k.UPDATE_ACTIVE)}get pageCount(){if(this.viewMode==="PAGINATED"){const e=this.selectedPeers.compulsoryPeers.length,t=this.joined.toArray().filter(r=>r.stageStatus==="ON_STAGE");return Math.ceil((t.length-e)/Math.max(this.maxActiveParticipantsCount-e,1))}return 0}acceptWaitingRoomRequest(e){var r,n;if(!this.socketJoined)throw new P("Can`t accept waiting room request without joining room","1205");const t=(n=(r=this.waitlisted.get(e))==null?void 0:r.userId)!=null?n:e;return o(this,Ft).acceptWaitingRoomRequest([t])}async acceptAllWaitingRoomRequest(e){const t=e.map(r=>{var n,i;return(i=(n=this.waitlisted.get(r))==null?void 0:n.userId)!=null?i:r});return o(this,Ft).acceptWaitingRoomRequest(t)}async rejectWaitingRoomRequest(e){var r,n;if(!this.socketJoined)throw new P("Can`t reject waiting room request without joining room","1205");const t=(n=(r=this.waitlisted.get(e))==null?void 0:r.userId)!=null?n:e;o(this,Ft).rejectWaitingRoomRequest([t])}async setViewMode(e){if(u.info("DyteParticipants::set_view_mode",{pageNavigation:{viewMode:e,currentPage:this.currentPage,pageCount:this.pageCount,maxActiveParticipantsCount:this.maxActiveParticipantsCount}}),!(r=>m1.includes(r))(e))throw u.error("DyteParticipants::setViewMode::invalid_view_mode",{pageNavigation:{viewMode:e,currentPage:this.currentPage,pageCount:this.pageCount,maxActiveParticipantsCount:this.maxActiveParticipantsCount}}),new P(`Invalid view mode: ${e}. Try ACTIVE_GRID, PAGINATED or MANUAL.`,"1207");if(this.viewMode===e){u.info("DyteParticipants::setViewMode::view_mode_same_as_previous");return}if(e==="MANUAL")throw new P("Manual Subscription is not enabled for your Organization. Please contact support.","1208");this.viewMode=e,e==="PAGINATED"?(this.currentPage=1,R.emit(k.UPDATE_ACTIVE,{page:this.currentPage})):e==="ACTIVE_GRID"&&(this.currentPage=0,R.emit(k.UPDATE_ACTIVE)),this.emit("viewModeChanged",{viewMode:e,currentPage:this.currentPage,pageCount:this.pageCount})}async subscribe(e,t=["audio","video","screenshareAudio","screenshareVideo"]){if(this.viewMode!=="MANUAL")throw new P("MANUAL subscription mode was not activated.","1206");const r=[];e.forEach(n=>{const i=this.joined.get(n);if(i){if(t.includes("audio")){i.manualProducerConfig={...i.manualProducerConfig,audio:!0},this.videoSubscribed.add(i);const a=i.producers.find(c=>c.kind==="audio"&&!c.screenShare);a&&r.push(a)}if(t.includes("video")){i.manualProducerConfig={...i.manualProducerConfig,video:!0},this.audioSubscribed.add(i);const a=i.producers.find(c=>c.kind==="video"&&!c.screenShare);a&&r.push(a)}if(t.includes("screenshareAudio")){i.manualProducerConfig={...i.manualProducerConfig,screenshareAudio:!0};const a=i.producers.find(c=>c.kind==="audio"&&c.screenShare);r.push(a)}if(t.includes("screenshareVideo")){i.manualProducerConfig={...i.manualProducerConfig,screenshareVideo:!0};const a=i.producers.find(c=>c.kind==="video"&&c.screenShare);r.push(a)}}}),await o(this,ur,ui).createConsumers(r)}async unsubscribe(e,t=["audio","video","screenshareAudio","screenshareVideo"]){if(this.viewMode!=="MANUAL")throw new P("MANUAL subscription mode was not activated.","1206");const r=[];e.forEach(n=>{const i=this.joined.get(n);if(i){if(t.includes("audio")){i.manualProducerConfig={...i.manualProducerConfig,audio:!1};const a=i.producers.find(c=>c.kind==="audio"&&!c.screenShare);a&&r.push(a)}if(t.includes("video")){i.manualProducerConfig={...i.manualProducerConfig,video:!1};const a=i.producers.find(c=>c.kind==="video"&&!c.screenShare);a&&r.push(a)}if(t.includes("screenshareAudio")){i.manualProducerConfig={...i.manualProducerConfig,screenshareAudio:!1};const a=i.producers.find(c=>c.kind==="audio"&&c.screenShare);r.push(a)}if(t.includes("screenshareVideo")){i.manualProducerConfig={...i.manualProducerConfig,screenshareVideo:!1};const a=i.producers.find(c=>c.kind==="video"&&c.screenShare);r.push(a)}}}),await o(this,ur,ui).closeConsumers(r)}getPeerIdsForCurrentPage(){u.info("DyteParticipants::getPeerIdsForCurrentPage()",{pageNavigation:{viewMode:this.viewMode,currentPage:this.currentPage,pageCount:this.pageCount,maxActiveParticipantsCount:this.maxActiveParticipantsCount}});const{compulsoryPeers:e}=this.selectedPeers,t=e.filter(c=>this.joined.has(c)),r=Array.from(this.pinned.keys()).filter(c=>!t.includes(c)),n=Array.from(this.joined.toArray().filter(c=>c.stageStatus==="ON_STAGE").map(c=>c.id)),i=Math.max((this.currentPage-1)*(this.maxActiveParticipantsCount-t.length-r.length)),a=this.currentPage*(this.maxActiveParticipantsCount-t.length-r.length);return t.concat(r,n.slice(i,a))}async setPage(e){if(u.info("DyteParticipants::set_page",{pageNavigation:{settingPage:e,viewMode:this.viewMode,currentPage:this.currentPage,pageCount:this.pageCount,maxActiveParticipantsCount:this.maxActiveParticipantsCount}}),this.viewMode==="PAGINATED"){if(!Number.isInteger(e))throw u.error("DyteParticipants::invalid_page_number"),new P(`Invalid page: ${e}. Page must be an integer and greater than 0 and less than or equal to .pageCount`,"1202");this.currentPage=e,R.emit(k.UPDATE_ACTIVE,{page:e}),this.emit("pageChanged",{viewMode:this.viewMode,currentPage:this.currentPage,pageCount:this.pageCount})}}async disableAllAudio(e){if(u.info("DyteParticipants::disable_all_audio",{actions:{disableAllAudio:{allowUnmute:e}}}),!this.mediaJoined)throw new P("Can`t disable all audio without joining room","1205");if(o(this,Jn).permissions.canAllowParticipantAudio)return o(this,ur,ui).muteAll(e);throw u.error("DyteParticipants::unauthorized_disable_all_audio",{actions:{disableAllAudio:{allowUnmute:e}}}),new P("Unauthorized: User does not have permission to disable peer audio.","1201")}async disableAllVideo(){if(u.info("DyteParticipants::disable_all_video"),!this.mediaJoined)throw new P("Can`t disable all video without joining room","1205");if(o(this,Jn).permissions.canAllowParticipantVideo)return o(this,ur,ui).muteAllVideo();throw u.error("DyteParticipants::unauthorized_disable_all_video"),new P("Unauthorized: User does not have permission to disable peer video.","1201")}async disableAudio(e){this.joined.get(e).disableAudio()}async disableVideo(e){this.joined.get(e).disableVideo()}async kick(e){await R.emitAsync(k.KICK_PEER,{peerId:e})}async kickAll(){if(u.info("DyteParticipants::kick_all"),o(this,Fs).getValue("viewType")!=="LIVESTREAM"&&!this.socketJoined)throw new P("Can`t kick all without joining room","1205");if(!o(this,Jn).permissions.kickParticipant)throw u.error("DyteParticipants::unauthorized_kick_all"),new P("Unauthorized: User does not have permission to kick peers.","1201");const t=ee.hasFeature(se.PROPAGATE_KICK_ALL);o(this,Ft).kickAll(t)}async broadcastMessage(e,t,r){if(u.info("DyteParticipants::broadcastMessage"),!this.socketJoined)throw new P("Can`t broadcast message without joining room","1205");if(!(e!=null&&e.trim()))throw new P("`type` must be a non-empty string.","1209");if(r)if("meetingIds"in r)await o(this,Ft).broadcastToMeetings(e,r.meetingIds,t);else{let n=[];"participantIds"in r?n=r.participantIds:n=this.joined.toArray().filter(i=>{var a;return(a=r.presetNames)==null?void 0:a.includes(i.presetName)}).map(i=>i.id),await o(this,Ft).broadcastToPeers(e,n,t)}else await o(this,Ft).broadcastMessage(e,t)}async getAllJoinedPeers(e,t,r){return(await o(this,Ft).getRoomPeers(e,t,r)).peers.map(Zs.formatSocketServiceMessage)}async updatePermissions(e,t){const r=this.joined.toArray().filter(i=>e.includes(i.id)).map(i=>i.userId),n=[...new Set(r)];if(!n.length)throw new P("Cannot update permissions, no valid userIDs found","1204");o(this,Ft).updatePermissions(n,t)}async getParticipantsInMeetingPreJoin(){return o(this,Ft).getRoomPeersNonPaginated()}},Fs=new WeakMap,ur=new WeakSet,ui=function(){return o(this,Fs).getValue("roomNodeClient")},Jn=new WeakMap,Ft=new WeakMap,gy);Kt([T.trace("DyteParticipants.setViewMode")],wt.prototype,"setViewMode",1),Kt([T.trace("DyteParticipants.setPage")],wt.prototype,"setPage",1),Kt([T.trace("DyteParticipants.disableAllAudio")],wt.prototype,"disableAllAudio",1),Kt([T.trace("DyteParticipants.disableAllVideo")],wt.prototype,"disableAllVideo",1),Kt([T.trace("DyteParticipants.disablePeerAudio")],wt.prototype,"disableAudio",1),Kt([T.trace("DyteParticipants.disablePeerVideo")],wt.prototype,"disableVideo",1),Kt([T.trace("DyteParticipants.kickPeer")],wt.prototype,"kick",1),Kt([T.trace("DyteParticipants.kickAll")],wt.prototype,"kickAll",1),Kt([T.trace("DyteParticipants.broadcastMessage"),xt(_i,"rateLimitConfig")],wt.prototype,"broadcastMessage",1),Kt([T.trace("DyteParticipants.getAllJoinedPeers"),xt({maxInvocations:10,period:60})],wt.prototype,"getAllJoinedPeers",1),Kt([T.trace("DyteParticipant.updatePermissions"),xt({maxInvocations:1e3,period:60})],wt.prototype,"updatePermissions",1),Kt([T.trace("DyteParticipants.getParticipantsInMeetingPreJoin")],wt.prototype,"getParticipantsInMeetingPreJoin",1),wt=Kt([ht("1200")],wt);var kr=(s=>(s.NEW="new",s.CONNECTING="connecting",s.RECONNECTING="reconnecting",s.DISCONNECTED="disconnected",s.CONNECTED="connected",s.FAILED="failed",s.CLOSED="closed",s))(kr||{}),ft=(s=>(s[s.HIVE=1]="HIVE",s[s.ROOM_NODE=2]="ROOM_NODE",s[s.CF=3]="CF",s))(ft||{}),f1=Object.defineProperty,g1=Object.getOwnPropertyDescriptor,Pn=(s,e,t,r)=>{for(var n=r>1?void 0:r?g1(e,t):e,i=s.length-1,a;i>=0;i--)(a=s[i])&&(n=(r?a(e,t,n):a(n))||n);return r&&n&&f1(e,t,n),n};const _v=class{constructor(s,e,t,r){m(this,"participants");m(this,"self");m(this,"selectedPeers",Ev);m(this,"maxSpatialLayerUpdates",new Map);m(this,"consumerPeerMap");m(this,"events");m(this,"roomSocketHandler");m(this,"context");m(this,"videoPeerConsumerMap",new Map);m(this,"updateConsumerSpatialLayers",ad(()=>{const s={},e=new Map(this.maxSpatialLayerUpdates);this.maxSpatialLayerUpdates.clear(),Array.from(e.entries()).forEach(([t,r])=>{s[r]===void 0&&(s[r]={layer:r,consumerIds:[]}),s[r].consumerIds.push(t)}),Object.keys(s).forEach(t=>{const r=s[t];u.log(`Switching max spatial layer to ${r.layer}`,{consumerIds:r.consumerIds}),this.roomNodeClient.switchConsumersToLayer(r.consumerIds,r.layer)})},2e3));m(this,"updateConsumers",(s,e)=>{let t=Promise.resolve();e.length>0&&(u.info("Closing consumers for producers",{producers:e}),t=this.roomNodeClient.closeConsumers(e)),t.then(()=>{s.length!==0&&(u.info("Consuming producers",{producers:s}),this.roomNodeClient.createConsumers(s).catch(r=>u.error("Error activating peers",{error:r})))}).catch(r=>u.error("Error deactivating peers",{error:r}))});m(this,"updateConsumersDebounced",ad(this.updateConsumers,200,{trailing:!0}));switch(this.context=s,this.roomSocketHandler=t,this.participants=new wt(s,e,this.roomSocketHandler),this.self=e,this.consumerPeerMap=new Map,r){case ft.HIVE:{this.events=es;break}case ft.CF:{this.events=ys;break}default:this.events=es}e.config.viewType!=="CHAT"&&this.setupEventsGlobal(),this.setupEvents()}get roomNodeClient(){return this.context.getValue("roomNodeClient")}get mediaJoined(){var s;return((s=this.roomNodeClient)==null?void 0:s.mediaJoined)===!0}get pip(){return this.context.getValue("pip")}setupEvents(){this.roomSocketHandler.on(U.getWaitingRoomRequests,this.waitingRoomRequestHandler.bind(this)),R.on(k.SOCKET_PEERS,async s=>{const e=ee.hasFeature(se.DEBUG_SOCKET_JOIN);if(e){const t=s&&(s==null?void 0:s.length)<20?{peers:JSON.stringify(s.map(r=>r.peerId))}:void 0;u.info("Processing socket peers",t)}s==null||s.forEach(t=>{t.waitlisted||this.onParticipantJoined(this.fromSocketService(t))}),e&&u.info("Processed socket peers")}),this.roomSocketHandler.on(this.events.peerJoinedBroadcast,({participant:s})=>{ee.hasFeature(se.DEBUG_SOCKET_JOIN)&&u.info("events.peerJoinedBroadcast",{peers:s.peerId}),this.onMediaJoined(s.peerId,s.producerStates,s.capabilities)}),this.roomSocketHandler.on(U.leaveRoom,s=>{var t;const{peerId:e}=s.peer;(t=this.roomNodeClient)==null||t.handlePeerLeaving(e)}),this.roomSocketHandler.on(this.events.selfJoinComplete,({participants:s,selectedPeers:e,roomState:t})=>{if(ee.hasFeature(se.DEBUG_SOCKET_JOIN)){const i=s&&(s==null?void 0:s.length)<20?{peers:JSON.stringify(s.map(a=>a.peerId))}:void 0;u.info("events.selfJoinComplete",i)}s.forEach(({peerId:i,producerStates:a,capabilities:c})=>this.onMediaJoined(i,a,c));const{audioPeers:r,compulsoryPeers:n}=e!=null?e:{};t.pinnedPeerIds.length!==0&&this.onParticipantPinned(t.pinnedPeerIds[0]),this.computeActivateParticipants(r!=null?r:[],n),R.emit(k.UPDATE_ACTIVE,{createAllConsumers:!0})}),R.on(k.MAX_SPATIAL_LAYER_CHANGE,({peerId:s,maxSpatialLayer:e})=>{const t=this.videoPeerConsumerMap.get(s);t&&(this.maxSpatialLayerUpdates.set(t,e),this.updateConsumerSpatialLayers())}),R.on(k.NEW_PRODUCER,({peerId:s,producer:e})=>{const t=this.participants.joined.get(s);if(!t){u.warn("ParticipantController::NEW_PRODUCER::participant not found",{producer:{id:e==null?void 0:e.producerId,kind:e==null?void 0:e.kind,status:"UNKNOWN",appData:{screenShare:e==null?void 0:e.screenShare}},dyteParticipant:{id:s}});return}if(t.producers.push(e),u.info("ParticipantController::NEW_PRODUCER::producer_added_to_participant",{producer:{id:e==null?void 0:e.producerId,peerId:s,kind:e==null?void 0:e.kind,status:"UNKNOWN",appData:{screenShare:e==null?void 0:e.screenShare}}}),this.participants.viewMode==="MANUAL"){let r=!1;const n=e.kind==="audio",i=e.kind==="video",a=t.manualProducerConfig;(n&&(a.audio&&!e.screenShare||a.screenshareAudio&&e.screenShare)||i&&(a.video&&!e.screenShare||a.screenshareVideo&&e.screenShare))&&(r=!0),r?this.roomNodeClient.createConsumers([e]):u.info("ParticipantController::NEW_PRODUCER::not_consuming_producer",{producer:{id:e==null?void 0:e.producerId,peerId:s,kind:e==null?void 0:e.kind,status:"UNKNOWN",appData:{screenShare:e==null?void 0:e.screenShare}}});return}(e==null?void 0:e.kind)==="audio"&&this.participants.audioSubscribed.get(s)||(e==null?void 0:e.kind)==="video"&&this.participants.videoSubscribed.get(s)||e!=null&&e.screenShare?this.roomNodeClient.createConsumers([e]).catch(r=>{u.error("ParticipantController::createConsumer failed",{error:r})}):u.info("ParticipantController::NEW_PRODUCER::not_consuming_producer",{producer:{id:e==null?void 0:e.producerId,peerId:s,kind:e==null?void 0:e.kind,status:"UNKNOWN",appData:{screenShare:e==null?void 0:e.screenShare}}})}),R.on(k.PRODUCER_CLOSED,({peerId:s,producerId:e})=>{const t=this.participants.joined.get(s);if(!t){u.warn("ParticipantController::NEW_PRODUCER::participant not found",{dyteParticipant:{id:s}});return}t.producers=t.producers.filter(r=>r.producerId!==e)}),R.on(k.PRODUCER_TOGGLE,({peerId:s,producerId:e,paused:t,kind:r})=>{const n=this.participants.joined.get(s);if(n){r==="audio"&&n.setAudioEnabled(!t);const i=n.producers.find(a=>a.producerId===e);i&&(i.pause=t)}}),this.roomSocketHandler.on(this.events.globalPeerPinBroadcast,s=>{let e;if(s&&(e=s.participantId),!this.mediaJoined)return;const t=e;this.onParticipantPinned(t);const r=this.participants.joined.get(t);r&&this.roomNodeClient.activatePeers(r.producers).catch(n=>{u.error("unable to create consumers",{error:n})})}),this.roomSocketHandler.on(this.events.selectedPeer,({audioPeers:s,compulsoryPeers:e})=>{this.mediaJoined&&this.onSelectedPeers(e.concat(s))}),this.roomSocketHandler.on(this.events.selectedPeerDiff,({entries:s})=>{if(!this.mediaJoined)return;const e=s.map(t=>({peerId:t.peerId,priority:t.priority}));this.updateActiveParticipantsWithPriorities(e,!0)})}waitingRoomRequestHandler(s){const e=s.requests.filter(r=>!this.participants.waitlisted.toArray().find(n=>n.userId===r.userId)),t=this.participants.waitlisted.toArray().filter(r=>!s.requests.find(n=>n.userId===r.userId));e.forEach(r=>this.participants.waitlisted.add(new Xs(this.context,{id:r.peerId,displayName:r.displayName,audioMuted:!0,videoEnabled:!1,audioTrack:void 0,videoTrack:void 0,stageStatus:"OFF_STAGE",userId:r.userId,flags:{},isHost:!1,customParticipantId:r.customParticipantId,picture:r.picture,metadata:{preset_name:r.presetName}},this.self,this.roomSocketHandler))),t.forEach(r=>this.participants.waitlisted.delete(r.id))}get maxPreferredStreams(){return this.participants.maxActiveParticipantsCount}async selectPagePeers(s){const{compulsoryPeers:e}=this.selectedPeers,t=e.filter(d=>this.participants.joined.has(d)),r=Array.from(this.participants.pinned.keys()).filter(d=>!t.includes(d)),n=Array.from(this.participants.joined.toArray().filter(d=>d.stageStatus==="ON_STAGE").map(d=>d.id)),i=Math.max((s-1)*(this.roomNodeClient.maxPreferredStreams-t.length-r.length)),a=s*(this.roomNodeClient.maxPreferredStreams-t.length-r.length);return t.concat(r,n.slice(i,a))}selectActivePeers(){const s=new Map,e=Array.from(this.participants.joined.toArray().filter(l=>l.stageStatus==="ON_STAGE").map(l=>(s.set(l.id,!0),l.id))),t=this.selectedPeers.peers,r=this.participants.pinned.toArray().reduce((l,h)=>(h.stageStatus!=="ON_STAGE"?this.participants.pinned.delete(h.id):l.push(h.id),l),[]),n=this.self.stageStatus==="ON_STAGE"?1:0,i=this.participants.maxActiveParticipantsCount-n,a=new Set(t.concat(r).filter(l=>l!==this.self.id&&s.has(l)));let c=Array.from(a);const d=i-a.size;if(d>=0){const l=e.filter(h=>!a.has(h)&&h!==this.self.id).slice(0,d);c=Array.from(a).concat(l)}else c=c.slice(0,i);return c}async updateActive(s,e){const{page:t,createAllConsumers:r}=e!=null?e:{};let{strategies:n}=e!=null?e:{},i,a;switch(s){case"PAGINATED":{if(!t)return;i=await this.selectPagePeers(t),u.debug("ParticipantController::updateActive::updating_current_page_peers",{peerIds:i}),n!=null||(n={video:this.updateParticipantsMap.bind(this)}),a=this.updateConsumersDebounced;break}case"ACTIVE_GRID":{i=this.selectActivePeers(),u.debug("ParticipantController::updateActive::updating_current_selected_peers",{peerIds:i}),n!=null||(n={video:this.updateParticipantsMapMinReplacement.bind(this),audio:this.updateParticipantsMap.bind(this)}),a=this.updateConsumers;break}default:throw new Error(`View mode ${s} not supported`)}let c,d;const l=this.updateGrid(i,n);r?(c=this.mapPeerIdsToProducers(i,["audio","video","screenshare"]),d=[]):(c=[...this.mapPeerIdsToProducers([...l.video.add],["video"]),...this.mapPeerIdsToProducers([...l.audio.add],["audio"])],d=[...this.mapPeerIdsToProducers([...l.video.remove],["video"]),...this.mapPeerIdsToProducers([...l.audio.remove],["audio"])]),!(c.length===0&&d.length===0)&&a(c,d)}computeActivateParticipants(s,e){const t=s.map((n,i)=>({peerId:n,priority:i+1})),r=e==null?void 0:e.map((n,i)=>({peerId:n,priority:-(i+1)}));t.push(...r!=null?r:[]),t.length>0&&this.updateActiveParticipantsWithPriorities(t)}fromSocketService(s){const e=_v.formatSocketServiceMessage(s);return new Xs(this.context,{...e,isHost:!1,videoEnabled:!1,audioMuted:!0,videoTrack:void 0,audioTrack:void 0},this.self,this.roomSocketHandler)}updatePipSource(s,e){var t,r;e?(t=this.pip)==null||t.enableSource(s):(r=this.pip)==null||r.disableSource(s)}onMediaJoined(s,e,t){if(!this.mediaJoined||s===this.self.id)return;const r=this.participants.joined.get(s);if(!r){u.warn(`Received media.peerJoinedBroadcast for non-existent peer ${s}`);return}e.forEach(n=>{n.kind===Ls.AUDIO&&!n.screenShare?r.setAudioEnabled(!n.pause):n.kind===Ls.VIDEO&&!n.screenShare&&(r.setVideoEnabled(!n.pause),this.updatePipSource(r.id,!n.pause)),r.producers.push({...n,producingTransportId:n.producingTransportId,kind:n.kind===Ls.AUDIO?"audio":"video",producingPeerId:s,mimeType:n.mimeType})}),this.roomNodeClient.handlePeerCapabilities(s,t),this.roomNodeClient.shareWebcam(this.self.videoTrack)}updateParticipantsMapMinReplacement(s,e){const t=Array.from(s.keys()),r=new Map(s),n=[],i=[],a=new Set(e),c=[];return t.forEach((d,l)=>{(!a.has(d)||!this.participants.joined.get(d))&&c.push(l)}),e.forEach(d=>{if(s.get(d))return;if(t.length<e.length){t.push(d),n.push(d);return}const l=c.shift();i.push(t[l]),t[l]=d,n.push(t[l])}),t.forEach((d,l)=>{a.has(d)||i.concat(t.splice(l,1))}),Array.from(s.keys()).forEach(d=>{s.delete(d,!a.has(d))}),t.forEach(d=>{if(!this.participants.joined.get(d)){u.warn("updateActiveParticipants::participant_not_in_joined_list",{dyteParticipant:{id:d}});return}s.add(this.participants.joined.get(d),!r.get(d))}),s.emit("participantsUpdate"),[n,i]}updateParticipantsMap(s,e){const t=Array.from(s.keys()),r=[],n=[];return t.forEach(i=>{e.includes(i)||(s.delete(i,!0),n.push(i))}),e.forEach(i=>{s.get(i)||(s.add(this.participants.joined.get(i)),r.push(i))}),s.emit("participantsUpdate"),[r,n]}updatePinnedParticipants(){this.participants.pinned.forEach(s=>{s.setIsPinned(!1),this.participants.pinned.delete(s.id)})}setupEventsGlobal(){this.roomSocketHandler.on(U.joinRoom,({peer:s})=>{if(!s.waitlisted){const e=ee.hasFeature(se.DEBUG_SOCKET_JOIN);e&&u.info("Processing socket join",{peers:s.peerId}),this.onParticipantJoined(this.fromSocketService(s)),e&&u.info("Processed socket join",{peers:s.peerId})}}),this.roomSocketHandler.on(U.leaveRoom,s=>{this.selectedPeers.delete(s.peer.peerId),this.onParticipantLeave(s.peer.peerId)}),R.on(k.SOCKET_SERVICE_ROOM_JOINED,()=>{this.self.permissions.acceptWaitingRequests&&this.roomSocketHandler.getWaitingRoomRequests()}),this.self.permissions.on("permissionsUpdate",s=>{const{acceptWaitingRequests:e}=s;e!==void 0&&(e?this.roomSocketHandler.getWaitingRoomRequests():this.participants.waitlisted.clear())}),R.on(k.SOCKET_SERVICE_DISCONNECTED,()=>{this.participants.joined.clear(),this.participants.videoSubscribed.clear(),this.participants.audioSubscribed.clear(),this.participants.pinned.clear(),this.participants.currentPage=0,this.participants.viewMode="ACTIVE_GRID",this.participants.emit("viewModeChanged",{viewMode:"ACTIVE_GRID",currentPage:this.participants.currentPage,pageCount:this.participants.pageCount})}),R.on(k.CONSUMER_PAUSED,({id:s})=>{this.processConsumerPaused(s)}),R.on(k.CONSUMER_RESUMED,({id:s})=>{this.processConsumerResumed(s)}),R.on(k.NEW_CONSUMER,({id:s})=>{this.processNewConsumer(s)}),R.on(k.CONSUMER_CLOSED,({id:s})=>{this.processConsumerClosed(s)}),R.on(k.ROOM_MESSAGE,async({payload:s,type:e,timestamp:t})=>{this.participants.emit("broadcastedMessage",{type:e,payload:s,timestamp:t})}),R.on(k.MESSAGE,async({payload:s,type:e,timestamp:t})=>{e!=="spotlight"&&this.participants.emit("broadcastedMessage",{type:e,payload:s,timestamp:t})}),R.on(k.LOW_CONSUMER_SCORE,({peerId:s,score:e,kind:t})=>{const r=this.participants.joined.get(s);r&&(r.emit("poorConnection",{score:e,kind:t}),this.participants.emit("poorConnection",{participantId:s,score:e,kind:t}))}),R.on(k.CONSUMER_SCORE_UPDATE,({score:s,kind:e,appData:t,peerId:r,scoreStats:n})=>{var c;const i=e==="video"&&((c=t==null?void 0:t.screenShare)!=null?c:!1),a=this.participants.joined.get(r);a&&(a.emit("mediaScoreUpdate",{kind:e,isScreenshare:i,score:s,participantId:r,scoreStats:n}),this.participants.emit("mediaScoreUpdate",{kind:e,isScreenshare:i,score:s,participantId:r,scoreStats:n}))}),R.onAsync(k.KICK_PEER,async({peerId:s})=>{const e=this.participants.joined.get(s);await this.roomNodeClient.kick(s),await this.roomSocketHandler.kick(s),e?e.emit("kicked"):this.participants.joined.emit("kicked",{id:s})}),R.on(k.UPDATE_ACTIVE,async({page:s,createAllConsumers:e}={})=>{await this.updateActive(s?"PAGINATED":"ACTIVE_GRID",{page:s,createAllConsumers:e})})}async onParticipantPinned(s){if(!s){this.self.isPinned&&this.self.setIsPinned(!1),this.participants.pinned.size!==0&&this.updatePinnedParticipants();return}if(s===this.self.id){this.participants.pinned.size!==0&&this.updatePinnedParticipants(),this.self.setIsPinned(!0);return}const e=this.participants.joined.get(s);this.self.isPinned&&this.self.setIsPinned(!1),this.updatePinnedParticipants(),e.setIsPinned(!0),this.participants.pinned.add(e)}async onParticipantJoined(s){var t,r,n;if(this.self.id!==s.id&&!((t=s.flags)!=null&&t.recorder)&&!((r=s.flags)!=null&&r.hidden_participant)&&!((n=s.flags)!=null&&n.hiddenParticipant)&&(this.participants.videoSubscribed.delete(s.id),this.participants.audioSubscribed.delete(s.id),this.participants.joined.add(s),this.participants.waitlisted.delete(s.id),s.stageStatus==="REQUESTED_TO_JOIN_STAGE"&&R.emit(k.UPDATE_STAGE_REQUESTS,{request:{displayName:s.name,userId:s.userId,peerId:s.id},add:!0})),R.emit(k.PEER_JOINED_INTERNAL,s),this.self.config.viewType===Et.Webinar&&s.stageStatus!=="ON_STAGE"||this.roomNodeClient===void 0||this.participants.videoSubscribed.size>=this.roomNodeClient.maxPreferredStreams)return;const e=this.participants.currentPage;this.updateActive(e?"PAGINATED":"ACTIVE_GRID",{page:e})}async onParticipantLeave(s){const e=this.participants.joined.get(s);this.participants.joined.delete(s,!0,!0),this.participants.pinned.delete(s,!0,!0),this.participants.waitlisted.delete(s,!0,!0),e&&e.stageStatus==="REQUESTED_TO_JOIN_STAGE"&&R.emit(k.UPDATE_STAGE_REQUESTS,{request:{displayName:e.name,userId:e.userId,peerId:e.id},add:!1});const{currentPage:t}=this.participants,r=this.maxPreferredStreams*(t-1),n=this.participants.videoSubscribed.get(s);r===0?this.participants.setViewMode("ACTIVE_GRID"):this.participants.joined.size<=r?t===2?this.participants.setViewMode("ACTIVE_GRID"):this.participants.setPage(t-1):n&&this.updateActive(t?"PAGINATED":"ACTIVE_GRID",{page:t})}processMedia(s){var h;const e=this.roomNodeClient.getConsumers(),{peerId:t,kind:r,appData:n,track:i,producerId:a,rtpReceiver:c,paused:d}=(h=e.get(s))!=null?h:{};if(!t)return u.warn("processMedia::Peer ID is undefined",{consumer:{id:s,kind:r,peerId:t,appData:{supportsRemoteControl:!!(n!=null&&n.supportsRemoteControl),screenShare:!!(n!=null&&n.screenShare)},remotelyPaused:d,producerId:a}}),{};const l=n;return r==="video"&&l.screenShare!==!0&&this.videoPeerConsumerMap.set(t,s),u.info("ParticipantController::processMedia",{consumer:{id:s,peerId:t,kind:r,appData:l,remotelyPaused:d,producerId:a}}),this.consumerPeerMap.set(s,{type:r,peerId:t,appData:l,remotelyPaused:d,producerId:a}),{peerId:t,kind:r,appData:l,remotelyPaused:d,track:i,producerId:a,rtpReceiver:c}}processConsumerClosed(s){const{peerId:e,type:t,appData:r,remotelyPaused:n,producerId:i}=this.consumerPeerMap.get(s)||{},a=this.participants.joined.get(e);if(u.info("ParticipantController::processConsumerClosed",{consumer:{id:s,peerId:e,appData:r,kind:t,remotelyPaused:n,producerId:i}}),this.consumerPeerMap.delete(s),t==="video"&&r.screenShare!==!0&&this.videoPeerConsumerMap.delete(e),!a)return;const c=[];r&&r.screenShare?(a.setScreenShareEnabled(!1),G.consumerSharedMediaState(s,{screen:!1}),a.screenShareTracks.video&&c.push(a.screenShareTracks.video.id),a.screenShareTracks.audio&&c.push(a.screenShareTracks.audio.id),a.screenShareTracks={audio:void 0,video:void 0}):t==="audio"?(a.setAudioEnabled(!1),a.audioTrack&&c.push(a.audioTrack.id),G.consumerSharedMediaState(s,{audio:!1}),a.audioTrack=void 0):t==="video"&&(a.setVideoEnabled(!1),this.updatePipSource(a.id,!1),a.videoTrack&&c.push(a.videoTrack.id),G.consumerSharedMediaState(s,{video:!1}),a.videoTrack=void 0),r.e2ee&&c.forEach(d=>{R.emit(k.E2EE_INACTIVE_CONSUMER,{peerId:e,trackId:d})})}processConsumerResumed(s){const{peerId:e,kind:t,appData:r,track:n,remotelyPaused:i,producerId:a,rtpReceiver:c}=this.processMedia(s);if(!e)return;u.info("ParticipantController::processConsumerResumed",{consumer:{id:s,peerId:e,kind:t,appData:r,remotelyPaused:i,producerId:a}});const d=this.participants.joined.get(e);if(d){if(r.e2ee&&R.emit(k.E2EE_ACTIVE_CONSUMER,{peerId:e,rtpReceiver:c,track:n}),r.screenShare){t==="video"?d.screenShareTracks.video=n:t==="audio"&&(d.screenShareTracks.audio=n),d.setScreenShareEnabled(!0),G.consumerSharedMediaState(s,{screen:!0});return}t==="video"?(d.videoTrack=n,d.setVideoEnabled(!0),this.updatePipSource(d.id,!0),G.consumerSharedMediaState(s,{video:!0})):t==="audio"&&(d.audioTrack=n,d.setAudioEnabled(d.audioEnabled),G.consumerSharedMediaState(s,{audio:d.audioEnabled}))}}processConsumerPaused(s){u.info(`ParticipantController::processConsumerPaused called for consumerId: ${s}`);const{peerId:e,kind:t,track:r,appData:n,remotelyPaused:i,producerId:a}=this.processMedia(s);if(!e)return;u.info("ParticipantController::processConsumerPaused",{consumer:{id:s,peerId:e,kind:t,appData:n,remotelyPaused:i,producerId:a}});const c=this.participants.joined.get(e);c&&(r&&n.e2ee&&R.emit(k.E2EE_INACTIVE_CONSUMER,{peerId:e,trackId:r.id}),t==="video"?(c.videoTrack=r,c.setVideoEnabled(!1),this.updatePipSource(c.id,!1),G.consumerSharedMediaState(s,{video:!1})):t==="audio"&&(c.audioTrack=r,c.setAudioEnabled(c.audioEnabled),G.consumerSharedMediaState(s,{audio:c.audioEnabled})))}processNewConsumer(s){const{peerId:e,kind:t,remotelyPaused:r,track:n,appData:i,producerId:a,rtpReceiver:c}=this.processMedia(s);if(!e)return;u.info("ParticipantController::processNewConsumer",{consumer:{id:s,peerId:e,kind:t,remotelyPaused:r,appData:i,producerId:a}});const d=this.participants.joined.get(e);if(d){if(i.screenShare){t==="video"?d.screenShareTracks.video=n:t==="audio"&&(d.screenShareTracks.audio=n),(!r||this.self.permissions.isRecorder||ee.hasFeature(se.SCREEENSHARE_ERR_HACK))&&d.setScreenShareEnabled(!0),i.supportsRemoteControl&&(d.supportsRemoteControl=!0),this.participants.broadcastMessage("screenshareConsumerCreated",{producerId:a,peerId:e,screenShare:!0,consumerId:s,consumerPeerId:this.self.id}),u.info("ParticipantController::newScreenshareConsumer::screenshareConsumerCreated",{consumer:{id:s,peerId:e,kind:t,remotelyPaused:r,appData:i,producerId:a}});return}t==="video"?(d.videoTrack=n,r||(d.setVideoEnabled(!0),this.updatePipSource(d.id,!0)),G.consumerSharedMediaState(s,{video:!r})):t==="audio"&&(d.audioTrack=n,r||d.setAudioEnabled(!0),G.consumerSharedMediaState(s,{audio:!r})),!r&&i.e2ee&&R.emit(k.E2EE_ACTIVE_CONSUMER,{peerId:e,rtpReceiver:c,track:n})}}static formatSocketServiceMessage(s){var t,r,n,i,a,c;if(!s)return;const e=Sh(s.stageType);return{id:s.peerId,userId:s.userId,name:s.displayName,displayName:s.displayName,stageType:e,customParticipantId:s.customParticipantId,presetId:s.presetId,picture:s.displayPictureUrl,waitlisted:s.waitlisted,stageStatus:e,metadata:{preset_name:(t=s.flags)==null?void 0:t.presetName},recorderType:(r=s.flags)==null?void 0:r.recorderType,flags:{hiddenParticipant:(n=s.flags)==null?void 0:n.hiddenParticipant,hidden_participant:(i=s.flags)==null?void 0:i.hiddenParticipant,recorder:((a=s.flags)==null?void 0:a.recorderType)!==void 0&&((c=s.flags)==null?void 0:c.recorderType)!=="NONE"}}}mapPeerIdsToProducers(s,e){const t=(n,i)=>n.filter(({kind:a,screenShare:c})=>i.includes(a)||c&&i.includes("screenshare"));return s.flatMap(n=>{const i=this.participants.joined.get(n);if(i)return t(i.producers,e)}).filter(n=>!!n)}updateGrid(s,e){let t=[],r=[],n=[],i=[];return e.video&&([t,n]=e.video(this.participants.videoSubscribed,s)),e.audio&&([r,i]=e.audio(this.participants.audioSubscribed,s)),{video:{add:t,remove:n},audio:{add:r,remove:i}}}async onSelectedPeers(s,e){this.participants.viewMode==="ACTIVE_GRID"&&this.computeActivateParticipants(s,e)}updateActiveParticipantsWithPriorities(s,e=!1){if(!this.mediaJoined){u.warn("Skipped::ParticipantController::updateActiveParticipantsWithPriorities",{roomJoined:this.mediaJoined});return}s.forEach(r=>{this.selectedPeers.add(r.peerId,r.priority)});const t=this.selectedPeers.activeSpeakerPeers.at(0);t!==void 0&&t!==this.participants.lastActiveSpeaker&&(this.participants.lastActiveSpeaker=t,this.participants.emit("activeSpeaker",{peerId:t,volume:1})),e&&(this.participants.viewMode==="ACTIVE_GRID"?this.updateActive("ACTIVE_GRID"):this.participants.viewMode==="PAGINATED"&&this.updateActive("ACTIVE_GRID",{strategies:{audio:this.updateParticipantsMap.bind(this)}}))}};let Zs=_v;Pn([T.trace("ParticipantController.setupEvents")],Zs.prototype,"setupEvents",1),Pn([T.trace("ParticipantController.setupEvents")],Zs.prototype,"setupEventsGlobal",1),Pn([T.trace("ParticipantController.processMedia")],Zs.prototype,"processMedia",1),Pn([T.trace("ParticipantController.processConsumerClosed")],Zs.prototype,"processConsumerClosed",1),Pn([T.trace("ParticipantController.processConsumerResumed")],Zs.prototype,"processConsumerResumed",1),Pn([T.trace("ParticipantController.processConsumerPaused")],Zs.prototype,"processConsumerPaused",1),Pn([T.trace("ParticipantController.processNewConsumer")],Zs.prototype,"processNewConsumer",1);const ve=Ss(Vu().permissions),ha=class extends jt{constructor(t,r,n,i=!1){super();g(this,kt);g(this,q,void 0);g(this,la,void 0);g(this,ua,void 0);g(this,yl,t=>{var l,h,p;const{chat:r,connectedMeetings:n,plugins:i,polls:a,media:c,...d}=t;if(r&&(r.private&&_r(o(this,q).chat.private,r.private),r.public&&_r(o(this,q).chat.public,r.public),this.emit("chatUpdate")),n&&_r(o(this,q).connectedMeetings,n),c){const f=_=>{switch(_){case Pr.NONE:return W.Allowed;case Pr.ALLOWED:return W.Allowed;case Pr.NOT_ALLOWED:return W.NotAllowed;case Pr.CAN_REQUEST:return W.CanRequest;default:return}},y={audio:void 0,video:void 0,screenshare:void 0};(l=c.audio)!=null&&l.canProduce&&(y.audio={canProduce:f(c.audio.canProduce)}),(h=c.video)!=null&&h.canProduce&&(y.video={canProduce:f(c.video.canProduce)}),(p=c.screenshare)!=null&&p.canProduce&&(y.screenshare={canProduce:f(c.screenshare.canProduce)}),_r(o(this,q).media,y)}i&&(_r(o(this,q).plugins,i),this.emit("pluginsUpdate")),a&&(_r(o(this,q).polls,a),this.emit("pollsUpdate")),Object.keys(d).length!==0&&_r(o(this,q),d),this.emit("permissionsUpdate",t)});if(!r)throw u.error("DytePermissionsPreset::load_preset_permissions_failed"),new P("Could not load preset permissions.","0904");v(this,ua,t),v(this,la,n),v(this,q,r),i&&this.setupEvents()}setupEvents(){R.on(k.UPDATE_PERMISSIONS,o(this,yl))}static fromResponse(t,r,n){return new ha(n,t,r,!0)}static default(t,r){return new ha(t,ve,r)}static init(t,r,n){let i;return n?i=new ha(t,n,r,!0):i=new ha(t,ve,r),i}get mediaRoomType(){const{sfu:t}=o(this,ua).getValue("roomNodeOptions");return t===ft.CF?"CF":"HIVE"}get stageEnabled(){var t;return((t=o(this,q))==null?void 0:t.stageEnabled)||o(this,la)===Et.Webinar||o(this,la)===Et.Livestream}get acceptStageRequests(){var t,r;return this.stageEnabled?((t=o(this,q))==null?void 0:t.acceptStageRequests)||((r=o(this,q))==null?void 0:r.canAcceptProductionRequests):!1}get stageAccess(){var t,r,n;return((t=o(this,q))==null?void 0:t.stageAccess)===W.NotAllowed?W.NotAllowed:((r=o(this,q))==null?void 0:r.stageAccess)===W.CanRequest?W.CanRequest:((n=o(this,q))==null?void 0:n.stageAccess)===W.Allowed||o(this,q).media.audio.canProduce===W.Allowed||o(this,q).media.video.canProduce===W.Allowed||o(this,q).media.screenshare.canProduce===W.Allowed?W.Allowed:o(this,q).media.audio.canProduce===W.CanRequest||o(this,q).media.video.canProduce===W.CanRequest||o(this,q).media.screenshare.canProduce===W.CanRequest?W.CanRequest:W.NotAllowed}get acceptWaitingRequests(){var t,r;return(r=(t=o(this,q))==null?void 0:t.acceptWaitingRequests)!=null?r:ve.acceptWaitingRequests}get requestProduceVideo(){var t,r,n;return((n=(r=(t=o(this,q))==null?void 0:t.media)==null?void 0:r.video)==null?void 0:n.canProduce)===W.CanRequest}get requestProduceAudio(){var t,r,n;return((n=(r=(t=o(this,q))==null?void 0:t.media)==null?void 0:r.audio)==null?void 0:n.canProduce)===W.CanRequest}get requestProduceScreenshare(){var t,r,n;return((n=(r=(t=o(this,q))==null?void 0:t.media)==null?void 0:r.screenshare)==null?void 0:n.canProduce)===W.CanRequest}get canAllowParticipantAudio(){var t,r;return(r=(t=o(this,q))==null?void 0:t.disableParticipantAudio)!=null?r:ve.disableParticipantAudio}get canAllowParticipantScreensharing(){var t,r;return(r=(t=o(this,q))==null?void 0:t.canAcceptProductionRequests)!=null?r:ve.canAcceptProductionRequests}get canAllowParticipantVideo(){var t,r;return(r=(t=o(this,q))==null?void 0:t.disableParticipantVideo)!=null?r:ve.disableParticipantVideo}get canDisableParticipantAudio(){return this.canAllowParticipantAudio}get canDisableParticipantVideo(){return this.canAllowParticipantVideo}get kickParticipant(){var t,r;return(r=(t=o(this,q))==null?void 0:t.kickParticipant)!=null?r:ve.kickParticipant}get pinParticipant(){var t,r;return(r=(t=o(this,q))==null?void 0:t.pinParticipant)!=null?r:ve.pinParticipant}get canRecord(){var t,r;return(r=(t=o(this,q))==null?void 0:t.canRecord)!=null?r:ve.canRecord}get waitingRoomType(){var t,r;return(r=(t=o(this,q))==null?void 0:t.waitingRoomType)!=null?r:ve.waitingRoomType}get waitingRoomBehaviour(){var t,r;return(r=(t=o(this,q))==null?void 0:t.waitingRoomType)!=null?r:ve.waitingRoomType}get plugins(){var t,r;return(r=(t=o(this,q))==null?void 0:t.plugins)!=null?r:ve.plugins}get polls(){var t,r;return(r=(t=o(this,q))==null?void 0:t.polls)!=null?r:ve.polls}get produceVideo(){return this.canProduceVideo}get requestProduce(){return o(this,q).media.audio.canProduce===W.CanRequest||o(this,q).media.video.canProduce===W.CanRequest||o(this,q).media.screenshare.canProduce===W.CanRequest}get canProduceVideo(){var r;const t=(r=o(this,q).media.video.canProduce)!=null?r:ve.media.video.canProduce;return this.stageEnabled&&(o(this,kt,Xt)==="ACCEPTED_TO_JOIN_STAGE"||o(this,kt,Xt)==="ON_STAGE")&&t===W.CanRequest?W.Allowed:this.stageEnabled&&(o(this,kt,Xt)==="OFF_STAGE"||o(this,kt,Xt)==="REQUESTED_TO_JOIN_STAGE")&&t===W.Allowed?W.NotAllowed:t}get produceScreenshare(){return this.canProduceScreenshare}get canProduceScreenshare(){var r;const t=(r=o(this,q).media.screenshare.canProduce)!=null?r:ve.media.screenshare.canProduce;return this.stageEnabled&&(o(this,kt,Xt)==="ACCEPTED_TO_JOIN_STAGE"||o(this,kt,Xt)==="ON_STAGE")&&t===W.CanRequest?W.Allowed:this.stageEnabled&&(o(this,kt,Xt)==="OFF_STAGE"||o(this,kt,Xt)==="REQUESTED_TO_JOIN_STAGE")&&t===W.Allowed?W.NotAllowed:t}get produceAudio(){return this.canProduceAudio}get canProduceAudio(){var r;const t=(r=o(this,q).media.audio.canProduce)!=null?r:ve.media.audio.canProduce;return this.stageEnabled&&(o(this,kt,Xt)==="ACCEPTED_TO_JOIN_STAGE"||o(this,kt,Xt)==="ON_STAGE")&&t===W.CanRequest?W.Allowed:this.stageEnabled&&(o(this,kt,Xt)==="OFF_STAGE"||o(this,kt,Xt)==="REQUESTED_TO_JOIN_STAGE")&&t===W.Allowed?W.NotAllowed:t}get chatPublic(){var t,r,n;return(n=(r=(t=o(this,q))==null?void 0:t.chat)==null?void 0:r.public)!=null?n:ve.chat.public}get chatPrivate(){var t,r,n;return(n=(r=(t=o(this,q))==null?void 0:t.chat)==null?void 0:r.private)!=null?n:ve.chat.private}get chatChannel(){var t,r,n;return(n=(r=(t=o(this,q))==null?void 0:t.chat)==null?void 0:r.channel)!=null?n:ve.chat.channel}get chatMessage(){var t,r,n;return(n=(r=(t=o(this,q))==null?void 0:t.chat)==null?void 0:r.message)!=null?n:ve.chat.message}get connectedMeetings(){var t,r;return(r=(t=o(this,q))==null?void 0:t.connectedMeetings)!=null?r:ve==null?void 0:ve.connectedMeetings}get hiddenParticipant(){var t,r;return(r=(t=o(this,q))==null?void 0:t.hiddenParticipant)!=null?r:ve.hiddenParticipant}get showParticipantList(){var t;return(t=o(this,q).showParticipantList)!=null?t:ve.showParticipantList}get canChangeParticipantRole(){var t,r;return(r=(t=o(this,q))==null?void 0:t.canChangeParticipantPermissions)!=null?r:ve.canChangeParticipantPermissions}get canChangeParticipantPermissions(){var t,r;return(r=(t=o(this,q))==null?void 0:t.canChangeParticipantPermissions)!=null?r:ve.canChangeParticipantPermissions}get canChangeTheme(){return!1}get canPresent(){return o(this,q).media.audio.canProduce===W.Allowed||o(this,q).media.video.canProduce===W.Allowed||o(this,q).media.screenshare.canProduce===W.Allowed}get acceptPresentRequests(){return this.acceptStageRequests}get canEditDisplayName(){var t;return(t=o(this,q).canEditDisplayName)!=null?t:!1}get maxScreenShareCount(){return 1}get isRecorder(){return o(this,q).isRecorder}get canSpotlight(){return o(this,q).canSpotlight}get canLivestream(){return o(this,q).canLivestream}get transcriptionEnabled(){return o(this,q).transcriptionEnabled}};let Mh=ha;q=new WeakMap,la=new WeakMap,ua=new WeakMap,yl=new WeakMap,kt=new WeakSet,Xt=function(){return o(this,ua).getValue("stageStatus")};class v1 extends jt{constructor(){super(...arguments);m(this,"localMediaHandler");g(this,Xh,void 0)}async updatePermission(){var d,l;const t=(h,p)=>{this.mediaPermissions[h]=p;const f={message:this.mediaPermissions[h],kind:h};p==="DENIED"?R.emit(k.MEDIA_PERMISSION_ERROR,f):R.emit(k.MEDIA_PERMISSION_UPDATE,f)};if(_e.getName()==="firefox")return;const r="microphone",n="camera",i=await((d=navigator==null?void 0:navigator.permissions)==null?void 0:d.query({name:r})),a=await((l=navigator==null?void 0:navigator.permissions)==null?void 0:l.query({name:n})),c=(h,p)=>{switch(p){case"granted":t(h,"ACCEPTED");break;case"denied":t(h,"DENIED");break;case"prompt":t(h,"NOT_REQUESTED");break}this.localMediaHandler.repopulateAvailableDevices()};i&&(i.onchange=()=>c("audio",i.state)),a&&(a.onchange=()=>c("video",a.state))}async populateMediaPermissionsInCallstats({message:t,kind:r}){switch(r){case"audio":{G.mediaPermission("AUDIO",t),G.mediaPermission("SPEAKER",t);break}case"video":{G.mediaPermission("VIDEO",t);break}case"screenshare":{G.mediaPermission("SCREENSHARE",t);break}}}async init(t={},r=!1,n=null){var i,a,c,d,l,h;if(_e.init(),!this.localMediaHandler)try{let p=!0;if(n!=null&&n.getValue("defaults").mediaHandler)p=!1,this.localMediaHandler=n.getValue("defaults").mediaHandler.localMediaHandler;else if(navigator.RNLocalMediaHandlerImpl){const{RNLocalMediaHandlerImpl:f}=navigator;this.localMediaHandler=await f.init()}else this.localMediaHandler=new Vt(n,t.constraints,(i=n==null?void 0:n.getValue("defaults"))==null?void 0:i.isNonPreferredDevice,(a=n==null?void 0:n.getValue("defaults"))==null?void 0:a.autoSwitchAudioDevice);if(R.on(k.MEDIA_PERMISSION_UPDATE,async f=>{if(this.populateMediaPermissionsInCallstats({message:f.message,kind:f.kind}),f.message==="NOT_REQUESTED")switch(f==null?void 0:f.kind){case"audio":this.rawAudioTrack&&(u.info("Disabling audio due to media permission update"),this.disableAudio());break;case"video":this.rawVideoTrack&&(u.info("Disabling video due to media permission update"),this.disableVideo());break;default:break}this.emit("mediaPermissionUpdate",f)}),R.on(k.MEDIA_PERMISSION_ERROR,async f=>{const{kind:y,message:_,constraints:b}=f;this.populateMediaPermissionsInCallstats({message:_,kind:y}),y==="audio"?(u.info(`Disabling audio due to media permission error  skipping: ${this.localMediaHandler.audioUpdateInProgress}`),this.localMediaHandler.audioUpdateInProgress===!1&&this.disableAudio()):y==="video"&&(u.info(`Disabling video due to media permission error skipping: ${this.localMediaHandler.videoUpdateInProgress}`),this.localMediaHandler.videoUpdateInProgress===!1&&this.disableVideo()),u.error("SelfController::mediaPermissionError",{error:{message:_},constraints:b,mediaPermissionsErrors:{kind:y,message:_}}),this.emit("mediaPermissionError",f),this.emit("mediaPermissionUpdate",{message:_,kind:y})}),p){u.info(`Setting up DyteSelfMedia streams using media handler. audio:${(c=t==null?void 0:t.audio)!=null?c:!0} video:${(d=t==null?void 0:t.video)!=null?d:!0}`);const f=this.localMediaHandler.setupStreams({video:(l=t==null?void 0:t.video)!=null?l:!0,audio:(h=t==null?void 0:t.audio)!=null?h:!0});r||await f}}catch(p){u.error("DyteSelf::init::Failed To Setup Streams",{error:{name:p.name,message:p.message}})}}get audioTrack(){return this.localMediaHandler.audioTrack}get rawAudioTrack(){return this.localMediaHandler.rawAudioTrack}get mediaPermissions(){return this.localMediaHandler.permissions}async addAudioMiddleware(t){return this.localMediaHandler.addAudioMiddleware(t)}async removeAudioMiddleware(t){return this.localMediaHandler.removeAudioMiddleware(t)}async removeAllAudioMiddlewares(){return this.localMediaHandler.removeAllAudioMiddlewares()}get videoTrack(){return this.localMediaHandler.videoTrack}get rawVideoTrack(){return this.localMediaHandler.rawVideoTrack}async addVideoMiddleware(t){return this.localMediaHandler.addVideoMiddleware(t)}async setVideoMiddlewareGlobalConfig(t={disablePerFrameCanvasRendering:!1}){return this.localMediaHandler.setVideoMiddlewareGlobalConfig(t)}async removeVideoMiddleware(t){return this.localMediaHandler.removeVideoMiddleware(t)}async removeAllVideoMiddlewares(){return this.localMediaHandler.removeAllVideoMiddlewares()}get screenShareTracks(){return this.localMediaHandler.screenShareTracks}get audioEnabled(){return this.localMediaHandler.audioEnabled}get videoEnabled(){return this.localMediaHandler.videoEnabled}get screenShareEnabled(){return this.localMediaHandler.screenShareEnabled}async enableAudio(){await this.localMediaHandler.enableAudio(),this.emit("audioUpdate",{audioEnabled:this.audioEnabled,audioTrack:this.audioTrack})}async enableVideo(){await this.localMediaHandler.enableVideo(),this.emit("videoUpdate",{videoEnabled:this.videoEnabled,videoTrack:this.videoTrack})}async disableAudio(){this.localMediaHandler.disableAudio(),this.emit("audioUpdate",{audioEnabled:this.audioEnabled,audioTrack:this.audioTrack})}async enableScreenShare(){await this.localMediaHandler.enableScreenShare(),this.emit("screenShareUpdate",{screenShareEnabled:this.screenShareEnabled,screenShareTracks:this.screenShareTracks})}async disableScreenShare(){await this.localMediaHandler.disableScreenShare(),this.emit("screenShareUpdate",{screenShareEnabled:this.screenShareEnabled,screenShareTracks:this.screenShareTracks})}async disableVideo(){await this.localMediaHandler.disableVideo(),this.emit("videoUpdate",{videoEnabled:this.videoEnabled,videoTrack:this.videoTrack})}getCurrentDevices(){return this.localMediaHandler.getCurrentDevices()}async getAudioDevices(){return await this.localMediaHandler.getAudioDevices()}async getVideoDevices(){return await this.localMediaHandler.getVideoDevices()}async getSpeakerDevices(){return await this.localMediaHandler.getSpeakerDevices()}getDeviceById(t,r){let n;return r==="audio"?n="audioinput":r==="video"?n="videoinput":r==="speaker"&&(n="audiooutput"),this.localMediaHandler.getDeviceById(t,n)}async setDevice(t){switch(t.kind){case"audioinput":try{await this.localMediaHandler.setAudioDevice(t)}catch(r){}finally{this.emit("audioUpdate",{audioEnabled:this.audioEnabled,audioTrack:this.audioTrack})}break;case"audiooutput":await this.localMediaHandler.setSpeakerDevice(t);break;case"videoinput":try{await this.localMediaHandler.setVideoDevice(t)}catch(r){}finally{this.emit("videoUpdate",{videoEnabled:this.videoEnabled,videoTrack:this.videoTrack})}break}this.emit("deviceUpdate",{device:t})}}Xh=new WeakMap;const lo={},Ir={executeWithLock({methodName:s,lockName:e,timeout:t}){return(r,n,i)=>{const a=i.value;return i.value=function(...d){if(lo[e]){const p=new Error(`Unsupported concurrent calls on Dyte method: ${s}.`);throw p.name="UnsupportedConcurrentMethodExecution",u.error("DyteLocker::UnsupportedConcurrentMethodExecution",{error:{stack:p.stack},dyteLocker:{methodName:s,lockName:e}}),p}lo[e]=!0;const l=setTimeout(()=>delete lo[e],t),h=a.apply(this,d);return Promise.resolve(h).then(()=>{delete lo[e],clearTimeout(l)}).catch(()=>{delete lo[e],clearTimeout(l)}),h},i}}};var y1=Object.defineProperty,T1=Object.getOwnPropertyDescriptor,Pt=(s,e,t,r)=>{for(var n=r>1?void 0:r?T1(e,t):e,i=s.length-1,a;i>=0;i--)(a=s[i])&&(n=(r?a(e,t,n):a(n))||n);return r&&n&&y1(e,t,n),n};let st=(vy=class extends v1{constructor(e,t,r,n,i){var a;super();g(this,Kr);g(this,Xe);g(this,qe);g(this,Uo);m(this,"name");m(this,"picture");m(this,"customParticipantId");m(this,"waitlistStatus");g(this,pa,void 0);g(this,It,void 0);g(this,ma,void 0);m(this,"role");m(this,"userId");m(this,"organizationId");m(this,"supportsRemoteControl",!1);m(this,"device");g(this,Bs,void 0);m(this,"hidden",!1);m(this,"presetName");m(this,"roomState","init");g(this,fa,new Set);g(this,ga,new Set);v(this,Bs,e),this.userId=t.id,this.name=t.name,this.picture=t.picture,this.customParticipantId=(a=t.customParticipantId)!=null?a:t.clientSpecificId,this.waitlistStatus="none",v(this,It,r),v(this,pa,n),this.hidden=!1,v(this,ma,!1),this.organizationId=t.organizationId,this.supportsRemoteControl=_e.isElectron(),this.device=_e.getDeviceInfo(),this.presetName=i,n.viewType!==Et.Chat&&this.updatePermission(),this.updateVideo=this.updateVideo.bind(this),$(this,Uo,ap).call(this)}get stageStatus(){return o(this,Bs).getValue("stageStatus")}get id(){return o(this,Bs).getValue("peerId")}static async __init__(e,t,r,n,i,a=!1){var p,f,y,_,b;let c=(f=(p=e.getValue("defaults"))==null?void 0:p.audio)!=null?f:!0,d=(_=(y=e.getValue("defaults"))==null?void 0:y.video)!=null?_:!0;r.canProduceAudio!=="ALLOWED"&&(c=!1),r.canProduceVideo!=="ALLOWED"&&(d=!1);const l=new st(e,t,r,n,i);if(n.viewType===Et.Chat)return l;const h=kO(n.mediaConstraints);return _r(h,(b=e.getValue("defaults"))==null?void 0:b.mediaConfiguration),await l.init({audio:c,video:d,constraints:h},a,e),l.setupEvents(),l}cleanupEvents(){this.removeAllListeners("videoUpdate"),this.localMediaHandler.removeAllListeners("AUDIO_TRACK_CHANGE"),this.localMediaHandler.removeAllListeners("VIDEO_TRACK_CHANGE"),this.localMediaHandler.removeAllListeners("DEVICE_CHANGE"),this.localMediaHandler.removeAllListeners("DEVICE_LIST_UPDATED"),this.localMediaHandler.removeAllListeners("SCREENSHARE_TRACK_CHANGE"),this.localMediaHandler.removeAllListeners("SCREENSHARE_ENDED"),this.localMediaHandler.removeAllListeners("AUDIO_TRACK_SILENT"),this.localMediaHandler.removeAllListeners("FORCE_MUTE_AUDIO"),this.localMediaHandler.removeAllListeners("FORCE_MUTE_VIDEO"),o(this,It).removeAllListeners("permissionsUpdate")}setupEvents(){this.on("videoUpdate",$(this,Uo,ap)),this.localMediaHandler.on("AUDIO_TRACK_CHANGE",async()=>{if(u.info("DyteSelf::setupEvents::AUDIO_TRACK_CHANGE",{...wn(this)}),o(this,qe,et)&&this.audioEnabled)try{await o(this,Xe,ut).shareMic(this.audioTrack)}catch(e){u.error("DyteSelf::setupEvents::Error while sharing mic",{error:e}),this.localMediaHandler.disableAudio()}this.emit("audioUpdate",{audioEnabled:this.audioEnabled,audioTrack:this.audioTrack})}),this.localMediaHandler.on("VIDEO_TRACK_CHANGE",async()=>{if(u.info("DyteSelf::setupEvents::VIDEO_TRACK_CHANGE",{...wn(this)}),o(this,qe,et)&&this.rawVideoTrack===void 0)u.info("DyteSelf::VIDEO_TRACK_CHANGE::Forcing_disable_video"),this.disableVideo();else if(this.videoEnabled&&o(this,qe,et))try{const e=await o(this,Xe,ut).shareWebcam(this.videoTrack);e&&e.id!==this.videoTrack.id&&ee.hasFeature(se.EXP_RESHARE)&&await o(this,Xe,ut).shareWebcam(this.videoTrack)}catch(e){u.error("DyteSelf::setupEvents::failed shareWebcam",{error:e}),this.videoEnabled&&await this.localMediaHandler.disableVideo()}this.emit("videoUpdate",{videoEnabled:this.videoEnabled,videoTrack:this.videoTrack})}),this.localMediaHandler.on("DEVICE_CHANGE",async({device:e})=>{this.emit("deviceUpdate",{device:e})}),this.localMediaHandler.on("DEVICE_LIST_UPDATED",e=>{this.emit("deviceListUpdate",e)}),this.localMediaHandler.on("SCREENSHARE_TRACK_CHANGE",async()=>{if(!o(this,qe,et)){u.error("DyteSelf.SCREENSHARE_TRACK_CHANGE.LocalMediaInitialized_WithoutRoomNode");return}if(this.screenShareEnabled)try{await o(this,Xe,ut).shareScreen(this.screenShareTracks)}catch(e){u.error("DyteSelf::setupEvents::Error while sharing screen",{error:e}),this.screenShareEnabled&&await this.localMediaHandler.disableScreenShare()}u.info("DyteSelf::setupEvents::SCREENSHARE_TRACK_CHANGE",{...wn(this)}),this.emit("screenShareUpdate",{screenShareEnabled:this.screenShareEnabled,screenShareTracks:this.screenShareTracks})}),this.localMediaHandler.on("SCREENSHARE_ENDED",async()=>{u.log("Disabling screenshare due to SCREENSHARE_ENDED"),await this.disableScreenShare(),u.info("DyteSelf::setupEvents::SCREENSHARE_ENDED",{...wn(this)})}),this.localMediaHandler.on("AUDIO_TRACK_SILENT",()=>{G.mediaTrackMuted("AUDIO")}),this.localMediaHandler.on("FORCE_MUTE_AUDIO",()=>{this.disableAudio()}),this.localMediaHandler.on("FORCE_MUTE_VIDEO",async()=>{o(this,qe,et)&&await o(this,Xe,ut).pauseWebcam(),this.emit("videoUpdate",{videoEnabled:this.videoEnabled,videoTrack:this.videoTrack}),G.videoOff()}),o(this,It).on("permissionsUpdate",e=>{var t,r,n;(t=e==null?void 0:e.media)!=null&&t.audio&&o(this,It).canProduceAudio!==W.Allowed&&(this.disableAudio(),u.info(`Disabled audio due to dynamic preset change: canProduceAudio: ${this.permissions.canProduceAudio}`)),(r=e==null?void 0:e.media)!=null&&r.video&&o(this,It).canProduceVideo!==W.Allowed&&(this.disableVideo(),u.info(`Disabled video due to dynamic preset change: canProduceVideo: ${this.permissions.canProduceVideo}`)),(n=e==null?void 0:e.media)!=null&&n.screenshare&&o(this,It).canProduceScreenshare!==W.Allowed&&(this.disableScreenShare(),u.info(`Disabled screenshare due to dynamic preset change: canProduceScreenshare: ${this.permissions.canProduceScreenshare}`))})}get permissions(){return o(this,It)}get config(){return o(this,pa)}get roomJoined(){var e;return o(this,pa).viewType===Et.Livestream&&this.stageStatus!=="ON_STAGE"?((e=o(this,Bs).getValue("connectionHandler"))==null?void 0:e.socketJoined)===!0:o(this,qe,et)}setName(e){if(!e)throw new P("Name cannot be empty.","1103");this.name=e}async setupTracks(e={}){e.forceReset,await this.disableAudio(),await this.disableVideo(),this.localMediaHandler.removeAudioTrack(),this.localMediaHandler.removeVideoTrack(),e.audio&&await this.enableAudio(),e.video&&await this.enableVideo()}async destructMediaHandler(){return this.localMediaHandler.destruct()}async removeDocumentEventListeners(){return this.localMediaHandler.removeDocumentEventListeners()}async enableAudio(){if(this.permissions.canProduceAudio!==W.NotAllowed&&!(o(this,It).canProduceAudio===W.CanRequest&&(this.stageStatus==="OFF_STAGE"||this.stageStatus==="REQUESTED_TO_JOIN_STAGE"))&&!this.audioEnabled){if(G.audioOn(),await this.localMediaHandler.enableAudio(),o(this,qe,et)&&this.stageStatus==="ON_STAGE"){if(this.audioTrack)try{await o(this,Xe,ut).shareMic(this.audioTrack)}catch(e){u.error("DyteSelf::enableAudio::Error while sharing mic",{error:e}),this.localMediaHandler.disableAudio()}if(!this.audioEnabled)return;o(this,Xe,ut).unmuteSelf()}this.emit("audioUpdate",{audioEnabled:this.audioEnabled,audioTrack:this.audioTrack})}}async enableVideo(){if(o(this,It).canProduceVideo!==W.NotAllowed&&!(o(this,It).canProduceVideo===W.CanRequest&&(this.stageStatus==="OFF_STAGE"||this.stageStatus==="REQUESTED_TO_JOIN_STAGE"))&&!this.videoEnabled){if(G.videoOn(),await this.localMediaHandler.enableVideo(),o(this,qe,et)&&this.stageStatus==="ON_STAGE")try{await o(this,Xe,ut).shareWebcam(this.videoTrack)}catch(e){u.error("DyteSelf::enableVideo::Error while sharing video",{error:e}),this.videoEnabled&&this.localMediaHandler.disableVideo()}this.emit("videoUpdate",{videoEnabled:this.videoEnabled,videoTrack:this.videoTrack}),u.info("DyteSelf.enableVideo",{...wn(this)})}}async updateVideoConstraints(e){if(!this.localMediaHandler.updateVideoConstraints)throw new P("Unsupported","1102");await this.localMediaHandler.updateVideoConstraints(e)}async enableScreenShare(){if(!o(this,qe,et))throw new P("Can`t enable screenshare without joining room","1105");if(o(this,It).canProduceScreenshare!==W.NotAllowed&&!(o(this,It).canProduceScreenshare===W.CanRequest&&(this.stageStatus==="OFF_STAGE"||this.stageStatus==="REQUESTED_TO_JOIN_STAGE"))&&!this.screenShareEnabled&&(await this.localMediaHandler.enableScreenShare(),this.screenShareTracks.audio||this.screenShareTracks.video)){try{await o(this,Xe,ut).shareScreen(this.screenShareTracks)}catch(e){u.error("DyteSelf::enableScreenShare::Error while sharing screen",{error:e}),this.screenShareEnabled&&await this.localMediaHandler.disableScreenShare()}this.emit("screenShareUpdate",{screenShareEnabled:this.screenShareEnabled,screenShareTracks:this.screenShareTracks})}}async updateScreenshareConstraints(e){if(!this.localMediaHandler.updateScreenshareConstraints)throw new P("Unsupported","1102");await this.localMediaHandler.updateScreenshareConstraints(e)}async disableAudio(){this.audioEnabled&&(this.localMediaHandler.disableAudio(),o(this,qe,et)&&o(this,Xe,ut).muteSelf(),this.emit("audioUpdate",{audioEnabled:this.audioEnabled,audioTrack:this.audioTrack}),G.audioOff())}async disableVideo(){this.videoEnabled&&(await this.localMediaHandler.disableVideo(),o(this,qe,et)&&await o(this,Xe,ut).pauseWebcam(),this.emit("videoUpdate",{videoEnabled:this.videoEnabled,videoTrack:this.videoTrack}),G.videoOff())}async disableScreenShare(){this.screenShareEnabled&&(await this.localMediaHandler.disableScreenShare(),o(this,qe,et)&&await o(this,Xe,ut).disableScreenShare(),this.emit("screenShareUpdate",{screenShareEnabled:this.screenShareEnabled,screenShareTracks:this.screenShareTracks}))}getAllDevices(){return this.localMediaHandler.getAllDevices()}setIsPinned(e,t=!0){var n;v(this,ma,e);const r=e?"pinned":"unpinned";(n=o(this,Kr,Ba))==null||n.updateSource(this.id,{pinned:e}),t&&this.emit(r,this)}get isPinned(){return o(this,ma)}async pin(){if(!o(this,qe,et))throw new P("Can`t pin participants without joining room","1105");return this.show(),o(this,Xe,ut).pinPeer(this.id)}async unpin(){if(!o(this,qe,et))throw new P("Can`t unpin participants without joining room","1105");return o(this,Xe,ut).pinPeer(null)}async hide(){if(!o(this,qe,et))throw new P("Can`t toggle participant tile without joining room","1105");this.hidden=!0,this.emit("toggleTile",{hidden:this.hidden})}show(){if(!o(this,qe,et))throw new P("Can`t toggle participant tile without joining room","1105");this.hidden=!1,this.emit("toggleTile",{hidden:this.hidden})}async setDevice(e){var r,n,i;if(!e)throw new P("No device selected","1104");const t=this.getCurrentDevices();if(e.deviceId&&(((r=t==null?void 0:t.audio)==null?void 0:r.deviceId)===e.deviceId||((n=t==null?void 0:t.video)==null?void 0:n.deviceId)===e.deviceId||((i=t==null?void 0:t.speaker)==null?void 0:i.deviceId)===e.deviceId)&&(u.warn("DyteSelf.setDevice.setting_to_in_use_device",{devices:[e]}),ee.hasFeature(se.SKIP_SETTING_IN_USE_DEVICE)))throw new P("Cannot set device currently in use","1106");switch(e.kind){case"audioinput":try{await this.localMediaHandler.setAudioDevice(e)}catch(a){o(this,qe,et)&&await o(this,Xe,ut).muteSelf(),this.emit("audioUpdate",{audioEnabled:this.audioEnabled,audioTrack:this.audioTrack})}break;case"audiooutput":await this.localMediaHandler.setSpeakerDevice(e);break;case"videoinput":try{await this.localMediaHandler.setVideoDevice(e)}catch(a){o(this,qe,et)&&await o(this,Xe,ut).pauseWebcam(),this.emit("videoUpdate",{videoEnabled:this.videoEnabled,videoTrack:this.videoTrack})}break}}cleanUpTracks(){var e,t,r,n;(e=this.audioTrack)==null||e.stop(),(t=this.rawAudioTrack)==null||t.stop(),(r=this.videoTrack)==null||r.stop(),(n=this.rawVideoTrack)==null||n.stop()}registerVideoElement(e,t=!1){var r,n;t?o(this,fa).add(e):o(this,ga).add(e),this.updateVideo(e),t||(n=o(this,Kr,Ba))==null||n.addSource(this.id,e,this.videoEnabled,this.isPinned,this.name,this.picture,(r=this.raised)!=null?r:!1)}deregisterVideoElement(e,t=!1){e.srcObject=void 0,t?o(this,fa).delete(e):(o(this,ga).delete(e),o(this,Kr,Ba).removeSource(this.id))}updateVideo(e,t=!1){var r,n,i;if(this.videoEnabled){if(this.videoTrack==null)return;const a=(r=e.srcObject)==null?void 0:r.getTracks()[0];if((a==null?void 0:a.id)===this.videoTrack.id)return;const c=new MediaStream;c.addTrack(this.videoTrack),e.srcObject=c,t||(n=o(this,Kr,Ba))==null||n.enableSource(this.id)}else e.srcObject=void 0,t||(i=o(this,Kr,Ba))==null||i.disableSource(this.id);e.style.display=this.videoEnabled?"block":"none"}},pa=new WeakMap,It=new WeakMap,ma=new WeakMap,Bs=new WeakMap,Kr=new WeakSet,Ba=function(){return o(this,Bs).getValue("pip")},Xe=new WeakSet,ut=function(){return o(this,Bs).getValue("roomNodeClient")},qe=new WeakSet,et=function(){var e;return((e=o(this,Bs).getValue("connectionHandler"))==null?void 0:e.mediaJoined)===!0},fa=new WeakMap,ga=new WeakMap,Uo=new WeakSet,ap=function(){Array.from(o(this,ga)).forEach(e=>this.updateVideo(e,!1)),Array.from(o(this,fa)).forEach(e=>this.updateVideo(e,!0))},vy);Pt([T.trace("DyteSelf.cleanupEvents")],st.prototype,"cleanupEvents",1),Pt([T.trace("DyteSelf.setupEvents")],st.prototype,"setupEvents",1),Pt([T.trace("DyteSelf.setupTracks")],st.prototype,"setupTracks",1),Pt([T.trace("DyteSelf.destructMediaHandler")],st.prototype,"destructMediaHandler",1),Pt([T.trace("DyteSelf.removeDocumentEventListeners")],st.prototype,"removeDocumentEventListeners",1),Pt([Ir.executeWithLock({methodName:"meeting.self.enableAudio",lockName:"DyteSelf.toggleAudio",timeout:3e3}),T.trace("DyteSelf.enableAudio")],st.prototype,"enableAudio",1),Pt([Ir.executeWithLock({methodName:"meeting.self.enableVideo",lockName:"DyteSelf.toggleVideo",timeout:3e3}),T.trace("DyteSelf.enableVideo")],st.prototype,"enableVideo",1),Pt([T.trace("DyteSelf.updateVideoConstraints")],st.prototype,"updateVideoConstraints",1),Pt([T.trace("DyteSelf.enableScreenShare"),Ir.executeWithLock({methodName:"meeting.self.enableScreenShare",lockName:"DyteSelf.toggleScreenShare",timeout:3e3})],st.prototype,"enableScreenShare",1),Pt([T.trace("DyteSelf.updateScreenshareConstraints")],st.prototype,"updateScreenshareConstraints",1),Pt([Ir.executeWithLock({methodName:"meeting.self.disableAudio",lockName:"DyteSelf.toggleAudio",timeout:3e3}),T.trace("DyteSelf.disableAudio")],st.prototype,"disableAudio",1),Pt([Ir.executeWithLock({methodName:"meeting.self.disableVideo",lockName:"DyteSelf.toggleVideo",timeout:3e3}),T.trace("DyteSelf.disableVideo")],st.prototype,"disableVideo",1),Pt([Ir.executeWithLock({methodName:"meeting.self.disableScreenShare",lockName:"DyteSelf.toggleScreenShare",timeout:3e3}),T.trace("DyteSelf.disableScreenShare")],st.prototype,"disableScreenShare",1),Pt([T.trace("DyteSelf.setDevice")],st.prototype,"setDevice",1),st=Pt([ht("1100")],st);var S1=Object.defineProperty,E1=Object.getOwnPropertyDescriptor,_1=(s,e,t,r)=>{for(var n=r>1?void 0:r?E1(e,t):e,i=s.length-1,a;i>=0;i--)(a=s[i])&&(n=(r?a(e,t,n):a(n))||n);return r&&n&&S1(e,t,n),n};let Cn;const bv=(yy=class{constructor(s,e){m(this,"socket");g(this,Fo,void 0);v(this,Fo,e),this.socket=s,this.handleSocketEvents()}static create(s,e){return Cn||(Cn=new bv(s,e)),Cn}static cleanup(){var s;try{(s=Cn==null?void 0:Cn.socket)==null||s.disconnect()}catch(e){u.error("roomSocketHandler::cleanup")}Cn=void 0}async joinRoom(s){var r;this.socket.joinAttempted=!0;const e={capabilities:[],peer:{displayName:(r=s.name)!=null?r:"Participant",customParticipantId:s.customParticipantId,peerId:s.id,userId:s.userId,displayPictureUrl:s.picture,waitlisted:!1},roomUuid:""},t=this.socket.sendMessagePromise(U.joinRoom,II.toBinary(e));try{const{peer:n}=Si.fromBinary((await t).payload);o(this,Fo).getValue("connectionHandler").socketJoined=!0,R.emit(k.SOCKET_SERVICE_ROOM_JOINED,{peer:n});const i=this.getRoomState(),a=this.getRoomPeersNonPaginated(),[{room:c},{peers:d}]=await Promise.all([i,a]);return R.emit(k.ROOM_STATE,c),R.emit(k.SOCKET_PEERS,d),{peer:n}}catch(n){throw u.error("RoomSocketHandler.joinRoom.failed",{error:n}),new P("Error: RoomSocketHandler.joinRoom failed.","0002",n)}}async getAllAddedParticipants(){try{return pA.fromBinary((await this.socket.sendMessagePromise(U.getAllAddedParticipants)).payload).participants.map(({id:e,...t})=>({...t,userId:e}))}catch(s){return[]}}async getRoomPeers(s,e,t){let r;try{const n={seachQuery:s,limit:e,offset:t},i=await this.socket.sendMessagePromise(U.getRoomPeersInfo,TI.toBinary(n));r=rh.fromBinary(i.payload)}catch(n){u.error("getRoomPeers::binary_decode_error",{error:n})}return r}async getRoomPeersNonPaginated(){let s;try{const e=await this.socket.sendMessagePromise(U.getRoomPeersInfo);s=rh.fromBinary(e.payload)}catch(e){u.error("getRoomJoinedPeers::binary_decode_error",{error:e})}return s}async getStagePeers(){let s;try{const e=await this.socket.sendMessagePromise(U.getRoomPeersInfo);s=rh.fromBinary(e.payload)}catch(e){u.error("getRoomJoinedPeers::binary_decode_error",{error:e})}return s}async getPeerInfo(s){let e;try{const t=await this.socket.sendMessagePromise(U.getPeerInfo,Ag.toBinary({peerId:s}));e=Si.fromBinary(t.payload)}catch(t){u.error("getPeerInfo::binary_decode_error",{error:t})}return e}async getRoomState(){let s=Ig.create();try{const e=await this.socket.sendMessagePromise(U.getRoomInfo);s=Ig.fromBinary(e.payload)}catch(e){u.error("getRoomState::binary_decode_error",{error:e})}return s}async getRoomStageState(){let s=Lg.create();try{const e=await this.socket.sendMessagePromise(U.getRoomStageState);s=Lg.fromBinary(e.payload)}catch(e){u.error("getRoomStageState::binary_decode_error",{error:e})}return s}async broadcastMessage(s,e){const t={type:s,payload:new TextEncoder().encode(JSON.stringify(e)),timestamp:Date.now(),ids:[]};return this.socket.sendMessagePromise(U.broadcastMessage,so.toBinary(t))}async broadcastToMeetings(s,e,t){const r={type:s,payload:new TextEncoder().encode(JSON.stringify(t)),timestamp:Date.now(),ids:e,broadcastType:1};return this.socket.sendMessagePromise(U.broadcastToEntity,so.toBinary(r))}async broadcastToPeers(s,e,t){const r={type:s,payload:new TextEncoder().encode(JSON.stringify(t)),timestamp:Date.now(),ids:e,broadcastType:0};return this.socket.sendMessage(U.broadcastToEntity,so.toBinary(r))}async leaveRoom(){this.socket.joinAttempted=!1,this.socket.sendMessagePromise(U.leaveRoom,MI.toBinary({}))}async kick(s){const e={peerIds:[s]};this.socket.sendMessage(U.kick,vA.toBinary(e))}async kickAll(s=!1){const e={propagateKickAcrossRooms:s};this.socket.sendMessage(U.kickAll,Tg.toBinary(e))}getWaitingRoomRequests(){this.socket.sendMessage(U.getWaitingRoomRequests)}acceptWaitingRoomRequest(s){const e={userIds:s};this.socket.sendMessage(U.acceptWaitingRoomRequests,SA.toBinary(e))}rejectWaitingRoomRequest(s){const e={userIds:s};this.socket.sendMessage(U.denyWaitingRoomRequests,_A.toBinary(e))}async updatePermissions(s,e){const t={updatePeersPresets:[]};return s.forEach(r=>{t.updatePeersPresets.push({userIds:r,patch:e})}),this.socket.sendMessagePromise(Rd.updateUserPreset,QA.toBinary(t))}handleSocketEvents(){this.socket.on(U.broadcastMessage,({payload:s})=>{try{const e=so.fromBinary(s);R.emit(k.ROOM_MESSAGE,{payload:JSON.parse(new TextDecoder().decode(e.payload)),type:e.type,timestamp:e.timestamp})}catch(e){u.error("failed to decode broadcast message:",e)}}),this.socket.on(U.broadcastToEntity,({payload:s})=>{try{const e=so.fromBinary(s);R.emit(k.MESSAGE,{payload:JSON.parse(new TextDecoder().decode(e.payload)),type:e.type,timestamp:e.timestamp})}catch(e){u.error("failed to decode peer broadcast message:",e)}})}on(s,e){let t,r;switch(s){case U.joinRoom:case U.leaveRoom:case U.kick:case U.kickAll:{t=Si.fromBinary.bind(Si),r=Si.create();break}case U.getWaitingRoomRequests:{t=(n,i)=>n?Ng.fromBinary(n,i):{requests:[]},r=Ng.create();break}case U.recordingPaused:case U.recordingStarted:case U.recordingStopped:{t=Jg.fromBinary.bind(Jg);break}case Rd.updateUserPreset:{t=Vg.fromBinary.bind(Vg);break}case ys.peerJoinedBroadcast:case es.peerJoinedBroadcast:{t=_g.fromBinary.bind(_g);break}case ys.selfJoinComplete:case es.selfJoinComplete:{t=Xu.fromBinary.bind(Xu);break}case ys.globalPeerPinBroadcast:case es.globalPeerPinBroadcast:{t=Pg.fromBinary.bind(Pg);break}case ys.selectedPeer:case es.selectedPeer:{t=Qu.fromBinary.bind(Qu);break}case ys.selectedPeerDiff:case es.selectedPeerDiff:{t=Eg.fromBinary.bind(Eg);break}case ys.leaveRoom:case es.leaveRoom:{t=Zu.fromBinary.bind(Zu);break}}this.socket.on(s,({payload:n})=>{let i=r;if(!t)return e(void 0);try{i=t(n)}catch(a){u.error("roomSocketHandler::on::binary_decode_error",{error:a})}return e(i)})}async getUserPermissions(s){const e={userIds:[s]};try{const t=await this.socket.sendMessagePromise(Rd.getUserPresets,jA.toBinary(e)),r=KA.fromBinary(t.payload).peerPresets[0],n=new TextDecoder().decode(r.preset),i=JSON.parse(n).permissions;return{chat:i.chat,polls:i.polls,plugins:i.plugins}}catch(t){throw u.error("Error in getting user preset",{error:t}),t}}},Fo=new WeakMap,yy);let Fd=bv;_1([T.trace("RoomSocketHandler.joinRoom")],Fd.prototype,"joinRoom",1);var Rn={},Bd={};Object.defineProperty(Bd,"__esModule",{value:!0}),Bd.Logger=void 0;class b1{constructor(e){}debug(){}warn(){}error(){}}Bd.Logger=b1,Object.defineProperty(Rn,"__esModule",{value:!0});var $d=Rn.AwaitQueue=Rn.AwaitQueueRemovedTaskError=Rn.AwaitQueueStoppedError=void 0;const w1=Bd,Ar=new w1.Logger;class Dh extends Error{constructor(e){super(e!=null?e:"AwaitQueue stopped"),this.name="AwaitQueueStoppedError",typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,Dh)}}Rn.AwaitQueueStoppedError=Dh;class Hd extends Error{constructor(e){super(e!=null?e:"AwaitQueue task removed"),this.name="AwaitQueueRemovedTaskError",typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,Hd)}}Rn.AwaitQueueRemovedTaskError=Hd;class P1{constructor(){this.pendingTasks=new Map,this.nextTaskId=0,this.stopping=!1}get size(){return this.pendingTasks.size}async push(e,t){if(t=t!=null?t:e.name,Ar.debug(`push() [name:${t}]`),typeof e!="function")throw new TypeError("given task is not a function");if(t)try{Object.defineProperty(e,"name",{value:t})}catch(r){}return new Promise((r,n)=>{const i={id:this.nextTaskId++,task:e,name:t,enqueuedAt:Date.now(),executedAt:void 0,completed:!1,resolve:a=>{if(i.completed)return;i.completed=!0,this.pendingTasks.delete(i.id),Ar.debug(`resolving task [name:${i.name}]`),r(a);const[c]=this.pendingTasks.values();c&&!c.executedAt&&this.execute(c)},reject:a=>{if(!i.completed&&(i.completed=!0,this.pendingTasks.delete(i.id),Ar.debug(`rejecting task [name:${i.name}]: %s`,String(a)),n(a),!this.stopping)){const[c]=this.pendingTasks.values();c&&!c.executedAt&&this.execute(c)}}};this.pendingTasks.set(i.id,i),this.pendingTasks.size===1&&this.execute(i)})}stop(){Ar.debug("stop()"),this.stopping=!0;for(const e of this.pendingTasks.values())Ar.debug(`stop() | stopping task [name:${e.name}]`);this.stopping=!1}remove(e){Ar.debug(`remove() [taskIdx:${e}]`);const t=Array.from(this.pendingTasks.values())[e];if(!t){Ar.debug(`stop() | no task with given idx [taskIdx:${e}]`);return}t.reject(new Hd)}dump(){const e=Date.now();let t=0;return Array.from(this.pendingTasks.values()).map(r=>({idx:t++,task:r.task,name:r.name,enqueuedTime:r.executedAt?r.executedAt-r.enqueuedAt:e-r.enqueuedAt,executionTime:r.executedAt?e-r.executedAt:0}))}async execute(e){if(Ar.debug(`execute() [name:${e.name}]`),e.executedAt)throw new Error("task already being executed");e.executedAt=Date.now();try{const t=await e.task();e.resolve(t)}catch(t){e.reject(t)}}}$d=Rn.AwaitQueue=P1;function C1(s,e){const t=new Error(e);return t.name=s,t}class uo extends P{constructor(e){super(e),this.name="UnsupportedError",Error.hasOwnProperty("captureStackTrace")?Error.captureStackTrace(this,uo):this.stack=new Error(e).stack}}class Ct extends P{constructor(e){super(e),this.name="InvalidStateError",Error.hasOwnProperty("captureStackTrace")?Error.captureStackTrace(this,Ct):this.stack=new Error(e).stack}}class Ii extends P{constructor(e){super(e),this.name="TransportConnectionError",Error.hasOwnProperty("captureStackTrace")?Error.captureStackTrace(this,Ct):this.stack=new Error(e).stack}}class R1 extends P{constructor(e){super(e),this.name="DataChannelRequestError",Error.hasOwnProperty("captureStackTrace")?Error.captureStackTrace(this,Ct):this.stack=new Error(e).stack}}const wv=s=>new Promise(e=>setTimeout(e,s));async function Oh(s,e){return new Promise(async(t,r)=>{const{strategy:n,maxRetryCount:i,delayTime:a}={strategy:"linear",maxRetryCount:3,delayTime:10,...e};let c=0,d,l=!1;const h=p=>{l=!0,r(p)};for(;c<i;){try{const p=await s(c,h);return t(p)}catch(p){if(d=p,l)break;if(c<i)n==="linear"?await wv(a*(c+1)):n==="exponential"&&await wv(a*(c+Math.max(0,c-1)));else break}c+=1}return r(d)})}function k1(s){return s.map(e=>({channels:e.channels,clockRate:e.clockRate,mimeType:e.mimeType,sdpFmtpLine:e.sdpFmtpLine}))}function I1(s){return s.map(e=>({uri:e.uri}))}function qd(s){return{codecs:k1(s.codecs),headerExtensions:I1(s.headerExtensions)}}function A1(s){const e=RTCRtpReceiver.getCapabilities("audio"),t=RTCRtpReceiver.getCapabilities("video"),r=RTCRtpSender.getCapabilities("audio"),n=RTCRtpSender.getCapabilities("video");s&&(t.codecs=t.codecs.filter(({mimeType:d})=>s===d),n.codecs=n.codecs.filter(({mimeType:d})=>s===d));const i={audio:qd(e),video:qd(t)};return{sender:{audio:qd(r),video:qd(n)},receiver:i}}class M1{constructor(e,t){g(this,ot,void 0);m(this,"events");m(this,"sfuType");v(this,ot,e),this.sfuType=t,this.events=t===ft.CF?ys:es}async joinRoom(e,t,r,n=!1,i=null){const a={roomUuid:e,displayName:t,prejoined:n,capabilities:r};return i&&(a.location=i),(await o(this,ot).sendMessagePromiseWithTimeout({event:this.events.joinRoom,protobuf:MR.toBinary(a),timeout:5e3})).payload}async connectTransport(e){const t=(await o(this,ot).sendMessagePromise(this.events.createWebRTCTransport,aR.toBinary(e))).payload,{transportId:r,description:n,producerIds:i}=mg.fromBinary(t),a={sdp:n==null?void 0:n.sdp,type:n.type};return{transportId:r,answer:a,producerIds:i}}async produce(e){var i,a;const t=(await o(this,ot).sendMessagePromise(this.events.produce,HR.toBinary(e))).payload,r=Pk.fromBinary(t);return{answer:{sdp:(i=r==null?void 0:r.description)==null?void 0:i.sdp,type:(a=r==null?void 0:r.description)==null?void 0:a.type},producerId:r.producerId}}async consume(e){if(this.sfuType===ft.HIVE)throw new Error("Hive does not support socket consumer operations");const t=(await o(this,ot).sendMessagePromise(this.events.consume,BR.toBinary(e))).payload,{consumerIdsMap:{map:r},description:n}=bk.fromBinary(t);return{consumerStateMap:r,sessionDescription:n}}async closeProducer(e){const t=(await o(this,ot).sendMessagePromise(this.events.closeProducer,zR.toBinary(e))).payload,{description:r}=Dk.fromBinary(t);return r}async closeConsumer(e){if(this.sfuType===ft.HIVE)throw new Error("Hive does not support socket consumer operations");return(await o(this,ot).sendMessagePromise(this.events.closeConsumer,QR.toBinary(e))).payload}async hostControlForPeer(e,t){const r={audio:t==="audio",screeShare:!1,video:t==="video",participantId:e},n=(await o(this,ot).sendMessagePromise(this.events.hostControlPeer,nk.toBinary(r))).payload;if(!n)return!1;const{status:i}=Bk.fromBinary(n);return i==="success"}async hostControlForAll(e){const t={audio:e==="audio",screenShare:!1,video:e==="video"},r=(await o(this,ot).sendMessagePromise(this.events.hostControlAllPeers,ak.toBinary(t))).payload;if(!r)return!1;const{status:n}=Hk.fromBinary(r);return n==="success"}async kickAll(){const e={propagateKickAcrossRooms:!1},t=(await o(this,ot).sendMessagePromise(this.events.kickAll,Tg.toBinary(e))).payload;if(!t)return!1;const{status:r}=Uk.fromBinary(t);return r==="success"}async kickPeer(e){const t=(await o(this,ot).sendMessagePromise(this.events.kickPeer,ZR.toBinary(e))).payload;if(!t)return!1;const{status:r}=xk.fromBinary(t);return r==="success"}async changeDisplayName(e){const t=(await o(this,ot).sendMessagePromise(this.events.changeDisplayName,sk.toBinary(e))).payload;if(!t)return!1;const{status:r}=jk.fromBinary(t);return r==="success"}async notifySelfJoinComplete(){const e={},t=(await o(this,ot).sendMessagePromise(this.events.selfJoinComplete,OR.toBinary(e))).payload;return Xu.fromBinary(t)}async audioActivity(e){o(this,ot).sendMessage(this.events.audioActivity,cR.toBinary(e))}}ot=new WeakMap;class ho extends re.EventEmitter{constructor(){super(),this.setMaxListeners(1/0)}safeEmit(e,...t){const r=this.listenerCount(e);try{return this.emit(e,...t)}catch(n){return u.error(`EnhancedEventEmitter:: safeEmit() | event listener ${e} threw an error`,{error:n}),Boolean(r)}}async safeEmitAsPromise(e,...t){const r={}.EVENT_PROMISE_TIMEOUT?parseInt({}.EVENT_PROMISE_TIMEOUT,10):1e4;return this.safeEmitAsPromiseWithTimeout(e,r,...t)}async safeEmitAsPromiseWithTimeout(e,t,...r){return new Promise((n,i)=>{setTimeout(i,t,"event request timeout");try{this.emit(e.toString(),...r,n,i)}catch(a){u.error(`EnhancedEventEmitter:: safeEmitAsPromise() | event listener for event ${e.toString()} threw an error [event:%s]:%o`,{error:a}),i(a)}})}}class Nh extends ho{constructor(){super();m(this,"_sendWebStream",new MediaStream);m(this,"_sendScreenShareStream",new MediaStream);m(this,"_direction");m(this,"pc");m(this,"_transportReady",!1);m(this,"_mapMidTransceiver",new Map);m(this,"_enableHighBitrate",!1);m(this,"_enableStereo",!1);this._mapMidTransceiver=new Map,this._enableHighBitrate=!1}get midTransceiverMap(){return this._mapMidTransceiver}close(){if(u.debug(`${this.name}::close()`),this.pc)try{this.pc.close()}catch(t){u.error(`${this.name}::pc.close()`,{error:t})}}async restartIce(){u.debug(`${this.name}::restartIce()`);const t=await this.pc.createOffer({iceRestart:!0});return u.debug(`${this.name}::restartIce() | calling pc.setLocalDescription() [offer:${JSON.stringify(t)}]`),{offerSdp:t,callback:async n=>{u.info(`${this.name}::restartIce() | calling pc.setRemoteDescription() [answer:${JSON.stringify(n)}]`),await this.pc.setRemoteDescription(n)}}}init({direction:t,iceServers:r,iceTransportPolicy:n,additionalSettings:i,proprietaryConstraints:a,onTrackHandler:c}){u.debug("HandlerInterface::init()"),this._direction=t,this.pc=new RTCPeerConnection({iceServers:r||[],iceTransportPolicy:n||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",...i},a),c&&this.pc.addEventListener("track",d=>{c(d)}),this._addEventListeners()}async connect(){const t=this.pc.createDataChannel("dyte"),r=await this.pc.createOffer();return await this.pc.setLocalDescription(r),u.info(`connect offer: ${JSON.stringify(r)}`),{offerSdp:r,callback:async i=>{u.debug(`${this.name}::connect() | calling pc.setRemoteDescription() [answer:${JSON.stringify(i)}]`),await this.pc.setRemoteDescription(i),t.close()}}}async getTransportStats(){return this.pc.getStats()}_assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}_assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}async getReceiverStats(t){this._assertRecvDirection();const r=this.midTransceiverMap.get(t);if(!r)throw new Error("associated RTCRtpTransceiver not found");return r.receiver.getStats()}async stopSending(t){this._assertSendDirection(),u.debug(`stopSending() [localId:${t}]`);const r=this.midTransceiverMap.get(t);if(!r)throw new Error("associated RTCRtpTransceiver not found");r.sender.replaceTrack(null),this.pc.removeTrack(r.sender),r.direction="inactive";const n=await this.pc.createOffer();return u.debug(`stopSending() | calling pc.setLocalDescription() [offer:${JSON.stringify(n)}]`),await this.pc.setLocalDescription(n),{offerSdp:n,callback:async a=>{u.debug(`stopSending() | calling pc.setRemoteDescription() [answer:${JSON.stringify(a)}]`),await this.pc.setRemoteDescription(a),this.midTransceiverMap.delete(t)}}}async replaceTrack(t,r){this._assertSendDirection(),r?u.debug(`replaceTrack() [localId:${t}, track.id:${r.id}]`):u.debug(`replaceTrack() [localId:${t}, no track]`);const n=this.midTransceiverMap.get(t);if(!n)throw new Error("associated RTCRtpTransceiver not found");await n.sender.replaceTrack(r)}async setMaxSpatialLayer(t,r){this._assertSendDirection(),u.debug(`setMaxSpatialLayer() [localId:${t}, spatialLayer:${r}]`);const n=this.midTransceiverMap.get(t);if(!n)throw new Error("associated RTCRtpTransceiver not found");const i=n.sender.getParameters();i.encodings.forEach((a,c)=>{c<=r?a.active=!0:a.active=!1}),await n.sender.setParameters(i)}async setRtpEncodingParameters(t,r){this._assertSendDirection(),u.debug(`setRtpEncodingParameters() [localId:${t}, params:${JSON.stringify(r)}]`);const n=this.midTransceiverMap.get(t);if(!n)throw new Error("associated RTCRtpTransceiver not found");const i=n.sender.getParameters();i.encodings.forEach((a,c)=>{i.encodings[c]={...a,...r}}),await n.sender.setParameters(i)}getSenderStats(t){this._assertSendDirection();const r=this.midTransceiverMap.get(t);if(!r)throw new Error("associated RTCRtpTransceiver not found");return r.sender.getStats()}_addEventListeners(){this.pc.addEventListener("icecandidate",t=>{t.candidate&&this.emit("@icecandidate",{candidate:t.candidate})}),this.pc.addEventListener("iceconnectionstatechange",()=>{switch(this.pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected"),this._transportReady=!0;break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed");break;default:u.warn("unknown state");break}}),this.pc.addEventListener("negotiationneeded",()=>{this.emit("@negotiationneeded",{}),u.debug("negotiationneeded")}),this.pc.addEventListener("icegatheringstatechange",()=>{switch(this.pc.iceGatheringState){case"gathering":u.debug("icegatheringstatechange | gathering"),this.emit("@icegatheringstatechange","gathering");break;case"complete":u.debug("icegatheringstatechange | complete"),this.emit("@icegatheringstatechange","complete");break;default:u.warn("unknown state");break}}),this.pc.addEventListener("icecandidateerror",t=>{u.warn("icecandidateerror",{error:{code:t.errorCode,message:t.errorText}})}),this.pc.addEventListener("datachannel",t=>{u.info("data channel created: ",{rtcChannel:{label:t.channel.label}});const{channel:r}=t;r.onopen=()=>{u.info("data channel open: ",{rtcChannel:{label:t.channel.label}}),this.safeEmit("dc_open",t.channel)},r.onclose=()=>{u.warn("data channel closed: ",{rtcChannel:{label:t.channel.label}})},r.onerror=()=>{u.error("data channel error: ",{rtcChannel:{label:t.channel.label}})}}),this.addCustomEventListeners()}addCustomEventListeners(){}}class Lh extends Nh{static createFactory(){return()=>new Lh}get name(){return"Chrome74"}init({direction:e,iceServers:t,iceTransportPolicy:r,additionalSettings:n,proprietaryConstraints:i,onTrackHandler:a}){this._direction=e,this.pc=new RTCPeerConnection({iceServers:t||[],iceTransportPolicy:r||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan",...n},i),a&&this.pc.addEventListener("track",c=>{a(c)}),this._addEventListeners()}async send({track:e,encodings:t,codecOptions:r,screenShare:n}){this._assertSendDirection();const i=this.pc.addTransceiver(e,{direction:"sendonly",streams:[n?this._sendScreenShareStream:this._sendWebStream],sendEncodings:t});if(!navigator.isReactNative){u.debug("creating new transceiver");const d=RTCRtpSender.getCapabilities(typeof e=="string"?e:e.kind);u.info(`senders available params: ${JSON.stringify(d)}`);const l=[];r&&r.length&&r.forEach(h=>{var f;const p=d.codecs.find(y=>y.mimeType.includes(h.name));if(h.parameters){u.debug(`codecOption.parameters:${JSON.stringify(h.parameters)}`);const y=((f=p.sdpFmtpLine)==null?void 0:f.split(";"))||[];y.push(...h.parameters);const _=Array.from(new Set(y).values());p.sdpFmtpLine=_.join(";")}l.push(p)}),u.info(`selected codecs: ${JSON.stringify(l)}`),i.setCodecPreferences(l)}const a=await this.pc.createOffer();if(await this.pc.setLocalDescription(a),r&&r.findIndex(({name:d})=>d==="opus")>=0){const d=this._enableStereo,l=this._enableHighBitrate?d?128e3:64e3:d?64e3:32e3;a.sdp=a.sdp.replace("minptime=10;useinbandfec=1",`minptime=10;useinbandfec=1;usedtx=1${d?"":";stereo=1;sprop-stereo=1"};maxaveragebitrate=${l}`),a.sdp+=`a=rtcp-fb:111 nack\r
`}this.midTransceiverMap.set(i.mid,i);const c=async d=>(u.debug(`send() | calling pc.setRemoteDescription() [answer:${JSON.stringify(d)}]`),await this.pc.setRemoteDescription(d),i.mid);return u.debug(`send() | calling pc.setLocalDescription() [offer: ${JSON.stringify(a,void 0,2)}]`),{offerSdp:a,callback:c,sender:i.sender,mid:i.mid}}addCustomEventListeners(){this.pc.addEventListener("datachannel",e=>{const{channel:t}=e;t.onmessage=r=>{this.safeEmit("datachannel",e.channel,String.fromCharCode(...new Uint8Array(r.data)))}})}}var Pv={},jd={},D1={get exports(){return jd},set exports(s){jd=s}},Cv=D1.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(s){return s.encoding?"rtpmap:%d %s/%s/%s":s.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(s){return s.address!=null?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(s){return s.subtype!=null?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(s){return"extmap:%d"+(s.direction?"/%s":"%v")+(s["encrypt-uri"]?" %s":"%v")+" %s"+(s.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(s){return s.sessionConfig!=null?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(s){var e="candidate:%s %d %s %d %s %d typ %s";return e+=s.raddr!=null?" raddr %s rport %d":"%v%v",e+=s.tcptype!=null?" tcptype %s":"%v",s.generation!=null&&(e+=" generation %d"),e+=s["network-id"]!=null?" network-id %d":"%v",e+=s["network-cost"]!=null?" network-cost %d":"%v",e}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(s){var e="ssrc:%d";return s.attribute!=null&&(e+=" %s",s.value!=null&&(e+=":%s")),e}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(s){return s.maxMessageSize!=null?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(s){return s.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(s){return"imageattr:%s %s %s"+(s.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(s){return"simulcast:%s %s"+(s.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(s){return"ts-refclk:%s"+(s.clksrcExt!=null?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(s){var e="mediaclk:";return e+=s.id!=null?"id=%s %s":"%v%s",e+=s.mediaClockValue!=null?"=%s":"",e+=s.rateNumerator!=null?" rate=%s":"",e+=s.rateDenominator!=null?"/%s":"",e}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};Object.keys(Cv).forEach(function(s){var e=Cv[s];e.forEach(function(t){t.reg||(t.reg=/(.*)/),t.format||(t.format="%s")})}),function(s){var e=function(c){return String(Number(c))===c?Number(c):c},t=function(c,d,l,h){if(h&&!l)d[h]=e(c[1]);else for(var p=0;p<l.length;p+=1)c[p+1]!=null&&(d[l[p]]=e(c[p+1]))},r=function(c,d,l){var h=c.name&&c.names;c.push&&!d[c.push]?d[c.push]=[]:h&&!d[c.name]&&(d[c.name]={});var p=c.push?{}:h?d[c.name]:d;t(l.match(c.reg),p,c.names,c.name),c.push&&d[c.push].push(p)},n=jd,i=RegExp.prototype.test.bind(/^([a-z])=(.*)/);s.parse=function(c){var d={},l=[],h=d;return c.split(/(\r\n|\r|\n)/).filter(i).forEach(function(p){var f=p[0],y=p.slice(2);f==="m"&&(l.push({rtp:[],fmtp:[]}),h=l[l.length-1]);for(var _=0;_<(n[f]||[]).length;_+=1){var b=n[f][_];if(b.reg.test(y))return r(b,h,y)}}),d.media=l,d};var a=function(c,d){var l=d.split(/=(.+)/,2);return l.length===2?c[l[0]]=e(l[1]):l.length===1&&d.length>1&&(c[l[0]]=void 0),c};s.parseParams=function(c){return c.split(/;\s?/).reduce(a,{})},s.parseFmtpConfig=s.parseParams,s.parsePayloads=function(c){return c.toString().split(" ").map(Number)},s.parseRemoteCandidates=function(c){for(var d=[],l=c.split(" ").map(e),h=0;h<l.length;h+=3)d.push({component:l[h],ip:l[h+1],port:l[h+2]});return d},s.parseImageAttributes=function(c){return c.split(" ").map(function(d){return d.substring(1,d.length-1).split(",").reduce(a,{})})},s.parseSimulcastStreamList=function(c){return c.split(";").map(function(d){return d.split(",").map(function(l){var h,p=!1;return l[0]!=="~"?h=e(l):(h=e(l.substring(1,l.length)),p=!0),{scid:h,paused:p}})})}}(Pv);var xh=jd,O1=/%[sdv%]/g,N1=function(s){var e=1,t=arguments,r=t.length;return s.replace(O1,function(n){if(e>=r)return n;var i=t[e];switch(e+=1,n){case"%%":return"%";case"%s":return String(i);case"%d":return Number(i);case"%v":return""}})},po=function(s,e,t){var r=e.format instanceof Function?e.format(e.push?t:t[e.name]):e.format,n=[s+"="+r];if(e.names)for(var i=0;i<e.names.length;i+=1){var a=e.names[i];e.name?n.push(t[e.name][a]):n.push(t[e.names[i]])}else n.push(t[e.name]);return N1.apply(null,n)},L1=["v","o","s","i","u","e","p","c","b","t","r","z","a"],x1=["i","c","b","a"],V1=function(s,e){e=e||{},s.version==null&&(s.version=0),s.name==null&&(s.name=" "),s.media.forEach(function(i){i.payloads==null&&(i.payloads="")});var t=e.outerOrder||L1,r=e.innerOrder||x1,n=[];return t.forEach(function(i){xh[i].forEach(function(a){a.name in s&&s[a.name]!=null?n.push(po(i,a,s)):a.push in s&&s[a.push]!=null&&s[a.push].forEach(function(c){n.push(po(i,a,c))})})}),s.media.forEach(function(i){n.push(po("m",xh.m[0],i)),r.forEach(function(a){xh[a].forEach(function(c){c.name in i&&i[c.name]!=null?n.push(po(a,c,i)):c.push in i&&i[c.push]!=null&&i[c.push].forEach(function(d){n.push(po(a,c,d))})})})}),n.join(`\r
`)+`\r
`},kn=Pv,U1=V1,Rv=U1,Vh=kn.parse;kn.parseParams,kn.parseFmtpConfig,kn.parsePayloads,kn.parseRemoteCandidates,kn.parseImageAttributes,kn.parseSimulcastStreamList;class Gd extends Nh{constructor(t){super();m(this,"supportsSendEncodings",!1);this.supportsSendEncodings=t.supportsSendEncodings}static createFactory(t){return()=>new Gd(t)}get name(){return"Firefox60"}async send({track:t,encodings:r,codecOptions:n,screenShare:i}){this._assertSendDirection();const a=this.supportsSendEncodings&&r!==void 0?{sendEncodings:r}:{},c=this.pc.addTransceiver(t,{direction:"sendonly",streams:[i?this._sendScreenShareStream:this._sendWebStream],...a});if(!this.supportsSendEncodings&&r){r.reverse();const p=c.sender.getParameters();p.encodings=r,await c.sender.setParameters(p)}const d=(p,f)=>{var H;const y=Vh(p),_=y.media[y.media.length-1],b=_.rtp.filter(M=>f.some(z=>z.name===M.codec)),I=_.fmtp.filter(M=>b.some(z=>z.payload===M.payload)),x=(H=_.rtcpFb)==null?void 0:H.filter(M=>b.some(z=>z.payload===M.payload)),B=b.map(M=>M.payload);return y.media[y.media.length-1].rtp=b,y.media[y.media.length-1].fmtp=I,y.media[y.media.length-1].rtcpFb=x,y.media[y.media.length-1].payloads=B.join(" "),Rv(y)},l=await this.pc.createOffer();if(l.sdp=d(l.sdp,n),u.debug(`send() | calling pc.setLocalDescription() [offer:${JSON.stringify(l)}]`),await this.pc.setLocalDescription(l),t==="audio"||t.kind==="audio"){const p=this._enableStereo,f=this._enableHighBitrate?p?128e3:64e3:p?64e3:32e3;l.sdp=l.sdp.replace("minptime=10;useinbandfec=1",`minptime=10;useinbandfec=1;usedtx=1${this.supportsSendEncodings?"":`${p?"":";stereo=1;sprop-stereo=1"};maxaveragebitrate=${f}`}`)}return this.midTransceiverMap.set(c.mid,c),{offerSdp:l,callback:async p=>(u.debug(`send() | calling pc.setRemoteDescription() [answer:${JSON.stringify(p)}]`),await this.pc.setRemoteDescription(p),c.mid),sender:c.sender,mid:c.mid}}async setMaxSpatialLayer(t,r){this._assertSendDirection(),u.debug(`setMaxSpatialLayer() [localId:${t}, spatialLayer:${r}]`);const n=this.midTransceiverMap.get(t);if(!n)throw new Error("associated RTCRtpTransceiver not found");const i=n.sender.getParameters(),a=i.encodings.length-1-r;i.encodings.forEach((c,d)=>{d>=a?c.active=!0:c.active=!1}),await n.sender.setParameters(i)}addCustomEventListeners(){this.pc.addEventListener("datachannel",t=>{const{channel:r}=t;r.onmessage=async n=>{const i=await n.data.arrayBuffer();this.safeEmit("datachannel",t.channel,String.fromCharCode(...new Uint8Array(i)))}})}}class Uh extends Nh{static createFactory(){return()=>new Uh}get name(){return"Chrome74"}async send({track:e,encodings:t,codecOptions:r,screenShare:n}){this._assertSendDirection(),u.debug("Safari12::creating new transceiver");const i=this.pc.addTransceiver(e,{direction:"sendonly",streams:[n?this._sendScreenShareStream:this._sendWebStream],sendEncodings:t}),a=RTCRtpSender.getCapabilities(typeof e=="string"?e:e.kind);u.info(`Safari12::senders available params: ${JSON.stringify(a)}`);const c=[];r&&r.length>0&&r.forEach(h=>{var f;const p=a.codecs.find(y=>y.mimeType.includes(h.name));if(h.parameters){u.info(`Safari12::codecOption.parameters:, ${JSON.stringify(h.parameters)}`);const y=((f=p.sdpFmtpLine)==null?void 0:f.split(";"))||[];y.push(...h.parameters);const _=[...new Set(y).values()];p.sdpFmtpLine=_.join(";")}c.push(p)}),u.info(`Safari12::selected codecs: ${JSON.stringify(c)}`),i.setCodecPreferences(c);const d=await this.pc.createOffer();if(await this.pc.setLocalDescription(d),e==="audio"||e.kind==="audio"){const h=this._enableStereo,p=this._enableHighBitrate?h?128e3:64e3:h?64e3:32e3;d.sdp=d.sdp.replace("minptime=10;useinbandfec=1",`minptime=10;useinbandfec=1;usedtx=1${h?"":";stereo=1;sprop-stereo=1"};maxaveragebitrate=${p}`)}return this.midTransceiverMap.set(i.mid,i),{offerSdp:d,callback:async h=>(u.debug(`Safari12::send() | calling pc.setRemoteDescription() [answer:${JSON.stringify(h)}]`),await this.pc.setRemoteDescription(h),i.mid),sender:i.sender,mid:i.mid}}addCustomEventListeners(){this.pc.ondatachannel=e=>{const{channel:t}=e;t.onmessage=async r=>{const n=String.fromCharCode(...new Uint8Array(r.data));this.safeEmit("datachannel",e.channel,n)}}}}function F1(s,e){return typeof s=="undefined"?e:typeof window!="undefined"&&Object.getOwnPropertyDescriptor(window,"structuredClone")?structuredClone(s):JSON.parse(JSON.stringify(s))}class B1 extends ho{constructor(t){var r,n;super();g(this,Hs);g(this,$o);g(this,Tl);g(this,Sl);m(this,"rtpReceiver");m(this,"id");m(this,"localId");m(this,"producerId");m(this,"producingTransportId");m(this,"mimeType");m(this,"track");m(this,"peerId");m(this,"appData");m(this,"transceiver");m(this,"closeTranscieverOnClose");g(this,Bo,void 0);g(this,Kn,void 0);g(this,$s,void 0);this.id=t.id,this.localId=t.localId,v(this,Bo,t.handler),this.appData=t.appData,this.peerId=t.producingPeerId,this.producingTransportId=t.producingTransportId,v(this,$s,!1),this.producerId=t.producerId,this.track=t.track,v(this,Kn,(r=t.paused)!=null?r:!1),this.mimeType=t.mimeType,this.transceiver=t.transceiver,this.closeTranscieverOnClose=(n=t.closeTranscieverOnClose)!=null?n:!1,this.rtpReceiver=t.rtpReceiver,$(this,Tl,Cy).call(this)}get closed(){return o(this,$s)}get kind(){return this.track.kind}get paused(){return o(this,Kn)}close(t){o(this,$s)||(u.debug(`Consumer::close() ${t?`with reason ${t}`:""}`,o(this,Hs,dn)),v(this,$s,!0),this.closeTranscieverOnClose&&($(this,Sl,Ry).call(this),this.transceiver.stop()),this.safeEmit("close",t))}async getStats(){if(o(this,$s))throw new Ct("closed");return o(this,Bo).getReceiverStats(this.localId)}pause(){if(u.debug("consumer::pause()",o(this,Hs,dn)),o(this,$s)){u.error("consumer::pause() | Consumer closed",o(this,Hs,dn));return}v(this,Kn,!0),this.track.enabled=!1,this.safeEmit("pause")}resume(){if(u.debug("consumer::resume()",o(this,Hs,dn)),o(this,$s)){u.error("Consumer::resume() | Consumer closed",o(this,Hs,dn));return}v(this,Kn,!1),this.track.enabled=!0,this.safeEmit("resume")}}Bo=new WeakMap,Kn=new WeakMap,$s=new WeakMap,Hs=new WeakSet,dn=function(){return{consumer:{id:this.id,appData:this.appData,peerId:this.peerId,kind:this.kind}}},$o=new WeakSet,op=function(){u.debug('Consumer::track "ended" event',o(this,Hs,dn)),this.safeEmit("trackended")},Tl=new WeakSet,Cy=function(){this.track.addEventListener("ended",$(this,$o,op).bind(this))},Sl=new WeakSet,Ry=function(){try{this.track.removeEventListener("ended",$(this,$o,op)),this.track.stop()}catch(t){u.error("Consumer::destroyTrack()",{...o(this,Hs,dn),error:t})}};class $1 extends ho{constructor(t){var r,n;super();g(this,Yt);m(this,"id");m(this,"localId");g(this,Cs,void 0);m(this,"kind");m(this,"appData");m(this,"rtpSender");g(this,va,void 0);g(this,ya,void 0);g(this,zn,void 0);g(this,ds,!1);g(this,ct,void 0);g(this,zr,void 0);g(this,Ta,void 0);this.id=t.id,this.localId=t.localId,v(this,ct,t.track),this.kind=(r=t.track)==null?void 0:r.kind,v(this,zr,t.disableTrackOnPause?!((n=t.track)!=null&&n.enabled):!1),v(this,Ta,void 0),v(this,va,t.stopTracks),v(this,ya,t.disableTrackOnPause),v(this,zn,t.zeroRtpOnPause),this.appData=t.appData||{},this._onTrackEnded=this._onTrackEnded.bind(this),v(this,Cs,t.handler),this.rtpSender=t.rtpSender,this._handleTrack()}get closed(){return o(this,ds)}get track(){return o(this,ct)}get paused(){return o(this,zr)}get maxSpatialLayer(){return o(this,Ta)}async close(t){if(o(this,ds))return;if(u.debug(`Producer::close() ${t?`with reason ${t}`:""}`,o(this,Yt,As)),v(this,ds,!0),this._destroyTrack(),t===Bh){this.safeEmit("close");return}const{offerSdp:r,callback:n}=await o(this,Cs).stopSending(this.localId),{answer:i}=await this.safeEmitAsPromise("close",{offer:r,reason:t});n(i)}async getStats(){if(o(this,ds))throw new Ct("closed");return o(this,Cs).getSenderStats(this.localId)}pause(){u.debug("Producer::pause()",o(this,Yt,As)),o(this,ds)&&u.error("Producer::pause() | Producer closed",o(this,Yt,As)),v(this,zr,!0),o(this,ct)&&o(this,ya)&&(o(this,ct).enabled=!1),o(this,zn)&&o(this,Cs).replaceTrack(this.localId,null),this.emit("pause")}resume(){if(u.debug("Producer::resume()",o(this,Yt,As)),o(this,ds)){u.error("Producer::resume() | Producer closed",o(this,Yt,As));return}v(this,zr,!1),o(this,ct)&&o(this,ya)&&(o(this,ct).enabled=!0),o(this,zn)&&o(this,Cs).replaceTrack(this.localId,o(this,ct)),this.emit("resume")}async replaceTrack({track:t}){if(u.debug(`Producer::replaceTrack() trackId: ${t==null?void 0:t.id}`,o(this,Yt,As)),o(this,ds)){if(t&&o(this,va))try{t.stop()}catch(r){u.error("Producer::replaceTrack",{...o(this,Yt,As),error:r})}throw new Ct("closed")}else if(t&&t.readyState==="ended")throw new Ct("track ended");if(t===o(this,ct)){u.debug(`replaceTrack() | same track, ignored trackId: ${t.id}`,o(this,Yt,As));return}(!o(this,zn)||!o(this,zr))&&await o(this,Cs).replaceTrack(this.localId,t),this._destroyTrack(),v(this,ct,t),this._handleTrack()}async setMaxSpatialLayer(t){if(o(this,ds))throw new Ct("closed");if(this.kind!=="video")throw new uo("not a video Producer");if(typeof t!="number")throw new TypeError("invalid spatialLayer");await o(this,Cs).setMaxSpatialLayer(this.localId,t),v(this,Ta,t)}async setRtpEncodingParameters(t){if(o(this,ds))throw new Ct("closed");if(typeof t!="object")throw new TypeError("invalid params");await o(this,Cs).setRtpEncodingParameters(this.localId,t)}_onTrackEnded(){u.debug(`Producer::track "ended" event trackId: ${this.track.id}`,o(this,Yt,As)),this.safeEmit("trackended",this.track.id)}_handleTrack(){o(this,ct)&&o(this,ct).addEventListener("ended",this._onTrackEnded)}_destroyTrack(){var t;if(o(this,ct))try{o(this,ct).removeEventListener("ended",this._onTrackEnded),o(this,va)&&o(this,ct).stop()}catch(r){u.error(`Producer::_destroyTrack trackId: ${(t=this.track)==null?void 0:t.id}`,{...o(this,Yt,As),error:r})}}}Cs=new WeakMap,va=new WeakMap,ya=new WeakMap,zn=new WeakMap,ds=new WeakMap,ct=new WeakMap,zr=new WeakMap,Ta=new WeakMap,Yt=new WeakSet,As=function(){return{producer:{id:this.id,appData:this.appData,kind:this.kind}}};function kv(s){return typeof s=="object"&&!Array.isArray(s)&&s!==null}function Fh(s){return Math.random().toString(36).substring(2,2+s)}const Wd=1;function Iv(s){const e=s;return delete e.payload._bolt,e}function H1(s){return s.payload&&kv(s.payload)}function Av(s){var e,t;return H1(s)&&(t=(e=s.payload._bolt)==null?void 0:e.id)!=null?t:""}const Sa=class extends re.EventEmitter{constructor(t,r,n){super();m(this,"channel");m(this,"queue");m(this,"serverProtocolVersion");g(this,Yr,new Map);m(this,"respond",(t,r,n=!1)=>{let i;n?i=Sa.createErrorResponse(t,r):i=Sa.createResponse(t,r),this.channel.send(JSON.stringify(i))});m(this,"notify",t=>{const r=Sa.createNotification(t);this.channel.send(JSON.stringify(r))});m(this,"request",async t=>{const r=Sa.createRequest(t),n=new Promise((i,a)=>{const c=1e3*(5+.1*this.queue.size),{id:d}=r.payload._bolt,l={id:d,method:r.type,resolve:h=>{this.queue.delete(d)&&(clearTimeout(l.timer),i(h))},timer:setTimeout(()=>{this.queue.delete(d)&&a(new Error(`request timeout for message id: ${d}`))},c),cancel:h=>{this.queue.delete(d)&&(clearTimeout(l.timer),a(h))}};this.queue.set(d,l)});return this.channel.send(JSON.stringify(r)),n});m(this,"send",t=>{const r=JSON.stringify(t),n=16384;if(r.length>n){const i=n-200,a=Math.ceil(r.length/i),c=[];for(let l=0;l<a;l+=1){const h=l*i,p=(l+1)*i;c.push(r.slice(h,p))}const d=hi();for(let l=0;l<a;l+=1){const h=c[l],f=JSON.stringify({id:d,count:a,chunkIndex:l,chunk:h});u.debug(`Sending message chunk over dc: ${f}`),this.channel.send(f)}}else u.debug(`Sending message over dc: ${r}`),this.channel.send(r)});m(this,"processMessage",t=>{var n;o(this,Yr).has(t.id)||o(this,Yr).set(t.id,[]);const r=o(this,Yr).get(t.id);if(r[t.chunkIndex]=t,(r==null?void 0:r.length)===t.count&&!r.some(i=>i===void 0)){const i=o(this,Yr).get(t.id),a=i==null?void 0:i.reduce((d,l)=>d+l.chunk,"");o(this,Yr).delete(t.id);const c=JSON.parse(a);if(!c.payload||!kv(c.payload))throw new Error("corrupted incoming message over dc",{cause:{code:"CORRUPT_DC_MESSAGE",values:c}});if(this.processBoltHandshake(c))return;if(this.serverProtocolVersion=(n=c.payload._bolt)==null?void 0:n.version,!this.processResponseMsg(c))return c}});m(this,"processResponseMsg",t=>{const{id:r}=t.payload._bolt,n=this.queue.get(r);return n?(u.debug(`resolving pending request with id: ${r}, complete response: ${JSON.stringify(t)}`),t.type==="error"?n.cancel(Iv(t)):n.resolve(Iv(t)),!0):!1});m(this,"processBoltHandshake",t=>{var r,n;return t.type==="_bolt"||t.type==="handshake"?(this.respond((n=(r=t.payload._bolt)==null?void 0:r.id)!=null?n:Fh(8),{type:"_bolt",payload:{message:"pong"}}),!0):!1});this.label=r,this.transportId=n,this.channel=t,this.queue=new Map}};let In=Sa;Yr=new WeakMap,m(In,"createRequest",t=>{var r;if((r=t.payload)!=null&&r._bolt)throw new Error("rpc fields are internal values");return{type:t.type,payload:{...t.payload,_bolt:{id:Fh(8),type:"REQUEST",version:Wd}}}}),m(In,"createResponse",(t,r)=>{var n;if((n=r.payload)!=null&&n._bolt)throw new Error("rpc fields are internal values");return{type:r.type,payload:{...r.payload,_bolt:{id:t,type:"RESPONSE",version:Wd}}}}),m(In,"createNotification",t=>{var r;if((r=t.payload)!=null&&r._bolt)throw new Error("rpc fields are internal values");return{type:t.type,payload:{...t.payload,bolt:{id:Fh(8),type:"NOTIFY",version:Wd}}}}),m(In,"createErrorResponse",(t,r)=>({type:"error",payload:{error:r.message,_bolt:{id:t,type:"RESPONSE",version:Wd}}}));function Mv(s){if(Promise.allSettled)return Promise.allSettled(s);const e=s.map(t=>t.then(r=>({status:"fulfilled",value:r})).catch(r=>({status:"rejected",reason:r})));return Promise.all(e)}const Bh="transport closed";class q1 extends ho{constructor(t,{id:r,direction:n,handlerFactory:i,iceServers:a,iceTransportPolicy:c,proprietaryConstraints:d,additionalSettings:l,appData:h,config:p}){var y,_;super();m(this,"awaitQueue");m(this,"observer");g(this,Ea,void 0);m(this,"id");m(this,"serverId");m(this,"closed",!1);m(this,"direction");m(this,"maxSctpMessageSize");m(this,"handler");m(this,"connectionState","new");m(this,"producers");m(this,"consumers");m(this,"datachannels");m(this,"connected",!1);m(this,"eventsDCReadyPromise");m(this,"eventsDCReadyPromiseResolver");m(this,"eventsDCFailureTimer");m(this,"transportConnectionPromise");m(this,"consumerTrackEvents");m(this,"unknownTracksMap");m(this,"appData");u.debug(`constructor() [id: ${r}, direction: ${n}]`),v(this,Ea,t),this.id=r,this.direction=n;const f=F1(l,{});delete f.iceServers,delete f.iceTransportPolicy,delete f.bundlePolicy,delete f.rtcpMuxPolicy,delete f.sdpSemantics,this.producers=new Map,this.consumers=new Map,this.datachannels=new Map,this.consumerTrackEvents=new Map,this.unknownTracksMap=new Map,this.awaitQueue=new $d,this.observer=new ho,this.handler=i(),this.handler._enableHighBitrate=(y=p==null?void 0:p.enableHighBitrate)!=null?y:!1,this.handler._enableStereo=(_=p==null?void 0:p.enableStereo)!=null?_:!1,this.handler.init({onTrackHandler:this._ontrack.bind(this),direction:n,iceServers:a,iceTransportPolicy:c,additionalSettings:l,proprietaryConstraints:d}),this.appData=h||{},this.transportConnectionPromise=new Promise(b=>{this.observer.once("connected",()=>{b(!0)}),this.observer.once("disconnect",()=>{b(!1)}),this.observer.once("close",()=>{b(!1)})}),this.eventsDCReadyPromise=new Promise(b=>{this.eventsDCReadyPromiseResolver=b}),this.handler.on("@connectionstatechange",b=>{b!==this.connectionState&&(u.debug(`connection state changed to ${b}`),this.connectionState=b,b==="connected"&&(this.connected=!0,this.observer.emit("connected")),b==="disconnected"&&(this.connected=!1,this.observer.emit("disconnect")),(b==="failed"||b==="closed")&&(this.connected=!1,this.observer.emit("close")),this.closed||this.safeEmit("connectionstatechange",b))}),this.handler.on("@icecandidate",({candidate:b})=>{this.closed||this.safeEmit("icecandidate",b)}),this.handler.on("dc_open",b=>{let I=this.datachannels.get(b.label);I||(I||(I=new In(b,b.label,this.serverId),this.datachannels.set(b.label,I)),this.eventsDCFailureTimer=setTimeout(()=>{b.label==="events"&&(this.eventsDCReadyPromiseResolver(!1),this.safeEmit("dc_error",b.label))},5e3))}),this.handler.on("datachannel",(b,I)=>{b.label==="events"&&(this.eventsDCReadyPromiseResolver(!0),this.eventsDCFailureTimer&&clearTimeout(this.eventsDCFailureTimer));const x=this.datachannels.get(b.label);if(!x){u.error("unregistered datachannel for message",{rtcChannel:{label:b.label,message:I}});return}try{const B=JSON.parse(I);u.debug("datachannel message chunk recieved",{dataChannelMessageChunk:{id:B.id,count:B.count,chunkIndex:B.chunkIndex,chunk:B.chunk,transprtId:this.serverId}});const H=x.processMessage(B);if(!H)return;u.debug(`datachannel message with id:${B.id} on transport:${this.serverId}complete - ${JSON.stringify(H)}`),this.emit(`datachannel:${b.label}`,x.label,H)}catch(B){u.error("error parsing message",{error:B})}})}setServerId(t){this.serverId=t}getDatachannel(t){return this.datachannels.get(t)}get isEventsDCReady(){return this.eventsDCReadyPromise}close(){this.closed||(u.debug("Transport close called"),this.connected=!1,this.closed=!0,this.handler.close(),Array.from(this.producers.values()).forEach(t=>{t.close(Bh).catch(()=>{})}),this.producers.clear(),Array.from(this.consumers.values()).forEach(t=>{t.close(Bh)}),this.consumers.clear(),this.consumerTrackEvents.clear(),this.emit("close"),this.observer.emit("close"))}async getStats(){if(this.closed)throw new Ct("closed");return this.handler.getTransportStats()}async connect(t,r){try{const{producerIds:n}=await this.awaitQueue.push(async()=>{const{offerSdp:i,callback:a}=await this.handler.connect(),{transportId:c,answer:d,producerIds:l}=await t(i);return this.setServerId(c),await a(d),{producerIds:l}});if(n.forEach((i,a)=>{this.createProducerObject({id:i,localId:r[a].mid,track:r[a].track,stopTracks:!0,disableTrackOnPause:!0,zeroRtpOnPause:!1,appData:JSON.parse(r[a].appData||"{}"),handler:this.handler}).catch(c=>{u.error("error creating producer:",c)})}),!await this.transportConnectionPromise)throw new Error("ice connection failed");if(o(this,Ea)===ft.HIVE&&!await this.isEventsDCReady)throw new Error("events datachannel not open")}catch(n){throw u.error("transport failed to connect:",n),n}}async restartIce(){if(u.debug("restartIce()"),this.closed)throw new Ct("closed");return this.handler.restartIce()}async canProduce(t){const{track:r,appData:n}=t;if(r){if(this.direction!=="send")throw new uo("not a sending Transport");if(r.readyState==="ended")throw new Ct("track ended");if(this.listenerCount("connect")===0&&this.connectionState==="new")throw new TypeError('no "connect" listener set into this transport');if(n&&typeof n!="object")throw new TypeError("if given, appData must be an object")}else throw new TypeError("missing track");if(!await this.transportConnectionPromise)throw new Ii("transport not connected");return!0}async produce(t,r){if(!await this.canProduce(t))throw new Error("Cannot produce");const{track:i,encodings:a,codecOptions:c,stopTracks:d=!0,disableTrackOnPause:l=!0,zeroRtpOnPause:h=!1,appData:p={}}=t;u.debug(`produce() [track:${i.id}]`);const{producerId:f,localId:y,rtpSender:_}=await this.awaitQueue.push(async()=>{const{offerSdp:b,callback:I,sender:x,mid:B}=await this.handler.send({track:i,encodings:a,codecOptions:c,screenShare:p==null?void 0:p.screenShare}),{answer:H,producerId:M}=await r({offer:b,kind:i.kind,paused:l?!i.enabled:!1,appData:{...p||{},mid:B},codecOptions:c,producingTransportId:this.serverId}),z=await I(H);return{producerId:M,localId:z,rtpSender:x}},"producer");return this.createProducerObject({id:f,localId:y,track:i,stopTracks:d,disableTrackOnPause:l,zeroRtpOnPause:h,appData:p,handler:this.handler,rtpSender:_})}async precreateProducers(t){const r=[];for(const{kind:n,options:{encodings:i,codecOptions:a,track:c}}of t){const d=await this.handler.send({track:c,encodings:i,codecOptions:a});r.push({kind:n,result:d})}return r}async createProducerObject(t){const r=new $1(t);return this.producers.set(r.id,r),r.once("close",()=>{this.producers.delete(r.id)}),r}async closeProducer(t){await this.awaitQueue.push(t.close.bind(t),"producer")}async canConsume(){if(this.closed)throw new Ct("closed");if(this.direction!=="recv")throw new uo("not a receiving transport");if(this.listenerCount("connect")===0&&this.connectionState==="new")throw new TypeError('no "connect" listener set into this transport');if(!await this.transportConnectionPromise)throw new Ii("transport not connected");return!0}async consume(t,r,n){const i=[];return this.awaitQueue.push(async()=>{const{consumerStates:a,sessionDescription:c}=await r(t);return a.forEach((d,l)=>{i.push(this.createConsumerObjectAndWaitForTrack({...d,producerId:l}))}),c&&n(c),Mv(i)},"consumer")}async setRemoteOffer(t){await this.setRemoteDescription(t);const r=await this.handler.pc.createAnswer(),n=Vh(r.sdp);return n.media=n.media.map(i=>{if(i.type==="audio"){const a={...i},c=a.fmtp.find(l=>l.payload===111);return c&&(c.config+=";stereo=1;sprop-stereo=1"),a.rtcpFb||(a.rtcpFb=[]),a.rtcpFb.some(l=>l.type==="nack")||a.rtcpFb.push({payload:parseInt(a.payloads,10),type:"nack"}),a}return i}),r.sdp=Rv(n),await this.setLocalDescription(r),r}_ontrack(t){const{track:r,transceiver:n,streams:i}=t;u.info(`track event received [trackId: ${r.id}]`);let a;o(this,Ea)===ft.HIVE?a=`${i[0].id}:${r.kind}`:a=`${n.mid}:${r.kind}`,r.addEventListener("ended",()=>{u.info(`rtc consumer track ended [trackId: ${r.id}]`),this.unknownTracksMap.delete(a)});const c=this.consumerTrackEvents.get(a);c?(c(r,n),this.consumerTrackEvents.delete(a)):(u.warn(`track event handler not found ${a}`),this.unknownTracksMap.set(a,t))}sendErrorOverDC(t,r,n){const i=this.getDatachannel(t);if(!i)throw new Error("datachannel not found",{cause:{code:"DC_NOT_FOUND",values:{label:t}}});i.respond(r,n,!0)}sendResponseOverDC(t,r,n){const i=this.getDatachannel(t);if(!i)throw new Error("datachannel not found",{cause:{code:"DC_NOT_FOUND",values:{label:t}}});i.respond(r,n)}async createConsumerObjectAndWaitForTrack(t){const{consumerId:r,producerId:n,producingPeerId:i,producingTransportId:a,streamId:c,paused:d,screenShare:l,appData:h,kind:p,mimeType:f}=t,y=`${c}:${p}`,_={...t,name:"consumer creation task error",message:"consumer creation failed"};return new Promise(async(b,I)=>{const x=setTimeout(()=>{this.consumerTrackEvents.delete(y),_.isTimedout=!0,I(_)},5e3),B=(M,z)=>{try{if(M.readyState==="ended")clearTimeout(x),I(_);else{const ne=M;ne.enabled=!0,this.handler.midTransceiverMap.set(z.mid,z);const ue=new B1({id:r,localId:z.mid,transceiver:z,track:ne,paused:d,producerId:n,producingPeerId:i,producingTransportId:a,handler:this.handler,appData:{...h,screenShare:l,peerId:i},rtpReceiver:z.receiver,mimeType:f});this.consumers.set(r,ue),ue.once("close",()=>{this.consumers.delete(ue.id),this.handler.midTransceiverMap.delete(z.mid)}),u.info("consumer created for ",{consumer:{id:r,kind:p,appData:{screenShare:l},peerId:i,producerId:n}}),this.observer.emit("newconsumer",ue),clearTimeout(x),b(ue)}}catch(ne){u.warn("error while creating consumer:",ne),clearTimeout(x),I(_)}},H=this.unknownTracksMap.get(y);H?(this.unknownTracksMap.delete(y),B(H.track,H.transceiver)):this.consumerTrackEvents.set(y,B)})}async setRemoteDescription(t){await this.handler.pc.setRemoteDescription(t)}async setLocalDescription(t){u.debug(`${this.direction}() {transportId: ${this.serverId}} | calling pc.setLocalDescription() [offer:${JSON.stringify(t)}]`),await this.handler.pc.setLocalDescription(t)}async retryFailedConsumerCreationTasks(t){return Mv(t.map(async r=>Oh(async n=>(n>0&&u.warn(`retrying failed consumer creation task: ${JSON.stringify(r)}`),this.createConsumerObjectAndWaitForTrack({...r})))))}async sendDataChannelMessage(t,r){const n=this.getDatachannel(t);if(!n)throw C1("DC_NOT_READY",`${t} datachannel not ready`);const i=(await n.request(r)).payload;return u.info(`sendDataChannelMessage::response ${JSON.stringify(i)}`),i}}Ea=new WeakMap;function j1(){if(typeof navigator=="object"&&navigator.product==="ReactNative"){if(typeof RTCPeerConnection=="undefined"){u.warn("Device::this._detectDevice() | unsupported ReactNative without RTCPeerConnection");return}return u.debug("Device::this._detectDevice() | ReactNative handler chosen"),"Chrome74"}if(typeof navigator=="object"&&typeof navigator.userAgent=="string"){const s=navigator.userAgent,e=Hf.getParser(s),t=e.getEngine();if(e.satisfies({chrome:">=74",chromium:">=74","microsoft edge":">=88"}))return"Chrome74";if(e.satisfies({chrome:">=55",chromium:">=55"}))return;if(e.satisfies({firefox:">=110"}))return"Firefox110";if(e.satisfies({firefox:">=60"}))return"Firefox60";if(e.satisfies({ios:{OS:">=14.3",firefox:">=30.0"}})||e.satisfies({safari:">=12.0"})&&typeof RTCRtpTransceiver!="undefined"&&RTCRtpTransceiver.prototype.hasOwnProperty("currentDirection"))return"Safari12";if(e.satisfies({safari:">=11"})||e.satisfies({"microsoft edge":">=11"})&&e.satisfies({"microsoft edge":"<=18"}))return;if(t.name&&t.name.toLowerCase()==="blink"){const r=s.match(/(?:(?:Chrome|Chromium))[ /](\w+)/i);return r?Number(r[1])>=74?"Chrome74":void 0:"Chrome74"}if(t.name.toLowerCase()==="webkit"&&e.getOS().name.toLowerCase()==="ios")return typeof RTCRtpTransceiver!="undefined"&&RTCRtpTransceiver.prototype.hasOwnProperty("currentDirection")?"Safari12":void 0;u.warn("Device::this._detectDevice() | browser not supported");return}u.warn("Device::this._detectDevice() | unknown device")}class G1{constructor(e,{handlerName:t,handlerFactory:r}={}){m(this,"handlerFactory");g(this,Ho,void 0);if(u.debug("constructor()"),v(this,Ho,e),t&&r)throw new TypeError("just one of handlerName or handlerInterface can be given");if(r)this.handlerFactory=r;else{if(t)u.debug(`Device::constructor() | handler given: ${t}`);else if(t=j1(),t)u.debug(`Device::constructor() | detected handler: ${t}`);else throw new Error("device not supported");switch(t){case"Chrome74":this.handlerFactory=Lh.createFactory();break;case"Safari12":this.handlerFactory=Uh.createFactory();break;case"Firefox60":this.handlerFactory=Gd.createFactory({supportsSendEncodings:!1});break;case"Firefox110":this.handlerFactory=Gd.createFactory({supportsSendEncodings:!0});break;default:throw new TypeError(`unknown handlerName "${t}"`)}}}createTransport(e){const t=hi();return new q1(o(this,Ho),{id:t,...e,handlerFactory:this.handlerFactory})}}Ho=new WeakMap;const W1=2e3;class J1 extends re.EventEmitter{constructor(t,r,n){super();g(this,Ca);g(this,jo);g(this,El);g(this,_l);g(this,bl);g(this,wl);g(this,Pl);g(this,Go);g(this,Wo);g(this,hr,void 0);g(this,_a,void 0);g(this,At,void 0);g(this,Mt,void 0);g(this,Yn,void 0);g(this,ba,void 0);g(this,wa,void 0);g(this,Pa,{transportFailureCount:{send:0,recv:0},lastConnectionTime:0});g(this,Qn,void 0);g(this,Qr,"all");g(this,qo,void 0);switch(v(this,hr,t),v(this,Yn,r),v(this,qo,n),v(this,_a,new G1(n)),v(this,ba,new M1(r,n)),n){case ft.CF:{v(this,wa,ys);break}case ft.HIVE:default:{v(this,wa,es);break}}o(this,Ca,Jl).mediaState={send:{state:kr.NEW,reconnected:!1},recv:{state:kr.NEW,reconnected:!1}},ee.hasFeature(se.FORCE_RELAY)&&v(this,Qr,"relay"),$(this,jo,cp).call(this)}get socket(){return o(this,Yn)}get socketHandler(){return o(this,ba)}get sendTransport(){return o(this,At)}get recvTransport(){return o(this,Mt)}get events(){return o(this,wa)}get nodeType(){return o(this,qo)}async createTransports(t){var a,c,d,l,h,p,f,y;ee.hasFeature(se.FORCE_RELAY)&&(u.info("ICE Transport Policy set to relay"),v(this,Qr,"relay"));const n=await at().getICEServers().catch(_=>(u.warn(`failed to get iceservers from server: ${_.message}`),[])),i=[];if(t.send){const _=$(this,_l,Iy).call(this,{iceServers:n,additionalSettings:{encodedInsertableStreams:(a=o(this,hr).getValue("modules").e2ee)==null?void 0:a.enabled},config:{enableHighBitrate:(l=(d=(c=o(this,hr).getValue("defaults").mediaConfiguration)==null?void 0:c.audio)==null?void 0:d.enableHighBitrate)!=null?l:!1,enableStereo:(f=(p=(h=o(this,hr).getValue("defaults").mediaConfiguration)==null?void 0:h.audio)==null?void 0:p.enableStereo)!=null?f:!1},iceTransportPolicy:o(this,Qr)});i.push(_)}if(t.recv){const _=$(this,bl,Ay).call(this,{iceServers:n,additionalSettings:{encodedInsertableStreams:(y=o(this,hr).getValue("modules").e2ee)==null?void 0:y.enabled},iceTransportPolicy:o(this,Qr)});i.push(_)}await Promise.all(i)}stopTransports(t){var r,n,i,a;t.send&&((r=o(this,At))==null||r.close(),(n=o(this,At))==null||n.removeAllListeners(),v(this,At,void 0)),t.recv&&((i=o(this,Mt))==null||i.close(),(a=o(this,Mt))==null||a.removeAllListeners(),v(this,Mt,void 0)),$(this,jo,cp).call(this)}stopAllTransports(){u.info("Closing all transports"),this.stopTransports({send:!0,recv:!0})}async connectTransportWithRetry(t,r){const{id:n,serverId:i,direction:a}=t;$(this,wl,My).call(this,t);try{const c=ee.hasFeature(se.ENABLE_HIVE_INFINITE_RETRIES)?1/0:3;return await Oh(async(d,l)=>{d>0&&u.debug(`Retrying transport connect, count: ${d}`,{transport:{id:n,serverId:i,type:a}});try{await $(this,El,ky).call(this,t,r)}catch(h){if(h instanceof Ii){l(h);return}throw h}},{delayTime:100,strategy:"exponential",maxRetryCount:c}),t}catch(c){throw u.error(`Failed to connect send transport after retry: ${t.id}`,{error:c,transport:{id:n,serverId:i,type:a}}),t.close(),t.removeAllListeners(),this.handleErrors("rejoin"),c}}handleErrors(t){throw new Error("Method not implemented.")}}hr=new WeakMap,_a=new WeakMap,At=new WeakMap,Mt=new WeakMap,Yn=new WeakMap,ba=new WeakMap,wa=new WeakMap,Pa=new WeakMap,Qn=new WeakMap,Qr=new WeakMap,qo=new WeakMap,Ca=new WeakSet,Jl=function(){return o(this,hr).getValue("connectionHandler")},jo=new WeakSet,cp=function(){v(this,Qn,{send:void 0,recv:void 0})},El=new WeakSet,ky=async function(t,r){const{id:n,serverId:i,direction:a}=t;if(u.info(`Connecting ${a} transport`,{transport:{id:n,serverId:i,type:a}}),!o(this,Yn).isConnected)throw new Ii("Socket is not connected");if(t.connectionState==="closed")throw new Ii("Transport is closed");try{await t.connect(c=>$(this,Pl,Dy).call(this,a,c,r),r),u.info(`Connected ${a} transport`,{transport:{id:n,serverId:i,type:a}})}catch(c){throw o(this,Pa).transportFailureCount[a]+=1,c.message==="ice connection failed"?new Ii(c.message):c}},_l=new WeakSet,Iy=async function(t){var r,n;if(o(this,At)&&o(this,At).connected){u.info("Transport send is already connected",{transport:{id:(r=o(this,At))==null?void 0:r.id,serverId:(n=o(this,At))==null?void 0:n.serverId,type:"send"}});return}v(this,At,await o(this,_a).createTransport({...t,direction:"send"})),G.configureSendTransport(o(this,At))},bl=new WeakSet,Ay=async function(t){var r,n;if(o(this,Mt)&&o(this,Mt).connected){u.info("Transport recv is already connected",{transport:{id:(r=o(this,Mt))==null?void 0:r.id,serverId:(n=o(this,Mt))==null?void 0:n.serverId,type:"recv"}});return}v(this,Mt,await o(this,_a).createTransport({...t,direction:"recv"})),G.configureRecvTransport(o(this,Mt))},wl=new WeakSet,My=function(t){const{direction:r,id:n}=t;t.on("connectionstatechange",async i=>{$(this,Wo,lp).call(this,{state:i,direction:r}),u.info(`Transport connection state changed for ${r} transport`,{transport:{id:n,serverId:t.serverId,type:r,status:i}});const a=()=>{const c=o(this,Qn)[r];c!==void 0&&(clearTimeout(c),o(this,Qn)[r]=void 0)};switch(i){case"connected":a(),o(this,Pa).lastConnectionTime=performance.now();break;case"disconnected":o(this,Qn)[r]=setTimeout(async()=>{await $(this,Go,dp).call(this,t)},W1);break;case"failed":if(t.closed)return;a(),await $(this,Go,dp).call(this,t);break}}),t.on("icecandidate",async i=>{u.debug("Sending iceCandidate:",{iceCandidate:i})}),t.on("datachannel:events",async(i,a)=>{var c,d;u.debug("Got data channel message on event:",{rtcChannel:{label:i,message:a}});try{switch(a.type){case"handshake":{const l={type:"handshake",payload:{message:"pong"}};t.sendResponseOverDC(i,Av(a),l);break}case"hub-disconnect":{u.debug(`media hub disconnected, full_reconnect: ${(c=a.payload)==null?void 0:c.full_reconnect}`),((d=a.payload)==null?void 0:d.full_reconnect)===!0&&this.handleErrors("rejoin");break}case"error":break;default:break}}catch(l){u.error(`Unable to handle the incoming datachannel message on channel ${i}`)}}),t.on("dc_error",()=>{t.direction==="recv"&&(u.warn("Events datachannel did not open in 5s",{country:T.location.country}),this.handleErrors("reconnectRecvTransport"))})},Pl=new WeakSet,Dy=async function(t,r,n){const i=t==="recv";try{const{sdp:a,type:c}=r,d={consuming:i,description:{sdp:a,type:c,target:i?wr.SUBSCRIBER:wr.PUBLISHER},producers:[]};return!i&&n&&(d.producers=n),o(this,ba).connectTransport(d)}catch(a){throw u.error(`Error in ${t} transport connection:`,{error:a,country:T.location.country}),a}},Go=new WeakSet,dp=async function(t){t.close(),t.removeAllListeners();const{direction:r}=t;switch(ee.hasFeature(se.HIVE_TRANSPORT_FORCE_RELAY_ON_ICE_FAILED)&&o(this,Yn).isConnected&&o(this,Pa).transportFailureCount[r]>2&&(u.warn(`Multiple disconnections in ${r} transport, forcing relay`),v(this,Qr,"relay")),await this.createTransports({[r]:!0}),r){case"send":{await this.connectTransportWithRetry(o(this,At)),u.info("Transport reconnected",{transport:o(this,At)}),R.emit(k.RESET_PRODUCER_STATE);break}case"recv":{await this.connectTransportWithRetry(o(this,Mt)),u.info("Transport reconnected",{transport:o(this,Mt)}),R.emit(k.UPDATE_ACTIVE,{createAllConsumers:!0});break}default:u.warn("Unknown transport direction",{transport:t})}$(this,Wo,lp).call(this,{state:kr.CONNECTED,direction:r})},Wo=new WeakSet,lp=function(t){const{state:r,direction:n}=t;o(this,Ca,Jl).mediaState[n]={state:r,reconnected:!0},R.emit(k.TRANSPORT_STATE_UPDATE,{transport:n,...o(this,Ca,Jl).mediaState[n]})};class K1{constructor(e){g(this,Cl);this.recvTransport=e,$(this,Cl,Oy).call(this)}async create(e){if(!e||e&&e.length===0)throw new Error("List of producers is required");const r={type:"create_consumer",payload:{producers:e.map(({producerId:c,producingTransportId:d,kind:l,mimeType:h})=>({producerId:c,producingTransportId:d,preferredCodec:{...l==="video"&&h?{video:h}:{},...l==="audio"&&h?{audio:h}:{}}}))}},n=await this.recvTransport.sendDataChannelMessage("events",r),i=new Map;e.forEach(c=>i.set(c.producerId,c));const a=new Map;return Object.entries(n).forEach(([c,d])=>{const l=i.get(d.producerId);l&&a.set(d.producerId,{consumerId:c,producingTransportId:l.producingTransportId,producingPeerId:l.producingPeerId,kind:l.kind,paused:l.pause,streamId:d.streamId,trackId:d.trackId,screenShare:l.screenShare,mimeType:l.mimeType,appData:{}})}),{consumerStates:a}}async negotiate(e,t,r){try{u.debug(`Received offer over dc: ${e.sdp} for transport`);const n=await this.recvTransport.setRemoteOffer(e),i={type:"answer",payload:{type:n.type,sdp:n.sdp}};return u.debug(`datachannel answer: ${JSON.stringify(i)}`),this.recvTransport.sendResponseOverDC(r,t,i),n}catch(n){throw u.error("datachannel:events::Error:",n),n.code!=="DC_NOT_FOUND"&&this.recvTransport.sendErrorOverDC(r,t,n),n}}async close(e){if(!e.length)return{};const t=e.map(a=>a.id);u.info(`Closing consumers: ${JSON.stringify(t)}`);const r={type:"close_consumers",payload:{consumers:t}},n=await this.recvTransport.sendDataChannelMessage("events",r),{failedConsumers:i}=n;return{failedConsumers:i}}}Cl=new WeakSet,Oy=function(){this.recvTransport.on("datachannel:events",async(t,r)=>{try{switch(r.type){case"negotiation":{const{sdp:n}=r.payload,i={sdp:n,type:"offer"};this.negotiate(i,Av(r),t);break}default:break}}catch(n){u.error(`Unable to handle the incoming datachannel message on channel ${t}`)}})};class z1{constructor(e,t,r,n){this.events=e,this.recvTransport=t,this.socket=r,this.socketHandler=n}async create(e){if(!e||e&&e.length===0)throw new Error("List of producers is required");const t=new Map,r=[];e.forEach(c=>{const{producingPeerId:d,producerId:l,producingTransportId:h}=c;t.set(l,d),r.push({producingPeerId:d,producerId:l,producingTransportId:h})});const n=await this.socketHandler.consume({requests:r,consumingTransportId:this.recvTransport.serverId}),i=new Map;e.forEach(c=>i.set(c.producerId,c));const a=new Map;return Object.entries(n.consumerStateMap).forEach(([c,d])=>{const l=i.get(c);if(!l)return;let h={};try{h=JSON.parse(d.producerState.appData)}catch(p){}a.set(c,{consumerId:d.consumerId,producingTransportId:l.producingTransportId,producingPeerId:l.producingPeerId,kind:l.kind,paused:l.pause,streamId:d.producerTrack.streamId,trackId:d.producerTrack.trackId,screenShare:l.screenShare,mimeType:l.mimeType,appData:h})}),{consumerStates:a,sessionDescription:n.sessionDescription}}async negotiate(e){u.debug(`setting remote offer: ${JSON.stringify(e)} on recvTransport`,{transport:this.recvTransport});const t=await this.recvTransport.setRemoteOffer(e),r={transportId:this.recvTransport.serverId,description:{sdp:t.sdp,type:t.type,target:wr.SUBSCRIBER}};return u.debug(`sending renegotiate request: ${JSON.stringify(r)} on recvTransport`,{transport:this.recvTransport}),await this.socket.sendMessagePromise(this.events.renegotiateSessionDescription,uR.toBinary(r)),u.info("renegotiation done",{transport:this.recvTransport}),t}async close(e){if(!e.length)return{};const t=e.map(i=>i.localId);u.info(`Closing consumers: ${JSON.stringify(t)}`);const r={consumerIds:t};return await(async()=>{var i;return(i=this.recvTransport)==null?void 0:i.awaitQueue.push(async()=>{await this.socketHandler.closeConsumer(r)},"close_consumer").catch(a=>{u.warn("error on closing consumer:",{error:a})})})(),{}}}class Jd{constructor(e){this.socketHandler=e}static getMSIDFromSDP(e,t){return Vh(e).media.filter(i=>t==="video"?i.type==="video":i.type==="audio").at(-1).msid}async create({offer:e,kind:t,paused:r,appData:n,codecOptions:i,producingTransportId:a}){var p,f;const c=Jd.getMSIDFromSDP(e.sdp,t),d={description:{sdp:e.sdp,type:e.type,target:wr.PUBLISHER},paused:r,kind:t,msid:c,appData:JSON.stringify(n),screenShare:(p=n.screenShare)!=null?p:!1,mimeType:`${t}/${(f=i[0])==null?void 0:f.name}`,producingTransportId:a},{answer:l,producerId:h}=await this.socketHandler.produce(d);return{answer:l,producerId:h}}}const Y1=3;class Q1 extends J1{constructor(t,r,n){super(t,r,n);g(this,Rl);g(this,kl);g(this,Il);g(this,Al);g(this,zo);g(this,Yo);g(this,Ml);g(this,Ra,void 0);g(this,Xn,void 0);g(this,Xr,void 0);g(this,ka,void 0);g(this,Jo,void 0);g(this,qs,void 0);g(this,Ko,{producerCreationFailureCount:0,consumerCreationFailureCount:0,producerNotReadyFailureCount:0});v(this,Ra,t),o(this,Rl,Ny).mediaState={send:{state:kr.NEW,reconnected:!1},recv:{state:kr.NEW,reconnected:!1}},this.reset()}get socketHandler(){return super.socketHandler}get producers(){return o(this,Xn)}get consumers(){return o(this,Xr)}get producerIdToConsumerIdMap(){return o(this,ka)}reset(){v(this,Xn,new Map),v(this,Xr,new Map),v(this,ka,new Map)}async setupTransports(t,r){await this.createTransports(t);let n,i;t.send&&(n=$(this,kl,Ly).call(this,r)),t.recv&&(i=$(this,Il,xy).call(this));const[a]=await Promise.all([n,i]);return a}async createProducer(t,r){var n;if(!this.sendTransport||this.sendTransport.closed)throw new Error("Send transport is closed");try{const i=await this.sendTransport.produce(t,$(this,Al,Vy).bind(this));return(n=t.appData)!=null&&n.e2ee&&R.emit(k.E2EE_ACTIVE_PRODUCER,i),$(this,zo,up).call(this,i,r),i}catch(i){throw u.error("Failed to create producer",{error:i}),o(this,Ko).producerCreationFailureCount+=1,i}}async closeProducer(t,r){var i;const n=this.producers.get(t);if(!n){u.warn(`Producer with ID ${t} was not found`);return}r!=null&&r.stopTrack&&n.track.stop();try{await this.sendTransport.closeProducer(n),(i=o(this,Ra).getValue("modules").e2ee)!=null&&i.enabled&&R.emit(k.E2EE_INACTIVE_PRODUCER,n)}catch(a){u.error("Failed to close producer on server",{error:a,producer:n})}}closeAllProducers(){return Promise.all(Array.from(o(this,Xn).entries()).map(([,t])=>t.close()))}createConsumer(t){return this.createConsumers([t])}async createConsumers(t){if(!this.recvTransport||this.recvTransport.closed)throw new Error("Recv transport is closed");try{const r=t.filter(({producerId:i})=>!this.producers.get(i));(await this.recvTransport.consume(r,$(this,Yo,hp).bind(this),o(this,qs).negotiate.bind(o(this,qs)))).forEach(i=>{i.status!=="rejected"&&$(this,Ml,Uy).call(this,i.value)})}catch(r){}}closeConsumer(t){return this.closeConsumers([t])}async closeConsumers(t){if(!o(this,qs))return;const r=t.map(i=>this.consumers.get(i)).filter(i=>i!==void 0);if(r.length===0)return;const{failedConsumers:n}=await o(this,qs).close(r);n!=null&&n.length&&u.warn("Failed to close some consumers",{consumerIds:n})}closeAllConsumers(){return this.closeConsumers(Array.from(o(this,Xr).keys()))}async switchConsumersToLayer(t,r){const n=this.recvTransport.getDatachannel("events");if(!n){u.warn("events datachannel not found");return}const i={type:"switch_consumer_layer",payload:{consumerIds:t,layer:r}};await n.request(i),u.info(`Consumers switched layers to ${r}`,{consumerIds:t})}}Ra=new WeakMap,Xn=new WeakMap,Xr=new WeakMap,ka=new WeakMap,Jo=new WeakMap,qs=new WeakMap,Ko=new WeakMap,Rl=new WeakSet,Ny=function(){return o(this,Ra).getValue("connectionHandler")},kl=new WeakSet,Ly=async function(t){v(this,Jo,new Jd(this.socketHandler));const r=[];return t&&(await this.sendTransport.precreateProducers(t)).forEach(async({kind:a,result:c},d)=>{var p;const{codecOptions:l}=t[d].options,h=l[0]?`${a}/${(p=l[0])==null?void 0:p.name}`:void 0;r.push({kind:a,msid:Jd.getMSIDFromSDP(c.offerSdp.sdp,a),mid:c.mid,paused:!0,mimeType:h,appData:JSON.stringify({mid:c.mid}),screenShare:!1,track:t[d].options.track})}),await this.connectTransportWithRetry(this.sendTransport,r),this.sendTransport.producers.size?r.map(({mid:i},a)=>{const[,c]=Array.from(this.sendTransport.producers.entries()).find(([,d])=>d.localId===i);return $(this,zo,up).call(this,c,t[a].onClose),c}):[]},Il=new WeakSet,xy=async function(){switch(this.recvTransport.on("connect",()=>{o(this,ka).clear()}),await this.connectTransportWithRetry(this.recvTransport),this.nodeType){case ft.CF:{v(this,qs,new z1(this.events,this.recvTransport,this.socket,this.socketHandler));break}case ft.HIVE:default:v(this,qs,new K1(this.recvTransport))}},Al=new WeakSet,Vy=function(t){return o(this,Jo).create(t)},zo=new WeakSet,up=function(t,r){t.on("close",async({offer:n,reason:i},a)=>{u.info("producer::closing",{debuggingHint:i,producer:{...t,status:"closing"}});const c={producerId:t.id,description:{sdp:n.sdp,type:n.type,target:wr.PUBLISHER}};try{const d=await this.socketHandler.closeProducer(c),l={sdp:d==null?void 0:d.sdp,type:d==null?void 0:d.type};u.info("producer::closed",{producer:{...t,status:"closed"}}),a({answer:l})}catch(d){u.error("producer close error",d)}this.producers.delete(t.id),r()}),t.on("trackended",()=>{u.info("producer::trackended",{producer:{...t,status:"UNKNOWN"}})}),o(this,Xn).set(t.id,t)},Yo=new WeakSet,hp=async function(t,r=0){try{return await this.recvTransport.canConsume(),await o(this,qs).create(t)}catch(n){if(n instanceof R1&&(o(this,Ko).consumerCreationFailureCount+=1),r<=Y1)return u.error(`Error in consume request attempt:${r}`,{error:n}),$(this,Yo,hp).call(this,t,r+1);throw u.error("Error in consume request",{error:n}),n}},Ml=new WeakSet,Uy=function(t){t.on("close",async r=>{u.debug("consumer closed",{consumer:{closureReason:r,id:t.id,kind:t.kind,appData:t.appData}}),o(this,Xr).delete(t.id),R.emit(k.CONSUMER_CLOSED,{id:t.id})}),o(this,Xr).set(t.id,t),this.producerIdToConsumerIdMap.set(t.producerId,t.id),R.emit(k.NEW_CONSUMER,{id:t.id,appData:t.appData,peerId:t.peerId})};const xl=class{constructor({initialEnergyThreshold:e=.015,zeroCrossingThreshold:t=20,minVoiceDuration:r=3,hangoverFrames:n=5,noiseAdaptationRate:i=.95,voiceAdaptationRate:a=.99,minEnergyThreshold:c=.005,maxEnergyThreshold:d=.2,energyRatioThreshold:l=1.5,noiseHistorySize:h=50}={}){g(this,Dl);g(this,Ol);g(this,Qo,void 0);g(this,Xo,void 0);g(this,Zo,void 0);g(this,Ia,void 0);g(this,Aa,void 0);g(this,Ma,void 0);g(this,ec,void 0);g(this,tc,void 0);g(this,Zn,void 0);g(this,Bt,void 0);g(this,Rs,void 0);g(this,ks,!1);g(this,ei,0);g(this,ti,0);g(this,pr,[]);g(this,sc,void 0);v(this,Ia,e),v(this,Bt,e),v(this,Qo,t),v(this,Xo,r),v(this,Zo,n),v(this,Aa,i),v(this,Ma,a),v(this,ec,c),v(this,tc,d),v(this,Zn,l),v(this,sc,h),v(this,Rs,e/2)}get voiceDetected(){return o(this,ks)}processAudioChunk(e){var a,c;const t=$(a=xl,Nl,$y).call(a,e),r=$(c=xl,Ll,Hy).call(c,e);return $(this,Dl,Fy).call(this,t),t/o(this,Rs)>o(this,Zn)&&t>o(this,Bt)&&r>o(this,Qo)?(v(this,ei,o(this,ei)+1),v(this,ti,o(this,Zo)),o(this,ei)>=o(this,Xo)&&v(this,ks,!0)):(v(this,ei,0),o(this,ti)>0?v(this,ti,o(this,ti)-1):o(this,ks)&&v(this,ks,!1),o(this,ks)||$(this,Ol,By).call(this,t)),o(this,ks)}reset(){v(this,ks,!1),v(this,ei,0),v(this,ti,0),v(this,Bt,o(this,Ia)),v(this,Rs,o(this,Ia)/2),v(this,pr,[])}getThresholdInfo(){return{currentEnergyThreshold:o(this,Bt),backgroundNoiseEnergy:o(this,Rs),energyRatioThreshold:o(this,Zn)}}};let mo=xl;Qo=new WeakMap,Xo=new WeakMap,Zo=new WeakMap,Ia=new WeakMap,Aa=new WeakMap,Ma=new WeakMap,ec=new WeakMap,tc=new WeakMap,Zn=new WeakMap,Bt=new WeakMap,Rs=new WeakMap,ks=new WeakMap,ei=new WeakMap,ti=new WeakMap,pr=new WeakMap,sc=new WeakMap,Dl=new WeakSet,Fy=function(e){o(this,ks)?v(this,Bt,o(this,Ma)*o(this,Bt)+(1-o(this,Ma))*e):v(this,Bt,o(this,Aa)*o(this,Bt)+(1-o(this,Aa))*(o(this,Rs)*o(this,Zn))),v(this,Bt,Math.max(o(this,ec),Math.min(o(this,tc),o(this,Bt))))},Ol=new WeakSet,By=function(e){if(e<o(this,Bt)*1.2)if(o(this,pr).push(e),o(this,pr).length>o(this,sc)&&o(this,pr).shift(),o(this,pr).length>=10){const t=[...o(this,pr)].sort((n,i)=>n-i),r=Math.floor(t.length/2);v(this,Rs,t[r])}else v(this,Rs,.95*o(this,Rs)+.05*e)},Nl=new WeakSet,$y=function(e){return Math.sqrt(e.map(t=>t*t).reduce((t,r)=>t+r)/e.length)},Ll=new WeakSet,Hy=function(e){let t=0;for(let r=1;r<e.length;r+=1)(e[r]>=0&&e[r-1]<0||e[r]<0&&e[r-1]>=0)&&(t+=1);return t},g(mo,Nl),g(mo,Ll);const X1=60,Z1=400,xa=class{constructor(e){g(this,Vl);g(this,Ul);g(this,Zr,void 0);g(this,en,void 0);g(this,si,void 0);g(this,Da,void 0);g(this,tn,void 0);g(this,Oa,void 0);g(this,Na,void 0);g(this,rc,void 0);g(this,sn,void 0);g(this,ri,void 0);g(this,La,void 0);this.reportRequest=e,v(this,Da,new AudioContext),v(this,tn,o(this,Da).createAnalyser()),o(this,tn).fftSize=2048,v(this,rc,new mo)}set producerId(e){v(this,si,e)}set audioTrack(e){v(this,Oa,e);const t=new MediaStream;t.addTrack(o(this,Oa)),o(this,Da).createMediaStreamSource(t).connect(o(this,tn))}start(){o(this,Zr)&&Pi(o(this,Zr)),v(this,Zr,Ld(async()=>{var n;if(!o(this,Oa)||!o(this,si))return;const{energy:e}=$(this,Vl,qy).call(this),t=$(n=xa,nc,pp).call(n,e);let r=.9;o(this,La)!==t&&o(this,La)?r=.9:t?r=.3:r=.5,v(this,Na,(o(this,Na)||0)*(1-r)+e*r)},X1)),o(this,en)&&Pi(o(this,en)),v(this,en,Ld(async()=>{$(this,Ul,jy).call(this)},Z1))}stop(){o(this,Zr)&&Pi(o(this,Zr)),o(this,en)&&Pi(o(this,en))}};let Ai=xa;Zr=new WeakMap,en=new WeakMap,si=new WeakMap,Da=new WeakMap,tn=new WeakMap,Oa=new WeakMap,Na=new WeakMap,rc=new WeakMap,sn=new WeakMap,ri=new WeakMap,La=new WeakMap,Vl=new WeakSet,qy=function(){var a,c;const e=new Float32Array(o(this,tn).frequencyBinCount);o(this,tn).getFloatTimeDomainData(e);const t=o(this,rc).processAudioChunk(e),r=$(a=xa,Fl,Gy).call(a,e),n=$(c=xa,Bl,Wy).call(c,r);return(!o(this,sn)||n<o(this,sn))&&v(this,sn,n),(!o(this,ri)||n>o(this,ri))&&v(this,ri,n),{energy:(n-o(this,sn))/(o(this,ri)-o(this,sn))*10||0,isVoice:t}},nc=new WeakSet,pp=function(e){return e<5},Ul=new WeakSet,jy=function(e=o(this,Na)){var r;if(!o(this,si)||!e)return;const t={producerId:o(this,si),energy:Math.round(e),silent:$(r=xa,nc,pp).call(r,e)};v(this,La,t.silent),this.reportRequest(t)},Fl=new WeakSet,Gy=function(e){return Math.sqrt(e.reduce((t,r)=>t+r*r,0)/e.length)},Bl=new WeakSet,Wy=function(e){const t=Math.log10(e);return Math.round(t)},g(Ai,nc),g(Ai,Fl),g(Ai,Bl);const eN=()=>{const s=new window.AudioContext,e=s.createOscillator();e.type="triangle",e.frequency.setValueAtTime(20,s.currentTime);const t=s.createGain();t.gain.setValueAtTime(0,s.currentTime),e.connect(t);const r=s.createMediaStreamDestination();return t.connect(r),e.start(),r.stream.getAudioTracks()[0]},tN=()=>{var r,n;const s=new MediaStream().getVideoTracks()[0],e=document.createElement("canvas");e.height=(r=s==null?void 0:s.getSettings().height)!=null?r:720,e.width=(n=s==null?void 0:s.getSettings().width)!=null?n:1280;const t=e.getContext("2d");return t.fillStyle="black",t.fillRect(0,0,e.width,e.height),setInterval(()=>{t.fillStyle="black",t.fillRect(0,0,e.width,e.height)},1e3),e.captureStream().getVideoTracks()[0]};var sN=Object.defineProperty,rN=Object.getOwnPropertyDescriptor,de=(s,e,t,r)=>{for(var n=r>1?void 0:r?rN(e,t):e,i=s.length-1,a;i>=0;i--)(a=s[i])&&(n=(r?a(e,t,n):a(n))||n);return r&&n&&sN(e,t,n),n};const xs=["video/VP9","video/VP8"];class ce{constructor(e,t,r){g(this,nn);g(this,dt);g(this,li);g(this,cc);g(this,dc);m(this,"context");m(this,"authToken");m(this,"e2ee");g(this,ic,void 0);g(this,ac,void 0);g(this,St,void 0);g(this,j,void 0);g(this,Va,void 0);g(this,ni,void 0);g(this,Dt,void 0);g(this,ii,void 0);g(this,ai,void 0);g(this,rn,void 0);g(this,oc,void 0);g(this,mr,void 0);m(this,"maxPreferredStreams");g(this,Ua,void 0);g(this,oi,void 0);g(this,ci,void 0);g(this,di,void 0);g(this,ls,void 0);m(this,"partialJoinRoomPromise");var i,a;this.context=e;const{socket:n}=r;this.mediaJoined=!1,v(this,oi,new Map([["video/VP9",new Set],["video/VP8",new Set]])),v(this,ci,new Map([["video/VP9",new Set],["video/VP8",new Set]])),v(this,ni,t),v(this,St,n),v(this,ii,!1),v(this,j,new Q1(e,n,t)),v(this,Dt,o(this,j).events),this.maxPreferredStreams=6,v(this,mr,new Set),v(this,di,new Map),v(this,ai,!1),v(this,rn,new $d),t===ft.CF&&v(this,ls,new Ai(o(this,j).socketHandler.audioActivity.bind(o(this,j).socketHandler))),this.e2ee=(a=(i=e.getValue("modules").e2ee)==null?void 0:i.enabled)!=null?a:!1,this.handleSocketEvents(),this.handleCallstatsEvents(),v(this,oc,ad(async()=>{if(!o(this,nn,$a).mediaJoinAttempted)return;const{roomJoined:c}=await this.joinRoom(o(this,ac),o(this,ic),{},!0,!0);c&&(R.emit(k.RESET_PRODUCER_STATE),R.emit(k.ROOM_NODE_RECONNECTED))},5e3,{leading:!0,maxWait:1e3}))}get peerId(){return this.context.getValue("peerId")}get mediaJoined(){return o(this,nn,$a).mediaJoined}set mediaJoined(e){o(this,nn,$a).mediaJoined=e}reset(e=!0){o(this,j).closeAllProducers(),o(this,j).closeAllConsumers(),o(this,mr).clear(),e&&(this.partialJoinRoomPromise=void 0,o(this,rn).stop(),o(this,j).stopAllTransports(),o(this,j).reset(),v(this,rn,new $d))}async joinRoom(e,t,r={},n=!1,i=!1){o(this,nn,$a).mediaJoinAttempted=!0,v(this,ii,!0),this.reset(n);const a=at().ipInfo;if(a!=null&&a.loc&&!o(this,Ua)){const d=a.loc.split(",");v(this,Ua,{latitude:parseFloat(d[0]),longitude:parseFloat(d[1])})}let c;try{return c=await o(this,rn).push(()=>this._joinRoom(e,t,r,i,o(this,Ua)),"joinRoom"),c}catch(d){c={roomJoined:!1}}return c.roomJoined||R.emit(k.ROOM_NODE_FAILED),c}async _partialJoinRoom(e,t,r=!1,n=void 0){var f;const{ipInfo:i}=at();let a=n;if(i!=null&&i.loc&&!n){const[y,_]=i.loc.split(",").map(parseFloat);a={latitude:y,longitude:_}}const c=(f=ee.getValue(se.FORCE_VIDEO_CODEC))==null?void 0:f.toString(),d=A1(c);v(this,Va,d),this.maxPreferredStreams=this.context.getValue("maxPreferredStreams"),await Oh(async(y,_)=>{if(!o(this,St).isConnected){_(new Error("socket is not connected"));return}y>0&&u.warn(`retrying sending join room request, count: ${y}`);try{await o(this,j).socketHandler.joinRoom(t,e,d,r,a)}catch(b){throw u.error("failed to send join room request, error:",{error:b}),b}},{delayTime:1e3,strategy:"exponential",maxRetryCount:ee.hasFeature(se.ENABLE_HIVE_INFINITE_RETRIES)?1/0:3});const l="video/VP8",h=ee.hasFeature(se.PRECREATE_PRODUCERS)?[{type:Le.MIC,kind:"audio",options:$(this,cc,mp).call(this,eN()),onClose:()=>this.disableMic()},{type:Le.WEBCAM,kind:"video",options:$(this,dc,fp).call(this,tN(),l),onClose:()=>{this.disableWebcam(l)}}]:[],p=await o(this,j).setupTransports({send:!0,recv:!0},h);p!=null&&p.length&&h.forEach((y,_)=>{o(this,di).set(y.type,p[_].id)})}async partialJoinRoom(e,t,r=!1,n=void 0){return this.partialJoinRoomPromise=o(this,rn).push(()=>this._partialJoinRoom(e,t,r,n)),this.partialJoinRoomPromise}async _joinRoom(e,t,r={},n=!1,i=null){v(this,ac,e);try{this.partialJoinRoomPromise?await this.partialJoinRoomPromise:await this._partialJoinRoom(e,t,n,i)}catch(a){u.error("error in partial join room",{error:a})}finally{this.partialJoinRoomPromise=void 0}try{return navigator.product!=="ReactNative"&&setTimeout(async()=>{const d={userId:this.context.getValue("userId"),peerId:this.peerId,roomUUID:t,roomViewType:"groupCall",deviceInfo:{..._e.getDeviceInfo(),userAgent:navigator.userAgent,memory:navigator.deviceMemory,cpus:navigator.hardwareConcurrency},sdkName:this.context.getValue("sdkName"),sdkVersion:this.context.getValue("sdkVersion"),metaData:{},permissions:{}};G.roomJoined(d)}),{roomJoined:await this.completeJoinRoom()}}catch(a){return u.error("error on sending join room request",{error:a}),{roomJoined:!1}}}async completeJoinRoom(){try{this.mediaJoined=!0;const{maxPreferredStreams:e,roomState:t}=await o(this,j).socketHandler.notifySelfJoinComplete();return v(this,ic,t.roomUuid),v(this,ai,!0),v(this,ii,!1),this.maxPreferredStreams=e!=null?e:6,!0}catch(e){return u.error("error on completing join room:",{error:e}),this.mediaJoined=!1,!1}}async leaveRoom(){o(this,j).stopAllTransports(),v(this,ai,!1),o(this,nn,$a).mediaJoinAttempted=!1;const e={closeRoom:!1};o(this,St).sendMessagePromise(o(this,Dt).leaveRoom,LR.toBinary(e)).then(t=>{var n;((n=Sk.fromBinary(t.payload))==null?void 0:n.closed)||u.warn("weird state on peer closed and should not happen")}).catch(t=>{u.error("error on sending leave room request",{error:t})}),G.callEnded(),T.destruct()}getConsumers(){return o(this,j).consumers}async activatePeers(e){return this.createConsumers(e)}async deactivatePeers(e,t="default"){const r=new Set;e.forEach(i=>{i.screenShare&&i.kind==="video"&&r.add(i.producingPeerId)});const n=t==="default"?e.filter(i=>!r.has(i.producingPeerId)).filter(i=>i.kind!=="audio"):e;await Promise.all(n.map(i=>{const a=o(this,j).producerIdToConsumerIdMap.get(i.producerId);if(!a){u.warn(`consumer not found in deactivate producers: ${i.producerId}`);return}return o(this,j).closeConsumer(a)}))}async createConsumers(e){return e.length===0?Promise.resolve():o(this,j).createConsumers(e)}async closeConsumers(e){if(!e.length)return;const t=e.reduce((r,n)=>{const i=o(this,j).producerIdToConsumerIdMap.get(n.producerId);return i?(r.push(i),r):(u.warn(`consumer not found in deactivate producers: ${n.producerId}`),r)},[]);await o(this,j).closeConsumers(t)}async _shareWebcam(e,t){const r=t==="video/VP9"?Le.WEBCAM:Le.WEBCAM_BACKUP,n=$(this,dt,Nt).call(this,r);if(o(this,j).producers.has(n)){const l=o(this,j).producers.get(n);if(!l.closed&&!navigator.isReactNative)return await l.replaceTrack({track:e}),await this.resumeWebcam(r),e;await this.disableWebcam(t)}const i=$(this,dc,fp).call(this,e,t),a=dd(this.context,"disableSimulcast");o(this,ni)===ft.HIVE&&!a&&ee.hasFeature(se.ENABLE_HIVE_SIMULCAST)?(u.info(`Simulcast enabled for SFU: ${o(this,ni)}`),i.encodings=CO(e)):u.info(`Simulcast disabled for webcam producer, SFU: ${o(this,ni)}`),ee.hasFeature(se.TRACK_HINT)&&(i.track.contentHint=ee.getValue(se.TRACK_HINT));const c=()=>{u.info("Disabling video due to the producer closure"),this.disableWebcam(t)},d=await o(this,j).createProducer(i,c);return $(this,li,Oc).call(this,r,d.id),d.track}async shareWebcam(e){if(e===void 0)return null;if(ee.hasFeature(se.FORCE_VIDEO_CODEC)){const t=ee.getValue(se.FORCE_VIDEO_CODEC).toString();if(t)return u.debug(`Calling _shareWebcam with forced video codec: ${t}`),this._shareWebcam(e,t)}return await Promise.all(xs.map(t=>{var r,n;return((n=(r=o(this,Va).sender)==null?void 0:r.video)==null?void 0:n.codecs.findIndex(i=>i.mimeType===t))>=0&&o(this,ci).get(t).size>0?(u.debug(`Calling _shareWebcam with video codec: ${t}`),this._shareWebcam(e,t)):e})),e}async shareScreen(e){const{video:t,audio:r}=e;if(t===void 0)return;const n={track:t,codecOptions:[{name:"VP8"}],appData:{screenShare:!0,e2ee:this.e2ee,supportsRemoteControl:_e.isElectron()},stopTracks:!1};let i=()=>{u.info("Disabling screenShare due to the producer closure"),this.disableScreenShare()};const a=await o(this,j).createProducer(n,i);if($(this,li,Oc).call(this,Le.SCREENSHARE_VIDEO,a.id),r){const c={track:r,codecOptions:[{name:"opus"}],appData:{screenShare:!0,e2ee:this.e2ee,supportsRemoteControl:_e.isElectron()},stopTracks:!1,zeroRtpOnPause:!0};i=()=>{};const d=await o(this,j).createProducer(c,i);$(this,li,Oc).call(this,Le.SCREENSHARE_AUDIO,d.id)}G.screenShareStart()}async shareMic(e){try{if(e===void 0)throw new Ct("track undefined");const t=$(this,dt,Nt).call(this,Le.MIC);if(o(this,j).producers.has(t)){const a=o(this,j).producers.get(t);if(!a.closed&&!navigator.isReactNative){await a.replaceTrack({track:e}),await this.resumeMic(),o(this,ls)&&(o(this,ls).audioTrack=e,o(this,ls).start());return}await o(this,j).closeProducer(t,{stopTrack:!1})}const r=$(this,cc,mp).call(this,e),n=()=>{u.info("Disabling audio due to the producer closure"),this.disableMic()},i=await o(this,j).createProducer(r,n);$(this,li,Oc).call(this,Le.MIC,i.id),o(this,ls)&&(o(this,ls).producerId=i.id,o(this,ls).audioTrack=e,o(this,ls).start())}catch(t){throw new P(t)}}pauseMic(){const e=$(this,dt,Nt).call(this,Le.MIC),t=o(this,j).producers.get(e);if(!t){u.error("pauseMic::could_not_find_mic_producer");return}if(t.paused){u.info("pauseMic::mic_producer_already_paused");return}t.pause();const r={producerId:t.id,pause:!0};o(this,St).sendMessage(o(this,Dt).toggleProducer,Ed.toBinary(r))}async pauseWebcam(){const e=$(this,dt,Nt).call(this,Le.WEBCAM),t=$(this,dt,Nt).call(this,Le.WEBCAM_BACKUP),r=o(this,j).producers.get(e),n=o(this,j).producers.get(t);if(!r){u.error("pauseWebcam::could_not_find_webcam_producer");return}const i=a=>{const c={producerId:a.id,pause:!0};o(this,St).sendMessage(o(this,Dt).toggleProducer,Ed.toBinary(c))};r.pause(),i(r),n&&(n.pause(),i(n))}async resumeMic(){const e=$(this,dt,Nt).call(this,Le.MIC),t=o(this,j).producers.get(e);if(!t){u.error("resumeMic::could_not_find_mic_producer");return}if(!t.pause){u.info("resumeMic::mic_producer_already_resumed");return}t.resume(),t.appData.e2ee&&R.emit(k.E2EE_ACTIVE_PRODUCER,t);const r={producerId:t.id,pause:!1};o(this,St).sendMessage(o(this,Dt).toggleProducer,Ed.toBinary(r))}async resumeWebcam(e=Le.WEBCAM){const t=$(this,dt,Nt).call(this,e),r=o(this,j).producers.get(t);if(!r){u.error("resumeWebcam::could_not_find_webcam_producer");return}r.resume(),r.appData.e2ee&&R.emit(k.E2EE_ACTIVE_PRODUCER,r);const n={producerId:r.id,pause:!1};o(this,St).sendMessage(o(this,Dt).toggleProducer,Ed.toBinary(n))}async disableWebcam(e){const t=e==="video/VP9"?Le.WEBCAM:Le.WEBCAM_BACKUP,r=$(this,dt,Nt).call(this,t);await o(this,j).closeProducer(r)}async disableMic(){var t;const e=$(this,dt,Nt).call(this,Le.MIC);await o(this,j).closeProducer(e),(t=o(this,ls))==null||t.stop()}async disableScreenShare(){u.info("screen_sharing_stopped"),G.screenShareStop();const e=$(this,dt,Nt).call(this,Le.SCREENSHARE_VIDEO),t=$(this,dt,Nt).call(this,Le.SCREENSHARE_AUDIO);await o(this,j).closeProducer(e),await o(this,j).closeProducer(t),o(this,mr).clear()}async muteSelf(){this.pauseMic()}async unmuteSelf(){}async resetVideoProducers(e,t){if(e){const r=$(this,dt,Nt).call(this,Le.WEBCAM),n=$(this,dt,Nt).call(this,Le.WEBCAM_BACKUP);await o(this,j).closeProducer(r,{stopTrack:!1}),await o(this,j).closeProducer(n,{stopTrack:!1}),this.shareWebcam(e)}if(t){const r=$(this,dt,Nt).call(this,Le.SCREENSHARE_VIDEO);await o(this,j).closeProducer(r,{stopTrack:!1}),this.shareScreen({video:t})}}async changeDisplayName(e,t){const r={displayName:e,participantId:t!=null?t:this.peerId};if(!await o(this,j).socketHandler.changeDisplayName(r))throw new Error("failed to change display name!")}async kick(e){const t={participantId:e};if(!await o(this,j).socketHandler.kickPeer(t))throw new Error("failed to kickout the participant!")}async kickAll(){if(!await o(this,j).socketHandler.kickAll())throw new Error("failed to kickout all participant!")}async muteAll(e){if(!await o(this,j).socketHandler.hostControlForAll("audio"))throw new Error("failed to mute all participant")}async muteAllVideo(){if(!await o(this,j).socketHandler.hostControlForAll("video"))throw new Error("failed to mute all video participant")}async disableAudio(e){if(!await o(this,j).socketHandler.hostControlForPeer(e,"audio"))throw new Error("failed to mute given participant")}async disableVideo(e){if(!await o(this,j).socketHandler.hostControlForPeer(e,"video"))throw new Error("failed to mute video of given participant")}async pinPeer(e){const t={participantId:e!=null?e:""};try{await o(this,St).sendMessagePromise(o(this,Dt).globalPinPeer,GR.toBinary(t))}catch(r){u.error("Error in pinning peer:",{error:r})}}validateScreenShare(e){return this.peerId===e.peerId&&o(this,j).producers.get(e.producerId)&&o(this,mr).add(e.consumerPeerId),o(this,mr).size}async switchConsumersToLayer(e,t){o(this,j).switchConsumersToLayer(e,t)}async handleSocketEvents(){o(this,St).on(o(this,Dt).peerProducerCreateBroadcast,({payload:e})=>{var t,r;if(this.mediaJoined)try{const{participantId:n,producerState:i}=Qk.fromBinary(e);if(n===this.peerId)return;if(i!=null&&i.mimeType||(i.mimeType=i.kind===Ls.AUDIO?"audio/opus":"video/VP8"),i.kind===Ls.VIDEO&&!i.screenShare&&((r=(t=o(this,Va).receiver)==null?void 0:t.video)==null?void 0:r.codecs.findIndex(a=>a.mimeType===xs[0]))>=0&&o(this,oi).get(xs[0]).has(n)&&i.mimeType!==xs[0]){u.warn(`Ignoring producer: ${i.producerId}`);return}u.info(`producer created broadcast: ${n}, producer state: ${i}`),R.emit(k.NEW_PRODUCER,{peerId:n,producer:{...i,kind:i.kind===Ls.AUDIO?"audio":"video",producingPeerId:n}})}catch(n){u.error("error in peer-producer-create-broadcast",{error:n})}}),o(this,St).on(o(this,Dt).peerProducerToggleBroadcast,({payload:e})=>{if(this.mediaJoined)try{const{participantId:t,initiatorParticipantId:r,producerState:{kind:n,pause:i,producerId:a}}=wg.fromBinary(e),c=n===Ls.AUDIO?"audio":"video";if(u.info(`producer toggle broadcast: ${t}, producerId: ${a}, kind:${c}, paused:${i} payload: ${JSON.stringify(wg.fromBinary(e))}`),t===this.peerId&&r!==this.peerId&&i&&R.emit(c==="audio"?k.MUTE_SELF:k.MUTE_SELF_VIDEO),t===this.peerId)return;R.emit(k.PRODUCER_TOGGLE,{peerId:t,producerId:a,paused:i,kind:c}),Array.from(this.getConsumers().values()).filter(l=>l.producerId===a).forEach(l=>{l.paused!==i&&(u.debug(`consumer state mismatched for ${l.id}. updating consumer pause state ${l.paused} to ${i}`),i?(l.pause(),R.emit(k.CONSUMER_PAUSED,{id:l.id})):(l.resume(),R.emit(k.CONSUMER_RESUMED,{id:l.id})))})}catch(t){u.error("error in producer toggle broadcast handler",{error:t})}}),o(this,St).on(o(this,Dt).peerLeaveBroadcast,({payload:e})=>{if(this.mediaJoined)try{const{participantId:t}=Zu.fromBinary(e);if(t===this.peerId)return;u.info(`peer left broadcast:${t}`),o(this,mr).delete(t),o(this,j).consumers.forEach(r=>{r.peerId===t&&r.close()}),R.emit(k.PEER_CLOSED,{id:t})}catch(t){u.error("error in peer left broadcast",{error:t})}}),o(this,St).on(o(this,Dt).peerProducerCloseBroadcast,({payload:e})=>{if(this.mediaJoined)try{const{participantId:t,producerState:{producerId:r}}=eI.fromBinary(e);if(t===this.peerId)return;u.info(`producer closed broadcast:${t}`),R.emit(k.PRODUCER_CLOSED,{peerId:t,producerId:r});const n=o(this,j).producerIdToConsumerIdMap.get(r);if(!n){u.warn(`no consumer found for producer:${r}`);return}u.info(`closing consumer ${n}, producer id: ${r}`),o(this,j).closeConsumer(n).then(()=>{u.info(`closed consumer: ${n}`),o(this,j).producerIdToConsumerIdMap.delete(r),R.emit(k.CONSUMER_CLOSED,{id:n})}).catch(i=>{u.error("error closing consumer",{error:i})})}catch(t){u.error("error on producer close broadcast",{error:t})}}),o(this,St).on(o(this,Dt).mediaRoomTerminationBroadcastResponse,()=>{!this.mediaJoined&&!o(this,ii)&&!o(this,ai)||(u.warn("media hub termination broadcast received, rejoining room"),R.emit(k.ROOM_NODE_DISCONNECTED),o(this,oc).call(this))})}handleCallstatsEvents(){G.onConsumerScore(e=>{e.forEach((t,r)=>{const n=o(this,j).consumers.get(r);n&&R.emit(k.CONSUMER_SCORE_UPDATE,{id:r,kind:n.kind,peerId:n.peerId,score:t.score,scoreStats:t})})}),G.onProducerScore(e=>{e.forEach((t,r)=>{const n=Array.from(o(this,j).producers.values()).find(i=>i.id===r);n&&R.emit(k.PRODUCER_SCORE_UPDATE,{id:r,kind:n.kind,appData:n.appData,score:t.score,scoreStats:t})})})}handlePeerCapabilities(e,t){var r,n,i,a;for(let c=0;c<=xs.length;c+=1){const d=xs[c];if(((n=(r=t==null?void 0:t.receiver)==null?void 0:r.video)==null?void 0:n.codecs.findIndex(l=>l.mimeType===d))>=0||c===xs.length-1){o(this,ci).get(d).add(e);break}}for(let c=0;c<=xs.length;c+=1){const d=xs[c];if(((a=(i=t==null?void 0:t.sender)==null?void 0:i.video)==null?void 0:a.codecs.findIndex(l=>l.mimeType===d))>=0||c===xs.length-1){o(this,oi).get(d).add(e);break}}}handlePeerLeaving(e){o(this,oi).forEach(t=>t.delete(e)),o(this,ci).forEach((t,r)=>{t.delete(e),t.size===0&&this.disableWebcam(r)})}}ic=new WeakMap,ac=new WeakMap,St=new WeakMap,j=new WeakMap,Va=new WeakMap,ni=new WeakMap,Dt=new WeakMap,ii=new WeakMap,ai=new WeakMap,rn=new WeakMap,oc=new WeakMap,mr=new WeakMap,Ua=new WeakMap,oi=new WeakMap,ci=new WeakMap,di=new WeakMap,ls=new WeakMap,nn=new WeakSet,$a=function(){return this.context.getValue("connectionHandler")},dt=new WeakSet,Nt=function(e){return o(this,di).get(e)},li=new WeakSet,Oc=function(e,t){return o(this,di).set(e,t)},cc=new WeakSet,mp=function(e){return{track:e,encodings:[{priority:"high"}],codecOptions:[{name:"opus"}],appData:{e2ee:this.e2ee},stopTracks:!1,zeroRtpOnPause:!0}},dc=new WeakSet,fp=function(e,t){return{track:e,codecOptions:[{name:t?t.split("/")[1]:"VP8"}],appData:{screenShare:!1,e2ee:this.e2ee},stopTracks:!1}},de([T.trace("MediaNodeClient.reset",{country:T.location.country})],ce.prototype,"reset",1),de([T.trace("MediaNodeClient.joinRoom")],ce.prototype,"joinRoom",1),de([T.trace("MediaNodeClient.completeJoinRoom")],ce.prototype,"completeJoinRoom",1),de([T.trace("MediaNodeClient.leaveRoom")],ce.prototype,"leaveRoom",1),de([T.trace("MediaNodeClient.activatePeers")],ce.prototype,"activatePeers",1),de([T.trace("MediaNodeClient.deactivatePeers")],ce.prototype,"deactivatePeers",1),de([T.trace("MediaNodeClient.createConsumers")],ce.prototype,"createConsumers",1),de([T.trace("MediaNodeClient.closeConsumers")],ce.prototype,"closeConsumers",1),de([T.trace("MediaNodeClient._shareWebcam")],ce.prototype,"_shareWebcam",1),de([T.trace("MediaNodeClient.shareWebcam")],ce.prototype,"shareWebcam",1),de([T.trace("MediaNodeClient.shareScreen")],ce.prototype,"shareScreen",1),de([T.trace("MediaNodeClient.shareMic")],ce.prototype,"shareMic",1),de([T.trace("MediaNodeClient.pauseMic")],ce.prototype,"pauseMic",1),de([T.trace("MediaNodeClient.pauseWebcam")],ce.prototype,"pauseWebcam",1),de([T.trace("MediaNodeClient.resumeMic")],ce.prototype,"resumeMic",1),de([T.trace("MediaNodeClient.resumeWebcam")],ce.prototype,"resumeWebcam",1),de([T.trace("MediaNodeClient.disableWebcam")],ce.prototype,"disableWebcam",1),de([T.trace("HiveClient.disableMic")],ce.prototype,"disableMic",1),de([T.trace("HiveClient.disableScreenShare")],ce.prototype,"disableScreenShare",1),de([T.trace("MediaNodeClient.muteSelf")],ce.prototype,"muteSelf",1),de([T.trace("MediaNodeClient.resetVideoProducers")],ce.prototype,"resetVideoProducers",1),de([T.trace("MediaNodeClient.changeDisplayName")],ce.prototype,"changeDisplayName",1),de([T.trace("MediaNodeClient.kickPeer")],ce.prototype,"kick",1),de([T.trace("MediaNodeClient.kickAllPeers")],ce.prototype,"kickAll",1),de([T.trace("MediaNodeClient.muteAll")],ce.prototype,"muteAll",1),de([T.trace("MediaNodeClient.muteAllVideo")],ce.prototype,"muteAllVideo",1),de([T.trace("MediaNodeClient.disableAudio")],ce.prototype,"disableAudio",1),de([T.trace("MediaNodeClient.disableVideo")],ce.prototype,"disableVideo",1),de([T.trace("MediaNodeClient.pinPeer")],ce.prototype,"pinPeer",1),de([T.trace("MediaNodeClient.validateScreenShare")],ce.prototype,"validateScreenShare",1);function Dv(s,e,t){const r=s.getValue("roomNodeClient");if(r){if(r)return r;throw new Error("Room node client already set up.")}const n=new ce(s,e,t);return s.setValue("roomNodeClient",n),n}function Ov(s){const e=s.getValue("roomNodeClient");try{e==null||e.leaveRoom()}catch(t){u.error("roomNodeClient::cleanupRoomNodeClient")}s.setValue("roomNodeClient",void 0)}var nN=Object.defineProperty,iN=Object.getOwnPropertyDescriptor,An=(s,e,t,r)=>{for(var n=r>1?void 0:r?iN(e,t):e,i=s.length-1,a;i>=0;i--)(a=s[i])&&(n=(r?a(e,t,n):a(n))||n);return r&&n&&nN(e,t,n),n};const Nv=(Ty=class{constructor(s,e,t,r){g(this,$t);m(this,"self");m(this,"authToken");g(this,an,void 0);m(this,"viewType");g(this,Is,void 0);g(this,lt,void 0);const{socket:n}=t,i=s.getValue("authToken");this.self=e,v(this,lt,s),this.viewType=r,this.authToken=i,v(this,an,n),v(this,Is,t),e.config.viewType!==Et.Chat&&this.setupEvents()}get peerId(){return o(this,lt).getValue("peerId")}get mediaJoined(){return o(this,lt).getValue("connectionHandler").mediaJoined}static async init(s,e,t,r,n){const i=at(),a=s.getValue("peerId"),c=!!s.getValue("cachedUserDetails"),d=await st.__init__(s,t,r,n,n.name,c);if(navigator.product!=="ReactNative"){const l=!ee.hasFeature(se.PRECALL_BANDWIDTH_TEST);setTimeout(async()=>{const h=await d.getAllDevices();u.info("populated_full_device_list",{devices:JSON.stringify(h)}),G.devices("AUDIO",h==null?void 0:h.filter(p=>p.kind==="audioinput")),G.devices("VIDEO",h==null?void 0:h.filter(p=>p.kind==="videoinput")),G.devices("SPEAKER",h==null?void 0:h.filter(p=>p.kind==="audiooutput")),u.info("Callstats:: initializing");try{await G.initialize({peerId:a,engineName:_e.getDeviceInfo().engineName,env:s.getValue("env"),iceServers:await i.getICEServers(),apiBase:s.getValue("apiBase"),flags:ee.getAllFlags(),logger:u,apiHostnames:Yf(s),skipConnectivityChecks:l}),u.info("Callstats:: initialized")}catch(p){u.error("Callstats:: initialization failed",{error:p})}},0)}else u.info("Callstats:: Skipped initialization due to navigator product being ReactNative.");return new Nv(s,d,e,n.viewType)}async shareMediaTracks(){var c;const{audioTrack:s,videoTrack:e,permissions:t,audioEnabled:r,videoEnabled:n,screenShareEnabled:i,screenShareTracks:a}=this.self;if(t.canProduceAudio&&r)try{await o(this,$t,ps).shareMic(s)}catch(d){this.self.disableAudio()}if(t.canProduceVideo&&n)try{const d=await o(this,$t,ps).shareWebcam(e);d&&d.id!==e.id&&ee.hasFeature(se.EXP_RESHARE)&&await o(this,$t,ps).shareWebcam(d)}catch(d){this.self.disableVideo()}if(t.canProduceScreenshare&&i)try{await((c=o(this,$t,ps))==null?void 0:c.shareScreen({video:a.video,audio:a.audio}))}catch(d){this.self.disableScreenShare()}}async kickHandler(s){let e="kicked";(s==null?void 0:s.kickType)==="kickAll"&&(e="ended"),this.leaveRoom(e)}waitlistedHandler(){u.info("SelController.waitlisted"),this.self.waitlistStatus="waiting",this.self.roomState="waitlisted",this.self.emit("waitlisted")}waitlistAcceptHandler(){if(u.info("SelController.waitlistAccepted"),this.self.waitlistStatus==="accepted"){u.warn("SelfController.WAITLIST_ACCEPTED.UserAlreadyAccepted");return}this.self.waitlistStatus="accepted",this.joinRoom()}waitlistRejectedHandler(){if(u.info("SelfController.waitlistRejected"),this.self.waitlistStatus==="rejected"){u.warn("SelfController.WAITLIST_REJECTED.UserAlreadyRejected");return}this.self.waitlistStatus="rejected",this.leaveRoom("rejected")}async resetSelf(s){G.callEnded(),o(this,$t,ps).reset(),s&&await this.joinRoom(s)}setupEvents(){R.on(k.RESET_PRODUCER_STATE,async()=>{this.mediaJoined&&this.shareMediaTracks()}),R.on(k.ROOM_NODE_RECONNECTED,()=>{this.self.roomState="joined",this.self.emit("roomJoined",{reconnected:!0})}),R.on(k.ROOM_NODE_DISCONNECTED,()=>{this.self.roomState!=="disconnected"&&(this.self.roomState="disconnected",this.self.emit("roomLeft",{state:"disconnected"}))}),R.on(k.ROOM_NODE_FAILED,()=>{this.self.roomState="failed",this.self.emit("roomLeft",{state:"failed"})}),R.on(k.SOCKET_SERVICE_RECONNECTED,({wasJoinAttempted:s})=>{s===!1&&(this.self.roomState="init"),this.resetSelf(s)}),R.on(k.SOCKET_SERVICE_DISCONNECTED,({joinAttempted:s})=>{if(this.self.roomState==="disconnected")return;let{peerId:e}=this;s&&ee.hasFeature(se.REFRESH_ID_ON_DISCONNECTION)&&(e=hi()),o(this,an).updateURL(e),T.resetPeerId(e),at().setHeader("dyte-tracing-id",e),gn.remapContext(e,o(this,lt)),this.self.roomState="disconnected",this.self.emit("roomLeft",{state:"disconnected"})}),R.on(k.SOCKET_SERVICE_FAILED,()=>{this.self.roomState="failed",this.self.emit("roomLeft",{state:"failed"})}),o(this,Is).on(U.waitingRoomRequestAccepted,()=>{this.waitlistAcceptHandler()}),o(this,Is).on(Rd.updateUserPreset,s=>{s.updatePeersPresets.forEach(e=>{e.userIds===this.self.userId&&R.emit(k.UPDATE_PERMISSIONS,e.patch)})}),o(this,Is).on(U.waitingRoomRequestDenied,()=>{this.waitlistRejectedHandler()}),o(this,Is).on(U.kick,()=>{this.kickHandler({kickType:"kick"})}),o(this,Is).on(U.kickAll,()=>{this.kickHandler({kickType:"kickAll"})}),R.onAsync(k.JOIN_MEDIA_ROOM,this.joinMediaRoom.bind(this)),R.on(k.PRODUCER_SCORE_UPDATE,({score:s,kind:e,appData:t,scoreStats:r})=>{var i;const n=(i=t==null?void 0:t.screenShare)!=null?i:!1;this.self.emit("mediaScoreUpdate",{kind:e,isScreenshare:n,score:s,participantId:this.self.id,scoreStats:r})}),R.on(k.MUTE_SELF,async()=>{this.self.audioEnabled&&(await this.self.disableAudio(),G.audioOff())}),R.on(k.MUTE_SELF_VIDEO,async()=>{this.self.videoEnabled&&(await this.self.disableVideo(),G.videoOff())}),R.onAsync(k.LEAVE_MEDIA_ROOM,this.leaveMediaRoom.bind(this)),R.on(k.PIP_HANGUP,this.leaveRoom.bind(this))}async joinRoom(s=!1){try{const{peer:e}=await o(this,Is).joinRoom(this.self);o(this,Is).socket.flush();const t=Sh(e.stageType);if(o(this,lt).setValue("stageStatus",t,!1),e.waitlisted){this.waitlistedHandler();return}await this.joinMediaRoom(s),o(this,lt).notify("stageStatus")}catch(e){throw u.error("Error in joinRoom",{error:e}),e}}async leaveRoom(s="left"){var e,t;if(s==="rejected"){try{(e=o(this,an))==null||e.disconnect()}catch(r){u.error("SelfController::leaveRoom::socketDisconnect")}this.self.roomState=s,this.self.emit("roomLeft",{state:s});return}this.self.setIsPinned(!1),o(this,lt).setValue("stageStatus","OFF_STAGE",!1),await this.leaveMediaRoom(s),o(this,lt).notify("stageStatus");try{(t=o(this,an))==null||t.disconnect()}catch(r){u.error("SelfController::leaveRoom::socketDisconnect")}Ov(o(this,lt)),Fd.cleanup(),this.self.roomState=s,this.self.emit("roomLeft",{state:s})}partialMediaRoom(){var s;return(s=o(this,$t,ps))==null?void 0:s.partialJoinRoom(this.self.name,o(this,lt).getValue("meetingId"),void 0)}async joinMediaRoom(s=!1){var c,d;const{peerId:e,viewType:t,meetingId:r,stageStatus:n,roomNodeOptions:i}=o(this,lt).getAllValues(),{sfu:a}=i;try{if(t===Et.Livestream){if(n!=="ON_STAGE"){this.self.roomState="joined",this.self.emit("roomJoined",{reconnected:s});return}Dv(o(this,lt),a,{socket:o(this,an),peerId:e})}const{roomJoined:l}=(d=await((c=o(this,$t,ps))==null?void 0:c.joinRoom(this.self.name,r,{audio:this.self.audioEnabled,video:this.self.videoEnabled,screen:this.self.screenShareEnabled},s,s)))!=null?d:{};if(!l)return;n==="ON_STAGE"&&await this.shareMediaTracks(),this.self.roomState="joined",this.self.emit("roomJoined",{reconnected:s})}catch(l){throw u.error("Error:SelfController.mediaRoomJoin",l),new P("Error: could not join media room","0002")}}async leaveMediaRoom(s){const e=o(this,lt).getValue("viewType");s!=="connected-meeting"&&await this.cleanupSelf(),!(s==="stageLeft"&&e===Et.Webinar)&&o(this,$t,ps)&&(o(this,$t,ps).mediaJoined&&s!=="disconnected"&&await o(this,$t,ps).leaveRoom(),!(s==="stageLeft"&&e===Et.Livestream)&&(o(this,$t,ps).mediaJoined=!1))}async cleanupSelf(){await this.self.disableAudio(),await this.self.disableVideo(),await this.self.disableScreenShare(),this.self.cleanUpTracks(),this.self.destructMediaHandler(),navigator.isReactNative||this.self.removeDocumentEventListeners()}},an=new WeakMap,Is=new WeakMap,lt=new WeakMap,$t=new WeakSet,ps=function(){return o(this,lt).getValue("roomNodeClient")},Ty);let Mr=Nv;An([T.trace("SelfController.resetSelf")],Mr.prototype,"resetSelf",1),An([T.trace("SelfController.setupEvents")],Mr.prototype,"setupEvents",1),An([T.trace("SelfController.joinRoom")],Mr.prototype,"joinRoom",1),An([T.trace("SelfController.leaveRoom")],Mr.prototype,"leaveRoom",1),An([T.trace("SelfController.joinMediaRoom")],Mr.prototype,"joinMediaRoom",1),An([T.trace("SelfController.leaveMediaRoom")],Mr.prototype,"leaveMediaRoom",1),An([T.trace("SelfController.init")],Mr,"init",1);class aN{constructor(e){g(this,lc,void 0);v(this,lc,e)}on(e,t){let r;e===U.roomPeerCount?r=Rg.fromBinary.bind(Rg):r=qg.fromBinary.bind(qg),o(this,lc).on(e,({payload:n})=>{const i=r(n);return t(i)})}}lc=new WeakMap;class oN{constructor(e){g(this,uc,void 0);v(this,uc,e)}on(e,t){let r,n;switch(e){case U.transcript:{r=eh.fromBinary.bind(eh),n=eh.create();break}default:{u.debug("AISocketHandler switch case hit default, event not accounted for.");break}}o(this,uc).on(e,({payload:i})=>{let a=n;try{a=r(i)}catch(c){u.error("chatSocketHandler::on::binary_decode_error",{error:c})}return t(a)})}}uc=new WeakMap;var cN=Object.defineProperty,dN=Object.getOwnPropertyDescriptor,$h=(s,e,t,r)=>{for(var n=r>1?void 0:r?dN(e,t):e,i=s.length-1,a;i>=0;i--)(a=s[i])&&(n=(r?a(e,t,n):a(n))||n);return r&&n&&cN(e,t,n),n};class Kd{constructor(e){g(this,fr,void 0);v(this,fr,e)}getPolls(){return o(this,fr).sendMessagePromise(Qs.getPolls)}createPoll(e,t,r=!1,n=!1){const i={anonymous:r,hideVotes:n,question:e,options:t};return o(this,fr).sendMessage(Qs.createPoll,qM.toBinary(i))}votePoll(e,t){const r={index:t,pollId:e};return o(this,fr).sendMessage(Qs.votePoll,GM.toBinary(r))}on(e,t){let r,n;switch(e){case Qs.updatePoll:case Qs.createPoll:case Qs.votePoll:{r=ph.fromBinary.bind(ph),n=ph.create();break}}o(this,fr).on(e,({payload:i})=>{let a=n;try{a=r(i)}catch(c){u.error("pollSocketHandler::on::binary_decode_error",{error:c})}return t(a)})}removeListeners(e){o(this,fr).removeListeners(e)}}fr=new WeakMap,$h([T.trace("PollSocketHandler.getPolls")],Kd.prototype,"getPolls",1),$h([T.trace("PollSocketHandler.createPoll")],Kd.prototype,"createPoll",1),$h([T.trace("PollSocketHandler.votePoll")],Kd.prototype,"votePoll",1);class lN{constructor(e){g(this,Ht,void 0);v(this,Ht,e)}async getStageRequests(){const{payload:e}=await o(this,Ht).sendMessagePromise(U.getStageRequests);return e?hh.fromBinary(e):{stageRequests:[]}}requestAccess(){o(this,Ht).sendMessage(U.requestStageAccess)}cancelRequestAccess(){o(this,Ht).sendMessage(U.cancelStageRequest)}async grantAccess(e){const t={userIds:e};o(this,Ht).sendMessage(U.grantStageAccess,OM.toBinary(t))}async denyAccess(e){const t={userIds:e};o(this,Ht).sendMessage(U.denyStageAccess,LM.toBinary(t))}joinStage(){return o(this,Ht).sendMessagePromise(U.joinStage,void 0,void 0,U.peerStageStatusUpdate)}leaveStage(e){const t={userIds:[e]};return o(this,Ht).sendMessagePromise(U.leaveStage,Gg.toBinary(t),void 0,U.peerStageStatusUpdate)}kick(e){const t={userIds:e};return o(this,Ht).sendMessagePromise(U.leaveStage,Gg.toBinary(t))}on(e,t){let r;switch(e){case U.grantStageAccess:case U.denyStageAccess:{r=void 0;break}case U.getStagePeers:{r=jg.fromBinary.bind(jg);break}case U.getStageRequests:case U.requestStageAccess:case U.cancelStageRequest:{r=hh.fromBinary.bind(hh);break}case U.peerStageStatusUpdate:{r=Cg.fromBinary.bind(Cg);break}}o(this,Ht).on(e,({payload:n,id:i})=>{if(!n||!r)return t(void 0,i);const a=r(n);return t(a,i)})}async getPeerInfo(e){const t=await o(this,Ht).sendMessagePromise(U.getPeerInfo,Ag.toBinary({peerId:e}));return Si.fromBinary(t.payload)}}Ht=new WeakMap;class uN{constructor(e){g(this,Ze,void 0);v(this,Ze,e)}addPlugin(e,t){o(this,Ze).sendMessage(J.addPlugin,Y0.toBinary({pluginId:e,staggered:t}))}removePlugin(e){o(this,Ze).sendMessage(J.removePlugin,X0.toBinary({pluginId:e,staggered:!1}))}async getActivePlugins(){const{payload:e}=await o(this,Ze).sendMessagePromise(J.getPlugins);return e?EM.fromBinary(e):{plugins:[]}}customPluginEventToRoom(e,t,r){const n={pluginId:e,pluginData:new TextEncoder().encode(JSON.stringify(t))};o(this,Ze).sendMessage(J.customPluginEventToRoom,cM.toBinary(n),r)}customPluginEventToPeers(e,t,r,n){const i={pluginId:e,peerIds:t,pluginData:new TextEncoder().encode(JSON.stringify(r))};o(this,Ze).sendMessage(J.customPluginEventToPeers,lM.toBinary(i),n)}enablePluginForRoom(e,t){o(this,Ze).sendMessage(J.enablePluginForRoom,eM.toBinary({pluginId:e}),t)}enablePluginForPeers(e,t,r){o(this,Ze).sendMessage(J.enablePluginForPeers,nM.toBinary({pluginId:e,peerIds:t}),r)}disablePluginForRoom(e,t){o(this,Ze).sendMessage(J.disablePluginForRoom,sM.toBinary({pluginId:e}),t)}disablePluginForPeers(e,t,r){o(this,Ze).sendMessage(J.disablePluginForPeers,aM.toBinary({pluginId:e,peerIds:t}),r)}storeInsertKeys(e,t,r,n){const i={pluginId:e,storeName:t,insertKeys:r.map(a=>({storeKey:a.key,payload:new TextEncoder().encode(JSON.stringify(a.payload))}))};o(this,Ze).sendMessage(J.storeInsertKeys,Fg.toBinary(i),n)}storeGetKeys(e,t,r,n){const i={pluginId:e,storeName:t,getKeys:r.map(a=>({storeKey:a.key}))};o(this,Ze).sendMessage(J.storeGetKeys,mM.toBinary(i),n)}storeDeleteKeys(e,t,r,n){const i={pluginId:e,storeName:t,deleteKeys:r.map(a=>({storeKey:a.key}))};o(this,Ze).sendMessage(J.storeDeleteKeys,gM.toBinary(i),n)}storeDelete(e,t,r){o(this,Ze).sendMessage(J.storeDelete,yM.toBinary({pluginId:e,storeName:t}),r)}getPluginDataOld(e,t){u.info("getPluginDataOld",{plugin:{id:e,storeName:t}})}storePluginDataOld(e,t,r){const n={pluginId:e,storeName:t,insertKeys:[{storeKey:r.key,payload:new TextEncoder().encode(JSON.stringify(r))}]};o(this,Ze).sendMessage(J.storeInsertKeys,Fg.toBinary(n))}on(e,t){let r;switch(e){case J.addPlugin:case J.enablePluginForPeers:case J.enablePluginForRoom:{r=uh.fromBinary.bind(uh);break}case J.removePlugin:case J.disablePluginForPeers:case J.disablePluginForRoom:{r=Bg.fromBinary.bind(Bg);break}case J.customPluginEventToPeers:case J.customPluginEventToRoom:{r=Hg.fromBinary.bind(Hg);break}case J.storeInsertKeys:case J.storeGetKeys:case J.storeDeleteKeys:case J.storeDelete:{r=$g.fromBinary.bind($g);break}}o(this,Ze).on(e,({payload:n,id:i})=>{const a=r(n);return t(a,i)})}}Ze=new WeakMap;var hN=Object.defineProperty,pN=(s,e,t)=>e in s?hN(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,mN=(s,e,t)=>(pN(s,typeof e!="symbol"?e+"":e,t),t),Hh=(s,e,t)=>{if(!e.has(s))throw TypeError("Cannot "+t)},N=(s,e,t)=>(Hh(s,e,"read from private field"),t?t.call(s):e.get(s)),be=(s,e,t)=>{if(e.has(s))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(s):e.set(s,t)},he=(s,e,t,r)=>(Hh(s,e,"write to private field"),r?r.call(s,t):e.set(s,t),t),Ce=(s,e,t)=>(Hh(s,e,"access private method"),t),Dr,Mn,Dn,xe,On,Re,Be,Or,rt,er,Nr,bs,Mi,tr,qh,Lv,fo,zd,jh,xv,Gh,Vv,Yd,Wh,Jh,Uv,go,Qd,vo,Xd,Zd,Kh,Di,yo,To,el,zh={exports:{}},Oi=typeof Reflect=="object"?Reflect:null,Fv=Oi&&typeof Oi.apply=="function"?Oi.apply:function(e,t,r){return Function.prototype.apply.call(e,t,r)},tl;Oi&&typeof Oi.ownKeys=="function"?tl=Oi.ownKeys:Object.getOwnPropertySymbols?tl=function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:tl=function(e){return Object.getOwnPropertyNames(e)};function fN(s){console&&console.warn&&console.warn(s)}var Bv=Number.isNaN||function(e){return e!==e};function me(){me.init.call(this)}zh.exports=me,zh.exports.once=TN,me.EventEmitter=me,me.prototype._events=void 0,me.prototype._eventsCount=0,me.prototype._maxListeners=void 0;var $v=10;function sl(s){if(typeof s!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof s)}Object.defineProperty(me,"defaultMaxListeners",{enumerable:!0,get:function(){return $v},set:function(s){if(typeof s!="number"||s<0||Bv(s))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+s+".");$v=s}}),me.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},me.prototype.setMaxListeners=function(e){if(typeof e!="number"||e<0||Bv(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this};function Hv(s){return s._maxListeners===void 0?me.defaultMaxListeners:s._maxListeners}me.prototype.getMaxListeners=function(){return Hv(this)},me.prototype.emit=function(e){for(var t=[],r=1;r<arguments.length;r++)t.push(arguments[r]);var n=e==="error",i=this._events;if(i!==void 0)n=n&&i.error===void 0;else if(!n)return!1;if(n){var a;if(t.length>0&&(a=t[0]),a instanceof Error)throw a;var c=new Error("Unhandled error."+(a?" ("+a.message+")":""));throw c.context=a,c}var d=i[e];if(d===void 0)return!1;if(typeof d=="function")Fv(d,this,t);else for(var l=d.length,h=Jv(d,l),r=0;r<l;++r)Fv(h[r],this,t);return!0};function qv(s,e,t,r){var n,i,a;if(sl(t),i=s._events,i===void 0?(i=s._events=Object.create(null),s._eventsCount=0):(i.newListener!==void 0&&(s.emit("newListener",e,t.listener?t.listener:t),i=s._events),a=i[e]),a===void 0)a=i[e]=t,++s._eventsCount;else if(typeof a=="function"?a=i[e]=r?[t,a]:[a,t]:r?a.unshift(t):a.push(t),n=Hv(s),n>0&&a.length>n&&!a.warned){a.warned=!0;var c=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");c.name="MaxListenersExceededWarning",c.emitter=s,c.type=e,c.count=a.length,fN(c)}return s}me.prototype.addListener=function(e,t){return qv(this,e,t,!1)},me.prototype.on=me.prototype.addListener,me.prototype.prependListener=function(e,t){return qv(this,e,t,!0)};function gN(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function jv(s,e,t){var r={fired:!1,wrapFn:void 0,target:s,type:e,listener:t},n=gN.bind(r);return n.listener=t,r.wrapFn=n,n}me.prototype.once=function(e,t){return sl(t),this.on(e,jv(this,e,t)),this},me.prototype.prependOnceListener=function(e,t){return sl(t),this.prependListener(e,jv(this,e,t)),this},me.prototype.removeListener=function(e,t){var r,n,i,a,c;if(sl(t),n=this._events,n===void 0)return this;if(r=n[e],r===void 0)return this;if(r===t||r.listener===t)--this._eventsCount===0?this._events=Object.create(null):(delete n[e],n.removeListener&&this.emit("removeListener",e,r.listener||t));else if(typeof r!="function"){for(i=-1,a=r.length-1;a>=0;a--)if(r[a]===t||r[a].listener===t){c=r[a].listener,i=a;break}if(i<0)return this;i===0?r.shift():vN(r,i),r.length===1&&(n[e]=r[0]),n.removeListener!==void 0&&this.emit("removeListener",e,c||t)}return this},me.prototype.off=me.prototype.removeListener,me.prototype.removeAllListeners=function(e){var t,r,n;if(r=this._events,r===void 0)return this;if(r.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):r[e]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete r[e]),this;if(arguments.length===0){var i=Object.keys(r),a;for(n=0;n<i.length;++n)a=i[n],a!=="removeListener"&&this.removeAllListeners(a);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(t=r[e],typeof t=="function")this.removeListener(e,t);else if(t!==void 0)for(n=t.length-1;n>=0;n--)this.removeListener(e,t[n]);return this};function Gv(s,e,t){var r=s._events;if(r===void 0)return[];var n=r[e];return n===void 0?[]:typeof n=="function"?t?[n.listener||n]:[n]:t?yN(n):Jv(n,n.length)}me.prototype.listeners=function(e){return Gv(this,e,!0)},me.prototype.rawListeners=function(e){return Gv(this,e,!1)},me.listenerCount=function(s,e){return typeof s.listenerCount=="function"?s.listenerCount(e):Wv.call(s,e)},me.prototype.listenerCount=Wv;function Wv(s){var e=this._events;if(e!==void 0){var t=e[s];if(typeof t=="function")return 1;if(t!==void 0)return t.length}return 0}me.prototype.eventNames=function(){return this._eventsCount>0?tl(this._events):[]};function Jv(s,e){for(var t=new Array(e),r=0;r<e;++r)t[r]=s[r];return t}function vN(s,e){for(;e+1<s.length;e++)s[e]=s[e+1];s.pop()}function yN(s){for(var e=new Array(s.length),t=0;t<e.length;++t)e[t]=s[t].listener||s[t];return e}function TN(s,e){return new Promise(function(t,r){function n(a){s.removeListener(e,i),r(a)}function i(){typeof s.removeListener=="function"&&s.removeListener("error",n),t([].slice.call(arguments))}Kv(s,e,i,{once:!0}),e!=="error"&&SN(s,n,{once:!0})})}function SN(s,e,t){typeof s.on=="function"&&Kv(s,"error",e,t)}function Kv(s,e,t,r){if(typeof s.on=="function")r.once?s.once(e,t):s.on(e,t);else if(typeof s.addEventListener=="function")s.addEventListener(e,function n(i){r.once&&s.removeEventListener(e,n),t(i)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof s)}var EN=zh.exports;class _N extends S{constructor(){super("message.v1.SocketMessage",[{no:1,name:"event",kind:"scalar",T:13},{no:2,name:"id",kind:"scalar",opt:!0,T:9},{no:3,name:"payload",kind:"scalar",opt:!0,T:12},{no:4,name:"metadata",kind:"scalar",opt:!0,T:12}])}}const zv=new _N;class Yv{static encode(e){return zv.toBinary(e)}static decode(e){return zv.fromBinary(new Uint8Array(e))}}function bN(s,e){return Math.floor(Math.random()*(e-s+1)+s)}class wN{constructor(e={}){mN(this,"opts"),be(this,Dr,void 0),this.opts={initialTimeout:e.initialTimeout||1e3,maxTimeout:e.maxTimeout||1e4,factor:e.factor||2},he(this,Dr,0)}async wait(){he(this,Dr,N(this,Dr)+1);const e=bN(0,Math.min(this.opts.maxTimeout,this.opts.initialTimeout*2**N(this,Dr)));await new Promise(t=>{setTimeout(t,e)})}getAttempts(){return N(this,Dr)}reset(){he(this,Dr,0)}}Dr=new WeakMap;const Lr={debug:0,info:1,warn:2,error:3};class PN{constructor(e){be(this,Mn,void 0),be(this,Dn,void 0),he(this,Mn,console),he(this,Dn,e)}debug(...e){Lr[N(this,Dn)]>Lr.debug||N(this,Mn).debug("[Sockrates]:",...e)}info(...e){Lr[N(this,Dn)]>Lr.info||N(this,Mn).info("[Sockrates]:",...e)}warn(...e){Lr[N(this,Dn)]>Lr.warn||N(this,Mn).warn("[Sockrates]:",...e)}error(...e){Lr[N(this,Dn)]>Lr.error||N(this,Mn).error("[Sockrates]:",...e)}}Mn=new WeakMap,Dn=new WeakMap;var Qv=(s=>(s[s.CONNECTING=0]="CONNECTING",s[s.OPEN=1]="OPEN",s[s.CLOSING=2]="CLOSING",s[s.CLOSED=3]="CLOSED",s))(Qv||{});const CN="2",RN="3";class kN{constructor(e,t){be(this,qh),be(this,fo),be(this,jh),be(this,Gh),be(this,Yd),be(this,Jh),be(this,go),be(this,vo),be(this,Zd),be(this,Di),be(this,To),be(this,xe,void 0),be(this,On,void 0),be(this,Re,void 0),be(this,Be,void 0),be(this,Or,void 0),be(this,rt,void 0),be(this,er,void 0),be(this,Nr,void 0),be(this,bs,void 0),be(this,Mi,void 0),be(this,tr,void 0);var r,n,i,a,c,d,l,h,p,f,y,_,b,I,x,B,H,M,z;he(this,On,e),he(this,Or,[]),he(this,rt,new EN),he(this,er,!0),he(this,bs,!1),he(this,Re,t!=null?t:{}),(n=(r=N(this,Re)).autoReconnect)!=null||(r.autoReconnect=!0),(a=(i=N(this,Re)).retryConnectionInterval)!=null||(i.retryConnectionInterval=1e3),(d=(c=N(this,Re)).pingTimeout)!=null||(c.pingTimeout=3e4),(h=(l=N(this,Re)).connectionTimeout)!=null||(l.connectionTimeout=5e3),(f=(p=N(this,Re)).debug)!=null||(p.debug=!0),(_=(y=N(this,Re)).maxReconnectionAttempts)!=null||(y.maxReconnectionAttempts=10),(I=(b=N(this,Re)).disconnectOnPingTimeout)!=null||(b.disconnectOnPingTimeout=!0),(B=(x=N(this,Re)).queueOnDisconnect)!=null||(x.queueOnDisconnect=!1),(M=(H=N(this,Re)).flushOnReconnect)!=null||(H.flushOnReconnect=!1),he(this,Nr,{code:void 0,reason:void 0}),he(this,Be,(z=N(this,Re).logger)!=null?z:new PN(N(this,Re).debug?"debug":"info")),he(this,tr,new wN)}get readyState(){var e;return(e=N(this,xe))==null?void 0:e.readyState}get url(){return N(this,On)}updateURL(e){he(this,On,e),Ce(this,Jh,Uv).call(this)}get config(){return N(this,Re)}get sendQueue(){return N(this,Or)}flush(){if(!N(this,Re).queueOnDisconnect)return!1;const e=[];return N(this,Or).forEach(t=>{this.send(t.event,t.id,t.payload,t.metadata)||e.push(t)}),he(this,Or,e),N(this,Or)}async connect(e=!1){if(!e&&[0,1].includes(this.readyState)){N(this,Be).debug("Websocket was already connecting or connected.");return}if(N(this,er)!==!1)return new Promise((t,r)=>{Ce(this,Di,yo).call(this),Ce(this,To,el).call(this);try{he(this,xe,new WebSocket(Ce(this,qh,Lv).call(this,N(this,On)))),N(this,xe).binaryType="arraybuffer",N(this,Be).debug("Connecting to",N(this,On));const n=setTimeout(()=>{N(this,Be).debug("Connection timeout. Closing socket"),he(this,er,!0),Ce(this,To,el).call(this),N(this,xe).close(3001,"Connection Timeout"),N(this,Re).autoReconnect&&!N(this,bs)&&(N(this,rt).emit("reconnecting"),Ce(this,go,Qd).call(this)),r(new Error("Connection timed out!"))},N(this,Re).connectionTimeout);N(this,xe).onopen=()=>{N(this,Be).debug(`Ready State: ${Qv[N(this,xe).readyState]}`),n&&clearTimeout(n),Ce(this,Zd,Kh).call(this),he(this,Nr,{code:void 0,reason:void 0}),N(this,rt).emit("connected"),N(this,Re).flushOnReconnect&&this.flush(),t()},N(this,xe).onclose=i=>{try{n&&clearTimeout(n);const{code:a,reason:c}=i;r(c),N(this,Be).debug("Socket closed. Close event:",i),N(this,Be).debug("Connection closed code:",a),N(this,Be).debug("Connection closed reason:",c),N(this,bs)||Ce(this,Yd,Wh).call(this,a,c)}catch(a){Ce(this,fo,zd).call(this,a)}},N(this,xe).onerror=i=>{Ce(this,fo,zd).call(this,i)},N(this,xe).onmessage=i=>Ce(this,jh,xv).call(this,i)}catch(n){Ce(this,fo,zd).call(this,n,r)}})}send(e,t,r,n){const i={event:e,id:t,payload:r,metadata:n};if(N(this,Re).queueOnDisconnect&&(!N(this,xe)||N(this,xe).readyState!==1))return N(this,Be).debug("Queuing message since socket is not connected!",i),N(this,Or).push(i),!1;const a=Yv.encode(i);return Ce(this,vo,Xd).call(this,a)}emit(e,t,r,n){return this.send(e,t,r,n)}sendRaw(e){return Ce(this,vo,Xd).call(this,e)}receive(e,t){return N(this,rt).on(e.toString(),t)}on(e,t){if(typeof e=="string"&&(e==="connected"||e==="disconnected"||e==="errored"||e==="reconnected"||e==="reconnecting"||e==="reconnectAttempt"||e==="reconnectFailure"||e==="failed")){N(this,rt).on(e,t);return}this.receive(e,t)}removeAllListeners(){N(this,rt).removeAllListeners()}removeReceiver(e,t){this.removeListener(e,t)}removeListener(e,t){N(this,rt).removeListener(e.toString(),t)}removeReceivers(e){this.removeListeners(e)}removeListeners(e){N(this,rt).listeners(e.toString()).map(t=>this.removeListener(e,t))}disconnect(){he(this,er,!1),Ce(this,Di,yo).call(this),this.removeAllListeners(),he(this,Nr,{code:1e3,reason:"Sockrates disconnect method called"}),N(this,xe).close(1e3,"Sockrates disconnect method called.")}}xe=new WeakMap,On=new WeakMap,Re=new WeakMap,Be=new WeakMap,Or=new WeakMap,rt=new WeakMap,er=new WeakMap,Nr=new WeakMap,bs=new WeakMap,Mi=new WeakMap,tr=new WeakMap,qh=new WeakSet,Lv=function(s){if(s.startsWith("ws://")||s.startsWith("wss://"))return s;if(s.startsWith("https://"))return`wss://${s.substring(8)}`;if(s.startsWith("http://"))return`ws://${s.substring(7)}`;throw new Error("Invalid URL. URL must start with http(s):// or ws(s)://.")},fo=new WeakSet,zd=function(s,e){N(this,Be).error("Error:",{error:s}),N(this,rt).emit("errored",{error:s}),e==null||e(s)},jh=new WeakSet,xv=function(s){if(Ce(this,Zd,Kh).call(this),s.data===CN){N(this,Be).debug("Received ping from server"),Ce(this,vo,Xd).call(this,RN);return}const e=Yv.decode(s.data),{id:t,payload:r}=e;N(this,Be).debug("Received message",{event:e.event,messageID:t}),N(this,rt).emit(e.event.toString(),{id:t,payload:r})},Gh=new WeakSet,Vv=function(){return N(this,xe).readyState===1},Yd=new WeakSet,Wh=function(s,e){he(this,Nr,{reason:e,code:s}),N(this,rt).emit("disconnected",{code:s,reason:e})},Jh=new WeakSet,Uv=function(){const{reason:s,code:e}=N(this,Nr);e&&e!==1e3&&N(this,er)&&N(this,Re).autoReconnect&&!N(this,bs)&&(N(this,Be).debug(`Triggering reconnection due to ${s}.`),N(this,rt).emit("reconnecting"),Ce(this,go,Qd).call(this))},go=new WeakSet,Qd=async function(s=!0){if(s&&N(this,bs)){N(this,Be).debug("Reconnect called when already in a reconnect loop. Ignoring.");return}if(N(this,bs)||N(this,tr).reset(),N(this,Re).maxReconnectionAttempts!==null&&N(this,tr).getAttempts()>=N(this,Re).maxReconnectionAttempts){N(this,rt).emit("failed"),he(this,bs,!1);return}he(this,bs,!0),Ce(this,To,el).call(this),Ce(this,Di,yo).call(this);try{if(await N(this,tr).wait(),N(this,er)===!1)return;if(N(this,Be).debug(`Reconnection attempt ${N(this,tr).getAttempts()}`),N(this,rt).emit("reconnectAttempt",{attempt:N(this,tr).getAttempts()}),await this.connect(),!Ce(this,Gh,Vv).call(this))throw Error("Reconnect Failed");he(this,bs,!1),he(this,Nr,{code:void 0,reason:void 0}),N(this,rt).emit("reconnected")}catch(e){N(this,Be).debug("Failed to reconnect."),N(this,rt).emit("reconnectFailure",{attempt:N(this,tr).getAttempts()}),Ce(this,go,Qd).call(this,!1)}},vo=new WeakSet,Xd=function(s){try{return N(this,xe).send(s),!0}catch(e){return N(this,Be).error(e.message),!1}},Zd=new WeakSet,Kh=function(){this.config.disconnectOnPingTimeout&&(N(this,Be).debug("Resetting ping timeout"),Ce(this,Di,yo).call(this),he(this,Mi,setTimeout(()=>{var s;N(this,Be).debug("Disconnecting the socket due to ping timeout"),he(this,er,!0);const e=3002,t="Ping timeout";(s=N(this,xe))==null||s.close(e,t),Ce(this,Yd,Wh).call(this,e,t)},N(this,Re).pingTimeout)))},Di=new WeakSet,yo=function(){N(this,Mi)&&(clearTimeout(N(this,Mi)),he(this,Mi,void 0))},To=new WeakSet,el=function(){N(this,xe)&&(N(this,xe).onopen=void 0,N(this,xe).onerror=void 0,N(this,xe).onmessage=void 0,N(this,xe).onclose=void 0)};var IN=Object.defineProperty,AN=Object.getOwnPropertyDescriptor,rl=(s,e,t,r)=>{for(var n=r>1?void 0:r?AN(e,t):e,i=s.length-1,a;i>=0;i--)(a=s[i])&&(n=(r?a(e,t,n):a(n))||n);return r&&n&&IN(e,t,n),n};const Xv=65535,MN=3e3,Zv=(Sy=class{constructor(s,{peerId:e,meetingId:t,authToken:r,capabilities:n}){g(this,De);g(this,hc);g(this,pc);g(this,on,void 0);g(this,Me,void 0);m(this,"roomName");m(this,"authToken");m(this,"capabilities");g(this,us,void 0);g(this,gr,void 0);var i;if(!e||!t||!r)throw new P("peerId, meetingId, or authToken can not be empty","0404");v(this,us,void 0),v(this,gr,s),this.capabilities=n,this.roomName=t,this.authToken=r,v(this,on,$(this,hc,gp).call(this,e)),v(this,Me,new kN(o(this,on),{autoReconnect:!0,disconnectOnPingTimeout:(i=n.includes("PING"))!=null?i:!1,queueOnDisconnect:!0,flushOnReconnect:!1,logger:u})),this.handleSocketConnectionEvents()}get joinAttempted(){return o(this,De,Ge).socketJoinAttempted}set joinAttempted(s){o(this,De,Ge).socketJoinAttempted=s}get peerId(){return o(this,gr).getValue("peerId")}updateURL(s){s!==this.peerId&&(v(this,on,$(this,hc,gp).call(this,s)),u.debug("SocketService:: Connection URL updated.")),o(this,Me).updateURL(o(this,on))}static getSocketEdgeDomain(s){return yi({servicePrefix:"socket-edge",baseURI:s})}get url(){return o(this,on)}async connect(){o(this,De,Ge).socketJoinAttempted=!0,await o(this,Me).connect(),o(this,De,Ge).socketJoinAttempted=!0,o(this,De,Ge).socketState={state:"connected",reconnected:!1,reconnectionAttempt:void 0}}async disconnect(){o(this,De,Ge).socketJoinAttempted=!1,o(this,Me).disconnect(),o(this,De,Ge).socketJoinAttempted=!0,o(this,De,Ge).socketState={state:"disconnected",reconnected:!1,reconnectionAttempt:void 0}}get isConnected(){try{return o(this,Me).readyState===1}catch(s){return!1}}sendMessage(s,e,t){const r={};return T.injectContext(r),o(this,Me).send(s,t!=null?t:$(this,pc,vp).call(this),e,new TextEncoder().encode(JSON.stringify(r)))}sendMessagePromise(s,e,t,r){const n=parseInt({}.SOCKET_SERVICE_MESSAGE_REQUEST_TIMEOUT,10)||2e4;return this.sendMessagePromiseWithTimeout({event:s,timeout:n,protobuf:e,messageId:t,resp:r})}sendMessagePromiseWithTimeout({event:s,timeout:e,protobuf:t,messageId:r,resp:n}){const i=n!=null?n:s;return new Promise((a,c)=>{const d=(y,_)=>{o(this,Me).removeListener(i,y),o(this,Me).removeListener(Xv,_),o(this,Me).removeListener(es.errorResponse,_),o(this,Me).removeListener(ys.errorResponse,_)},l=r!=null?r:$(this,pc,vp).call(this),h={};T.injectContext(h);const p=({id:y,payload:_})=>{if(l===y){let b;try{const I=lk.fromBinary(_);b=new Error(I.errorMessage)}catch(I){b=new Error("failed to parse error message",{cause:I});try{const x=hI.fromBinary(_);b=new Error(x.message)}catch(x){b=new Error("failed to parse error message",{cause:x})}}c(b),d(f,p)}},f=({id:y,payload:_})=>{l===y&&(a({id:y,payload:_}),d(f,p))};o(this,Me).on(i,f),o(this,Me).on(Xv,p),o(this,Me).on(es.errorResponse,p),o(this,Me).on(ys.errorResponse,p),setTimeout(()=>{d(f,p),c(new Error(`request timeout for callback eventId:${s}`))},e),o(this,Me).send(s,l,t,new TextEncoder().encode(JSON.stringify(h)))})}on(s,e){o(this,Me).on(s,e)}onStateEvent(s,e){o(this,Me).on(s,e)}removeListener(s,e){o(this,Me).removeListener(s,e)}removeListeners(s){o(this,Me).removeListeners(s)}flush(){return o(this,Me).flush()}handleSocketConnectionEvents(){this.onStateEvent("connected",async()=>{u.info("SocketService::Connected to socket-edge"),o(this,us)&&(clearTimeout(o(this,us)),v(this,us,void 0)),o(this,De,Ge).updateSocketConnectionState("connected")}),this.onStateEvent("disconnected",({code:s,reason:e})=>{var n;u.info("SocketService::Disconnected from socket-edge",{error:{code:s,reason:e},country:T.location.country});const{recv:t,send:r}=(n=o(this,De,Ge).mediaState)!=null?n:{};t!=null&&t.state&&(t==null?void 0:t.state)!==kr.CONNECTED||r!=null&&r.state&&(r==null?void 0:r.state)!==kr.CONNECTED?R.emit(k.SOCKET_SERVICE_DISCONNECTED,{joinAttempted:o(this,De,Ge).joinAttempted}):v(this,us,setTimeout(()=>{R.emit(k.SOCKET_SERVICE_DISCONNECTED,{joinAttempted:o(this,De,Ge).joinAttempted}),v(this,us,void 0)},MN)),o(this,De,Ge).updateSocketConnectionState("disconnected")}),this.onStateEvent("reconnecting",async()=>{u.info("SocketService::Reconnecting to socket-edge",{country:T.location.country}),o(this,De,Ge).updateSocketConnectionState("reconnecting")}),this.onStateEvent("reconnectAttempt",async({attempt:s})=>{u.info("SocketService::Attempting to reconnect to socket-edge",{socket:{retryAttempt:s}}),o(this,De,Ge).updateSocketConnectionState("reconnectAttempt",s)}),this.onStateEvent("reconnectFailure",({attempt:s})=>{u.info("SocketService::Reconnect attempt to socket-edge failed",{socket:{retryAttempt:s}}),o(this,De,Ge).updateSocketConnectionState("reconnectFailure",s)}),this.onStateEvent("reconnected",async()=>{u.info("SocketService::Reconnected to socket-edge",{connectionState:{joinAttempted:o(this,De,Ge).mediaJoinAttempted}}),o(this,us)&&(clearTimeout(o(this,us)),v(this,us,void 0)),R.emit(k.SOCKET_SERVICE_RECONNECTED,{wasJoinAttempted:o(this,De,Ge).mediaJoinAttempted}),o(this,De,Ge).updateSocketConnectionState("reconnected")}),this.onStateEvent("failed",async()=>{u.info("SocketService::Failed to connect to socket-edge",{country:T.location.country}),R.emit(k.SOCKET_SERVICE_FAILED),o(this,De,Ge).updateSocketConnectionState("failed")})}},on=new WeakMap,Me=new WeakMap,De=new WeakSet,Ge=function(){return o(this,gr).getValue("connectionHandler")},us=new WeakMap,gr=new WeakMap,hc=new WeakSet,gp=function(s){let e=Zv.getSocketEdgeDomain(o(this,gr).getValue("baseURI"));typeof dd(o(this,gr),"socket_server_base")=="string"&&(e=dd(o(this,gr),"socket_server_base"));const t=`wss://${e}`,r=new URL(`${t}/ws`),n=this.peerId,i={roomID:this.roomName,peerID:s,authToken:this.authToken,useMediaV2:!0,...n!==s&&{oldPeerID:n},ping:this.capabilities.includes("PING"),capabilities:this.capabilities.map(a=>_d[a]).join(" "),joinWithDetails:!0,useCfWorker:!0};return Object.entries(i).forEach(([a,c])=>{r.searchParams.append(a,c.toString())}),r.href},pc=new WeakSet,vp=function(){return`${this.peerId}-${(Math.random()+1).toString(36).substring(7)}`},Sy);let So=Zv;rl([T.trace("SocketService.connect")],So.prototype,"connect",1),rl([T.trace("SocketService.disconnect")],So.prototype,"disconnect",1),rl([T.trace("SocketService.sendMessagePromise")],So.prototype,"sendMessagePromise",1),rl([T.trace("SocketService.sendMessagePromiseWithTimeout")],So.prototype,"sendMessagePromiseWithTimeout",1);const cn=class{static handleConnectedRoomsDumpRaw({payload:e}){var i;const t=FI.fromBinary(e),r=t.meetings.map(a=>{var c;return{id:a.id,title:a.title,participants:(c=a.participants)!=null?c:[]}});return{parentMeeting:{id:t.parentMeeting.id,title:t.parentMeeting.title,participants:(i=t.parentMeeting.participants)!=null?i:[]},meetings:r}}static handleTransferPeerRaw({payload:e}){const t=uA.fromBinary(e);return{authToken:t.authToken,meetingId:t.meetingId}}static handleMovedPeerRaw({payload:e}){const t=Og.fromBinary(e);return{meetingId:t.meetingId,customParticipantId:t.customParticipantId}}static handleConnectedRoomsUpdatedRaw({payload:e}){return Dg.fromBinary(e).payloads.map(r=>({id:r.id,title:r.title}))}static handleConnectedRoomsDeletedRaw({payload:e}){return tA.fromBinary(e).payloads}static async getConnectedRoomsDump(){const e=await cn.socketService.sendMessagePromise(U.getConnectedRoomsDump);return cn.handleConnectedRoomsDumpRaw(e)}static async createConnectedRooms(e){const{payload:t}=await cn.socketService.sendMessagePromise(U.createConnectedRooms,qI.toBinary({payloads:e}));return Dg.fromBinary(t).payloads.map(n=>({id:n.id,title:n.title}))}static async updateConnectedRooms(e){}static async disableConnectedRooms(e){const t=e.map(n=>({id:n})),r=await cn.socketService.sendMessagePromise(U.deleteConnectedRooms,ZI.toBinary({payloads:t}));return cn.handleConnectedRoomsDeletedRaw(r)}static async movePeersBetweenRooms(e){try{const t=await cn.socketService.sendMessagePromise(U.movePeers,oA.toBinary({sourceMeetingId:e.sourceMeetingId,destinationMeetingId:e.destinationMeetingId,participants:e.participants}));return new TextDecoder().decode(t.payload).includes("error")?{success:!1,error:"failed to move participants"}:{success:!0}}catch(t){return{success:!1,error:t}}}};let we=cn;m(we,"socketService"),m(we,"currentMeetingId");var DN=Object.defineProperty,ON=Object.getOwnPropertyDescriptor,nl=(s,e,t,r)=>{for(var n=r>1?void 0:r?ON(e,t):e,i=s.length-1,a;i>=0;i--)(a=s[i])&&(n=(r?a(e,t,n):a(n))||n);return r&&n&&DN(e,t,n),n};const Ni=class{constructor(s,e){m(this,"apiBase");m(this,"selfController");m(this,"pollController");m(this,"chatController");m(this,"metaController");m(this,"storesManager");m(this,"stageController");m(this,"pluginController");m(this,"internalsController");m(this,"recordingController");m(this,"livestreamController");m(this,"participantController");this.apiBase=s,this.storesManager=e.storesManager,this.metaController=e.metaController,this.selfController=e.selfController,this.chatController=e.chatController,this.pollController=e.pollController,this.stageController=e.stageController,this.pluginController=e.pluginController,this.recordingController=e.recordingController,this.internalsController=e.internalsController,this.participantController=e.participantController,this.livestreamController=e.livestreamController}static async init(s){var B,H;const{peerId:e,apiBase:t,authToken:r,meetingId:n,organizationId:i,cachedUserDetails:a}=s.getAllValues();if(R.reset(),Fd.cleanup(),Ov(s),_e.isSupported()===!1)throw new P("Browser not supported","0010",!0);const c=wD(s,{authToken:r,baseURL:t,cachedUserDetails:a});c.setRoomName(n),c.setRoomUUID(n),c.setOrganizationId(i),c.setHeader("dyte-tracing-id",e),s.setValue("apiClient",c);const d=new aO;s.setValue("connectionHandler",d);const l=Ni.createSocketService(s),h=l.connect(),p=c.getUserDetails(),f=c.getPlugins();let y=ft.HIVE,_,b="";try{await Ni.setupFlagsmith(s)}catch(M){u.error("Failed to setup flagsmith",{error:M})}try{await h}catch(M){u.error("[Controller]: Failed to connect to socket server:",{error:M})}try{({sfu:y,meetingTitle:b}=await c.getRoomNodeData()),_=await p,u.info(`SFU ${y} is being used.`),s.setValue("presetName",_.preset.name),s.setValue("roomNodeOptions",{sfu:y})}catch(M){u.error("Failed to get room metadata",{error:M})}T.location.country=(B=c.ipInfo)==null?void 0:B.country;const{theme:I,controllers:x}=await Ni.setupControllers(l,s,_,f,b);return zD(I)&&Ni.createRoomNodeClient(s,l),EC(),(H=x.selfController.partialMediaRoom())==null||H.catch(M=>{u.error("[Controller]: Failed to queue partial media room promise:",{error:M})}),new Ni(t,x)}static async setupFlagsmith(s){var d;const{peerId:e,baseURI:t,overrides:r,meetingId:n,organizationId:i}=s.getAllValues(),a=TC(n),c={entity:Hu.PEER,clientId:i,isAnonUser:!i,sdkVersion:s.getValue("sdkVersion"),presetName:s.getValue("presetName"),meetingHash:a,roomName:n,..._e.getDeviceInfo(),isReactNative:navigator.isReactNative};try{const l=(d=r==null?void 0:r.whitelabelled_flags_endpoint)==null||d?yi({servicePrefix:"flags",baseURI:t}):"edge.api.flagsmith.com";await ee.identify(`${Hu.PEER}_${e}`,JSON.parse(JSON.stringify(c)),!1,5e3,l,u),u.info("flagsmith::allFlags",{flags:JSON.stringify(ee.getAllFlags())},!0)}catch(l){u.error("Failed to fetch flagsmith flags")}}static async setupControllers(s,e,t,r,n){var V,C,Ye;const i=e.getValue("modules"),{preset:a,participant:c}=t,d=e.getValue("defaults"),{sfu:l}=e.getValue("roomNodeOptions"),h=Ih.init(a,!i.theme),{viewType:p,mediaConstraints:{audio:f}}=h;e.setValue("viewType",p),e.setValue("defaults",{mediaConfiguration:{audio:{enableHighBitrate:(V=f.enableHighBitrate)!=null?V:!1,enableStereo:(C=f.enableStereo)!=null?C:!1}},...d});const y=Mh.init(e,p,a.permissions);e.setValue("maxPreferredStreams",_e.isMobile()?h.maxVideoStreams.mobile:h.maxVideoStreams.desktop);let _,b,I,x,B,H,M,z;const ne=new oN(s);we.socketService=s;const ue=new Kd(s),ze=new ts(s),Qt=new lN(s),Oe=Fd.create(s,e),Ot=new uN(s),A=new aN(s),E=new Sn(s),w=await Mr.init(e,Oe,c,y,h),F=await sv.init(e,w.self,Oe,ne,n);if(i.participant&&(z=new Zs(e,w.self,Oe,l)),(Ye=i.e2ee)!=null&&Ye.enabled&&i.e2ee.manager.init(u,R),i.chat&&(b=await Es.init(e,ze,E,w.self,z.participants)),i.internals&&(B=await bh.init()),i.livestream&&h.viewType===Et.Livestream&&ee.hasFeature(se.LIVESTREAM)&&(M=new Sv(w.self,A)),h.viewType!==Et.Chat){if(i.poll&&(_=await Xg.init(e,w.self,ue)),i.recording&&(H=new ov(e,w.self,Oe)),i.stage&&(I=new rv(e,Qt,Oe,w.self,z.participants)),i.plugin){if(!z)throw new P("The plugin module cannot be initialized without the `participant` module","0102");const vr=await r;x=await ro.init(e,vr,Ot,ze,b==null?void 0:b.chat,w.self,z.participants,n)}if(i.pip){const vr=await ju._init(e,w.self);e.setValue("pip",vr)}}const je={storesManager:new n1(e,Ot),pollController:_,selfController:w,metaController:F,chatController:b,stageController:I,pluginController:x,recordingController:H,internalsController:B,livestreamController:M,participantController:z};return{theme:h,permissions:y,controllers:je}}static createRoomNodeClient(s,e){const{peerId:t,roomNodeOptions:r}=s.getAllValues(),{sfu:n}=r;return Dv(s,n,{socket:e,peerId:t})}static createSocketService(s){const{peerId:e,meetingId:t,authToken:r}=s.getAllValues(),n=["PING"];return new So(s,{peerId:e,meetingId:t,authToken:r,capabilities:n})}};let Eo=Ni;nl([T.trace("Controller.init")],Eo,"init",1),nl([T.trace("setupFlagsmith")],Eo,"setupFlagsmith",1),nl([T.trace("Controller.createRoomNodeClient")],Eo,"createRoomNodeClient",1),nl([T.trace("Controller.createSocketService")],Eo,"createSocketService",1);var NN=Object.defineProperty,LN=Object.getOwnPropertyDescriptor,xN=(s,e,t,r)=>{for(var n=r>1?void 0:r?LN(e,t):e,i=s.length-1,a;i>=0;i--)(a=s[i])&&(n=(r?a(e,t,n):a(n))||n);return r&&n&&NN(e,t,n),n};class ey extends jt{constructor(t,r){super();g(this,mc,void 0);m(this,"meetings",[]);m(this,"parentMeeting",null);g(this,$l,void 0);v(this,$l,t),v(this,mc,r.self)}get supportsConnectedMeetings(){return o(this,mc).id!==""}get isActive(){return this.meetings.length!==0}get currentMeetingId(){return we.currentMeetingId}validateConnectedMeetingsAction(){if(!this.supportsConnectedMeetings)throw new Error(`You are not allowed to perform this action.
Please connect with Dyte team to move you to V2 APIs & to enable connected meetings.`)}async getConnectedMeetings(){return this.validateConnectedMeetingsAction(),await we.getConnectedRoomsDump()}async createMeetings(t){return this.validateConnectedMeetingsAction(),(await we.createConnectedRooms(t)).map(n=>({id:n.id,title:n.title}))}async updateMeetings(t){this.validateConnectedMeetingsAction(),await we.updateConnectedRooms(t.map(r=>({meetingId:r.id,title:r.title})))}async deleteMeetings(t){this.validateConnectedMeetingsAction();const r=this.meetings.map(i=>t.includes(i.id)&&i.participants.length!==0?this.moveParticipants(i.id,this.parentMeeting.id,i.participants.map(a=>a.id)):Promise.resolve());return await Promise.all(r),await we.disableConnectedRooms(t)}async moveParticipants(t,r,n){this.validateConnectedMeetingsAction();const i=await we.movePeersBetweenRooms({sourceMeetingId:t,destinationMeetingId:r,participants:n.map(a=>({id:a}))});return i.success&&this.moveSuccessHandler(t,r,n),i}async moveParticipantsWithCustomPreset(t,r,n){this.validateConnectedMeetingsAction();const i=await we.movePeersBetweenRooms({sourceMeetingId:t,destinationMeetingId:r,participants:n});return i.success&&this.moveSuccessHandler(t,r,n.map(a=>a.id)),i}moveSuccessHandler(t,r,n){const i=new Map;[...this.parentMeeting.participants,...this.meetings.flatMap(a=>a.participants)].forEach(a=>i.set(a.id,a)),r===this.parentMeeting.id&&(this.parentMeeting.participants=this.parentMeeting.participants.concat(n.map(a=>i.get(a)))),t===this.parentMeeting.id&&(this.parentMeeting.participants=this.parentMeeting.participants.filter(a=>!n.includes(a.id))),this.meetings=this.meetings.map(a=>{if(r===a.id){const c=a.participants.concat(n.map(d=>i.get(d)));return{...a,participants:c}}if(t===a.id){const c=a.participants.filter(d=>!n.includes(d.id));return{...a,participants:c}}return a})}}mc=new WeakMap,$l=new WeakMap,xN([xt({maxInvocations:60,period:60})],ey.prototype,"getConnectedMeetings",1);var VN=Object.defineProperty,UN=Object.getOwnPropertyDescriptor,Yh=(s,e,t,r)=>{for(var n=r>1?void 0:r?UN(e,t):e,i=s.length-1,a;i>=0;i--)(a=s[i])&&(n=(r?a(e,t,n):a(n))||n);return r&&n&&VN(e,t,n),n};const xr=(Zh=class{constructor(s,e,t){m(this,"connectedMeetings");g(this,Fa,void 0);g(this,hs,void 0);g(this,Hl,void 0);v(this,Hl,s),v(this,Fa,t),this.connectedMeetings=new ey(s,e),this.setCurrentMeeting(e)}static init(s,e,t){return xr.instance||(xr.instance=new xr(s,e,t)),xr.instance.connectedMeetings.supportsConnectedMeetings&&(xr.instance.setupEvents(),e.self.once("roomJoined",()=>xr.instance.getConnectedMeetings())),xr.instance}setCurrentMeeting(s){v(this,hs,s),we.currentMeetingId=s.meta.meetingId}getConnectedMeetings(){this.connectedMeetings.getConnectedMeetings()}setupEvents(){we.socketService&&(we.socketService.on(U.getConnectedRoomsDump,this.handleConnectedRoomsDump.bind(this)),we.socketService.on(U.transferPeer,this.handleTransferPeer.bind(this)),we.socketService.on(U.movedPeer,this.handleMovedPeer.bind(this)),we.socketService.on(U.connectedRoomsUpdated,this.handleConnectedRoomsUpdated.bind(this)),we.socketService.on(U.connectedRoomsDeleted,this.handleConnectedRoomsDeleted.bind(this)))}handleTransferPeer(s){const e=we.handleTransferPeerRaw(s);return this.switchMeeting(e)}async switchMeeting({authToken:s,meetingId:e}){var n,i,a,c;if(!this.connectedMeetings.supportsConnectedMeetings)throw new Error(`You are not allowed to perform this action.
Please connect with Dyte team to move you to V2 APIs & to enable connected meetings.`);u.info("ConnectedMeetingsController::switchMeeting:: asking ui-kit to show switching breakout UI"),this.connectedMeetings.emit("changingMeeting",e);const t={video:o(this,hs).self.videoEnabled,audio:o(this,hs).self.audioEnabled};try{o(this,hs).self.cleanupEvents(),await o(this,hs).leave("connected-meeting")}catch(d){u.error(`ConnectedMeetingsController:: switchMeeting:: issues in leaving previous meeting. Meeting Id: ${(i=(n=o(this,hs))==null?void 0:n.meta)==null?void 0:i.meetingId}`,{error:d})}we.socketService=void 0,u.info(`ConnectedMeetingsController::switchMeeting:: initializing new meeting. Meeting Id: ${e}`);const r=await sy.init({...o(this,Fa),cachedUserDetails:null,defaults:{...o(this,Fa).defaults,...t,mediaHandler:o(this,hs).self},authToken:s});u.info(`ConnectedMeetingsController::switchMeeting:: initialized new meeting. Meeting Id: ${(a=r==null?void 0:r.meta)==null?void 0:a.meetingId}`);try{const{hidden:d}=o(this,hs).self;r.self.setName(o(this,hs).self.name),await r.join(),d&&r.self.hide()}catch(d){u.error("ConnectedMeetingsController.joinRoom",{error:d})}return u.info(`ConnectedMeetingsController::switchMeeting:: asking ui-kit to show in-meeting ui of newly joined meeting id: ${(c=r==null?void 0:r.meta)==null?void 0:c.meetingId}`),this.connectedMeetings.emit("meetingChanged",r),this.setCurrentMeeting(r),r}handleConnectedRoomsDump(s){const e=we.handleConnectedRoomsDumpRaw(s);this.connectedMeetings.meetings=e.meetings.map(t=>({id:t.id,title:t.title,participants:t.participants||[]})),this.connectedMeetings.parentMeeting={id:e.parentMeeting.id,title:e.parentMeeting.title,participants:e.parentMeeting.participants},this.emitStateUpdate()}handleMovedPeer(s){return we.handleMovedPeerRaw(s)}handleConnectedRoomsUpdated(s){const e=we.handleConnectedRoomsUpdatedRaw(s),t=new Map;this.connectedMeetings.meetings.forEach(r=>{t.set(r.id,r)}),e.forEach(r=>{t.has(r.id)?t.get(r.id).title=r.title:t.set(r.id,{...r,participants:[]})}),this.connectedMeetings.meetings=Array.from(t.values()),this.emitStateUpdate()}handleConnectedRoomsDeleted(s){const t=we.handleConnectedRoomsDeletedRaw(s).map(r=>r.id);this.connectedMeetings.meetings=this.connectedMeetings.meetings.filter(r=>!t.includes(r.id)),this.emitStateUpdate()}emitStateUpdate(){this.connectedMeetings.emit("stateUpdate",{meetings:this.connectedMeetings.meetings,parentMeeting:this.connectedMeetings.parentMeeting})}},Fa=new WeakMap,hs=new WeakMap,Hl=new WeakMap,m(Zh,"instance"),Zh);let il=xr;Yh([T.trace("ConnectedMeetingsController.getConnectedMeetings")],il.prototype,"getConnectedMeetings",1),Yh([T.trace("ConnectedMeetingsController.setupEvents")],il.prototype,"setupEvents",1),Yh([T.trace("ConnectedMeetingsController.switchMeeting")],il.prototype,"switchMeeting",1);class FN{constructor(){m(this,"battery");m(this,"init",async()=>{try{"getBattery"in navigator&&(this.battery=await navigator.getBattery(),this.battery.addEventListener("chargingchange",this.updateChargeInfo),this.battery.addEventListener("levelchange",this.updateLevelInfo),this.updateLevelInfo(),this.updateChargeInfo())}catch(e){u.error("Error getting battery",e)}});m(this,"updateChargeInfo",()=>{var e;u.log(`Battery charging? ${(e=this.battery)!=null&&e.charging?"Yes":"No"}`)});m(this,"updateLevelInfo",()=>{if(!this.battery){u.log("Battery level: Not known");return}u.log(`Battery level: ${this.battery.level*100}%`)});m(this,"cleanup",()=>{var e,t;"getBattery"in navigator&&((e=this.battery)==null||e.removeEventListener("chargingchange",this.updateChargeInfo),(t=this.battery)==null||t.removeEventListener("levelchange",this.updateLevelInfo))})}}const ty=new FN;function BN(s,e){try{const{meetingId:t,orgId:r,participantId:n}=JSON.parse(atob(s.split(".")[1]));if(!t)throw Error(`Received V1 auth token ${s}`);let i="dyte.io";e&&(i=e);const a=`https://api.${i}`;return{meetingId:t,orgId:r,participantId:n,baseURI:i,apiBase:a}}catch(t){throw u.error("constants::decodeAuthToken",{error:t,debuggingHint:`Unable to decode auth token: ${s}`},!0),new P("Invalid auth token","0004")}}var $N=Object.defineProperty,HN=Object.getOwnPropertyDescriptor,al=(s,e,t,r)=>{for(var n=r>1?void 0:r?HN(e,t):e,i=s.length-1,a;i>=0;i--)(a=s[i])&&(n=(r?a(e,t,n):a(n))||n);return r&&n&&$N(e,t,n),n};let Vr=(Ey=class{constructor(e,t){g(this,ql);g(this,nt,void 0);g(this,fc,void 0);g(this,gc,void 0);v(this,gc,e),v(this,nt,t)}static async init(e){var h,p,f,y,_;gC(),_e.init();const t=hi();ty.init();const{authToken:r,baseURI:n}=e,{meetingId:i,...a}=BN(r,n);window.__zone_symbol__DISABLE_WRAPPING_UNCAUGHT_PROMISE_REJECTION=!0;const c=Vr.setupContext(t,e,i,a);T.meetingMetadata.roomName=i,T.meetingMetadata.userId=a.participantId,T.meetingMetadata.organizationId=a.orgId,T.init(c,(p=(h=e.modules)==null?void 0:h.tracing)!=null?p:!0),u.info("DyteClient::init::options",{dyteClientInitOptions:{...e,authToken:`${(f=e.authToken)==null?void 0:f.slice(0,10)}...
${(y=e.authToken)==null?void 0:y.slice(-10)}`}});const d=await Eo.init(c),l=new Vr(c,d);return $(_=l,ql,Jy).call(_,e),l}static setupContext(e,t,r,n){var c;const i=gn.createContext(e,t),a={...lC,...t==null?void 0:t.modules};return i.setValue("peerId",e),i.setValue("modules",a),i.setValue("sdkName","web-core"),i.setValue("meetingId",r),i.setValue("apiBase",n.apiBase),i.setValue("baseURI",n.baseURI),i.setValue("userId",n.participantId),i.setValue("organizationId",n.orgId),i.setValue("authToken",t.authToken),i.setValue("overrides",(c=t.overrides)!=null?c:{}),i.setValue("env",uC({baseURI:n.baseURI})),i.setValue("defaults",t.defaults||{audio:!0,video:!0}),i.setValue("onError",t.onError||(()=>{})),i.setValue("cachedUserDetails",Ss(t.cachedUserDetails)),i.setValue("sdkVersion","2.5.0-staging.37"),i}async join(){const{selfController:e}=o(this,nt);return e.self.roomJoined?null:e.joinRoom()}async leave(e){ty.cleanup();const{selfController:t}=o(this,nt);return t.leaveRoom(e)}get participants(){var e;return(e=o(this,nt).participantController)==null?void 0:e.participants}get self(){var e;return(e=o(this,nt).selfController)==null?void 0:e.self}get meta(){var e;return(e=o(this,nt).metaController)==null?void 0:e.meta}get ai(){var e;return(e=o(this,nt).metaController)==null?void 0:e.ai}get plugins(){var e;return(e=o(this,nt).pluginController)==null?void 0:e.plugins}get chat(){var e;return(e=o(this,nt).chatController)==null?void 0:e.chat}get polls(){var e;return(e=o(this,nt).pollController)==null?void 0:e.polls}get connectedMeetings(){var e;return(e=o(this,fc))==null?void 0:e.connectedMeetings}get recording(){var e;return(e=o(this,nt).recordingController)==null?void 0:e.recording}get livestream(){var e;return(e=o(this,nt).livestreamController)==null?void 0:e.livestream}get stage(){var e;return(e=o(this,nt).stageController)==null?void 0:e.stage}get stores(){return o(this,nt).storesManager}get __internals__(){var e;return(e=o(this,nt).internalsController)==null?void 0:e.internals}async joinRoom(){return this.join()}async leaveRoom(e){return this.leave(e)}},nt=new WeakMap,fc=new WeakMap,gc=new WeakMap,ql=new WeakSet,Jy=function(e){v(this,fc,il.init(o(this,gc),this,e))},Ey);al([ht("0002"),Ir.executeWithLock({methodName:"meeting.join",lockName:"DyteClient.join",timeout:3e3})],Vr.prototype,"join",1),al([ht("0003")],Vr.prototype,"leave",1),al([ht("0001"),Ir.executeWithLock({methodName:"DyteClient.init",lockName:"DyteClient.init",timeout:3e3})],Vr,"init",1),Vr=al([ht("0000")],Vr);const sy=Vr;return sy}();
