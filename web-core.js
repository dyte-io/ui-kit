var DyteClient=function(){var Py,Xr,Zr,er,vi,yt,tr,Be,Tr,es,At,Xe,yi,Ti,ts,Si,Ds,ky,Tt,ee,wn,Ze,bn,xa,Pd,Wy,Iy,kd,Ay,Id,Jy,Ei,_i,Fa,My,wi,Cn,Dy,bi,Ad,Ky,$a,Ph,Rn,Ua,Oy,Os,Ci,Md,Ny,rr,Ri,pe,Va,Ar,Sr,Ba,kh,Pi,Gd,Ns,Pn,Ls,Ha,rs,St,Kt,ki,Ii,ss,Ai,Mi,kn,Uo,Ly,Je,In,sr,Di,qa,xy,Oi,ja,Ni,Wd,Fy,Dd,rt,Ke,Ae,Mr,nr,Ga,Od,An,Mn,Nd,Li,ir,Ld,$y,xi,Fi,Wa,Ft,Dn,Ja,$i,Vi,Bi,Hi,ns,Et,xs,Fs,xd,zy,On,Nn,Ka,Ih,za,$s,Fd,Yy,qi,ji,Us,Ln,Vo,is,Ya,Vs,Gi,Jd,as,$d,Qa,Ah,Uy,Bs,Dr,os,Gn,xn,$t,Vy,H,Wi,Ji,Ud,Mt,zt,wh,zi,Dt,Yi,Or,Hs,sa,st,pt,ze,it,Qi,Xi,Xa,Mh,By,Za,eo,to,ro,so,Nr,no,io,Er,Fn,ao,oo,co,Dh,Vd,Qy,Bd,Xy,qs,$n,lo,_t,Un,Bo,Lr,wt,Vn,Ho,xr,uo,ho,bt,re,ea,ut,Fr,Bn,Hn,js,po,mo,fo,cs,Gs,ta,qn,jn,$r,zs,go,Hy,Ws,_r,ht,Ut,cr,qy,vo,yo,ds,Vt,nt,Js,Fe,$e,Qe,ar,ls,To,Oh,So,Nh,jy,Eo,Hd,ra,or,bh,qd,dt,_o,wo,jd,Zy,Gy;"use strict";var pL=Object.defineProperty;var mL=(Me,be,ne)=>be in Me?pL(Me,be,{enumerable:!0,configurable:!0,writable:!0,value:ne}):Me[be]=ne;var m=(Me,be,ne)=>(mL(Me,typeof be!="symbol"?be+"":be,ne),ne),Rh=(Me,be,ne)=>{if(!be.has(Me))throw TypeError("Cannot "+ne)};var d=(Me,be,ne)=>(Rh(Me,be,"read from private field"),ne?ne.call(Me):be.get(Me)),E=(Me,be,ne)=>{if(be.has(Me))throw TypeError("Cannot add the same private member more than once");be instanceof WeakSet?be.add(Me):be.set(Me,ne)},y=(Me,be,ne,qo)=>(Rh(Me,be,"write to private field"),qo?qo.call(Me,ne):be.set(Me,ne),ne);var qe=(Me,be,ne)=>(Rh(Me,be,"access private method"),ne);var Me=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{};function be(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var ne={},qo={get exports(){return ne},set exports(r){ne=r}},Wn=typeof Reflect=="object"?Reflect:null,Lh=Wn&&typeof Wn.apply=="function"?Wn.apply:function(t,e,s){return Function.prototype.apply.call(t,e,s)},jo;Wn&&typeof Wn.ownKeys=="function"?jo=Wn.ownKeys:Object.getOwnPropertySymbols?jo=function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:jo=function(t){return Object.getOwnPropertyNames(t)};function eT(r){console&&console.warn&&console.warn(r)}var xh=Number.isNaN||function(t){return t!==t};function fe(){fe.init.call(this)}qo.exports=fe,ne.once=nT,fe.EventEmitter=fe,fe.prototype._events=void 0,fe.prototype._eventsCount=0,fe.prototype._maxListeners=void 0;var Fh=10;function Go(r){if(typeof r!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof r)}Object.defineProperty(fe,"defaultMaxListeners",{enumerable:!0,get:function(){return Fh},set:function(r){if(typeof r!="number"||r<0||xh(r))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+r+".");Fh=r}}),fe.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},fe.prototype.setMaxListeners=function(t){if(typeof t!="number"||t<0||xh(t))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t+".");return this._maxListeners=t,this};function $h(r){return r._maxListeners===void 0?fe.defaultMaxListeners:r._maxListeners}fe.prototype.getMaxListeners=function(){return $h(this)},fe.prototype.emit=function(t){for(var e=[],s=1;s<arguments.length;s++)e.push(arguments[s]);var n=t==="error",i=this._events;if(i!==void 0)n=n&&i.error===void 0;else if(!n)return!1;if(n){var a;if(e.length>0&&(a=e[0]),a instanceof Error)throw a;var o=new Error("Unhandled error."+(a?" ("+a.message+")":""));throw o.context=a,o}var c=i[t];if(c===void 0)return!1;if(typeof c=="function")Lh(c,this,e);else for(var l=c.length,p=qh(c,l),s=0;s<l;++s)Lh(p[s],this,e);return!0};function Uh(r,t,e,s){var n,i,a;if(Go(e),i=r._events,i===void 0?(i=r._events=Object.create(null),r._eventsCount=0):(i.newListener!==void 0&&(r.emit("newListener",t,e.listener?e.listener:e),i=r._events),a=i[t]),a===void 0)a=i[t]=e,++r._eventsCount;else if(typeof a=="function"?a=i[t]=s?[e,a]:[a,e]:s?a.unshift(e):a.push(e),n=$h(r),n>0&&a.length>n&&!a.warned){a.warned=!0;var o=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");o.name="MaxListenersExceededWarning",o.emitter=r,o.type=t,o.count=a.length,eT(o)}return r}fe.prototype.addListener=function(t,e){return Uh(this,t,e,!1)},fe.prototype.on=fe.prototype.addListener,fe.prototype.prependListener=function(t,e){return Uh(this,t,e,!0)};function tT(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function Vh(r,t,e){var s={fired:!1,wrapFn:void 0,target:r,type:t,listener:e},n=tT.bind(s);return n.listener=e,s.wrapFn=n,n}fe.prototype.once=function(t,e){return Go(e),this.on(t,Vh(this,t,e)),this},fe.prototype.prependOnceListener=function(t,e){return Go(e),this.prependListener(t,Vh(this,t,e)),this},fe.prototype.removeListener=function(t,e){var s,n,i,a,o;if(Go(e),n=this._events,n===void 0)return this;if(s=n[t],s===void 0)return this;if(s===e||s.listener===e)--this._eventsCount===0?this._events=Object.create(null):(delete n[t],n.removeListener&&this.emit("removeListener",t,s.listener||e));else if(typeof s!="function"){for(i=-1,a=s.length-1;a>=0;a--)if(s[a]===e||s[a].listener===e){o=s[a].listener,i=a;break}if(i<0)return this;i===0?s.shift():rT(s,i),s.length===1&&(n[t]=s[0]),n.removeListener!==void 0&&this.emit("removeListener",t,o||e)}return this},fe.prototype.off=fe.prototype.removeListener,fe.prototype.removeAllListeners=function(t){var e,s,n;if(s=this._events,s===void 0)return this;if(s.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):s[t]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete s[t]),this;if(arguments.length===0){var i=Object.keys(s),a;for(n=0;n<i.length;++n)a=i[n],a!=="removeListener"&&this.removeAllListeners(a);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(e=s[t],typeof e=="function")this.removeListener(t,e);else if(e!==void 0)for(n=e.length-1;n>=0;n--)this.removeListener(t,e[n]);return this};function Bh(r,t,e){var s=r._events;if(s===void 0)return[];var n=s[t];return n===void 0?[]:typeof n=="function"?e?[n.listener||n]:[n]:e?sT(n):qh(n,n.length)}fe.prototype.listeners=function(t){return Bh(this,t,!0)},fe.prototype.rawListeners=function(t){return Bh(this,t,!1)},fe.listenerCount=function(r,t){return typeof r.listenerCount=="function"?r.listenerCount(t):Hh.call(r,t)},fe.prototype.listenerCount=Hh;function Hh(r){var t=this._events;if(t!==void 0){var e=t[r];if(typeof e=="function")return 1;if(e!==void 0)return e.length}return 0}fe.prototype.eventNames=function(){return this._eventsCount>0?jo(this._events):[]};function qh(r,t){for(var e=new Array(t),s=0;s<t;++s)e[s]=r[s];return e}function rT(r,t){for(;t+1<r.length;t++)r[t]=r[t+1];r.pop()}function sT(r){for(var t=new Array(r.length),e=0;e<t.length;++e)t[e]=r[e].listener||r[e];return t}function nT(r,t){return new Promise(function(e,s){function n(a){r.removeListener(t,i),s(a)}function i(){typeof r.removeListener=="function"&&r.removeListener("error",n),e([].slice.call(arguments))}jh(r,t,i,{once:!0}),t!=="error"&&iT(r,n,{once:!0})})}function iT(r,t,e){typeof r.on=="function"&&jh(r,"error",t,e)}function jh(r,t,e,s){if(typeof r.on=="function")s.once?r.once(t,e):r.on(t,e);else if(typeof r.addEventListener=="function")r.addEventListener(t,function n(i){s.once&&r.removeEventListener(t,n),e(i)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof r)}var K;(function(r){r[r.MAJOR_EVENT=0]="MAJOR_EVENT",r[r.MINOR_EVENT=1]="MINOR_EVENT"})(K||(K={}));var F;(function(r){r.PRECALL_TEST_BEGIN="precall_begin",r.PRECALL_TEST_COMPLETE="precall_end",r.CALL_JOIN_BEGIN="call_join",r.NET_QUALITY_TEST_BEGIN="net_quality_test_begin",r.NET_QUALITY_TEST_END="net_quality_test_end",r.WEBSOCKET_CONNECTED="websocket_connected",r.TRANSPORT_CONNECTED="transport_connected",r.AUDIO_ON="audio_on",r.AUDIO_OFF="audio_off",r.VIDEO_ON="video_on",r.VIDEO_OFF="video_off",r.PARTICIPANT_ROLE="participant_role",r.PING_STAT="ping_stat",r.DISCONNECT="disconnect",r.RECONNECT_ATTEMPT="reconnect_attempt",r.SCREENSHARE_START_REQUESTED="screenshare_start_requested",r.SCREENSHARE_STARTED="screenshare_started",r.SCREENSHARE_STOPPED="screenshare_stopped",r.TAB_CHANGE="tab_change",r.BROWSER_BACKGROUNDED="browser_backgrounded",r.BROWSER_FOREGROUNDED="browser_foregrounded",r.DOMINANT_SPEAKER="dominant_speaker",r.AUDIO_DEVICES_UPDATES="audio_devices_updates",r.VIDEO_DEVICES_UPDATES="video_devices_updates",r.SPEAKER_DEVICES_UPDATES="speaker_devices_updates",r.SELECTED_MICROHPONE_UPDATE="selected_microphone_update",r.SELECTED_CAMERA_UPDATE="selected_camera_update",r.SELECTED_SPEAKER_UPDATE="selected_speaker_update",r.EXPECTED_VIDEO_RESOLUTION="expected_video_resolution",r.EXPECTED_SCREENSHARE_RESOLUTION="expected_screenshare_resolution",r.MEDIA_PERMISSION="media_permission",r.LEGACY_SWITCH="legacy_switch",r.AUDIO_PLAY_FAILED="audio_play_failed",r.VIDEO_PLAY_FAILED="video_play_failed",r.AUDIO_TRACK_MUTED="audio_track_muted",r.VIDEO_TRACK_MUTED="video_track_muted",r.IVS_PLAYER_REBUFFERING="ivs_player_rebuffering",r.IVS_PLAYER_AUDIO_BLOCKED="ivs_player_audio_blocked",r.IVS_PLAYER_PLAYBACK_BLOCKED="ivs_player_playback_blocked",r.IVS_PLAYER_ERROR="ivs_player_error",r.IVS_PLAYER_RECOVERABLE_ERROR="ivs_player_recoverable_error",r.IVS_PLAYER_WORKER_ERROR="ivs_player_worker_error",r.IVS_PLAYER_NETWORK_UNAVAILABLE="ivs_player_network_unavailable",r.LIVESTREAM_LATENCY="livestream_latency",r.IVS_PLAYER_ANALYTICS_EVENT="ivs_player_analytics_event",r.IVS_PLAYER_PLAYBACK_RATE_CHANGED="ivs_player_playback_rate_changed",r.IVS_PLAYER_QUALITY_CHANGED="ivs_player_quality_changed",r.IVS_PLAYER_INITIALIZED="ivs_player_initialized"})(F||(F={}));const aT=new Map([[F.PRECALL_TEST_BEGIN,K.MINOR_EVENT],[F.PRECALL_TEST_COMPLETE,K.MINOR_EVENT],[F.CALL_JOIN_BEGIN,K.MAJOR_EVENT],[F.NET_QUALITY_TEST_BEGIN,K.MINOR_EVENT],[F.NET_QUALITY_TEST_END,K.MINOR_EVENT],[F.WEBSOCKET_CONNECTED,K.MINOR_EVENT],[F.TRANSPORT_CONNECTED,K.MAJOR_EVENT],[F.AUDIO_ON,K.MINOR_EVENT],[F.AUDIO_OFF,K.MINOR_EVENT],[F.VIDEO_ON,K.MINOR_EVENT],[F.VIDEO_OFF,K.MINOR_EVENT],[F.PARTICIPANT_ROLE,K.MINOR_EVENT],[F.PING_STAT,K.MAJOR_EVENT],[F.DISCONNECT,K.MAJOR_EVENT],[F.RECONNECT_ATTEMPT,K.MAJOR_EVENT],[F.SCREENSHARE_START_REQUESTED,K.MINOR_EVENT],[F.SCREENSHARE_STARTED,K.MINOR_EVENT],[F.SCREENSHARE_STOPPED,K.MINOR_EVENT],[F.TAB_CHANGE,K.MINOR_EVENT],[F.BROWSER_BACKGROUNDED,K.MINOR_EVENT],[F.BROWSER_FOREGROUNDED,K.MINOR_EVENT],[F.DOMINANT_SPEAKER,K.MINOR_EVENT],[F.AUDIO_DEVICES_UPDATES,K.MINOR_EVENT],[F.VIDEO_DEVICES_UPDATES,K.MINOR_EVENT],[F.SPEAKER_DEVICES_UPDATES,K.MINOR_EVENT],[F.SELECTED_MICROHPONE_UPDATE,K.MINOR_EVENT],[F.SELECTED_CAMERA_UPDATE,K.MINOR_EVENT],[F.SELECTED_SPEAKER_UPDATE,K.MINOR_EVENT],[F.MEDIA_PERMISSION,K.MINOR_EVENT],[F.LEGACY_SWITCH,K.MINOR_EVENT],[F.AUDIO_PLAY_FAILED,K.MINOR_EVENT],[F.VIDEO_PLAY_FAILED,K.MINOR_EVENT],[F.AUDIO_TRACK_MUTED,K.MINOR_EVENT],[F.VIDEO_TRACK_MUTED,K.MINOR_EVENT],[F.IVS_PLAYER_REBUFFERING,K.MAJOR_EVENT],[F.IVS_PLAYER_AUDIO_BLOCKED,K.MAJOR_EVENT],[F.IVS_PLAYER_PLAYBACK_BLOCKED,K.MAJOR_EVENT],[F.IVS_PLAYER_ERROR,K.MAJOR_EVENT],[F.IVS_PLAYER_RECOVERABLE_ERROR,K.MAJOR_EVENT],[F.IVS_PLAYER_WORKER_ERROR,K.MAJOR_EVENT],[F.IVS_PLAYER_NETWORK_UNAVAILABLE,K.MAJOR_EVENT],[F.LIVESTREAM_LATENCY,K.MAJOR_EVENT],[F.IVS_PLAYER_ANALYTICS_EVENT,K.MINOR_EVENT],[F.IVS_PLAYER_PLAYBACK_RATE_CHANGED,K.MINOR_EVENT],[F.IVS_PLAYER_QUALITY_CHANGED,K.MINOR_EVENT],[F.IVS_PLAYER_INITIALIZED,K.MINOR_EVENT],[F.EXPECTED_VIDEO_RESOLUTION,K.MINOR_EVENT],[F.EXPECTED_SCREENSHARE_RESOLUTION,K.MINOR_EVENT]]);class oT{constructor(){m(this,"events");this.events=[]}add(t){this.events.push(t)}flush(){return{entries:this.events.splice(0,25)}}}class cT extends ne{constructor({logger:e,peerId:s,apiHostnames:n}){super();m(this,"logger");m(this,"peerId");m(this,"eventStore");m(this,"apiEndpoint");this.logger=e,this.peerId=s,this.apiEndpoint=`https://${n.daCollector}/api/v1/message`,this.eventStore=new oT}async sendEventsChunkToServer(e){var n;const s={payload:e,peerId:this.peerId};try{return await fetch(this.apiEndpoint,{method:"POST",body:JSON.stringify(s)}),!0}catch(i){return this.logger.error("callStats::sendEventsChunkToServer::catch",{error:i}),(n=e.entries)==null||n.forEach(a=>{this.eventStore.add(a)}),!1}}callEvent(e){e.timestamp=new Date,this.eventStore.add(e),this.emit(e.event,e.metaData),aT.get(e.event)===K.MAJOR_EVENT&&this.flush()}async flush(){var s;const e=this.eventStore.flush();return(s=e==null?void 0:e.entries)!=null&&s.length?(await this.sendEventsChunkToServer(e),!0):!1}}var Gh;(function(r){r.CHROMIUM="chromum",r.FIREFOX="firefox",r.SAFARI="safari"})(Gh||(Gh={}));const na={DEVEL:"devel",PREPROD:"preprod",PROD:"prod"};var Yt;(function(r){r.AUDIO="AUDIO",r.VIDEO="VIDEO",r.SPEAKER="SPEAKER",r.SCREENSHARE="SCREENSHARE"})(Yt||(Yt={}));var Wh;(function(r){r[r.INIT=0]="INIT",r[r.ACCEPTED=1]="ACCEPTED",r[r.DENIED=2]="DENIED",r[r.SYS_DENIED=3]="SYS_DENIED",r[r.FAILED=4]="FAILED",r[r.NOTFOUND=5]="NOTFOUND",r[r.NOT_APPLICABLE=6]="NOT_APPLICABLE"})(Wh||(Wh={}));function hs(r){return r?r.split(".").slice(0,2).concat(["0","0"]).join("."):""}function Wo({packetsLost:r,packetsSent:t}){return t>0?r*100/t:0}function Jo({packetsLost:r,packetsReceived:t}){return t+r>0?r*100/(t+r):0}const Jh=240,Kh=720,zh=8,Yh=3,Ko=10,zo=.02,Yo=.03;function Ur({stat:r,weight:t,rangeMin:e,rangeMax:s,rangeRankingDirection:n}){return r==null?t:e===s?n==="UP"?r<=e?t:0:r>=s?t:0:n==="UP"?(1-Math.max(Math.min(s,Math.abs(r))-e,0)/(s-e))*t:n==="DOWN"?Math.max(Math.min(s,Math.abs(r))-e,0)/(s-e)*t:t}function Qh({isLowQualityVideo:r,isVideoStuck:t,isVideoLagging:e,jitterQuality:s,packetsLostQuality:n}){const i=.8*((r?.85:1)*(e?.7:1)*(t?.5:1))+.2*(s*n);return Math.round((i+Number.EPSILON)*100)/100}function Xh({packetsLost:r,packetsSent:t}){return t>0?r*100/t:0}function Zh({packetsLost:r,packetsSent:t,jitter:e}){const n=Ur({stat:Xh({packetsLost:r,packetsSent:t}),weight:.7,rangeMin:0,rangeMax:Ko,rangeRankingDirection:"UP"}),a=Ur({stat:e,weight:.3,rangeMin:zo,rangeMax:Yo,rangeRankingDirection:"UP"});return n+a}function dT({frameWidth:r,isScreenShare:t}){return r<(t?Kh:Jh)}function lT({framesPerSecond:r,isScreenShare:t}){return r<(t?Yh:zh)}function uT({framesEncoded:r}){return r===0}function ep({frameWidth:r,framesPerSecond:t,packetsLost:e,packetsSent:s,jitter:n,isScreenShare:i,framesEncoded:a}){const o=Ur({stat:Xh({packetsLost:e,packetsSent:s}),weight:1,rangeMin:0,rangeMax:Ko,rangeRankingDirection:"UP"}),c=Ur({stat:n,weight:1,rangeMin:zo,rangeMax:Yo,rangeRankingDirection:"UP"}),l=dT({frameWidth:r,isScreenShare:i}),p=lT({framesPerSecond:t,isScreenShare:i}),h=uT({framesEncoded:a,isScreenShare:i});return Qh({isLowQualityVideo:l,isVideoLagging:p,isVideoStuck:h,jitterQuality:c,packetsLostQuality:o})}function tp({packetsLost:r,packetsReceived:t}){return t+r>0?r*100/(t+r):0}function rp({concealmentEvents:r,packetsLost:t,packetsReceived:e,jitter:s}){const i=Ur({stat:r,weight:.2,rangeMin:0,rangeMax:3,rangeRankingDirection:"UP"}),a=.5,o=Ur({stat:tp({packetsLost:t,packetsReceived:e}),weight:a,rangeMin:0,rangeMax:Ko,rangeRankingDirection:"UP"}),l=Ur({stat:s,weight:.3,rangeMin:zo,rangeMax:Yo,rangeRankingDirection:"UP"});return i+o+l}function hT({framesDecoded:r}){return r===0}function pT({framesPerSecond:r,isScreenShare:t}){return r<(t?Yh:zh)}function mT({frameWidth:r,isScreenShare:t}){return r<(t?Kh:Jh)}function sp({frameWidth:r,framesPerSecond:t,packetsLost:e,packetsReceived:s,jitter:n,isScreenShare:i,framesDecoded:a}){const o=Ur({stat:tp({packetsLost:e,packetsReceived:s}),weight:1,rangeMin:0,rangeMax:Ko,rangeRankingDirection:"UP"}),c=Ur({stat:n,weight:1,rangeMin:zo,rangeMax:Yo,rangeRankingDirection:"UP"}),l=mT({frameWidth:r,isScreenShare:i}),p=pT({framesPerSecond:t,isScreenShare:i}),h=hT({framesDecoded:a,isScreenShare:i});return Qh({isLowQualityVideo:l,isVideoLagging:p,isVideoStuck:h,jitterQuality:c,packetsLostQuality:o})}class Vr{constructor(t){m(this,"pc1");m(this,"pc2");m(this,"constrainVideoBitrateKbps");m(this,"constrainOfferToRemoveVideoFec",!1);m(this,"iceCandidateFilter");const e=new RTCPeerConnection(t),s=new RTCPeerConnection(t);this.pc1=e,this.pc2=s,this.iceCandidateFilter=Vr.noFilter,this.pc1.addEventListener("icecandidate",this.onIceCandidate.bind(this,this.pc2)),this.pc2.addEventListener("icecandidate",this.onIceCandidate.bind(this,this.pc1))}static parseCandidate(t){const e="candidate:",s=t.indexOf(e)+e.length,n=t.substr(s).split(" ");return{type:n[7],protocol:n[2],address:n[4]}}static isNotHostCandidate(t){return t.type!=="host"}static isHost(t){return t.type==="host"}static isRelay(t){return t.type==="relay"}static isReflexive(t){return t.type==="srflx"}static noFilter(t){return!0}onIceCandidate(t,e){if(e.candidate){const s=Vr.parseCandidate(e.candidate.candidate);this.iceCandidateFilter(s)&&t.addIceCandidate(e.candidate)}}setIceCandidateFilter(t){this.iceCandidateFilter=t}constrainVideoBitrate(t){this.constrainVideoBitrateKbps=t}disableVideoFec(){this.constrainOfferToRemoveVideoFec=!0}gotOffer(t){this.constrainOfferToRemoveVideoFec&&(t.sdp=t.sdp.replace(/(m=video 1 [^\r]+)(116 117)(\r\n)/g,`$1\r
`),t.sdp=t.sdp.replace(/a=rtpmap:116 red\/90000\r\n/g,""),t.sdp=t.sdp.replace(/a=rtpmap:117 ulpfec\/90000\r\n/g,""),t.sdp=t.sdp.replace(/a=rtpmap:98 rtx\/90000\r\n/g,""),t.sdp=t.sdp.replace(/a=fmtp:98 apt=116\r\n/g,"")),this.pc1.setLocalDescription(t),this.pc2.setRemoteDescription(t),this.pc2.createAnswer().then(this.gotAnswer.bind(this),this.reportFatal.bind(this))}gotAnswer(t){this.constrainVideoBitrateKbps&&(t.sdp=t.sdp.replace(/a=mid:video\r\n/g,`a=mid:video\r
b=AS:${this.constrainVideoBitrateKbps}\r
`)),this.pc2.setLocalDescription(t),this.pc1.setRemoteDescription(t)}establishConnection(){this.pc1.createOffer().then(this.gotOffer.bind(this),this.reportFatal.bind(this))}reportFatal(t){console.error("Error:",t)}async getRoundTripTime(){const[t,e]=await Promise.all([this.pc1.getStats(),this.pc2.getStats()]);let s,n;if(t.forEach(i=>{i.type==="candidate-pair"&&i.nominated===!0&&i.bytesSent>0&&(s=i)}),e.forEach(i=>{i.type==="candidate-pair"&&i.nominated===!0&&i.bytesReceived>0&&(n=i)}),s&&n)try{if(s.currentRoundTripTime&&n.currentRoundTripTime)return{rtt:s.currentRoundTripTime,backendRTT:n.currentRoundTripTime};const i=(n.lastPacketReceivedTimestamp-s.lastPacketSentTimestamp)/1e3;return{rtt:i,backendRTT:i}}catch(i){return}}close(){this.pc1.close(),this.pc2.close()}}class np extends ne{constructor(e){super();m(this,"call");m(this,"timeOut");this.call=new Vr(e)}start(e=1e4){this.call.establishConnection(),this.timeOut=setTimeout(this.testFailed.bind(this),e)}testComplete(e){clearTimeout(this.timeOut),this.call.close(),this.emit("done",e)}testFailed(e){this.call.close(),this.emit("failed",e)}}const fT=8,gT=1/1e3;class vT extends np{constructor(e){super(e);m(this,"senderChannel");m(this,"recieveChannel");m(this,"startTime");m(this,"lastBitrateMeasureTime");m(this,"sentPayloadBytes",0);m(this,"recievedPayloadBytes",0);m(this,"lastReceivedPayloadBytes",0);m(this,"stopSending",!1);m(this,"testProgress",0);m(this,"samplePacket","");m(this,"finalBitrateSum",0);m(this,"bitRateSampels",0);m(this,"maxNumberOfPacketsToSend",0);m(this,"bytesToKeepBuffered",0);m(this,"testDurationSeconds",5);this.call.setIceCandidateFilter(Vr.isNotHostCandidate),this.senderChannel=this.call.pc1.createDataChannel(null);for(let s=0;s<262144;s+=1)this.samplePacket+="h";this.maxNumberOfPacketsToSend=1,this.bytesToKeepBuffered=1024*this.maxNumberOfPacketsToSend,this.testDurationSeconds=4,this.senderChannel.addEventListener("open",this.sendingStep.bind(this)),this.call.pc2.addEventListener("datachannel",this.onRecieverChannel.bind(this))}sendingStep(){const e=new Date;this.startTime||(this.startTime=e,this.lastBitrateMeasureTime=e);for(let n=0;n!==this.maxNumberOfPacketsToSend&&!(this.senderChannel.bufferedAmount>=this.bytesToKeepBuffered);n+=1){this.sentPayloadBytes+=this.samplePacket.length;try{this.senderChannel.send(this.samplePacket)}catch(i){}}const s=e.getTime()-this.startTime.getTime();s>=1e3*this.testDurationSeconds?(this.stopSending=!0,this.testProgress=100):(this.testProgress=s/(10*this.testDurationSeconds),setTimeout(this.sendingStep.bind(this),1))}onMessageRecieved(e){this.recievedPayloadBytes+=e.data.length;const s=new Date,n=s.getTime()-this.lastBitrateMeasureTime.getTime();if(n>=1e3){const a=(this.recievedPayloadBytes-this.lastReceivedPayloadBytes)*fT/(n/1e3);this.finalBitrateSum+=a,this.bitRateSampels+=1,this.lastReceivedPayloadBytes=this.recievedPayloadBytes,this.lastBitrateMeasureTime=s}if(this.stopSending&&this.sentPayloadBytes===this.recievedPayloadBytes){const i=this.finalBitrateSum/this.bitRateSampels;this.testComplete({throughput:Math.round(i*gT)})}}testComplete(e){this.call.getRoundTripTime().then(({rtt:s,backendRTT:n})=>super.testComplete({RTT:s,backendRTT:n,throughput:e.throughput}))}onRecieverChannel(e){this.recieveChannel=e.channel,this.recieveChannel.addEventListener("message",this.onMessageRecieved.bind(this))}}class Kd extends np{constructor(e,s=Vr.noFilter){super(e);m(this,"ch1");m(this,"ch2");this.call.setIceCandidateFilter(s);const n=this.call.pc1.createDataChannel(null);this.ch1=n,n.addEventListener("open",()=>{n.send("hello")}),n.addEventListener("message",this.onCh1Recieve.bind(this)),this.call.pc2.addEventListener("datachannel",this.dataChannelHandler.bind(this))}onCh1Recieve(e){e.data!=="world"?this.hangup("Invalid data transmitted."):this.testComplete({connectivity:!0})}onCh2Recieve(e){if(e.data!=="hello")this.hangup("Invalid data transmitted.");else try{this.ch2.send("world")}catch(s){}}dataChannelHandler(e){const s=e.channel;this.ch2=s,s.addEventListener("message",this.onCh2Recieve.bind(this))}hangup(e){this.testFailed(e)}}class yT extends Kd{constructor(t){super(t,Vr.isHost)}}class TT extends Kd{constructor(t){super(t,Vr.isRelay)}}class ST extends Kd{constructor(t){super(t,Vr.isReflexive)}}class ET{constructor(){m(this,"ipInformation",null)}async getIPDetails({peerId:t,apiHostnames:e,logger:s}){var n,i,a;if(!this.ipInformation){try{const o=`https://${e.location}`,l=await(await fetch(o)).json();if(((n=l.loc)==null?void 0:n.length)>5)return this.ipInformation=l,(i=this.ipInformation)!=null&&i.ip&&(this.ipInformation.ip=hs(this.ipInformation.ip)),l;throw Error("Insufficient data")}catch(o){s.error("callstats::ipDetails:: failed to fetch ip using location service",{error:o})}try{const o=await fetch(`https://${e.locationLegacy}/?token=3c493932b0624c&peerId=${t}`,{method:"POST"});this.ipInformation=await o.json(),(a=this.ipInformation)!=null&&a.ip&&(this.ipInformation.ip=hs(this.ipInformation.ip))}catch(o){s.error("callstats::ipDetails:: failed to fetch ip using legacy location service",{error:o})}}return this.ipInformation}resetCache(){this.ipInformation=null}}const zd=new ET,ip=[{urls:"turn:turn.dyte.in:443?transport=tcp",username:"dyte",credential:"dytein",credentialType:"password"},{urls:"turn:turn.dyte.in:3478?transport=udp",username:"dyte",credential:"dytein",credentialType:"password"}];function ap(r){const[t,e]=r.split(",");return{coords:{latitude:Number(t),longitude:Number(e)}}}class op{constructor(){m(this,"transport");m(this,"candidatePair");m(this,"outboundVideoRtp",new Map);m(this,"inboundVideoRtp",new Map);m(this,"outboundAudioRtp",new Map);m(this,"inboundAudioRtp",new Map);m(this,"remoteInboundRtp",new Map);m(this,"producerStreamMap",new Map);m(this,"consumerStreamMap",new Map);m(this,"staleProducerStreamMap",!1);m(this,"staleConsumerStreamMap",!1)}}class cp extends ne{constructor(){super();m(this,"observer");m(this,"outboundProducerMap",new Map);m(this,"inboundConsumerMap",new Map);m(this,"consumerPeerIdMap",new Map);m(this,"pausedConsumerMap",new Map);m(this,"pausedProducerMap",new Map);m(this,"overallProducingTransportsStatsMap",{});m(this,"overallConsumingTransportsStatsMap",{});m(this,"overallConsumersStatsMap",{});m(this,"overallProducersStatsMap",{});m(this,"videoProducerToStatsMap",new Map);m(this,"audioProducerToStatsMap",new Map);m(this,"videoConsumerToStatsMap",new Map);m(this,"audioConsumerToStatsMap",new Map);m(this,"consumerIdsWithFreezedVideo",new Set);m(this,"consumerIdsWithFreezedAudio",new Set);m(this,"producerIdsWithFreezedVideo",new Set);m(this,"producerIdsWithFreezedAudio",new Set);m(this,"freezedProducingTransportIds",new Set);m(this,"freezedConsumingTransportIds",new Set);m(this,"screenShareProducers",new Set);m(this,"screenShareConsumers",new Set);m(this,"ipDetails");m(this,"callStatsInstance");this.observer=new ne}async registerProducer(e){await this.generateProducerStreamMap(e),e.observer.on("close",this.deregisterProducer.bind(this,e)),e.observer.on("pause",this.pauseProducer.bind(this,e.id)),e.observer.on("resume",this.resumeProducer.bind(this,e.id)),e.appData.screenShare===!0&&this.screenShareProducers.add(e.id)}pauseProducer(e){this.pausedProducerMap.set(e,{lastReportCalculated:!1})}resumeProducer(e){this.pausedProducerMap.delete(e)}processInboundConsumerVideoStats(e,s,n){var a,o;const i=((o=(a=this==null?void 0:this.callStatsInstance)==null?void 0:a.consumerSharedMediaStatesMap)==null?void 0:o.get(e))||{};s.totalVideoPacketsReceived===n.packetsReceived?(this.consumerIdsWithFreezedVideo.add(e),this.callStatsInstance&&i.video&&(this.callStatsInstance.logger.debug("callstats::measurements::consumerVideoFreezed",{consumerId:e}),this.callStatsInstance.eventHandler.emit("consumer_video_status","pause",e))):(s.totalVideoPacketsReceived=n.packetsReceived,this.consumerIdsWithFreezedVideo.has(e)&&(this.consumerIdsWithFreezedVideo.delete(e),this.callStatsInstance&&i.video&&(this.callStatsInstance.logger.debug("callstats::measurements::consumerVideoDefreezed",{consumerId:e}),this.callStatsInstance.eventHandler.emit("consumer_video_status","resume",e))))}processInboundConsumerAudioStats(e,s,n){var a,o;const i=((o=(a=this==null?void 0:this.callStatsInstance)==null?void 0:a.consumerSharedMediaStatesMap)==null?void 0:o.get(e))||{};s.totalAudioPacketsReceived===n.packetsReceived?(this.consumerIdsWithFreezedAudio.add(e),this.callStatsInstance&&i.audio&&(this.callStatsInstance.logger.debug("callStats::measurements::consumerAudioFreezed",{consumerId:e}),this.callStatsInstance.eventHandler.emit("consumer_audio_status","pause",e))):(s.totalAudioPacketsReceived=n.packetsReceived,this.consumerIdsWithFreezedAudio.has(e)&&(this.consumerIdsWithFreezedAudio.delete(e),this.callStatsInstance&&i.audio&&(this.callStatsInstance.logger.debug("callStats::measurements::consumerAudioDefreezed",{consumerId:e}),this.callStatsInstance.eventHandler.emit("consumer_audio_status","resume",e))))}processOutboundProducerVideoStats(e,s,n){var a;const i=((a=this==null?void 0:this.callStatsInstance)==null?void 0:a.currentUserMediaStates)||{};s.totalVideoPacketsSent===n.packetsSent?(this.producerIdsWithFreezedVideo.add(e),this.callStatsInstance&&i.video&&(this.callStatsInstance.logger.debug("callStats::measurements::producerVideoFreezed",{producerId:e}),this.callStatsInstance.eventHandler.emit("producer_video_status","pause",e))):(s.totalVideoPacketsSent=n.packetsSent,this.producerIdsWithFreezedVideo.has(e)&&(this.producerIdsWithFreezedVideo.delete(e),this.callStatsInstance&&i.video&&(this.callStatsInstance.logger.debug("callStats::measurements::producerVideoDefreezed",{producerId:e}),this.callStatsInstance.eventHandler.emit("producer_video_status","resume",e))))}processOutboundProducerAudioStats(e,s,n){var a;const i=((a=this==null?void 0:this.callStatsInstance)==null?void 0:a.currentUserMediaStates)||{};s.totalAudioPacketsSent===n.packetsSent?(this.producerIdsWithFreezedAudio.add(e),this.callStatsInstance&&i.audio&&(this.callStatsInstance.logger.debug("callStats::measurements::producerAudioFreezed",{producerId:e}),this.callStatsInstance.eventHandler.emit("producer_audio_status","pause",e))):(s.totalAudioPacketsSent=n.packetsSent,this.producerIdsWithFreezedAudio.has(e)&&(this.producerIdsWithFreezedAudio.delete(e),this.callStatsInstance&&i.audio&&(this.callStatsInstance.logger.debug("callStats::measurements::producerAudioDefreezed",{producerId:e}),this.callStatsInstance.eventHandler.emit("producer_audio_status","resume",e))))}processProducingTransportStats(e,s,n){var p;const i=((p=this==null?void 0:this.callStatsInstance)==null?void 0:p.currentUserMediaStates)||{},{audio:a,video:o,screen:c}=i,l=a||o||c;s.totalPacketsSent===n.packetsSent?(this.freezedProducingTransportIds.add(e),this.callStatsInstance&&l&&(this.callStatsInstance.logger.debug("callStats::measurements::producingTransportFreezed",{transportId:e}),this.callStatsInstance.eventHandler.emit("producing_transport_status","pause",e))):(s.totalPacketsSent=n.packetsSent,this.freezedProducingTransportIds.has(e)&&(this.freezedProducingTransportIds.delete(e),this.callStatsInstance&&l&&(this.callStatsInstance.logger.debug("callStats::measurements::producingTransportDefreezed",{transportId:e}),this.callStatsInstance.eventHandler.emit("producing_transport_status","resume",e))))}processConsumingTransportStats(e,s,n){var o,c;const a=!!Array.from(((c=(o=this==null?void 0:this.callStatsInstance)==null?void 0:o.consumerSharedMediaStatesMap)==null?void 0:c.values())||[]).reduce((l,p)=>l||p.audio||p.video||p.screen,!1);s.totalPacketsReceived===n.packetsSent?(this.freezedConsumingTransportIds.add(e),this.callStatsInstance&&a&&(this.callStatsInstance.logger.debug("callStats::measurements::consumingTransportFreezed",{transportId:e}),this.callStatsInstance.eventHandler.emit("consuming_transport_status","pause",e))):(s.totalPacketsReceived=n.packetsSent,this.freezedConsumingTransportIds.has(e)&&(this.freezedConsumingTransportIds.delete(e),this.callStatsInstance&&a&&(this.callStatsInstance.logger.debug("callStats::measurements::consumingTransportDefreezed",{transportId:e}),this.callStatsInstance.eventHandler.emit("consuming_transport_status","resume",e))))}async registerConsumer(e){await this.generateConsumerStreamMap(e),this.consumerPeerIdMap.set(e.id,{producerId:e.producerId,peerId:e.appData.peerId,appData:e.appData}),e.observer.on("close",this.deregisterConsumer.bind(this,e)),e.observer.on("pause",this.pauseConsumer.bind(this,e.id)),e.observer.on("resume",this.resumeConsumer.bind(this,e.id)),e.appData.screenShare===!0&&this.screenShareConsumers.add(e.id)}pauseConsumer(e){this.pausedConsumerMap.set(e,{lastReportCalculated:!1})}resumeConsumer(e){this.pausedConsumerMap.delete(e)}async generateProducerStreamMap(e,s=!1){const n=await e.getStats(),i=s?this.getProducerStatsFromReport(this.parseRTCReport(n,["outbound-rtp","remote-inbound-rtp"],!1,e.id))[0]:void 0;for(const a of n.values())switch(a.type){case"outbound-rtp":{this.outboundProducerMap.set(a.id,e.id);break}}return i}async generateConsumerStreamMap(e,s=!1){const n=await e.getStats(),i=s?this.getConsumerStatsFromReport(this.parseRTCReport(n,["inbound-rtp"],!1,e.id))[0]:void 0;for(const a of n.values())switch(a.type){case"inbound-rtp":{this.inboundConsumerMap.set(a.id,e.id);break}}return i}deregisterProducer(e){this.outboundProducerMap.forEach((s,n)=>{s===e.id&&this.outboundProducerMap.delete(n)}),this.pausedProducerMap.delete(e.id),this.screenShareProducers.delete(e.id)}deregisterConsumer(e){this.inboundConsumerMap.forEach((s,n)=>{s===e.id&&this.inboundConsumerMap.delete(n)}),this.consumerPeerIdMap.delete(e.id),this.pausedConsumerMap.delete(e.id),this.screenShareConsumers.delete(e.id)}getIceCandidateStats(e){var s;return{id:e.id,type:e.candidateType||e.type,address:e.address,port:e.port,url:e.url,protocol:(s=e.relayProtocol)!=null?s:e.protocol,networkType:e.networkType,relatedAddress:e.relatedAddress,relatedPort:e.relatedPort}}getWorkingSimulcastVideoStats(e){return e.find(n=>{const i=n.framesEncoded>0,a=n.packetsSent>0,o=n.frameWidth&&n.frameHeight;return i&&a&&!!o})||e[e.length-1]}parseRTCReport(e,s=[],n=!1,i=void 0,a=void 0){var w,R,D,x,B,b,Q,te,ce,he,Ne,de,He;const o=e,c=new op,l=s.length?new Set(s):void 0,p=[],h=[],f=[],g=new Map,_=new Map;for(const A of o.values()){if(l){if(l.size===0)break;if(l.has(A.type))n&&l.delete(A.type);else continue}switch(A.type){case"local-candidate":{p.push(this.getIceCandidateStats(A));break}case"remote-candidate":{h.push(this.getIceCandidateStats(A));break}case"candidate-pair":{const{nominated:S}=A,{selected:C}=A,V=A,Le={nominated:S!=null?S:C,currentRoundTripTime:V.currentRoundTripTime,totalRoundTripTime:V.totalRoundTripTime,bytesReceived:V.bytesReceived,bytesSent:V.bytesSent,availableOutgoingBitrate:V.availableOutgoingBitrate,availableIncomingBitrate:V.availableIncomingBitrate,lastPacketReceivedTimestamp:V.lastPacketReceivedTimestamp,lastPacketSentTimestamp:V.lastPacketSentTimestamp,localCandidateId:V.localCandidateId,remoteCandidateId:V.remoteCandidateId,bytesDiscardedOnSend:V.bytesDiscardedOnSend,packetsSent:V.packetsSent,packetsReceived:V.packetsReceived,packetsDiscardedOnSend:V.packetsDiscardedOnSend};f.push(Le),(A.nominated===!0||A.selected===!0)&&(c.candidatePair=Le);break}case"transport":{const S=A;a&&(a.producing&&(this.overallProducingTransportsStatsMap[a.id]||(this.overallProducingTransportsStatsMap[a.id]={totalPacketsSent:0})),a.consuming&&(this.overallConsumingTransportsStatsMap[a.id]||(this.overallConsumingTransportsStatsMap[a.id]={totalPacketsReceived:0})));const C={bytesReceived:S.bytesReceived,bytesSent:S.bytesSent,packetsSent:S.packetsSent,packetsReceived:S.packetsReceived,dtlsCipher:S.dtlsCipher,dtlsState:S.dtlsState,iceRole:S.iceRole};if(c.transport=C,a){if(a.producing){const V=this.overallProducingTransportsStatsMap[a.id];this.processProducingTransportStats(a.id,V,C)}if(a.consuming){const V=this.overallConsumingTransportsStatsMap[a.id];this.processConsumingTransportStats(a.id,V,C)}}break}case"remote-inbound-rtp":{const S=A,C={jitter:S.jitter,fractionLost:S.fractionLost,roundTripTime:S.roundTripTime,roundTripTimeMeasurements:S.roundTripTimeMeasurements,totalRoundTripTime:S.totalRoundTripTime,packetsLost:S.packetsLost};c.remoteInboundRtp.set(S.localId,C);break}case"outbound-rtp":{const S=A,C=i||this.outboundProducerMap.get(A.id),V=this.pausedProducerMap.get(C);if(V){if(V.lastReportCalculated===!0)break;this.pausedProducerMap.set(C,{lastReportCalculated:!0})}this.overallProducersStatsMap[C]||(this.overallProducersStatsMap[C]={totalVideoPacketsSent:0,totalAudioPacketsSent:0});const Le=this.overallProducersStatsMap[C];if(["video","audio"].includes(S.mediaType)||["video","audio"].includes(S.kind)){if(!this.outboundProducerMap.has(A.id)){c.staleProducerStreamMap=!0;break}const Ye=this.callStatsInstance.producers.get(C);if(((w=Ye==null?void 0:Ye.track)==null?void 0:w.readyState)==="ended")break;c.producerStreamMap.has(C)||c.producerStreamMap.set(C,{outboundVideoRtpId:[],outboundAudioRtpId:[]});const $={bytesSent:S.bytesSent,packetsSent:S.packetsSent,nackCount:S.nackCount,ssrc:S.ssrc,mid:S.mid,active:S.active,codecId:S.codecId,headerBytesSent:S.headerBytesSent||0,totalPacketSendDelay:S.totalPacketSendDelay||0};if(S.mediaType==="video"||S.kind==="video"){const M=S,et={frameHeight:M.frameHeight,frameWidth:M.frameWidth,framesEncoded:M.framesEncoded,framesDropped:M.framesDropped,framesPerSecond:M.framesPerSecond,framesSent:M.framesSent,keyFramesEncoded:M.keyFramesEncoded,firCount:M.firCount,encoderImplementation:M.encoderImplementation,hugeFramesSent:M.hugeFramesSent,pliCount:M.pliCount,qpSum:M.qpSum,qualityLimitationDurations:M.qualityLimitationDurations,qualityLimitationReason:M.qualityLimitationReason,qualityLimitationResolutionChanges:M.qualityLimitationResolutionChanges,totalEncodeTime:M.targetBitrate,totalPacketSendDelay:M.totalPacketSendDelay,retransmittedBytesSent:M.retransmittedBytesSent,retransmittedPacketsSent:M.retransmittedPacketsSent,scalabilityMode:M.scalabilityMode,powerEfficientEncoder:M.powerEfficientEncoder,...$};c.outboundVideoRtp.set(A.id,et),c.producerStreamMap.get(C).outboundVideoRtpId.push(A.id),this.processOutboundProducerVideoStats(C,Le,et)}else if(S.mediaType==="audio"||S.kind==="audio"){const M=S,et={retransmittedBytesSent:M.retransmittedBytesSent,retransmittedPacketsSent:M.retransmittedPacketsSent,...$};c.outboundAudioRtp.set(A.id,et),c.producerStreamMap.get(C).outboundAudioRtpId.push(A.id),this.processOutboundProducerAudioStats(C,Le,et)}}else this.callStatsInstance.logger.error(`Callstats: Unknown Outbound-rtp. mediatype: ${S.mediaType} kind: ${S.kind}`);break}case"inbound-rtp":{const S=A,C=i||this.inboundConsumerMap.get(A.id),V=this.pausedConsumerMap.get(C);if(V){if(V.lastReportCalculated===!0)break;this.pausedConsumerMap.set(C,{lastReportCalculated:!0})}if(S.ssrc===1234)break;this.overallConsumersStatsMap[C]||(this.overallConsumersStatsMap[C]={totalVideoPacketsReceived:0,totalAudioPacketsReceived:0});const Le=this.overallConsumersStatsMap[C];if(["video","audio"].includes(S.mediaType)||["video","audio"].includes(S.kind)){if(!this.inboundConsumerMap.has(A.id)){c.staleConsumerStreamMap=!0;break}c.consumerStreamMap.has(C)||c.consumerStreamMap.set(C,{inboundVideoRtpId:[],inboundAudioRtpId:[]});const Ye={bytesReceived:S.bytesReceived,packetsReceived:S.packetsReceived,packetsLost:S.packetsLost>=0?S.packetsLost:0,jitter:S.jitter,nackCount:S.nackCount,jitterBufferDelay:S.jitterBufferDelay,jitterBufferEmittedCount:S.jitterBufferEmittedCount,lastPacketReceivedTimestamp:S.lastPacketReceivedTimestamp,ssrc:S.ssrc,mid:S.mid,codecId:S.codecId,headerBytesReceived:S.headerBytesReceived||0,packetsDiscarded:S.packetsDiscarded||0,jitterBufferMinimumDelay:S.jitterBufferMinimumDelay||0,jitterBufferTargetDelay:S.jitterBufferTargetDelay||0};if(S.mediaType==="video"||S.kind==="video"){const $=S,M={frameHeight:$.frameHeight,frameWidth:$.frameWidth,framesDecoded:$.framesDecoded,framesDropped:$.framesDropped,framesPerSecond:$.framesPerSecond,framesReceived:$.framesReceived,keyFramesDecoded:$.keyFramesDecoded,firCount:$.firCount,decoderImplementation:$.decoderImplementation,pliCount:$.pliCount,totalProcessingDelay:$.totalProcessingDelay,qpSum:$.qpSum||0,totalAssemblyTime:$.totalAssemblyTime||0,totalDecodeTime:$.totalDecodeTime||0,totalFreezesDuration:$.totalFreezesDuration||0,totalInterFrameDelay:$.totalInterFrameDelay||0,totalPausesDuration:$.totalPausesDuration||0,totalSquaredInterFrameDelay:$.totalSquaredInterFrameDelay||0,freezeCount:$.freezeCount||0,pauseCount:$.pauseCount||0,powerEfficientDecoder:$.powerEfficientDecoder,...Ye};M.score=sp({frameWidth:M.frameWidth||0,framesDecoded:(M.framesDecoded||0)-(((R=this.videoConsumerToStatsMap.get(C))==null?void 0:R.framesDecoded)||0),framesPerSecond:M.framesPerSecond||0,packetsLost:(M.packetsLost||0)-(((D=this.videoConsumerToStatsMap.get(C))==null?void 0:D.packetsLost)||0),packetsReceived:(M.packetsReceived||0)-(((x=this.videoConsumerToStatsMap.get(C))==null?void 0:x.packetsReceived)||0),jitter:M.jitter||0,isScreenShare:this.screenShareConsumers.has(C)}),_.set(C,{score:+(M.score*10).toFixed(),frameWidth:M.frameWidth||0,frameHeight:M.frameHeight||0,framesPerSecond:M.framesPerSecond||0,packetsLostPercentage:Jo({packetsLost:(M.packetsLost||0)-(((B=this.videoConsumerToStatsMap.get(C))==null?void 0:B.packetsLost)||0),packetsReceived:(M.packetsReceived||0)-(((b=this.videoConsumerToStatsMap.get(C))==null?void 0:b.packetsReceived)||0)}),jitter:M.jitter||0,isScreenShare:this.screenShareConsumers.has(C),bitrate:((M.bytesReceived||0)-(((Q=this.videoConsumerToStatsMap.get(C))==null?void 0:Q.bytesReceived)||0))*8/7}),this.videoConsumerToStatsMap.set(C,M),c.inboundVideoRtp.set(A.id,M),c.consumerStreamMap.get(C).inboundVideoRtpId.push(A.id),this.processInboundConsumerVideoStats(C,Le,M)}else if(S.mediaType==="audio"||S.kind==="audio"){const $=S,M={audioLevel:$.audioLevel,concealedSamples:$.concealedSamples,concealmentEvents:$.concealmentEvents,totalAudioEnergy:$.totalAudioEnergy,totalSamplesDuration:$.totalSamplesDuration,totalSamplesReceived:$.totalSamplesReceived,fecPacketsDiscarded:$.fecPacketsDiscarded||0,fecPacketsReceived:$.fecPacketsReceived||0,insertedSamplesForDeceleration:$.insertedSamplesForDeceleration||0,removedSamplesForAcceleration:$.removedSamplesForAcceleration||0,silentConcealedSamples:$.silentConcealedSamples||0,playoutId:$.playoutId,...Ye};M.score=rp({concealmentEvents:(M.concealmentEvents||0)-(((te=this.audioConsumerToStatsMap.get(C))==null?void 0:te.concealmentEvents)||0),packetsLost:(M.packetsLost||0)-(((ce=this.audioConsumerToStatsMap.get(C))==null?void 0:ce.packetsLost)||0),packetsReceived:(M.packetsReceived||0)-(((he=this.audioConsumerToStatsMap.get(C))==null?void 0:he.packetsReceived)||0),jitter:M.jitter||0}),_.set(C,{score:+(M.score*10).toFixed(),packetsLostPercentage:Jo({packetsLost:(M.packetsLost||0)-(((Ne=this.audioConsumerToStatsMap.get(C))==null?void 0:Ne.packetsLost)||0),packetsReceived:(M.packetsReceived||0)-(((de=this.audioConsumerToStatsMap.get(C))==null?void 0:de.packetsReceived)||0)}),jitter:M.jitter||0,isScreenShare:this.screenShareConsumers.has(C),bitrate:((M.bytesReceived||0)-(((He=this.audioConsumerToStatsMap.get(C))==null?void 0:He.bytesReceived)||0))*8/7}),this.audioConsumerToStatsMap.set(C,M),c.inboundAudioRtp.set(A.id,M),c.consumerStreamMap.get(C).inboundAudioRtpId.push(A.id),this.processInboundConsumerAudioStats(C,Le,M)}}else this.callStatsInstance.logger.error(`Callstats: Unknown Inbound-rtp. mediatype: ${S.mediaType} kind: ${S.kind}`);break}}}if(c.producerStreamMap.forEach((A,S)=>{var C,V,Le,Ye,$,M,et,us,bo,Co,Ro,Po,ko,Io,Ao,Mo,Do,Oo,No,Lo,xo,Fo,$o;if(A.outboundVideoRtpId.length>0){const Ee=[];A.outboundVideoRtpId.forEach(Ch=>{Ee.push(c.outboundVideoRtp.get(Ch))});const se=this.getWorkingSimulcastVideoStats(Ee);se.score=ep({frameWidth:se.frameWidth||0,framesPerSecond:se.framesPerSecond||0,jitter:((C=se.remoteData)==null?void 0:C.jitter)||0,isScreenShare:this.screenShareProducers.has(S),packetsSent:(se.packetsSent||0)-(((V=this.videoProducerToStatsMap.get(S))==null?void 0:V.packetsSent)||0),packetsLost:(((Le=se.remoteData)==null?void 0:Le.packetsLost)||0)-((($=(Ye=this.videoProducerToStatsMap.get(S))==null?void 0:Ye.remoteData)==null?void 0:$.packetsLost)||0),framesEncoded:(se.framesEncoded||0)-(((M=this.videoProducerToStatsMap.get(S))==null?void 0:M.framesEncoded)||0)}),g.set(S,{score:+(se.score*10).toFixed(),frameWidth:se.frameWidth||0,frameHeight:se.frameHeight||0,framesPerSecond:se.framesPerSecond||0,jitter:((et=se.remoteData)==null?void 0:et.jitter)||0,isScreenShare:this.screenShareProducers.has(S),packetsLostPercentage:Wo({packetsSent:(se.packetsSent||0)-(((us=this.videoProducerToStatsMap.get(S))==null?void 0:us.packetsSent)||0),packetsLost:(((bo=se.remoteData)==null?void 0:bo.packetsLost)||0)-(((Ro=(Co=this.videoProducerToStatsMap.get(S))==null?void 0:Co.remoteData)==null?void 0:Ro.packetsLost)||0)}),bitrate:((se.bytesSent||0)-(((Po=this.videoProducerToStatsMap.get(S))==null?void 0:Po.bytesSent)||0))*8/7,cpuLimitations:se.qualityLimitationReason==="cpu",bandwidthLimitations:se.qualityLimitationReason==="bandwidth"}),this.videoProducerToStatsMap.set(S,se)}else if(A.outboundAudioRtpId.length>0){const Ee=c.outboundAudioRtp.get(A.outboundAudioRtpId[0]);Ee.score=Zh({packetsSent:(Ee.packetsSent||0)-(((ko=this.audioProducerToStatsMap.get(S))==null?void 0:ko.packetsSent)||0),packetsLost:(((Io=Ee.remoteData)==null?void 0:Io.packetsLost)||0)-(((Mo=(Ao=this.audioProducerToStatsMap.get(S))==null?void 0:Ao.remoteData)==null?void 0:Mo.packetsLost)||0),jitter:((Do=Ee.remoteData)==null?void 0:Do.jitter)||0}),g.set(S,{score:+(Ee.score*10).toFixed(),bitrate:((Ee.bytesSent||0)-(((Oo=this.audioProducerToStatsMap.get(S))==null?void 0:Oo.bytesSent)||0))*8/7,packetsLostPercentage:Wo({packetsSent:(Ee.packetsSent||0)-(((No=this.audioProducerToStatsMap.get(S))==null?void 0:No.packetsSent)||0),packetsLost:(((Lo=Ee.remoteData)==null?void 0:Lo.packetsLost)||0)-(((Fo=(xo=this.audioProducerToStatsMap.get(S))==null?void 0:xo.remoteData)==null?void 0:Fo.packetsLost)||0)}),jitter:(($o=Ee.remoteData)==null?void 0:$o.jitter)||0,isScreenShare:this.screenShareProducers.has(S)}),this.audioProducerToStatsMap.set(S,Ee)}}),f.forEach(A=>{const S=p.find(V=>V.id===A.localCandidateId?(A.localCandidateId=V.id,V):null),C=h.find(V=>V.id===A.remoteCandidateId?(A.remoteCandidateId=V.id,V):null);S&&(A.localCandidateType=S.type,A.localCandidateAddress=hs(S.address),A.localCandidatePort=S.port,A.localCandidateProtocol=S.protocol,A.localCandidateUrl=S.url,A.localCandidateNetworkType=S.networkType,A.localCandidateRelatedAddress=hs(S.relatedAddress),A.localCandidateRelatedPort=S.relatedPort),C&&(A.remoteCandidateType=C.type,A.remoteCandidateAddress=hs(C.address),A.remoteCandidatePort=C.port,A.remoteCandidateProtocol=C.protocol,A.remoteCandidateUrl=C.url)}),c.candidatePair&&(c.transport?(c.transport.totalRoundTripTime=c.candidatePair.totalRoundTripTime,c.transport.availableOutgoingBitrate=c.candidatePair.availableOutgoingBitrate,c.transport.availableIncomingBitrate=c.candidatePair.availableIncomingBitrate,c.transport.roundTripTime=c.candidatePair.currentRoundTripTime):c.transport={bytesReceived:c.candidatePair.bytesReceived,bytesSent:c.candidatePair.bytesSent,totalRoundTripTime:c.candidatePair.totalRoundTripTime,availableOutgoingBitrate:c.candidatePair.availableOutgoingBitrate,availableIncomingBitrate:c.candidatePair.availableIncomingBitrate,roundTripTime:c.candidatePair.currentRoundTripTime}),c.transport&&(c.transport.candidatePairs=f),c.transport&&!c.transport.roundTripTime){let A=0,S=0;c.remoteInboundRtp.forEach((C,V)=>{C.roundTripTime&&C.roundTripTime>A&&(A=C.roundTripTime,S=C.totalRoundTripTime)}),c.transport.roundTripTime=A,c.transport.totalRoundTripTime=S}if(_.size>0)try{this.observer.emit("consumer_score",_)}catch(A){}if(g.size>0)try{this.observer.emit("producer_score",g)}catch(A){}return c}async getProducersReport(e){const s=e.map(n=>this.generateProducerStreamMap(n,!0));return s.length>0?Promise.all(s):void 0}async getConsumersReport(e){const s=e.map(n=>this.generateConsumerStreamMap(n,!0));return s.length>0?Promise.all(s):void 0}async getTransportReport(e){return e.getStats()}async getProcessedStats(e,s,n){const i=await this.getTransportReport(e),a={producing:n,consuming:s,id:e.id},o=i,c=this.parseRTCReport(o,["transport","candidate-pair","inbound-rtp","outbound-rtp","remote-inbound-rtp","local-candidate","remote-candidate"],!1,void 0,a);if(!c)return;const l={stats:c.transport,transportId:e.id,consuming:s,producing:n},p=c.staleProducerStreamMap?void 0:this.getProducerStatsFromReport(c),h=c.staleConsumerStreamMap?void 0:this.getConsumerStatsFromReport(c);return{transportReport:l,producerReport:p,consumerReport:h}}getProducerStatsFromReport(e){const s=[];try{e.producerStreamMap.forEach((n,i)=>{var a,o;s.push({producerId:i,videoStats:n.outboundVideoRtpId.map(c=>e.outboundVideoRtp.get(c)),audioStats:n.outboundAudioRtpId.map(c=>e.outboundAudioRtp.get(c)),appData:((o=(a=this.callStatsInstance.producers)==null?void 0:a.get(i))==null?void 0:o.appData)||null})})}catch(n){this.callStatsInstance.logger.error("callStats::measurements::getProducerStatsFromReport",{error:{reason:n.reason,message:n.message}})}return s}getConsumerStatsFromReport(e){const s=[];try{e.consumerStreamMap.forEach((n,i)=>{const{peerId:a,producerId:o,appData:c}=this.consumerPeerIdMap.get(i);s.push({consumerId:i,peerId:a,producerId:o,appData:c,videoStats:n.inboundVideoRtpId.map(l=>e.inboundVideoRtp.get(l)),audioStats:n.inboundAudioRtpId.map(l=>e.inboundAudioRtp.get(l))})})}catch(n){console.error("getConsumersReport: ",n,e)}return s}async getUserLocation(){return new Promise((e,s)=>{try{navigator.geolocation?navigator.geolocation.getCurrentPosition(n=>{e(n)}):s()}catch(n){s(n)}})}async getConnectivity(e){try{const s={iceServers:e||ip},n=new Promise((p,h)=>{try{const f=new yT(s);f.addListener("done",p),f.addListener("failed",()=>{p({connectivity:!1})}),f.start(2e3)}catch(f){h(f)}}),i=new Promise((p,h)=>{try{const f=new TT(s);f.addListener("done",p),f.addListener("failed",()=>{p({connectivity:!1})}),f.start(2e3)}catch(f){h(f)}}),a=new Promise((p,h)=>{try{const f=new ST(s);f.addListener("done",p),f.addListener("failed",()=>{p({connectivity:!1})}),f.start(2e3)}catch(f){h(f)}}),[o,c,l]=await Promise.all([n,i,a]);return{host:o==null?void 0:o.connectivity,relay:c==null?void 0:c.connectivity,reflexive:l==null?void 0:l.connectivity}}catch(s){return{host:!1,relay:!1,reflexive:!1}}}async getThroughput(e){try{const n=await new Promise((i,a)=>{try{const o={iceServers:e||ip},c=new vT(o);c.addListener("done",i),c.addListener("failed",a),c.start(1e4)}catch(o){a(o)}});return{throughput:n.throughput,fractionalLoss:0,RTT:n.RTT,jitter:0,backendRTT:n.backendRTT}}catch(s){return}}async getIPDetails(){var e,s;try{return this.ipDetails||(this.ipDetails=await zd.getIPDetails({peerId:(e=this.callStatsInstance)==null?void 0:e.peerId,apiHostnames:(s=this.callStatsInstance)==null?void 0:s.apiHostnames,logger:this.callStatsInstance.logger})),this.ipDetails}catch(n){return}}async getNetworkQuality(e){const[s,n]=await Promise.all([this.getConnectivity(e),this.getThroughput(e)]);return{connectivity:s,throughput:n==null?void 0:n.throughput,fractionalLoss:n==null?void 0:n.fractionalLoss,RTT:n==null?void 0:n.RTT,jitter:n==null?void 0:n.jitter,backendRTT:n==null?void 0:n.backendRTT}}async getNetworkInfo(e,s=!1){var o,c;if(s){const l=await this.getIPDetails();return{ipDetails:l,effectiveNetworkType:(o=navigator.connection)==null?void 0:o.effectiveType,location:l!=null&&l.loc?ap(l==null?void 0:l.loc):void 0}}const[n,i,a]=await Promise.all([this.getConnectivity(e),this.getThroughput(e),this.getIPDetails()]);return{ipDetails:a,effectiveNetworkType:(c=navigator.connection)==null?void 0:c.effectiveType,location:a!=null&&a.loc?ap(a==null?void 0:a.loc):void 0,turnConnectivity:n?n.host||n.relay||n.reflexive:!1,connectivity:n,throughput:i==null?void 0:i.throughput,fractionalLoss:i==null?void 0:i.fractionalLoss,RTT:i==null?void 0:i.RTT,jitter:i==null?void 0:i.jitter,backendRTT:i==null?void 0:i.backendRTT}}}class _T extends cp{}class dp extends cp{constructor(){super(...arguments);m(this,"producerMap",new Map);m(this,"consumerMap",new Map)}async registerProducer(e){this.producerMap.set(e.id,e),await this.generateProducerStreamMap(e),e.observer.on("close",this.deregisterProducer.bind(this,e)),e.observer.on("pause",this.pauseProducer.bind(this,e.id)),e.observer.on("resume",this.resumeProducer.bind(this,e.id)),e.appData.screenShare===!0&&this.screenShareProducers.add(e.id)}async registerConsumer(e){this.consumerMap.set(e.id,e),await this.generateConsumerStreamMap(e),this.consumerPeerIdMap.set(e.id,{producerId:e.producerId,peerId:e.appData.peerId,appData:e.appData}),e.observer.on("close",this.deregisterConsumer.bind(this,e)),e.observer.on("pause",this.pauseConsumer.bind(this,e.id)),e.observer.on("resume",this.resumeConsumer.bind(this,e.id)),e.appData.screenShare===!0&&this.screenShareConsumers.add(e.id)}async generateConsumerStreamMap(e,s=!1){const n=await e.getStats(),i=this.parseRTCReport(n,["inbound-rtp"],!1,e.id),a=[...i.consumerStreamMap.values()][0],o=s?this.getConsumerStatsFromParsedConsumerStats(i,a,e.id):void 0;for(const c of n.values())switch(c.type){case"inbound-rtp":{this.inboundConsumerMap.set(c.id,e.id);break}}return o}deregisterProducer(e){this.producerMap.delete(e.id),this.outboundProducerMap.forEach((s,n)=>{s===e.id&&this.outboundProducerMap.delete(n)}),this.pausedProducerMap.delete(e.id),this.screenShareProducers.delete(e.id)}deregisterConsumer(e){this.consumerMap.delete(e.id),this.inboundConsumerMap.forEach((s,n)=>{s===e.id&&this.inboundConsumerMap.delete(n)}),this.consumerPeerIdMap.delete(e.id),this.pausedConsumerMap.delete(e.id),this.screenShareConsumers.delete(e.id)}getIceCandidateStats(e){var s;return{id:e.id,type:e.candidateType||e.type,address:e.address,port:e.port,url:e.url,protocol:(s=e.relayProtocol)!=null?s:e.protocol,networkType:e.networkType,relatedAddress:e.relatedAddress,relatedPort:e.relatedPort}}parseRTCReport(e,s=[],n=!1,i=void 0,a=void 0){var w,R,D,x,B,b,Q,te,ce,he,Ne,de,He;const o=e,c=new op,l=s.length?new Set(s):void 0,p=[],h=[],f=[],g=new Map,_=new Map;for(const A of o.values()){if(l){if(l.size===0)break;if(l.has(A.type))n&&l.delete(A.type);else continue}switch(A.type){case"local-candidate":{p.push(this.getIceCandidateStats(A));break}case"remote-candidate":{h.push(this.getIceCandidateStats(A));break}case"candidate-pair":{const{nominated:S}=A,{selected:C}=A,V=A,Le={nominated:S!=null?S:C,currentRoundTripTime:V.currentRoundTripTime,totalRoundTripTime:V.totalRoundTripTime,bytesReceived:V.bytesReceived,bytesSent:V.bytesSent,availableOutgoingBitrate:V.availableOutgoingBitrate,availableIncomingBitrate:V.availableIncomingBitrate,lastPacketReceivedTimestamp:V.lastPacketReceivedTimestamp,lastPacketSentTimestamp:V.lastPacketSentTimestamp,localCandidateId:V.localCandidateId,remoteCandidateId:V.remoteCandidateId,bytesDiscardedOnSend:V.bytesDiscardedOnSend,packetsSent:V.packetsSent,packetsReceived:V.packetsReceived,packetsDiscardedOnSend:V.packetsDiscardedOnSend};f.push(Le),(A.nominated===!0||A.selected===!0)&&(c.candidatePair=Le);break}case"transport":{const S=A;a&&(a.producing&&(this.overallProducingTransportsStatsMap[a.id]||(this.overallProducingTransportsStatsMap[a.id]={totalPacketsSent:0})),a.consuming&&(this.overallConsumingTransportsStatsMap[a.id]||(this.overallConsumingTransportsStatsMap[a.id]={totalPacketsReceived:0})));const C={bytesReceived:S.bytesReceived,bytesSent:S.bytesSent,packetsSent:S.packetsSent,packetsReceived:S.packetsReceived,dtlsCipher:S.dtlsCipher,dtlsState:S.dtlsState,iceRole:S.iceRole};if(c.transport=C,a){if(a.producing){const V=this.overallProducingTransportsStatsMap[a.id];this.processProducingTransportStats(a.id,V,C)}if(a.consuming){const V=this.overallConsumingTransportsStatsMap[a.id];this.processConsumingTransportStats(a.id,V,C)}}break}case"remote-inbound-rtp":{const S=A,C={jitter:S.jitter,fractionLost:S.fractionLost,roundTripTime:S.roundTripTime,roundTripTimeMeasurements:S.roundTripTimeMeasurements,totalRoundTripTime:S.totalRoundTripTime,packetsLost:S.packetsLost};c.remoteInboundRtp.set(S.localId,C);break}case"outbound-rtp":{const S=A,C=i||this.outboundProducerMap.get(A.id),V=this.pausedProducerMap.get(C);if(V){if(V.lastReportCalculated===!0)break;this.pausedProducerMap.set(C,{lastReportCalculated:!0})}this.overallProducersStatsMap[C]||(this.overallProducersStatsMap[C]={totalVideoPacketsSent:0,totalAudioPacketsSent:0});const Le=this.overallProducersStatsMap[C];if(["video","audio"].includes(S.mediaType)||["video","audio"].includes(S.kind)){if(!this.outboundProducerMap.has(A.id)){c.staleProducerStreamMap=!0;break}const Ye=this.callStatsInstance.producers.get(C);if(((w=Ye==null?void 0:Ye.track)==null?void 0:w.readyState)==="ended")break;c.producerStreamMap.has(C)||c.producerStreamMap.set(C,{outboundVideoRtpId:[],outboundAudioRtpId:[]});const $={bytesSent:S.bytesSent,packetsSent:S.packetsSent,nackCount:S.nackCount,ssrc:S.ssrc,mid:S.mid,active:S.active,codecId:S.codecId,headerBytesSent:S.headerBytesSent||0,totalPacketSendDelay:S.totalPacketSendDelay||0};if(S.mediaType==="video"||S.kind==="video"){const M=S,et={frameHeight:M.frameHeight,frameWidth:M.frameWidth,framesEncoded:M.framesEncoded,framesDropped:M.framesDropped?M.framesDropped:M.droppedFrames,framesPerSecond:M.framesPerSecond?M.framesPerSecond:M.framerateMean,framesSent:M.framesSent,keyFramesEncoded:M.keyFramesEncoded,firCount:M.firCount,encoderImplementation:M.encoderImplementation,hugeFramesSent:M.hugeFramesSent,pliCount:M.pliCount,qpSum:M.qpSum,qualityLimitationReason:M.qualityLimitationReason,qualityLimitationDurations:M.qualityLimitationDurations,qualityLimitationResolutionChanges:M.qualityLimitationResolutionChanges,totalEncodeTime:M.totalEncodeTime,totalPacketSendDelay:M.totalEncodeTime,retransmittedBytesSent:M.retransmittedBytesSent,retransmittedPacketsSent:M.retransmittedPacketsSent,scalabilityMode:M.scalabilityMode,powerEfficientEncoder:M.powerEfficientEncoder,...$};c.outboundVideoRtp.set(A.id,et),c.producerStreamMap.get(C).outboundVideoRtpId.push(A.id),this.processOutboundProducerVideoStats(C,Le,et)}else if(S.mediaType==="audio"||S.kind==="audio"){const M=S,et={retransmittedBytesSent:M.retransmittedBytesSent,retransmittedPacketsSent:M.retransmittedPacketsSent,...$};c.outboundAudioRtp.set(A.id,et),c.producerStreamMap.get(C).outboundAudioRtpId.push(A.id),this.processOutboundProducerAudioStats(C,Le,et)}}else this.callStatsInstance.logger.error(`Callstats: Unknown Outbound-rtp. mediatype: ${S.mediaType} kind: ${S.kind}`);break}case"inbound-rtp":{const S=A,C=i||this.inboundConsumerMap.get(A.id),V=this.pausedConsumerMap.get(C);if(V){if(V.lastReportCalculated===!0)break;this.pausedConsumerMap.set(C,{lastReportCalculated:!0})}if(S.ssrc===1234)break;this.overallConsumersStatsMap[C]||(this.overallConsumersStatsMap[C]={totalVideoPacketsReceived:0,totalAudioPacketsReceived:0});const Le=this.overallConsumersStatsMap[C];if(["video","audio"].includes(S.mediaType)||["video","audio"].includes(S.kind)){if(!this.inboundConsumerMap.has(A.id)){c.staleConsumerStreamMap=!0;break}c.consumerStreamMap.has(C)||c.consumerStreamMap.set(C,{inboundVideoRtpId:[],inboundAudioRtpId:[]});const Ye={bytesReceived:S.bytesReceived,packetsReceived:S.packetsReceived,packetsLost:S.packetsLost>=0?S.packetsLost:0,jitter:S.jitter,nackCount:S.nackCount,jitterBufferDelay:S.jitterBufferDelay,jitterBufferEmittedCount:S.jitterBufferEmittedCount,lastPacketReceivedTimestamp:S.lastPacketReceivedTimestamp,ssrc:S.ssrc,mid:S.mid,codecId:S.codecId,headerBytesReceived:S.headerBytesReceived||0,packetsDiscarded:S.packetsDiscarded||0,jitterBufferMinimumDelay:S.jitterBufferMinimumDelay||0,jitterBufferTargetDelay:S.jitterBufferTargetDelay||0};if(S.mediaType==="video"||S.kind==="video"){const $=S,M={frameHeight:$.frameHeight,frameWidth:$.frameWidth,framesDecoded:$.framesDecoded,framesDropped:$.framesDropped?$.framesDropped:$.droppedFrames,framesPerSecond:$.framesPerSecond?$.framesPerSecond:$.framerateMean,framesReceived:$.framesReceived,keyFramesDecoded:$.keyFramesDecoded,firCount:$.firCount,decoderImplementation:$.decoderImplementation,pliCount:$.pliCount,totalProcessingDelay:$.totalProcessingDelay,qpSum:$.qpSum||0,totalAssemblyTime:$.totalAssemblyTime||0,totalDecodeTime:$.totalDecodeTime||0,totalFreezesDuration:$.totalFreezesDuration||0,totalInterFrameDelay:$.totalInterFrameDelay||0,totalPausesDuration:$.totalPausesDuration||0,totalSquaredInterFrameDelay:$.totalSquaredInterFrameDelay||0,freezeCount:$.freezeCount||0,pauseCount:$.pauseCount||0,powerEfficientDecoder:$.powerEfficientDecoder,...Ye};M.score=sp({frameWidth:M.frameWidth||0,framesDecoded:(M.framesDecoded||0)-(((R=this.videoConsumerToStatsMap.get(C))==null?void 0:R.framesDecoded)||0),framesPerSecond:M.framesPerSecond||0,packetsLost:(M.packetsLost||0)-(((D=this.videoConsumerToStatsMap.get(C))==null?void 0:D.packetsLost)||0),packetsReceived:(M.packetsReceived||0)-(((x=this.videoConsumerToStatsMap.get(C))==null?void 0:x.packetsReceived)||0),jitter:M.jitter||0,isScreenShare:this.screenShareConsumers.has(C)}),_.set(C,{score:+(M.score*10).toFixed(),frameWidth:M.frameWidth||0,frameHeight:M.frameHeight||0,framesPerSecond:M.framesPerSecond||0,packetsLostPercentage:Jo({packetsLost:(M.packetsLost||0)-(((B=this.videoConsumerToStatsMap.get(C))==null?void 0:B.packetsLost)||0),packetsReceived:(M.packetsReceived||0)-(((b=this.videoConsumerToStatsMap.get(C))==null?void 0:b.packetsReceived)||0)}),jitter:M.jitter||0,isScreenShare:this.screenShareConsumers.has(C),bitrate:((M.bytesReceived||0)-(((Q=this.videoConsumerToStatsMap.get(C))==null?void 0:Q.bytesReceived)||0))*8/7}),this.videoConsumerToStatsMap.set(C,M),c.inboundVideoRtp.set(A.id,M),c.consumerStreamMap.get(C).inboundVideoRtpId.push(A.id),this.processInboundConsumerVideoStats(C,Le,M)}else if(S.mediaType==="audio"||S.kind==="audio"){const $=S,M={audioLevel:$.audioLevel,concealedSamples:$.concealedSamples,concealmentEvents:$.concealmentEvents,totalAudioEnergy:$.totalAudioEnergy,totalSamplesDuration:$.totalSamplesDuration,totalSamplesReceived:$.totalSamplesReceived,fecPacketsDiscarded:$.fecPacketsDiscarded||0,fecPacketsReceived:$.fecPacketsReceived||0,insertedSamplesForDeceleration:$.insertedSamplesForDeceleration||0,removedSamplesForAcceleration:$.removedSamplesForAcceleration||0,silentConcealedSamples:$.silentConcealedSamples||0,playoutId:$.playoutId,...Ye};M.score=rp({concealmentEvents:(M.concealmentEvents||0)-(((te=this.audioConsumerToStatsMap.get(C))==null?void 0:te.concealmentEvents)||0),packetsLost:(M.packetsLost||0)-(((ce=this.audioConsumerToStatsMap.get(C))==null?void 0:ce.packetsLost)||0),packetsReceived:(M.packetsReceived||0)-(((he=this.audioConsumerToStatsMap.get(C))==null?void 0:he.packetsReceived)||0),jitter:M.jitter||0}),_.set(C,{score:+(M.score*10).toFixed(),packetsLostPercentage:Jo({packetsLost:(M.packetsLost||0)-(((Ne=this.audioConsumerToStatsMap.get(C))==null?void 0:Ne.packetsLost)||0),packetsReceived:(M.packetsReceived||0)-(((de=this.audioConsumerToStatsMap.get(C))==null?void 0:de.packetsReceived)||0)}),jitter:M.jitter||0,isScreenShare:this.screenShareConsumers.has(C),bitrate:((M.bytesReceived||0)-(((He=this.audioConsumerToStatsMap.get(C))==null?void 0:He.bytesReceived)||0))*8/7}),this.audioConsumerToStatsMap.set(C,M),c.inboundAudioRtp.set(A.id,M),c.consumerStreamMap.get(C).inboundAudioRtpId.push(A.id),this.processInboundConsumerAudioStats(C,Le,M)}}else this.callStatsInstance.logger.error(`Callstats: Unknown Inbound-rtp. mediatype: ${S.mediaType} kind: ${S.kind}`);break}}}if(c.producerStreamMap.forEach((A,S)=>{var C,V,Le,Ye,$,M,et,us,bo,Co,Ro,Po,ko,Io,Ao,Mo,Do,Oo,No,Lo,xo,Fo,$o;if(A.outboundVideoRtpId.length>0){const Ee=[];A.outboundVideoRtpId.forEach(Ch=>{Ee.push(c.outboundVideoRtp.get(Ch))});const se=this.getWorkingSimulcastVideoStats(Ee);se.score=ep({frameWidth:se.frameWidth||0,framesPerSecond:se.framesPerSecond||0,jitter:((C=se.remoteData)==null?void 0:C.jitter)||0,isScreenShare:this.screenShareProducers.has(S),packetsSent:(se.packetsSent||0)-(((V=this.videoProducerToStatsMap.get(S))==null?void 0:V.packetsSent)||0),packetsLost:(((Le=se.remoteData)==null?void 0:Le.packetsLost)||0)-((($=(Ye=this.videoProducerToStatsMap.get(S))==null?void 0:Ye.remoteData)==null?void 0:$.packetsLost)||0),framesEncoded:(se.framesEncoded||0)-(((M=this.videoProducerToStatsMap.get(S))==null?void 0:M.framesEncoded)||0)}),g.set(S,{score:+(se.score*10).toFixed(),frameWidth:se.frameWidth||0,frameHeight:se.frameHeight||0,framesPerSecond:se.framesPerSecond||0,jitter:((et=se.remoteData)==null?void 0:et.jitter)||0,isScreenShare:this.screenShareProducers.has(S),packetsLostPercentage:Wo({packetsSent:(se.packetsSent||0)-(((us=this.videoProducerToStatsMap.get(S))==null?void 0:us.packetsSent)||0),packetsLost:(((bo=se.remoteData)==null?void 0:bo.packetsLost)||0)-(((Ro=(Co=this.videoProducerToStatsMap.get(S))==null?void 0:Co.remoteData)==null?void 0:Ro.packetsLost)||0)}),bitrate:((se.bytesSent||0)-(((Po=this.videoProducerToStatsMap.get(S))==null?void 0:Po.bytesSent)||0))*8/7,cpuLimitations:se.qualityLimitationReason==="cpu",bandwidthLimitations:se.qualityLimitationReason==="bandwidth"}),this.videoProducerToStatsMap.set(S,se)}else if(A.outboundAudioRtpId.length>0){const Ee=c.outboundAudioRtp.get(A.outboundAudioRtpId[0]);Ee.score=Zh({packetsSent:(Ee.packetsSent||0)-(((ko=this.audioProducerToStatsMap.get(S))==null?void 0:ko.packetsSent)||0),packetsLost:(((Io=Ee.remoteData)==null?void 0:Io.packetsLost)||0)-(((Mo=(Ao=this.audioProducerToStatsMap.get(S))==null?void 0:Ao.remoteData)==null?void 0:Mo.packetsLost)||0),jitter:((Do=Ee.remoteData)==null?void 0:Do.jitter)||0}),g.set(S,{score:+(Ee.score*10).toFixed(),bitrate:((Ee.bytesSent||0)-(((Oo=this.audioProducerToStatsMap.get(S))==null?void 0:Oo.bytesSent)||0))*8/7,packetsLostPercentage:Wo({packetsSent:(Ee.packetsSent||0)-(((No=this.audioProducerToStatsMap.get(S))==null?void 0:No.packetsSent)||0),packetsLost:(((Lo=Ee.remoteData)==null?void 0:Lo.packetsLost)||0)-(((Fo=(xo=this.audioProducerToStatsMap.get(S))==null?void 0:xo.remoteData)==null?void 0:Fo.packetsLost)||0)}),jitter:(($o=Ee.remoteData)==null?void 0:$o.jitter)||0,isScreenShare:this.screenShareProducers.has(S)}),this.audioProducerToStatsMap.set(S,Ee)}}),f.forEach(A=>{const S=p.find(V=>V.id===A.localCandidateId?(A.localCandidateId=V.id,V):null),C=h.find(V=>V.id===A.remoteCandidateId?(A.remoteCandidateId=V.id,V):null);S&&(A.localCandidateType=S.type,A.localCandidateAddress=hs(S.address),A.localCandidatePort=S.port,A.localCandidateProtocol=S.protocol,A.localCandidateUrl=S.url,A.localCandidateNetworkType=S.networkType,A.localCandidateRelatedAddress=hs(S.relatedAddress),A.localCandidateRelatedPort=S.relatedPort),C&&(A.remoteCandidateType=C.type,A.remoteCandidateAddress=hs(C.address),A.remoteCandidatePort=C.port,A.remoteCandidateProtocol=C.protocol,A.remoteCandidateUrl=C.url)}),c.candidatePair&&(c.transport?(c.transport.bytesReceived=c.candidatePair.bytesReceived,c.transport.bytesSent=c.candidatePair.bytesSent,c.transport.totalRoundTripTime=c.candidatePair.totalRoundTripTime,c.transport.availableOutgoingBitrate=c.candidatePair.availableOutgoingBitrate,c.transport.availableIncomingBitrate=c.candidatePair.availableIncomingBitrate,c.transport.roundTripTime=c.candidatePair.currentRoundTripTime):c.transport={bytesReceived:c.candidatePair.bytesReceived,bytesSent:c.candidatePair.bytesSent,totalRoundTripTime:c.candidatePair.totalRoundTripTime,availableOutgoingBitrate:c.candidatePair.availableOutgoingBitrate,availableIncomingBitrate:c.candidatePair.availableIncomingBitrate,roundTripTime:c.candidatePair.currentRoundTripTime}),c.transport&&(c.transport.candidatePairs=f),c.transport&&!c.transport.roundTripTime){let A=0,S=0;c.remoteInboundRtp.forEach((C,V)=>{C.roundTripTime&&C.roundTripTime>A&&(A=C.roundTripTime,S=C.totalRoundTripTime)}),c.transport.roundTripTime=A,c.transport.totalRoundTripTime=S}if(_.size>0)try{this.observer.emit("consumer_score",_)}catch(A){}if(g.size>0)try{this.observer.emit("producer_score",g)}catch(A){}return c}getProducerStatsFromReport(e){const s=[];try{e.producerStreamMap.forEach((n,i)=>{const a=this.producerMap.get(i),o=a.track.getSettings(),c=n.outboundVideoRtpId.map(p=>{const h=e.outboundVideoRtp.get(p);return h.frameHeight||(h.frameHeight=o.height,h.frameWidth=o.width,h.framesPerSecond=o.frameRate),h}),l={producerId:i,appData:a.appData,videoStats:c,audioStats:n.outboundAudioRtpId.map(p=>e.outboundAudioRtp.get(p))};s.push(l)})}catch(n){console.error("getProducersReport: ",n,e)}return s}getConsumerStatsFromParsedConsumerStats(e,s,n){let i;try{const{peerId:a,producerId:o,appData:c}=this.consumerPeerIdMap.get(n),l=s==null?void 0:s.inboundVideoRtpId.map(p=>{const f=this.consumerMap.get(n).track.getSettings(),g=e.inboundVideoRtp.get(p);return g.frameHeight||(g.frameHeight=f.height,g.frameWidth=f.width,g.framesPerSecond=f.frameRate),g});i={consumerId:n,peerId:a,producerId:o,appData:c,videoStats:l,audioStats:s==null?void 0:s.inboundAudioRtpId.map(p=>e.inboundAudioRtp.get(p))}}catch(a){console.error("getConsumerStatsFromParsedConsumerStats: ",a,e)}return i}getConsumerStatsFromReport(e){const s=[];try{e.consumerStreamMap.forEach((n,i)=>{s.push(this.getConsumerStatsFromParsedConsumerStats(e,n,i))})}catch(n){console.error("getConsumerStatsFromReport: ",n,e)}return s}}class wT extends dp{}function Qo(r,t,e,s){if(r!=null&&r.logger&&r.logger.error("Callstats::handleError",{error:s}),typeof e=="function"&&s instanceof t)e.call(null,s,r);else throw s}function lp(r,t,e){const s=r.value;return r.value=function(...n){try{const i=s.apply(this,n);return i&&i instanceof Promise?i.catch(a=>{Qo(this,t,e,a)}):i}catch(i){Qo(this,t,e,i)}return null},r}const X=(r,t)=>(e,s,n)=>{const i=n.value;return n.value=function(...a){try{const o=i.apply(this,a);return o&&o instanceof Promise?o.catch(c=>{Qo(this,r,t,c)}):o}catch(o){Qo(this,r,t,o)}return null},n},bT=(r,t)=>(e,s,n)=>{if(n)return lp(n,r,t);for(const i of Reflect.ownKeys(e.prototype).filter(a=>a!=="constructor")){const a=Object.getOwnPropertyDescriptor(e.prototype,i);a.value instanceof Function&&Object.defineProperty(e.prototype,i,lp(a,r,t))}};var z=globalThis&&globalThis.__decorate||function(r,t,e,s){var n=arguments.length,i=n<3?t:s===null?s=Object.getOwnPropertyDescriptor(t,e):s,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(r,t,e,s);else for(var o=r.length-1;o>=0;o--)(a=r[o])&&(i=(n<3?a(i):n>3?a(t,e,i):a(t,e))||i);return n>3&&i&&Object.defineProperty(t,e,i),i};const Y=console;let W=class extends ne{constructor(e="https://api.testingv3.dyte.in",s="Blink",n=na.PROD,i,a,o,c){super();m(this,"observer");m(this,"eventHandler");m(this,"measurements");m(this,"producingTransport");m(this,"consumingTransport");m(this,"producers",new Map);m(this,"consumers",new Map);m(this,"iceServers");m(this,"connectionInfoPromise");m(this,"pingStatsTimeout");m(this,"logger");m(this,"env");m(this,"apiHostnames");m(this,"peerId");m(this,"consumerSharedMediaStatesMap",new Map);m(this,"currentUserMediaStates",{});switch(this.env=n,this.apiHostnames=c,this.logger=a,this.peerId=o,this.eventHandler=new cT({logger:a,peerId:o,apiHostnames:c}),this.logger.debug("callStats::engineName: ",{engineName:s}),s){case"Blink":this.measurements=new _T;break;case"Gecko":this.measurements=new dp;break;case"WebKit":this.measurements=new wT;break;default:throw Error(`Unknown engineName! ${s}`)}this.measurements.callStatsInstance=this,this.registerProducer=this.registerProducer.bind(this),this.registerConsumer=this.registerConsumer.bind(this),this.observer=new ne,this.measurements.observer.on("consumer_score",l=>{a.debug(`callStats::consumer_score ${[...l.entries()]}`),this.eventHandler.emit("consumer_score",l)}),this.measurements.observer.on("producer_score",l=>{a.debug(`callStats::producer_score ${[...l.entries()]}`),this.eventHandler.emit("producer_score",l)})}registerIceServers(e){this.iceServers=e}registerConsumer(e){var s;this.consumerSharedMediaStatesMap.has(e.id)||this.consumerSharedMediaStatesMap.set(e.id,{}),this.consumers.set(e.id,e),this.measurements.registerConsumer(e),this.logger.debug("callStats::registerConsumer",{consumerId:e.id,consumerkind:e.kind,isScreenShare:!!((s=e.appData)!=null&&s.screenShare)}),e.observer.on("close",this.deRegisterConsumer.bind(this,e))}registerProducer(e){var s;this.producers.set(e.id,e),this.measurements.registerProducer(e),this.logger.debug("callStats::registerProducer",{producerId:e.id,producerKind:e.kind,isScreenShare:!!((s=e.appData)!=null&&s.screenShare)}),e.observer.on("close",this.deRegisterProducer.bind(this,e))}sendConsumerSharedMediaStateEvent(e,s){this.consumerSharedMediaStatesMap.has(e)||this.consumerSharedMediaStatesMap.set(e,{});const n=this.consumerSharedMediaStatesMap.get(e);this.consumerSharedMediaStatesMap.set(e,Object.assign(n,s))}registerProducingTransport(e){var n;this.producingTransport=e,e.observer.on("close",this.disconnectProducingTransport.bind(this,e)),e.observer.on("disconnect",this.disconnectProducingTransport.bind(this,e)),Array.from(((n=e._producers)==null?void 0:n.values())||[]).forEach(i=>{this.registerProducer(i)}),e.observer.on("newproducer",this.registerProducer)}registerConsumingTransport(e){var n;this.consumingTransport=e,e.observer.on("close",this.disconnectConsumingTransport.bind(this,e)),e.observer.on("disconnect",this.disconnectConsumingTransport.bind(this,e)),Array.from(((n=e._consumers)==null?void 0:n.values())||[]).forEach(i=>{this.registerConsumer(i)}),e.observer.on("newconsumer",this.registerConsumer)}deRegisterConsumer(e){this.consumers.delete(e.id)}deRegisterProducer(e){var s;this.producers.delete(e.id),this.logger.debug("callStats::deRegisterProducer",{producerId:e.id,producerKind:e.kind,isScreenShare:!!((s=e.appData)!=null&&s.screenShare)})}disconnectConsumingTransport(){this.consumingTransport=void 0}disconnectProducingTransport(){this.producingTransport=void 0}callEvent(e){this.eventHandler.callEvent(e)}sendPreCallTestBeginEvent(e=!1,s){this.connectionInfoPromise=this.measurements.getNetworkInfo(this.iceServers,e),this.eventHandler.callEvent({event:F.PRECALL_TEST_BEGIN,timestamp:s}),this.connectionInfoPromise&&this.connectionInfoPromise.then(n=>{this.eventHandler.callEvent({event:F.PRECALL_TEST_COMPLETE,metaData:{connectionInfo:n},timestamp:s})})}sendScreenShareToggleEvent(e,s=null,n){this.currentUserMediaStates.screen=e,this.eventHandler.callEvent({event:e?F.SCREENSHARE_STARTED:F.SCREENSHARE_STOPPED,metaData:{ssrc:s},timestamp:n})}sendScreenShareRequestedEvent(e){this.eventHandler.callEvent({event:F.SCREENSHARE_START_REQUESTED,timestamp:e})}sendActiveSpeakerEvent(e,s){this.eventHandler.callEvent({event:F.DOMINANT_SPEAKER,metaData:{peerId:e},timestamp:s})}devices(e,s,n){this.eventHandler.callEvent({event:e===Yt.AUDIO&&F.AUDIO_DEVICES_UPDATES||e===Yt.VIDEO&&F.VIDEO_DEVICES_UPDATES||e===Yt.SPEAKER&&F.SPEAKER_DEVICES_UPDATES,metaData:{deviceList:s},timestamp:n})}selectedDevice(e,s,n){this.eventHandler.callEvent({event:e===Yt.AUDIO&&F.SELECTED_MICROHPONE_UPDATE||e===Yt.VIDEO&&F.SELECTED_CAMERA_UPDATE||e===Yt.SPEAKER&&F.SELECTED_SPEAKER_UPDATE,metaData:{device:s},timestamp:n})}mediaPermission(e,s,n){this.eventHandler.callEvent({event:F.MEDIA_PERMISSION,metaData:{deviceType:e,permission:s},timestamp:n})}mediaPlaybackFailed(e,s){this.eventHandler.callEvent({event:e===Yt.AUDIO&&F.AUDIO_PLAY_FAILED||e===Yt.VIDEO&&F.VIDEO_PLAY_FAILED,metaData:{deviceType:e},timestamp:s})}mediaTrackMuted(e,s){this.eventHandler.callEvent({event:e===Yt.AUDIO&&F.AUDIO_TRACK_MUTED||e===Yt.VIDEO&&F.VIDEO_TRACK_MUTED,metaData:{deviceType:e},timestamp:s})}tabChanged(e,s){this.eventHandler.callEvent({event:F.TAB_CHANGE,metaData:{isMeetingsTabActive:e},timestamp:s})}browserBackgrounded(e){this.eventHandler.callEvent({event:F.BROWSER_BACKGROUNDED,timestamp:e})}browserForegrounded(e){this.eventHandler.callEvent({event:F.BROWSER_FOREGROUNDED,timestamp:e})}legacySwitch(e,s){this.eventHandler.callEvent({event:F.LEGACY_SWITCH,metadata:{on:e},timestamp:s})}async getPreCallTestResults(){return this.connectionInfoPromise}sendCallJoinBeginEvent(e,s){e={...e,meetingEnv:this.env},e.deviceInfo={...e.deviceInfo,userAgent:navigator.userAgent,cpus:navigator.hardwareConcurrency,memory:navigator.deviceMemory},this.eventHandler.callEvent({event:F.CALL_JOIN_BEGIN,metaData:{peerMetaData:e},timestamp:s})}sendNetworkQualityTestBeginEvent(e,s){this.eventHandler.callEvent({event:F.NET_QUALITY_TEST_BEGIN,timestamp:s}),new Promise(async(i,a)=>{const o=[];try{for(const c of e)try{if(c.iceServers&&c.iceServers.length>0){const l=await this.measurements.getNetworkQuality(c.iceServers);o.push({...c,networkResults:l})}}catch(l){console.warn("Error handling ",l)}i({regionData:o})}catch(c){console.warn("Error in callstats, ",c),a(c)}}).then(i=>{this.eventHandler.callEvent({event:F.NET_QUALITY_TEST_END,timestamp:s,metaData:i})})}sendWebSocketConnectedEvent(e){this.eventHandler.callEvent({event:F.WEBSOCKET_CONNECTED,timestamp:e})}sendTransportConnectedEvent(e){this.eventHandler.callEvent({event:F.TRANSPORT_CONNECTED,timestamp:e})}sendAudioToggleEvent(e,s){this.currentUserMediaStates.audio=e;let n;e?n=F.AUDIO_ON:n=F.AUDIO_OFF,this.eventHandler.callEvent({event:n,timestamp:s})}sendVideoToggleEvent(e,s){this.currentUserMediaStates.video=e;let n;e?n=F.VIDEO_ON:n=F.VIDEO_OFF,this.eventHandler.callEvent({event:n,timestamp:s})}sendParticipantRoleToggleEvent(e,s){this.eventHandler.callEvent({event:F.PARTICIPANT_ROLE,timestamp:s,metaData:e})}startPingStats(e=7e3){this.sendPingStatsEvent(!1,new Date),this.pingStatsTimeout=setInterval(this.sendPingStatsEvent.bind(this),e)}stopPingStats(){clearInterval(this.pingStatsTimeout)}async sendPingStatsEvent(e=!0,s){let n,i;if(this.producingTransport&&(n=await this.measurements.getProcessedStats(this.producingTransport,!1,!0),!n||!(n!=null&&n.producerReport))){this.logger.debug("callStats::sendPingStatsEvent::staleProducingTransport",{disclaimer:"Stale producer? Regenerating Stream Maps!"});const o=await this.measurements.getProducersReport([...this.producers.values()]);n&&o?n.producerReport=o:(n=await this.measurements.getProcessedStats(this.producingTransport,!1,!0),(!n||!(n!=null&&n.producerReport))&&this.logger.debug("callStats::sendPingStatsEvent::noProducingTransportReport",{disclaimer:"Stream maps invalid despite regenerating!"}))}if(this.consumingTransport&&(i=await this.measurements.getProcessedStats(this.consumingTransport,!0,!1),!i||!i.consumerReport)){this.logger.debug("callStats::sendPingStatsEvent::staleConsumingTransport",{disclaimer:"Stale consumer? Regenerating Stream Maps!"});const o=await this.measurements.getConsumersReport([...this.consumers.values()]);i&&o?i.consumerReport=o:(i=await this.measurements.getProcessedStats(this.consumingTransport,!0,!1),(!i||!i.consumerReport)&&this.logger.debug("callStats::sendPingStatsEvent::noConsumingTransportReport",{disclaimer:"Stream maps invalid despite regenerating!"}))}const a={producingTransportStats:n?n==null?void 0:n.transportReport:void 0,consumingTransportStats:i?i==null?void 0:i.transportReport:void 0,producerStats:[].concat((n==null?void 0:n.producerReport)||[]).concat((i==null?void 0:i.producerReport)||[]),consumerStats:[].concat((i==null?void 0:i.consumerReport)||[]).concat((n==null?void 0:n.consumerReport)||[])};if(e&&a.producerStats.length===0&&a.consumerStats.length===0){await this.eventHandler.flush();return}this.eventHandler.callEvent({event:F.PING_STAT,metaData:a,timestamp:s})}sendIVSPlayerRebufferEvent(e){this.eventHandler.callEvent({event:F.IVS_PLAYER_REBUFFERING,timestamp:e})}sendIVSPlayerAudioBlockEvent(e){this.eventHandler.callEvent({event:F.IVS_PLAYER_AUDIO_BLOCKED,timestamp:e})}sendIVSPlayerPlaybackBlockedEvent(e){this.eventHandler.callEvent({event:F.IVS_PLAYER_PLAYBACK_BLOCKED,timestamp:e})}sendIVSPlayerNetworkUnavailableEvent(e){this.eventHandler.callEvent({event:F.IVS_PLAYER_NETWORK_UNAVAILABLE,timestamp:e})}sendIVSPlayerInitializedEvent(e){this.eventHandler.callEvent({event:F.IVS_PLAYER_INITIALIZED,timestamp:e})}sendIVSPlayerWorkerErrorEvent(e){this.eventHandler.callEvent({event:F.IVS_PLAYER_WORKER_ERROR,timestamp:e})}sendIVSPlayerErrorEvent(e,s){this.eventHandler.callEvent({event:F.IVS_PLAYER_ERROR,timestamp:s,metaData:e})}sendIVSPlayerRecoverableErrorEvent(e,s){this.eventHandler.callEvent({event:F.IVS_PLAYER_RECOVERABLE_ERROR,timestamp:s,metaData:e})}sendIVSPlayerAnalyticsEvent(e,s){this.eventHandler.callEvent({event:F.IVS_PLAYER_ANALYTICS_EVENT,timestamp:s,metaData:e})}sendIVSPlayerPlaybackRateChangedEvent(e,s){this.eventHandler.callEvent({event:F.IVS_PLAYER_PLAYBACK_RATE_CHANGED,timestamp:s,metaData:{updatedPlaybackRate:e}})}sendIVSPlayerQualityChanged(e,s){this.eventHandler.callEvent({event:F.IVS_PLAYER_QUALITY_CHANGED,timestamp:s,metaData:e})}sendPlayerLiveLatency(e,s){this.eventHandler.callEvent({event:F.LIVESTREAM_LATENCY,timestamp:s,metaData:{latency:e}})}sendDisconnectEvent(e){this.eventHandler.callEvent({event:F.DISCONNECT,timestamp:e})}sendReconnectEvent(e){this.eventHandler.callEvent({event:F.RECONNECT_ATTEMPT,timestamp:e})}expectedVideoResolution(e,s,n){this.eventHandler.callEvent({event:F.EXPECTED_VIDEO_RESOLUTION,timestamp:n,metaData:{frameWidth:e,frameHeight:s}})}expectedScreenshareResolution(e,s,n){this.eventHandler.callEvent({event:F.EXPECTED_SCREENSHARE_RESOLUTION,timestamp:n,metaData:{frameWidth:e,frameHeight:s}})}};z([X(TypeError,(r,t)=>Y.error(t,r))],W.prototype,"registerIceServers",null),z([X(TypeError,(r,t)=>Y.error(t,r))],W.prototype,"registerConsumer",null),z([X(TypeError,(r,t)=>Y.error(t,r))],W.prototype,"registerProducer",null),z([X(TypeError,(r,t)=>Y.error(t,r))],W.prototype,"sendConsumerSharedMediaStateEvent",null),z([X(TypeError,(r,t)=>Y.error(t,r))],W.prototype,"registerProducingTransport",null),z([X(TypeError,(r,t)=>Y.error(t,r))],W.prototype,"registerConsumingTransport",null),z([X(TypeError,(r,t)=>Y.error(t,r))],W.prototype,"deRegisterConsumer",null),z([X(TypeError,(r,t)=>Y.error(t,r))],W.prototype,"deRegisterProducer",null),z([X(TypeError,(r,t)=>Y.error(t,r))],W.prototype,"disconnectConsumingTransport",null),z([X(TypeError,(r,t)=>Y.error(t,r))],W.prototype,"disconnectProducingTransport",null),z([X(TypeError,(r,t)=>Y.error(t,r))],W.prototype,"sendPreCallTestBeginEvent",null),z([X(TypeError,(r,t)=>Y.error(t,r))],W.prototype,"sendScreenShareToggleEvent",null),z([X(TypeError,(r,t)=>Y.error(t,r))],W.prototype,"sendScreenShareRequestedEvent",null),z([X(TypeError,(r,t)=>Y.error(t,r))],W.prototype,"sendActiveSpeakerEvent",null),z([X(TypeError,(r,t)=>Y.error(t,r))],W.prototype,"devices",null),z([X(TypeError,(r,t)=>Y.error(t,r))],W.prototype,"selectedDevice",null),z([X(TypeError,(r,t)=>Y.error(t,r))],W.prototype,"mediaPermission",null),z([X(TypeError,(r,t)=>Y.error(t,r))],W.prototype,"mediaPlaybackFailed",null),z([X(TypeError,(r,t)=>Y.error(t,r))],W.prototype,"mediaTrackMuted",null),z([X(TypeError,(r,t)=>Y.error(t,r))],W.prototype,"tabChanged",null),z([X(TypeError,(r,t)=>Y.error(t,r))],W.prototype,"browserBackgrounded",null),z([X(TypeError,(r,t)=>Y.error(t,r))],W.prototype,"browserForegrounded",null),z([X(TypeError,(r,t)=>Y.error(t,r))],W.prototype,"legacySwitch",null),z([X(TypeError,(r,t)=>Y.error(t,r))],W.prototype,"getPreCallTestResults",null),z([X(TypeError,(r,t)=>Y.error(t,r))],W.prototype,"sendCallJoinBeginEvent",null),z([X(TypeError,(r,t)=>Y.error(t,r))],W.prototype,"sendNetworkQualityTestBeginEvent",null),z([X(TypeError,(r,t)=>Y.error(t,r))],W.prototype,"sendWebSocketConnectedEvent",null),z([X(TypeError,(r,t)=>Y.error(t,r))],W.prototype,"sendTransportConnectedEvent",null),z([X(TypeError,(r,t)=>Y.error(t,r))],W.prototype,"sendAudioToggleEvent",null),z([X(TypeError,(r,t)=>Y.error(t,r))],W.prototype,"sendVideoToggleEvent",null),z([X(TypeError,(r,t)=>Y.error(t,r))],W.prototype,"sendParticipantRoleToggleEvent",null),z([X(TypeError,(r,t)=>Y.error(t,r))],W.prototype,"startPingStats",null),z([X(TypeError,(r,t)=>Y.error(t,r))],W.prototype,"stopPingStats",null),z([X(TypeError,(r,t)=>Y.error(t,r))],W.prototype,"sendPingStatsEvent",null),z([X(TypeError,(r,t)=>Y.error(t,r))],W.prototype,"sendIVSPlayerRebufferEvent",null),z([X(TypeError,(r,t)=>Y.error(t,r))],W.prototype,"sendIVSPlayerAudioBlockEvent",null),z([X(TypeError,(r,t)=>Y.error(t,r))],W.prototype,"sendIVSPlayerPlaybackBlockedEvent",null),z([X(TypeError,(r,t)=>Y.error(t,r))],W.prototype,"sendIVSPlayerNetworkUnavailableEvent",null),z([X(TypeError,(r,t)=>Y.error(t,r))],W.prototype,"sendIVSPlayerInitializedEvent",null),z([X(TypeError,(r,t)=>Y.error(t,r))],W.prototype,"sendIVSPlayerWorkerErrorEvent",null),z([X(TypeError,(r,t)=>Y.error(t,r))],W.prototype,"sendIVSPlayerErrorEvent",null),z([X(TypeError,(r,t)=>Y.error(t,r))],W.prototype,"sendIVSPlayerRecoverableErrorEvent",null),z([X(TypeError,(r,t)=>Y.error(t,r))],W.prototype,"sendIVSPlayerAnalyticsEvent",null),z([X(TypeError,(r,t)=>Y.error(t,r))],W.prototype,"sendIVSPlayerPlaybackRateChangedEvent",null),z([X(TypeError,(r,t)=>Y.error(t,r))],W.prototype,"sendIVSPlayerQualityChanged",null),z([X(TypeError,(r,t)=>Y.error(t,r))],W.prototype,"sendPlayerLiveLatency",null),z([X(TypeError,(r,t)=>Y.error(t,r))],W.prototype,"sendDisconnectEvent",null),z([X(TypeError,(r,t)=>Y.error(t,r))],W.prototype,"sendReconnectEvent",null),z([X(TypeError,(r,t)=>Y.error(t,r))],W.prototype,"expectedVideoResolution",null),z([X(TypeError,(r,t)=>Y.error(t,r))],W.prototype,"expectedScreenshareResolution",null),W=z([bT(TypeError,(r,t)=>Y.error(t,r))],W);const CT=W;class RT extends ne{constructor(){super(...arguments);m(this,"stats");m(this,"peerId");m(this,"backend");m(this,"iceServers");m(this,"initialized",!1);m(this,"stalled",!1);m(this,"ipInformation");m(this,"logger")}async initialize({peerId:e,engineName:s,env:n=na.PROD,iceServers:i,apiBase:a="https://api.cluster.dyte.in",flags:o,logger:c=console,apiHostnames:l,skipConnectivityChecks:p=!1}){var h,f,g;try{this.peerId=e,this.logger=c,this.ipInformation=await zd.getIPDetails({peerId:e,apiHostnames:l,logger:c}),this.backend=new CT(a,s,n,o,c,e,l),this.iceServers=i,(h=this.backend)==null||h.registerIceServers(this.iceServers),this.initialized=!0,(g=(f=this.backend)==null?void 0:f.eventHandler)==null||g.emit("initialized",this.ipInformation),this.emit("initialized",this.ipInformation),this.startPreCallTest(p)}catch(_){this.logger.error("callStats::CallStatsIntegration: ",{error:_}),this.stallCallStats()}}configureSendTransport(e){this.onSafeInitialization(()=>{var s;(s=this.backend)==null||s.registerProducingTransport(e)})}configureRecvTransport(e){this.onSafeInitialization(()=>{var s;(s=this.backend)==null||s.registerConsumingTransport(e)})}async candidateRegionalNetworkQualityTest(e){const s=new Date;this.onSafeInitialization(()=>{var n;try{(n=this.backend)==null||n.sendNetworkQualityTestBeginEvent(e,s)}catch(i){this.logger.error("callStats::sendNetworkQualityTestBeginEvent",{error:{reason:i.reason}})}})}async roomJoined(e){const s=new Date;this.onSafeInitialization(()=>{var n,i;(n=this.backend)==null||n.sendCallJoinBeginEvent(e,s),this.backend,(i=this.backend)==null||i.startPingStats()})}audioOff(){const e=new Date;this.onSafeInitialization(()=>{var s;(s=this.backend)==null||s.sendAudioToggleEvent(!1,e)})}audioOn(){const e=new Date;this.onSafeInitialization(()=>{var s;(s=this.backend)==null||s.sendAudioToggleEvent(!0,e)})}videoOff(){const e=new Date;this.onSafeInitialization(()=>{var s;(s=this.backend)==null||s.sendVideoToggleEvent(!1,e)})}videoOn(){const e=new Date;this.onSafeInitialization(()=>{var s;(s=this.backend)==null||s.sendVideoToggleEvent(!0,e)})}callEnded(){const e=new Date;this.onSafeInitialization(()=>{var s,n;(s=this.backend)==null||s.stopPingStats(),(n=this.backend)==null||n.sendDisconnectEvent(e)})}screenShareStart(e){const s=new Date;this.onSafeInitialization(()=>{var n;(n=this.backend)==null||n.sendScreenShareToggleEvent(!0,e,s)})}consumerSharedMediaState(e,s){this.onSafeInitialization(()=>{var n;(n=this.backend)==null||n.sendConsumerSharedMediaStateEvent(e,s)})}screenShareStop(e){const s=new Date;this.onSafeInitialization(()=>{var n;(n=this.backend)==null||n.sendScreenShareToggleEvent(!1,e,s)})}screenShareRequested(){const e=new Date;this.onSafeInitialization(()=>{var s;(s=this.backend)==null||s.sendScreenShareRequestedEvent(e)})}activeSpeaker(e){if(e!==this.peerId)return;const s=new Date;this.onSafeInitialization(()=>{var n;(n=this.backend)==null||n.sendActiveSpeakerEvent(e,s)})}devices(e,s){const n=new Date;this.onSafeInitialization(()=>{var i;(i=this.backend)==null||i.devices(e,s,n)})}selectedDevice(e,s){const n=new Date;this.onSafeInitialization(()=>{var i;(i=this.backend)==null||i.selectedDevice(e,s,n)})}mediaPermission(e,s){const n=new Date;this.onSafeInitialization(()=>{var i;(i=this.backend)==null||i.mediaPermission(e,s,n)})}mediaPlaybackFailed(e){const s=new Date;this.onSafeInitialization(()=>{var n;(n=this.backend)==null||n.mediaPlaybackFailed(e,s)})}mediaTrackMuted(e){const s=new Date;this.onSafeInitialization(()=>{var n;(n=this.backend)==null||n.mediaTrackMuted(e,s)})}tabChanged(e=!1){const s=new Date;this.onSafeInitialization(()=>{var n;(n=this.backend)==null||n.tabChanged(e,s)})}browserBackgrounded(){const e=new Date;this.onSafeInitialization(()=>{var s;(s=this.backend)==null||s.browserBackgrounded(e)})}browserForegrounded(){const e=new Date;this.onSafeInitialization(()=>{var s;(s=this.backend)==null||s.browserForegrounded(e)})}legacySwitch(e){const s=new Date;this.onSafeInitialization(()=>{var n;(n=this.backend)==null||n.legacySwitch(e,s)})}async startPreCallTest(e=!1){const s=new Date;this.onSafeInitialization(()=>{var n;(n=this.backend)==null||n.sendPreCallTestBeginEvent(e,s)})}onPreCallTestResults(e){return this.onSafeInitialization(()=>{var s;(s=this.backend)==null||s.eventHandler.once("precall_end",e)}),e}onReceivingConsumerAudioStatus(e){this.onSafeInitialization(()=>{var s;(s=this.backend)==null||s.eventHandler.on("consumer_audio_status",e)})}onReceivingConsumerVideoStatus(e){this.onSafeInitialization(()=>{var s;(s=this.backend)==null||s.eventHandler.on("consumer_video_status",e)})}onReceivingProducerAudioStatus(e){this.onSafeInitialization(()=>{var s;(s=this.backend)==null||s.eventHandler.on("producer_audio_status",e)})}onReceivingProducerVideoStatus(e){this.onSafeInitialization(()=>{var s;(s=this.backend)==null||s.eventHandler.on("producer_video_status",e)})}onReceivingProducingTransportStatus(e){this.onSafeInitialization(()=>{var s;(s=this.backend)==null||s.eventHandler.on("producing_transport_status",e)})}onReceivingConsumingTransportStatus(e){this.onSafeInitialization(()=>{var s;(s=this.backend)==null||s.eventHandler.on("consuming_transport_status",e)})}onProducerScore(e){this.onSafeInitialization(()=>{var s;(s=this.backend)==null||s.eventHandler.on("producer_score",e)})}onConsumerScore(e){this.onSafeInitialization(()=>{var s;(s=this.backend)==null||s.eventHandler.on("consumer_score",e)})}onSafeInitialization(e){if(this.initialized)e(this.ipInformation,!1);else if(!this.stalled){const s=n=>{e(n,!0)};return this.once("initialized",s),s}return()=>{}}removeInitializationListener(e){this.removeListener("initialized",e)}stallCallStats(){this.stalled=!0,this.removeAllListeners("initialized")}ivsPlayerEvent(e,s){const n=new Date;this.onSafeInitialization(()=>{var i,a,o,c,l,p,h,f,g,_,w;switch(e){case"PlayerRebuffering":(i=this.backend)==null||i.sendIVSPlayerRebufferEvent(n);break;case"PlayerAudioBlocked":(a=this.backend)==null||a.sendIVSPlayerAudioBlockEvent(n);break;case"PlayerPlaybackBlocked":(o=this.backend)==null||o.sendIVSPlayerPlaybackBlockedEvent(n);break;case"PlayerNetworkUnavailable":(c=this.backend)==null||c.sendIVSPlayerNetworkUnavailableEvent(n);break;case"PlayerInitialized":(l=this.backend)==null||l.sendIVSPlayerInitializedEvent(n);break;case"PlayerWorkerError":(p=this.backend)==null||p.sendIVSPlayerWorkerErrorEvent(n);break;case"PlayerError":(h=this.backend)==null||h.sendIVSPlayerErrorEvent(s,n);break;case"PlayerRecoverableError":(f=this.backend)==null||f.sendIVSPlayerRecoverableErrorEvent(s,n);break;case"PlayerAnalyticsEvent":(g=this.backend)==null||g.sendIVSPlayerAnalyticsEvent(s,n);break;case"PlayerPlaybackRateChanged":(_=this.backend)==null||_.sendIVSPlayerPlaybackRateChangedEvent(s,n);break;case"PlayerQualityChanged":(w=this.backend)==null||w.sendIVSPlayerQualityChanged(s,n);break}})}livestreamLatency(e){const s=new Date;this.onSafeInitialization(()=>{var n;(n=this.backend)==null||n.sendPlayerLiveLatency(e,s)})}expectedVideoResolution(e,s){const n=new Date;this.onSafeInitialization(()=>{var i;(i=this.backend)==null||i.expectedVideoResolution(e,s,n)})}expectedScreenshareResolution(e,s){const n=new Date;this.onSafeInitialization(()=>{var i;(i=this.backend)==null||i.expectedScreenshareResolution(e,s,n)})}}const q=new RT;q.setMaxListeners(30);function PT(r){const{length:t}=this,e=r>=0?r:t+r;return e<0||e>=t?void 0:this[e]}Array.prototype.at||Object.assign(Array.prototype,{at:PT});function kT(r){const{length:t}=this,e=r>=0?r:t+r;return e<0||e>=t?void 0:this[e]}String.prototype.at||Object.assign(String.prototype,{at:kT});var Xo,IT=new Uint8Array(16);function AT(){if(!Xo&&(Xo=typeof crypto!="undefined"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto!="undefined"&&typeof msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto),!Xo))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Xo(IT)}const MT=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function Yd(r){return typeof r=="string"&&MT.test(r)}for(var lt=[],Qd=0;Qd<256;++Qd)lt.push((Qd+256).toString(16).substr(1));function DT(r){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,e=(lt[r[t+0]]+lt[r[t+1]]+lt[r[t+2]]+lt[r[t+3]]+"-"+lt[r[t+4]]+lt[r[t+5]]+"-"+lt[r[t+6]]+lt[r[t+7]]+"-"+lt[r[t+8]]+lt[r[t+9]]+"-"+lt[r[t+10]]+lt[r[t+11]]+lt[r[t+12]]+lt[r[t+13]]+lt[r[t+14]]+lt[r[t+15]]).toLowerCase();if(!Yd(e))throw TypeError("Stringified UUID is invalid");return e}function Jn(r,t,e){r=r||{};var s=r.random||(r.rng||AT)();if(s[6]=s[6]&15|64,s[8]=s[8]&63|128,t){e=e||0;for(var n=0;n<16;++n)t[e+n]=s[n];return t}return DT(s)}var Xd={},OT={get exports(){return Xd},set exports(r){Xd=r}},Zo={},NT={get exports(){return Zo},set exports(r){Zo=r}},up=function(t,e){return function(){for(var n=new Array(arguments.length),i=0;i<n.length;i++)n[i]=arguments[i];return t.apply(e,n)}},LT=up,ps=Object.prototype.toString;function Zd(r){return Array.isArray(r)}function el(r){return typeof r=="undefined"}function xT(r){return r!==null&&!el(r)&&r.constructor!==null&&!el(r.constructor)&&typeof r.constructor.isBuffer=="function"&&r.constructor.isBuffer(r)}function hp(r){return ps.call(r)==="[object ArrayBuffer]"}function FT(r){return ps.call(r)==="[object FormData]"}function $T(r){var t;return typeof ArrayBuffer!="undefined"&&ArrayBuffer.isView?t=ArrayBuffer.isView(r):t=r&&r.buffer&&hp(r.buffer),t}function UT(r){return typeof r=="string"}function VT(r){return typeof r=="number"}function pp(r){return r!==null&&typeof r=="object"}function ec(r){if(ps.call(r)!=="[object Object]")return!1;var t=Object.getPrototypeOf(r);return t===null||t===Object.prototype}function BT(r){return ps.call(r)==="[object Date]"}function HT(r){return ps.call(r)==="[object File]"}function qT(r){return ps.call(r)==="[object Blob]"}function mp(r){return ps.call(r)==="[object Function]"}function jT(r){return pp(r)&&mp(r.pipe)}function GT(r){return ps.call(r)==="[object URLSearchParams]"}function WT(r){return r.trim?r.trim():r.replace(/^\s+|\s+$/g,"")}function JT(){return typeof navigator!="undefined"&&(navigator.product==="ReactNative"||navigator.product==="NativeScript"||navigator.product==="NS")?!1:typeof window!="undefined"&&typeof document!="undefined"}function tl(r,t){if(!(r===null||typeof r=="undefined"))if(typeof r!="object"&&(r=[r]),Zd(r))for(var e=0,s=r.length;e<s;e++)t.call(null,r[e],e,r);else for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&t.call(null,r[n],n,r)}function rl(){var r={};function t(n,i){ec(r[i])&&ec(n)?r[i]=rl(r[i],n):ec(n)?r[i]=rl({},n):Zd(n)?r[i]=n.slice():r[i]=n}for(var e=0,s=arguments.length;e<s;e++)tl(arguments[e],t);return r}function KT(r,t,e){return tl(t,function(n,i){e&&typeof n=="function"?r[i]=LT(n,e):r[i]=n}),r}function zT(r){return r.charCodeAt(0)===65279&&(r=r.slice(1)),r}var Ot={isArray:Zd,isArrayBuffer:hp,isBuffer:xT,isFormData:FT,isArrayBufferView:$T,isString:UT,isNumber:VT,isObject:pp,isPlainObject:ec,isUndefined:el,isDate:BT,isFile:HT,isBlob:qT,isFunction:mp,isStream:jT,isURLSearchParams:GT,isStandardBrowserEnv:JT,forEach:tl,merge:rl,extend:KT,trim:WT,stripBOM:zT},Kn=Ot;function fp(r){return encodeURIComponent(r).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}var gp=function(t,e,s){if(!e)return t;var n;if(s)n=s(e);else if(Kn.isURLSearchParams(e))n=e.toString();else{var i=[];Kn.forEach(e,function(c,l){c===null||typeof c=="undefined"||(Kn.isArray(c)?l=l+"[]":c=[c],Kn.forEach(c,function(h){Kn.isDate(h)?h=h.toISOString():Kn.isObject(h)&&(h=JSON.stringify(h)),i.push(fp(l)+"="+fp(h))}))}),n=i.join("&")}if(n){var a=t.indexOf("#");a!==-1&&(t=t.slice(0,a)),t+=(t.indexOf("?")===-1?"?":"&")+n}return t},YT=Ot;function tc(){this.handlers=[]}tc.prototype.use=function(t,e,s){return this.handlers.push({fulfilled:t,rejected:e,synchronous:s?s.synchronous:!1,runWhen:s?s.runWhen:null}),this.handlers.length-1},tc.prototype.eject=function(t){this.handlers[t]&&(this.handlers[t]=null)},tc.prototype.forEach=function(t){YT.forEach(this.handlers,function(s){s!==null&&t(s)})};var QT=tc,XT=Ot,ZT=function(t,e){XT.forEach(t,function(n,i){i!==e&&i.toUpperCase()===e.toUpperCase()&&(t[e]=n,delete t[i])})},vp=function(t,e,s,n,i){return t.config=e,s&&(t.code=s),t.request=n,t.response=i,t.isAxiosError=!0,t.toJSON=function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code,status:this.response&&this.response.status?this.response.status:null}},t},sl,yp;function Tp(){if(yp)return sl;yp=1;var r=vp;return sl=function(e,s,n,i,a){var o=new Error(e);return r(o,s,n,i,a)},sl}var nl,Sp;function eS(){if(Sp)return nl;Sp=1;var r=Tp();return nl=function(e,s,n){var i=n.config.validateStatus;!n.status||!i||i(n.status)?e(n):s(r("Request failed with status code "+n.status,n.config,null,n.request,n))},nl}var il,Ep;function tS(){if(Ep)return il;Ep=1;var r=Ot;return il=r.isStandardBrowserEnv()?function(){return{write:function(s,n,i,a,o,c){var l=[];l.push(s+"="+encodeURIComponent(n)),r.isNumber(i)&&l.push("expires="+new Date(i).toGMTString()),r.isString(a)&&l.push("path="+a),r.isString(o)&&l.push("domain="+o),c===!0&&l.push("secure"),document.cookie=l.join("; ")},read:function(s){var n=document.cookie.match(new RegExp("(^|;\\s*)("+s+")=([^;]*)"));return n?decodeURIComponent(n[3]):null},remove:function(s){this.write(s,"",Date.now()-864e5)}}}():function(){return{write:function(){},read:function(){return null},remove:function(){}}}(),il}var al,_p;function rS(){return _p||(_p=1,al=function(t){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(t)}),al}var ol,wp;function sS(){return wp||(wp=1,ol=function(t,e){return e?t.replace(/\/+$/,"")+"/"+e.replace(/^\/+/,""):t}),ol}var cl,bp;function nS(){if(bp)return cl;bp=1;var r=rS(),t=sS();return cl=function(s,n){return s&&!r(n)?t(s,n):n},cl}var dl,Cp;function iS(){if(Cp)return dl;Cp=1;var r=Ot,t=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"];return dl=function(s){var n={},i,a,o;return s&&r.forEach(s.split(`
`),function(l){if(o=l.indexOf(":"),i=r.trim(l.substr(0,o)).toLowerCase(),a=r.trim(l.substr(o+1)),i){if(n[i]&&t.indexOf(i)>=0)return;i==="set-cookie"?n[i]=(n[i]?n[i]:[]).concat([a]):n[i]=n[i]?n[i]+", "+a:a}}),n},dl}var ll,Rp;function aS(){if(Rp)return ll;Rp=1;var r=Ot;return ll=r.isStandardBrowserEnv()?function(){var e=/(msie|trident)/i.test(navigator.userAgent),s=document.createElement("a"),n;function i(a){var o=a;return e&&(s.setAttribute("href",o),o=s.href),s.setAttribute("href",o),{href:s.href,protocol:s.protocol?s.protocol.replace(/:$/,""):"",host:s.host,search:s.search?s.search.replace(/^\?/,""):"",hash:s.hash?s.hash.replace(/^#/,""):"",hostname:s.hostname,port:s.port,pathname:s.pathname.charAt(0)==="/"?s.pathname:"/"+s.pathname}}return n=i(window.location.href),function(o){var c=r.isString(o)?i(o):o;return c.protocol===n.protocol&&c.host===n.host}}():function(){return function(){return!0}}(),ll}var ul,Pp;function rc(){if(Pp)return ul;Pp=1;function r(t){this.message=t}return r.prototype.toString=function(){return"Cancel"+(this.message?": "+this.message:"")},r.prototype.__CANCEL__=!0,ul=r,ul}var hl,kp;function Ip(){if(kp)return hl;kp=1;var r=Ot,t=eS(),e=tS(),s=gp,n=nS(),i=iS(),a=aS(),o=Tp(),c=sc(),l=rc();return hl=function(h){return new Promise(function(g,_){var w=h.data,R=h.headers,D=h.responseType,x;function B(){h.cancelToken&&h.cancelToken.unsubscribe(x),h.signal&&h.signal.removeEventListener("abort",x)}r.isFormData(w)&&delete R["Content-Type"];var b=new XMLHttpRequest;if(h.auth){var Q=h.auth.username||"",te=h.auth.password?unescape(encodeURIComponent(h.auth.password)):"";R.Authorization="Basic "+btoa(Q+":"+te)}var ce=n(h.baseURL,h.url);b.open(h.method.toUpperCase(),s(ce,h.params,h.paramsSerializer),!0),b.timeout=h.timeout;function he(){if(b){var de="getAllResponseHeaders"in b?i(b.getAllResponseHeaders()):null,He=!D||D==="text"||D==="json"?b.responseText:b.response,A={data:He,status:b.status,statusText:b.statusText,headers:de,config:h,request:b};t(function(C){g(C),B()},function(C){_(C),B()},A),b=null}}if("onloadend"in b?b.onloadend=he:b.onreadystatechange=function(){!b||b.readyState!==4||b.status===0&&!(b.responseURL&&b.responseURL.indexOf("file:")===0)||setTimeout(he)},b.onabort=function(){b&&(_(o("Request aborted",h,"ECONNABORTED",b)),b=null)},b.onerror=function(){_(o("Network Error",h,null,b)),b=null},b.ontimeout=function(){var He=h.timeout?"timeout of "+h.timeout+"ms exceeded":"timeout exceeded",A=h.transitional||c.transitional;h.timeoutErrorMessage&&(He=h.timeoutErrorMessage),_(o(He,h,A.clarifyTimeoutError?"ETIMEDOUT":"ECONNABORTED",b)),b=null},r.isStandardBrowserEnv()){var Ne=(h.withCredentials||a(ce))&&h.xsrfCookieName?e.read(h.xsrfCookieName):void 0;Ne&&(R[h.xsrfHeaderName]=Ne)}"setRequestHeader"in b&&r.forEach(R,function(He,A){typeof w=="undefined"&&A.toLowerCase()==="content-type"?delete R[A]:b.setRequestHeader(A,He)}),r.isUndefined(h.withCredentials)||(b.withCredentials=!!h.withCredentials),D&&D!=="json"&&(b.responseType=h.responseType),typeof h.onDownloadProgress=="function"&&b.addEventListener("progress",h.onDownloadProgress),typeof h.onUploadProgress=="function"&&b.upload&&b.upload.addEventListener("progress",h.onUploadProgress),(h.cancelToken||h.signal)&&(x=function(de){b&&(_(!de||de&&de.type?new l("canceled"):de),b.abort(),b=null)},h.cancelToken&&h.cancelToken.subscribe(x),h.signal&&(h.signal.aborted?x():h.signal.addEventListener("abort",x))),w||(w=null),b.send(w)})},hl}var pl,Ap;function sc(){if(Ap)return pl;Ap=1;var r=Ot,t=ZT,e=vp,s={"Content-Type":"application/x-www-form-urlencoded"};function n(c,l){!r.isUndefined(c)&&r.isUndefined(c["Content-Type"])&&(c["Content-Type"]=l)}function i(){var c;return(typeof XMLHttpRequest!="undefined"||typeof process!="undefined"&&Object.prototype.toString.call(process)==="[object process]")&&(c=Ip()),c}function a(c,l,p){if(r.isString(c))try{return(l||JSON.parse)(c),r.trim(c)}catch(h){if(h.name!=="SyntaxError")throw h}return(p||JSON.stringify)(c)}var o={transitional:{silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},adapter:i(),transformRequest:[function(l,p){return t(p,"Accept"),t(p,"Content-Type"),r.isFormData(l)||r.isArrayBuffer(l)||r.isBuffer(l)||r.isStream(l)||r.isFile(l)||r.isBlob(l)?l:r.isArrayBufferView(l)?l.buffer:r.isURLSearchParams(l)?(n(p,"application/x-www-form-urlencoded;charset=utf-8"),l.toString()):r.isObject(l)||p&&p["Content-Type"]==="application/json"?(n(p,"application/json"),a(l)):l}],transformResponse:[function(l){var p=this.transitional||o.transitional,h=p&&p.silentJSONParsing,f=p&&p.forcedJSONParsing,g=!h&&this.responseType==="json";if(g||f&&r.isString(l)&&l.length)try{return JSON.parse(l)}catch(_){if(g)throw _.name==="SyntaxError"?e(_,this,"E_JSON_PARSE"):_}return l}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,validateStatus:function(l){return l>=200&&l<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};return r.forEach(["delete","get","head"],function(l){o.headers[l]={}}),r.forEach(["post","put","patch"],function(l){o.headers[l]=r.merge(s)}),pl=o,pl}var oS=Ot,cS=sc(),dS=function(t,e,s){var n=this||cS;return oS.forEach(s,function(a){t=a.call(n,t,e)}),t},ml,Mp;function Dp(){return Mp||(Mp=1,ml=function(t){return!!(t&&t.__CANCEL__)}),ml}var Op=Ot,fl=dS,lS=Dp(),uS=sc(),hS=rc();function gl(r){if(r.cancelToken&&r.cancelToken.throwIfRequested(),r.signal&&r.signal.aborted)throw new hS("canceled")}var pS=function(t){gl(t),t.headers=t.headers||{},t.data=fl.call(t,t.data,t.headers,t.transformRequest),t.headers=Op.merge(t.headers.common||{},t.headers[t.method]||{},t.headers),Op.forEach(["delete","get","head","post","put","patch","common"],function(n){delete t.headers[n]});var e=t.adapter||uS.adapter;return e(t).then(function(n){return gl(t),n.data=fl.call(t,n.data,n.headers,t.transformResponse),n},function(n){return lS(n)||(gl(t),n&&n.response&&(n.response.data=fl.call(t,n.response.data,n.response.headers,t.transformResponse))),Promise.reject(n)})},Bt=Ot,Np=function(t,e){e=e||{};var s={};function n(p,h){return Bt.isPlainObject(p)&&Bt.isPlainObject(h)?Bt.merge(p,h):Bt.isPlainObject(h)?Bt.merge({},h):Bt.isArray(h)?h.slice():h}function i(p){if(Bt.isUndefined(e[p])){if(!Bt.isUndefined(t[p]))return n(void 0,t[p])}else return n(t[p],e[p])}function a(p){if(!Bt.isUndefined(e[p]))return n(void 0,e[p])}function o(p){if(Bt.isUndefined(e[p])){if(!Bt.isUndefined(t[p]))return n(void 0,t[p])}else return n(void 0,e[p])}function c(p){if(p in e)return n(t[p],e[p]);if(p in t)return n(void 0,t[p])}var l={url:a,method:a,data:a,baseURL:o,transformRequest:o,transformResponse:o,paramsSerializer:o,timeout:o,timeoutMessage:o,withCredentials:o,adapter:o,responseType:o,xsrfCookieName:o,xsrfHeaderName:o,onUploadProgress:o,onDownloadProgress:o,decompress:o,maxContentLength:o,maxBodyLength:o,transport:o,httpAgent:o,httpsAgent:o,cancelToken:o,socketPath:o,responseEncoding:o,validateStatus:c};return Bt.forEach(Object.keys(t).concat(Object.keys(e)),function(h){var f=l[h]||i,g=f(h);Bt.isUndefined(g)&&f!==c||(s[h]=g)}),s},vl,Lp;function xp(){return Lp||(Lp=1,vl={version:"0.25.0"}),vl}var mS=xp().version,yl={};["object","boolean","number","function","string","symbol"].forEach(function(r,t){yl[r]=function(s){return typeof s===r||"a"+(t<1?"n ":" ")+r}});var Fp={};yl.transitional=function(t,e,s){function n(i,a){return"[Axios v"+mS+"] Transitional option '"+i+"'"+a+(s?". "+s:"")}return function(i,a,o){if(t===!1)throw new Error(n(a," has been removed"+(e?" in "+e:"")));return e&&!Fp[a]&&(Fp[a]=!0,console.warn(n(a," has been deprecated since v"+e+" and will be removed in the near future"))),t?t(i,a,o):!0}};function fS(r,t,e){if(typeof r!="object")throw new TypeError("options must be an object");for(var s=Object.keys(r),n=s.length;n-- >0;){var i=s[n],a=t[i];if(a){var o=r[i],c=o===void 0||a(o,i,r);if(c!==!0)throw new TypeError("option "+i+" must be "+c);continue}if(e!==!0)throw Error("Unknown option "+i)}}var gS={assertOptions:fS,validators:yl},$p=Ot,vS=gp,Up=QT,Vp=pS,nc=Np,Bp=gS,zn=Bp.validators;function ia(r){this.defaults=r,this.interceptors={request:new Up,response:new Up}}ia.prototype.request=function(t,e){if(typeof t=="string"?(e=e||{},e.url=t):e=t||{},!e.url)throw new Error("Provided config url is not valid");e=nc(this.defaults,e),e.method?e.method=e.method.toLowerCase():this.defaults.method?e.method=this.defaults.method.toLowerCase():e.method="get";var s=e.transitional;s!==void 0&&Bp.assertOptions(s,{silentJSONParsing:zn.transitional(zn.boolean),forcedJSONParsing:zn.transitional(zn.boolean),clarifyTimeoutError:zn.transitional(zn.boolean)},!1);var n=[],i=!0;this.interceptors.request.forEach(function(g){typeof g.runWhen=="function"&&g.runWhen(e)===!1||(i=i&&g.synchronous,n.unshift(g.fulfilled,g.rejected))});var a=[];this.interceptors.response.forEach(function(g){a.push(g.fulfilled,g.rejected)});var o;if(!i){var c=[Vp,void 0];for(Array.prototype.unshift.apply(c,n),c=c.concat(a),o=Promise.resolve(e);c.length;)o=o.then(c.shift(),c.shift());return o}for(var l=e;n.length;){var p=n.shift(),h=n.shift();try{l=p(l)}catch(f){h(f);break}}try{o=Vp(l)}catch(f){return Promise.reject(f)}for(;a.length;)o=o.then(a.shift(),a.shift());return o},ia.prototype.getUri=function(t){if(!t.url)throw new Error("Provided config url is not valid");return t=nc(this.defaults,t),vS(t.url,t.params,t.paramsSerializer).replace(/^\?/,"")},$p.forEach(["delete","get","head","options"],function(t){ia.prototype[t]=function(e,s){return this.request(nc(s||{},{method:t,url:e,data:(s||{}).data}))}}),$p.forEach(["post","put","patch"],function(t){ia.prototype[t]=function(e,s,n){return this.request(nc(n||{},{method:t,url:e,data:s}))}});var yS=ia,Tl,Hp;function TS(){if(Hp)return Tl;Hp=1;var r=rc();function t(e){if(typeof e!="function")throw new TypeError("executor must be a function.");var s;this.promise=new Promise(function(a){s=a});var n=this;this.promise.then(function(i){if(n._listeners){var a,o=n._listeners.length;for(a=0;a<o;a++)n._listeners[a](i);n._listeners=null}}),this.promise.then=function(i){var a,o=new Promise(function(c){n.subscribe(c),a=c}).then(i);return o.cancel=function(){n.unsubscribe(a)},o},e(function(a){n.reason||(n.reason=new r(a),s(n.reason))})}return t.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},t.prototype.subscribe=function(s){if(this.reason){s(this.reason);return}this._listeners?this._listeners.push(s):this._listeners=[s]},t.prototype.unsubscribe=function(s){if(this._listeners){var n=this._listeners.indexOf(s);n!==-1&&this._listeners.splice(n,1)}},t.source=function(){var s,n=new t(function(a){s=a});return{token:n,cancel:s}},Tl=t,Tl}var Sl,qp;function SS(){return qp||(qp=1,Sl=function(t){return function(s){return t.apply(null,s)}}),Sl}var El,jp;function ES(){if(jp)return El;jp=1;var r=Ot;return El=function(e){return r.isObject(e)&&e.isAxiosError===!0},El}var Gp=Ot,_S=up,ic=yS,wS=Np,bS=sc();function Wp(r){var t=new ic(r),e=_S(ic.prototype.request,t);return Gp.extend(e,ic.prototype,t),Gp.extend(e,t),e.create=function(n){return Wp(wS(r,n))},e}var wr=Wp(bS);wr.Axios=ic,wr.Cancel=rc(),wr.CancelToken=TS(),wr.isCancel=Dp(),wr.VERSION=xp().version,wr.all=function(t){return Promise.all(t)},wr.spread=SS(),wr.isAxiosError=ES(),NT.exports=wr,Zo.default=wr,function(r){r.exports=Zo}(OT);const CS=be(Xd);function RS(){this.__data__=[],this.size=0}function aa(r,t){return r===t||r!==r&&t!==t}function ac(r,t){for(var e=r.length;e--;)if(aa(r[e][0],t))return e;return-1}var PS=Array.prototype,kS=PS.splice;function IS(r){var t=this.__data__,e=ac(t,r);if(e<0)return!1;var s=t.length-1;return e==s?t.pop():kS.call(t,e,1),--this.size,!0}function AS(r){var t=this.__data__,e=ac(t,r);return e<0?void 0:t[e][1]}function MS(r){return ac(this.__data__,r)>-1}function DS(r,t){var e=this.__data__,s=ac(e,r);return s<0?(++this.size,e.push([r,t])):e[s][1]=t,this}function Br(r){var t=-1,e=r==null?0:r.length;for(this.clear();++t<e;){var s=r[t];this.set(s[0],s[1])}}Br.prototype.clear=RS,Br.prototype.delete=IS,Br.prototype.get=AS,Br.prototype.has=MS,Br.prototype.set=DS;function OS(){this.__data__=new Br,this.size=0}function NS(r){var t=this.__data__,e=t.delete(r);return this.size=t.size,e}function LS(r){return this.__data__.get(r)}function xS(r){return this.__data__.has(r)}var FS=typeof global=="object"&&global&&global.Object===Object&&global;const Jp=FS;var $S=typeof self=="object"&&self&&self.Object===Object&&self,US=Jp||$S||Function("return this")();const dr=US;var VS=dr.Symbol;const ms=VS;var Kp=Object.prototype,BS=Kp.hasOwnProperty,HS=Kp.toString,oa=ms?ms.toStringTag:void 0;function qS(r){var t=BS.call(r,oa),e=r[oa];try{r[oa]=void 0;var s=!0}catch(i){}var n=HS.call(r);return s&&(t?r[oa]=e:delete r[oa]),n}var jS=Object.prototype,GS=jS.toString;function WS(r){return GS.call(r)}var JS="[object Null]",KS="[object Undefined]",zp=ms?ms.toStringTag:void 0;function Ys(r){return r==null?r===void 0?KS:JS:zp&&zp in Object(r)?qS(r):WS(r)}function lr(r){var t=typeof r;return r!=null&&(t=="object"||t=="function")}var zS="[object AsyncFunction]",YS="[object Function]",QS="[object GeneratorFunction]",XS="[object Proxy]";function _l(r){if(!lr(r))return!1;var t=Ys(r);return t==YS||t==QS||t==zS||t==XS}var ZS=dr["__core-js_shared__"];const wl=ZS;var Yp=function(){var r=/[^.]+$/.exec(wl&&wl.keys&&wl.keys.IE_PROTO||"");return r?"Symbol(src)_1."+r:""}();function eE(r){return!!Yp&&Yp in r}var tE=Function.prototype,rE=tE.toString;function Qs(r){if(r!=null){try{return rE.call(r)}catch(t){}try{return r+""}catch(t){}}return""}var sE=/[\\^$.*+?()[\]{}|]/g,nE=/^\[object .+?Constructor\]$/,iE=Function.prototype,aE=Object.prototype,oE=iE.toString,cE=aE.hasOwnProperty,dE=RegExp("^"+oE.call(cE).replace(sE,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function lE(r){if(!lr(r)||eE(r))return!1;var t=_l(r)?dE:nE;return t.test(Qs(r))}function uE(r,t){return r==null?void 0:r[t]}function Xs(r,t){var e=uE(r,t);return lE(e)?e:void 0}var hE=Xs(dr,"Map");const ca=hE;var pE=Xs(Object,"create");const da=pE;function mE(){this.__data__=da?da(null):{},this.size=0}function fE(r){var t=this.has(r)&&delete this.__data__[r];return this.size-=t?1:0,t}var gE="__lodash_hash_undefined__",vE=Object.prototype,yE=vE.hasOwnProperty;function TE(r){var t=this.__data__;if(da){var e=t[r];return e===gE?void 0:e}return yE.call(t,r)?t[r]:void 0}var SE=Object.prototype,EE=SE.hasOwnProperty;function _E(r){var t=this.__data__;return da?t[r]!==void 0:EE.call(t,r)}var wE="__lodash_hash_undefined__";function bE(r,t){var e=this.__data__;return this.size+=this.has(r)?0:1,e[r]=da&&t===void 0?wE:t,this}function Zs(r){var t=-1,e=r==null?0:r.length;for(this.clear();++t<e;){var s=r[t];this.set(s[0],s[1])}}Zs.prototype.clear=mE,Zs.prototype.delete=fE,Zs.prototype.get=TE,Zs.prototype.has=_E,Zs.prototype.set=bE;function CE(){this.size=0,this.__data__={hash:new Zs,map:new(ca||Br),string:new Zs}}function RE(r){var t=typeof r;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?r!=="__proto__":r===null}function oc(r,t){var e=r.__data__;return RE(t)?e[typeof t=="string"?"string":"hash"]:e.map}function PE(r){var t=oc(this,r).delete(r);return this.size-=t?1:0,t}function kE(r){return oc(this,r).get(r)}function IE(r){return oc(this,r).has(r)}function AE(r,t){var e=oc(this,r),s=e.size;return e.set(r,t),this.size+=e.size==s?0:1,this}function en(r){var t=-1,e=r==null?0:r.length;for(this.clear();++t<e;){var s=r[t];this.set(s[0],s[1])}}en.prototype.clear=CE,en.prototype.delete=PE,en.prototype.get=kE,en.prototype.has=IE,en.prototype.set=AE;var ME=200;function DE(r,t){var e=this.__data__;if(e instanceof Br){var s=e.__data__;if(!ca||s.length<ME-1)return s.push([r,t]),this.size=++e.size,this;e=this.__data__=new en(s)}return e.set(r,t),this.size=e.size,this}function br(r){var t=this.__data__=new Br(r);this.size=t.size}br.prototype.clear=OS,br.prototype.delete=NS,br.prototype.get=LS,br.prototype.has=xS,br.prototype.set=DE;function OE(r,t){for(var e=-1,s=r==null?0:r.length;++e<s&&t(r[e],e,r)!==!1;);return r}var NE=function(){try{var r=Xs(Object,"defineProperty");return r({},"",{}),r}catch(t){}}();const cc=NE;function bl(r,t,e){t=="__proto__"&&cc?cc(r,t,{configurable:!0,enumerable:!0,value:e,writable:!0}):r[t]=e}var LE=Object.prototype,xE=LE.hasOwnProperty;function Qp(r,t,e){var s=r[t];(!(xE.call(r,t)&&aa(s,e))||e===void 0&&!(t in r))&&bl(r,t,e)}function la(r,t,e,s){var n=!e;e||(e={});for(var i=-1,a=t.length;++i<a;){var o=t[i],c=s?s(e[o],r[o],o,e,r):void 0;c===void 0&&(c=r[o]),n?bl(e,o,c):Qp(e,o,c)}return e}function FE(r,t){for(var e=-1,s=Array(r);++e<r;)s[e]=t(e);return s}function Cr(r){return r!=null&&typeof r=="object"}var $E="[object Arguments]";function Xp(r){return Cr(r)&&Ys(r)==$E}var Zp=Object.prototype,UE=Zp.hasOwnProperty,VE=Zp.propertyIsEnumerable,BE=Xp(function(){return arguments}())?Xp:function(r){return Cr(r)&&UE.call(r,"callee")&&!VE.call(r,"callee")};const dc=BE;var HE=Array.isArray;const fs=HE;function qE(){return!1}var em=typeof exports=="object"&&exports&&!exports.nodeType&&exports,tm=em&&typeof module=="object"&&module&&!module.nodeType&&module,jE=tm&&tm.exports===em,rm=jE?dr.Buffer:void 0,GE=rm?rm.isBuffer:void 0,WE=GE||qE;const Yn=WE;var JE=9007199254740991,KE=/^(?:0|[1-9]\d*)$/;function sm(r,t){var e=typeof r;return t=t==null?JE:t,!!t&&(e=="number"||e!="symbol"&&KE.test(r))&&r>-1&&r%1==0&&r<t}var zE=9007199254740991;function nm(r){return typeof r=="number"&&r>-1&&r%1==0&&r<=zE}var YE="[object Arguments]",QE="[object Array]",XE="[object Boolean]",ZE="[object Date]",e_="[object Error]",t_="[object Function]",r_="[object Map]",s_="[object Number]",n_="[object Object]",i_="[object RegExp]",a_="[object Set]",o_="[object String]",c_="[object WeakMap]",d_="[object ArrayBuffer]",l_="[object DataView]",u_="[object Float32Array]",h_="[object Float64Array]",p_="[object Int8Array]",m_="[object Int16Array]",f_="[object Int32Array]",g_="[object Uint8Array]",v_="[object Uint8ClampedArray]",y_="[object Uint16Array]",T_="[object Uint32Array]",Ce={};Ce[u_]=Ce[h_]=Ce[p_]=Ce[m_]=Ce[f_]=Ce[g_]=Ce[v_]=Ce[y_]=Ce[T_]=!0,Ce[YE]=Ce[QE]=Ce[d_]=Ce[XE]=Ce[l_]=Ce[ZE]=Ce[e_]=Ce[t_]=Ce[r_]=Ce[s_]=Ce[n_]=Ce[i_]=Ce[a_]=Ce[o_]=Ce[c_]=!1;function S_(r){return Cr(r)&&nm(r.length)&&!!Ce[Ys(r)]}function Cl(r){return function(t){return r(t)}}var im=typeof exports=="object"&&exports&&!exports.nodeType&&exports,ua=im&&typeof module=="object"&&module&&!module.nodeType&&module,E_=ua&&ua.exports===im,Rl=E_&&Jp.process,__=function(){try{var r=ua&&ua.require&&ua.require("util").types;return r||Rl&&Rl.binding&&Rl.binding("util")}catch(t){}}();const Qn=__;var am=Qn&&Qn.isTypedArray,w_=am?Cl(am):S_;const lc=w_;var b_=Object.prototype,C_=b_.hasOwnProperty;function om(r,t){var e=fs(r),s=!e&&dc(r),n=!e&&!s&&Yn(r),i=!e&&!s&&!n&&lc(r),a=e||s||n||i,o=a?FE(r.length,String):[],c=o.length;for(var l in r)(t||C_.call(r,l))&&!(a&&(l=="length"||n&&(l=="offset"||l=="parent")||i&&(l=="buffer"||l=="byteLength"||l=="byteOffset")||sm(l,c)))&&o.push(l);return o}var R_=Object.prototype;function uc(r){var t=r&&r.constructor,e=typeof t=="function"&&t.prototype||R_;return r===e}function cm(r,t){return function(e){return r(t(e))}}var P_=cm(Object.keys,Object);const k_=P_;var I_=Object.prototype,A_=I_.hasOwnProperty;function dm(r){if(!uc(r))return k_(r);var t=[];for(var e in Object(r))A_.call(r,e)&&e!="constructor"&&t.push(e);return t}function ha(r){return r!=null&&nm(r.length)&&!_l(r)}function Pl(r){return ha(r)?om(r):dm(r)}function M_(r,t){return r&&la(t,Pl(t),r)}function D_(r){var t=[];if(r!=null)for(var e in Object(r))t.push(e);return t}var O_=Object.prototype,N_=O_.hasOwnProperty;function L_(r){if(!lr(r))return D_(r);var t=uc(r),e=[];for(var s in r)s=="constructor"&&(t||!N_.call(r,s))||e.push(s);return e}function pa(r){return ha(r)?om(r,!0):L_(r)}function x_(r,t){return r&&la(t,pa(t),r)}var lm=typeof exports=="object"&&exports&&!exports.nodeType&&exports,um=lm&&typeof module=="object"&&module&&!module.nodeType&&module,F_=um&&um.exports===lm,hm=F_?dr.Buffer:void 0,pm=hm?hm.allocUnsafe:void 0;function mm(r,t){if(t)return r.slice();var e=r.length,s=pm?pm(e):new r.constructor(e);return r.copy(s),s}function fm(r,t){var e=-1,s=r.length;for(t||(t=Array(s));++e<s;)t[e]=r[e];return t}function $_(r,t){for(var e=-1,s=r==null?0:r.length,n=0,i=[];++e<s;){var a=r[e];t(a,e,r)&&(i[n++]=a)}return i}function gm(){return[]}var U_=Object.prototype,V_=U_.propertyIsEnumerable,vm=Object.getOwnPropertySymbols,B_=vm?function(r){return r==null?[]:(r=Object(r),$_(vm(r),function(t){return V_.call(r,t)}))}:gm;const kl=B_;function H_(r,t){return la(r,kl(r),t)}function ym(r,t){for(var e=-1,s=t.length,n=r.length;++e<s;)r[n+e]=t[e];return r}var q_=cm(Object.getPrototypeOf,Object);const Il=q_;var j_=Object.getOwnPropertySymbols,G_=j_?function(r){for(var t=[];r;)ym(t,kl(r)),r=Il(r);return t}:gm;const Tm=G_;function W_(r,t){return la(r,Tm(r),t)}function Sm(r,t,e){var s=t(r);return fs(r)?s:ym(s,e(r))}function Al(r){return Sm(r,Pl,kl)}function J_(r){return Sm(r,pa,Tm)}var K_=Xs(dr,"DataView");const Ml=K_;var z_=Xs(dr,"Promise");const Dl=z_;var Y_=Xs(dr,"Set");const Ol=Y_;var Q_=Xs(dr,"WeakMap");const Nl=Q_;var Em="[object Map]",X_="[object Object]",_m="[object Promise]",wm="[object Set]",bm="[object WeakMap]",Cm="[object DataView]",Z_=Qs(Ml),ew=Qs(ca),tw=Qs(Dl),rw=Qs(Ol),sw=Qs(Nl),tn=Ys;(Ml&&tn(new Ml(new ArrayBuffer(1)))!=Cm||ca&&tn(new ca)!=Em||Dl&&tn(Dl.resolve())!=_m||Ol&&tn(new Ol)!=wm||Nl&&tn(new Nl)!=bm)&&(tn=function(r){var t=Ys(r),e=t==X_?r.constructor:void 0,s=e?Qs(e):"";if(s)switch(s){case Z_:return Cm;case ew:return Em;case tw:return _m;case rw:return wm;case sw:return bm}return t});const Xn=tn;var nw=Object.prototype,iw=nw.hasOwnProperty;function aw(r){var t=r.length,e=new r.constructor(t);return t&&typeof r[0]=="string"&&iw.call(r,"index")&&(e.index=r.index,e.input=r.input),e}var ow=dr.Uint8Array;const hc=ow;function Ll(r){var t=new r.constructor(r.byteLength);return new hc(t).set(new hc(r)),t}function cw(r,t){var e=t?Ll(r.buffer):r.buffer;return new r.constructor(e,r.byteOffset,r.byteLength)}var dw=/\w*$/;function lw(r){var t=new r.constructor(r.source,dw.exec(r));return t.lastIndex=r.lastIndex,t}var Rm=ms?ms.prototype:void 0,Pm=Rm?Rm.valueOf:void 0;function uw(r){return Pm?Object(Pm.call(r)):{}}function km(r,t){var e=t?Ll(r.buffer):r.buffer;return new r.constructor(e,r.byteOffset,r.length)}var hw="[object Boolean]",pw="[object Date]",mw="[object Map]",fw="[object Number]",gw="[object RegExp]",vw="[object Set]",yw="[object String]",Tw="[object Symbol]",Sw="[object ArrayBuffer]",Ew="[object DataView]",_w="[object Float32Array]",ww="[object Float64Array]",bw="[object Int8Array]",Cw="[object Int16Array]",Rw="[object Int32Array]",Pw="[object Uint8Array]",kw="[object Uint8ClampedArray]",Iw="[object Uint16Array]",Aw="[object Uint32Array]";function Mw(r,t,e){var s=r.constructor;switch(t){case Sw:return Ll(r);case hw:case pw:return new s(+r);case Ew:return cw(r,e);case _w:case ww:case bw:case Cw:case Rw:case Pw:case kw:case Iw:case Aw:return km(r,e);case mw:return new s;case fw:case yw:return new s(r);case gw:return lw(r);case vw:return new s;case Tw:return uw(r)}}var Im=Object.create,Dw=function(){function r(){}return function(t){if(!lr(t))return{};if(Im)return Im(t);r.prototype=t;var e=new r;return r.prototype=void 0,e}}();const Ow=Dw;function Am(r){return typeof r.constructor=="function"&&!uc(r)?Ow(Il(r)):{}}var Nw="[object Map]";function Lw(r){return Cr(r)&&Xn(r)==Nw}var Mm=Qn&&Qn.isMap,xw=Mm?Cl(Mm):Lw;const Fw=xw;var $w="[object Set]";function Uw(r){return Cr(r)&&Xn(r)==$w}var Dm=Qn&&Qn.isSet,Vw=Dm?Cl(Dm):Uw;const Bw=Vw;var Hw=1,qw=2,jw=4,Om="[object Arguments]",Gw="[object Array]",Ww="[object Boolean]",Jw="[object Date]",Kw="[object Error]",Nm="[object Function]",zw="[object GeneratorFunction]",Yw="[object Map]",Qw="[object Number]",Lm="[object Object]",Xw="[object RegExp]",Zw="[object Set]",eb="[object String]",tb="[object Symbol]",rb="[object WeakMap]",sb="[object ArrayBuffer]",nb="[object DataView]",ib="[object Float32Array]",ab="[object Float64Array]",ob="[object Int8Array]",cb="[object Int16Array]",db="[object Int32Array]",lb="[object Uint8Array]",ub="[object Uint8ClampedArray]",hb="[object Uint16Array]",pb="[object Uint32Array]",_e={};_e[Om]=_e[Gw]=_e[sb]=_e[nb]=_e[Ww]=_e[Jw]=_e[ib]=_e[ab]=_e[ob]=_e[cb]=_e[db]=_e[Yw]=_e[Qw]=_e[Lm]=_e[Xw]=_e[Zw]=_e[eb]=_e[tb]=_e[lb]=_e[ub]=_e[hb]=_e[pb]=!0,_e[Kw]=_e[Nm]=_e[rb]=!1;function pc(r,t,e,s,n,i){var a,o=t&Hw,c=t&qw,l=t&jw;if(e&&(a=n?e(r,s,n,i):e(r)),a!==void 0)return a;if(!lr(r))return r;var p=fs(r);if(p){if(a=aw(r),!o)return fm(r,a)}else{var h=Xn(r),f=h==Nm||h==zw;if(Yn(r))return mm(r,o);if(h==Lm||h==Om||f&&!n){if(a=c||f?{}:Am(r),!o)return c?W_(r,x_(a,r)):H_(r,M_(a,r))}else{if(!_e[h])return n?r:{};a=Mw(r,h,o)}}i||(i=new br);var g=i.get(r);if(g)return g;i.set(r,a),Bw(r)?r.forEach(function(R){a.add(pc(R,t,e,R,r,i))}):Fw(r)&&r.forEach(function(R,D){a.set(D,pc(R,t,e,D,r,i))});var _=l?c?J_:Al:c?pa:Pl,w=p?void 0:_(r);return OE(w||r,function(R,D){w&&(D=R,R=r[D]),Qp(a,D,pc(R,t,e,D,r,i))}),a}var mb=1,fb=4;function xl(r){return pc(r,mb|fb)}var gb="[object Symbol]";function vb(r){return typeof r=="symbol"||Cr(r)&&Ys(r)==gb}var yb=Object.defineProperty,Tb=(r,t)=>{for(var e in t)yb(r,e,{get:t[e],enumerable:!0})},Sb={};Tb(Sb,{permissions:()=>Eb,theme:()=>_b});var Ct=(r=>(r.GroupCall="GROUP_CALL",r.Webinar="WEBINAR",r.AudioRoom="AUDIO_ROOM",r.Livestream="LIVESTREAM",r.Chat="CHAT",r))(Ct||{}),j=(r=>(r.Allowed="ALLOWED",r.NotAllowed="NOT_ALLOWED",r.CanRequest="CAN_REQUEST",r))(j||{}),Eb={view_type:"GROUP_CALL",accept_waiting_requests:!1,accept_present_requests:!1,request_produce:!1,can_allow_participant_audio:!1,can_allow_participant_screensharing:!1,can_allow_participant_video:!1,can_spotlight:!1,request_kick_participant:!1,kick_participant:!1,pin_participant:!1,can_edit_display_name:!1,can_record:!1,can_livestream:!1,can_present:!0,waiting_room_type:"SKIP_ON_ACCEPT",recorder_type:"NONE",plugins:{can_close:!0,can_start:!0},polls:{can_create:!0,can_vote:!0,can_view:!0},produce:{video:{allow:!0,quality:"vga",frame_rate:24},audio:!0,screenshare:{allow:!0,quality:"hd",frame_rate:5}},chat:{public:{can_send:!0,text:!0,files:!0},private:{can_send:!1,can_receive:!1,text:!1,files:!1}},connected_meetings:{can_alter_connected_meetings:!1,can_switch_connected_meetings:!1,can_switch_to_parent_meeting:!1},reactions:!1,hidden_participant:!1,is_recorder:!1,show_participant_list:!0,can_change_participant_role:!1,can_change_theme:!1,max_screenshare_count:1},_b={setup_screen:{is_enabled:!0},alone_here:{is_enabled:!0},waiting_room:{is_enabled:!1,enable_preview:!0},control_bar:{is_enabled:!0,elements:{plugins:!0,screenshare:!0,invite:!0,participants:!0,chat:!0,reactions:!1,polls:!0,fullscreen:!0,layout:!0}},header:{is_enabled:!0,elements:{timer:!0,title:!0,participant_count:!0,change_layout:!0}},pip_mode:!0,auto_tune:!0,grid:{multi:{maxVideoCount:6,videoFit:"cover"},single:{maxVideoCount:6,videoFit:"cover"},defaultView:"multi"},controls:{pip_toggle:!1}},xm="hXgU8Wc8pwuGNq9ms5q9Hh";typeof process!="undefined"&&(Py=process==null?void 0:process.env)!=null&&Py.FLAGSMITH_ENVIRONMENT_KEY&&(xm=process.env.FLAGSMITH_ENVIRONMENT_KEY);function wb(r=[]){const t={};return r.forEach(e=>{t[e.feature.name]={enabled:e.enabled,value:e.feature_state_value}}),t}var bb=class{constructor(r=xm){m(this,"flags",{});m(this,"environmentKey",null);this.environmentKey=r}async identifyAndFetchFlagsWithRetry({primaryEndpoint:r,secondaryEndpoint:t,forceEvaluate:e,timeout:s,uniqueIdentifier:n,traitsObj:i,logger:a}){const o=JSON.parse(JSON.stringify(i)),c=Object.entries(o).map(p=>({trait_key:p[0],trait_value:p[1]})),l=[r,t,t];for(const p of l)try{const h="_"+(Math.random()+1).toString(36).substring(2),f=await CS.post(`https://${p}/api/v1/identities/`,{identifier:n+(e?h:""),traits:c},{headers:{"Content-Type":"application/json","X-Environment-Key":this.environmentKey},timeout:s});return wb(f.data.flags||[])}catch(h){a.error("Flagsmith identify failed!!",{error:h,url:p})}return{}}async identify(r,t={},e=!1,s=5e3,n="edge.api.flagsmith.com",i=console){return this.flags=await this.identifyAndFetchFlagsWithRetry({traitsObj:t,uniqueIdentifier:r,forceEvaluate:e,timeout:s,primaryEndpoint:n,secondaryEndpoint:"edge.api.flagsmith.com",logger:i}),this.flags}getValue(r){return this.flags&&this.flags[r]&&this.flags[r].value}hasFeature(r){return this.flags&&this.flags[r]&&this.flags[r].enabled}getAllFlags(){return this.flags}},J=new bb,Fm=[-2,-1,0,1,2],Cb=[0,1,2,3,4];function Rb(r){r=r.trim();let t="0",e="0",s="0";return r.length==4?(t="0x"+r[1]+r[1],e="0x"+r[2]+r[2],s="0x"+r[3]+r[3]):r.length>6&&(t="0x"+r[1]+r[2],e="0x"+r[3]+r[4],s="0x"+r[5]+r[6]),[+t,+e,+s]}var Pb=(r,t,e)=>{let s,n,i;if(t==0)s=n=i=e;else{const a=(l,p,h)=>(h<0&&(h+=1),h>1&&(h-=1),h<.16666666666666666?l+(p-l)*6*h:h<.5?p:h<.6666666666666666?l+(p-l)*(.6666666666666666-h)*6:l),o=e<.5?e*(1+t):e+t-e*t,c=2*e-o;s=a(c,o,r+1/3),n=a(c,o,r),i=a(c,o,r-1/3)}return[Math.round(s*255),Math.round(n*255),Math.round(i*255)]},kb=(r,t,e)=>{r/=255,t/=255,e/=255;const s=Math.max(r,t,e),n=Math.min(r,t,e);let i,a;const o=(s+n)/2;if(s==n)i=a=0;else{const c=s-n;switch(a=o>.5?c/(2-s-n):c/(s+n),s){case r:i=(t-e)/c+(t<e?6:0);break;case t:i=(e-r)/c+2;break;case e:i=(r-t)/c+4;break}i/=6}return[i,a,o]},Ib=(r,t,e)=>{const s=n=>n.toString(16).padStart(2,"0");return`#${s(r)}${s(t)}${s(e)}`},$m=(r,t=Fm,e=.4)=>{const s=[],[n,i,a]=Rb(r),[o,c,l]=kb(n,i,a),p=Math.round(l*100);p>70?e=.8:p>60?e=.9:p<10?e=.075:p<42&&(e=.3);const h=t.findIndex(R=>R===0);if(h===-1)throw new Error("Invalid reducer provided, it must contain atleast one zero");const f=5-h,g=h+1,_=(100-p)/f,w=p/g;for(const R of t){let D;R<0?D=p+R*w*e:R>0?D=p+R*_*e:D=p;const[x,B,b]=Pb(o,c,D/100);s.push(Ib(x,B,b))}return s},Um={dark:{background:{1e3:"#252525",900:"#2F2F2F",800:"#323232",700:"#3E3E3E",600:"#4A4A4A"},text:"#F5F5F5","video-bg":"#1C1C1C"},light:{background:{1e3:"#FFFFFF",900:"#F5F5F5",800:"#EBEBEB",700:"#E0E0E0",600:"#D6D6D6"},text:"#111111","text-on-brand":"#ffffff","video-bg":"#DADADA"}},Ab=r=>{const[t,e,s,n,i]=$m(r,Fm);return{300:t,400:e,500:s,600:n,700:i}},Mb=r=>{if(r==="#FFFFFF")return Um.light.background;if(r==="#000000")return Um.dark.background;const[t,e,s,n,i]=$m(r,Cb);return{1e3:t,900:e,800:s,700:n,600:i}},Db={border_radius:"rounded",border_width:"thin",spacing_base:4,theme:"dark",colors:{brand:Ab("#2160FD"),background:Mb("#141414"),danger:"#FF2D2D",text:"#EEEEEE",text_on_brand:"#EEEEEE",success:"#62A504",video_bg:"#191919",warning:"#FFCD07"}};function Vm(){return xl(Db)}var Ob={permissions:{can_accept_production_requests:!1,can_edit_display_name:!0,accept_waiting_requests:!1,disable_participant_audio:!1,disable_participant_screensharing:!1,disable_participant_video:!1,can_spotlight:!1,kick_participant:!1,pin_participant:!1,can_record:!1,can_livestream:!1,waiting_room_type:"SKIP",plugins:{can_close:!0,can_start:!0,can_edit_config:!1,config:{}},polls:{can_create:!0,can_vote:!0,can_view:!0},media:{video:{can_produce:"ALLOWED",can_consume:"ALLOWED"},audio:{can_produce:"ALLOWED"},screenshare:{can_produce:"ALLOWED",can_consume:"ALLOWED"}},chat:{public:{can_send:!0,text:!0,files:!0},private:{can_send:!1,can_receive:!1,text:!1,files:!1},channel:{can_create:"ALL",can_delete:"ALL",can_update:"ALL",can_read_all:!1},message:{can_delete:"ALL",can_edit:"ALL",delete_cutoff_time_seconds:0,edit_cutoff_time_seconds:0}},hidden_participant:!1,is_recorder:!1,recorder_type:"NONE",show_participant_list:!0,transcription_enabled:!1,can_change_participant_permissions:!1,connected_meetings:{can_alter_connected_meetings:!1,can_switch_connected_meetings:!1,can_switch_to_parent_meeting:!1},stage_enabled:!1,stage_access:void 0,accept_stage_requests:!1},ui:{oldTheme:{setup_screen:{is_enabled:!1},alone_here:{is_enabled:!1},waiting_room:{is_enabled:!1,enable_preview:!0},control_bar:{is_enabled:!0,elements:{plugins:!0,screenshare:!0,invite:!1,participants:!0,chat:!0,reactions:!1,polls:!0,fullscreen:!0,layout:!0}},header:{is_enabled:!0,elements:{timer:!0,title:!0,participant_count:!0,change_layout:!0}},pip_mode:!0,auto_tune:!0,colors:{primary:"#2160FD",secondary:"#1A1A1A",text:"#EEEEEE",background:"#1A1A1A",textPrimary:"#EEEEEE",videoBackground:"#1A1A1A"},dimensions:{mode:"fillParent"},grid:{multi:{maxVideoCount:6,videoFit:"cover"},single:{maxVideoCount:6,videoFit:"cover"},defaultView:"MULTI"},controls:{pip_toggle:!1},plugins:[]},design_tokens:Vm(),config_diff:{}},config:{view_type:"GROUP_CALL",media:{audio:{enable_stereo:!1,enable_high_bitrate:!1},video:{quality:"vga",frame_rate:24},screenshare:{quality:"hd",frame_rate:5}},max_video_streams:{mobile:6,desktop:6},max_screenshare_count:1},version:"hybrid"};function Nb(){return xl(Ob)}var Lb={permissions:{can_accept_production_requests:!1,can_edit_display_name:!0,accept_waiting_requests:!1,disable_participant_audio:!1,disable_participant_screensharing:!1,disable_participant_video:!1,can_spotlight:!1,kick_participant:!1,pin_participant:!1,can_record:!1,can_livestream:!1,waiting_room_type:"SKIP",plugins:{can_close:!0,can_start:!0,can_edit_config:!1,config:{}},polls:{can_create:!0,can_vote:!0,can_view:!0},media:{video:{can_produce:"ALLOWED"},audio:{can_produce:"ALLOWED"},screenshare:{can_produce:"ALLOWED"}},chat:{public:{can_send:!0,text:!0,files:!0},private:{can_send:!1,can_receive:!1,text:!1,files:!1}},hidden_participant:!1,is_recorder:!1,recorder_type:"NONE",show_participant_list:!0,transcription_enabled:!1,can_change_participant_permissions:!1,connected_meetings:{can_alter_connected_meetings:!1,can_switch_connected_meetings:!1,can_switch_to_parent_meeting:!1},stage_enabled:!1,stage_access:void 0,accept_stage_requests:!1},ui:{design_tokens:Vm(),config_diff:{}},config:{view_type:"GROUP_CALL",media:{audio:{enable_stereo:!1,enable_high_bitrate:!1},video:{quality:"vga",frame_rate:24},screenshare:{quality:"hd",frame_rate:5}},max_video_streams:{mobile:6,desktop:6},max_screenshare_count:1},version:"2.0.0"};function Fl(){return xl(Lb)}var $l={},xb={get exports(){return $l},set exports(r){$l=r}},mc={},Fb={get exports(){return mc},set exports(r){mc=r}},Bm=function(t,e){return function(){for(var n=new Array(arguments.length),i=0;i<n.length;i++)n[i]=arguments[i];return t.apply(e,n)}},$b=Bm,gs=Object.prototype.toString;function Ul(r){return Array.isArray(r)}function Vl(r){return typeof r=="undefined"}function Ub(r){return r!==null&&!Vl(r)&&r.constructor!==null&&!Vl(r.constructor)&&typeof r.constructor.isBuffer=="function"&&r.constructor.isBuffer(r)}function Hm(r){return gs.call(r)==="[object ArrayBuffer]"}function Vb(r){return gs.call(r)==="[object FormData]"}function Bb(r){var t;return typeof ArrayBuffer!="undefined"&&ArrayBuffer.isView?t=ArrayBuffer.isView(r):t=r&&r.buffer&&Hm(r.buffer),t}function Hb(r){return typeof r=="string"}function qb(r){return typeof r=="number"}function qm(r){return r!==null&&typeof r=="object"}function fc(r){if(gs.call(r)!=="[object Object]")return!1;var t=Object.getPrototypeOf(r);return t===null||t===Object.prototype}function jb(r){return gs.call(r)==="[object Date]"}function Gb(r){return gs.call(r)==="[object File]"}function Wb(r){return gs.call(r)==="[object Blob]"}function jm(r){return gs.call(r)==="[object Function]"}function Jb(r){return qm(r)&&jm(r.pipe)}function Kb(r){return gs.call(r)==="[object URLSearchParams]"}function zb(r){return r.trim?r.trim():r.replace(/^\s+|\s+$/g,"")}function Yb(){return typeof navigator!="undefined"&&(navigator.product==="ReactNative"||navigator.product==="NativeScript"||navigator.product==="NS")?!1:typeof window!="undefined"&&typeof document!="undefined"}function Bl(r,t){if(!(r===null||typeof r=="undefined"))if(typeof r!="object"&&(r=[r]),Ul(r))for(var e=0,s=r.length;e<s;e++)t.call(null,r[e],e,r);else for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&t.call(null,r[n],n,r)}function Hl(){var r={};function t(n,i){fc(r[i])&&fc(n)?r[i]=Hl(r[i],n):fc(n)?r[i]=Hl({},n):Ul(n)?r[i]=n.slice():r[i]=n}for(var e=0,s=arguments.length;e<s;e++)Bl(arguments[e],t);return r}function Qb(r,t,e){return Bl(t,function(n,i){e&&typeof n=="function"?r[i]=$b(n,e):r[i]=n}),r}function Xb(r){return r.charCodeAt(0)===65279&&(r=r.slice(1)),r}var Nt={isArray:Ul,isArrayBuffer:Hm,isBuffer:Ub,isFormData:Vb,isArrayBufferView:Bb,isString:Hb,isNumber:qb,isObject:qm,isPlainObject:fc,isUndefined:Vl,isDate:jb,isFile:Gb,isBlob:Wb,isFunction:jm,isStream:Jb,isURLSearchParams:Kb,isStandardBrowserEnv:Yb,forEach:Bl,merge:Hl,extend:Qb,trim:zb,stripBOM:Xb},Zn=Nt;function Gm(r){return encodeURIComponent(r).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}var Wm=function(t,e,s){if(!e)return t;var n;if(s)n=s(e);else if(Zn.isURLSearchParams(e))n=e.toString();else{var i=[];Zn.forEach(e,function(c,l){c===null||typeof c=="undefined"||(Zn.isArray(c)?l=l+"[]":c=[c],Zn.forEach(c,function(h){Zn.isDate(h)?h=h.toISOString():Zn.isObject(h)&&(h=JSON.stringify(h)),i.push(Gm(l)+"="+Gm(h))}))}),n=i.join("&")}if(n){var a=t.indexOf("#");a!==-1&&(t=t.slice(0,a)),t+=(t.indexOf("?")===-1?"?":"&")+n}return t},Zb=Nt;function gc(){this.handlers=[]}gc.prototype.use=function(t,e,s){return this.handlers.push({fulfilled:t,rejected:e,synchronous:s?s.synchronous:!1,runWhen:s?s.runWhen:null}),this.handlers.length-1},gc.prototype.eject=function(t){this.handlers[t]&&(this.handlers[t]=null)},gc.prototype.forEach=function(t){Zb.forEach(this.handlers,function(s){s!==null&&t(s)})};var eC=gc,tC=Nt,rC=function(t,e){tC.forEach(t,function(n,i){i!==e&&i.toUpperCase()===e.toUpperCase()&&(t[e]=n,delete t[i])})},Jm=function(t,e,s,n,i){return t.config=e,s&&(t.code=s),t.request=n,t.response=i,t.isAxiosError=!0,t.toJSON=function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code,status:this.response&&this.response.status?this.response.status:null}},t},ql,Km;function zm(){if(Km)return ql;Km=1;var r=Jm;return ql=function(e,s,n,i,a){var o=new Error(e);return r(o,s,n,i,a)},ql}var jl,Ym;function sC(){if(Ym)return jl;Ym=1;var r=zm();return jl=function(e,s,n){var i=n.config.validateStatus;!n.status||!i||i(n.status)?e(n):s(r("Request failed with status code "+n.status,n.config,null,n.request,n))},jl}var Gl,Qm;function nC(){if(Qm)return Gl;Qm=1;var r=Nt;return Gl=r.isStandardBrowserEnv()?function(){return{write:function(s,n,i,a,o,c){var l=[];l.push(s+"="+encodeURIComponent(n)),r.isNumber(i)&&l.push("expires="+new Date(i).toGMTString()),r.isString(a)&&l.push("path="+a),r.isString(o)&&l.push("domain="+o),c===!0&&l.push("secure"),document.cookie=l.join("; ")},read:function(s){var n=document.cookie.match(new RegExp("(^|;\\s*)("+s+")=([^;]*)"));return n?decodeURIComponent(n[3]):null},remove:function(s){this.write(s,"",Date.now()-864e5)}}}():function(){return{write:function(){},read:function(){return null},remove:function(){}}}(),Gl}var Wl,Xm;function iC(){return Xm||(Xm=1,Wl=function(t){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(t)}),Wl}var Jl,Zm;function aC(){return Zm||(Zm=1,Jl=function(t,e){return e?t.replace(/\/+$/,"")+"/"+e.replace(/^\/+/,""):t}),Jl}var Kl,ef;function oC(){if(ef)return Kl;ef=1;var r=iC(),t=aC();return Kl=function(s,n){return s&&!r(n)?t(s,n):n},Kl}var zl,tf;function cC(){if(tf)return zl;tf=1;var r=Nt,t=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"];return zl=function(s){var n={},i,a,o;return s&&r.forEach(s.split(`
`),function(l){if(o=l.indexOf(":"),i=r.trim(l.substr(0,o)).toLowerCase(),a=r.trim(l.substr(o+1)),i){if(n[i]&&t.indexOf(i)>=0)return;i==="set-cookie"?n[i]=(n[i]?n[i]:[]).concat([a]):n[i]=n[i]?n[i]+", "+a:a}}),n},zl}var Yl,rf;function dC(){if(rf)return Yl;rf=1;var r=Nt;return Yl=r.isStandardBrowserEnv()?function(){var e=/(msie|trident)/i.test(navigator.userAgent),s=document.createElement("a"),n;function i(a){var o=a;return e&&(s.setAttribute("href",o),o=s.href),s.setAttribute("href",o),{href:s.href,protocol:s.protocol?s.protocol.replace(/:$/,""):"",host:s.host,search:s.search?s.search.replace(/^\?/,""):"",hash:s.hash?s.hash.replace(/^#/,""):"",hostname:s.hostname,port:s.port,pathname:s.pathname.charAt(0)==="/"?s.pathname:"/"+s.pathname}}return n=i(window.location.href),function(o){var c=r.isString(o)?i(o):o;return c.protocol===n.protocol&&c.host===n.host}}():function(){return function(){return!0}}(),Yl}var Ql,sf;function vc(){if(sf)return Ql;sf=1;function r(t){this.message=t}return r.prototype.toString=function(){return"Cancel"+(this.message?": "+this.message:"")},r.prototype.__CANCEL__=!0,Ql=r,Ql}var Xl,nf;function af(){if(nf)return Xl;nf=1;var r=Nt,t=sC(),e=nC(),s=Wm,n=oC(),i=cC(),a=dC(),o=zm(),c=yc(),l=vc();return Xl=function(h){return new Promise(function(g,_){var w=h.data,R=h.headers,D=h.responseType,x;function B(){h.cancelToken&&h.cancelToken.unsubscribe(x),h.signal&&h.signal.removeEventListener("abort",x)}r.isFormData(w)&&delete R["Content-Type"];var b=new XMLHttpRequest;if(h.auth){var Q=h.auth.username||"",te=h.auth.password?unescape(encodeURIComponent(h.auth.password)):"";R.Authorization="Basic "+btoa(Q+":"+te)}var ce=n(h.baseURL,h.url);b.open(h.method.toUpperCase(),s(ce,h.params,h.paramsSerializer),!0),b.timeout=h.timeout;function he(){if(b){var de="getAllResponseHeaders"in b?i(b.getAllResponseHeaders()):null,He=!D||D==="text"||D==="json"?b.responseText:b.response,A={data:He,status:b.status,statusText:b.statusText,headers:de,config:h,request:b};t(function(C){g(C),B()},function(C){_(C),B()},A),b=null}}if("onloadend"in b?b.onloadend=he:b.onreadystatechange=function(){!b||b.readyState!==4||b.status===0&&!(b.responseURL&&b.responseURL.indexOf("file:")===0)||setTimeout(he)},b.onabort=function(){b&&(_(o("Request aborted",h,"ECONNABORTED",b)),b=null)},b.onerror=function(){_(o("Network Error",h,null,b)),b=null},b.ontimeout=function(){var He=h.timeout?"timeout of "+h.timeout+"ms exceeded":"timeout exceeded",A=h.transitional||c.transitional;h.timeoutErrorMessage&&(He=h.timeoutErrorMessage),_(o(He,h,A.clarifyTimeoutError?"ETIMEDOUT":"ECONNABORTED",b)),b=null},r.isStandardBrowserEnv()){var Ne=(h.withCredentials||a(ce))&&h.xsrfCookieName?e.read(h.xsrfCookieName):void 0;Ne&&(R[h.xsrfHeaderName]=Ne)}"setRequestHeader"in b&&r.forEach(R,function(He,A){typeof w=="undefined"&&A.toLowerCase()==="content-type"?delete R[A]:b.setRequestHeader(A,He)}),r.isUndefined(h.withCredentials)||(b.withCredentials=!!h.withCredentials),D&&D!=="json"&&(b.responseType=h.responseType),typeof h.onDownloadProgress=="function"&&b.addEventListener("progress",h.onDownloadProgress),typeof h.onUploadProgress=="function"&&b.upload&&b.upload.addEventListener("progress",h.onUploadProgress),(h.cancelToken||h.signal)&&(x=function(de){b&&(_(!de||de&&de.type?new l("canceled"):de),b.abort(),b=null)},h.cancelToken&&h.cancelToken.subscribe(x),h.signal&&(h.signal.aborted?x():h.signal.addEventListener("abort",x))),w||(w=null),b.send(w)})},Xl}var Zl,of;function yc(){if(of)return Zl;of=1;var r=Nt,t=rC,e=Jm,s={"Content-Type":"application/x-www-form-urlencoded"};function n(c,l){!r.isUndefined(c)&&r.isUndefined(c["Content-Type"])&&(c["Content-Type"]=l)}function i(){var c;return(typeof XMLHttpRequest!="undefined"||typeof process!="undefined"&&Object.prototype.toString.call(process)==="[object process]")&&(c=af()),c}function a(c,l,p){if(r.isString(c))try{return(l||JSON.parse)(c),r.trim(c)}catch(h){if(h.name!=="SyntaxError")throw h}return(p||JSON.stringify)(c)}var o={transitional:{silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},adapter:i(),transformRequest:[function(l,p){return t(p,"Accept"),t(p,"Content-Type"),r.isFormData(l)||r.isArrayBuffer(l)||r.isBuffer(l)||r.isStream(l)||r.isFile(l)||r.isBlob(l)?l:r.isArrayBufferView(l)?l.buffer:r.isURLSearchParams(l)?(n(p,"application/x-www-form-urlencoded;charset=utf-8"),l.toString()):r.isObject(l)||p&&p["Content-Type"]==="application/json"?(n(p,"application/json"),a(l)):l}],transformResponse:[function(l){var p=this.transitional||o.transitional,h=p&&p.silentJSONParsing,f=p&&p.forcedJSONParsing,g=!h&&this.responseType==="json";if(g||f&&r.isString(l)&&l.length)try{return JSON.parse(l)}catch(_){if(g)throw _.name==="SyntaxError"?e(_,this,"E_JSON_PARSE"):_}return l}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,validateStatus:function(l){return l>=200&&l<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};return r.forEach(["delete","get","head"],function(l){o.headers[l]={}}),r.forEach(["post","put","patch"],function(l){o.headers[l]=r.merge(s)}),Zl=o,Zl}var lC=Nt,uC=yc(),hC=function(t,e,s){var n=this||uC;return lC.forEach(s,function(a){t=a.call(n,t,e)}),t},eu,cf;function df(){return cf||(cf=1,eu=function(t){return!!(t&&t.__CANCEL__)}),eu}var lf=Nt,tu=hC,pC=df(),mC=yc(),fC=vc();function ru(r){if(r.cancelToken&&r.cancelToken.throwIfRequested(),r.signal&&r.signal.aborted)throw new fC("canceled")}var gC=function(t){ru(t),t.headers=t.headers||{},t.data=tu.call(t,t.data,t.headers,t.transformRequest),t.headers=lf.merge(t.headers.common||{},t.headers[t.method]||{},t.headers),lf.forEach(["delete","get","head","post","put","patch","common"],function(n){delete t.headers[n]});var e=t.adapter||mC.adapter;return e(t).then(function(n){return ru(t),n.data=tu.call(t,n.data,n.headers,t.transformResponse),n},function(n){return pC(n)||(ru(t),n&&n.response&&(n.response.data=tu.call(t,n.response.data,n.response.headers,t.transformResponse))),Promise.reject(n)})},Ht=Nt,uf=function(t,e){e=e||{};var s={};function n(p,h){return Ht.isPlainObject(p)&&Ht.isPlainObject(h)?Ht.merge(p,h):Ht.isPlainObject(h)?Ht.merge({},h):Ht.isArray(h)?h.slice():h}function i(p){if(Ht.isUndefined(e[p])){if(!Ht.isUndefined(t[p]))return n(void 0,t[p])}else return n(t[p],e[p])}function a(p){if(!Ht.isUndefined(e[p]))return n(void 0,e[p])}function o(p){if(Ht.isUndefined(e[p])){if(!Ht.isUndefined(t[p]))return n(void 0,t[p])}else return n(void 0,e[p])}function c(p){if(p in e)return n(t[p],e[p]);if(p in t)return n(void 0,t[p])}var l={url:a,method:a,data:a,baseURL:o,transformRequest:o,transformResponse:o,paramsSerializer:o,timeout:o,timeoutMessage:o,withCredentials:o,adapter:o,responseType:o,xsrfCookieName:o,xsrfHeaderName:o,onUploadProgress:o,onDownloadProgress:o,decompress:o,maxContentLength:o,maxBodyLength:o,transport:o,httpAgent:o,httpsAgent:o,cancelToken:o,socketPath:o,responseEncoding:o,validateStatus:c};return Ht.forEach(Object.keys(t).concat(Object.keys(e)),function(h){var f=l[h]||i,g=f(h);Ht.isUndefined(g)&&f!==c||(s[h]=g)}),s},su,hf;function pf(){return hf||(hf=1,su={version:"0.25.0"}),su}var vC=pf().version,nu={};["object","boolean","number","function","string","symbol"].forEach(function(r,t){nu[r]=function(s){return typeof s===r||"a"+(t<1?"n ":" ")+r}});var mf={};nu.transitional=function(t,e,s){function n(i,a){return"[Axios v"+vC+"] Transitional option '"+i+"'"+a+(s?". "+s:"")}return function(i,a,o){if(t===!1)throw new Error(n(a," has been removed"+(e?" in "+e:"")));return e&&!mf[a]&&(mf[a]=!0,console.warn(n(a," has been deprecated since v"+e+" and will be removed in the near future"))),t?t(i,a,o):!0}};function yC(r,t,e){if(typeof r!="object")throw new TypeError("options must be an object");for(var s=Object.keys(r),n=s.length;n-- >0;){var i=s[n],a=t[i];if(a){var o=r[i],c=o===void 0||a(o,i,r);if(c!==!0)throw new TypeError("option "+i+" must be "+c);continue}if(e!==!0)throw Error("Unknown option "+i)}}var TC={assertOptions:yC,validators:nu},ff=Nt,SC=Wm,gf=eC,vf=gC,Tc=uf,yf=TC,ei=yf.validators;function ma(r){this.defaults=r,this.interceptors={request:new gf,response:new gf}}ma.prototype.request=function(t,e){if(typeof t=="string"?(e=e||{},e.url=t):e=t||{},!e.url)throw new Error("Provided config url is not valid");e=Tc(this.defaults,e),e.method?e.method=e.method.toLowerCase():this.defaults.method?e.method=this.defaults.method.toLowerCase():e.method="get";var s=e.transitional;s!==void 0&&yf.assertOptions(s,{silentJSONParsing:ei.transitional(ei.boolean),forcedJSONParsing:ei.transitional(ei.boolean),clarifyTimeoutError:ei.transitional(ei.boolean)},!1);var n=[],i=!0;this.interceptors.request.forEach(function(g){typeof g.runWhen=="function"&&g.runWhen(e)===!1||(i=i&&g.synchronous,n.unshift(g.fulfilled,g.rejected))});var a=[];this.interceptors.response.forEach(function(g){a.push(g.fulfilled,g.rejected)});var o;if(!i){var c=[vf,void 0];for(Array.prototype.unshift.apply(c,n),c=c.concat(a),o=Promise.resolve(e);c.length;)o=o.then(c.shift(),c.shift());return o}for(var l=e;n.length;){var p=n.shift(),h=n.shift();try{l=p(l)}catch(f){h(f);break}}try{o=vf(l)}catch(f){return Promise.reject(f)}for(;a.length;)o=o.then(a.shift(),a.shift());return o},ma.prototype.getUri=function(t){if(!t.url)throw new Error("Provided config url is not valid");return t=Tc(this.defaults,t),SC(t.url,t.params,t.paramsSerializer).replace(/^\?/,"")},ff.forEach(["delete","get","head","options"],function(t){ma.prototype[t]=function(e,s){return this.request(Tc(s||{},{method:t,url:e,data:(s||{}).data}))}}),ff.forEach(["post","put","patch"],function(t){ma.prototype[t]=function(e,s,n){return this.request(Tc(n||{},{method:t,url:e,data:s}))}});var EC=ma,iu,Tf;function _C(){if(Tf)return iu;Tf=1;var r=vc();function t(e){if(typeof e!="function")throw new TypeError("executor must be a function.");var s;this.promise=new Promise(function(a){s=a});var n=this;this.promise.then(function(i){if(n._listeners){var a,o=n._listeners.length;for(a=0;a<o;a++)n._listeners[a](i);n._listeners=null}}),this.promise.then=function(i){var a,o=new Promise(function(c){n.subscribe(c),a=c}).then(i);return o.cancel=function(){n.unsubscribe(a)},o},e(function(a){n.reason||(n.reason=new r(a),s(n.reason))})}return t.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},t.prototype.subscribe=function(s){if(this.reason){s(this.reason);return}this._listeners?this._listeners.push(s):this._listeners=[s]},t.prototype.unsubscribe=function(s){if(this._listeners){var n=this._listeners.indexOf(s);n!==-1&&this._listeners.splice(n,1)}},t.source=function(){var s,n=new t(function(a){s=a});return{token:n,cancel:s}},iu=t,iu}var au,Sf;function wC(){return Sf||(Sf=1,au=function(t){return function(s){return t.apply(null,s)}}),au}var ou,Ef;function bC(){if(Ef)return ou;Ef=1;var r=Nt;return ou=function(e){return r.isObject(e)&&e.isAxiosError===!0},ou}var _f=Nt,CC=Bm,Sc=EC,RC=uf,PC=yc();function wf(r){var t=new Sc(r),e=CC(Sc.prototype.request,t);return _f.extend(e,Sc.prototype,t),_f.extend(e,t),e.create=function(n){return wf(RC(r,n))},e}var Rr=wf(PC);Rr.Axios=Sc,Rr.Cancel=vc(),Rr.CancelToken=_C(),Rr.isCancel=df(),Rr.VERSION=pf().version,Rr.all=function(t){return Promise.all(t)},Rr.spread=wC(),Rr.isAxiosError=bC(),Fb.exports=Rr,mc.default=Rr,function(r){r.exports=mc}(xb);const cu=be($l);var kC=/\s/;function IC(r){for(var t=r.length;t--&&kC.test(r.charAt(t)););return t}var AC=/^\s+/;function MC(r){return r&&r.slice(0,IC(r)+1).replace(AC,"")}var bf=0/0,DC=/^[-+]0x[0-9a-f]+$/i,OC=/^0b[01]+$/i,NC=/^0o[0-7]+$/i,LC=parseInt;function Cf(r){if(typeof r=="number")return r;if(vb(r))return bf;if(lr(r)){var t=typeof r.valueOf=="function"?r.valueOf():r;r=lr(t)?t+"":t}if(typeof r!="string")return r===0?r:+r;r=MC(r);var e=OC.test(r);return e||NC.test(r)?LC(r.slice(2),e?2:8):DC.test(r)?bf:+r}function Rf(r){return r}function xC(r,t,e){switch(e.length){case 0:return r.call(t);case 1:return r.call(t,e[0]);case 2:return r.call(t,e[0],e[1]);case 3:return r.call(t,e[0],e[1],e[2])}return r.apply(t,e)}var FC=800,$C=16,UC=Date.now;function VC(r){var t=0,e=0;return function(){var s=UC(),n=$C-(s-e);if(e=s,n>0){if(++t>=FC)return arguments[0]}else t=0;return r.apply(void 0,arguments)}}function BC(r){return function(){return r}}var HC=cc?function(r,t){return cc(r,"toString",{configurable:!0,enumerable:!1,value:BC(t),writable:!0})}:Rf,qC=VC(HC);const jC=qC;var Pf=Math.max;function GC(r,t,e){return t=Pf(t===void 0?r.length-1:t,0),function(){for(var s=arguments,n=-1,i=Pf(s.length-t,0),a=Array(i);++n<i;)a[n]=s[t+n];n=-1;for(var o=Array(t+1);++n<t;)o[n]=s[n];return o[t]=e(a),xC(r,this,o)}}function WC(r,t){return jC(GC(r,t,Rf),r+"")}function JC(r,t,e){if(!lr(e))return!1;var s=typeof t;return(s=="number"?ha(e)&&sm(t,e.length):s=="string"&&t in e)?aa(e[t],r):!1}function KC(r){return WC(function(t,e){var s=-1,n=e.length,i=n>1?e[n-1]:void 0,a=n>2?e[2]:void 0;for(i=r.length>3&&typeof i=="function"?(n--,i):void 0,a&&JC(e[0],e[1],a)&&(i=n<3?void 0:i,n=1),t=Object(t);++s<n;){var o=e[s];o&&r(t,o,s,i)}return t})}var zC="[object Object]",YC=Function.prototype,QC=Object.prototype,kf=YC.toString,XC=QC.hasOwnProperty,ZC=kf.call(Object);function eR(r){if(!Cr(r)||Ys(r)!=zC)return!1;var t=Il(r);if(t===null)return!0;var e=XC.call(t,"constructor")&&t.constructor;return typeof e=="function"&&e instanceof e&&kf.call(e)==ZC}var tR="__lodash_hash_undefined__";function rR(r){return this.__data__.set(r,tR),this}function sR(r){return this.__data__.has(r)}function Ec(r){var t=-1,e=r==null?0:r.length;for(this.__data__=new en;++t<e;)this.add(r[t])}Ec.prototype.add=Ec.prototype.push=rR,Ec.prototype.has=sR;function nR(r,t){for(var e=-1,s=r==null?0:r.length;++e<s;)if(t(r[e],e,r))return!0;return!1}function iR(r,t){return r.has(t)}var aR=1,oR=2;function If(r,t,e,s,n,i){var a=e&aR,o=r.length,c=t.length;if(o!=c&&!(a&&c>o))return!1;var l=i.get(r),p=i.get(t);if(l&&p)return l==t&&p==r;var h=-1,f=!0,g=e&oR?new Ec:void 0;for(i.set(r,t),i.set(t,r);++h<o;){var _=r[h],w=t[h];if(s)var R=a?s(w,_,h,t,r,i):s(_,w,h,r,t,i);if(R!==void 0){if(R)continue;f=!1;break}if(g){if(!nR(t,function(D,x){if(!iR(g,x)&&(_===D||n(_,D,e,s,i)))return g.push(x)})){f=!1;break}}else if(!(_===w||n(_,w,e,s,i))){f=!1;break}}return i.delete(r),i.delete(t),f}function cR(r){var t=-1,e=Array(r.size);return r.forEach(function(s,n){e[++t]=[n,s]}),e}function dR(r){var t=-1,e=Array(r.size);return r.forEach(function(s){e[++t]=s}),e}var lR=1,uR=2,hR="[object Boolean]",pR="[object Date]",mR="[object Error]",fR="[object Map]",gR="[object Number]",vR="[object RegExp]",yR="[object Set]",TR="[object String]",SR="[object Symbol]",ER="[object ArrayBuffer]",_R="[object DataView]",Af=ms?ms.prototype:void 0,du=Af?Af.valueOf:void 0;function wR(r,t,e,s,n,i,a){switch(e){case _R:if(r.byteLength!=t.byteLength||r.byteOffset!=t.byteOffset)return!1;r=r.buffer,t=t.buffer;case ER:return!(r.byteLength!=t.byteLength||!i(new hc(r),new hc(t)));case hR:case pR:case gR:return aa(+r,+t);case mR:return r.name==t.name&&r.message==t.message;case vR:case TR:return r==t+"";case fR:var o=cR;case yR:var c=s&lR;if(o||(o=dR),r.size!=t.size&&!c)return!1;var l=a.get(r);if(l)return l==t;s|=uR,a.set(r,t);var p=If(o(r),o(t),s,n,i,a);return a.delete(r),p;case SR:if(du)return du.call(r)==du.call(t)}return!1}var bR=1,CR=Object.prototype,RR=CR.hasOwnProperty;function PR(r,t,e,s,n,i){var a=e&bR,o=Al(r),c=o.length,l=Al(t),p=l.length;if(c!=p&&!a)return!1;for(var h=c;h--;){var f=o[h];if(!(a?f in t:RR.call(t,f)))return!1}var g=i.get(r),_=i.get(t);if(g&&_)return g==t&&_==r;var w=!0;i.set(r,t),i.set(t,r);for(var R=a;++h<c;){f=o[h];var D=r[f],x=t[f];if(s)var B=a?s(x,D,f,t,r,i):s(D,x,f,r,t,i);if(!(B===void 0?D===x||n(D,x,e,s,i):B)){w=!1;break}R||(R=f=="constructor")}if(w&&!R){var b=r.constructor,Q=t.constructor;b!=Q&&"constructor"in r&&"constructor"in t&&!(typeof b=="function"&&b instanceof b&&typeof Q=="function"&&Q instanceof Q)&&(w=!1)}return i.delete(r),i.delete(t),w}var kR=1,Mf="[object Arguments]",Df="[object Array]",_c="[object Object]",IR=Object.prototype,Of=IR.hasOwnProperty;function AR(r,t,e,s,n,i){var a=fs(r),o=fs(t),c=a?Df:Xn(r),l=o?Df:Xn(t);c=c==Mf?_c:c,l=l==Mf?_c:l;var p=c==_c,h=l==_c,f=c==l;if(f&&Yn(r)){if(!Yn(t))return!1;a=!0,p=!1}if(f&&!p)return i||(i=new br),a||lc(r)?If(r,t,e,s,n,i):wR(r,t,c,e,s,n,i);if(!(e&kR)){var g=p&&Of.call(r,"__wrapped__"),_=h&&Of.call(t,"__wrapped__");if(g||_){var w=g?r.value():r,R=_?t.value():t;return i||(i=new br),n(w,R,e,s,i)}}return f?(i||(i=new br),PR(r,t,e,s,n,i)):!1}function Nf(r,t,e,s,n){return r===t?!0:r==null||t==null||!Cr(r)&&!Cr(t)?r!==r&&t!==t:AR(r,t,e,s,Nf,n)}function MR(r){return function(t,e,s){for(var n=-1,i=Object(t),a=s(t),o=a.length;o--;){var c=a[r?o:++n];if(e(i[c],c,i)===!1)break}return t}}var DR=MR();const OR=DR;var NR=function(){return dr.Date.now()};const lu=NR;var LR="Expected a function",xR=Math.max,FR=Math.min;function ti(r,t,e){var s,n,i,a,o,c,l=0,p=!1,h=!1,f=!0;if(typeof r!="function")throw new TypeError(LR);t=Cf(t)||0,lr(e)&&(p=!!e.leading,h="maxWait"in e,i=h?xR(Cf(e.maxWait)||0,t):i,f="trailing"in e?!!e.trailing:f);function g(te){var ce=s,he=n;return s=n=void 0,l=te,a=r.apply(he,ce),a}function _(te){return l=te,o=setTimeout(D,t),p?g(te):a}function w(te){var ce=te-c,he=te-l,Ne=t-ce;return h?FR(Ne,i-he):Ne}function R(te){var ce=te-c,he=te-l;return c===void 0||ce>=t||ce<0||h&&he>=i}function D(){var te=lu();if(R(te))return x(te);o=setTimeout(D,w(te))}function x(te){return o=void 0,f&&s?g(te):(s=n=void 0,a)}function B(){o!==void 0&&clearTimeout(o),l=0,s=c=n=o=void 0}function b(){return o===void 0?a:x(lu())}function Q(){var te=lu(),ce=R(te);if(s=arguments,n=this,c=te,ce){if(o===void 0)return _(c);if(h)return clearTimeout(o),o=setTimeout(D,t),g(c)}return o===void 0&&(o=setTimeout(D,t)),a}return Q.cancel=B,Q.flush=b,Q}function uu(r,t,e){(e!==void 0&&!aa(r[t],e)||e===void 0&&!(t in r))&&bl(r,t,e)}function $R(r){return Cr(r)&&ha(r)}function hu(r,t){if(!(t==="constructor"&&typeof r[t]=="function")&&t!="__proto__")return r[t]}function UR(r){return la(r,pa(r))}function VR(r,t,e,s,n,i,a){var o=hu(r,e),c=hu(t,e),l=a.get(c);if(l){uu(r,e,l);return}var p=i?i(o,c,e+"",r,t,a):void 0,h=p===void 0;if(h){var f=fs(c),g=!f&&Yn(c),_=!f&&!g&&lc(c);p=c,f||g||_?fs(o)?p=o:$R(o)?p=fm(o):g?(h=!1,p=mm(c,!0)):_?(h=!1,p=km(c,!0)):p=[]:eR(c)||dc(c)?(p=o,dc(o)?p=UR(o):(!lr(o)||_l(o))&&(p=Am(c))):h=!1}h&&(a.set(c,p),n(p,c,s,i,a),a.delete(c)),uu(r,e,p)}function Lf(r,t,e,s,n){r!==t&&OR(t,function(i,a){if(n||(n=new br),lr(i))VR(r,t,a,e,Lf,s,n);else{var o=s?s(hu(r,a),i,a+"",r,t,n):void 0;o===void 0&&(o=i),uu(r,a,o)}},pa)}var BR="[object Map]",HR="[object Set]",qR=Object.prototype,jR=qR.hasOwnProperty;function GR(r){if(r==null)return!0;if(ha(r)&&(fs(r)||typeof r=="string"||typeof r.splice=="function"||Yn(r)||lc(r)||dc(r)))return!r.length;var t=Xn(r);if(t==BR||t==HR)return!r.size;if(uc(r))return!dm(r).length;for(var e in r)if(jR.call(r,e))return!1;return!0}function WR(r,t){return Nf(r,t)}var JR=KC(function(r,t,e){Lf(r,t,e)});const vs=JR;var pu=(r=>(r.PARTICIPANT="PARTICIPANT",r.PEER="PEER",r.CLIENT="CLIENT",r))(pu||{});const Z={PROPAGATE_KICK_ALL:"propagate_kick_across_rooms",REFRESH_ID_ON_DISCONNECTION:"refresh_id_on_disconnection",SIMULCAST:"simulcast",CHAT_SOCKET_SERVER:"chat_socket_server",POLL_SOCKET_SERVER:"poll_socket_server",PLUGIN_SOCKET_SERVER:"plugin_socket_server",NR_OTEL_WEB:"nr_otel_web",ICE_RESTART_ON_FAILED_STATE:"ice_restart_on_failed_state",ICE_RESTART_ON_DISCONNECTED_STATE:"ice_restart_on_disconnected_state",ENABLE_ICE_STATE_LOGGING:"enable_ice_state_logging",SUPPRESS_PEER_MUTE_UNMUTE_EMITS:"web_core_suppress_peer_mute_unmute_emits",SKIP_OTEL_TRACES:"skip_otel_traces",USE_USERIDS_IN_CHAT:"use_userids_in_chat",CUSTOM_PING_PONG:"custom_ping_pong",ENABLE_HIVE_SIMULCAST:"enable_hive_simulcast",ENABLE_HIVE_TRANSPORT_RECONNECTION_ON_ICE_FAILED:"enable_hive_transport_reconnection_on_ice_failed",ENABLE_HIVE_EXPERIMENTAL_FAIL_RECOVERY:"enable_hive_fail_recovery",ENABLE_HIVE_INFINITE_RETRIES:"enable_hive_infinite_retries",HIVE_TRANSPORT_FORCE_RELAY_ON_ICE_FAILED:"hive_transport_force_relay_on_ice_failed",ENABLE_HIVE_CONSUME_OVER_DC:"enable_hive_consume_over_dc",ENABLE_CF_SIMULCAST:"enable_cf_simulcast",ENABLE_CF_TRANSPORT_RECONNECTION_ON_ICE_FAILED:"enable_cf_transport_reconnection_on_ice_failed",ENABLE_CF_EXPERIMENTAL_FAIL_RECOVERY:"enable_cf_fail_recovery",ENABLE_CF_INFINITE_RETRIES:"enable_cf_infinite_retries",CF_TRANSPORT_FORCE_RELAY_ON_ICE_FAILED:"cf_transport_force_relay_on_ice_failed",BYPASS_LOG_EXCLUSION_LIST:"bypass_log_exclusion_list",LOG_LEVEL:"log_level",V1_PLUGINS:"v1_plugins",SCREENSHARE_DTX:"screenshare_dtx",SCREENSHARE_PRIORITY:"screenshare_priority",SCREENSHARE_MIN_BITRATE:"screenshare_minbitrate",SCREENSHARE_SIMULCAST:"screenshare_simulcast",DISABLE_WEBCAM_LAYERS_ON_SCREENSHARE:"disable_webcam_layers_on_screenshare",SCREENSHARE_FORCE_GOOG_CONFERENCE:"screenshare_force_goog_conference",LIVESTREAM:"feat_livestream",FETCH_RETRY:"fetch_retry",DISABLE_WEBCAM_SIMULCAST:"webcore_disable_webcam_simulcast",OVERRIDE_WEBCAM_SIMULCAST:"override_webcam_simulcast",SOCKET_POLLING:"socket_polling",FEAT_PAGINATED_CHAT:"feat_paginated_chat",VAL_MIN_FRAMERATE:"val_min_framerate",SCREEENSHARE_ERR_HACK:"screenshare_err_hack",SCREEENSHARE_CONSTRAINTS_RETRY:"screenshare_constraints_retry",TROUBLESHOOTING:"feat_troubleshooting",VIDEO_CONSTRAINTS:"video_constraints",SCREENSHARE_CONSTRAINTS:"screenshare_constraints",FEAT_CHAT_SDK:"feat_chat_sdk",FEAT_CHAT_SDK_SEARCH:"chat_search",OBS_QUALITY:"obs_quality",ALLOW_SAFARI_MEDIA_MIDDLEWARES:"allow_safari_media_middlewares",DYNAMIC_VIDEO_QUALITY:"dynamic_video_quality",EXP_RESHARE:"exp_reshare",LEAVE_STAGE_ON_END:"leave_stage_on_end",SKIP_SETTING_IN_USE_DEVICE:"skip_setting_in_use_device",PRECALL_BANDWIDTH_TEST:"precall_bandwidth_test",CONSUMER_BIND_NO_RETRY:"consumer_bind_no_retry",DEBUG_SOCKET_JOIN:"debug_socket_join",FORCE_RELAY:"force_relay",FORCE_VIDEO_CODEC:"force_video_codec"};function wc(r){const t={};return typeof(r==null?void 0:r.code)=="number"&&(t.code=r.code),typeof(r==null?void 0:r.code)=="string"&&(t.code=r.code.substring(0,100)),typeof(r==null?void 0:r.name)=="string"&&(t.name=r.name.substring(0,500)),typeof(r==null?void 0:r.message)=="string"&&(t.message=r.message.substring(0,500)),typeof(r==null?void 0:r.reason)=="string"&&(t.reason=r.reason.substring(0,500)),typeof(r==null?void 0:r.stack)=="string"&&(t.stack=r.stack.substring(0,500)),t}function xf(r){var s,n,i,a;const t=typeof navigator!="undefined"&&!navigator.isReactNative&&typeof window!="undefined"&&((s=window.location.host)==null?void 0:s.includes("devel"))&&((n=window.location.host)==null?void 0:n.includes("dyte.io")),e=!!((a=(i=r==null?void 0:r.getValue("modules"))==null?void 0:i.devTools)!=null&&a.logs);return t||e}function KR(r){var t;if(J.hasFeature(Z.LOG_LEVEL)){let e=((t=J.getValue(Z.LOG_LEVEL))==null?void 0:t.toString())||"all";if(e=e.toLowerCase().trim(),e==="off")return!1;if(e!=="all"){const s=["debug","log","info","warn","error"],n=s.indexOf(r),i=s.indexOf(e);if(n<i)return!1}}return!0}function Ff(r,t,e={}){return Object.getOwnPropertyNames(r).forEach(s=>{var i;if([null,void 0,NaN].includes(r[s])||t&&(((i=t.match(/\./g))==null?void 0:i.length)||0)>=10)return;const n=t?`${t}.${s}`:s;typeof r[s]=="object"?Ff(r[s],n,e):["number","string","boolean"].includes(typeof r[s])&&(e[n]=r[s])}),e}function $f(r,t,e={},s=""){const n={};try{const i=JSON.stringify(e),a=JSON.parse(i),o=Ff(a,s),c=JSON.stringify(o);if(c.length>5e3){const l=`Log named: "${t}" is trying to log an flattened object of size
${c.length} chars that is beyond permitted limit of 5000 chars. Please optimize.`;throw xf(r)&&console.error(l,{log:e,flattened:c}),new Error(l)}return JSON.parse(c)}catch(i){const a=wc(i);n[`${s}.error.message`]=a.message||"",n[`${s}.error.stack`]=a.stack||"",n[`${s}.error.reason`]=a.reason||"",n[`${s}.error.source`]="safelyFlattenObjForOpenTelemetry"}return n}const zR={"Amazon Silk":"amazon_silk","Android Browser":"android",Bada:"bada",BlackBerry:"blackberry",Chrome:"chrome",Chromium:"chromium",Electron:"electron",Epiphany:"epiphany",Firefox:"firefox",Focus:"focus",Generic:"generic","Google Search":"google_search",Googlebot:"googlebot","Internet Explorer":"ie","K-Meleon":"k_meleon",Maxthon:"maxthon","Microsoft Edge":"edge","MZ Browser":"mz","NAVER Whale Browser":"naver",Opera:"opera","Opera Coast":"opera_coast",PhantomJS:"phantomjs",Puffin:"puffin",QupZilla:"qupzilla",QQ:"qq",QQLite:"qqlite",Safari:"safari",Sailfish:"sailfish","Samsung Internet for Android":"samsung_internet",SeaMonkey:"seamonkey",Sleipnir:"sleipnir",Swing:"swing",Tizen:"tizen","UC Browser":"uc",Vivaldi:"vivaldi","WebOS Browser":"webos",WeChat:"wechat","Yandex Browser":"yandex",Roku:"roku"},Uf={amazon_silk:"Amazon Silk",android:"Android Browser",bada:"Bada",blackberry:"BlackBerry",chrome:"Chrome",chromium:"Chromium",electron:"Electron",epiphany:"Epiphany",firefox:"Firefox",focus:"Focus",generic:"Generic",googlebot:"Googlebot",google_search:"Google Search",ie:"Internet Explorer",k_meleon:"K-Meleon",maxthon:"Maxthon",edge:"Microsoft Edge",mz:"MZ Browser",naver:"NAVER Whale Browser",opera:"Opera",opera_coast:"Opera Coast",phantomjs:"PhantomJS",puffin:"Puffin",qupzilla:"QupZilla",qq:"QQ Browser",qqlite:"QQ Browser Lite",safari:"Safari",sailfish:"Sailfish",samsung_internet:"Samsung Internet for Android",seamonkey:"SeaMonkey",sleipnir:"Sleipnir",swing:"Swing",tizen:"Tizen",uc:"UC Browser",vivaldi:"Vivaldi",webos:"WebOS Browser",wechat:"WeChat",yandex:"Yandex Browser"},je={tablet:"tablet",mobile:"mobile",desktop:"desktop",tv:"tv"},Rt={WindowsPhone:"Windows Phone",Windows:"Windows",MacOS:"macOS",iOS:"iOS",Android:"Android",WebOS:"WebOS",BlackBerry:"BlackBerry",Bada:"Bada",Tizen:"Tizen",Linux:"Linux",ChromeOS:"Chrome OS",PlayStation4:"PlayStation 4",Roku:"Roku"},ys={EdgeHTML:"EdgeHTML",Blink:"Blink",Trident:"Trident",Presto:"Presto",Gecko:"Gecko",WebKit:"WebKit"};class N{static getFirstMatch(t,e){const s=e.match(t);return s&&s.length>0&&s[1]||""}static getSecondMatch(t,e){const s=e.match(t);return s&&s.length>1&&s[2]||""}static matchAndReturnConst(t,e,s){if(t.test(e))return s}static getWindowsVersionName(t){switch(t){case"NT":return"NT";case"XP":return"XP";case"NT 5.0":return"2000";case"NT 5.1":return"XP";case"NT 5.2":return"2003";case"NT 6.0":return"Vista";case"NT 6.1":return"7";case"NT 6.2":return"8";case"NT 6.3":return"8.1";case"NT 10.0":return"10";default:return}}static getMacOSVersionName(t){const e=t.split(".").splice(0,2).map(s=>parseInt(s,10)||0);if(e.push(0),e[0]===10)switch(e[1]){case 5:return"Leopard";case 6:return"Snow Leopard";case 7:return"Lion";case 8:return"Mountain Lion";case 9:return"Mavericks";case 10:return"Yosemite";case 11:return"El Capitan";case 12:return"Sierra";case 13:return"High Sierra";case 14:return"Mojave";case 15:return"Catalina";default:return}}static getAndroidVersionName(t){const e=t.split(".").splice(0,2).map(s=>parseInt(s,10)||0);if(e.push(0),!(e[0]===1&&e[1]<5)){if(e[0]===1&&e[1]<6)return"Cupcake";if(e[0]===1&&e[1]>=6)return"Donut";if(e[0]===2&&e[1]<2)return"Eclair";if(e[0]===2&&e[1]===2)return"Froyo";if(e[0]===2&&e[1]>2)return"Gingerbread";if(e[0]===3)return"Honeycomb";if(e[0]===4&&e[1]<1)return"Ice Cream Sandwich";if(e[0]===4&&e[1]<4)return"Jelly Bean";if(e[0]===4&&e[1]>=4)return"KitKat";if(e[0]===5)return"Lollipop";if(e[0]===6)return"Marshmallow";if(e[0]===7)return"Nougat";if(e[0]===8)return"Oreo";if(e[0]===9)return"Pie"}}static getVersionPrecision(t){return t.split(".").length}static compareVersions(t,e,s=!1){const n=N.getVersionPrecision(t),i=N.getVersionPrecision(e);let a=Math.max(n,i),o=0;const c=N.map([t,e],l=>{const p=a-N.getVersionPrecision(l),h=l+new Array(p+1).join(".0");return N.map(h.split("."),f=>new Array(20-f.length).join("0")+f).reverse()});for(s&&(o=a-Math.min(n,i)),a-=1;a>=o;){if(c[0][a]>c[1][a])return 1;if(c[0][a]===c[1][a]){if(a===o)return 0;a-=1}else if(c[0][a]<c[1][a])return-1}}static map(t,e){const s=[];let n;if(Array.prototype.map)return Array.prototype.map.call(t,e);for(n=0;n<t.length;n+=1)s.push(e(t[n]));return s}static find(t,e){let s,n;if(Array.prototype.find)return Array.prototype.find.call(t,e);for(s=0,n=t.length;s<n;s+=1){const i=t[s];if(e(i,s))return i}}static assign(t,...e){const s=t;let n,i;if(Object.assign)return Object.assign(t,...e);for(n=0,i=e.length;n<i;n+=1){const a=e[n];typeof a=="object"&&a!==null&&Object.keys(a).forEach(c=>{s[c]=a[c]})}return t}static getBrowserAlias(t){return zR[t]}static getBrowserTypeByAlias(t){return Uf[t]||""}}const ve=/version\/(\d+(\.?_?\d+)+)/i,YR=[{test:[/googlebot/i],describe(r){const t={name:"Googlebot"},e=N.getFirstMatch(/googlebot\/(\d+(\.\d+))/i,r)||N.getFirstMatch(ve,r);return e&&(t.version=e),t}},{test:[/opera/i],describe(r){const t={name:"Opera"},e=N.getFirstMatch(ve,r)||N.getFirstMatch(/(?:opera)[\s/](\d+(\.?_?\d+)+)/i,r);return e&&(t.version=e),t}},{test:[/opr\/|opios/i],describe(r){const t={name:"Opera"},e=N.getFirstMatch(/(?:opr|opios)[\s/](\S+)/i,r)||N.getFirstMatch(ve,r);return e&&(t.version=e),t}},{test:[/SamsungBrowser/i],describe(r){const t={name:"Samsung Internet for Android"},e=N.getFirstMatch(ve,r)||N.getFirstMatch(/(?:SamsungBrowser)[\s/](\d+(\.?_?\d+)+)/i,r);return e&&(t.version=e),t}},{test:[/Whale/i],describe(r){const t={name:"NAVER Whale Browser"},e=N.getFirstMatch(ve,r)||N.getFirstMatch(/(?:whale)[\s/](\d+(?:\.\d+)+)/i,r);return e&&(t.version=e),t}},{test:[/MZBrowser/i],describe(r){const t={name:"MZ Browser"},e=N.getFirstMatch(/(?:MZBrowser)[\s/](\d+(?:\.\d+)+)/i,r)||N.getFirstMatch(ve,r);return e&&(t.version=e),t}},{test:[/focus/i],describe(r){const t={name:"Focus"},e=N.getFirstMatch(/(?:focus)[\s/](\d+(?:\.\d+)+)/i,r)||N.getFirstMatch(ve,r);return e&&(t.version=e),t}},{test:[/swing/i],describe(r){const t={name:"Swing"},e=N.getFirstMatch(/(?:swing)[\s/](\d+(?:\.\d+)+)/i,r)||N.getFirstMatch(ve,r);return e&&(t.version=e),t}},{test:[/coast/i],describe(r){const t={name:"Opera Coast"},e=N.getFirstMatch(ve,r)||N.getFirstMatch(/(?:coast)[\s/](\d+(\.?_?\d+)+)/i,r);return e&&(t.version=e),t}},{test:[/opt\/\d+(?:.?_?\d+)+/i],describe(r){const t={name:"Opera Touch"},e=N.getFirstMatch(/(?:opt)[\s/](\d+(\.?_?\d+)+)/i,r)||N.getFirstMatch(ve,r);return e&&(t.version=e),t}},{test:[/yabrowser/i],describe(r){const t={name:"Yandex Browser"},e=N.getFirstMatch(/(?:yabrowser)[\s/](\d+(\.?_?\d+)+)/i,r)||N.getFirstMatch(ve,r);return e&&(t.version=e),t}},{test:[/ucbrowser/i],describe(r){const t={name:"UC Browser"},e=N.getFirstMatch(ve,r)||N.getFirstMatch(/(?:ucbrowser)[\s/](\d+(\.?_?\d+)+)/i,r);return e&&(t.version=e),t}},{test:[/Maxthon|mxios/i],describe(r){const t={name:"Maxthon"},e=N.getFirstMatch(ve,r)||N.getFirstMatch(/(?:Maxthon|mxios)[\s/](\d+(\.?_?\d+)+)/i,r);return e&&(t.version=e),t}},{test:[/epiphany/i],describe(r){const t={name:"Epiphany"},e=N.getFirstMatch(ve,r)||N.getFirstMatch(/(?:epiphany)[\s/](\d+(\.?_?\d+)+)/i,r);return e&&(t.version=e),t}},{test:[/puffin/i],describe(r){const t={name:"Puffin"},e=N.getFirstMatch(ve,r)||N.getFirstMatch(/(?:puffin)[\s/](\d+(\.?_?\d+)+)/i,r);return e&&(t.version=e),t}},{test:[/sleipnir/i],describe(r){const t={name:"Sleipnir"},e=N.getFirstMatch(ve,r)||N.getFirstMatch(/(?:sleipnir)[\s/](\d+(\.?_?\d+)+)/i,r);return e&&(t.version=e),t}},{test:[/k-meleon/i],describe(r){const t={name:"K-Meleon"},e=N.getFirstMatch(ve,r)||N.getFirstMatch(/(?:k-meleon)[\s/](\d+(\.?_?\d+)+)/i,r);return e&&(t.version=e),t}},{test:[/micromessenger/i],describe(r){const t={name:"WeChat"},e=N.getFirstMatch(/(?:micromessenger)[\s/](\d+(\.?_?\d+)+)/i,r)||N.getFirstMatch(ve,r);return e&&(t.version=e),t}},{test:[/qqbrowser/i],describe(r){const t={name:/qqbrowserlite/i.test(r)?"QQ Browser Lite":"QQ Browser"},e=N.getFirstMatch(/(?:qqbrowserlite|qqbrowser)[/](\d+(\.?_?\d+)+)/i,r)||N.getFirstMatch(ve,r);return e&&(t.version=e),t}},{test:[/msie|trident/i],describe(r){const t={name:"Internet Explorer"},e=N.getFirstMatch(/(?:msie |rv:)(\d+(\.?_?\d+)+)/i,r);return e&&(t.version=e),t}},{test:[/\sedg\//i],describe(r){const t={name:"Microsoft Edge"},e=N.getFirstMatch(/\sedg\/(\d+(\.?_?\d+)+)/i,r);return e&&(t.version=e),t}},{test:[/edg([ea]|ios)/i],describe(r){const t={name:"Microsoft Edge"},e=N.getSecondMatch(/edg([ea]|ios)\/(\d+(\.?_?\d+)+)/i,r);return e&&(t.version=e),t}},{test:[/vivaldi/i],describe(r){const t={name:"Vivaldi"},e=N.getFirstMatch(/vivaldi\/(\d+(\.?_?\d+)+)/i,r);return e&&(t.version=e),t}},{test:[/seamonkey/i],describe(r){const t={name:"SeaMonkey"},e=N.getFirstMatch(/seamonkey\/(\d+(\.?_?\d+)+)/i,r);return e&&(t.version=e),t}},{test:[/sailfish/i],describe(r){const t={name:"Sailfish"},e=N.getFirstMatch(/sailfish\s?browser\/(\d+(\.\d+)?)/i,r);return e&&(t.version=e),t}},{test:[/silk/i],describe(r){const t={name:"Amazon Silk"},e=N.getFirstMatch(/silk\/(\d+(\.?_?\d+)+)/i,r);return e&&(t.version=e),t}},{test:[/phantom/i],describe(r){const t={name:"PhantomJS"},e=N.getFirstMatch(/phantomjs\/(\d+(\.?_?\d+)+)/i,r);return e&&(t.version=e),t}},{test:[/slimerjs/i],describe(r){const t={name:"SlimerJS"},e=N.getFirstMatch(/slimerjs\/(\d+(\.?_?\d+)+)/i,r);return e&&(t.version=e),t}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe(r){const t={name:"BlackBerry"},e=N.getFirstMatch(ve,r)||N.getFirstMatch(/blackberry[\d]+\/(\d+(\.?_?\d+)+)/i,r);return e&&(t.version=e),t}},{test:[/(web|hpw)[o0]s/i],describe(r){const t={name:"WebOS Browser"},e=N.getFirstMatch(ve,r)||N.getFirstMatch(/w(?:eb)?[o0]sbrowser\/(\d+(\.?_?\d+)+)/i,r);return e&&(t.version=e),t}},{test:[/bada/i],describe(r){const t={name:"Bada"},e=N.getFirstMatch(/dolfin\/(\d+(\.?_?\d+)+)/i,r);return e&&(t.version=e),t}},{test:[/tizen/i],describe(r){const t={name:"Tizen"},e=N.getFirstMatch(/(?:tizen\s?)?browser\/(\d+(\.?_?\d+)+)/i,r)||N.getFirstMatch(ve,r);return e&&(t.version=e),t}},{test:[/qupzilla/i],describe(r){const t={name:"QupZilla"},e=N.getFirstMatch(/(?:qupzilla)[\s/](\d+(\.?_?\d+)+)/i,r)||N.getFirstMatch(ve,r);return e&&(t.version=e),t}},{test:[/firefox|iceweasel|fxios/i],describe(r){const t={name:"Firefox"},e=N.getFirstMatch(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,r);return e&&(t.version=e),t}},{test:[/electron/i],describe(r){const t={name:"Electron"},e=N.getFirstMatch(/(?:electron)\/(\d+(\.?_?\d+)+)/i,r);return e&&(t.version=e),t}},{test:[/MiuiBrowser/i],describe(r){const t={name:"Miui"},e=N.getFirstMatch(/(?:MiuiBrowser)[\s/](\d+(\.?_?\d+)+)/i,r);return e&&(t.version=e),t}},{test:[/chromium/i],describe(r){const t={name:"Chromium"},e=N.getFirstMatch(/(?:chromium)[\s/](\d+(\.?_?\d+)+)/i,r)||N.getFirstMatch(ve,r);return e&&(t.version=e),t}},{test:[/chrome|crios|crmo/i],describe(r){const t={name:"Chrome"},e=N.getFirstMatch(/(?:chrome|crios|crmo)\/(\d+(\.?_?\d+)+)/i,r);return e&&(t.version=e),t}},{test:[/GSA/i],describe(r){const t={name:"Google Search"},e=N.getFirstMatch(/(?:GSA)\/(\d+(\.?_?\d+)+)/i,r);return e&&(t.version=e),t}},{test(r){const t=!r.test(/like android/i),e=r.test(/android/i);return t&&e},describe(r){const t={name:"Android Browser"},e=N.getFirstMatch(ve,r);return e&&(t.version=e),t}},{test:[/playstation 4/i],describe(r){const t={name:"PlayStation 4"},e=N.getFirstMatch(ve,r);return e&&(t.version=e),t}},{test:[/safari|applewebkit/i],describe(r){const t={name:"Safari"},e=N.getFirstMatch(ve,r);return e&&(t.version=e),t}},{test:[/.*/i],describe(r){const t=/^(.*)\/(.*) /,e=/^(.*)\/(.*)[ \t]\((.*)/,n=r.search("\\(")!==-1?e:t;return{name:N.getFirstMatch(n,r),version:N.getSecondMatch(n,r)}}}],QR=[{test:[/Roku\/DVP/],describe(r){const t=N.getFirstMatch(/Roku\/DVP-(\d+\.\d+)/i,r);return{name:Rt.Roku,version:t}}},{test:[/windows phone/i],describe(r){const t=N.getFirstMatch(/windows phone (?:os)?\s?(\d+(\.\d+)*)/i,r);return{name:Rt.WindowsPhone,version:t}}},{test:[/windows /i],describe(r){const t=N.getFirstMatch(/Windows ((NT|XP)( \d\d?.\d)?)/i,r),e=N.getWindowsVersionName(t);return{name:Rt.Windows,version:t,versionName:e}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe(r){const t={name:Rt.iOS},e=N.getSecondMatch(/(Version\/)(\d[\d.]+)/,r);return e&&(t.version=e),t}},{test:[/macintosh/i],describe(r){const t=N.getFirstMatch(/mac os x (\d+(\.?_?\d+)+)/i,r).replace(/[_\s]/g,"."),e=N.getMacOSVersionName(t),s={name:Rt.MacOS,version:t};return e&&(s.versionName=e),s}},{test:[/(ipod|iphone|ipad)/i],describe(r){const t=N.getFirstMatch(/os (\d+([_\s]\d+)*) like mac os x/i,r).replace(/[_\s]/g,".");return{name:Rt.iOS,version:t}}},{test(r){const t=!r.test(/like android/i),e=r.test(/android/i);return t&&e},describe(r){const t=N.getFirstMatch(/android[\s/-](\d+(\.\d+)*)/i,r),e=N.getAndroidVersionName(t),s={name:Rt.Android,version:t};return e&&(s.versionName=e),s}},{test:[/(web|hpw)[o0]s/i],describe(r){const t=N.getFirstMatch(/(?:web|hpw)[o0]s\/(\d+(\.\d+)*)/i,r),e={name:Rt.WebOS};return t&&t.length&&(e.version=t),e}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe(r){const t=N.getFirstMatch(/rim\stablet\sos\s(\d+(\.\d+)*)/i,r)||N.getFirstMatch(/blackberry\d+\/(\d+([_\s]\d+)*)/i,r)||N.getFirstMatch(/\bbb(\d+)/i,r);return{name:Rt.BlackBerry,version:t}}},{test:[/bada/i],describe(r){const t=N.getFirstMatch(/bada\/(\d+(\.\d+)*)/i,r);return{name:Rt.Bada,version:t}}},{test:[/tizen/i],describe(r){const t=N.getFirstMatch(/tizen[/\s](\d+(\.\d+)*)/i,r);return{name:Rt.Tizen,version:t}}},{test:[/linux/i],describe(){return{name:Rt.Linux}}},{test:[/CrOS/],describe(){return{name:Rt.ChromeOS}}},{test:[/PlayStation 4/],describe(r){const t=N.getFirstMatch(/PlayStation 4[/\s](\d+(\.\d+)*)/i,r);return{name:Rt.PlayStation4,version:t}}}],XR=[{test:[/googlebot/i],describe(){return{type:"bot",vendor:"Google"}}},{test:[/huawei/i],describe(r){const t=N.getFirstMatch(/(can-l01)/i,r)&&"Nova",e={type:je.mobile,vendor:"Huawei"};return t&&(e.model=t),e}},{test:[/nexus\s*(?:7|8|9|10).*/i],describe(){return{type:je.tablet,vendor:"Nexus"}}},{test:[/ipad/i],describe(){return{type:je.tablet,vendor:"Apple",model:"iPad"}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe(){return{type:je.tablet,vendor:"Apple",model:"iPad"}}},{test:[/kftt build/i],describe(){return{type:je.tablet,vendor:"Amazon",model:"Kindle Fire HD 7"}}},{test:[/silk/i],describe(){return{type:je.tablet,vendor:"Amazon"}}},{test:[/tablet(?! pc)/i],describe(){return{type:je.tablet}}},{test(r){const t=r.test(/ipod|iphone/i),e=r.test(/like (ipod|iphone)/i);return t&&!e},describe(r){const t=N.getFirstMatch(/(ipod|iphone)/i,r);return{type:je.mobile,vendor:"Apple",model:t}}},{test:[/nexus\s*[0-6].*/i,/galaxy nexus/i],describe(){return{type:je.mobile,vendor:"Nexus"}}},{test:[/[^-]mobi/i],describe(){return{type:je.mobile}}},{test(r){return r.getBrowserName(!0)==="blackberry"},describe(){return{type:je.mobile,vendor:"BlackBerry"}}},{test(r){return r.getBrowserName(!0)==="bada"},describe(){return{type:je.mobile}}},{test(r){return r.getBrowserName()==="windows phone"},describe(){return{type:je.mobile,vendor:"Microsoft"}}},{test(r){const t=Number(String(r.getOSVersion()).split(".")[0]);return r.getOSName(!0)==="android"&&t>=3},describe(){return{type:je.tablet}}},{test(r){return r.getOSName(!0)==="android"},describe(){return{type:je.mobile}}},{test(r){return r.getOSName(!0)==="macos"},describe(){return{type:je.desktop,vendor:"Apple"}}},{test(r){return r.getOSName(!0)==="windows"},describe(){return{type:je.desktop}}},{test(r){return r.getOSName(!0)==="linux"},describe(){return{type:je.desktop}}},{test(r){return r.getOSName(!0)==="playstation 4"},describe(){return{type:je.tv}}},{test(r){return r.getOSName(!0)==="roku"},describe(){return{type:je.tv}}}],ZR=[{test(r){return r.getBrowserName(!0)==="microsoft edge"},describe(r){if(/\sedg\//i.test(r))return{name:ys.Blink};const e=N.getFirstMatch(/edge\/(\d+(\.?_?\d+)+)/i,r);return{name:ys.EdgeHTML,version:e}}},{test:[/trident/i],describe(r){const t={name:ys.Trident},e=N.getFirstMatch(/trident\/(\d+(\.?_?\d+)+)/i,r);return e&&(t.version=e),t}},{test(r){return r.test(/presto/i)},describe(r){const t={name:ys.Presto},e=N.getFirstMatch(/presto\/(\d+(\.?_?\d+)+)/i,r);return e&&(t.version=e),t}},{test(r){const t=r.test(/gecko/i),e=r.test(/like gecko/i);return t&&!e},describe(r){const t={name:ys.Gecko},e=N.getFirstMatch(/gecko\/(\d+(\.?_?\d+)+)/i,r);return e&&(t.version=e),t}},{test:[/(apple)?webkit\/537\.36/i],describe(){return{name:ys.Blink}}},{test:[/(apple)?webkit/i],describe(r){const t={name:ys.WebKit},e=N.getFirstMatch(/webkit\/(\d+(\.?_?\d+)+)/i,r);return e&&(t.version=e),t}}];class Vf{constructor(t,e=!1){if(t==null||t==="")throw new Error("UserAgent parameter can't be empty");this._ua=t,this.parsedResult={},e!==!0&&this.parse()}getUA(){return this._ua}test(t){return t.test(this._ua)}parseBrowser(){this.parsedResult.browser={};const t=N.find(YR,e=>{if(typeof e.test=="function")return e.test(this);if(e.test instanceof Array)return e.test.some(s=>this.test(s));throw new Error("Browser's test function is not valid")});return t&&(this.parsedResult.browser=t.describe(this.getUA())),this.parsedResult.browser}getBrowser(){return this.parsedResult.browser?this.parsedResult.browser:this.parseBrowser()}getBrowserName(t){return t?String(this.getBrowser().name).toLowerCase()||"":this.getBrowser().name||""}getBrowserVersion(){return this.getBrowser().version}getOS(){return this.parsedResult.os?this.parsedResult.os:this.parseOS()}parseOS(){this.parsedResult.os={};const t=N.find(QR,e=>{if(typeof e.test=="function")return e.test(this);if(e.test instanceof Array)return e.test.some(s=>this.test(s));throw new Error("Browser's test function is not valid")});return t&&(this.parsedResult.os=t.describe(this.getUA())),this.parsedResult.os}getOSName(t){const{name:e}=this.getOS();return t?String(e).toLowerCase()||"":e||""}getOSVersion(){return this.getOS().version}getPlatform(){return this.parsedResult.platform?this.parsedResult.platform:this.parsePlatform()}getPlatformType(t=!1){const{type:e}=this.getPlatform();return t?String(e).toLowerCase()||"":e||""}parsePlatform(){this.parsedResult.platform={};const t=N.find(XR,e=>{if(typeof e.test=="function")return e.test(this);if(e.test instanceof Array)return e.test.some(s=>this.test(s));throw new Error("Browser's test function is not valid")});return t&&(this.parsedResult.platform=t.describe(this.getUA())),this.parsedResult.platform}getEngine(){return this.parsedResult.engine?this.parsedResult.engine:this.parseEngine()}getEngineName(t){return t?String(this.getEngine().name).toLowerCase()||"":this.getEngine().name||""}parseEngine(){this.parsedResult.engine={};const t=N.find(ZR,e=>{if(typeof e.test=="function")return e.test(this);if(e.test instanceof Array)return e.test.some(s=>this.test(s));throw new Error("Browser's test function is not valid")});return t&&(this.parsedResult.engine=t.describe(this.getUA())),this.parsedResult.engine}parse(){return this.parseBrowser(),this.parseOS(),this.parsePlatform(),this.parseEngine(),this}getResult(){return N.assign({},this.parsedResult)}satisfies(t){const e={};let s=0;const n={};let i=0;if(Object.keys(t).forEach(o=>{const c=t[o];typeof c=="string"?(n[o]=c,i+=1):typeof c=="object"&&(e[o]=c,s+=1)}),s>0){const o=Object.keys(e),c=N.find(o,p=>this.isOS(p));if(c){const p=this.satisfies(e[c]);if(p!==void 0)return p}const l=N.find(o,p=>this.isPlatform(p));if(l){const p=this.satisfies(e[l]);if(p!==void 0)return p}}if(i>0){const o=Object.keys(n),c=N.find(o,l=>this.isBrowser(l,!0));if(c!==void 0)return this.compareVersion(n[c])}}isBrowser(t,e=!1){const s=this.getBrowserName().toLowerCase();let n=t.toLowerCase();const i=N.getBrowserTypeByAlias(n);return e&&i&&(n=i.toLowerCase()),n===s}compareVersion(t){let e=[0],s=t,n=!1;const i=this.getBrowserVersion();if(typeof i=="string")return t[0]===">"||t[0]==="<"?(s=t.substr(1),t[1]==="="?(n=!0,s=t.substr(2)):e=[],t[0]===">"?e.push(1):e.push(-1)):t[0]==="="?s=t.substr(1):t[0]==="~"&&(n=!0,s=t.substr(1)),e.indexOf(N.compareVersions(i,s,n))>-1}isOS(t){return this.getOSName(!0)===String(t).toLowerCase()}isPlatform(t){return this.getPlatformType(!0)===String(t).toLowerCase()}isEngine(t){return this.getEngineName(!0)===String(t).toLowerCase()}is(t,e=!1){return this.isBrowser(t,e)||this.isOS(t)||this.isPlatform(t)}some(t=[]){return t.some(e=>this.is(e))}}/*!
 * Bowser - a browser detector
 * https://github.com/lancedikson/bowser
 * MIT License | (c) Dustin Diaz 2012-2015
 * MIT License | (c) Denis Demchenko 2015-2019
 */class Bf{static getParser(t,e=!1){if(typeof t!="string")throw new Error("UserAgent should be a string");return new Vf(t,e)}static parse(t){return new Vf(t).getResult()}static get BROWSER_MAP(){return Uf}static get ENGINE_MAP(){return ys}static get OS_MAP(){return Rt}static get PLATFORMS_MAP(){return je}}const fa="chrome",Hf="opera",qf="firefox",jf="iexplorer",Gf="safari",Wf="nwjs",Jf="electron",Kf="react-native",mu="unknown",bc={Chrome:fa,Chromium:fa,Opera:Hf,Firefox:qf,"Internet Explorer":jf,Safari:Gf};function eP(){const{userAgent:r}=navigator,t={name:mu,version:void 0};if(r.match(/Chrome/)&&!r.match(/Edge/))if(r.match(/Edg(A?)/)){const e=r.match(/Chrome\/([\d.]+)/)[1];Number.parseInt(e,10)>72&&(t.name=fa,t.version=e)}else t.name=fa,t.version=r.match(/Chrome\/([\d.]+)/)[1];return t}function tP(){const{userAgent:r}=navigator;if(r.match(/Electron/)){const t=r.match(/Electron\/([\d.]+)/)[1];return{name:Jf,version:t}}return null}function rP(){const{userAgent:r}=navigator;if(r.match(/JitsiMeetNW/)){const t=r.match(/JitsiMeetNW\/([\d.]+)/)[1];return{name:Wf,version:t}}}function sP(){const r=navigator.userAgent.match(/\b(react[ \t_-]*native)(?:\/(\S+))?/i);let t;if(r||navigator.product==="ReactNative")return r&&r.length>2&&(r[1],t=r[2]),t||(t="unknown"),{name:Kf,version:t}}function nP(r){let t;const e=[sP,tP,rP];for(let n=0;n<e.length;n+=1)if(t=e[n](),t)return t;const s=r.getBrowserName();return s in bc?{name:bc[s],version:r.getBrowserVersion()}:(t=eP(),t||{name:mu,version:void 0})}class iP{constructor(){m(this,"_bowser");m(this,"_name");m(this,"_version");m(this,"getDeviceInfo",()=>({isMobile:this.isMobile(),browserName:this._bowser.getBrowserName(),osName:this._bowser.getOSName(),browserVersion:this._bowser.getBrowserVersion(),osVersionName:this._bowser.getOSVersion(),engineName:this._bowser.getEngineName()}))}init(t){let e,s;if(this._bowser=Bf.getParser(navigator.userAgent),typeof t=="undefined"){const n=nP(this._bowser);e=n.name,s=n.version}else t.name in bc?(e=bc[t.name],s=t.version):(e=mu,s=void 0);this._name=e,this._version=s}getName(){return this._name}isChrome(){return this._name===fa}isOpera(){return this._name===Hf}isFirefox(){return this._name===qf}isIExplorer(){return this._name===jf}isSafari(){return this._name===Gf}isNWJS(){return this._name===Wf}isElectron(){return this._name===Jf}isReactNative(){return this._name===Kf||navigator.isReactNative===!0}getVersion(){return this._version}isMobile(){return this._bowser.getPlatformType()==="mobile"}_checkCondition(t){if(this._version)return this._bowser.satisfies(t)}isVersionGreaterThan(t){return this._checkCondition({[this._name]:`>${t}`})}isVersionLessThan(t){return this._checkCondition({[this._name]:`<${t}`})}isVersionEqualTo(t){return this._checkCondition({[this._name]:`~${t}`})}}class aP extends iP{doesVideoMuteByStreamRemove(){return this.isChromiumBased()||this.isWebKitBased()}supportsP2P(){return!this.usesUnifiedPlan()}isChromiumBased(){return this.isChrome()||this.isElectron()||this.isNWJS()||this.isOpera()}isWebKitBased(){return this._bowser.isEngine("webkit")&&typeof navigator.mediaDevices!="undefined"&&typeof navigator.mediaDevices.getUserMedia!="undefined"&&typeof window.RTCRtpTransceiver!="undefined"&&Object.keys(RTCRtpTransceiver.prototype).indexOf("currentDirection")>-1}isSupported(){return typeof RTCPeerConnection!="undefined"}isUserInteractionRequiredForUnmute(){return this.isFirefox()&&this.isVersionLessThan("68")}supportsVideoMuteOnConnInterrupted(){return this.isChromiumBased()||this.isReactNative()||this.isWebKitBased()}supportsBandwidthStatistics(){return!this.isFirefox()&&!this.isWebKitBased()}supportsCodecPreferences(){return this.usesUnifiedPlan()&&typeof window.RTCRtpTransceiver!="undefined"&&Object.keys(window.RTCRtpTransceiver.prototype).indexOf("setCodecPreferences")>-1&&Object.keys(RTCRtpSender.prototype).indexOf("getCapabilities")>-1&&!this.isWebKitBased()}supportsDeviceChangeEvent(){return navigator.mediaDevices&&typeof navigator.mediaDevices.ondevicechange!="undefined"&&typeof navigator.mediaDevices.addEventListener!="undefined"}supportsLocalCandidateRttStatistics(){return this.isChromiumBased()||this.isReactNative()||this.isWebKitBased()}supportsPerformanceObserver(){return typeof window.PerformanceObserver!="undefined"&&PerformanceObserver.supportedEntryTypes.indexOf("longtask")>-1}supportsReceiverStats(){return typeof window.RTCRtpReceiver!="undefined"&&Object.keys(RTCRtpReceiver.prototype).indexOf("getSynchronizationSources")>-1}supportsRTTStatistics(){return!this.isFirefox()}usesPlanB(){return!this.usesUnifiedPlan()}usesSdpMungingForSimulcast(){return this.isChromiumBased()||this.isReactNative()||this.isWebKitBased()}usesUnifiedPlan(){return!!(this.isFirefox()||this.isWebKitBased())}usesNewGumFlow(){return!!(this.isChromiumBased()||this.isFirefox()||this.isWebKitBased())}usesAdapter(){return this.usesNewGumFlow()}usesRidsForSimulcast(){return!1}supportsGetDisplayMedia(){return typeof navigator.getDisplayMedia!="undefined"||typeof navigator.mediaDevices!="undefined"&&typeof navigator.mediaDevices.getDisplayMedia!="undefined"}supportsInsertableStreams(){if(!(typeof window.RTCRtpSender!="undefined"&&(window.RTCRtpSender.prototype.createEncodedStreams||window.RTCRtpSender.prototype.createEncodedVideoStreams)))return!1;const t=new ReadableStream;try{return window.postMessage(t,"*",[t]),!0}catch(e){return!1}}supportsAudioRed(){return Boolean(window.RTCRtpSender&&window.RTCRtpSender.getCapabilities&&window.RTCRtpSender.getCapabilities("audio").codecs.some(t=>t.mimeType==="audio/red")&&window.RTCRtpReceiver&&window.RTCRtpReceiver.getCapabilities&&window.RTCRtpReceiver.getCapabilities("audio").codecs.some(t=>t.mimeType==="audio/red"))}supportsSdpSemantics(){return this.isChromiumBased()}_getChromiumBasedVersion(){if(this.isChromiumBased()){if(this.isNWJS())return Number.parseInt(process.versions.chromium,10);const t=navigator.userAgent;if(t.match(/Chrome/))return Number.parseInt(t.match(/Chrome\/([\d.]+)/)[1],10)}return-1}isIOSMobile(){return this.isMobile&&this._bowser.getOSName()==="iOS"}}const Re=new aP,oP={audio:!0,video:!0,screenshareAudio:!0,screenshareVideo:!0},ga={baseURL:"http://localhost:5000",createdAt:"2021-08-05T10:49:56.602Z",description:"Develop plugins locally",id:"09259e3b-7be8-46f6-9801-106bf1866e1c",name:"Localhost Dev",organizationId:"4ad15a19-80e2-4105-bf43-48039fd2963e",picture:"https://dyte-uploads.s3.ap-south-1.amazonaws.com/dyte.png",private:!1,published:!0,staggered:!1,tags:["#localhost","#dev"],type:"self_hosted",updatedAt:"2021-08-05T10:50:07.681Z"},cP={pip:!0,poll:!0,chat:!0,stage:!0,theme:!0,plugin:!0,tracing:!0,internals:!0,recording:!0,livestream:!0,participant:!0,devTools:{logs:!1}};function Cc(r,t){const e=r.getValue("overrides");return e&&e[t]?e[t]:!1}function dP({baseURI:r}){return r!=null&&r.includes("preprod.dyte")?na.PREPROD:r!=null&&r.includes("devel.dyte")?na.DEVEL:na.PROD}function ri({servicePrefix:r,baseURI:t}){return`${r}.${t}`}function zf(r){const t=r.getValue("baseURI");return{location:ri({servicePrefix:"location",baseURI:t}),locationLegacy:ri({servicePrefix:"location-legacy",baseURI:t}),daCollector:ri({servicePrefix:"da-collector",baseURI:t})}}const lP='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m16.242 2.932 4.826 4.826a2.75 2.75 0 0 1-.715 4.404l-4.87 2.435a.75.75 0 0 0-.374.426l-1.44 4.166a1.25 1.25 0 0 1-2.065.476L8.5 16.561 4.06 21H3v-1.06l4.44-4.44-3.105-3.104a1.25 1.25 0 0 1 .476-2.066l4.166-1.44a.75.75 0 0 0 .426-.373l2.435-4.87a2.75 2.75 0 0 1 4.405-.715Zm3.766 5.886-4.826-4.826a1.25 1.25 0 0 0-2.002.325l-2.435 4.871a2.25 2.25 0 0 1-1.278 1.12l-3.789 1.31 6.705 6.704 1.308-3.789a2.25 2.25 0 0 1 1.12-1.277l4.872-2.436a1.25 1.25 0 0 0 .325-2.002Z" fill="currentColor"/></svg>',uP='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M4 12.02c0 1.06.2 2.1.6 3.08l.6 1.42c.22.55.64 1.01 1.17 1.29.27.14.56.21.86.21h2.55c.77 0 1.49-.41 1.87-1.08.5-.87 1.02-1.7 1.72-2.43l1.32-1.39c.44-.46.97-.84 1.49-1.23l.59-.45a.6.6 0 0 0 .23-.47c0-.75-.54-1.57-1.22-1.79a3.34 3.34 0 0 0-2.78.29V4.5a1.5 1.5 0 0 0-2.05-1.4 1.5 1.5 0 0 0-2.9 0A1.5 1.5 0 0 0 6 4.5v.09A1.5 1.5 0 0 0 4 6v6.02ZM8 4.5v4a.5.5 0 0 0 1 0v-5a.5.5 0 0 1 1 0v5a.5.5 0 0 0 1 0v-4a.5.5 0 0 1 1 0v6a.5.5 0 0 0 .85.37h.01c.22-.22.44-.44.72-.58.7-.35 2.22-.57 2.4.5l-.53.4c-.52.4-1.04.78-1.48 1.24l-1.33 1.38c-.75.79-1.31 1.7-1.85 2.63-.21.36-.6.58-1.01.58H7.23a.87.87 0 0 1-.4-.1 1.55 1.55 0 0 1-.71-.78l-.59-1.42a7.09 7.09 0 0 1-.53-2.7V6a.5.5 0 0 1 1 0v3.5a.5.5 0 0 0 1 0v-5a.5.5 0 0 1 1 0Z" fill="currentColor"></path></svg>',Rc=r=>{if(!r)return;if(!r.startsWith("<svg"))return new Promise(i=>{i(r)});const e=new Blob([r],{type:"image/svg+xml"}),s=new Image,n=window.URL.createObjectURL(e);return new Promise((i,a)=>{s.onload=()=>{i(s),window.URL.revokeObjectURL(n)},s.onerror=()=>{a(),window.URL.revokeObjectURL(n)},s.src=n})};function hP(r){const t={...r},e=new Map,s=(l,p)=>(e.has(l)||e.set(l,new Set),e.get(l).add(p),()=>{var h;return(h=e.get(l))==null?void 0:h.delete(p)}),n=(l,p)=>{var h;(h=e.get(l))==null||h.delete(p)},i=l=>{var p;(p=e.get(l))==null||p.forEach(h=>{try{h(t[l])}catch(f){u.error(`Error in notifying for "${l.toString()}"`,f)}})};return{subscribe:s,unsubscribe:n,notify:i,setValue:(l,p,h=!0)=>{t[l]=p,h&&i(l)},getValue:l=>t[l],getAllValues:()=>t}}class pP{constructor(){m(this,"contexts",new Map);m(this,"mostRecentPeerId",null)}createContext(t,e){return this.contexts.has(t)?this.contexts.get(t):(this.contexts.set(t,hP(e)),this.mostRecentPeerId=t,this.contexts.get(t))}remapContext(t,e){const s=e.getValue("peerId");s!==t&&(e.setValue("peerId",t),this.mostRecentPeerId=t,this.contexts.set(t,e),this.contexts.delete(s))}getContext(t){return this.contexts.get(t)}getMostRecentPeerId(){return this.mostRecentPeerId}}const rn=new pP,oe=class{static get logsEndpoint(){const t=rn.getContext(oe.meetingMetadata.peerId);return`https://${ri({servicePrefix:"api-silos",baseURI:t.getValue("baseURI")})}/otel/logs`}static resetPeerId(t){oe.meetingMetadata.peerId=t}static init(t,e){const s=t.getValue("peerId");oe.tracingEnabled=e,oe.meetingMetadata.peerId=s,oe.meetingMetadata.sdkVersion=t.getValue("sdkVersion"),oe.meetingMetadata.deviceInfo=Re.getDeviceInfo(),oe.meetingMetadata.visitedUrl=!navigator.isReactNative&&typeof window!="undefined"&&window.location.href,navigator.isReactNative||document.addEventListener("visibilitychange",oe.processCachedLogs),oe.logsProcessorTimer=setInterval(oe.processCachedLogs,oe.logsProcessingInterval),e&&(oe.initialized=!0)}static trace(t,e=void 0){return(s,n,i)=>{const a=i.value;return i.value=function(...c){if(!oe.initialized||navigator.isReactNative||!oe.tracingEnabled||J.hasFeature(Z.SKIP_OTEL_TRACES))return a.apply(this,c);oe.addLogInCurrentSpan("info",t,e);const l=performance.now(),p=a.apply(this,c);return Promise.resolve(p).then(()=>{const h=performance.now();h-l>10&&oe.addLogInCurrentSpan("info",`${t}_timing`,{execTime:h-l,country:oe.location.country})}).catch(()=>{const h=performance.now();oe.addLogInCurrentSpan("info",`${t}_timing`,{execTime:h-l})}),p},i}}static injectContext(t){var n;const e=Jn().replace(/-/g,"").substring(0,16),s=(n=oe.meetingMetadata.peerId)==null?void 0:n.replace(/-/g,"");t.TRACEPARENT=`00-${s}-${e}-01`}static addLogInCurrentSpan(t,e,s={},n=!1){s!=null&&s.error&&Object.assign(s,{error:wc(s.error)});const i=rn.getContext(oe.meetingMetadata.peerId);if(xf(i)&&(GR(s)?console[t]("DyteInternalLogs:: ",t,e):console[t]("DyteInternalLogs:: ",t,e,s)),!!KR(t))try{const o=$f(i,e,s,"metadata"),c=new Date,l={message:e,level:t,...o,loggedAt:c.toISOString(),loggedAtTzOffset:c.getTimezoneOffset()};n?oe.sendOtelLogsToNewRelic([l]):oe.logsCache.push(l)}catch(o){oe.addLogInCurrentSpan("error","opentelemetry::addLogInCurrentSpan_failed",{error:wc(o)})}}static sendOtelLogsToNewRelic(t){const e=rn.getContext(oe.meetingMetadata.peerId);cu.post(oe.logsEndpoint,{meetingMetadata:$f(e,"sendOtelLogsToNewRelic",oe.meetingMetadata,"meetingMetadata"),serviceName:e.getValue("sdkName"),logs:t}).catch(s=>{oe.addLogInCurrentSpan("error","opentelemetry::sendOtelLogToNewRelic_failed",{error:wc(s)}),oe.logsCache.push(...t)})}static processCachedLogs(){const t=oe.logsCache.splice(0,25);t!=null&&t.length&&oe.sendOtelLogsToNewRelic(t)}static destruct(){clearInterval(oe.logsProcessorTimer),oe.processCachedLogs(),navigator.isReactNative||document.removeEventListener("visibilitychange",oe.processCachedLogs)}};let v=oe;m(v,"logsCache",[]),m(v,"logsProcessorTimer"),m(v,"location",{country:void 0}),m(v,"tracingEnabled",!0),m(v,"initialized",!1),m(v,"logsProcessingInterval",7e3),m(v,"logExclusionList",["message","websocket/message","roomMessage","websocket/room-message","websocket/room-legacy-mode","chatMessage","websocket/new-chat-message","websocket/no-active-speaker","websocket/selected-peers","websocket/active-speaker","ping","websocket/new-consumer","websocket/producer-score","websocket/consumer-score","websocket/plugin-event","websocket/plugin-data","websocket/plugin-internal-data"]),m(v,"meetingMetadata",{});class u{static info(t,e,s){v.addLogInCurrentSpan("info",t,e,s)}static error(t,e,s){v.addLogInCurrentSpan("error",t,e,s)}static debug(t,e,s){v.addLogInCurrentSpan("debug",t,e,s)}static log(t,e,s){v.addLogInCurrentSpan("log",t,e,s)}static warn(t,e,s){v.addLogInCurrentSpan("warn",t,e,s)}}const mP=()=>{!navigator.isReactNative&&typeof window!="undefined"&&(window.addEventListener("error",r=>{var t;!((t=r.filename)!=null&&t.includes("localhost"))&&r.lineno!==0&&u.error("window::error",{error:r.error},!0)}),window.addEventListener("unhandledrejection",r=>{var t,e,s,n,i,a,o,c;u.error("window::unhandledrejection",{error:r==null?void 0:r.reason,networkCall:{url:(e=(t=r==null?void 0:r.reason)==null?void 0:t.config)==null?void 0:e.url,baseURL:(n=(s=r==null?void 0:r.reason)==null?void 0:s.config)==null?void 0:n.baseURL,method:(a=(i=r==null?void 0:r.reason)==null?void 0:i.config)==null?void 0:a.method,status:(o=r==null?void 0:r.reason)==null?void 0:o.status,statusText:(c=r==null?void 0:r.reason)==null?void 0:c.statusText}},!0)}),window.addEventListener("offline",()=>{u.info("window::offline")}),window.addEventListener("online",()=>{u.info("window::online")}))},fP={"00":"DyteClient","01":"Controller","02":"RoomNodeClient","03":"HiveNodeClient","04":"SocketService","05":"Chat","06":"Plugin","07":"Polls","08":"Meta","09":"Preset",10:"Recording",11:"Self",12:"Participant",13:"Spotlight",14:"Remote Request",15:"Webinar",16:"LocalMediaHandler",17:"End-End Encryption",18:"AI",19:"Livestream",20:"Stage"},Pc={"0000":"Internal exception.","0001":"Failed to initialize.","0002":"Failed to join room.","0003":"Failed to leave room.","0004":"Invalid auth token","0010":"Browser not supported","0011":"HTTP Network Error","0012":"Websocket Network Error","0013":"Rate Limited","0100":"Internal exception","0101":"Permission denied","0102":"Prerequisite module missing","0200":"Internal exception.","0300":"Internal exception","0400":"Internal exception","0404":"Missing prerequisites to establish a websocket connection","0500":"Internal exception","0501":"Permission denied.","0502":"Invalid message body.","0503":"Text Message is too large","0504":"Message not found by the given id","0505":"Action not permitted without joining room","0506":"Message search is disabled","0510":"Invalid channel name.","0600":"Internal exception","0601":"Permission denied.","0602":"Auth token not set for plugin","0603":"Iframe was not provided","0700":"Internal exception","0705":"Action not permitted without joining room","0800":"Internal exception","0801":"Permission denied","0900":"Internal exception","0904":"Could not load preset",1e3:"Internal exception",1001:"Permission denied",1004:"Could not find specified recording",1005:"Action not permitted in given recording state",1100:"Internal exception",1101:"Permission denied",1102:"Unsupported",1103:"Name cannot be empty",1104:"No device selected while calling meeting.self.setDevice",1105:"Action not permitted without joining room",1106:"Can't set currently used device",1200:"Internal exception",1201:"Permission denied",1202:"Invalid page number was requested",1203:"Invalid participant count per page was requested",1204:"No participants exists with the given UserIds",1205:"Action not permitted without joining room",1206:"Manual Subscription Mode was not ACTIVATED",1207:"Invalid view mode",1208:"Manual Subscription not enabled for organization",1209:"Broadcast message type must be a non-empty string",1300:"Internal exception",1400:"Internal exception",1402:"No existing remote requests",1403:"No peer exists with given id",1500:"Internal exception",1600:"Internal exception",1601:"Failed to get audio track",1602:"Failed to get video track",1603:"Incorrect device",1604:"Failed to change device",1605:"Failed to get audio & video track",1606:"No audio input devices are available",1607:"No video input devices are available",1608:"No audio output devices (speakers) are available",1609:"Failed to fetch list of media devices",1610:"No media track exists",1611:"Failed to unmute track",1612:"Failed to get screenshare tracks",1701:"Crypto error",1800:"Internal exception",1801:"Can't fetch transcript file",1900:"Internal exception",1901:"Permission denied.",1902:"Livestream that has not yet started, can't be stopped",2e3:"Internal exception",2001:"Permission denied",2002:"Unsupported",2003:"Stage is disabled",2004:"Method not implemented",2005:"Action not permitted without joining room",2006:"Action not permitted in current stage status",9900:"Internal exception"};Object.keys(Pc).forEach(r=>{Pc[r]=`{${fP[r.slice(0,2)]}} ${Pc[r]}`});class I extends Error{constructor(e,s,n=!1){super(e);m(this,"code");this.code=s,this.name="DyteError",this.message=`[ERR${this.code}]: ${Pc[this.code]}
${this.message}`;try{let i=n;s&&s.endsWith("00")&&(i=!0),i&&u.error("DyteError",{error:{message:this.message,name:this.name,code:s}});const a=rn.getContext(rn.getMostRecentPeerId());if(a){const o=a.getValue("onError");try{o(this)}catch(c){}}}catch(i){}}}function kc(r,t,e,s){if(s instanceof I)throw s;if(s instanceof t){const n=new I(s.message,e);throw n.stack=s.stack,n}else throw s}function Yf(r,t,e){if(!r.value){const n=r.get,i=r.set;return n&&(r.get=function(){try{return n.apply(this)}catch(a){kc(this,t,e,a)}}),i&&(r.set=function(a){try{return i.apply(this,[a])}catch(o){kc(this,t,e,o)}}),r}const s=r.value;return r.value=function(...n){try{const i=s.apply(this,n);return i&&i instanceof Promise?i.catch(a=>{kc(this,t,e,a)}):i}catch(i){kc(this,t,e,i)}},r}function gP(r,t){return(e,s,n)=>{if(n)return Yf(n,r,t);for(const i of Reflect.ownKeys(e.prototype).filter(a=>a!=="constructor")){const a=Object.getOwnPropertyDescriptor(e.prototype,i);(a.value instanceof Function||a.get instanceof Function||a.set instanceof Function)&&Object.defineProperty(e.prototype,i,Yf(a,r,t))}}}const mt=r=>gP(Error,r);function vP(r){let t=0,e,s;if(!r)return t;for(e=0;e<r.length;e+=1)s=r.charCodeAt(e),t=(t<<5)-t+s,t|=0;return Math.abs(t)%100+1}class yP extends ne.EventEmitter{constructor(){super();E(this,Xr,void 0);E(this,Zr,void 0);m(this,"asyncPromiseTimeout");y(this,Xr,new Map),y(this,Zr,new Map),this.asyncPromiseTimeout=8e3}async emitAsync(e,...s){d(this,Xr).set(e,[]);const n=d(this,Zr).get(e).map(()=>new Promise(i=>{d(this,Xr).get(e).push(i)}));super.emit(e,...s),await Promise.race([Promise.all(n),new Promise((i,a)=>setTimeout(()=>a(new Error(`emitAsync failed to resolve for event ${e}.`)),this.asyncPromiseTimeout))]),d(this,Xr).delete(e)}onAsync(e,s){const n=d(this,Xr),i=async(...a)=>{var c;try{await s(...a)}catch(l){u.error("[onAsync]",{error:l})}const o=(c=n.get(e))==null?void 0:c.shift();o==null||o()};return d(this,Zr).get(e)||d(this,Zr).set(e,[]),d(this,Zr).get(e).push(i),super.on(e,i)}reset(){y(this,Xr,new Map),y(this,Zr,new Map),super.removeAllListeners()}}Xr=new WeakMap,Zr=new WeakMap;const P=new yP;function TP(){Re.isElectron()&&window.dyteElectronGetDisplayMediaSource&&(navigator.mediaDevices.getDisplayMedia=async()=>{const r=await window.dyteElectronGetDisplayMediaSource({types:["window","screen"]});let t=[];if(r&&(Array.isArray(r)?t=r:t=[r]),!(t!=null&&t.length))throw new Error("Couldn't find any media source for screen share.");let e=t.find(i=>{var a;return(a=i.id)==null?void 0:a.includes("screen")});e=e!=null?e:t[0];const s={audio:!1,video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:e.id}}};return await navigator.mediaDevices.getUserMedia(s)})}var k=(r=>(r.NEW_PRODUCER="NEW_PRODUCER",r.PRODUCER_TRACK_ENDED="PRODUCER_TRACK_ENDED",r.ROOM_NODE_CONNECTION_ERROR="ROOM_NODE_CONNECTION_ERROR",r.SOCKET_SERVICE_ROOM_JOINED="SOCKET_SERVICE_ROOM_JOINED",r.SOCKET_SERVICE_RECONNECTED="SOCKET_SERVICE_RECONNECTED",r.SOCKET_SERVICE_DISCONNECTED="SOCKET_SERVICE_DISCONNECTED",r.SOCKET_SERVICE_FAILED="SOCKET_SERVICE_FAILED",r.SOCKET_STATE_UPDATE="SOCKET_STATE_UPDATE",r.ROOM_NODE_RECONNECTED="ROOM_NODE_RECONNECTED",r.ROOM_NODE_DISCONNECTED="ROOM_NODE_DISCONNECTED",r.ROOM_NODE_FAILED="ROOM_NODE_FAILED",r.TRANSPORT_STATE_UPDATE="TRANSPORT_STATE_UPDATE",r.PRODUCER_SCORE_UPDATE="PRODUCER_SCORE_UPDATE",r.CONSUMER_SCORE_UPDATE="CONSUMER_SCORE_UPDATE",r.PRODUCER_STATUS_UPDATE="PRODUCER_STATUS_UPDATE",r.CONSUMER_STATUS_UPDATE="CONSUMER_STATUS_UPDATE",r.LOW_PRODUCER_SCORE="LOW_PRODUCER_SCORE",r.LOW_CONSUMER_SCORE="LOW_CONSUMER_SCORE",r.MEDIA_PERMISSION_ERROR="MEDIA_PERMISSION_ERROR",r.MEDIA_PERMISSION_UPDATE="MEDIA_PERMISSION_UPDATE",r.WAITLISTED="WAIT_LISTED",r.MESSAGE="websocket/message",r.ROOM_MESSAGE="websocket/room-message",r.PEER_JOINED_INTERNAL="peer/joined-internal",r.PEER_CLOSED="websocket/peer-closed",r.CONSUMER_CLOSED="websocket/consumer-closed",r.CONSUMER_PAUSED="websocket/consumer-paused",r.CONSUMER_RESUMED="websocket/consumer-resumed",r.PRODUCER_CLOSED="websocket/producer-closed",r.NEW_CONSUMER="websocket/new-consumer",r.PRODUCER_SCORE="websocket/producer-score",r.CONSUMER_SCORE="websocket/consumer-score",r.PRODUCER_TOGGLE="hive/producer-toggle",r.CONSUMER_TOGGLE="hive/consumer-toggle",r.SELECTED_PEERS_DIFF="hive/selected-peers-diff",r.UPDATE_ACTIVE="media/update-active",r.RESET_PRODUCER_STATE="hive/reset-producer-state",r.CF_TRANSPORT_STATE_CHANGED="cf/transport-state-changed",r.CF_ROOM_REJOINING="cf/room-rejoining",r.CF_ROOM_REJOIN_FAILED="cf/room-rejoining-failed",r.CF_ROOM_REJOINED="cf/room-rejoined",r.CF_TRANPSORT_RECONNECTING="cf/transport-reconnecting",r.ROOM_STATE="sockethub/room-state",r.PEER_DISPLAY_NAME_CHANGED="hive/display-name-changed",r.GET_STAGE_REQUESTS="GET_STAGE_REQUESTS",r.UPDATE_STAGE_REQUESTS="UPDATE_STAGE_REQUESTS",r.KICK_PEER="KICK_PEER",r.UPDATE_PEER_STAGE_STATUS="UPDATE_PEER_STAGE_STATUS",r.JOIN_MEDIA_ROOM="JOIN_MEDIA_ROOM",r.LEAVE_MEDIA_ROOM="LEAVE_MEDIA_ROOM",r.PIP_HANGUP="PIP_HANGUP",r.E2EE_ACTIVE_PRODUCER="E2EE_ACTIVE_PRODUCER",r.E2EE_INACTIVE_PRODUCER="E2EE_INACTIVE_PRODUCER",r.E2EE_ACTIVE_CONSUMER="E2EE_ACTIVE_CONSUMER",r.E2EE_INACTIVE_CONSUMER="E2EE_INACTIVE_CONSUMER",r.SOCKET_PEERS="SOCKET_PEERS",r.UPDATE_PERMISSIONS="UPDATE_PERMISSIONS",r.MAX_SPATIAL_LAYER_CHANGE="MAX_SPATIAL_LAYER_CHANGE",r.MUTE_SELF="MUTE_SELF",r.MUTE_SELF_VIDEO="MUTE_SELF_VIDEO",r))(k||{});class si extends ne.EventEmitter{constructor(){super(),super.setMaxListeners(25)}emit(t,...e){return super.emit("*",t,...e),super.emit(t,...e)}on(t,e){try{const s=this.listenerCount(t);s>25&&s%25===0&&u.warn("DyteEventEmitter::maxListenersExceeded",{eventListener:{eventName:t.toString(),listenerCount:this.listenerCount(t)}})}catch(s){}return super.on(t,e)}addListener(t,e){try{const s=this.listenerCount(t);s>25&&s%25===0&&u.warn("DyteEventEmitter::maxListenersExceeded",{eventListener:{eventName:t.toString(),listenerCount:this.listenerCount(t)}})}catch(s){}return super.addListener(t,e)}off(t,e){return super.off(t,e)}once(t,e){return super.once(t,e)}prependListener(t,e){return super.prependListener(t,e)}prependOnceListener(t,e){return super.prependOnceListener(t,e)}removeListener(t,e){return super.removeListener(t,e)}removeAllListeners(t){return super.removeAllListeners(t)}listeners(t){return super.listeners(t)}listenerCount(t){return super.listenerCount(t)}}class qt extends ne.EventEmitter{constructor(){super(),super.setMaxListeners(25)}emit(t,...e){return super.emit("*",t,...e),super.emit(t,...e)}on(t,e){try{const s=this.listenerCount(t);s>25&&s%25===0&&u.warn("DyteEventEmitter::maxListenersExceeded",{eventListener:{eventName:t.toString(),listenerCount:this.listenerCount(t)}})}catch(s){}return super.on(t,e)}addListener(t,e){try{const s=this.listenerCount(t);s>25&&s%25===0&&u.warn("DyteEventEmitter::maxListenersExceeded",{eventListener:{eventName:t.toString(),listenerCount:this.listenerCount(t)}})}catch(s){}return super.addListener(t,e)}off(t,e){return super.off(t,e)}once(t,e){return super.once(t,e)}prependListener(t,e){return super.prependListener(t,e)}prependOnceListener(t,e){return super.prependOnceListener(t,e)}removeListener(t,e){return super.removeListener(t,e)}removeAllListeners(t){return super.removeAllListeners(t)}listeners(t){return super.listeners(t)}listenerCount(t){return super.listenerCount(t)}}function SP(r,t=2){return r.replace(/[^\u00BF-\u1FFF\u2C00-\uD7FF\w\s]/g,"").trim().split(/\s+/).slice(0,t).map(n=>n.charAt(0)).join("").toUpperCase()}const Qf=1080,Xf=1920,EP=(r,t,e,s,n,i)=>{let a=.5,o=.5;const c=n,l=i,p=Math.min(e/c,s/l);let h=c*p,f=l*p,g,_,w,R,D=1;return h<e&&(D=e/h),Math.abs(D-1)<1e-14&&f<s&&(D=s/f),h*=D,f*=D,w=c/(h/e),R=l/(f/s),g=(c-w)*a,_=(l-R)*o,g<0&&(g=0),_<0&&(_=0),w>c&&(w=c),R>l&&(R=l),[g,_,w,R,r,t,e,s]},_h=class extends qt{constructor(e,s,n,i){super();E(this,er,void 0);E(this,vi,void 0);E(this,yt,void 0);E(this,tr,void 0);E(this,Be,{height:Qf,width:Xf});E(this,Tr,{brand:"#2160FD",background:"#141414",text:"#000000",videoBackground:"#191919",textOnBrand:"#EEEEEE"});E(this,es,void 0);E(this,At,{});E(this,Xe,void 0);E(this,yi,void 0);E(this,Ti,void 0);E(this,ts,void 0);E(this,Si,!1);m(this,"cleanupEventListeners",()=>{d(this,vi).unsubscribe("stageStatus",this.handlePipMediaControls),d(this,Xe).removeListener("videoUpdate",this.onSelfVideoUpdateListener),d(this,Xe).removeListener("audioUpdate",this.onSelfAudioUpdateListener),d(this,Xe).removeListener("roomLeft",()=>this.disable())});m(this,"enablePipMediaControls",()=>{this.mountAudioEvents(),this.mountVideoEvents()});m(this,"onSelfVideoUpdateListener",({videoEnabled:e})=>{this.updateMediaSession("CAMERA",e)});m(this,"onSelfAudioUpdateListener",({audioEnabled:e})=>{this.updateMediaSession("MIC",e)});m(this,"handlePipMediaControls",e=>{e==="ON_STAGE"?this.enablePipMediaControls():this.unmountEvents()});m(this,"eventCallback",e=>{e==="CAMERA"&&(d(this,Xe).videoEnabled?d(this,Xe).disableVideo():d(this,Xe).enableVideo(),this.emit("cameraToggled")),e==="MIC"&&(d(this,Xe).audioEnabled?d(this,Xe).disableAudio():d(this,Xe).enableAudio(),this.emit("micToggled")),e==="END"&&(P.emit(k.PIP_HANGUP),this.cleanupEventListeners(),this.emit("hangup"),this.cleanup())});m(this,"unmountEvents",()=>{navigator.mediaSession===void 0||navigator.mediaSession.setCameraActive===void 0||(navigator.mediaSession.setActionHandler("togglemicrophone",void 0),navigator.mediaSession.setActionHandler("togglecamera",void 0))});m(this,"animate",()=>{if(!this.isActive&&d(this,ts)==="active"){this.disable(!0);return}d(this,At)!==void 0&&this.paintCanvas(),d(this,es)!==void 0&&y(this,es,requestAnimationFrame(()=>this.animate()))});m(this,"disable",(e=!1)=>{y(this,ts,"idle"),this.cleanupEventListeners(),cancelAnimationFrame(d(this,es)),e!==!0&&document.body.removeChild(d(this,yt)),y(this,es,void 0),document.pictureInPictureElement&&document.exitPictureInPicture()});y(this,vi,e),y(this,ts,"idle"),y(this,Xe,s),y(this,Tr,{brand:s.config.designTokens.colors.brand[500],background:s.config.designTokens.colors.background[1e3],text:s.config.designTokens.colors.text,videoBackground:s.config.designTokens.colors.videoBg,textOnBrand:s.config.designTokens.colors.textOnBrand}),n&&this.setupIcon("pin",n),i&&this.setupIcon("handRaise",i)}static async _init(e,s){let n,i;try{n=await Rc(lP),i=await Rc(uP)}catch(a){}return new _h(e,s,n,i)}async setupIcon(e,s){switch(e){case"handRaise":y(this,Ti,s);break;case"pin":y(this,yi,s);break}}async overrideIcon(e,s){switch(e){case"handRaise":y(this,Ti,await Rc(s));break;case"pin":y(this,yi,await Rc(s));break}}constructImage(e){const s=new Image,n=new Blob([e],{type:"image/svg+xml"}),i=window.URL.createObjectURL(n);return new Promise(a=>{s.onload=()=>{a(s),window.URL.revokeObjectURL(i)},s.src=i})}createVideoContainer(){y(this,yt,document.createElement("div")),d(this,yt).style.width="0.1px",d(this,yt).style.height="0.1px",d(this,yt).style.overflow="hidden",d(this,yt).style.position="absolute",d(this,yt).style.bottom="0",d(this,yt).style.right="0",d(this,yt).style.opacity="0",d(this,yt).appendChild(d(this,tr))}setupEventListeners(){d(this,vi).subscribe("stageStatus",this.handlePipMediaControls),d(this,Xe).addListener("videoUpdate",this.onSelfVideoUpdateListener),d(this,Xe).addListener("audioUpdate",this.onSelfAudioUpdateListener),d(this,Xe).addListener("roomLeft",()=>this.disable())}createCanvas(){const e=document.createElement("canvas");e.height=d(this,Be).height,e.width=d(this,Be).width,y(this,er,e)}setupMediaSessionEvents(){navigator.mediaSession===void 0||navigator.mediaSession.setCameraActive===void 0||(navigator.mediaSession.setActionHandler("hangup",()=>{this.eventCallback("END")}),this.mountAudioEvents(),this.mountVideoEvents())}mountAudioEvents(){navigator.mediaSession===void 0||navigator.mediaSession.setMicrophoneActive===void 0||d(this,Xe).permissions.canProduceAudio&&navigator.mediaSession.setActionHandler("togglemicrophone",()=>{this.eventCallback("MIC")})}mountVideoEvents(){navigator.mediaSession===void 0||navigator.mediaSession.setCameraActive===void 0||d(this,Xe).permissions.canProduceVideo&&navigator.mediaSession.setActionHandler("togglecamera",()=>{this.eventCallback("CAMERA")})}getSources(){const s=Object.values(d(this,At)).reduce((n,i)=>(n[i.pinned?"pinned":"regular"].push(i),n),{pinned:[],regular:[]});return[...s.pinned,...s.regular]}drawEmptyTile(e,s,n,i){if(d(this,er)===void 0)return;const a=d(this,er).getContext("2d"),o=d(this,er).width,c=0,l=0,p=s-c*2,h=n-c*2,f=Math.floor(o/p),g=Math.floor(e/f),w=e%f*(p+c)+c,R=g*(h+c)+c,{displayText:D,image:x}=i!=null?i:{};a.fillStyle=D||x?d(this,Tr).videoBackground:d(this,Tr).background,a.strokeStyle=d(this,Tr).brand,a.beginPath(),a.moveTo(w+l,R),a.arcTo(w+p,R,w+p,R+l,l),a.arcTo(w+p,R+h,w+p-l,R+h,l),a.arcTo(w,R+h,w,R+h-l,l),a.arcTo(w,R,w+l,R,l),a.closePath(),a.fill(),a.stroke();const B=p/6,b=p/2+w,Q=h/2+R;a.save(),(D||x)&&(a.beginPath(),a.arc(b,Q,B,0,Math.PI*2),a.fillStyle=d(this,Tr).brand,a.fill(),x?(a.clip(),a.drawImage(x,b-B,Q-B,B*2,B*2),a.restore()):D&&(a.fillStyle=d(this,Tr).textOnBrand,a.font=`${B/2}px sans-serif`,a.textAlign="center",a.textBaseline="middle",a.fillText(D,b,Q)),this.drawIcons(i,w,R,Math.max(p,h)))}drawIcons(e,s,n,i){const a=Math.min(Math.max(i*.15,100),200),o=a*.2,c=a*.2;let l=s+o;const p=n+o,h=f=>{const g=d(this,er).getContext("2d");g.save(),g.fillStyle=d(this,Tr).background,g.beginPath(),g.moveTo(l+c,p),g.arcTo(l+a,p,l+a,p+c,c),g.arcTo(l+a,p+a,l+a-c,p+a,c),g.arcTo(l,p+a,l,p+a-c,c),g.arcTo(l,p,l+c,p,c),g.closePath(),g.fill(),typeof f=="string"?(g.font=`${a/1.5}px sans-serif`,g.fillStyle=d(this,Tr).text,g.textAlign="center",g.textBaseline="top",g.fillText(f,a/2+l,p+o)):g.drawImage(f,l+o,p+o,a-o*2,a-o*2),l+=a+o,g.restore()};e.pinned&&h(d(this,yi)),e.handRaised&&h(d(this,Ti))}drawTile(e,s,n){var l,p;if(d(this,er)===void 0)return;const i=d(this,er).getContext("2d"),a=this.getSources();let o=0,c=0;for(;o<d(this,Be).height-5;){let h=0;for(;h<d(this,Be).width-5&&c<n;){if((l=a[c])!=null&&l.enabled){const f=a[c].element,[g,_,w,R,D,x,B,b]=EP(h,o,e,s,f.videoWidth,f.videoHeight);((p=f==null?void 0:f.classList)==null?void 0:p.contains("mirror"))?(i.save(),i.scale(-1,1),i.drawImage(f,g,_,w,R,-1*D,x,-1*B,b),i.restore()):i.drawImage(f,g,_,w,R,D,x,B,b),this.drawIcons(a[c],D,x,Math.max(B,b))}else this.drawEmptyTile(c,e,s,a[c]);c+=1,h+=e}o+=s}}calcGridElemSize(e){switch(e){case 0:case 1:return[d(this,Be).width,d(this,Be).height];case 2:return[Math.floor(d(this,Be).width/2),d(this,Be).height];case 3:case 4:return[Math.floor(d(this,Be).width/2),Math.floor(d(this,Be).height/2)];case 5:case 6:return[Math.floor(d(this,Be).width/3),Math.floor(d(this,Be).height/2)];case 7:case 8:case 9:return[Math.floor(d(this,Be).width/3),Math.floor(d(this,Be).height/3)];default:return[Math.floor(d(this,Be).width/3),Math.floor(d(this,Be).height/2)]}}paintCanvas(){let e=this.getSources().length;e!==1&&(e=e%2>0?e+1:e);const[s,n]=this.calcGridElemSize(e);this.drawTile(s,n,e)}isSupported(){return!!window.chrome&&document.pictureInPictureEnabled}get isActive(){return document.pictureInPictureElement!==null}cleanup(){if(y(this,Si,!1),this.isSupported()&&document.exitPictureInPicture!==void 0&&document.pictureInPictureElement!==null&&document.exitPictureInPicture(),d(this,yt))try{document.body.removeChild(d(this,yt))}catch(e){}this.removeAllSources(),y(this,er,void 0),y(this,tr,void 0),y(this,es,void 0)}init({height:e,width:s}={}){if(d(this,Si))return;y(this,Si,!0),this.createCanvas(),this.setupMediaSessionEvents();const n=document.createElement("video");y(this,Be,{height:e!=null?e:Qf,width:s!=null?s:Xf}),n.height=d(this,Be).height,n.width=d(this,Be).width,n.autoplay=!0,n.muted=!0,n.srcObject=d(this,er).captureStream(24),y(this,tr,n),d(this,tr).onloadedmetadata=()=>{try{this.emit("pipStarted"),d(this,tr).onleavepictureinpicture=()=>{this.emit("pipEnded")}}catch(i){this.emit("pipEnded")}},this.createVideoContainer(),this.paintCanvas()}updateMediaSession(e,s){navigator.mediaSession!==void 0&&(e==="CAMERA"&&navigator.mediaSession.setCameraActive!==void 0&&navigator.mediaSession.setCameraActive(s),e==="MIC"&&navigator.mediaSession.setMicrophoneActive!==void 0&&navigator.mediaSession.setMicrophoneActive(s))}enableSource(e){d(this,At)[e]!==void 0&&(d(this,At)[e].enabled=!0)}disableSource(e){d(this,At)[e]!==void 0&&(d(this,At)[e].enabled=!1)}async generateAvatar(e,s){if(!s)return;const n=new Image;try{const i=await(await fetch(s)).blob(),a=window.URL.createObjectURL(i);n.onload=()=>{this.updateSource(e,{image:n}),window.URL.revokeObjectURL(a)},n.src=a}catch(i){u.error("DytePip::GenerateAvatar",{error:i})}}addSource(e,s,n,i=!1,a=void 0,o=void 0,c=!1){u.debug("DytePIP::AddSource",{pip:{id:e,handRaised:c}}),d(this,At)[e]={id:e,element:s,enabled:n,pinned:i,displayText:a?SP(a):void 0,imageUrl:o,handRaised:c},o&&this.generateAvatar(e,o)}updateSource(e,s){u.info("DytePIP::UpdateSource",{pip:{id:e,handRaised:s.handRaised}});const n=d(this,At)[e];n&&(d(this,At)[e]={...n,...s})}removeSource(e){delete d(this,At)[e]}removePinnedSource(){Object.values(d(this,At)).forEach(s=>{s.pinned&&this.removeSource(s.id)})}removeAllSources(){y(this,At,{})}enable(){y(this,ts,"activating"),this.setupEventListeners(),this.updateMediaSession("CAMERA",d(this,Xe).videoEnabled),this.updateMediaSession("MIC",d(this,Xe).audioEnabled),document.body.appendChild(d(this,yt)),y(this,es,requestAnimationFrame(()=>this.animate())),d(this,tr).onloadedmetadata=()=>{d(this,tr).requestPictureInPicture().then(()=>{y(this,ts,"active")})},d(this,tr).readyState===4&&d(this,tr).requestPictureInPicture().then(()=>{y(this,ts,"active")})}};let fu=_h;er=new WeakMap,vi=new WeakMap,yt=new WeakMap,tr=new WeakMap,Be=new WeakMap,Tr=new WeakMap,es=new WeakMap,At=new WeakMap,Xe=new WeakMap,yi=new WeakMap,Ti=new WeakMap,ts=new WeakMap,Si=new WeakMap;function gu(r){let t=typeof r;if(t=="object"){if(Array.isArray(r))return"array";if(r===null)return"null"}return t}function _P(r){return r!==null&&typeof r=="object"&&!Array.isArray(r)}let Hr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split(""),Ic=[];for(let r=0;r<Hr.length;r++)Ic[Hr[r].charCodeAt(0)]=r;Ic["-".charCodeAt(0)]=Hr.indexOf("+"),Ic["_".charCodeAt(0)]=Hr.indexOf("/");function wP(r){let t=r.length*3/4;r[r.length-2]=="="?t-=2:r[r.length-1]=="="&&(t-=1);let e=new Uint8Array(t),s=0,n=0,i,a=0;for(let o=0;o<r.length;o++){if(i=Ic[r.charCodeAt(o)],i===void 0)switch(r[o]){case"=":n=0;case`
`:case"\r":case"	":case" ":continue;default:throw Error("invalid base64 string.")}switch(n){case 0:a=i,n=1;break;case 1:e[s++]=a<<2|(i&48)>>4,a=i,n=2;break;case 2:e[s++]=(a&15)<<4|(i&60)>>2,a=i,n=3;break;case 3:e[s++]=(a&3)<<6|i,n=0;break}}if(n==1)throw Error("invalid base64 string.");return e.subarray(0,s)}function bP(r){let t="",e=0,s,n=0;for(let i=0;i<r.length;i++)switch(s=r[i],e){case 0:t+=Hr[s>>2],n=(s&3)<<4,e=1;break;case 1:t+=Hr[n|s>>4],n=(s&15)<<2,e=2;break;case 2:t+=Hr[n|s>>6],t+=Hr[s&63],e=0;break}return e&&(t+=Hr[n],t+="=",e==1&&(t+="=")),t}var Ac;(function(r){r.symbol=Symbol.for("protobuf-ts/unknown"),r.onRead=(e,s,n,i,a)=>{(t(s)?s[r.symbol]:s[r.symbol]=[]).push({no:n,wireType:i,data:a})},r.onWrite=(e,s,n)=>{for(let{no:i,wireType:a,data:o}of r.list(s))n.tag(i,a).raw(o)},r.list=(e,s)=>{if(t(e)){let n=e[r.symbol];return s?n.filter(i=>i.no==s):n}return[]},r.last=(e,s)=>r.list(e,s).slice(-1)[0];const t=e=>e&&Array.isArray(e[r.symbol])})(Ac||(Ac={}));var Ge;(function(r){r[r.Varint=0]="Varint",r[r.Bit64=1]="Bit64",r[r.LengthDelimited=2]="LengthDelimited",r[r.StartGroup=3]="StartGroup",r[r.EndGroup=4]="EndGroup",r[r.Bit32=5]="Bit32"})(Ge||(Ge={}));function CP(){let r=0,t=0;for(let s=0;s<28;s+=7){let n=this.buf[this.pos++];if(r|=(n&127)<<s,!(n&128))return this.assertBounds(),[r,t]}let e=this.buf[this.pos++];if(r|=(e&15)<<28,t=(e&112)>>4,!(e&128))return this.assertBounds(),[r,t];for(let s=3;s<=31;s+=7){let n=this.buf[this.pos++];if(t|=(n&127)<<s,!(n&128))return this.assertBounds(),[r,t]}throw new Error("invalid varint")}function vu(r,t,e){for(let i=0;i<28;i=i+7){const a=r>>>i,o=!(!(a>>>7)&&t==0),c=(o?a|128:a)&255;if(e.push(c),!o)return}const s=r>>>28&15|(t&7)<<4,n=!!(t>>3);if(e.push((n?s|128:s)&255),!!n){for(let i=3;i<31;i=i+7){const a=t>>>i,o=!!(a>>>7),c=(o?a|128:a)&255;if(e.push(c),!o)return}e.push(t>>>31&1)}}const Mc=(1<<16)*(1<<16);function Zf(r){let t=r[0]=="-";t&&(r=r.slice(1));const e=1e6;let s=0,n=0;function i(a,o){const c=Number(r.slice(a,o));n*=e,s=s*e+c,s>=Mc&&(n=n+(s/Mc|0),s=s%Mc)}return i(-24,-18),i(-18,-12),i(-12,-6),i(-6),[t,s,n]}function yu(r,t){if(t>>>0<=2097151)return""+(Mc*t+(r>>>0));let e=r&16777215,s=(r>>>24|t<<8)>>>0&16777215,n=t>>16&65535,i=e+s*6777216+n*6710656,a=s+n*8147497,o=n*2,c=1e7;i>=c&&(a+=Math.floor(i/c),i%=c),a>=c&&(o+=Math.floor(a/c),a%=c);function l(p,h){let f=p?String(p):"";return h?"0000000".slice(f.length)+f:f}return l(o,0)+l(a,o)+l(i,1)}function eg(r,t){if(r>=0){for(;r>127;)t.push(r&127|128),r=r>>>7;t.push(r)}else{for(let e=0;e<9;e++)t.push(r&127|128),r=r>>7;t.push(1)}}function RP(){let r=this.buf[this.pos++],t=r&127;if(!(r&128))return this.assertBounds(),t;if(r=this.buf[this.pos++],t|=(r&127)<<7,!(r&128))return this.assertBounds(),t;if(r=this.buf[this.pos++],t|=(r&127)<<14,!(r&128))return this.assertBounds(),t;if(r=this.buf[this.pos++],t|=(r&127)<<21,!(r&128))return this.assertBounds(),t;r=this.buf[this.pos++],t|=(r&15)<<28;for(let e=5;r&128&&e<10;e++)r=this.buf[this.pos++];if(r&128)throw new Error("invalid varint");return this.assertBounds(),t>>>0}let ye;function PP(){const r=new DataView(new ArrayBuffer(8));ye=globalThis.BigInt!==void 0&&typeof r.getBigInt64=="function"&&typeof r.getBigUint64=="function"&&typeof r.setBigInt64=="function"&&typeof r.setBigUint64=="function"?{MIN:BigInt("-9223372036854775808"),MAX:BigInt("9223372036854775807"),UMIN:BigInt("0"),UMAX:BigInt("18446744073709551615"),C:BigInt,V:r}:void 0}PP();function tg(r){if(!r)throw new Error("BigInt unavailable, see https://github.com/timostamm/protobuf-ts/blob/v1.0.8/MANUAL.md#bigint-support")}const rg=/^-?[0-9]+$/,Dc=4294967296,Oc=2147483648;class sg{constructor(t,e){this.lo=t|0,this.hi=e|0}isZero(){return this.lo==0&&this.hi==0}toNumber(){let t=this.hi*Dc+(this.lo>>>0);if(!Number.isSafeInteger(t))throw new Error("cannot convert to safe number");return t}}class ft extends sg{static from(t){if(ye)switch(typeof t){case"string":if(t=="0")return this.ZERO;if(t=="")throw new Error("string is no integer");t=ye.C(t);case"number":if(t===0)return this.ZERO;t=ye.C(t);case"bigint":if(!t)return this.ZERO;if(t<ye.UMIN)throw new Error("signed value for ulong");if(t>ye.UMAX)throw new Error("ulong too large");return ye.V.setBigUint64(0,t,!0),new ft(ye.V.getInt32(0,!0),ye.V.getInt32(4,!0))}else switch(typeof t){case"string":if(t=="0")return this.ZERO;if(t=t.trim(),!rg.test(t))throw new Error("string is no integer");let[e,s,n]=Zf(t);if(e)throw new Error("signed value for ulong");return new ft(s,n);case"number":if(t==0)return this.ZERO;if(!Number.isSafeInteger(t))throw new Error("number is no integer");if(t<0)throw new Error("signed value for ulong");return new ft(t,t/Dc)}throw new Error("unknown value "+typeof t)}toString(){return ye?this.toBigInt().toString():yu(this.lo,this.hi)}toBigInt(){return tg(ye),ye.V.setInt32(0,this.lo,!0),ye.V.setInt32(4,this.hi,!0),ye.V.getBigUint64(0,!0)}}ft.ZERO=new ft(0,0);class we extends sg{static from(t){if(ye)switch(typeof t){case"string":if(t=="0")return this.ZERO;if(t=="")throw new Error("string is no integer");t=ye.C(t);case"number":if(t===0)return this.ZERO;t=ye.C(t);case"bigint":if(!t)return this.ZERO;if(t<ye.MIN)throw new Error("signed long too small");if(t>ye.MAX)throw new Error("signed long too large");return ye.V.setBigInt64(0,t,!0),new we(ye.V.getInt32(0,!0),ye.V.getInt32(4,!0))}else switch(typeof t){case"string":if(t=="0")return this.ZERO;if(t=t.trim(),!rg.test(t))throw new Error("string is no integer");let[e,s,n]=Zf(t);if(e){if(n>Oc||n==Oc&&s!=0)throw new Error("signed long too small")}else if(n>=Oc)throw new Error("signed long too large");let i=new we(s,n);return e?i.negate():i;case"number":if(t==0)return this.ZERO;if(!Number.isSafeInteger(t))throw new Error("number is no integer");return t>0?new we(t,t/Dc):new we(-t,-t/Dc).negate()}throw new Error("unknown value "+typeof t)}isNegative(){return(this.hi&Oc)!==0}negate(){let t=~this.hi,e=this.lo;return e?e=~e+1:t+=1,new we(e,t)}toString(){if(ye)return this.toBigInt().toString();if(this.isNegative()){let t=this.negate();return"-"+yu(t.lo,t.hi)}return yu(this.lo,this.hi)}toBigInt(){return tg(ye),ye.V.setInt32(0,this.lo,!0),ye.V.setInt32(4,this.hi,!0),ye.V.getBigInt64(0,!0)}}we.ZERO=new we(0,0);const ng={readUnknownField:!0,readerFactory:r=>new IP(r)};function kP(r){return r?Object.assign(Object.assign({},ng),r):ng}class IP{constructor(t,e){this.varint64=CP,this.uint32=RP,this.buf=t,this.len=t.length,this.pos=0,this.view=new DataView(t.buffer,t.byteOffset,t.byteLength),this.textDecoder=e!=null?e:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0})}tag(){let t=this.uint32(),e=t>>>3,s=t&7;if(e<=0||s<0||s>5)throw new Error("illegal tag: field no "+e+" wire type "+s);return[e,s]}skip(t){let e=this.pos;switch(t){case Ge.Varint:for(;this.buf[this.pos++]&128;);break;case Ge.Bit64:this.pos+=4;case Ge.Bit32:this.pos+=4;break;case Ge.LengthDelimited:let s=this.uint32();this.pos+=s;break;case Ge.StartGroup:let n;for(;(n=this.tag()[1])!==Ge.EndGroup;)this.skip(n);break;default:throw new Error("cant skip wire type "+t)}return this.assertBounds(),this.buf.subarray(e,this.pos)}assertBounds(){if(this.pos>this.len)throw new RangeError("premature EOF")}int32(){return this.uint32()|0}sint32(){let t=this.uint32();return t>>>1^-(t&1)}int64(){return new we(...this.varint64())}uint64(){return new ft(...this.varint64())}sint64(){let[t,e]=this.varint64(),s=-(t&1);return t=(t>>>1|(e&1)<<31)^s,e=e>>>1^s,new we(t,e)}bool(){let[t,e]=this.varint64();return t!==0||e!==0}fixed32(){return this.view.getUint32((this.pos+=4)-4,!0)}sfixed32(){return this.view.getInt32((this.pos+=4)-4,!0)}fixed64(){return new ft(this.sfixed32(),this.sfixed32())}sfixed64(){return new we(this.sfixed32(),this.sfixed32())}float(){return this.view.getFloat32((this.pos+=4)-4,!0)}double(){return this.view.getFloat64((this.pos+=8)-8,!0)}bytes(){let t=this.uint32(),e=this.pos;return this.pos+=t,this.assertBounds(),this.buf.subarray(e,e+t)}string(){return this.textDecoder.decode(this.bytes())}}function ue(r,t){if(!r)throw new Error(t)}const AP=34028234663852886e22,MP=-34028234663852886e22,DP=4294967295,OP=2147483647,NP=-2147483648;function va(r){if(typeof r!="number")throw new Error("invalid int 32: "+typeof r);if(!Number.isInteger(r)||r>OP||r<NP)throw new Error("invalid int 32: "+r)}function Nc(r){if(typeof r!="number")throw new Error("invalid uint 32: "+typeof r);if(!Number.isInteger(r)||r>DP||r<0)throw new Error("invalid uint 32: "+r)}function Tu(r){if(typeof r!="number")throw new Error("invalid float 32: "+typeof r);if(Number.isFinite(r)&&(r>AP||r<MP))throw new Error("invalid float 32: "+r)}const ig={writeUnknownFields:!0,writerFactory:()=>new xP};function LP(r){return r?Object.assign(Object.assign({},ig),r):ig}class xP{constructor(t){this.stack=[],this.textEncoder=t!=null?t:new TextEncoder,this.chunks=[],this.buf=[]}finish(){this.chunks.push(new Uint8Array(this.buf));let t=0;for(let n=0;n<this.chunks.length;n++)t+=this.chunks[n].length;let e=new Uint8Array(t),s=0;for(let n=0;n<this.chunks.length;n++)e.set(this.chunks[n],s),s+=this.chunks[n].length;return this.chunks=[],e}fork(){return this.stack.push({chunks:this.chunks,buf:this.buf}),this.chunks=[],this.buf=[],this}join(){let t=this.finish(),e=this.stack.pop();if(!e)throw new Error("invalid state, fork stack empty");return this.chunks=e.chunks,this.buf=e.buf,this.uint32(t.byteLength),this.raw(t)}tag(t,e){return this.uint32((t<<3|e)>>>0)}raw(t){return this.buf.length&&(this.chunks.push(new Uint8Array(this.buf)),this.buf=[]),this.chunks.push(t),this}uint32(t){for(Nc(t);t>127;)this.buf.push(t&127|128),t=t>>>7;return this.buf.push(t),this}int32(t){return va(t),eg(t,this.buf),this}bool(t){return this.buf.push(t?1:0),this}bytes(t){return this.uint32(t.byteLength),this.raw(t)}string(t){let e=this.textEncoder.encode(t);return this.uint32(e.byteLength),this.raw(e)}float(t){Tu(t);let e=new Uint8Array(4);return new DataView(e.buffer).setFloat32(0,t,!0),this.raw(e)}double(t){let e=new Uint8Array(8);return new DataView(e.buffer).setFloat64(0,t,!0),this.raw(e)}fixed32(t){Nc(t);let e=new Uint8Array(4);return new DataView(e.buffer).setUint32(0,t,!0),this.raw(e)}sfixed32(t){va(t);let e=new Uint8Array(4);return new DataView(e.buffer).setInt32(0,t,!0),this.raw(e)}sint32(t){return va(t),t=(t<<1^t>>31)>>>0,eg(t,this.buf),this}sfixed64(t){let e=new Uint8Array(8),s=new DataView(e.buffer),n=we.from(t);return s.setInt32(0,n.lo,!0),s.setInt32(4,n.hi,!0),this.raw(e)}fixed64(t){let e=new Uint8Array(8),s=new DataView(e.buffer),n=ft.from(t);return s.setInt32(0,n.lo,!0),s.setInt32(4,n.hi,!0),this.raw(e)}int64(t){let e=we.from(t);return vu(e.lo,e.hi,this.buf),this}sint64(t){let e=we.from(t),s=e.hi>>31,n=e.lo<<1^s,i=(e.hi<<1|e.lo>>>31)^s;return vu(n,i,this.buf),this}uint64(t){let e=ft.from(t);return vu(e.lo,e.hi,this.buf),this}}const ag={emitDefaultValues:!1,enumAsInteger:!1,useProtoFieldName:!1,prettySpaces:0},og={ignoreUnknownFields:!1};function FP(r){return r?Object.assign(Object.assign({},og),r):og}function $P(r){return r?Object.assign(Object.assign({},ag),r):ag}const cg=Symbol.for("protobuf-ts/message-type");function dg(r){let t=!1;const e=[];for(let s=0;s<r.length;s++){let n=r.charAt(s);n=="_"?t=!0:/\d/.test(n)?(e.push(n),t=!0):t?(e.push(n.toUpperCase()),t=!1):s==0?e.push(n.toLowerCase()):e.push(n)}return e.join("")}var O;(function(r){r[r.DOUBLE=1]="DOUBLE",r[r.FLOAT=2]="FLOAT",r[r.INT64=3]="INT64",r[r.UINT64=4]="UINT64",r[r.INT32=5]="INT32",r[r.FIXED64=6]="FIXED64",r[r.FIXED32=7]="FIXED32",r[r.BOOL=8]="BOOL",r[r.STRING=9]="STRING",r[r.BYTES=12]="BYTES",r[r.UINT32=13]="UINT32",r[r.SFIXED32=15]="SFIXED32",r[r.SFIXED64=16]="SFIXED64",r[r.SINT32=17]="SINT32",r[r.SINT64=18]="SINT64"})(O||(O={}));var Pr;(function(r){r[r.BIGINT=0]="BIGINT",r[r.STRING=1]="STRING",r[r.NUMBER=2]="NUMBER"})(Pr||(Pr={}));var Lc;(function(r){r[r.NO=0]="NO",r[r.PACKED=1]="PACKED",r[r.UNPACKED=2]="UNPACKED"})(Lc||(Lc={}));function UP(r){var t,e,s,n;return r.localName=(t=r.localName)!==null&&t!==void 0?t:dg(r.name),r.jsonName=(e=r.jsonName)!==null&&e!==void 0?e:dg(r.name),r.repeat=(s=r.repeat)!==null&&s!==void 0?s:Lc.NO,r.opt=(n=r.opt)!==null&&n!==void 0?n:r.repeat||r.oneof?!1:r.kind=="message",r}function VP(r){if(typeof r!="object"||r===null||!r.hasOwnProperty("oneofKind"))return!1;switch(typeof r.oneofKind){case"string":return r[r.oneofKind]===void 0?!1:Object.keys(r).length==2;case"undefined":return Object.keys(r).length==1;default:return!1}}class BP{constructor(t){var e;this.fields=(e=t.fields)!==null&&e!==void 0?e:[]}prepare(){if(this.data)return;const t=[],e=[],s=[];for(let n of this.fields)if(n.oneof)s.includes(n.oneof)||(s.push(n.oneof),t.push(n.oneof),e.push(n.oneof));else switch(e.push(n.localName),n.kind){case"scalar":case"enum":(!n.opt||n.repeat)&&t.push(n.localName);break;case"message":n.repeat&&t.push(n.localName);break;case"map":t.push(n.localName);break}this.data={req:t,known:e,oneofs:Object.values(s)}}is(t,e,s=!1){if(e<0)return!0;if(t==null||typeof t!="object")return!1;this.prepare();let n=Object.keys(t),i=this.data;if(n.length<i.req.length||i.req.some(a=>!n.includes(a))||!s&&n.some(a=>!i.known.includes(a)))return!1;if(e<1)return!0;for(const a of i.oneofs){const o=t[a];if(!VP(o))return!1;if(o.oneofKind===void 0)continue;const c=this.fields.find(l=>l.localName===o.oneofKind);if(!c||!this.field(o[o.oneofKind],c,s,e))return!1}for(const a of this.fields)if(a.oneof===void 0&&!this.field(t[a.localName],a,s,e))return!1;return!0}field(t,e,s,n){let i=e.repeat;switch(e.kind){case"scalar":return t===void 0?e.opt:i?this.scalars(t,e.T,n,e.L):this.scalar(t,e.T,e.L);case"enum":return t===void 0?e.opt:i?this.scalars(t,O.INT32,n):this.scalar(t,O.INT32);case"message":return t===void 0?!0:i?this.messages(t,e.T(),s,n):this.message(t,e.T(),s,n);case"map":if(typeof t!="object"||t===null)return!1;if(n<2)return!0;if(!this.mapKeys(t,e.K,n))return!1;switch(e.V.kind){case"scalar":return this.scalars(Object.values(t),e.V.T,n,e.V.L);case"enum":return this.scalars(Object.values(t),O.INT32,n);case"message":return this.messages(Object.values(t),e.V.T(),s,n)}break}return!0}message(t,e,s,n){return s?e.isAssignable(t,n):e.is(t,n)}messages(t,e,s,n){if(!Array.isArray(t))return!1;if(n<2)return!0;if(s){for(let i=0;i<t.length&&i<n;i++)if(!e.isAssignable(t[i],n-1))return!1}else for(let i=0;i<t.length&&i<n;i++)if(!e.is(t[i],n-1))return!1;return!0}scalar(t,e,s){let n=typeof t;switch(e){case O.UINT64:case O.FIXED64:case O.INT64:case O.SFIXED64:case O.SINT64:switch(s){case Pr.BIGINT:return n=="bigint";case Pr.NUMBER:return n=="number"&&!isNaN(t);default:return n=="string"}case O.BOOL:return n=="boolean";case O.STRING:return n=="string";case O.BYTES:return t instanceof Uint8Array;case O.DOUBLE:case O.FLOAT:return n=="number"&&!isNaN(t);default:return n=="number"&&Number.isInteger(t)}}scalars(t,e,s,n){if(!Array.isArray(t))return!1;if(s<2)return!0;if(Array.isArray(t)){for(let i=0;i<t.length&&i<s;i++)if(!this.scalar(t[i],e,n))return!1}return!0}mapKeys(t,e,s){let n=Object.keys(t);switch(e){case O.INT32:case O.FIXED32:case O.SFIXED32:case O.SINT32:case O.UINT32:return this.scalars(n.slice(0,s).map(i=>parseInt(i)),e,s);case O.BOOL:return this.scalars(n.slice(0,s).map(i=>i=="true"?!0:i=="false"?!1:i),e,s);default:return this.scalars(n,e,s,Pr.STRING)}}}function ur(r,t){switch(t){case Pr.BIGINT:return r.toBigInt();case Pr.NUMBER:return r.toNumber();default:return r.toString()}}class HP{constructor(t){this.info=t}prepare(){var t;if(this.fMap===void 0){this.fMap={};const e=(t=this.info.fields)!==null&&t!==void 0?t:[];for(const s of e)this.fMap[s.name]=s,this.fMap[s.jsonName]=s,this.fMap[s.localName]=s}}assert(t,e,s){if(!t){let n=gu(s);throw(n=="number"||n=="boolean")&&(n=s.toString()),new Error(`Cannot parse JSON ${n} for ${this.info.typeName}#${e}`)}}read(t,e,s){this.prepare();const n=[];for(const[i,a]of Object.entries(t)){const o=this.fMap[i];if(!o){if(!s.ignoreUnknownFields)throw new Error(`Found unknown field while reading ${this.info.typeName} from JSON format. JSON key: ${i}`);continue}const c=o.localName;let l;if(o.oneof){if(a===null&&(o.kind!=="enum"||o.T()[0]!=="google.protobuf.NullValue"))continue;if(n.includes(o.oneof))throw new Error(`Multiple members of the oneof group "${o.oneof}" of ${this.info.typeName} are present in JSON.`);n.push(o.oneof),l=e[o.oneof]={oneofKind:c}}else l=e;if(o.kind=="map"){if(a===null)continue;this.assert(_P(a),o.name,a);const p=l[c];for(const[h,f]of Object.entries(a)){this.assert(f!==null,o.name+" map value",null);let g;switch(o.V.kind){case"message":g=o.V.T().internalJsonRead(f,s);break;case"enum":if(g=this.enum(o.V.T(),f,o.name,s.ignoreUnknownFields),g===!1)continue;break;case"scalar":g=this.scalar(f,o.V.T,o.V.L,o.name);break}this.assert(g!==void 0,o.name+" map value",f);let _=h;o.K==O.BOOL&&(_=_=="true"?!0:_=="false"?!1:_),_=this.scalar(_,o.K,Pr.STRING,o.name).toString(),p[_]=g}}else if(o.repeat){if(a===null)continue;this.assert(Array.isArray(a),o.name,a);const p=l[c];for(const h of a){this.assert(h!==null,o.name,null);let f;switch(o.kind){case"message":f=o.T().internalJsonRead(h,s);break;case"enum":if(f=this.enum(o.T(),h,o.name,s.ignoreUnknownFields),f===!1)continue;break;case"scalar":f=this.scalar(h,o.T,o.L,o.name);break}this.assert(f!==void 0,o.name,a),p.push(f)}}else switch(o.kind){case"message":if(a===null&&o.T().typeName!="google.protobuf.Value"){this.assert(o.oneof===void 0,o.name+" (oneof member)",null);continue}l[c]=o.T().internalJsonRead(a,s,l[c]);break;case"enum":let p=this.enum(o.T(),a,o.name,s.ignoreUnknownFields);if(p===!1)continue;l[c]=p;break;case"scalar":l[c]=this.scalar(a,o.T,o.L,o.name);break}}}enum(t,e,s,n){if(t[0]=="google.protobuf.NullValue"&&ue(e===null||e==="NULL_VALUE",`Unable to parse field ${this.info.typeName}#${s}, enum ${t[0]} only accepts null.`),e===null)return 0;switch(typeof e){case"number":return ue(Number.isInteger(e),`Unable to parse field ${this.info.typeName}#${s}, enum can only be integral number, got ${e}.`),e;case"string":let i=e;t[2]&&e.substring(0,t[2].length)===t[2]&&(i=e.substring(t[2].length));let a=t[1][i];return typeof a=="undefined"&&n?!1:(ue(typeof a=="number",`Unable to parse field ${this.info.typeName}#${s}, enum ${t[0]} has no value for "${e}".`),a)}ue(!1,`Unable to parse field ${this.info.typeName}#${s}, cannot parse enum value from ${typeof e}".`)}scalar(t,e,s,n){let i;try{switch(e){case O.DOUBLE:case O.FLOAT:if(t===null)return 0;if(t==="NaN")return Number.NaN;if(t==="Infinity")return Number.POSITIVE_INFINITY;if(t==="-Infinity")return Number.NEGATIVE_INFINITY;if(t===""){i="empty string";break}if(typeof t=="string"&&t.trim().length!==t.length){i="extra whitespace";break}if(typeof t!="string"&&typeof t!="number")break;let a=Number(t);if(Number.isNaN(a)){i="not a number";break}if(!Number.isFinite(a)){i="too large or small";break}return e==O.FLOAT&&Tu(a),a;case O.INT32:case O.FIXED32:case O.SFIXED32:case O.SINT32:case O.UINT32:if(t===null)return 0;let o;if(typeof t=="number"?o=t:t===""?i="empty string":typeof t=="string"&&(t.trim().length!==t.length?i="extra whitespace":o=Number(t)),o===void 0)break;return e==O.UINT32?Nc(o):va(o),o;case O.INT64:case O.SFIXED64:case O.SINT64:if(t===null)return ur(we.ZERO,s);if(typeof t!="number"&&typeof t!="string")break;return ur(we.from(t),s);case O.FIXED64:case O.UINT64:if(t===null)return ur(ft.ZERO,s);if(typeof t!="number"&&typeof t!="string")break;return ur(ft.from(t),s);case O.BOOL:if(t===null)return!1;if(typeof t!="boolean")break;return t;case O.STRING:if(t===null)return"";if(typeof t!="string"){i="extra whitespace";break}try{encodeURIComponent(t)}catch(c){c="invalid UTF8";break}return t;case O.BYTES:if(t===null||t==="")return new Uint8Array(0);if(typeof t!="string")break;return wP(t)}}catch(a){i=a.message}this.assert(!1,n+(i?" - "+i:""),t)}}class qP{constructor(t){var e;this.fields=(e=t.fields)!==null&&e!==void 0?e:[]}write(t,e){const s={},n=t;for(const i of this.fields){if(!i.oneof){let l=this.field(i,n[i.localName],e);l!==void 0&&(s[e.useProtoFieldName?i.name:i.jsonName]=l);continue}const a=n[i.oneof];if(a.oneofKind!==i.localName)continue;const o=i.kind=="scalar"||i.kind=="enum"?Object.assign(Object.assign({},e),{emitDefaultValues:!0}):e;let c=this.field(i,a[i.localName],o);ue(c!==void 0),s[e.useProtoFieldName?i.name:i.jsonName]=c}return s}field(t,e,s){let n;if(t.kind=="map"){ue(typeof e=="object"&&e!==null);const i={};switch(t.V.kind){case"scalar":for(const[c,l]of Object.entries(e)){const p=this.scalar(t.V.T,l,t.name,!1,!0);ue(p!==void 0),i[c.toString()]=p}break;case"message":const a=t.V.T();for(const[c,l]of Object.entries(e)){const p=this.message(a,l,t.name,s);ue(p!==void 0),i[c.toString()]=p}break;case"enum":const o=t.V.T();for(const[c,l]of Object.entries(e)){ue(l===void 0||typeof l=="number");const p=this.enum(o,l,t.name,!1,!0,s.enumAsInteger);ue(p!==void 0),i[c.toString()]=p}break}(s.emitDefaultValues||Object.keys(i).length>0)&&(n=i)}else if(t.repeat){ue(Array.isArray(e));const i=[];switch(t.kind){case"scalar":for(let c=0;c<e.length;c++){const l=this.scalar(t.T,e[c],t.name,t.opt,!0);ue(l!==void 0),i.push(l)}break;case"enum":const a=t.T();for(let c=0;c<e.length;c++){ue(e[c]===void 0||typeof e[c]=="number");const l=this.enum(a,e[c],t.name,t.opt,!0,s.enumAsInteger);ue(l!==void 0),i.push(l)}break;case"message":const o=t.T();for(let c=0;c<e.length;c++){const l=this.message(o,e[c],t.name,s);ue(l!==void 0),i.push(l)}break}(s.emitDefaultValues||i.length>0||s.emitDefaultValues)&&(n=i)}else switch(t.kind){case"scalar":n=this.scalar(t.T,e,t.name,t.opt,s.emitDefaultValues);break;case"enum":n=this.enum(t.T(),e,t.name,t.opt,s.emitDefaultValues,s.enumAsInteger);break;case"message":n=this.message(t.T(),e,t.name,s);break}return n}enum(t,e,s,n,i,a){if(t[0]=="google.protobuf.NullValue")return!i&&!n?void 0:null;if(e===void 0){ue(n);return}if(!(e===0&&!i&&!n))return ue(typeof e=="number"),ue(Number.isInteger(e)),a||!t[1].hasOwnProperty(e)?e:t[2]?t[2]+t[1][e]:t[1][e]}message(t,e,s,n){return e===void 0?n.emitDefaultValues?null:void 0:t.internalJsonWrite(e,n)}scalar(t,e,s,n,i){if(e===void 0){ue(n);return}const a=i||n;switch(t){case O.INT32:case O.SFIXED32:case O.SINT32:return e===0?a?0:void 0:(va(e),e);case O.FIXED32:case O.UINT32:return e===0?a?0:void 0:(Nc(e),e);case O.FLOAT:Tu(e);case O.DOUBLE:return e===0?a?0:void 0:(ue(typeof e=="number"),Number.isNaN(e)?"NaN":e===Number.POSITIVE_INFINITY?"Infinity":e===Number.NEGATIVE_INFINITY?"-Infinity":e);case O.STRING:return e===""?a?"":void 0:(ue(typeof e=="string"),e);case O.BOOL:return e===!1?a?!1:void 0:(ue(typeof e=="boolean"),e);case O.UINT64:case O.FIXED64:ue(typeof e=="number"||typeof e=="string"||typeof e=="bigint");let o=ft.from(e);return o.isZero()&&!a?void 0:o.toString();case O.INT64:case O.SFIXED64:case O.SINT64:ue(typeof e=="number"||typeof e=="string"||typeof e=="bigint");let c=we.from(e);return c.isZero()&&!a?void 0:c.toString();case O.BYTES:return ue(e instanceof Uint8Array),e.byteLength?bP(e):a?"":void 0}}}function Su(r,t=Pr.STRING){switch(r){case O.BOOL:return!1;case O.UINT64:case O.FIXED64:return ur(ft.ZERO,t);case O.INT64:case O.SFIXED64:case O.SINT64:return ur(we.ZERO,t);case O.DOUBLE:case O.FLOAT:return 0;case O.BYTES:return new Uint8Array(0);case O.STRING:return"";default:return 0}}class jP{constructor(t){this.info=t}prepare(){var t;if(!this.fieldNoToField){const e=(t=this.info.fields)!==null&&t!==void 0?t:[];this.fieldNoToField=new Map(e.map(s=>[s.no,s]))}}read(t,e,s,n){this.prepare();const i=n===void 0?t.len:t.pos+n;for(;t.pos<i;){const[a,o]=t.tag(),c=this.fieldNoToField.get(a);if(!c){let f=s.readUnknownField;if(f=="throw")throw new Error(`Unknown field ${a} (wire type ${o}) for ${this.info.typeName}`);let g=t.skip(o);f!==!1&&(f===!0?Ac.onRead:f)(this.info.typeName,e,a,o,g);continue}let l=e,p=c.repeat,h=c.localName;switch(c.oneof&&(l=l[c.oneof],l.oneofKind!==h&&(l=e[c.oneof]={oneofKind:h})),c.kind){case"scalar":case"enum":let f=c.kind=="enum"?O.INT32:c.T,g=c.kind=="scalar"?c.L:void 0;if(p){let R=l[h];if(o==Ge.LengthDelimited&&f!=O.STRING&&f!=O.BYTES){let D=t.uint32()+t.pos;for(;t.pos<D;)R.push(this.scalar(t,f,g))}else R.push(this.scalar(t,f,g))}else l[h]=this.scalar(t,f,g);break;case"message":if(p){let R=l[h],D=c.T().internalBinaryRead(t,t.uint32(),s);R.push(D)}else l[h]=c.T().internalBinaryRead(t,t.uint32(),s,l[h]);break;case"map":let[_,w]=this.mapEntry(c,t,s);l[h][_]=w;break}}}mapEntry(t,e,s){let n=e.uint32(),i=e.pos+n,a,o;for(;e.pos<i;){let[c,l]=e.tag();switch(c){case 1:t.K==O.BOOL?a=e.bool().toString():a=this.scalar(e,t.K,Pr.STRING);break;case 2:switch(t.V.kind){case"scalar":o=this.scalar(e,t.V.T,t.V.L);break;case"enum":o=e.int32();break;case"message":o=t.V.T().internalBinaryRead(e,e.uint32(),s);break}break;default:throw new Error(`Unknown field ${c} (wire type ${l}) in map entry for ${this.info.typeName}#${t.name}`)}}if(a===void 0){let c=Su(t.K);a=t.K==O.BOOL?c.toString():c}if(o===void 0)switch(t.V.kind){case"scalar":o=Su(t.V.T,t.V.L);break;case"enum":o=0;break;case"message":o=t.V.T().create();break}return[a,o]}scalar(t,e,s){switch(e){case O.INT32:return t.int32();case O.STRING:return t.string();case O.BOOL:return t.bool();case O.DOUBLE:return t.double();case O.FLOAT:return t.float();case O.INT64:return ur(t.int64(),s);case O.UINT64:return ur(t.uint64(),s);case O.FIXED64:return ur(t.fixed64(),s);case O.FIXED32:return t.fixed32();case O.BYTES:return t.bytes();case O.UINT32:return t.uint32();case O.SFIXED32:return t.sfixed32();case O.SFIXED64:return ur(t.sfixed64(),s);case O.SINT32:return t.sint32();case O.SINT64:return ur(t.sint64(),s)}}}class GP{constructor(t){this.info=t}prepare(){if(!this.fields){const t=this.info.fields?this.info.fields.concat():[];this.fields=t.sort((e,s)=>e.no-s.no)}}write(t,e,s){this.prepare();for(const i of this.fields){let a,o,c=i.repeat,l=i.localName;if(i.oneof){const p=t[i.oneof];if(p.oneofKind!==l)continue;a=p[l],o=!0}else a=t[l],o=!1;switch(i.kind){case"scalar":case"enum":let p=i.kind=="enum"?O.INT32:i.T;if(c)if(ue(Array.isArray(a)),c==Lc.PACKED)this.packed(e,p,i.no,a);else for(const h of a)this.scalar(e,p,i.no,h,!0);else a===void 0?ue(i.opt):this.scalar(e,p,i.no,a,o||i.opt);break;case"message":if(c){ue(Array.isArray(a));for(const h of a)this.message(e,s,i.T(),i.no,h)}else this.message(e,s,i.T(),i.no,a);break;case"map":ue(typeof a=="object"&&a!==null);for(const[h,f]of Object.entries(a))this.mapEntry(e,s,i,h,f);break}}let n=s.writeUnknownFields;n!==!1&&(n===!0?Ac.onWrite:n)(this.info.typeName,t,e)}mapEntry(t,e,s,n,i){t.tag(s.no,Ge.LengthDelimited),t.fork();let a=n;switch(s.K){case O.INT32:case O.FIXED32:case O.UINT32:case O.SFIXED32:case O.SINT32:a=Number.parseInt(n);break;case O.BOOL:ue(n=="true"||n=="false"),a=n=="true";break}switch(this.scalar(t,s.K,1,a,!0),s.V.kind){case"scalar":this.scalar(t,s.V.T,2,i,!0);break;case"enum":this.scalar(t,O.INT32,2,i,!0);break;case"message":this.message(t,e,s.V.T(),2,i);break}t.join()}message(t,e,s,n,i){i!==void 0&&(s.internalBinaryWrite(i,t.tag(n,Ge.LengthDelimited).fork(),e),t.join())}scalar(t,e,s,n,i){let[a,o,c]=this.scalarInfo(e,n);(!c||i)&&(t.tag(s,a),t[o](n))}packed(t,e,s,n){if(!n.length)return;ue(e!==O.BYTES&&e!==O.STRING),t.tag(s,Ge.LengthDelimited),t.fork();let[,i]=this.scalarInfo(e);for(let a=0;a<n.length;a++)t[i](n[a]);t.join()}scalarInfo(t,e){let s=Ge.Varint,n,i=e===void 0,a=e===0;switch(t){case O.INT32:n="int32";break;case O.STRING:a=i||!e.length,s=Ge.LengthDelimited,n="string";break;case O.BOOL:a=e===!1,n="bool";break;case O.UINT32:n="uint32";break;case O.DOUBLE:s=Ge.Bit64,n="double";break;case O.FLOAT:s=Ge.Bit32,n="float";break;case O.INT64:a=i||we.from(e).isZero(),n="int64";break;case O.UINT64:a=i||ft.from(e).isZero(),n="uint64";break;case O.FIXED64:a=i||ft.from(e).isZero(),s=Ge.Bit64,n="fixed64";break;case O.BYTES:a=i||!e.byteLength,s=Ge.LengthDelimited,n="bytes";break;case O.FIXED32:s=Ge.Bit32,n="fixed32";break;case O.SFIXED32:s=Ge.Bit32,n="sfixed32";break;case O.SFIXED64:a=i||we.from(e).isZero(),s=Ge.Bit64,n="sfixed64";break;case O.SINT32:n="sint32";break;case O.SINT64:a=i||we.from(e).isZero(),n="sint64";break}return[s,n,i||a]}}function WP(r){const t=r.messagePrototype?Object.create(r.messagePrototype):Object.defineProperty({},cg,{value:r});for(let e of r.fields){let s=e.localName;if(!e.opt)if(e.oneof)t[e.oneof]={oneofKind:void 0};else if(e.repeat)t[s]=[];else switch(e.kind){case"scalar":t[s]=Su(e.T,e.L);break;case"enum":t[s]=0;break;case"map":t[s]={};break}}return t}function Eu(r,t,e){let s,n=e,i;for(let a of r.fields){let o=a.localName;if(a.oneof){const c=n[a.oneof];if((c==null?void 0:c.oneofKind)==null)continue;if(s=c[o],i=t[a.oneof],i.oneofKind=c.oneofKind,s==null){delete i[o];continue}}else if(s=n[o],i=t,s==null)continue;switch(a.repeat&&(i[o].length=s.length),a.kind){case"scalar":case"enum":if(a.repeat)for(let l=0;l<s.length;l++)i[o][l]=s[l];else i[o]=s;break;case"message":let c=a.T();if(a.repeat)for(let l=0;l<s.length;l++)i[o][l]=c.create(s[l]);else i[o]===void 0?i[o]=c.create(s):c.mergePartial(i[o],s);break;case"map":switch(a.V.kind){case"scalar":case"enum":Object.assign(i[o],s);break;case"message":let l=a.V.T();for(let p of Object.keys(s))i[o][p]=l.create(s[p]);break}break}}}function JP(r,t,e){if(t===e)return!0;if(!t||!e)return!1;for(let s of r.fields){let n=s.localName,i=s.oneof?t[s.oneof][n]:t[n],a=s.oneof?e[s.oneof][n]:e[n];switch(s.kind){case"enum":case"scalar":let o=s.kind=="enum"?O.INT32:s.T;if(!(s.repeat?ug(o,i,a):lg(o,i,a)))return!1;break;case"map":if(!(s.V.kind=="message"?hg(s.V.T(),xc(i),xc(a)):ug(s.V.kind=="enum"?O.INT32:s.V.T,xc(i),xc(a))))return!1;break;case"message":let c=s.T();if(!(s.repeat?hg(c,i,a):c.equals(i,a)))return!1;break}}return!0}const xc=Object.values;function lg(r,t,e){if(t===e)return!0;if(r!==O.BYTES)return!1;let s=t,n=e;if(s.length!==n.length)return!1;for(let i=0;i<s.length;i++)if(s[i]!=n[i])return!1;return!0}function ug(r,t,e){if(t.length!==e.length)return!1;for(let s=0;s<t.length;s++)if(!lg(r,t[s],e[s]))return!1;return!0}function hg(r,t,e){if(t.length!==e.length)return!1;for(let s=0;s<t.length;s++)if(!r.equals(t[s],e[s]))return!1;return!0}const KP=Object.getOwnPropertyDescriptors(Object.getPrototypeOf({}));class T{constructor(t,e,s){this.defaultCheckDepth=16,this.typeName=t,this.fields=e.map(UP),this.options=s!=null?s:{},this.messagePrototype=Object.create(null,Object.assign(Object.assign({},KP),{[cg]:{value:this}})),this.refTypeCheck=new BP(this),this.refJsonReader=new HP(this),this.refJsonWriter=new qP(this),this.refBinReader=new jP(this),this.refBinWriter=new GP(this)}create(t){let e=WP(this);return t!==void 0&&Eu(this,e,t),e}clone(t){let e=this.create();return Eu(this,e,t),e}equals(t,e){return JP(this,t,e)}is(t,e=this.defaultCheckDepth){return this.refTypeCheck.is(t,e,!1)}isAssignable(t,e=this.defaultCheckDepth){return this.refTypeCheck.is(t,e,!0)}mergePartial(t,e){Eu(this,t,e)}fromBinary(t,e){let s=kP(e);return this.internalBinaryRead(s.readerFactory(t),t.byteLength,s)}fromJson(t,e){return this.internalJsonRead(t,FP(e))}fromJsonString(t,e){let s=JSON.parse(t);return this.fromJson(s,e)}toJson(t,e){return this.internalJsonWrite(t,$P(e))}toJsonString(t,e){var s;let n=this.toJson(t,e);return JSON.stringify(n,null,(s=e==null?void 0:e.prettySpaces)!==null&&s!==void 0?s:0)}toBinary(t,e){let s=LP(e);return this.internalBinaryWrite(t,s.writerFactory(),s).finish()}internalJsonRead(t,e,s){if(t!==null&&typeof t=="object"&&!Array.isArray(t)){let n=s!=null?s:this.create();return this.refJsonReader.read(t,n,e),n}throw new Error(`Unable to parse message ${this.typeName} from JSON ${gu(t)}.`)}internalJsonWrite(t,e){return this.refJsonWriter.write(t,e)}internalBinaryWrite(t,e,s){return this.refBinWriter.write(t,e,s),e}internalBinaryRead(t,e,s,n){let i=n!=null?n:this.create();return this.refBinReader.read(t,i,s,e),i}}var jt;(function(r){r[r.PUBLISHER=0]="PUBLISHER",r[r.SUBSCRIBER=1]="SUBSCRIBER"})(jt||(jt={}));var hr;(function(r){r[r.AUDIO=0]="AUDIO",r[r.VIDEO=1]="VIDEO"})(hr||(hr={}));class zP extends T{constructor(){super("media.Codec",[{no:1,name:"channels",kind:"scalar",opt:!0,T:5},{no:2,name:"clock_rate",kind:"scalar",T:5},{no:3,name:"mime_type",kind:"scalar",T:9},{no:4,name:"sdp_fmtp_line",kind:"scalar",opt:!0,T:9}])}}const YP=new zP;class QP extends T{constructor(){super("media.HeaderExtension",[{no:1,name:"direction",kind:"scalar",opt:!0,T:9},{no:2,name:"uri",kind:"scalar",T:9}])}}const XP=new QP;class ZP extends T{constructor(){super("media.Fingerprint",[{no:1,name:"algorithm",kind:"scalar",T:9},{no:2,name:"value",kind:"scalar",T:9}])}}new ZP;class ek extends T{constructor(){super("media.SessionDescription",[{no:1,name:"target",kind:"enum",T:()=>["media.Target",jt]},{no:2,name:"type",kind:"scalar",T:9},{no:3,name:"sdp",kind:"scalar",T:9}])}}const pr=new ek;class tk extends T{constructor(){super("media.CreateTransportRequest",[{no:1,name:"consuming",kind:"scalar",T:8},{no:2,name:"force_tcp",kind:"scalar",opt:!0,T:8},{no:3,name:"description",kind:"message",T:()=>pr},{no:4,name:"private_ice",kind:"scalar",opt:!0,T:8}])}}const pg=new tk;class rk extends T{constructor(){super("media.CreateTransportResponse",[{no:1,name:"transport_id",kind:"scalar",T:9},{no:2,name:"description",kind:"message",T:()=>pr},{no:3,name:"transcription_enabled",kind:"scalar",opt:!0,T:8}])}}const _u=new rk;class sk extends T{constructor(){super("media.RenegotiateRequest",[{no:1,name:"transport_id",kind:"scalar",T:9},{no:2,name:"description",kind:"message",T:()=>pr}])}}const mg=new sk;class nk extends T{constructor(){super("media.RenegotiateResponse",[{no:1,name:"transport_id",kind:"scalar",T:9},{no:2,name:"description",kind:"message",T:()=>pr}])}}new nk;class ik extends T{constructor(){super("media.NestedScore",[{no:1,name:"encoding_idx",kind:"scalar",T:5},{no:2,name:"rid",kind:"scalar",T:9},{no:3,name:"score",kind:"scalar",T:5},{no:4,name:"ssrc",kind:"scalar",T:3,L:0}])}}const ak=new ik;class ok extends T{constructor(){super("media.ProducerTrack",[{no:1,name:"track_id",kind:"scalar",T:9},{no:2,name:"producer_id",kind:"scalar",T:9},{no:3,name:"stream_id",kind:"scalar",T:9}])}}const ck=new ok;class dk extends T{constructor(){super("media.ProducerEntry",[{no:1,name:"producing_transport_id",kind:"scalar",T:9},{no:2,name:"producer_id",kind:"scalar",T:9}])}}new dk;class lk extends T{constructor(){super("media.ConsumerEntry",[{no:1,name:"consuming_transport_id",kind:"scalar",T:9},{no:2,name:"consumer_id",kind:"scalar",T:9}])}}new lk;class uk extends T{constructor(){super("media.ProducerState",[{no:1,name:"producer_id",kind:"scalar",T:9},{no:2,name:"kind",kind:"enum",T:()=>["media.ProducerKind",hr]},{no:3,name:"pause",kind:"scalar",T:8},{no:4,name:"screen_share",kind:"scalar",T:8},{no:5,name:"app_data",kind:"scalar",opt:!0,T:9},{no:6,name:"producing_transport_id",kind:"scalar",opt:!0,T:9},{no:7,name:"mime_type",kind:"scalar",opt:!0,T:9}])}}const ya=new uk;class hk extends T{constructor(){super("media.ConsumerState",[{no:1,name:"consumer_id",kind:"scalar",T:9},{no:2,name:"producer_state",kind:"message",T:()=>ya},{no:3,name:"producer_track",kind:"message",T:()=>ck}])}}const pk=new hk;class mk extends T{constructor(){super("media.ProducerIdToConsumerMap",[{no:1,name:"map",kind:"map",K:9,V:{kind:"message",T:()=>pk}}])}}const fg=new mk;class fk extends T{constructor(){super("media.PeerRtpCapabilitites",[{no:1,name:"sender",kind:"message",T:()=>yg},{no:2,name:"receiver",kind:"message",T:()=>yg}])}}const gg=new fk;class gk extends T{constructor(){super("media.RtpCapability",[{no:1,name:"codecs",kind:"message",repeat:1,T:()=>YP},{no:2,name:"header_extensions",kind:"message",repeat:1,T:()=>XP}])}}const vg=new gk;class vk extends T{constructor(){super("media.RtpCapabilitites",[{no:1,name:"audio",kind:"message",T:()=>vg},{no:2,name:"video",kind:"message",T:()=>vg}])}}const yg=new vk;class yk extends T{constructor(){super("media.PreferredCodec",[{no:1,name:"audio",kind:"scalar",opt:!0,T:9},{no:2,name:"video",kind:"scalar",opt:!0,T:9}])}}const Tk=new yk;class Sk extends T{constructor(){super("media.edge.GeoLocation",[{no:1,name:"latitude",kind:"scalar",T:2},{no:2,name:"longitude",kind:"scalar",T:2},{no:3,name:"region",kind:"scalar",opt:!0,T:9}])}}const Ek=new Sk;class _k extends T{constructor(){super("media.edge.PeerJoinRequest",[{no:1,name:"display_name",kind:"scalar",opt:!0,T:9},{no:2,name:"prejoined",kind:"scalar",T:8},{no:3,name:"room_uuid",kind:"scalar",T:9},{no:4,name:"meeting_id",kind:"scalar",opt:!0,T:9},{no:5,name:"preset",kind:"scalar",opt:!0,T:12},{no:6,name:"user_id",kind:"scalar",opt:!0,T:9},{no:7,name:"organization_id",kind:"scalar",opt:!0,T:9},{no:8,name:"location",kind:"message",T:()=>Ek},{no:9,name:"capabilities",kind:"message",T:()=>gg}])}}const Tg=new _k;class wk extends T{constructor(){super("media.edge.PeerJoinCompleteRequest",[])}}const Sg=new wk;class bk extends T{constructor(){super("media.edge.PeerLeaveRequest",[{no:1,name:"close_room",kind:"scalar",T:8}])}}const Ck=new bk;class Rk extends T{constructor(){super("media.edge.ConsumeMultipleProducerRequest",[{no:1,name:"producer_ids",kind:"scalar",repeat:2,T:9},{no:2,name:"paused",kind:"scalar",opt:!0,T:8}])}}new Rk;class Pk extends T{constructor(){super("media.edge.ConsumePeerRequest",[{no:1,name:"producing_peer_id",kind:"scalar",T:9},{no:2,name:"paused",kind:"scalar",opt:!0,T:8},{no:3,name:"producer_id",kind:"scalar",opt:!0,T:9},{no:4,name:"preferred_codec",kind:"message",T:()=>Tk}])}}const Eg=new Pk;class kk extends T{constructor(){super("media.edge.ConsumePeersRequest",[{no:1,name:"requests",kind:"message",repeat:1,T:()=>Eg}])}}const Ik=new kk;class Ak extends T{constructor(){super("media.edge.ProducerCreateRequest",[{no:1,name:"kind",kind:"scalar",T:9},{no:2,name:"paused",kind:"scalar",T:8},{no:3,name:"screen_share",kind:"scalar",T:8},{no:4,name:"description",kind:"message",T:()=>pr},{no:5,name:"msid",kind:"scalar",T:9},{no:6,name:"app_data",kind:"scalar",opt:!0,T:9},{no:7,name:"mime_type",kind:"scalar",opt:!0,T:9}])}}const _g=new Ak;class Mk extends T{constructor(){super("media.edge.SelectedPeersRequest",[])}}new Mk;class Dk extends T{constructor(){super("media.edge.GlobalPeerPinningRequest",[{no:1,name:"participant_id",kind:"scalar",T:9}])}}const Ok=new Dk;class Nk extends T{constructor(){super("media.edge.ProducerToggleRequest",[{no:1,name:"producer_id",kind:"scalar",T:9},{no:2,name:"pause",kind:"scalar",T:8}])}}const Fc=new Nk;class Lk extends T{constructor(){super("media.edge.ConsumerToggleRequest",[{no:1,name:"consumer_id",kind:"scalar",T:9},{no:2,name:"pause",kind:"scalar",T:8}])}}const $c=new Lk;class xk extends T{constructor(){super("media.edge.ProducerCloseRequest",[{no:1,name:"producer_id",kind:"scalar",T:9},{no:2,name:"description",kind:"message",T:()=>pr}])}}const wg=new xk;class Fk extends T{constructor(){super("media.edge.ConsumerCloseRequest",[{no:1,name:"consumer_ids",kind:"scalar",repeat:2,T:9},{no:2,name:"description",kind:"message",T:()=>pr}])}}const bg=new Fk;class $k extends T{constructor(){super("media.edge.KickPeerRequest",[{no:1,name:"participant_id",kind:"scalar",T:9}])}}const Cg=new $k;class Uk extends T{constructor(){super("media.edge.KickAllPeersRequest",[{no:1,name:"propagate_kick_across_rooms",kind:"scalar",T:8}])}}const wu=new Uk;class Vk extends T{constructor(){super("media.edge.PeerDisplayNameEditRequest",[{no:1,name:"participant_id",kind:"scalar",T:9},{no:2,name:"display_name",kind:"scalar",T:9}])}}const Rg=new Vk;class Bk extends T{constructor(){super("media.edge.HostMediaControlForPeerRequest",[{no:1,name:"participant_id",kind:"scalar",T:9},{no:2,name:"audio",kind:"scalar",T:8},{no:3,name:"video",kind:"scalar",T:8},{no:4,name:"scree_share",kind:"scalar",T:8}])}}const Pg=new Bk;class Hk extends T{constructor(){super("media.edge.HostMediaControlForAllPeerRequest",[{no:1,name:"audio",kind:"scalar",T:8},{no:2,name:"video",kind:"scalar",T:8},{no:3,name:"screen_share",kind:"scalar",T:8}])}}const kg=new Hk;class qk extends T{constructor(){super("media.edge.GetRoomStateResponse",[{no:1,name:"display_title",kind:"scalar",T:9},{no:2,name:"locked_mode",kind:"scalar",T:8},{no:3,name:"room_uuid",kind:"scalar",T:9},{no:4,name:"room_name",kind:"scalar",T:9},{no:5,name:"current_peer_id",kind:"scalar",T:9},{no:6,name:"is_recording",kind:"scalar",opt:!0,T:8},{no:7,name:"recorder_participant_id",kind:"scalar",opt:!0,T:9},{no:8,name:"pinned_peer_ids",kind:"scalar",repeat:2,T:9}])}}const jk=new qk;class Gk extends T{constructor(){super("media.edge.ErrorResponse",[{no:1,name:"error_message",kind:"scalar",T:9},{no:2,name:"event_id",kind:"scalar",T:5}])}}const Wk=new Gk;class Jk extends T{constructor(){super("media.edge.EmptyResponse",[])}}new Jk;class Kk extends T{constructor(){super("media.edge.RoomParticipants",[{no:1,name:"peer_id",kind:"scalar",T:9},{no:2,name:"producer_states",kind:"message",repeat:1,T:()=>ya},{no:3,name:"display_name",kind:"scalar",T:9},{no:4,name:"user_id",kind:"scalar",opt:!0,T:9},{no:5,name:"capabilities",kind:"message",T:()=>gg}])}}const Ig=new Kk;class zk extends T{constructor(){super("media.edge.SelectedPeersResponse",[{no:1,name:"audio_peers",kind:"scalar",repeat:2,T:9},{no:2,name:"compulsory_peers",kind:"scalar",repeat:2,T:9}])}}const bu=new zk;class Yk extends T{constructor(){super("media.edge.SelectedPeersDiffEntry",[{no:1,name:"peer_id",kind:"scalar",T:9},{no:2,name:"priority",kind:"scalar",T:5}])}}const Qk=new Yk;class Xk extends T{constructor(){super("media.edge.SelectedPeersDiffResponse",[{no:1,name:"entries",kind:"message",repeat:1,T:()=>Qk}])}}const Ag=new Xk;class Zk extends T{constructor(){super("media.edge.PeerJoinResponse",[])}}new Zk;class eI extends T{constructor(){super("media.edge.PeerJoinCompleteResponse",[{no:1,name:"room_state",kind:"message",T:()=>jk},{no:2,name:"participants",kind:"message",repeat:1,T:()=>Ig},{no:3,name:"selected_peers",kind:"message",T:()=>bu},{no:4,name:"max_preferred_streams",kind:"scalar",T:5}])}}const Uc=new eI;class tI extends T{constructor(){super("media.edge.PeerLeaveResponse",[{no:1,name:"closed",kind:"scalar",T:8}])}}const rI=new tI;class sI extends T{constructor(){super("media.edge.ConsumeMultipleProducerResponse",[{no:1,name:"status",kind:"scalar",T:8},{no:2,name:"consumer_ids_map",kind:"message",T:()=>fg}])}}new sI;class nI extends T{constructor(){super("media.edge.ConsumePeerResponse",[{no:1,name:"status",kind:"scalar",T:8},{no:2,name:"consumer_ids_map",kind:"message",T:()=>fg},{no:3,name:"description",kind:"message",T:()=>pr}])}}const Mg=new nI;class iI extends T{constructor(){super("media.edge.ProducerCreateResponse",[{no:1,name:"status",kind:"scalar",T:8},{no:2,name:"producer_id",kind:"scalar",T:9},{no:4,name:"description",kind:"message",T:()=>pr}])}}const Dg=new iI;class aI extends T{constructor(){super("media.edge.ProducerScoreResponse",[{no:1,name:"responseid",kind:"scalar",T:9},{no:2,name:"score",kind:"message",T:()=>ak}])}}new aI;class oI extends T{constructor(){super("media.edge.ActiveSpeakerResponse",[{no:1,name:"responsepeer_id",kind:"scalar",T:9},{no:2,name:"volume",kind:"scalar",T:5}])}}new oI;class cI extends T{constructor(){super("media.edge.NoActiveSpeakerResponse",[])}}new cI;class dI extends T{constructor(){super("media.edge.ProducerToggleResponse",[])}}new dI;class lI extends T{constructor(){super("media.edge.ConsumerToggleResponse",[])}}new lI;class uI extends T{constructor(){super("media.edge.ProducerClosingResponse",[{no:1,name:"description",kind:"message",T:()=>pr}])}}const Og=new uI;class hI extends T{constructor(){super("media.edge.ConsumerClosingResponse",[{no:1,name:"description",kind:"message",T:()=>pr}])}}new hI;class pI extends T{constructor(){super("media.edge.GlobalPeerPinningResponse",[])}}new pI;class mI extends T{constructor(){super("media.edge.KickPeerResponse",[{no:1,name:"status",kind:"scalar",T:9}])}}const Ng=new mI;class fI extends T{constructor(){super("media.edge.KickAllPeersResponse",[{no:1,name:"status",kind:"scalar",T:9}])}}const Lg=new fI;class gI extends T{constructor(){super("media.edge.HostMediaControlForPeerResponse",[{no:1,name:"status",kind:"scalar",T:9}])}}const xg=new gI;class vI extends T{constructor(){super("media.edge.HostMediaControlForAllPeerResponse",[{no:1,name:"status",kind:"scalar",T:9}])}}const Fg=new vI;class yI extends T{constructor(){super("media.edge.PeerDisplayNameEditResponse",[{no:1,name:"status",kind:"scalar",T:9}])}}const $g=new yI;class TI extends T{constructor(){super("media.edge.PeerJoinBroadcastResponse",[{no:1,name:"participant",kind:"message",T:()=>Ig}])}}const Ug=new TI;class SI extends T{constructor(){super("media.edge.TrackSubscriptionKind",[{no:1,name:"audio",kind:"scalar",T:8},{no:2,name:"video",kind:"scalar",T:8}])}}const Vg=new SI;class EI extends T{constructor(){super("media.edge.TrackSubscription",[{no:1,name:"label",kind:"scalar",T:9},{no:2,name:"webcam",kind:"message",T:()=>Vg},{no:3,name:"screenshare",kind:"message",T:()=>Vg}])}}const _I=new EI;class wI extends T{constructor(){super("media.edge.PeerProducingTransportCreateBroadcastResponse",[{no:1,name:"participant_id",kind:"scalar",T:9},{no:2,name:"transport_details",kind:"message",T:()=>_u},{no:3,name:"track_subscriptions",kind:"message",repeat:1,T:()=>_I}])}}new wI;class bI extends T{constructor(){super("media.edge.PeerProducerCreateBroadcastResponse",[{no:1,name:"participant_id",kind:"scalar",T:9},{no:2,name:"producer_state",kind:"message",T:()=>ya}])}}const CI=new bI;class RI extends T{constructor(){super("media.edge.PeerProducerToggleBroadcastResponse",[{no:1,name:"participant_id",kind:"scalar",T:9},{no:2,name:"producer_state",kind:"message",T:()=>ya},{no:3,name:"initiator_participant_id",kind:"scalar",opt:!0,T:9}])}}const Bg=new RI;class PI extends T{constructor(){super("media.edge.PeerProducerCloseBroadcastResponse",[{no:1,name:"participant_id",kind:"scalar",T:9},{no:2,name:"producer_state",kind:"message",T:()=>ya}])}}const kI=new PI;class II extends T{constructor(){super("media.edge.PeerLeaveBroadcastResponse",[{no:1,name:"participant_id",kind:"scalar",T:9}])}}const Cu=new II;class AI extends T{constructor(){super("media.edge.GlobalPeerPinningBroadcastResponse",[{no:1,name:"participant_id",kind:"scalar",T:9}])}}const Hg=new AI;class MI extends T{constructor(){super("media.edge.GlobalPeerUnPinningBroadcastResponse",[{no:1,name:"participant_id",kind:"scalar",T:9}])}}new MI;class DI extends T{constructor(){super("media.edge.RecordingStartedBroadcastResponse",[{no:1,name:"participant_id",kind:"scalar",T:9}])}}new DI;class OI extends T{constructor(){super("media.edge.RecordingStoppedBroadcastResponse",[{no:1,name:"participant_id",kind:"scalar",T:9}])}}new OI;class NI extends T{constructor(){super("media.edge.PeerDisplayNameEditBroadcastResponse",[{no:1,name:"participant_id",kind:"scalar",T:9},{no:2,name:"display_name",kind:"scalar",T:9}])}}new NI;class LI extends T{constructor(){super("media.edge.PeerPingRequestBroadcastResponse",[{no:1,name:"password",kind:"scalar",T:9}])}}new LI;class xI extends T{constructor(){super("media.edge.MediaRoomTerminationBroadcastResponse",[{no:1,name:"reason",kind:"scalar",T:9}])}}new xI;class FI extends T{constructor(){super("socket.ai.MeetingTranscript",[{no:1,name:"meeting_id",kind:"scalar",T:9},{no:2,name:"transcript",kind:"scalar",T:9},{no:3,name:"is_partial",kind:"scalar",T:8}])}}const Ru=new FI;class $I extends T{constructor(){super("socket.api.BaseSocketHubMessage",[{no:1,name:"event",kind:"scalar",T:5},{no:2,name:"id",kind:"scalar",T:9},{no:3,name:"peer_id",kind:"scalar",T:9},{no:4,name:"room_id",kind:"scalar",T:9},{no:5,name:"user_id",kind:"scalar",T:9},{no:6,name:"payload",kind:"scalar",T:12},{no:7,name:"error",kind:"scalar",opt:!0,T:8},{no:8,name:"sid",kind:"scalar",opt:!0,T:9}])}}new $I;class UI extends T{constructor(){super("socket.api.ErrorMessage",[{no:1,name:"code",kind:"scalar",opt:!0,T:5},{no:2,name:"message",kind:"scalar",T:9}])}}const VI=new UI;var sn;(function(r){r[r.BROWSER=0]="BROWSER",r[r.TRACK=1]="TRACK",r[r.COMPOSITE=2]="COMPOSITE"})(sn||(sn={}));var qr;(function(r){r[r.UNSPECIFIED=0]="UNSPECIFIED",r[r.ON_STAGE=1]="ON_STAGE",r[r.APPROVED_STAGE=2]="APPROVED_STAGE",r[r.REQUESTED_STAGE=3]="REQUESTED_STAGE",r[r.OFF_STAGE=4]="OFF_STAGE"})(qr||(qr={}));var Pu;(function(r){r[r.NONE=0]="NONE",r[r.RECORDER=1]="RECORDER",r[r.LIVESTREAMER=2]="LIVESTREAMER"})(Pu||(Pu={}));var ku;(function(r){r[r.PEERS=0]="PEERS",r[r.ROOMS=1]="ROOMS"})(ku||(ku={}));var Vc;(function(r){r[r.HIVE=0]="HIVE",r[r.CHAT=1]="CHAT",r[r.PING=2]="PING"})(Vc||(Vc={}));class BI extends T{constructor(){super("socket.room.PeerFlags",[{no:1,name:"preset_name",kind:"scalar",T:9},{no:2,name:"recorder_type",kind:"scalar",T:9},{no:3,name:"hidden_participant",kind:"scalar",T:8}])}}const HI=new BI;class qI extends T{constructor(){super("socket.room.Peer",[{no:1,name:"peer_id",kind:"scalar",T:9},{no:2,name:"user_id",kind:"scalar",T:9},{no:3,name:"display_name",kind:"scalar",T:9},{no:4,name:"stage_type",kind:"enum",opt:!0,T:()=>["socket.room.StageType",qr,"STAGE_TYPE_"]},{no:5,name:"custom_participant_id",kind:"scalar",opt:!0,T:9},{no:6,name:"preset_id",kind:"scalar",opt:!0,T:9},{no:7,name:"display_picture_url",kind:"scalar",opt:!0,T:9},{no:8,name:"waitlisted",kind:"scalar",T:8},{no:9,name:"flags",kind:"message",T:()=>HI}])}}const Bc=new qI;class jI extends T{constructor(){super("socket.room.PeerInfoResponse",[{no:1,name:"peer",kind:"message",T:()=>Bc}])}}const ni=new jI;class GI extends T{constructor(){super("socket.room.PeerStatusUpdate",[{no:1,name:"peer_id",kind:"scalar",T:9},{no:2,name:"user_id",kind:"scalar",T:9},{no:3,name:"stage_type",kind:"enum",opt:!0,T:()=>["socket.room.StageType",qr,"STAGE_TYPE_"]}])}}const qg=new GI;class WI extends T{constructor(){super("socket.room.RoomPeersInfoRequest",[{no:1,name:"seach_query",kind:"scalar",T:9},{no:2,name:"limit",kind:"scalar",T:5},{no:3,name:"offset",kind:"scalar",T:5}])}}const JI=new WI;class KI extends T{constructor(){super("socket.room.RoomPeersInfoResponse",[{no:1,name:"peers",kind:"message",repeat:1,T:()=>Bc}])}}const Iu=new KI;class zI extends T{constructor(){super("socket.room.RoomPeerCountResponse",[{no:1,name:"count",kind:"scalar",T:4,L:2}])}}const jg=new zI;class YI extends T{constructor(){super("socket.room.Room",[{no:1,name:"room_id",kind:"scalar",T:9},{no:2,name:"title",kind:"scalar",T:9},{no:4,name:"created_at",kind:"scalar",T:4,L:2},{no:5,name:"active_recordings",kind:"message",repeat:1,T:()=>XI},{no:6,name:"room_uuid",kind:"scalar",opt:!0,T:9}])}}const Gg=new YI;class QI extends T{constructor(){super("socket.room.ActiveRecording",[{no:1,name:"recording_id",kind:"scalar",T:9},{no:2,name:"recording_type",kind:"enum",T:()=>["common.RecordingType",sn]},{no:3,name:"recording_status",kind:"scalar",T:9}])}}const XI=new QI;class ZI extends T{constructor(){super("socket.room.RoomInfoResponse",[{no:1,name:"room",kind:"message",T:()=>Gg}])}}const Wg=new ZI;class eA extends T{constructor(){super("socket.room.GetPeerInfoRequest",[{no:1,name:"peer_id",kind:"scalar",T:9}])}}const Jg=new eA;class tA extends T{constructor(){super("socket.room.UpdatePeerInfoRequest",[{no:1,name:"peer_id",kind:"scalar",T:9},{no:2,name:"display_name",kind:"scalar",opt:!0,T:9}])}}new tA;class rA extends T{constructor(){super("socket.room.JoinRoomRequest",[{no:1,name:"peer",kind:"message",T:()=>Bc},{no:3,name:"room_uuid",kind:"scalar",T:9},{no:4,name:"organization_id",kind:"scalar",opt:!0,T:9},{no:5,name:"use_hive",kind:"scalar",opt:!0,T:8},{no:6,name:"preset",kind:"scalar",opt:!0,T:12},{no:7,name:"capabilities",kind:"enum",repeat:1,T:()=>["socket.room.Capabilities",Vc,"CAPABILITIES_"]},{no:8,name:"timestamp",kind:"scalar",opt:!0,T:4,L:2}])}}const sA=new rA;class nA extends T{constructor(){super("socket.room.LeaveRoomRequest",[{no:1,name:"peer",kind:"message",T:()=>Bc},{no:2,name:"timestamp",kind:"scalar",opt:!0,T:4,L:2}])}}const iA=new nA;class aA extends T{constructor(){super("socket.room.UpdateRoomInfoRequest",[{no:1,name:"room",kind:"message",T:()=>Gg}])}}new aA;class oA extends T{constructor(){super("socket.room.GetConnectedRoomsDumpRequest",[])}}new oA;class cA extends T{constructor(){super("socket.room.ServiceError",[{no:1,name:"message",kind:"scalar",opt:!0,T:9},{no:2,name:"code",kind:"scalar",opt:!0,T:9}])}}const Au=new cA;class dA extends T{constructor(){super("socket.room.ConnectedMeetingPeer",[{no:1,name:"id",kind:"scalar",opt:!0,T:9},{no:2,name:"display_name",kind:"scalar",opt:!0,T:9},{no:3,name:"custom_participant_id",kind:"scalar",opt:!0,T:9},{no:4,name:"preset_id",kind:"scalar",opt:!0,T:9},{no:5,name:"display_picture_url",kind:"scalar",opt:!0,T:9}])}}const lA=new dA;class uA extends T{constructor(){super("socket.room.ConnectedMeetingDump",[{no:1,name:"id",kind:"scalar",opt:!0,T:9},{no:2,name:"title",kind:"scalar",opt:!0,T:9},{no:3,name:"participants",kind:"message",repeat:1,T:()=>lA}])}}const Kg=new uA;class hA extends T{constructor(){super("socket.room.GetConnectedRoomsDumpResponse",[{no:1,name:"parent_meeting",kind:"message",T:()=>Kg},{no:2,name:"meetings",kind:"message",repeat:1,T:()=>Kg}])}}const pA=new hA;class mA extends T{constructor(){super("socket.room.CreateRoomRequestPayload",[{no:1,name:"title",kind:"scalar",opt:!0,T:9}])}}const fA=new mA;class gA extends T{constructor(){super("socket.room.CreateConnectedRoomsRequest",[{no:1,name:"payloads",kind:"message",repeat:1,T:()=>fA}])}}const vA=new gA;class yA extends T{constructor(){super("socket.room.CreateRoomResponsePayload",[{no:1,name:"id",kind:"scalar",opt:!0,T:9},{no:2,name:"title",kind:"scalar",opt:!0,T:9},{no:3,name:"error",kind:"message",T:()=>Au}])}}const TA=new yA;class SA extends T{constructor(){super("socket.room.CreateConnectedRoomsResponse",[{no:1,name:"payloads",kind:"message",repeat:1,T:()=>TA}])}}const zg=new SA;class EA extends T{constructor(){super("socket.room.UpdateRoomRequestPayload",[{no:1,name:"meeting_id",kind:"scalar",opt:!0,T:9},{no:2,name:"title",kind:"scalar",opt:!0,T:9}])}}const _A=new EA;class wA extends T{constructor(){super("socket.room.UpdateConnectedRoomsRequest",[{no:1,name:"payloads",kind:"message",repeat:1,T:()=>_A}])}}new wA;class bA extends T{constructor(){super("socket.room.DisableRoomPayload",[{no:1,name:"id",kind:"scalar",opt:!0,T:9}])}}const CA=new bA;class RA extends T{constructor(){super("socket.room.DisableConnectedRoomsRequest",[{no:1,name:"payloads",kind:"message",repeat:1,T:()=>CA}])}}const PA=new RA;class kA extends T{constructor(){super("socket.room.DisableConnectedRoomsResponse",[{no:1,name:"payloads",kind:"message",repeat:1,T:()=>MA}])}}const IA=new kA;class AA extends T{constructor(){super("socket.room.DisableConnectedRoomPayload",[{no:1,name:"id",kind:"scalar",opt:!0,T:9},{no:2,name:"status",kind:"scalar",opt:!0,T:9},{no:3,name:"title",kind:"scalar",opt:!0,T:9},{no:4,name:"error",kind:"message",T:()=>Au}])}}const MA=new AA;class DA extends T{constructor(){super("socket.room.MovePeerPayload",[{no:1,name:"id",kind:"scalar",opt:!0,T:9},{no:2,name:"preset_id",kind:"scalar",opt:!0,T:9}])}}const OA=new DA;class NA extends T{constructor(){super("socket.room.MovePeersBetweenRoomsRequest",[{no:1,name:"source_meeting_id",kind:"scalar",opt:!0,T:9},{no:2,name:"destination_meeting_id",kind:"scalar",opt:!0,T:9},{no:3,name:"participants",kind:"message",repeat:1,T:()=>OA}])}}const LA=new NA;class xA extends T{constructor(){super("socket.room.MovedPeer",[{no:1,name:"meeting_id",kind:"scalar",opt:!0,T:9},{no:2,name:"custom_participant_id",kind:"scalar",opt:!0,T:9},{no:3,name:"error",kind:"message",T:()=>Au}])}}const Yg=new xA;class FA extends T{constructor(){super("socket.room.MovePeersBetweenRoomsResponse",[{no:1,name:"payloads",kind:"message",repeat:1,T:()=>Yg}])}}new FA;class $A extends T{constructor(){super("socket.room.TransferPeer",[{no:1,name:"meeting_id",kind:"scalar",opt:!0,T:9},{no:2,name:"auth_token",kind:"scalar",opt:!0,T:9}])}}const UA=new $A;class VA extends T{constructor(){super("socket.room.GetAllAddedParticipantsResponse",[{no:1,name:"participants",kind:"message",repeat:1,T:()=>qA}])}}const BA=new VA;class HA extends T{constructor(){super("socket.room.AddedParticipant",[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",opt:!0,T:9},{no:3,name:"picture",kind:"scalar",opt:!0,T:9},{no:4,name:"custom_participant_id",kind:"scalar",T:9}])}}const qA=new HA;class jA extends T{constructor(){super("socket.room.RemoveParticipantsRequest",[{no:1,name:"peer_ids",kind:"scalar",repeat:2,T:9}])}}const GA=new jA;class WA extends T{constructor(){super("socket.room.BroadcastMessage",[{no:1,name:"type",kind:"scalar",T:9},{no:2,name:"payload",kind:"scalar",T:12},{no:3,name:"timestamp",kind:"scalar",T:4,L:2},{no:4,name:"ids",kind:"scalar",repeat:2,T:9},{no:5,name:"broadcast_type",kind:"enum",opt:!0,T:()=>["socket.room.BroadcastType",ku,"BROADCAST_TYPE_"]}])}}const Ta=new WA;class JA extends T{constructor(){super("socket.room.AcceptWaitingRoomRequests",[{no:1,name:"user_ids",kind:"scalar",repeat:2,T:9}])}}const KA=new JA;class zA extends T{constructor(){super("socket.room.DenyWaitingRoomRequests",[{no:1,name:"user_ids",kind:"scalar",repeat:2,T:9}])}}const YA=new zA;class QA extends T{constructor(){super("socket.room.WaitingRoomRequest",[{no:1,name:"peer_id",kind:"scalar",T:9},{no:2,name:"user_id",kind:"scalar",T:9},{no:3,name:"display_name",kind:"scalar",T:9},{no:4,name:"picture",kind:"scalar",opt:!0,T:9},{no:5,name:"custom_participant_id",kind:"scalar",opt:!0,T:9},{no:6,name:"preset_name",kind:"scalar",opt:!0,T:9}])}}const XA=new QA;class ZA extends T{constructor(){super("socket.room.GetWaitingRoomRequests",[{no:1,name:"requests",kind:"message",repeat:1,T:()=>XA}])}}const Qg=new ZA;class e0 extends T{constructor(){super("socket.room.GetRoomStageStateResponse",[{no:1,name:"on_stage_peers",kind:"scalar",repeat:2,T:9},{no:2,name:"approved_stage_peers",kind:"scalar",repeat:2,T:9},{no:3,name:"requested_stage_peers",kind:"scalar",repeat:2,T:9}])}}const Xg=new e0;var Mu;(function(r){r[r.NONE=0]="NONE",r[r.SKIP=1]="SKIP",r[r.ON_PRIVILEGED_USER_ENTRY=2]="ON_PRIVILEGED_USER_ENTRY",r[r.SKIP_ON_ACCEPT=3]="SKIP_ON_ACCEPT"})(Mu||(Mu={}));var Ts;(function(r){r[r.NONE=0]="NONE",r[r.ALLOWED=1]="ALLOWED",r[r.NOT_ALLOWED=2]="NOT_ALLOWED",r[r.CAN_REQUEST=3]="CAN_REQUEST"})(Ts||(Ts={}));class t0 extends T{constructor(){super("socket.preset.PollsPermissionUpdate",[{no:1,name:"can_create",kind:"scalar",opt:!0,T:8},{no:2,name:"can_vote",kind:"scalar",opt:!0,T:8},{no:3,name:"can_view",kind:"scalar",opt:!0,T:8}])}}const r0=new t0;class s0 extends T{constructor(){super("socket.preset.PluginsPermissionsUpdate",[{no:1,name:"can_close",kind:"scalar",opt:!0,T:8},{no:2,name:"can_start",kind:"scalar",opt:!0,T:8}])}}const n0=new s0;class i0 extends T{constructor(){super("socket.preset.PublicChatPermission",[{no:1,name:"can_send",kind:"scalar",opt:!0,T:8},{no:2,name:"text",kind:"scalar",opt:!0,T:8},{no:3,name:"files",kind:"scalar",opt:!0,T:8}])}}const a0=new i0;class o0 extends T{constructor(){super("socket.preset.PrivateChatPermission",[{no:1,name:"can_send",kind:"scalar",opt:!0,T:8},{no:2,name:"can_receive",kind:"scalar",opt:!0,T:8},{no:3,name:"text",kind:"scalar",opt:!0,T:8},{no:4,name:"files",kind:"scalar",opt:!0,T:8}])}}const c0=new o0;class d0 extends T{constructor(){super("socket.preset.ChatPermissionUpdate",[{no:1,name:"public",kind:"message",T:()=>a0},{no:2,name:"private",kind:"message",T:()=>c0}])}}const l0=new d0;class u0 extends T{constructor(){super("socket.preset.ConnectedMeetingPermissionUpdate",[{no:1,name:"can_alter_connected_meetings",kind:"scalar",opt:!0,T:8},{no:2,name:"can_switch_to_parent_meeting",kind:"scalar",opt:!0,T:8},{no:3,name:"can_switch_connected_meetings",kind:"scalar",opt:!0,T:8}])}}const h0=new u0;class p0 extends T{constructor(){super("socket.preset.StreamPermission",[{no:1,name:"can_produce",kind:"enum",opt:!0,T:()=>["socket.preset.StreamPermissionType",Ts,"STREAM_PERMISSION_TYPE_"]},{no:2,name:"can_consume",kind:"enum",opt:!0,T:()=>["socket.preset.StreamPermissionType",Ts,"STREAM_PERMISSION_TYPE_"]}])}}const Du=new p0;class m0 extends T{constructor(){super("socket.preset.MediaPermissionUpdate",[{no:1,name:"video",kind:"message",T:()=>Du},{no:2,name:"audio",kind:"message",T:()=>Du},{no:3,name:"screenshare",kind:"message",T:()=>Du}])}}const f0=new m0;class g0 extends T{constructor(){super("socket.preset.PresetUpdates",[{no:1,name:"polls",kind:"message",T:()=>r0},{no:2,name:"plugins",kind:"message",T:()=>n0},{no:3,name:"chat",kind:"message",T:()=>l0},{no:4,name:"accept_waiting_requests",kind:"scalar",opt:!0,T:8},{no:5,name:"can_accept_production_requests",kind:"scalar",opt:!0,T:8},{no:6,name:"can_edit_display_name",kind:"scalar",opt:!0,T:8},{no:7,name:"can_record",kind:"scalar",opt:!0,T:8},{no:8,name:"can_livestream",kind:"scalar",opt:!0,T:8},{no:9,name:"can_spotlight",kind:"scalar",opt:!0,T:8},{no:10,name:"disable_participant_audio",kind:"scalar",opt:!0,T:8},{no:11,name:"disable_participant_screensharing",kind:"scalar",opt:!0,T:8},{no:12,name:"disable_participant_video",kind:"scalar",opt:!0,T:8},{no:13,name:"kick_participant",kind:"scalar",opt:!0,T:8},{no:14,name:"pin_participant",kind:"scalar",opt:!0,T:8},{no:15,name:"transcription_enabled",kind:"scalar",opt:!0,T:8},{no:16,name:"waiting_room_type",kind:"enum",opt:!0,T:()=>["socket.preset.WaitingRoomType",Mu,"WAITING_ROOM_TYPE_"]},{no:17,name:"is_recorder",kind:"scalar",opt:!0,T:8},{no:18,name:"recorder_type",kind:"enum",opt:!0,T:()=>["socket.room.RecorderType",Pu,"RECORDER_TYPE_"]},{no:19,name:"hidden_participant",kind:"scalar",opt:!0,T:8},{no:20,name:"show_participant_list",kind:"scalar",opt:!0,T:8},{no:21,name:"can_change_participant_permissions",kind:"scalar",opt:!0,T:8},{no:22,name:"connected_meetings",kind:"message",T:()=>h0},{no:23,name:"media",kind:"message",T:()=>f0}])}}const Ou=new g0;class v0 extends T{constructor(){super("socket.preset.ReadPeersPresetRequest",[{no:1,name:"user_ids",kind:"scalar",repeat:2,T:9}])}}const y0=new v0;class T0 extends T{constructor(){super("socket.preset.PeerPreset",[{no:1,name:"user_id",kind:"scalar",T:9},{no:2,name:"peer_id",kind:"scalar",T:9},{no:3,name:"preset",kind:"scalar",T:12}])}}const S0=new T0;class E0 extends T{constructor(){super("socket.preset.ReadPeersPresetResponse",[{no:1,name:"peer_presets",kind:"message",repeat:1,T:()=>S0}])}}const _0=new E0;class w0 extends T{constructor(){super("socket.preset.UpdatePeerPreset",[{no:1,name:"user_ids",kind:"scalar",T:9},{no:2,name:"patch",kind:"message",T:()=>Ou}])}}const Zg=new w0;class b0 extends T{constructor(){super("socket.preset.UpdatePeersPresetRequest",[{no:1,name:"update_peers_presets",kind:"message",repeat:1,T:()=>Zg}])}}const C0=new b0;class R0 extends T{constructor(){super("socket.preset.UpdatePeersPresetResponse",[{no:1,name:"update_peers_presets",kind:"message",repeat:1,T:()=>Zg}])}}const ev=new R0;class P0 extends T{constructor(){super("socket.preset.PeerUserIDMap",[{no:1,name:"peer_id",kind:"scalar",T:9},{no:2,name:"user_id",kind:"scalar",T:9}])}}const k0=new P0;class I0 extends T{constructor(){super("socket.preset.BulkUpdatePeerPresetRequest",[{no:1,name:"peers",kind:"message",repeat:1,T:()=>k0},{no:2,name:"patch",kind:"message",T:()=>Ou}])}}new I0;class A0 extends T{constructor(){super("socket.preset.BulkUpdatePeerPresetResponse",[{no:2,name:"patch",kind:"message",T:()=>Ou}])}}new A0;class M0 extends T{constructor(){super("socket.chat.ChatMessage",[{no:1,name:"chat_id",kind:"scalar",T:9},{no:2,name:"peer_id",kind:"scalar",T:9},{no:3,name:"user_id",kind:"scalar",T:9},{no:4,name:"display_name",kind:"scalar",T:9},{no:5,name:"pinned",kind:"scalar",T:8},{no:6,name:"is_edited",kind:"scalar",T:8},{no:7,name:"payload_type",kind:"scalar",T:5},{no:8,name:"payload",kind:"scalar",T:9},{no:10,name:"target_user_ids",kind:"scalar",repeat:2,T:9},{no:11,name:"created_at",kind:"scalar",T:4,L:2},{no:12,name:"created_at_ms",kind:"scalar",opt:!0,T:4,L:2},{no:13,name:"channel_id",kind:"scalar",opt:!0,T:9},{no:14,name:"channel_index",kind:"scalar",opt:!0,T:9}])}}const nn=new M0;class D0 extends T{constructor(){super("socket.chat.GetPaginatedChatMessageRoomRequest",[{no:1,name:"time_stamp",kind:"scalar",T:4,L:2},{no:2,name:"size",kind:"scalar",T:5},{no:3,name:"from",kind:"scalar",T:5},{no:4,name:"reversed",kind:"scalar",T:8},{no:5,name:"channel_id",kind:"scalar",opt:!0,T:9}])}}const O0=new D0;class N0 extends T{constructor(){super("socket.chat.GetPaginatedChatMessageRoomResponse",[{no:1,name:"messages",kind:"message",repeat:1,T:()=>nn},{no:2,name:"next",kind:"scalar",T:8}])}}const L0=new N0;class x0 extends T{constructor(){super("socket.chat.GetChatMessagesResponse",[{no:1,name:"messages",kind:"message",repeat:1,T:()=>nn}])}}const tv=new x0;class F0 extends T{constructor(){super("socket.chat.SendChatMessageToRoomRequest",[{no:1,name:"payload_type",kind:"scalar",T:5},{no:2,name:"payload",kind:"scalar",T:9}])}}const $0=new F0;class U0 extends T{constructor(){super("socket.chat.SendChatMessageToRoomResponse",[{no:1,name:"message",kind:"message",T:()=>nn}])}}const Nu=new U0;class V0 extends T{constructor(){super("socket.chat.SendChatMessageToPeersRequest",[{no:1,name:"peer_ids",kind:"scalar",repeat:2,T:9},{no:2,name:"payload_type",kind:"scalar",T:5},{no:3,name:"payload",kind:"scalar",T:9}])}}const B0=new V0;class H0 extends T{constructor(){super("socket.chat.SendChatMessageToPeersResponse",[{no:1,name:"message",kind:"message",T:()=>nn}])}}const Lu=new H0;class q0 extends T{constructor(){super("socket.chat.SendChatMessageToChannelRequest",[{no:1,name:"channel_id",kind:"scalar",T:9},{no:2,name:"payload_type",kind:"scalar",T:5},{no:3,name:"payload",kind:"scalar",T:9}])}}const j0=new q0;class G0 extends T{constructor(){super("socket.chat.SendChatMessageToChannelResponse",[{no:1,name:"message",kind:"message",T:()=>nn}])}}new G0;class W0 extends T{constructor(){super("socket.chat.EditChatMessageRequest",[{no:1,name:"chat_id",kind:"scalar",T:9},{no:2,name:"payload_type",kind:"scalar",opt:!0,T:5},{no:3,name:"payload",kind:"scalar",opt:!0,T:9},{no:4,name:"pinned",kind:"scalar",opt:!0,T:8},{no:5,name:"channel_id",kind:"scalar",opt:!0,T:9}])}}const J0=new W0;class K0 extends T{constructor(){super("socket.chat.PinChatMessageRequest",[{no:1,name:"chat_id",kind:"scalar",T:9},{no:2,name:"pinned",kind:"scalar",T:8},{no:3,name:"channel_id",kind:"scalar",opt:!0,T:9}])}}const z0=new K0;class Y0 extends T{constructor(){super("socket.chat.PinChatMessageResponse",[{no:1,name:"chat_id",kind:"scalar",T:9},{no:2,name:"pinned",kind:"scalar",T:8},{no:3,name:"channel_id",kind:"scalar",opt:!0,T:9}])}}const Hc=new Y0;class Q0 extends T{constructor(){super("socket.chat.EditChatMessageResponse",[{no:1,name:"message",kind:"message",T:()=>nn}])}}const qc=new Q0;class X0 extends T{constructor(){super("socket.chat.DeleteChatMessageRequest",[{no:1,name:"chat_id",kind:"scalar",T:9},{no:2,name:"channel_id",kind:"scalar",opt:!0,T:9}])}}const Z0=new X0;class eM extends T{constructor(){super("socket.chat.DeleteChatMessageResponse",[{no:1,name:"chat_id",kind:"scalar",T:9},{no:2,name:"channel_id",kind:"scalar",opt:!0,T:9}])}}const jc=new eM;class tM extends T{constructor(){super("socket.chat.SearchChatMessagesRequest",[{no:1,name:"time_stamp",kind:"scalar",T:4,L:2},{no:2,name:"size",kind:"scalar",T:5},{no:3,name:"from",kind:"scalar",T:5},{no:4,name:"reversed",kind:"scalar",T:8},{no:5,name:"channel_id",kind:"scalar",opt:!0,T:9},{no:6,name:"search_term",kind:"scalar",T:9}])}}const rM=new tM;class sM extends T{constructor(){super("socket.chat.MarkChannelIndexAsReadRequest",[{no:1,name:"channel_id",kind:"scalar",T:9},{no:2,name:"user_id",kind:"scalar",T:9},{no:3,name:"channel_index",kind:"scalar",T:9}])}}const nM=new sM;class iM extends T{constructor(){super("socket.chat.MarkChannelIndexAsReadResponse",[{no:1,name:"channel_index",kind:"scalar",T:9}])}}const aM=new iM;class oM extends T{constructor(){super("socket.chat.CreateChatChannelRequest",[{no:1,name:"display_name",kind:"scalar",T:9},{no:2,name:"target_user_ids",kind:"scalar",repeat:2,T:9},{no:3,name:"display_picture_url",kind:"scalar",opt:!0,T:9},{no:4,name:"visibility",kind:"scalar",T:9},{no:5,name:"is_direct_message",kind:"scalar",T:8}])}}const cM=new oM;class dM extends T{constructor(){super("socket.chat.UpdateChatChannelRequest",[{no:1,name:"chat_channel_id",kind:"scalar",T:9},{no:2,name:"display_name",kind:"scalar",opt:!0,T:9},{no:3,name:"target_user_ids",kind:"scalar",repeat:2,T:9},{no:4,name:"display_picture_url",kind:"scalar",opt:!0,T:9},{no:5,name:"visibility",kind:"scalar",opt:!0,T:9},{no:6,name:"is_direct_message",kind:"scalar",opt:!0,T:8}])}}const lM=new dM;class uM extends T{constructor(){super("socket.chat.CreateChatChannelResponse",[{no:1,name:"chat_channel_id",kind:"scalar",T:9}])}}new uM;class hM extends T{constructor(){super("socket.chat.GetChatChannelRequest",[{no:1,name:"chat_channel_id",kind:"scalar",T:9}])}}const pM=new hM;class mM extends T{constructor(){super("socket.chat.LatestMessageAndUnreadCount",[{no:1,name:"message",kind:"message",T:()=>nn},{no:2,name:"unread_count",kind:"scalar",T:4,L:2}])}}const fM=new mM;class gM extends T{constructor(){super("socket.chat.ChatChannel",[{no:1,name:"chat_channel_id",kind:"scalar",T:9},{no:2,name:"display_name",kind:"scalar",T:9},{no:3,name:"display_picture_url",kind:"scalar",opt:!0,T:9},{no:4,name:"visibility",kind:"scalar",T:9},{no:5,name:"is_direct_message",kind:"scalar",T:8},{no:6,name:"latest_message_and_unread_count",kind:"message",T:()=>fM},{no:7,name:"target_user_ids",kind:"scalar",repeat:2,T:9}])}}const vM=new gM;class yM extends T{constructor(){super("socket.chat.GetChatChannelResponse",[{no:1,name:"chat_channels",kind:"message",repeat:1,T:()=>vM}])}}const jr=new yM;class TM extends T{constructor(){super("socket.chat.ChannelMember",[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",opt:!0,T:9},{no:3,name:"picture",kind:"scalar",opt:!0,T:9},{no:4,name:"custom_participant_id",kind:"scalar",T:9}])}}const SM=new TM;class EM extends T{constructor(){super("socket.chat.GetChatChannelMembersResponse",[{no:1,name:"channel_members",kind:"message",repeat:1,T:()=>SM}])}}const _M=new EM;class wM extends T{constructor(){super("socket.plugin.AddPluginRequest",[{no:1,name:"plugin_id",kind:"scalar",T:9},{no:2,name:"staggered",kind:"scalar",T:8}])}}const bM=new wM;class CM extends T{constructor(){super("socket.plugin.RemovePluginRequest",[{no:1,name:"plugin_id",kind:"scalar",T:9},{no:2,name:"staggered",kind:"scalar",T:8}])}}const RM=new CM;class PM extends T{constructor(){super("socket.plugin.EnablePluginForRoomRequest",[{no:1,name:"plugin_id",kind:"scalar",T:9}])}}const kM=new PM;class IM extends T{constructor(){super("socket.plugin.DisablePluginForRoomRequest",[{no:1,name:"plugin_id",kind:"scalar",T:9}])}}const AM=new IM;class MM extends T{constructor(){super("socket.plugin.EnablePluginForPeersRequest",[{no:1,name:"plugin_id",kind:"scalar",T:9},{no:2,name:"peer_ids",kind:"scalar",repeat:2,T:9}])}}const DM=new MM;class OM extends T{constructor(){super("socket.plugin.DisablePluginForPeersRequest",[{no:1,name:"plugin_id",kind:"scalar",T:9},{no:2,name:"peer_ids",kind:"scalar",repeat:2,T:9}])}}const NM=new OM;class LM extends T{constructor(){super("socket.plugin.PluginEventToRoomRequest",[{no:1,name:"plugin_id",kind:"scalar",T:9},{no:2,name:"plugin_data",kind:"scalar",T:12}])}}const xM=new LM;class FM extends T{constructor(){super("socket.plugin.PluginEventToPeersRequest",[{no:1,name:"plugin_id",kind:"scalar",T:9},{no:2,name:"peer_ids",kind:"scalar",repeat:2,T:9},{no:3,name:"plugin_data",kind:"scalar",T:12}])}}const $M=new FM;class UM extends T{constructor(){super("socket.plugin.StoreKeys",[{no:1,name:"store_key",kind:"scalar",T:9},{no:2,name:"payload",kind:"scalar",opt:!0,T:12}])}}const xu=new UM;class VM extends T{constructor(){super("socket.plugin.PluginStoreInsertKeysRequest",[{no:1,name:"plugin_id",kind:"scalar",T:9},{no:2,name:"store_name",kind:"scalar",T:9},{no:3,name:"insert_keys",kind:"message",repeat:1,T:()=>xu}])}}const rv=new VM;class BM extends T{constructor(){super("socket.plugin.PluginStoreGetKeysRequest",[{no:1,name:"plugin_id",kind:"scalar",T:9},{no:2,name:"store_name",kind:"scalar",T:9},{no:3,name:"get_keys",kind:"message",repeat:1,T:()=>xu}])}}const HM=new BM;class qM extends T{constructor(){super("socket.plugin.PluginStoreDeleteKeysRequest",[{no:1,name:"plugin_id",kind:"scalar",T:9},{no:2,name:"store_name",kind:"scalar",T:9},{no:3,name:"delete_keys",kind:"message",repeat:1,T:()=>xu}])}}const jM=new qM;class GM extends T{constructor(){super("socket.plugin.PluginStoreDeleteRequest",[{no:1,name:"plugin_id",kind:"scalar",T:9},{no:2,name:"store_name",kind:"scalar",T:9}])}}const WM=new GM;class JM extends T{constructor(){super("socket.plugin.EnablePluginResponse",[{no:1,name:"plugin_id",kind:"scalar",T:9},{no:2,name:"enabled_by",kind:"scalar",T:9}])}}const Fu=new JM;class KM extends T{constructor(){super("socket.plugin.EnablePluginsResponse",[{no:1,name:"plugins",kind:"message",repeat:1,T:()=>Fu}])}}const zM=new KM;class YM extends T{constructor(){super("socket.plugin.DisablePluginResponse",[{no:1,name:"plugin_id",kind:"scalar",T:9},{no:2,name:"disabled_by",kind:"scalar",T:9}])}}const sv=new YM;class QM extends T{constructor(){super("socket.plugin.PluginStoreItem",[{no:1,name:"timestamp",kind:"scalar",T:9},{no:2,name:"peer_id",kind:"scalar",T:9},{no:3,name:"store_key",kind:"scalar",T:9},{no:4,name:"payload",kind:"scalar",T:12}])}}const XM=new QM;class ZM extends T{constructor(){super("socket.plugin.PluginStoreResponse",[{no:1,name:"plugin_id",kind:"scalar",T:9},{no:2,name:"store_name",kind:"scalar",T:9},{no:3,name:"store_items",kind:"message",repeat:1,T:()=>XM}])}}const nv=new ZM;class eD extends T{constructor(){super("socket.plugin.PluginEventResponse",[{no:1,name:"plugin_id",kind:"scalar",T:9},{no:2,name:"plugin_data",kind:"scalar",T:12}])}}const iv=new eD;class tD extends T{constructor(){super("socket.livestreaming.LiveStreamingEvent",[{no:1,name:"livestream_id",kind:"scalar",T:9},{no:2,name:"err_message",kind:"scalar",T:9},{no:3,name:"name",kind:"scalar",T:9},{no:4,name:"meeting_id",kind:"scalar",T:9},{no:5,name:"playback_url",kind:"scalar",T:9},{no:6,name:"org_id",kind:"scalar",T:9},{no:7,name:"room_name",kind:"scalar",T:9},{no:8,name:"room_uuid",kind:"scalar",T:9},{no:9,name:"status",kind:"scalar",T:9},{no:10,name:"manual_ingest",kind:"scalar",opt:!0,T:8}])}}const av=new tD;class rD extends T{constructor(){super("socket.livestreaming.GetStagePeersResponse",[{no:1,name:"stage_peers",kind:"scalar",repeat:2,T:9}])}}const ov=new rD;class sD extends T{constructor(){super("socket.livestreaming.StageRequest",[{no:1,name:"display_name",kind:"scalar",T:9},{no:2,name:"user_id",kind:"scalar",T:9},{no:3,name:"peer_id",kind:"scalar",T:9}])}}const nD=new sD;class iD extends T{constructor(){super("socket.livestreaming.GetStageRequestsResponse",[{no:1,name:"stage_requests",kind:"message",repeat:1,T:()=>nD}])}}const $u=new iD;class aD extends T{constructor(){super("socket.livestreaming.GrantStageAccessRequest",[{no:1,name:"user_ids",kind:"scalar",repeat:2,T:9}])}}const oD=new aD;class cD extends T{constructor(){super("socket.livestreaming.DenyStageAccessRequest",[{no:1,name:"user_ids",kind:"scalar",repeat:2,T:9}])}}const dD=new cD;class lD extends T{constructor(){super("socket.livestreaming.LeaveStageRequest",[{no:1,name:"user_ids",kind:"scalar",repeat:2,T:9}])}}const cv=new lD;class uD extends T{constructor(){super("socket.polls.Poll",[{no:1,name:"poll_id",kind:"scalar",T:9},{no:2,name:"created_by",kind:"scalar",T:9},{no:3,name:"created_by_user_id",kind:"scalar",T:9},{no:4,name:"question",kind:"scalar",T:9},{no:5,name:"options",kind:"message",repeat:1,T:()=>pD},{no:6,name:"hide_votes",kind:"scalar",T:8},{no:7,name:"anonymous",kind:"scalar",T:8},{no:8,name:"votes",kind:"scalar",repeat:2,T:9}])}}const dv=new uD;class hD extends T{constructor(){super("socket.polls.PollOption",[{no:1,name:"text",kind:"scalar",T:9},{no:2,name:"count",kind:"scalar",opt:!0,T:4,L:2},{no:3,name:"votes",kind:"message",repeat:1,T:()=>fD}])}}const pD=new hD;class mD extends T{constructor(){super("socket.polls.PollVote",[{no:1,name:"user_id",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9}])}}const fD=new mD;class gD extends T{constructor(){super("socket.polls.NewPollRequest",[{no:1,name:"question",kind:"scalar",T:9},{no:2,name:"options",kind:"scalar",repeat:2,T:9},{no:3,name:"anonymous",kind:"scalar",T:8},{no:4,name:"hide_votes",kind:"scalar",T:8},{no:5,name:"created_by",kind:"scalar",opt:!0,T:9},{no:6,name:"created_by_user_id",kind:"scalar",opt:!0,T:9}])}}const vD=new gD;class yD extends T{constructor(){super("socket.polls.VotePollRequest",[{no:1,name:"poll_id",kind:"scalar",T:9},{no:2,name:"index",kind:"scalar",T:4,L:2}])}}const TD=new yD;class SD extends T{constructor(){super("socket.polls.UpdatePollResponse",[{no:1,name:"poll",kind:"message",T:()=>dv}])}}const Uu=new SD;class ED extends T{constructor(){super("socket.polls.GetPollsResponse",[{no:1,name:"polls",kind:"message",repeat:1,T:()=>dv}])}}const _D=new ED;class wD extends T{constructor(){super("socket.recording.RecordingEvent",[{no:1,name:"recording_id",kind:"scalar",T:9},{no:2,name:"err_message",kind:"scalar",T:9},{no:3,name:"recording_type",kind:"enum",T:()=>["common.RecordingType",sn]}])}}const lv=new wD;class bD extends T{constructor(){super("google.protobuf.Timestamp",[{no:1,name:"seconds",kind:"scalar",T:3,L:0},{no:2,name:"nanos",kind:"scalar",T:5}])}now(){const t=this.create(),e=Date.now();return t.seconds=we.from(Math.floor(e/1e3)).toBigInt(),t.nanos=e%1e3*1e6,t}toDate(t){return new Date(we.from(t.seconds).toNumber()*1e3+Math.ceil(t.nanos/1e6))}fromDate(t){const e=this.create(),s=t.getTime();return e.seconds=we.from(Math.floor(s/1e3)).toBigInt(),e.nanos=s%1e3*1e6,e}internalJsonWrite(t,e){let s=we.from(t.seconds).toNumber()*1e3;if(s<Date.parse("0001-01-01T00:00:00Z")||s>Date.parse("9999-12-31T23:59:59Z"))throw new Error("Unable to encode Timestamp to JSON. Must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive.");if(t.nanos<0)throw new Error("Unable to encode invalid Timestamp to JSON. Nanos must not be negative.");let n="Z";if(t.nanos>0){let i=(t.nanos+1e9).toString().substring(1);i.substring(3)==="000000"?n="."+i.substring(0,3)+"Z":i.substring(6)==="000"?n="."+i.substring(0,6)+"Z":n="."+i+"Z"}return new Date(s).toISOString().replace(".000Z",n)}internalJsonRead(t,e,s){if(typeof t!="string")throw new Error("Unable to parse Timestamp from JSON "+gu(t)+".");let n=t.match(/^([0-9]{4})-([0-9]{2})-([0-9]{2})T([0-9]{2}):([0-9]{2}):([0-9]{2})(?:Z|\.([0-9]{3,9})Z|([+-][0-9][0-9]:[0-9][0-9]))$/);if(!n)throw new Error("Unable to parse Timestamp from JSON. Invalid format.");let i=Date.parse(n[1]+"-"+n[2]+"-"+n[3]+"T"+n[4]+":"+n[5]+":"+n[6]+(n[8]?n[8]:"Z"));if(Number.isNaN(i))throw new Error("Unable to parse Timestamp from JSON. Invalid value.");if(i<Date.parse("0001-01-01T00:00:00Z")||i>Date.parse("9999-12-31T23:59:59Z"))throw new globalThis.Error("Unable to parse Timestamp from JSON. Must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive.");return s||(s=this.create()),s.seconds=we.from(i/1e3).toBigInt(),s.nanos=0,n[7]&&(s.nanos=parseInt("1"+n[7]+"0".repeat(9-n[7].length))-1e9),s}}new bD;const CD=0,RD=1,PD=2,kD=3,ID=4,AD=5,MD={getPeerInfo:0,updatePeerInfo:1,getRoomPeersInfo:2,joinRoom:3,leaveRoom:4,getRoomInfo:5,updateRoomInfo:6,closeRoom:7,startedLivestream:8,stoppedLivestream:9,erroredLivestream:10,getStagePeers:11,getStageRequests:12,requestStageAccess:13,cancelStageRequest:14,grantStageAccess:15,denyStageAccess:16,roomPeerCount:17,joinStage:18,leaveStage:19,getConnectedRoomsDump:20,createConnectedRooms:21,deleteConnectedRooms:22,movePeers:23,transferPeer:24,movedPeer:25,connectedRoomsUpdated:26,connectedRoomsDeleted:27,getAllAddedParticipants:28,broadcastMessage:29,kick:30,kickAll:31,transcript:32,getWaitingRoomRequests:33,acceptWaitingRoomRequests:34,waitingRoomRequestAccepted:35,denyWaitingRoomRequests:36,waitingRoomRequestDenied:37,peerStageStatusUpdate:38,broadcastToEntity:39,recordingStarted:40,recordingStopped:41,recordingPaused:42,getRoomStageState:43,livestreamingInvoked:44},DD={getMessages:0,sendMessageToRoom:1,sendMessageToPeers:2,editMessage:3,deleteMessage:4,getPaginatedMessages:5,sendMessageToChannel:6,searchChannelMessages:7,getAllChatChannels:8,markChannelIndexAsRead:9,pinMessage:10},OD={getPlugins:0,addPlugin:1,enablePluginForRoom:2,disablePluginForPeers:3,enablePluginForPeers:4,disablePluginForRoom:5,removePlugin:6,customPluginEventToRoom:7,customPluginEventToPeers:8,storeInsertKeys:9,storeGetKeys:10,storeDeleteKeys:11,storeDelete:12},ND={createPoll:0,getPolls:1,votePoll:2,updatePoll:3},uv={unknown:0,createWebRTCTransport:1,produce:2,consume:3,toggleProducer:4,toggleConsumer:5,closeProducer:6,closeConsumer:7,joinRoom:16,leaveRoom:17,selectedPeer:18,globalPinPeer:19,selfJoinComplete:20,peerJoinedBroadcast:25,peerLeaveBroadcast:26,peerProducerCreateBroadcast:27,peerProducerToggleBroadcast:28,peerProducerCloseBroadcast:29,globalPeerPinBroadcast:30,recordingStartedBroadcast:31,recordingStoppedBroadcast:32,peerDisplayNameEditBroadcast:33,mediaRoomTerminationBroadcastResponse:36,selectedPeerDiff:40,renegotiateSessionDescription:50,errorResponse:60,kickPeer:90,kickAll:91,changeDisplayName:92,hostControlPeer:93,hostControlAllPeers:94},LD={createChatChannel:0,getChatChannel:1,deprecatedGetAllChatChannels:2,getChannelMembers:3,updateChatChannel:4},xD={getUserPresets:0,updateUserPreset:1};function ii(r,t){return Object.keys(t).reduce((e,s)=>(e[s]=(r<<16)+t[s],e),{})}function hv(r,t){return Object.keys(r).reduce((e,s)=>(e[s]=t|r[s],e),{})}const U=ii(CD,MD),xe=ii(RD,DD),G=ii(PD,OD),Gr=ii(kD,ND),an=ii(ID,LD),Te=hv(uv,16777216),Pe=hv(uv,50331648),Gc=ii(AD,xD);var FD=Object.defineProperty,$D=Object.getOwnPropertyDescriptor,Vu=(r,t,e,s)=>{for(var n=s>1?void 0:s?$D(t,e):t,i=r.length-1,a;i>=0;i--)(a=r[i])&&(n=(s?a(t,e,n):a(n))||n);return s&&n&&FD(t,e,n),n};const Bu=(ky=class{constructor(r){E(this,Ds,void 0);y(this,Ds,r)}async createChannel(r,t,e,s="public",n=!1){const i={displayName:r,targetUserIds:t,displayPictureUrl:e,visibility:s,isDirectMessage:n};n&&(i.visibility="private");const a=await d(this,Ds).sendMessagePromise(an.createChatChannel,cM.toBinary(i)),o=jr.fromBinary(a.payload).chatChannels;return Bu.formatChannel(o[0])}async updateChannel(r,t){const e=await d(this,Ds).sendMessagePromise(an.updateChatChannel,lM.toBinary({chatChannelId:r,targetUserIds:t.memberIds,displayName:t.displayName,displayPictureUrl:t.displayPictureUrl,visibility:t.visibility})),s=jr.fromBinary(e.payload).chatChannels;return Bu.formatChannel(s[0])}static formatChannel(r){var s;const{latestMessageAndUnreadCount:t}=r,e={...r,id:r.chatChannelId,memberIds:r.targetUserIds,unreadCount:(s=t==null?void 0:t.unreadCount)!=null?s:0};return t!=null&&t.message&&(e.latestMessage=gr.formatSocketServiceMessage(t.message)),delete e.chatChannelId,delete e.targetUserIds,delete e.latestMessageAndUnreadCount,e}async getChannelMembers(r){try{const t=await d(this,Ds).sendMessagePromise(an.getChannelMembers,pM.toBinary({chatChannelId:r}));return _M.fromBinary(t.payload).channelMembers.map(({id:e,...s})=>({...s,userId:e}))}catch(t){return[]}}on(r,t){let e,s;switch(r){case an.createChatChannel:{e=jr.fromBinary.bind(jr),s=jr.create();break}case an.updateChatChannel:{e=jr.fromBinary.bind(jr),s=jr.create();break}}if(!e){u.warn(`ChatChannelSocketHandler::Event ${r} is not recognized`);return}d(this,Ds).on(r,({payload:n})=>{let i=s;try{i=e(n)}catch(a){u.error("ChatChannelSocketHandler::on::binary_decode_error",{error:a})}return t(i)})}},Ds=new WeakMap,ky);let on=Bu;Vu([v.trace("ChatChannelHandler.createChannel")],on.prototype,"createChannel",1),Vu([v.trace("ChatChannelHandler.updateChannel")],on.prototype,"updateChannel",1),Vu([v.trace("ChatChannelHandler.getChannelMembers")],on.prototype,"getChannelMembers",1);var UD=Object.defineProperty,VD=Object.getOwnPropertyDescriptor,mr=(r,t,e,s)=>{for(var n=s>1?void 0:s?VD(t,e):t,i=r.length-1,a;i>=0;i--)(a=r[i])&&(n=(s?a(t,e,n):a(n))||n);return s&&n&&UD(t,e,n),n},Pt=(r=>(r[r.TEXT=0]="TEXT",r[r.IMAGE=1]="IMAGE",r[r.FILE=2]="FILE",r[r.CUSTOM=3]="CUSTOM",r))(Pt||{});class Qt{constructor(t){E(this,Tt,void 0);y(this,Tt,t)}getChatMessages(){return d(this,Tt).sendMessagePromise(xe.getMessages)}async getChatMessagesPaginated(t,e,s,n=0,i=""){const a={timeStamp:t,size:e,from:n,reversed:s,channelId:i},o=await d(this,Tt).sendMessagePromise(xe.getPaginatedMessages,O0.toBinary(a));return o.payload?L0.fromBinary(o.payload):{messages:[],next:!1}}sendMessageToRoom(t,e){const s={payloadType:e,payload:t};d(this,Tt).sendMessage(xe.sendMessageToRoom,$0.toBinary(s))}sendMessageToPeers(t,e,s){const n={payloadType:e,peerIds:s,payload:t};d(this,Tt).sendMessage(xe.sendMessageToPeers,B0.toBinary(n))}sendMessageToChannel(t,e,s){const n={payloadType:e,channelId:s,payload:t};d(this,Tt).sendMessage(xe.sendMessageToChannel,j0.toBinary(n))}sendMessage(t,e,s,n){if(n&&this.sendMessageToChannel(t,e,n),s&&s.length>0){this.sendMessageToPeers(t,e,s);return}this.sendMessageToRoom(t,e)}async editMessage(t,e,s,n,i){const a={chatId:t,payloadType:s,payload:e};n&&(a.channelId=n),i!==void 0&&(a.pinned=i);const o=await d(this,Tt).sendMessagePromise(xe.editMessage,J0.toBinary(a));return qc.fromBinary(o.payload).message}async deleteMessage(t,e){const s={chatId:t};e&&(s.channelId=e);const n=await d(this,Tt).sendMessagePromise(xe.deleteMessage,Z0.toBinary(s)),i=jc.fromBinary(n.payload);return{id:i.chatId,...i.channelId?{channelId:i.channelId}:{}}}async searchMessages(t,e){var n,i,a;const s={searchTerm:t,timeStamp:(n=e.timestamp)!=null?n:Date.now(),size:(i=e.size)!=null?i:75,from:0,reversed:(a=e.reversed)!=null?a:!0};e.channelId&&(s.channelId=e.channelId);try{const o=await d(this,Tt).sendMessagePromise(xe.searchChannelMessages,rM.toBinary(s));return tv.fromBinary(o.payload).messages}catch(o){return[]}}async getAllChannels(){try{const t=await d(this,Tt).sendMessagePromise(xe.getAllChatChannels);return jr.fromBinary(t.payload).chatChannels.map(on.formatChannel)}catch(t){return[]}}async markLastReadMessage(t,e){const s=await d(this,Tt).sendMessagePromise(xe.markChannelIndexAsRead,nM.toBinary({channelId:t,userId:e.userId,channelIndex:e.channelIndex}));return aM.fromBinary(s.payload).channelIndex}async setPinState(t,e){const s={chatId:t.id,pinned:e,channelId:t.channelId},n=await d(this,Tt).sendMessagePromise(xe.pinMessage,z0.toBinary(s));return Hc.fromBinary(n.payload)}on(t,e){let s,n;switch(t){case xe.sendMessageToRoom:{s=Nu.fromBinary.bind(Nu),n=Nu.create();break}case xe.sendMessageToPeers:{s=Lu.fromBinary.bind(Lu),n=Lu.create();break}case xe.editMessage:{s=qc.fromBinary.bind(qc),n=qc.create();break}case xe.pinMessage:{s=Hc.fromBinary.bind(Hc),n=Hc.create();break}case xe.deleteMessage:{s=jc.fromBinary.bind(jc),n=jc.create();break}}if(!s){u.warn(`ChatSocketHandler::Event ${t} is not recognized`);return}d(this,Tt).on(t,({payload:i})=>{let a=n;try{a=s(i)}catch(o){u.error("chatSocketHandler::on::binary_decode_error",{error:o})}return e(a)})}}Tt=new WeakMap,mr([v.trace("SocketService.getChatMessages")],Qt.prototype,"getChatMessages",1),mr([v.trace("SocketService.getChatMessagesPaginated")],Qt.prototype,"getChatMessagesPaginated",1),mr([v.trace("SocketService.sendMessageToRoom")],Qt.prototype,"sendMessageToRoom",1),mr([v.trace("SocketService.sendMessageToPeers")],Qt.prototype,"sendMessageToPeers",1),mr([v.trace("SocketService.sendMessageToChannel")],Qt.prototype,"sendMessageToChannel",1),mr([v.trace("SocketService.sendMessage")],Qt.prototype,"sendMessage",1),mr([v.trace("SocketService.editMessage")],Qt.prototype,"editMessage",1),mr([v.trace("SocketService.deleteMessage")],Qt.prototype,"deleteMessage",1),mr([v.trace("SocketService.searchMessages")],Qt.prototype,"searchMessages",1),mr([v.trace("SocketService.getAllChannels")],Qt.prototype,"getAllChannels",1),mr([v.trace("SocketService.markLastReadMessage")],Qt.prototype,"markLastReadMessage",1);function BD(r){return r.replace(/([-_]\w)/g,t=>t[1].toUpperCase())}function fr(r){if(!r||typeof r!="object")return r;if(Array.isArray(r))return r.map(e=>fr(e));const t={};return Object.keys(r).forEach(e=>{const s=Yd(e)?e:BD(e);t[s]=fr(r[e])}),t}function HD(r){return r.replace(/[A-Z]/g,t=>`_${t.toLowerCase()}`)}function pv(r){if(!r||typeof r!="object")return r;if(Array.isArray(r))return r.map(e=>pv(e));const t={};return Object.keys(r).forEach(e=>{const s=Yd(e)?e:HD(e);t[s]=r[e]}),t}function Wc(r,t={}){return r==null?{}:(Object.getOwnPropertyNames(r).forEach(e=>{if(typeof r[e]!="function"){if(typeof r[e]=="object"){Wc(r[e],t[e]={});return}t[e]=r[e]}}),t)}const qD=3,jD=30,GD=8e3;class WD{constructor(t,e){m(this,"ipInfo");m(this,"axios");m(this,"requests");m(this,"roomName");m(this,"roomUUID");m(this,"authToken");m(this,"organizationId");m(this,"iceServers");m(this,"pluginInformation");m(this,"userDetails");m(this,"roomDetails");m(this,"context");this.context=t;const{timeout:s=GD,retry:n=qD,retryDelay:i=jD,baseURL:a="https://api.cluster.dyte.in",authToken:o,cachedUserDetails:c}=e||{};this.iceServers=c==null?void 0:c.iceServers,this.pluginInformation=c==null?void 0:c.pluginInformation,this.userDetails=c==null?void 0:c.userDetails,this.roomDetails=c==null?void 0:c.roomDetails,this.requests=cu.create({baseURL:a,responseType:"json",timeout:s,retry:n,retryDelay:i}),this.axios=cu,this.setAuthToken(o,{bearer:!0}),this.requests.interceptors.request.use(l=>(v.injectContext(this.requests.defaults.headers.common),l),async l=>{u.error("xhr::axios",{debuggingHint:"otelRequestInterceptor failed.",error:l})}),this.requests.interceptors.response.use(l=>{try{l.config.url!==v.logsEndpoint&&u.debug("xhr::axios",{networkCall:{status:l.status,statusText:l.statusText,baseURL:l.config.baseURL,url:l.config.url,method:l.config.method}})}catch(p){console.error("xhr::dyte",{error:"responseInterceptorFailed",err:p,response:l})}return l},async l=>{var p;try{if(!l)return Promise.reject(new I("Unknown network error occurred","0011"));l&&l.config&&((p=l.config)==null?void 0:p.url)!==v.logsEndpoint&&u.error("xhr::axios",{error:l,networkCall:{status:l.status,statusText:l.statusText,baseURL:l.config.baseURL,url:l.config.url,retries:l.config.retry,method:l.config.method,isOnline:navigator.onLine?"online":"offline"}});const{config:h,message:f}=l;return h&&f&&h.retry!==void 0&&h.retry>0&&(f.includes("timeout")||f.includes("Network Error"))?(h.retry-=1,this.requests(h)):Promise.reject(new I(f,"0011"))}catch(h){return console.error("xhr::dyte",{error:"responseInterceptorFailed",err:h,responseError:l}),Promise.reject(new I(h.message,"0011"))}})}get peerId(){return this.context.getValue("peerId")}setAuthToken(t,e){const{bearer:s}=e||{};this.authToken=t,this.requests.defaults.headers.common.Authorization=s?`Bearer ${t}`:t}setHeader(t,e){this.requests.defaults.headers.common[t]=e}setRoomName(t){this.roomName=t}setRoomUUID(t){this.roomUUID=t}setOrganizationId(t){this.organizationId=t}}var JD=Object.defineProperty,KD=Object.getOwnPropertyDescriptor,Hu=(r,t,e,s)=>{for(var n=s>1?void 0:s?KD(t,e):t,i=r.length-1,a;i>=0;i--)(a=r[i])&&(n=(s?a(t,e,n):a(n))||n);return s&&n&&JD(t,e,n),n};class Jc extends WD{constructor(t,e){super(t,e),this.setHeader("x-dyte-web-core-version",t.getValue("sdkVersion"))}async getIPDetails(){var e;const{peerId:t}=this;try{const s=await zd.getIPDetails({peerId:t,apiHostnames:zf(this.context),logger:u});if(u.log("ipInfo",{ipInfo:s}),((e=s==null?void 0:s.loc)==null?void 0:e.length)>5)return s;throw Error("Insufficient data")}catch(s){u.warn("ApiClient.getRoomNodeLinkAndTitleV1 Failed to get ip details",{error:{name:s.name,message:s.message}});return}}async getICEServers(){if(this.iceServers)return this.iceServers;const{success:t,iceServers:e}=(await this.requests.get("/iceservers")).data;if(t)return(e==null?void 0:e.length)>0&&(this.iceServers=e),e}async getPlugins(){var n,i,a,o,c,l,p;if(this.pluginInformation)return this.pluginInformation;const{plugins:t}=(await this.requests.get("/v2/plugins/user")).data.data,e=((i=(n=J.getValue(Z.V1_PLUGINS))==null?void 0:n.toString())==null?void 0:i.split(","))||[],s=t.reduce((h,f)=>(h[e.includes(f.id)?"v1":"v2"].push({...f,name:f.name.replace("v2","")}),h),{v1:[],v2:[]});return(c=(o=(a=this.context.getValue("modules"))==null?void 0:a.devTools)==null?void 0:o.plugins)!=null&&c.length&&((p=(l=this.context.getValue("modules"))==null?void 0:l.devTools)==null||p.plugins.forEach(h=>{var g,_,w;const f={...ga,tags:[...ga.tags],baseUrl:`http://localhost:${h.port}`,name:h.name,picture:(g=h.picture)!=null?g:ga.picture,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),id:h.id,organizationId:this.organizationId,description:(_=h.description)!=null?_:ga.description,staggered:(w=h.staggered)!=null?w:ga.staggered};s.v2.push(f)})),s.v2}async getPluginDetails(t){const{plugin:e}=(await this.requests.get(`/v2/plugins/view/${t}`)).data.data;return e}async getPluginConfig(t){return(await this.axios.get(`${t}/dyte-config.json`)).data}async authorizePlugin(t){const e={peerId:this.peerId},{token:s}=(await this.requests.post(`/v2/plugins/authorize/${t}`,e)).data.data;return s}async getPresignedUrls(t,e){const s=Cc(this.context,"chat_upload_expiry"),n={roomUUID:this.roomUUID,filename:t,expiry:typeof s=="number"?s:void 0};J.hasFeature(Z.FEAT_CHAT_SDK)&&(n.viewType=e);const{getLocation:i,putLocation:a}=(await this.requests.post("/v1/meetings/genPreSignedUploadUrl",n)).data.data;return{getLocation:i,putLocation:a}}async uploadFile(t,e){if(navigator.isReactNative&&"uri"in t)try{await fetch(e,{method:"PUT",headers:{"Content-Type":"application/octet-stream"},body:{uri:t.uri,name:t.name}})}catch(s){u.error(`sendFileMessage::${s}`)}else await this.axios.put(e,t,{headers:{"Content-Type":t.type}})}}Hu([v.trace("APIClient.getIPDetails")],Jc.prototype,"getIPDetails",1),Hu([v.trace("APIClient.getICEServers")],Jc.prototype,"getICEServers",1),Hu([v.trace("APIClient.getPlugins")],Jc.prototype,"getPlugins",1);var zD=Object.defineProperty,YD=Object.getOwnPropertyDescriptor,Wr=(r,t,e,s)=>{for(var n=s>1?void 0:s?YD(t,e):t,i=r.length-1,a;i>=0;i--)(a=r[i])&&(n=(s?a(t,e,n):a(n))||n);return s&&n&&zD(t,e,n),n};class kr extends Jc{async startLivestreaming({manualIngestion:t}){const e=fr(await this.requests.post(`/v2/meetings/${this.context.getValue("meetingId")}/livestreams`,{manual_ingest:!!t})).data.data;return{playbackUrl:e.playbackUrl,status:e.status,manualIngest:e.manualIngest,ingestionCredentials:e.streamKey?{ingestionServer:e.ingestServer,streamKey:e.streamKey}:null}}async stopLivestreaming(){return this.requests.post(`/v2/meetings/${this.context.getValue("meetingId")}/active-livestream/stop`)}async getActiveLivestream(){const t=fr((await this.requests.get(`/v2/meetings/${this.context.getValue("meetingId")}/active-livestream`)).data.data);return{playbackUrl:t.playbackUrl,status:t.status,manualIngest:t.manualIngest,ingestionCredentials:t.streamKey?{ingestionServer:t.ingestServer,streamKey:t.streamKey}:null}}async getUserDetails(){if(this.userDetails)return this.userDetails;const t=(await this.requests.get("v2/internals/participant-details")).data.data;return fr(t)}async startRecording(t,e){return(await this.requests.post("/v2/recordings",{...pv(t),meeting_id:this.context.getValue("meetingId"),allow_multiple_recordings:!!e})).data.data.id}async updateRecording(t,e){return this.requests.put(`v2/recordings/${t}`,{action:e})}async getActiveRecording(){const{status:t,id:e}=(await this.requests.get(`v2/recordings/active-recording/${this.context.getValue("meetingId")}`)).data.data;return{status:t,id:e}}async getActiveTranscript(){const{transcript_download_url:t}=(await this.requests.get(`v2/meetings/${this.context.getValue("meetingId")}/active-transcript`)).data.data;try{return{transcript:(await this.axios.get(t)).data}}catch(e){throw new I("Cant fetch transcript s3 url","1801")}}async getRoomNodeData(){const t=await this.getIPDetails();if(this.ipInfo=t,this.roomDetails)return this.roomDetails;const{roomNodeLink:e,title:s,useHiveMedia:n,sfu:i}=fr((await this.requests.post("v2/internals/rooms",{ip_information:t})).data.data);return{roomNodeUrl:e,meetingTitle:s,useHiveMedia:n!=null?n:!1,sfu:i}}}Wr([v.trace("APIClient.startLivestreaming")],kr.prototype,"startLivestreaming",1),Wr([v.trace("APIClient.stopLivestreaming")],kr.prototype,"stopLivestreaming",1),Wr([v.trace("APIClient.getActiveLivestream")],kr.prototype,"getActiveLivestream",1),Wr([v.trace("APIClient.getUserDetails")],kr.prototype,"getUserDetails",1),Wr([v.trace("APIClient.startRecording")],kr.prototype,"startRecording",1),Wr([v.trace("APIClient.stopRecording")],kr.prototype,"updateRecording",1),Wr([v.trace("APIClient.getActiveRecording")],kr.prototype,"getActiveRecording",1),Wr([v.trace("APIClient.getActiveTranscript")],kr.prototype,"getActiveTranscript",1),Wr([v.trace("APIClient.getRoomNodeData")],kr.prototype,"getRoomNodeData",1);let qu;function QD(r,t){return qu=new kr(r,t),qu}function tt(){return qu}function XD(r,t){return`<blockquote>${t.replace(/<blockquote>[.\s\S]*<\/blockquote>\n\n/m,"")}</blockquote>

${r}`}const ai={maxInvocations:5,period:1};function Lt(r,t){return function(e,s,n){const i=n.value;let a=0,o=Date.now();return n.value=function(...c){const l=Date.now(),p=t?this[t]:r;if(l-o>p.period*1e3&&(o=l,a=0),a>=p.maxInvocations)throw new I(`Method rate limit ${p.maxInvocations} invocations/${p.period}sec exceeded`,"0013");return a+=1,i.apply(this,c)},n}}var ZD=Object.defineProperty,eO=Object.getOwnPropertyDescriptor,gt=(r,t,e,s)=>{for(var n=s>1?void 0:s?eO(t,e):t,i=r.length-1,a;i>=0;i--)(a=r[i])&&(n=(s?a(t,e,n):a(n))||n);return s&&n&&ZD(t,e,n),n};const tO=["text","image","file","custom","poll"],Kc={maxInvocations:180,period:60};let at=(Iy=class extends qt{constructor(t,e,s,n,i){super();E(this,Pd);m(this,"messages");m(this,"channels",[]);E(this,ee,void 0);E(this,wn,void 0);E(this,Ze,void 0);E(this,bn,void 0);E(this,xa,void 0);m(this,"maxTextLimit",2e3);y(this,xa,t),y(this,Ze,e),y(this,bn,s),y(this,ee,n),y(this,wn,i),this.messages=[]}setMaxTextLimit(t){this.maxTextLimit=t}get socketJoined(){return d(this,Pd,Wy).socketJoined===!0}async sendMessageInternal(t,e,s,n={}){switch(t.type){case"text":{const i=n.replyTo&&n.replyTo.type==="text"?XD(t.message,n.replyTo.message):t.message;await this.sendTextMessageInternal(i,e,s);break}case"image":await this.sendImageMessageInternal(t.image,e,s);break;case"file":await this.sendFileMessageInternal(t.file,e,s);break;default:u.error("sendMessage::message_type_not_supported",{dyteChat:{messageType:t.type}});break}}async sendTextMessageInternal(t,e,s){var i,a,o,c,l,p;if(t.length>this.maxTextLimit)throw new I("Max character limit breached","0503");if(e&&e.length>0){if(!((i=d(this,ee).permissions)!=null&&i.chatPrivate.canSend)||!((a=d(this,ee).permissions)!=null&&a.chatPrivate.text))throw u.error("sendTextMessage::private_chat_permission_denied"),new I("Could not send message to private chat.","0501")}else if(!((c=(o=d(this,ee).permissions)==null?void 0:o.chatPublic)!=null&&c.canSend)||!((p=(l=d(this,ee).permissions)==null?void 0:l.chatPublic)!=null&&p.text))throw u.error("sendTextMessage::public_chat_permission_denied"),new I("Could not send message to public chat.","0501");if(!t)throw u.error("sendTextMessage::message_can_not_be_empty"),new I("Message can not be empty.","0502");if(s){d(this,Ze).sendMessageToChannel(t,Pt.TEXT,s);return}let n=[];e&&e.length>0&&(e.push(d(this,ee).id),n=d(this,wn).joined.toArray().filter(h=>e.includes(h.id)).map(h=>h.userId),n.push(d(this,ee).userId)),d(this,Ze).sendMessage(t,Pt.TEXT,e)}async sendImageMessageInternal(t,e,s){var i,a,o,c,l,p;if(e&&e.length>0){if(!((i=d(this,ee).permissions)!=null&&i.chatPrivate.canSend)||!((a=d(this,ee).permissions)!=null&&a.chatPrivate.files)){u.error("sendImageMessage::private_chat_permission_denied");return}}else if(!((c=(o=d(this,ee).permissions)==null?void 0:o.chatPublic)!=null&&c.canSend)||!((p=(l=d(this,ee).permissions)==null?void 0:l.chatPublic)!=null&&p.files)){u.error("sendImageMessage::permission_denied");return}if(!t){u.error("sendImageMessage::required_argument_image_can_not_be_empty");return}if(!["image/gif","image/jpeg","image/png"].includes(t.type)){u.error("sendImageMessage::image_type_not_supported",{dyteChat:{imageType:t.type}});return}try{const h=tt(),{getLocation:f,putLocation:g}=await h.getPresignedUrls(t.name,d(this,ee).config.viewType);if(await h.uploadFile(t,g),s){d(this,Ze).sendMessageToChannel(f,Pt.IMAGE,s);return}let _=[];e&&e.length>0&&(e.push(d(this,ee).id),_=d(this,wn).joined.toArray().filter(w=>e.includes(w.id)).map(w=>w.userId),_.push(d(this,ee).userId)),d(this,Ze).sendMessage(f,Pt.IMAGE,e)}catch(h){throw new I("Error sending image message.","0500")}}async sendFileMessageInternal(t,e,s){var n,i,a,o,c,l;if(e&&e.length>0){if(!((n=d(this,ee).permissions)!=null&&n.chatPrivate.canSend)||!((i=d(this,ee).permissions)!=null&&i.chatPrivate.files)){u.error("sendFileMessage::private_chat_permission_denied");return}}else if(!((o=(a=d(this,ee).permissions)==null?void 0:a.chatPublic)!=null&&o.canSend)||!((l=(c=d(this,ee).permissions)==null?void 0:c.chatPublic)!=null&&l.files)){u.error("sendFileMessage::permission_denied");return}if(!t){u.error("sendFileMessage::required_argument_file_can_not_be_empty");return}try{const p=tt(),{getLocation:h,putLocation:f}=await p.getPresignedUrls(t.name,d(this,ee).config.viewType);if(await p.uploadFile(t,f),s){d(this,Ze).sendMessageToChannel(JSON.stringify({link:h,name:t.name,size:"size"in t?t.size:0}),Pt.FILE,s);return}let g=[];e&&e.length>0&&(e.push(d(this,ee).id),g=d(this,wn).joined.toArray().filter(w=>e.includes(w.id)).map(w=>w.userId),g.push(d(this,ee).userId));const _=JSON.stringify({link:h,name:t.name,size:"size"in t?t.size:0});d(this,Ze).sendMessage(_,Pt.FILE,e)}catch(p){throw new I("Error sending file message.","0500")}}get rateLimits(){return Kc}updateRateLimits(t,e){Kc.maxInvocations=t,Kc.period=e}async sendTextMessage(t,e){return this.sendTextMessageInternal(t,e)}async sendCustomMessage(t,e){var i,a,o,c,l,p,h,f,g,_,w,R,D,x,B;if(e&&e.length>0){if(!((i=d(this,ee).permissions)!=null&&i.chatPrivate.canSend)||!((a=d(this,ee).permissions)!=null&&a.chatPrivate.files)||!((o=d(this,ee).permissions)!=null&&o.chatPrivate.text)){u.error("sendCustomMessage::private_chat_permission_denied");return}}else if(!((l=(c=d(this,ee).permissions)==null?void 0:c.chatPublic)!=null&&l.canSend)||!((h=(p=d(this,ee).permissions)==null?void 0:p.chatPublic)!=null&&h.files)||!((g=(f=d(this,ee).permissions)==null?void 0:f.chatPublic)!=null&&g.text)){u.error("sendCustomMessage::permission_denied");return}const s=async b=>{try{if(typeof b=="string")return{link:b};const Q=tt(),{getLocation:te,putLocation:ce}=await Q.getPresignedUrls(b.name,d(this,ee).config.viewType);return await Q.uploadFile(b,ce),{link:te,type:b.type,name:b.name,size:b.size}}catch(Q){throw new I("Error sending image message.","0500")}},n={...t,files:await Promise.all((w=(_=t.files)!=null?_:[])==null?void 0:w.map(async b=>s(b))),images:await Promise.all((D=(R=t.images)!=null?R:[])==null?void 0:D.map(async b=>s(b))),videos:await Promise.all((B=(x=t.videos)!=null?x:[])==null?void 0:B.map(async b=>s(b)))};d(this,Ze).sendMessage(JSON.stringify(n),Pt.CUSTOM,e)}async sendImageMessage(t,e){return this.sendImageMessageInternal(t,e)}async sendFileMessage(t,e){return this.sendFileMessageInternal(t,e)}async sendMessage(t,e){return this.sendMessageInternal(t,e)}async editTextMessage(t,e,s){var n,i,a,o,c,l;if(((i=(n=d(this,ee).permissions)==null?void 0:n.chatMessage)==null?void 0:i.canEdit)==="NONE")throw new I("Not permitted to edit messages","0501");if(!((o=(a=d(this,ee).permissions)==null?void 0:a.chatPublic)!=null&&o.canSend)||!((l=(c=d(this,ee).permissions)==null?void 0:c.chatPublic)!=null&&l.text)){u.error("editTextMessage::permission_denied");return}if(!e){u.error("editTextMessage::message_can_not_be_empty");return}d(this,Ze).editMessage(t,e,Pt.TEXT,s)}async editImageMessage(t,e,s){var i,a,o,c;if(!((a=(i=d(this,ee).permissions)==null?void 0:i.chatPublic)!=null&&a.canSend)||!((c=(o=d(this,ee).permissions)==null?void 0:o.chatPublic)!=null&&c.files)){u.error("editImageMessage::permission_denied");return}if(!e){u.error("editImageMessage::required_argument_image_can_not_be_empty");return}if(!["image/gif","image/jpeg","image/png"].includes(e.type)){u.error("sendImageMessage::image_type_not_supported",{dyteChat:{imageType:e.type}});return}try{const l=tt(),{getLocation:p,putLocation:h}=await l.getPresignedUrls(e.name,d(this,ee).config.viewType);await l.uploadFile(e,h),d(this,Ze).editMessage(t,p,Pt.IMAGE,s)}catch(l){throw new I("Error editing image message.","0500")}}async editFileMessage(t,e,s){var n,i,a,o;if(!((i=(n=d(this,ee).permissions)==null?void 0:n.chatPublic)!=null&&i.canSend)||!((o=(a=d(this,ee).permissions)==null?void 0:a.chatPublic)!=null&&o.files)){u.error("sendFileMessage::permission_denied");return}if(!e){u.error("sendFileMessage::required_argument_file_can_not_be_empty");return}try{const c=tt(),{getLocation:l,putLocation:p}=await c.getPresignedUrls(e.name,d(this,ee).config.viewType);await c.uploadFile(e,p),d(this,Ze).editMessage(t,JSON.stringify({link:l,name:e.name,size:"size"in e?e.size:0}),Pt.FILE,s)}catch(c){throw new I("Error editing file message.","0500")}}async editMessage(t,e,s){switch(e.type){case"text":{this.editTextMessage(t,e.message,s);break}case"image":{this.editImageMessage(t,e.image,s);break}case"file":{this.editFileMessage(t,e.file,s);break}default:{u.error("editMessage::message_type_not_supported",{dyteChat:{messageType:e.type}});break}}}async deleteMessage(t,e){var s,n;if(((n=(s=d(this,ee).permissions)==null?void 0:s.chatMessage)==null?void 0:n.canDelete)==="NONE")throw new I("Not permitted to delete messages","0501");d(this,Ze).deleteMessage(t,e)}getMessagesByUser(t){return this.messages.filter(e=>e.userId===t)}getMessagesByType(t){return this.messages.filter(e=>e.type===t)}async pin(t){if(!this.socketJoined)throw new I("Can`t pin message without joining room","0505");if(!d(this,ee).permissions.pinParticipant)throw new I("You do not have permission to pin messages.","0501");const e=this.messages.find(s=>s.id===t);if(e){d(this,Ze).setPinState(e,!0);return}throw new I(`No message found with id: ${t}`,"0504")}async unpin(t){if(!this.socketJoined)throw new I("Can`t unpin message without joining room","0505");if(!d(this,ee).permissions.pinParticipant)throw new I("You do not have permission to unpin messages.","0501");const e=this.messages.find(s=>s.id===t);if(e){d(this,Ze).setPinState(e,!1);return}throw new I(`No message found with id: ${t}`,"0504")}async getMessages(t,e,s,n=0,i=void 0){const a=await d(this,Ze).getChatMessagesPaginated(t,e,s,n,i);return{messages:a.messages.map(o=>gr.formatSocketServiceMessage(o)),next:a.next}}async createChannel(t,e,s={}){var o;const n=(o=d(this,ee).permissions)==null?void 0:o.chatChannel;if(n){if(n.canCreate==="NONE")throw new I("Not permitted to create channels","0501");if(s.visibility==="public"&&!(n.canCreate==="PUBLIC"||n.canCreate==="ALL"))throw new I("Not permitted to create public channels","0501");if(s.visibility==="private"&&!(n.canCreate==="PRIVATE"||n.canCreate==="ALL"))throw new I("Not permitted to create private channels","0501")}if(!t||t.trim().length===0)throw new I("channel name cannot be empty.","0510");const i=[...new Set([...e,d(this,ee).userId])];return await d(this,bn).createChannel(t.trim(),i,s.displayPictureUrl,s.visibility,s.isDirectMessage)}updateChannel(t,e){var a,o,c,l,p;const s=this.channels.find(h=>h.id===t),n=(a=d(this,ee).permissions)==null?void 0:a.chatChannel;if(n){if(n.canUpdate==="NONE")throw new I("Not permitted to update channels","0501");if(s.visibility==="public"&&!(n.canUpdate==="PUBLIC"||n.canUpdate==="ALL"))throw new I("Not permitted to update public channels","0501");if(s.visibility==="private"&&!(n.canUpdate==="PRIVATE"||n.canUpdate==="ALL"))throw new I("Not permitted to update private channels","0501")}const i={memberIds:(o=e.memberIds)!=null?o:s.memberIds,displayName:(c=e.displayName)!=null?c:s.displayName,displayPictureUrl:(l=e.displayPictureUrl)!=null?l:s.displayPictureUrl,visibility:(p=e.visibility)!=null?p:s.visibility};return d(this,bn).updateChannel(t,i)}async sendMessageToChannel(t,e,s={}){return this.sendMessageInternal(t,null,e,s)}async getChannelMembers(t){return d(this,bn).getChannelMembers(t)}async searchMessages(t,e={}){if(!J.hasFeature(Z.FEAT_CHAT_SDK_SEARCH))throw new I("searchMessages is temporarily disabled!","0506");return(await d(this,Ze).searchMessages(t,e)).map(gr.formatSocketServiceMessage)}async markLastReadMessage(t,e){await d(this,Ze).markLastReadMessage(t,e);const s=this.channels.find(n=>n.id===t);if(s){const n={...s,unreadCount:0};this.channels=this.channels.map(i=>i.id===t?n:i),this.emit("channelMessageUpdate",n)}}get pinned(){return this.messages.filter(t=>t.pinned)}},ee=new WeakMap,wn=new WeakMap,Ze=new WeakMap,bn=new WeakMap,xa=new WeakMap,Pd=new WeakSet,Wy=function(){return d(this,xa).getValue("connectionHandler")},Iy);gt([v.trace("DyteChat.sendTextMessage"),Lt(Kc)],at.prototype,"sendTextMessage",1),gt([v.trace("DyteChat.sendImageMessage"),Lt({maxInvocations:20,period:60})],at.prototype,"sendImageMessage",1),gt([v.trace("DyteChat.sendFileMessage"),Lt({maxInvocations:20,period:60})],at.prototype,"sendFileMessage",1),gt([v.trace("DyteChat.sendMessage"),Lt({maxInvocations:180,period:60})],at.prototype,"sendMessage",1),gt([v.trace("DyteChat.editTextMessage")],at.prototype,"editTextMessage",1),gt([v.trace("DyteChat.editImageMessage")],at.prototype,"editImageMessage",1),gt([v.trace("DyteChat.editFileMessage")],at.prototype,"editFileMessage",1),gt([v.trace("DyteChat.editMessage")],at.prototype,"editMessage",1),gt([v.trace("DyteChat.deleteMessage")],at.prototype,"deleteMessage",1),gt([v.trace("DyteChat.createChannel")],at.prototype,"createChannel",1),gt([v.trace("DyteChat.updateChannel")],at.prototype,"updateChannel",1),gt([v.trace("DyteChat.sendMessageToChannel")],at.prototype,"sendMessageToChannel",1),gt([v.trace("DyteChat.getChannelMembers")],at.prototype,"getChannelMembers",1),gt([v.trace("DyteChat.searchMessages")],at.prototype,"searchMessages",1),gt([v.trace("DyteChat.markLastReadMessage")],at.prototype,"markLastReadMessage",1),at=gt([mt("0500")],at);var rO=Object.defineProperty,sO=Object.getOwnPropertyDescriptor,nO=(r,t,e,s)=>{for(var n=s>1?void 0:s?sO(t,e):t,i=r.length-1,a;i>=0;i--)(a=r[i])&&(n=(s?a(t,e,n):a(n))||n);return s&&n&&rO(t,e,n),n};const cn=(Ay=class{constructor(r,t,e,s,n){m(this,"chat");m(this,"chatSocketHandler");m(this,"chatChannelSocketHandler");m(this,"self");E(this,kd,void 0);y(this,kd,r),this.chatSocketHandler=t,this.chatChannelSocketHandler=e,this.chat=new at(r,t,e,s,n),this.self=s,this.setupEvents()}static async init(r,t,e,s,n){return new cn(r,t,e,s,n)}static formatMessage(r){return{...r,time:new Date(r.time),type:tO[r.type]}}static formatSocketServiceMessage(r){const t=r.createdAt*1e3,e={displayName:r.displayName,id:r.chatId,time:t,timeMs:r.createdAtMs,type:r.payloadType,isEdited:r.isEdited,userId:r.userId,targetUserIds:r.targetUserIds,channelId:r.channelId,channelIndex:r.channelIndex,message:"",link:"",name:"",html:"",images:[],videos:[],files:[],size:0,pinned:r.pinned};switch(e.type){case Pt.TEXT:{e.message=r.payload;break}case Pt.IMAGE:{e.link=r.payload;break}case Pt.FILE:{const{link:s,name:n,size:i}=JSON.parse(r.payload);e.link=s,e.name=n,e.size=i;break}case Pt.CUSTOM:{const{html:s,images:n,message:i,videos:a,files:o}=JSON.parse(r.payload);e.message=i,e.html=s,e.images=n,e.videos=a,e.files=o;break}}return cn.formatMessage(e)}async getChatMessages(){if(this.self.config.viewType==="LIVESTREAM"||this.self.config.viewType==="CHAT"||J.hasFeature(Z.FEAT_PAGINATED_CHAT))return;const r=await this.chatSocketHandler.getChatMessages();if(!(r!=null&&r.payload))return;const t=tv.fromBinary(r.payload).messages;this.chat.messages=t.map(e=>cn.formatSocketServiceMessage(e))}setupEvents(){P.on(k.SOCKET_SERVICE_ROOM_JOINED,async()=>{this.getChatMessages()}),this.chatSocketHandler.on(xe.sendMessageToRoom,r=>{const t=cn.formatSocketServiceMessage(r.message);if(!t.channelId)this.chat.messages=[...this.chat.messages,t];else{const e=this.chat.channels.find(s=>s.id===t.channelId);e&&(e.latestMessage=t,e.unreadCount+=1,this.chat.emit("channelMessageUpdate",e))}this.chat.emit("chatUpdate",{action:"add",message:t,messages:this.chat.messages})}),this.chatSocketHandler.on(xe.sendMessageToPeers,r=>{const t=cn.formatSocketServiceMessage(r.message);this.chat.messages=[...this.chat.messages,t],this.chat.emit("chatUpdate",{action:"add",message:t,messages:this.chat.messages})}),this.chatSocketHandler.on(xe.editMessage,r=>{const t=cn.formatSocketServiceMessage(r.message);if(t.channelId){this.chat.emit("chatUpdate",{action:"edit",message:t,messages:this.chat.messages});return}const e=this.chat.messages.findIndex(s=>s.id===t.id);e!==-1&&(this.chat.messages[e]=t,this.chat.emit("chatUpdate",{action:"edit",message:t,messages:this.chat.messages}))}),this.chatSocketHandler.on(xe.deleteMessage,r=>{if(r.channelId){this.chat.emit("chatUpdate",{action:"delete",message:{id:r.chatId,channelId:r.channelId},messages:this.chat.messages});return}const t=this.chat.messages.findIndex(s=>s.id===r.chatId);if(t===-1)return;const[e]=this.chat.messages.splice(t,1);this.chat.emit("chatUpdate",{action:"delete",message:e,messages:this.chat.messages})}),this.chatChannelSocketHandler.on(an.createChatChannel,r=>{const[t]=r.chatChannels,e=on.formatChannel(t);this.chat.channels.push(e),this.chat.emit("channelCreate",e)}),this.chatSocketHandler.on(xe.pinMessage,r=>{const t=this.chat.messages.findIndex(s=>s.id===r.chatId);if(t===-1)return;const e=this.chat.messages[t];e.pinned=r.pinned,this.chat.messages[t]=e,this.chat.emit("chatUpdate",{action:"edit",message:e,messages:this.chat.messages})}),this.chatChannelSocketHandler.on(an.updateChatChannel,r=>{const[t]=r.chatChannels,e=on.formatChannel(t);this.chat.channels=this.chat.channels.map(s=>s.id===e.id?e:s),this.chat.emit("channelUpdate",e)})}},kd=new WeakMap,Ay);let gr=cn;nO([v.trace("ChatController.setupEvents")],gr.prototype,"setupEvents",1);var iO=Object.defineProperty,aO=Object.getOwnPropertyDescriptor,oO=(r,t,e,s)=>{for(var n=s>1?void 0:s?aO(t,e):t,i=r.length-1,a;i>=0;i--)(a=r[i])&&(n=(s?a(t,e,n):a(n))||n);return s&&n&&iO(t,e,n),n};let ju=(My=class extends qt{constructor(t,e,s){super();E(this,Id);m(this,"items");E(this,Ei,void 0);E(this,_i,void 0);E(this,Fa,void 0);y(this,Fa,t),y(this,Ei,e),y(this,_i,s),this.items=[]}get socketJoined(){var t;return((t=d(this,Id,Jy))==null?void 0:t.socketJoined)===!0}async create(t,e,s=!1,n=!1){if(!this.socketJoined)throw new I("Can't create polls without joining room","0705");if(!d(this,Ei).permissions.polls.canCreate){u.error("DytePolls::create::permission_denied");return}if(!t||!e){u.error("DytePolls::question_and_options_can_not_be_empty",{dytePolls:{hasQuestion:!!t,optionsLength:e==null?void 0:e.length}});return}if(e.length<2){u.error("DytePolls::there_must_be_at_least_two_options",{dytePolls:{hasQuestion:!!t,optionsLength:e.length}});return}await d(this,_i).createPoll(t,e,s,n)}async vote(t,e){if(!d(this,Ei).permissions.polls.canVote){u.error("DytePolls::vote::permission_denied");return}await d(this,_i).votePoll(t,e)}},Id=new WeakSet,Jy=function(){return d(this,Fa).getValue("connectionHandler")},Ei=new WeakMap,_i=new WeakMap,Fa=new WeakMap,My);ju=oO([mt("0700")],ju);var cO=Object.defineProperty,dO=Object.getOwnPropertyDescriptor,lO=(r,t,e,s)=>{for(var n=s>1?void 0:s?dO(t,e):t,i=r.length-1,a;i>=0;i--)(a=r[i])&&(n=(s?a(t,e,n):a(n))||n);return s&&n&&cO(t,e,n),n};const oi=(Dy=class{constructor(r,t,e){m(this,"polls");E(this,wi,void 0);E(this,Cn,void 0);this.polls=new ju(r,t,e),y(this,wi,t),y(this,Cn,e),this.setupEvents()}static async init(r,t,e){return new oi(r,t,e)}canViewPolls(){return d(this,wi).permissions.polls.canView}setupEvents(){const r={[Gr.createPoll]:s=>{s.poll&&this.updatePoll(oi.formatSocketServicePoll(s.poll))},[Gr.updatePoll]:s=>{s.poll&&this.updatePoll(oi.formatSocketServicePoll(s.poll))},[Gr.votePoll]:s=>{s.poll&&this.updatePoll(oi.formatSocketServicePoll(s.poll))}},t=()=>{P.on(k.SOCKET_SERVICE_ROOM_JOINED,()=>{this.getPolls()}),Object.keys(r).map(Number).forEach(s=>{d(this,Cn).on(s,r[s])})},e=()=>{P.on(k.SOCKET_SERVICE_ROOM_JOINED,()=>{this.getPolls()}),Object.keys(r).map(Number).forEach(s=>{d(this,Cn).removeListeners(s)})};d(this,wi).permissions.on("permissionsUpdate",async s=>{var n;(n=s==null?void 0:s.polls)!=null&&n.canView?(await this.getPolls(),t()):(this.polls.items=[],e())}),this.canViewPolls()&&t()}updatePoll(r){if(!this.canViewPolls())return;const t=this.polls.items.findIndex(e=>e.id===r.id);if(t>-1){const e=JSON.stringify(this.polls.items[t]);this.polls.items[t]=r,e!==JSON.stringify(r)&&this.polls.emit("pollsUpdate",{polls:this.polls.items,newPoll:!1});return}this.polls.items=[...this.polls.items,r],this.polls.emit("pollsUpdate",{polls:this.polls.items,newPoll:!0})}async getPolls(){const r=await d(this,Cn).getPolls();if(!(r!=null&&r.payload))return;const{polls:t}=_D.fromBinary(r.payload);this.polls.items=t.map(e=>oi.formatSocketServicePoll(e))}static formatSocketServicePoll(r){const t=r.options.map(e=>({count:e.count,text:e.text,votes:e.votes.map(s=>({id:s.userId,name:s.name}))}));return{anonymous:r.anonymous,createdBy:r.createdBy,createdByUserId:r.createdByUserId,hideVotes:r.hideVotes,id:r.pollId,options:t,question:r.question,voted:r.votes}}},wi=new WeakMap,Cn=new WeakMap,Dy);let mv=oi;lO([v.trace("PollController.setupEvents")],mv.prototype,"setupEvents",1);var uO=Object.defineProperty,hO=Object.getOwnPropertyDescriptor,pO=(r,t,e,s)=>{for(var n=s>1?void 0:s?hO(t,e):t,i=r.length-1,a;i>=0;i--)(a=r[i])&&(n=(s?a(t,e,n):a(n))||n);return s&&n&&uO(t,e,n),n},fv=(r=>(r[r.User=0]="User",r[r.Meeting=1]="Meeting",r))(fv||{});let Gu=(Oy=class extends qt{constructor(t,e,s,n,i){super();E(this,Ad);E(this,$a);m(this,"selfActiveTab");m(this,"broadcastTabChanges");E(this,bi,void 0);E(this,Rn,void 0);E(this,Ua,void 0);m(this,"viewType");m(this,"meetingStartedTimestamp");m(this,"meetingTitle");m(this,"sessionId");y(this,bi,t),y(this,Rn,e),this.viewType=s,y(this,Ua,n),this.meetingTitle=i,this.broadcastTabChanges=e.permissions.canSpotlight}get socketState(){return d(this,$a,Ph).socketState}get mediaState(){return d(this,$a,Ph).mediaState}get meetingId(){var t;return(t=d(this,Ad,Ky))==null?void 0:t.roomName}setBroadcastTabChanges(t){if(!d(this,Rn).permissions.canSpotlight)throw u.error("DyteSpotlight::setSpotlighted::permission_denied"),new I("User does not have permission to toggle spotlight","0801");this.broadcastTabChanges=t,this.emit("broadcastTabChangesUpdate",this.broadcastTabChanges),this.broadcastTabChanges&&this.assertActiveTabToRoom()}setSelfActiveTab(t,e){var s;u.info("DyteSpotlight::setActiveTab",{spotlight:{currentTab:{id:t.id,type:t.type}}}),this.selfActiveTab=t,e===0&&this.emit("selfTabUpdate",t),(s=d(this,Rn).permissions)!=null&&s.canSpotlight&&this.broadcastTabChanges&&e===0&&this.assertActiveTabToRoom()}assertActiveTabToRoom(){d(this,Ua).broadcastMessage("spotlight",{userId:d(this,Rn).userId,currentTab:this.selfActiveTab})}},bi=new WeakMap,Ad=new WeakSet,Ky=function(){return d(this,bi).getValue("roomNodeClient")},$a=new WeakSet,Ph=function(){return d(this,bi).getValue("connectionHandler")},Rn=new WeakMap,Ua=new WeakMap,Oy);Gu=pO([mt("0800")],Gu);function mO(r){let t="",e=[""];const s=[e];let n=0,i=0,a=!0,o;for(o of r)o==='"'?(a&&o===t&&(e[n]+=o),a=!a):o===","&&a?o=e[++n]="":o===`
`&&a?(t==="\r"&&(e[n]=e[n].slice(0,-1)),e=s[++i]=[o=""],n=0):e[n]+=o,t=o;return s}var fO=Object.defineProperty,gO=Object.getOwnPropertyDescriptor,gv=(r,t,e,s)=>{for(var n=s>1?void 0:s?gO(t,e):t,i=r.length-1,a;i>=0;i--)(a=r[i])&&(n=(s?a(t,e,n):a(n))||n);return s&&n&&fO(t,e,n),n};let Ss=class extends qt{constructor(){super();m(this,"transcripts");this.transcripts=[]}static async init(t){const e=new Ss;try{t&&e.getActiveTranscript()}catch(s){u.error("Error fetching active transcriptions ",s)}return e}static parseTranscript(t,e=!1){try{if(!t)return;const[[s,n,i,a,o,c]]=mO(t);return{id:Jn(),name:o,peerId:n,userId:i,customParticipantId:a,transcript:c,isPartialTranscript:e,date:new Date(parseInt(s,10)*1e3)}}catch(s){u.error(`Failed to parse transcript: ${t}`,s);return}}static parseTranscripts(t){return t?t.split(`
`).map(e=>Ss.parseTranscript(e,!1)).filter(Boolean):[]}async getActiveTranscript(){try{const t=tt(),{transcript:e}=await t.getActiveTranscript();this.transcripts=Ss.parseTranscripts(e)}catch(t){}}async onTranscript(t){var s;const e=this.transcripts.filter(({peerId:n})=>n===t.peerId);if((s=e==null?void 0:e.at(-1))!=null&&s.isPartialTranscript){const n=e.at(-1);n.transcript=t.transcript,n.isPartialTranscript=t.isPartialTranscript,this.emit("transcript",n);return}this.transcripts=[...this.transcripts,t],this.emit("transcript",t)}};gv([v.trace("DyteAi.getActiveTranscript")],Ss.prototype,"getActiveTranscript",1),Ss=gv([mt("0000")],Ss);var vO=Object.defineProperty,yO=Object.getOwnPropertyDescriptor,TO=(r,t,e,s)=>{for(var n=s>1?void 0:s?yO(t,e):t,i=r.length-1,a;i>=0;i--)(a=r[i])&&(n=(s?a(t,e,n):a(n))||n);return s&&n&&vO(t,e,n),n};const vv=(Ny=class{constructor(r,t,e,s,n,i){m(this,"meta");m(this,"ai");E(this,Os,void 0);E(this,Ci,void 0);m(this,"aiSocketHandler");E(this,Md,void 0);y(this,Md,r),this.meta=new Gu(r,t,t.config.viewType,e,i),this.ai=s,y(this,Os,t),y(this,Ci,e),this.aiSocketHandler=n,t.config.viewType!==Ct.Chat&&this.setupEvents()}static async init(r,t,e,s,n){const i=await Ss.init(t.permissions.transcriptionEnabled);return new vv(r,t,e,i,s,n)}conditionallySetActiveTab(r){var t;r!=null&&r.currentTab&&((t=this.meta.selfActiveTab)==null?void 0:t.id)!==r.currentTab.id&&(this.meta.setSelfActiveTab(r.currentTab,fv.Meeting),this.meta.emit("activeTabUpdate",r.currentTab))}setupEvents(){P.on(k.TRANSPORT_STATE_UPDATE,r=>{this.meta.emit("mediaConnectionUpdate",r)}),P.on(k.SOCKET_STATE_UPDATE,r=>{this.meta.emit("socketConnectionUpdate",r)}),P.on(k.ROOM_STATE,({createdAt:r,roomUuid:t})=>{const e=this.meta.meetingStartedTimestamp;if(t&&(this.meta.sessionId=t),r&&!e){const s=new Date(r*1e3);this.meta.meetingStartedTimestamp=s,this.meta.emit("meetingStartTimeUpdate",{meetingStartedTimestamp:this.meta.meetingStartedTimestamp})}}),P.on(k.PRODUCER_SCORE_UPDATE,({score:r})=>{r<5&&this.meta.emit("poorConnection",{score:r})}),d(this,Os).permissions.canSpotlight&&(u.info("DyteMetaController::Asserting Spotlight"),this.meta.selfActiveTab&&d(this,Ci).broadcastMessage("spotlight",{userId:d(this,Os).userId,currentTab:this.meta.selfActiveTab})),P.on(k.PEER_JOINED_INTERNAL,async r=>{d(this,Os).permissions.canSpotlight&&this.meta.selfActiveTab&&d(this,Ci).broadcastToPeers("spotlight",[r.id],{userId:d(this,Os).userId,currentTab:this.meta.selfActiveTab})}),P.on(k.ROOM_MESSAGE,r=>{var e,s;let t;if("type"in r){if(r.type!=="spotlight")return;t={...r,...r.payload}}else if("roomMessageType"in r){if(r.roomMessageType!=="spotlight")return;t=r}else return;u.info("Spotlight Assertion Received",{spotlight:{spotlighter:{id:t.userId},currentTab:{id:(e=t.currentTab)==null?void 0:e.id,type:(s=t.currentTab)==null?void 0:s.type}}}),this.conditionallySetActiveTab(t)}),P.on(k.MESSAGE,r=>{var e,s;let t;if("type"in r){if(r.type!=="spotlight")return;t={...r,...r.payload}}else if("roomMessageType"in r){if(r.roomMessageType!=="spotlight")return;t=r}else return;u.info("Spotlight Assertion Received",{spotlight:{spotlighter:{id:t.userId},currentTab:{id:(e=t.currentTab)==null?void 0:e.id,type:(s=t.currentTab)==null?void 0:s.type}}}),this.conditionallySetActiveTab(t)}),this.aiSocketHandler.on(U.transcript,r=>{const{meetingId:t,transcript:e,isPartial:s}=r,n=Ss.parseTranscript(e,s);if(!n){u.warn("Received empty transcript data");return}this.ai.onTranscript(n),this.meta.emit("transcript",n);const{peerId:i,name:a,transcript:o}=n;u.debug(`${t} Received transcript for peer ${i} - ${a}: ${o}`)})}},Os=new WeakMap,Ci=new WeakMap,Md=new WeakMap,Ny);let yv=vv;TO([v.trace("MetaController.setupEvents")],yv.prototype,"setupEvents",1);var SO=Object.defineProperty,EO=Object.getOwnPropertyDescriptor,dn=(r,t,e,s)=>{for(var n=s>1?void 0:s?EO(t,e):t,i=r.length-1,a;i>=0;i--)(a=r[i])&&(n=(s?a(t,e,n):a(n))||n);return s&&n&&SO(t,e,n),n};class Es extends qt{constructor(e,s,n,i,a){super();E(this,Ba);E(this,Pi);E(this,rr,void 0);E(this,Ri,void 0);E(this,pe,void 0);E(this,Va,void 0);E(this,Ar,void 0);E(this,Sr,void 0);y(this,Sr,e),y(this,rr,i),y(this,Ri,a),y(this,pe,s),y(this,Va,n),y(this,Ar,[]),this.setupEvents()}get status(){return d(this,Sr).getValue("stageStatus")}setupEvents(){const e={[k.GET_STAGE_REQUESTS]:async i=>{y(this,Ar,i)},[k.UPDATE_STAGE_REQUESTS]:async({add:i})=>{const a=d(this,Ar).length,{stageRequests:o}=this.getAccessRequests();(i||o.length>a)&&this.emit("newStageRequest",{count:o.length}),this.emit("stageAccessRequestUpdate",o)}},s=()=>{Object.entries(e).forEach(([i,a])=>{P.onAsync(i,a)})},n=()=>{Object.entries(e).forEach(([i,a])=>{P.removeListener(i,a)})};d(this,pe).permissions.on("permissionsUpdate",i=>{const{canAcceptProductionRequests:a}=i;a!==void 0&&(d(this,pe).permissions.acceptStageRequests?(s(),d(this,rr).getStageRequests()):(n(),y(this,Ar,[]),this.emit("stageAccessRequestUpdate",d(this,Ar))))}),d(this,pe).permissions.acceptStageRequests&&s()}getAccessRequests(){if(!d(this,pe).permissions.stageEnabled)throw u.error("DyteStage::stage_disabled"),new I("Stage is disabled","2003");if(!d(this,pe).permissions.acceptStageRequests)throw u.error("DyteStage::get_access_request::permission_denied"),new I("You do not have permission to perform this action","2001");const e=d(this,Va).joined.toArray().filter(s=>s.stageStatus==="REQUESTED_TO_JOIN_STAGE").map(s=>({displayName:s.name,userId:s.userId,peerId:s.id}));return y(this,Ar,e),{stageRequests:d(this,Ar)}}async requestAccess(){if(!d(this,pe).permissions.stageEnabled)throw u.error("DyteStage::stage_disabled"),new I("Stage is disabled","2003");if(this.status!=="OFF_STAGE")throw new I(`Unable to request access you are currently ${this.status}`,"2006");if(d(this,pe).permissions.stageAccess===j.Allowed){qe(this,Pi,Gd).call(this,"ACCEPTED_TO_JOIN_STAGE");return}d(this,rr).requestAccess(),qe(this,Pi,Gd).call(this,"REQUESTED_TO_JOIN_STAGE")}async cancelRequestAccess(){if(!d(this,pe).permissions.stageEnabled)throw u.error("DyteStage::stage_disabled"),new I("Stage is disabled","2003");d(this,rr).cancelRequestAccess(),qe(this,Pi,Gd).call(this,"OFF_STAGE")}grantAccess(e){if(!d(this,pe).roomJoined)throw new I("Can`t grant for participant without joining room");if(!d(this,pe).permissions.stageEnabled)throw u.error("DyteStage::stage_disabled"),new I("Stage is disabled","2003");if(!d(this,pe).permissions.acceptStageRequests)throw u.error("DyteStage::grant_access::permission_denied"),new I("You do not have permission to perform this action","2001");return d(this,rr).grantAccess(e)}denyAccess(e){if(!d(this,pe).roomJoined)throw new I("Can`t rejectRequestToJoinStage for participant without joining room","2005");if(!d(this,pe).permissions.stageEnabled)throw u.error("DyteStage::stage_disabled"),new I("Stage is disabled","2003");if(!d(this,pe).permissions.acceptStageRequests)throw u.error("DyteStage::deny_access::permission_denied"),new I("You do not have permission to perform this action","2001");return d(this,rr).denyAccess(e)}async join(){const e=d(this,Sr).getValue("viewType");if(this.status==="ON_STAGE")throw new I("You are already on stage.","2006");if(this.status!=="ACCEPTED_TO_JOIN_STAGE"||d(this,pe).permissions.stageAccess===j.NotAllowed)throw new I(`Unable to join stage you are currently ${this.status}`,"2006");if(await d(this,rr).joinStage(),e===Ct.Livestream){await d(this,Ri).joinRoom(d(this,pe));const{peers:s}=await d(this,Ri).getStagePeers();P.emit(k.SOCKET_PEERS,s)}d(this,Sr).setValue("stageStatus","ON_STAGE"),d(this,pe).audioEnabled&&d(this,Ba,kh).shareMic(d(this,pe).audioTrack),d(this,pe).videoEnabled&&d(this,Ba,kh).shareWebcam(d(this,pe).videoTrack)}async leave(){if(!d(this,pe).permissions.stageEnabled)throw u.error("DyteStage::stage_disabled"),new I("Stage is disabled","2003");if(!(this.status==="ON_STAGE"||this.status==="ACCEPTED_TO_JOIN_STAGE"))throw new I(`Unable to leave stage you are currently ${this.status}`,"2006");d(this,pe).setIsPinned(!1),await d(this,rr).leaveStage(d(this,pe).userId),d(this,Sr).setValue("stageStatus","OFF_STAGE",!1),await P.emitAsync(k.LEAVE_MEDIA_ROOM,"stageLeft"),d(this,Sr).notify("stageStatus")}async kick(e){if(!d(this,pe).roomJoined)throw new I("Can`t kick participant without joining room","2005");if(!d(this,pe).permissions.stageEnabled)throw u.error("DyteStage::stage_disabled"),new I("Stage is disabled","2003");if(!d(this,pe).permissions.acceptStageRequests)throw u.error("DyteStage::kick::permission_denied"),new I("You do not have permissions for kick","2001");return d(this,rr).kick(e)}}rr=new WeakMap,Ri=new WeakMap,pe=new WeakMap,Va=new WeakMap,Ar=new WeakMap,Sr=new WeakMap,Ba=new WeakSet,kh=function(){return d(this,Sr).getValue("roomNodeClient")},Pi=new WeakSet,Gd=async function(e){this.status!==e&&d(this,Sr).setValue("stageStatus",e)},dn([v.trace("DyteStage.getStageRequests")],Es.prototype,"getAccessRequests",1),dn([v.trace("DyteStage.requestAccess")],Es.prototype,"requestAccess",1),dn([v.trace("DyteStage.cancelRequestAccess")],Es.prototype,"cancelRequestAccess",1),dn([v.trace("DyteStage.grantAccess")],Es.prototype,"grantAccess",1),dn([v.trace("DyteStage.denyAccess")],Es.prototype,"denyAccess",1),dn([v.trace("DyteStage.joinStage")],Es.prototype,"join",1),dn([v.trace("DyteStage.leaveStage")],Es.prototype,"leave",1);function _O(r){return!(r.viewType==="LIVESTREAM"||r.viewType==="CHAT")}function Wu(r){switch(r){case qr.UNSPECIFIED:return"OFF_STAGE";case qr.REQUESTED_STAGE:return"REQUESTED_TO_JOIN_STAGE";case qr.APPROVED_STAGE:return"ACCEPTED_TO_JOIN_STAGE";case qr.OFF_STAGE:return"OFF_STAGE";case qr.ON_STAGE:return"ON_STAGE";default:return"OFF_STAGE"}}var wO=Object.defineProperty,bO=Object.getOwnPropertyDescriptor,CO=(r,t,e,s)=>{for(var n=s>1?void 0:s?bO(t,e):t,i=r.length-1,a;i>=0;i--)(a=r[i])&&(n=(s?a(t,e,n):a(n))||n);return s&&n&&wO(t,e,n),n};class Tv{constructor(t,e,s,n,i){m(this,"stage");E(this,Ns,void 0);E(this,Pn,void 0);E(this,Ls,void 0);E(this,Ha,0);E(this,rs,void 0);y(this,rs,t),this.stage=new Es(t,n,i,e,s),y(this,Ls,e),y(this,Ns,n),y(this,Pn,i),this.setupEvents()}setupEvents(){d(this,rs).subscribe("stageStatus",t=>{this.stage.emit("stageStatusUpdate",t)}),d(this,Ls).on(U.grantStageAccess,()=>{d(this,Ns).permissions.stageAccess!==j.Allowed&&(this.stage.emit("stageRequestApproved"),this.setStageStatus("ACCEPTED_TO_JOIN_STAGE"))}),d(this,Ls).on(U.peerStageStatusUpdate,t=>{t!==void 0&&(t.peerId===d(this,Ns).id?this.selfStageStatusHandler(t):this.peerStageStatusHandler(t))}),d(this,Ls).on(U.denyStageAccess,()=>{d(this,Ns).permissions.stageAccess!==j.Allowed&&(this.stage.emit("stageRequestRejected"),this.setStageStatus("OFF_STAGE"))}),d(this,Ls).on(U.getStageRequests,async t=>{var s;if(d(this,Ns).permissions.stageAccess!==j.Allowed)return;const e=(s=t==null?void 0:t.stageRequests)!=null?s:[];await P.emitAsync(k.GET_STAGE_REQUESTS,e),d(this,Ha)<e.length&&e.length>0&&this.stage.emit("newStageRequest",{count:e.length}),y(this,Ha,e.length),this.stage.emit("stageAccessRequestUpdate",e)})}getCurrentStageRequests(){return d(this,Pn).joined.toArray().filter(e=>e.stageStatus==="REQUESTED_TO_JOIN_STAGE").map(e=>({displayName:e.name,userId:e.userId,peerId:e.id}))}async setStageStatus(t){this.stage.status!==t&&d(this,rs).setValue("stageStatus",t)}selfStageStatusHandler(t){const e=Wu(t.stageType),s=d(this,rs).getValue("stageStatus");if(s!==e)switch(t.stageType){case 1:d(this,rs).setValue("stageStatus","ACCEPTED_TO_JOIN_STAGE",!1),this.stage.join();break;case 2:case 3:this.setStageStatus(s);break;case 0:case 4:default:d(this,rs).setValue("stageStatus","ACCEPTED_TO_JOIN_STAGE",!1),this.stage.leave();break}}async peerStageStatusHandler(t){const e=d(this,Pn).joined.get(t.peerId),s=d(this,Pn).viewMode==="ACTIVE_GRID";if(!e){u.warn("err::peerStageStatusUpdate: participant not found");return}switch(t.stageType){case 1:e.setStageStatus("ON_STAGE"),s&&P.emit(k.UPDATE_ACTIVE);break;case 2:e.setStageStatus("ACCEPTED_TO_JOIN_STAGE");break;case 3:e.setStageStatus("REQUESTED_TO_JOIN_STAGE");break;case 0:case 4:default:e.setStageStatus("OFF_STAGE"),s&&P.emit(k.UPDATE_ACTIVE);break}P.emit(k.UPDATE_PEER_STAGE_STATUS,{id:e.id,status:e.stageStatus})}}Ns=new WeakMap,Pn=new WeakMap,Ls=new WeakMap,Ha=new WeakMap,rs=new WeakMap,CO([v.trace("DyteStage.setupEvents")],Tv.prototype,"setupEvents",1);var RO=Object.defineProperty,PO=Object.getOwnPropertyDescriptor,zc=(r,t,e,s)=>{for(var n=s>1?void 0:s?PO(t,e):t,i=r.length-1,a;i>=0;i--)(a=r[i])&&(n=(s?a(t,e,n):a(n))||n);return s&&n&&RO(t,e,n),n};const Ue={getPeer:14,getPeers:15,chatMessage:16,getRoomName:17,getDisplayTitle:18,getPluginInitiator:19,customPluginEventToParent:20,peerJoined:22,peerLeft:23,sendData:24,stageStatusUpdate:25,peerStageStatusUpdate:26};let ci=(Ly=class extends si{constructor(t,{baseURL:e,createdAt:s,description:n,id:i,name:a,organizationId:o,picture:c,private:l,published:p,staggered:h,tags:f,type:g,updatedAt:_},w,R,D,x){super();E(this,kn);E(this,St,void 0);m(this,"baseURL");m(this,"createdAt");m(this,"description");m(this,"id");m(this,"name");E(this,Kt,void 0);E(this,ki,void 0);E(this,Ii,void 0);m(this,"organizationId");m(this,"picture");m(this,"private");m(this,"published");m(this,"staggered");m(this,"tags");m(this,"type");m(this,"updatedAt");E(this,ss,void 0);m(this,"config");E(this,Ai,void 0);m(this,"active");m(this,"iframes");m(this,"enabledBy");E(this,Mi,void 0);y(this,Mi,t),this.baseURL=e,this.createdAt=new Date(s),this.description=n,this.id=i,this.name=a,y(this,Kt,R),this.organizationId=o,this.picture=c,this.private=l,this.published=p,this.staggered=h,this.tags=f,this.type=g,this.updatedAt=new Date(_),this.active=!1,this.iframes=new Map,y(this,St,w),y(this,ki,D),y(this,Ii,x),this.enabledBy=""}sendIframeEvent(t){this.iframes.size&&this.iframes.forEach(e=>{const{iframe:s}=e;s&&(navigator.isReactNative?s.postMessage(JSON.stringify(t)):s.contentWindow.postMessage(t,"*"))})}async handleIframeMessage(t){var a;if(!this.active)return;const e=t,{payload:s,uuid:n,type:i}=e;switch(i){case G.customPluginEventToRoom:{d(this,St).customPluginEventToRoom(this.id,s,n);break}case G.customPluginEventToPeers:{d(this,St).customPluginEventToPeers(this.id,s.peerIds,s,n);break}case G.enablePluginForRoom:{d(this,St).enablePluginForRoom(this.id,n);break}case G.enablePluginForPeers:{d(this,St).enablePluginForPeers(this.id,s.peerIds,n);break}case G.disablePluginForRoom:{d(this,St).disablePluginForRoom(this.id,n);break}case G.disablePluginForPeers:{d(this,St).disablePluginForPeers(this.id,s.peerIds,n);break}case G.storeInsertKeys:{d(this,St).storeInsertKeys(this.id,s.store,s.insertKeys,n);break}case G.storeGetKeys:{d(this,St).storeGetKeys(this.id,s.store,s.getKeys,n);break}case G.storeDeleteKeys:{d(this,St).storeDeleteKeys(this.id,s.store,s.deleteKeys,n);break}case G.storeDelete:{d(this,St).storeDelete(this.id,s.store,n);break}case Ue.chatMessage:{const{messagePayload:o,peerIds:c}=s;if(!d(this,Ii)){this.sendIframeEvent({type:Ue.chatMessage,uuid:e.uuid,payload:{error:"Chat is disabled for this room."}});return}try{await d(this,Ii).sendMessage(o,c),this.sendIframeEvent({type:Ue.chatMessage,uuid:e.uuid,payload:{success:!0}})}catch(l){this.sendIframeEvent({type:Ue.chatMessage,uuid:e.uuid,payload:{error:l}})}break}case Ue.getPeer:{let o;const{peerId:c}=s,l={...d(this,Kt),id:d(this,Kt).id,isRecorder:(a=d(this,Kt).permissions)==null?void 0:a.isRecorder,isHidden:d(this,Kt).permissions.hiddenParticipant,stageStatus:d(this,Kt).stageStatus};c?(o=d(this,ki).joined.get(s.peerId),d(this,Kt).id===c&&(o=l)):o=l,this.sendIframeEvent({type:Ue.getPeer,payload:{peer:o&&Wc(o)},uuid:e.uuid});break}case Ue.getPeers:{const o=d(this,ki).joined.toArray().map(c=>Wc(c));this.sendIframeEvent({type:Ue.getPeers,payload:{peers:o},uuid:e.uuid});break}case Ue.getPluginInitiator:{this.sendIframeEvent({type:Ue.getPluginInitiator,payload:{enabledBy:this.enabledBy},uuid:e.uuid});break}case Ue.getDisplayTitle:{this.sendIframeEvent({type:Ue.getDisplayTitle,payload:{displayTitle:d(this,kn,Uo).meetingTitle},uuid:e.uuid});break}case Ue.getRoomName:{this.sendIframeEvent({type:Ue.getRoomName,payload:{roomName:d(this,kn,Uo).roomName},uuid:e.uuid});break}case Ue.customPluginEventToParent:{this.emit(e.payload.eventName,e.payload.data);break}}}sendData(t){this.active&&(u.info("DytePlugin::SendData",{plugin:{id:this.id,name:this.name,data:{eventName:t.eventName}}}),this.sendIframeEvent({type:Ue.sendData,uuid:"",payload:t}))}removePluginView(t="default"){var n;const{iframe:e,listener:s}=(n=this.iframes.get(t))!=null?n:{};(e||s)&&(navigator.isReactNative?e.props.onMessage=void 0:window.removeEventListener("message",s),this.iframes.delete(t))}addPluginView(t,e="default"){var a;if(!d(this,Ai))throw u.error("DytePlugin::addPluginView::no_auth_token_set_for_plugin"),new I("No auth token set for plugin.","0602");if(!t)throw u.error("DytePlugin::addPluginView::iframe_was_not_provided"),new I("Iframe was not provided.","0603");this.removePluginView(e);const s=t,n=new URL(this.baseURL),i={auth:d(this,Ai),parent:navigator.isReactNative?this.baseURL:window.location.origin,backend:d(this,Mi).getValue("apiBase"),pluginId:this.id,roomName:(a=d(this,kn,Uo).roomName)!=null?a:"",displayTitle:d(this,kn,Uo).meetingTitle};if(Object.keys(i).forEach(o=>{n.searchParams.set(o,i[o])}),s.src=n.href,s.allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",s.title=e,navigator.isReactNative)s.props.onMessage=o=>{this.handleIframeMessage(JSON.parse(o.nativeEvent.data))},this.iframes.set(e,{iframe:s});else{const o=async c=>{c.source===t.contentWindow&&await this.handleIframeMessage(c.data)};window.addEventListener("message",o),this.iframes.set(e,{iframe:s,listener:o})}}setActive(t){var e,s;if(this.active=t,t){this.emit("stateUpdate",{active:this.active,pluginId:this.id,bind:this.addPluginView.bind(this),views:(e=this.config)==null?void 0:e.views});return}this.active=!1,this.emit("stateUpdate",{active:this.active,pluginId:this.id,views:(s=this.config)==null?void 0:s.views})}async activateForSelf(){const t=tt(),e=await t.authorizePlugin(this.id);y(this,Ai,e),y(this,ss,new Date);try{const s=await t.getPluginConfig(this.baseURL);this.config=s}catch(s){u.error("DytePlugin::activateForSelf",{error:s})}this.setActive(!0),this.emit("enabled")}deactivateForSelf(){Array.from(this.iframes.keys()).forEach(t=>{this.removePluginView(t)}),y(this,ss,void 0),this.iframes.clear(),this.setActive(!1),this.emit("closed")}async enable(){return this.activateForSelf()}disable(){return this.deactivateForSelf()}async activate(){var t,e;this.active||(e=(t=d(this,Kt).permissions)==null?void 0:t.plugins)!=null&&e.canStart&&(d(this,St).addPlugin(this.id,this.staggered),y(this,ss,new Date),u.info("plugin::activated",{plugin:{id:this.id,enabledBy:this.enabledBy,name:this.name}}))}async deactivate(){var t,e;this.active&&(!((e=(t=d(this,Kt).permissions)==null?void 0:t.plugins)!=null&&e.canClose)&&this.enabledBy!==d(this,Kt).id||(d(this,St).removePlugin(this.id),u.info("plugin::deactivated",{plugin:{id:this.id,name:this.name,duration:d(this,ss)?new Date().getTime()-d(this,ss).getTime():0}}),y(this,ss,void 0)))}},St=new WeakMap,Kt=new WeakMap,ki=new WeakMap,Ii=new WeakMap,ss=new WeakMap,Ai=new WeakMap,Mi=new WeakMap,kn=new WeakSet,Uo=function(){return d(this,Mi).getValue("roomNodeClient")},Ly);zc([Lt({maxInvocations:5,period:1})],ci.prototype,"sendData",1),zc([v.trace("DytePlugin.activatePlugin")],ci.prototype,"activate",1),zc([v.trace("DytePlugin.deactivatePlugin")],ci.prototype,"deactivate",1),ci=zc([mt("0600")],ci);class Sv extends Map{constructor(e){const{onAddEvent:s,onDeleteEvent:n,onClearEvent:i}=e;super();E(this,Je,void 0);E(this,In,void 0);m(this,"onAddEvent");m(this,"onDeleteEvent");m(this,"onClearEvent");y(this,Je,new si),this.onAddEvent=s,this.onDeleteEvent=n,this.onClearEvent=i,y(this,In,new Map)}emit(e,...s){return d(this,Je).emit(e,...s)}on(e,s){return d(this,Je).on(e,s)}addListener(e,s){return d(this,Je).addListener(e,s)}off(e,s){return d(this,Je).off(e,s)}once(e,s){return d(this,Je).once(e,s)}prependListener(e,s){return d(this,Je).prependListener(e,s)}prependOnceListener(e,s){return d(this,Je).prependOnceListener(e,s)}removeListener(e,s){return d(this,Je).removeListener(e,s)}removeAllListeners(e){return d(this,Je).removeAllListeners(e)}listeners(e){return d(this,Je).listeners(e)}listenerCount(e){return d(this,Je).listenerCount(e)}getMaxListeners(){return d(this,Je).getMaxListeners()}setMaxListeners(e){return d(this,Je).setMaxListeners(e)}eventNames(){return d(this,Je).eventNames()}add(e,s=!0){return this.set(e.id,e,s)}set(e,s,n=!0){const i=super.set(e,s),a=(o,...c)=>{this.emit(o,s,...c)};return d(this,In).set(e,a),s.on("*",a),n&&d(this,Je).emit(this.onAddEvent,s),i}delete(e,s=!0,n=!1){const i=this.get(e);if(!i)return!1;i.removeListener("*",d(this,In).get(e));const a=super.delete(e);return n&&i.removeAllListeners(),s&&d(this,Je).emit(this.onDeleteEvent,i),a}clear(e=!0,s=!1){this.forEach(i=>{i.removeListener("*",d(this,In).get(i.id)),s&&i.removeAllListeners()});const n=super.clear();return e&&d(this,Je).emit(this.onClearEvent),n}toArray(){return Array.from(this.values())}}Je=new WeakMap,In=new WeakMap;class Ev extends Sv{constructor(){super({onAddEvent:"pluginAdded",onDeleteEvent:"pluginDeleted"})}add(t,e=!0){return super.add(t,e)}delete(t,e=!0,s=!1){return super.delete(t,e,s)}}var kO=Object.defineProperty,IO=Object.getOwnPropertyDescriptor,AO=(r,t,e,s)=>{for(var n=s>1?void 0:s?IO(t,e):t,i=r.length-1,a;i>=0;i--)(a=r[i])&&(n=(s?a(t,e,n):a(n))||n);return s&&n&&kO(t,e,n),n};let Ju=class{constructor(){m(this,"all");m(this,"active");this.all=new Ev,this.active=new Ev}};Ju=AO([mt("0600")],Ju);var MO=Object.defineProperty,DO=Object.getOwnPropertyDescriptor,Yc=(r,t,e,s)=>{for(var n=s>1?void 0:s?DO(t,e):t,i=r.length-1,a;i>=0;i--)(a=r[i])&&(n=(s?a(t,e,n):a(n))||n);return s&&n&&MO(t,e,n),n};const _v=(xy=class{constructor(r,t,e,s){m(this,"plugins");E(this,sr,void 0);E(this,Di,void 0);E(this,qa,void 0);y(this,sr,t),y(this,Di,e),y(this,qa,r),this.plugins=s,this.setupEvents()}static async init(r,t,e,s,n,i,a){const o=new Ju;return t.forEach(c=>{const l=new ci(r,c,e,i,a,n);o.all.add(l)}),new _v(r,e,s,o)}async getRoomPlugins(){var t;const{plugins:r}=await d(this,sr).getActivePlugins();(t=this.plugins.active)==null||t.toArray().forEach(e=>{this.disablePlugin({id:e.id})}),await Promise.all(r.map(e=>this.enablePlugin({id:e.pluginId,enabledBy:e.enabledBy})))}async enablePlugin({id:r,enabledBy:t}){const e=this.plugins.all.get(r);e&&(await e.activateForSelf(),e.enabledBy=t)}async disablePlugin({id:r}){const t=this.plugins.all.get(r);t&&t.deactivateForSelf()}sendIframeEvent(r,t,e,s){const n=this.plugins.all.get(t);n&&n.sendIframeEvent({type:r,uuid:e,payload:s})}broadcastIframeEvent(r,t){this.plugins.active.forEach(e=>{this.sendIframeEvent(r,e.id,"",t)})}setupEvents(){this.plugins.all.on("stateUpdate",({active:r,id:t})=>{if(r){this.plugins.active.add(this.plugins.all.get(t));return}this.plugins.active.delete(t)}),P.onAsync(k.SOCKET_SERVICE_ROOM_JOINED,async()=>{await this.getRoomPlugins(),u.debug("[SOCKET_SERVICE_ROOM_JOINED] resolved request to fetch plugins.")}),d(this,sr).on(G.addPlugin,async r=>{var e;const t=r.pluginId;(e=this.plugins.all.get(t))!=null&&e.active||await this.enablePlugin({id:t,enabledBy:r.enabledBy})}),d(this,sr).on(G.removePlugin,async r=>{var e;const t=r.pluginId;(e=this.plugins.all.get(t))!=null&&e.active&&await this.disablePlugin({id:t})}),[G.enablePluginForPeers,G.enablePluginForRoom].forEach(r=>{d(this,sr).on(r,async(t,e)=>{this.sendIframeEvent(r,t.pluginId,e,{enabledBy:t.enabledBy})})}),[G.disablePluginForPeers,G.disablePluginForRoom].forEach(r=>{d(this,sr).on(r,async(t,e)=>{this.sendIframeEvent(r,t.pluginId,e,{disabledBy:t.disabledBy})})}),[G.customPluginEventToPeers,G.customPluginEventToRoom].forEach(r=>{d(this,sr).on(r,async(t,e)=>{this.sendIframeEvent(r,t.pluginId,e,{data:JSON.parse(new TextDecoder().decode(t.pluginData))})})}),[G.storeInsertKeys,G.storeGetKeys,G.storeDeleteKeys].forEach(r=>{d(this,sr).on(r,async(t,e)=>{var n;const s=(n=t.storeItems)==null?void 0:n.map(i=>{var a;return{timestamp:i.timestamp,peerId:i.peerId,payload:JSON.parse((a=i.payload)!=null&&a.length?new TextDecoder().decode(i.payload):"{}"),key:i.storeKey}});this.sendIframeEvent(r,t.pluginId,e,{storeName:t.storeName,storeItems:s})})}),d(this,sr).on(G.storeDelete,async(r,t)=>{this.sendIframeEvent(G.storeDelete,r.pluginId,t,{storeName:r.storeName})}),d(this,Di).on(xe.sendMessageToPeers,r=>{const t=gr==null?void 0:gr.formatSocketServiceMessage(r.message);this.broadcastIframeEvent(Ue.chatMessage,{message:t})}),d(this,Di).on(xe.sendMessageToRoom,r=>{const t=gr==null?void 0:gr.formatSocketServiceMessage(r.message);this.broadcastIframeEvent(Ue.chatMessage,{message:t})}),P.on(k.PEER_JOINED_INTERNAL,r=>{const t=Wc(r);this.broadcastIframeEvent(Ue.peerJoined,t)}),P.on(k.PEER_CLOSED,r=>{this.broadcastIframeEvent(Ue.peerLeft,r)}),P.on(k.UPDATE_PEER_STAGE_STATUS,r=>{this.broadcastIframeEvent(Ue.peerStageStatusUpdate,r)}),d(this,qa).subscribe("stageStatus",r=>{this.broadcastIframeEvent(Ue.stageStatusUpdate,r)})}},sr=new WeakMap,Di=new WeakMap,qa=new WeakMap,xy);let Sa=_v;Yc([v.trace("PluginController.getRoomPlugins")],Sa.prototype,"getRoomPlugins",1),Yc([v.trace("PluginController.enableForSelf")],Sa.prototype,"enablePlugin",1),Yc([v.trace("PluginController.disableForSelf")],Sa.prototype,"disablePlugin",1),Yc([v.trace("PluginController.setupEvents")],Sa.prototype,"setupEvents",1);class OO{constructor(){m(this,"mediaJoined");m(this,"socketJoined");m(this,"socketJoinAttempted");m(this,"mediaJoinAttempted");m(this,"socketState");m(this,"mediaState");this.mediaJoined=!1,this.socketJoined=!1,this.socketJoinAttempted=!1,this.mediaJoinAttempted=!1,this.socketState={state:void 0,reconnected:!1,reconnectionAttempt:void 0},this.mediaState={recv:void 0,send:void 0}}get joinAttempted(){return this.mediaJoinAttempted||this.socketJoinAttempted}get roomJoined(){return this.mediaJoined&&this.socketJoined}updateSocketConnectionState(t,e){let s;const{reconnected:n}=this.socketState;switch(t){case"connected":s={state:"connected",reconnected:n,reconnectionAttempt:void 0};break;case"disconnected":s={state:"disconnected",reconnected:!1,reconnectionAttempt:0},this.socketJoined=!1;break;case"reconnected":s={state:"connected",reconnected:!0,reconnectionAttempt:void 0};break;case"reconnecting":s={state:"reconnecting",reconnected:n,reconnectionAttempt:0};break;case"reconnectAttempt":s={state:"reconnecting",reconnected:n,reconnectionAttempt:e};break;case"failed":s={state:"failed",reconnected:n,reconnectionAttempt:void 0},this.socketJoined=!1;break}s&&(P.emit(k.SOCKET_STATE_UPDATE,s),this.socketState=s)}}var NO=Object.defineProperty,LO=Object.getOwnPropertyDescriptor,Ea=(r,t,e,s)=>{for(var n=s>1?void 0:s?LO(t,e):t,i=r.length-1,a;i>=0;i--)(a=r[i])&&(n=(s?a(t,e,n):a(n))||n);return s&&n&&NO(t,e,n),n};let ln=(Fy=class extends qt{constructor(t,e){super();E(this,Ni);E(this,Oi,void 0);E(this,ja,void 0);m(this,"recordingPeerIds",[]);m(this,"recordings",[]);y(this,ja,t),y(this,Oi,e)}get recordingState(){return this.recordings.some(t=>t.state==="RECORDING")?"RECORDING":this.recordings.some(t=>t.state==="PAUSED")?"PAUSED":this.recordings.some(t=>t.state==="STARTING")?"STARTING":this.recordings.some(t=>t.state==="STOPPING")?"STOPPING":"IDLE"}updateRecordings(t){this.recordings=t,this.emit("recordingUpdate",this.recordingState)}async start(t){if(!d(this,Oi).permissions.canRecord)throw u.error("DyteRecording::start::permission_denied"),new I("User does not have permission to start recording","1001");if((t==null?void 0:t.allowMultiple)!==!0&&(this.recordingState==="STARTING"||this.recordingState==="RECORDING"||this.recordingState==="STOPPING"))throw u.error("DyteRecording::start::recording_in_progress",{recording:{state:this.recordingState}}),new I(`Cant start recording, recordingState irregular: ${this.recordingState}`,"1005");try{const e=tt(),{recording:s={}}=d(this,ja).getValue("defaults"),n=await e.startRecording(s,t==null?void 0:t.allowMultiple);this.updateRecordings([...this.recordings,{id:n,state:"STARTING",type:"BROWSER"}])}catch(e){throw u.error("DyteRecording::stop::recording_failed_to_start",{error:e}),new I("Error while starting recording","1000")}}async stop(t){await qe(this,Ni,Wd).call(this,"stop",["RECORDING","PAUSED"],t)}async pause(t){await qe(this,Ni,Wd).call(this,"pause",["RECORDING"],t)}async resume(t){await qe(this,Ni,Wd).call(this,"resume",["PAUSED"],t)}},Oi=new WeakMap,ja=new WeakMap,Ni=new WeakSet,Wd=async function(t,e,s){if(!d(this,Oi).permissions.canRecord)throw u.error("DyteRecording::stop::permission_denied"),new I("User does not have permission to stop recording","1001");let n=[];if(s!==void 0){const i=this.recordings.find(a=>a.id===s);if(i===void 0)throw new I("Could not find the specified recording","1004");if(e.includes(i.state)){u.error("DyteRecording::stop::recording_not_in_expected_state",{recording:{state:i.state}});return}n.push(i)}else n=this.recordings.filter(i=>e.includes(i.state));n.forEach(async i=>{const a=i.state;t==="stop"&&(i.state="STOPPING",this.emit("recordingUpdate","STOPPING"));try{await tt().updateRecording(i.id,t)}catch(o){throw u.error("DyteRecording::stop::recording_failed_to_stop",{error:o}),i.state!==a&&(i.state=a,this.emit("recordingUpdate",a)),new I("Error while stopping recording","1000")}})},Fy);Ea([v.trace("DyteRecording.start")],ln.prototype,"start",1),Ea([v.trace("DyteRecording.stop")],ln.prototype,"stop",1),Ea([v.trace("DyteRecording.stop")],ln.prototype,"pause",1),Ea([v.trace("DyteRecording.stop")],ln.prototype,"resume",1),ln=Ea([mt("1000")],ln);var xO=Object.defineProperty,FO=Object.getOwnPropertyDescriptor,$O=(r,t,e,s)=>{for(var n=s>1?void 0:s?FO(t,e):t,i=r.length-1,a;i>=0;i--)(a=r[i])&&(n=(s?a(t,e,n):a(n))||n);return s&&n&&xO(t,e,n),n};class wv{constructor(t,e,s){m(this,"recording");m(this,"room");E(this,Dd,void 0);y(this,Dd,t),this.recording=new ln(t,e),this.room=s,this.setupEvents()}getRecordingTypeFromProtoType(t){let e;switch(t){case sn.BROWSER:e="BROWSER";break;case sn.COMPOSITE:e="COMPOSITE";break;case sn.TRACK:e="TRACK";break;default:e="BROWSER"}return e}setupEvents(){P.on(k.ROOM_STATE,t=>{t.activeRecordings.length!==0?this.recording.updateRecordings(t.activeRecordings.map(e=>{const s=this.getRecordingTypeFromProtoType(e.recordingType);return{id:e.recordingId,state:e.recordingStatus,type:s}})):this.recording.recordings.length&&this.recording.updateRecordings([])}),this.room.on(U.recordingStarted,t=>{let e=!1;const s=[...this.recording.recordings];if(s.forEach(n=>{n.id===t.recordingId&&(e=!0,n.state="RECORDING")}),e===!1){const n=this.getRecordingTypeFromProtoType(t.recordingType);s.push({id:t.recordingId,state:"RECORDING",type:n})}this.recording.updateRecordings(s)}),this.room.on(U.recordingPaused,t=>{const e=[...this.recording.recordings];e.forEach(s=>{s.id===t.recordingId&&(s.state="PAUSED")}),this.recording.updateRecordings(e)}),this.room.on(U.recordingStopped,t=>{const e=[...this.recording.recordings.filter(s=>s.id!==t.recordingId)];this.recording.updateRecordings(e)})}}Dd=new WeakMap,$O([v.trace("RecordingController.setupEvents")],wv.prototype,"setupEvents",1);class UO{static hasFeature(t){var e;return(e=J.hasFeature(t))!=null?e:!1}static getFeatureValue(t){return J.getValue(t)}static getAllFeatures(){return J.getAllFlags()}}class Ku{constructor(t,e,s){m(this,"logger");m(this,"features");m(this,"browserSpecs");m(this,"callStats");this.logger=t,this.features=e,this.browserSpecs=Re,this.callStats=s}static init(t){return new Ku(u,UO,t)}}class zu{constructor(t){m(this,"internals");this.internals=t}static async init(){const t=Ku.init(q);return new zu(t)}}var VO=Object.defineProperty,BO=Object.getOwnPropertyDescriptor,Gt=(r,t,e,s)=>{for(var n=s>1?void 0:s?BO(t,e):t,i=r.length-1,a;i>=0;i--)(a=r[i])&&(n=(s?a(t,e,n):a(n))||n);return s&&n&&VO(t,e,n),n};class xt extends si{constructor(e,s,n=Yu,i=!0){super();E(this,rt,void 0);E(this,Ke,void 0);E(this,Ae,void 0);E(this,Mr,void 0);E(this,nr,void 0);E(this,Ga,void 0);E(this,Od,void 0);m(this,"audioUpdateInProgress");m(this,"videoUpdateInProgress");y(this,Od,e),this.audioUpdateInProgress=!1,this.videoUpdateInProgress=!1,y(this,rt,new Dv(e,s)),y(this,Ke,new mN(d(this,rt),void 0,n)),y(this,Ae,new EN(d(this,rt),void 0,n)),y(this,nr,new yN(d(this,rt))),y(this,Mr,new gN(d(this,rt))),y(this,Ga,i),d(this,Ke).on("trackMuted",this.onAudioTrackMuted.bind(this)),d(this,Ke).on("trackChanged",this.onAudioTrackChanged.bind(this)),d(this,Ae).on("trackChanged",this.onVideoTrackChanged.bind(this)),d(this,Ae).on("trackEnded",this.onVideoTrackEnded.bind(this)),d(this,nr).on("trackEnded",this.onScreenShareEnded.bind(this)),this.onVisibilityChange=this.onVisibilityChange.bind(this),document.addEventListener("visibilitychange",this.onVisibilityChange)}async onVisibilityChange(){q.tabChanged(document.visibilityState==="visible"),document.visibilityState!=="visible"?q.browserBackgrounded():(q.browserForegrounded(),await this.setupSpeaker())}async repopulateAvailableDevices(){return!0}async setupStreams({audio:e,video:s}){var a;e?q.audioOn():q.audioOff(),s?q.videoOn():q.videoOff();let n,i;if(e&&s)try{const o=await d(this,rt).getAudioAndVideoTrack(d(this,Ke).userSelectedDevice,d(this,Ae).userSelectedDevice);n=o.audioTrack,i=o.videoTrack}catch(o){u.error("LocalMediaHandler::init::Failed to get audio video tracks",{error:o})}if(!n&&e)try{n=await d(this,rt).getAudioTrack(!1,d(this,Ke).userSelectedDevice)}catch(o){u.error("LocalMediaHandler::init::Failed to get audio track",{error:o})}if(!i&&s)try{i=await d(this,rt).getVideoTrack(d(this,Ae).userSelectedDevice)}catch(o){u.error("LocalMediaHandler::init::Failed to get video track",{error:o})}e&&!n&&q.audioOff(),s&&!i&&q.videoOff(),await d(this,Ke).setMediaTrack(n),await d(this,Ae).setMediaTrack(i);try{await d(this,Mr).setupSpeaker()}catch(o){}if(i){const o=await this.getDeviceById(i.getSettings().deviceId);q.selectedDevice("VIDEO",o)}if(n){const o=await this.getDeviceById(n.getSettings().deviceId);q.selectedDevice("AUDIO",o)}(a=d(this,Mr).currentDevice)!=null&&a.deviceId&&q.selectedDevice("SPEAKER",d(this,Mr).currentDevice),d(this,rt).onDeviceChange((o,c,l)=>{this.onDeviceChange(c,l)})}getCurrentDevices(){return{audio:d(this,Ke).currentDevice,video:d(this,Ae).currentDevice,speaker:d(this,Mr).currentDevice}}get permissions(){return d(this,rt).permissions}getAllDevices(){return d(this,rt).getAvailableDevices()}getDeviceById(e,s){return d(this,rt).getDevice(e)}onAudioTrackMuted(){this.emit("AUDIO_TRACK_SILENT")}onAudioTrackChanged(){this.emit("AUDIO_TRACK_CHANGE")}get rawAudioTrack(){return d(this,Ke).mediaTrack}get audioTrack(){return d(this,Ke).transformedMediaTrack}get audioEnabled(){return d(this,Ke).trackEnabled}async enableAudio(){if(!this.audioUpdateInProgress){this.audioUpdateInProgress=!0;try{await d(this,Ke).unmuteTrack()}catch(e){}finally{this.audioUpdateInProgress=!1}}}disableAudio(){d(this,Ke).muteTrack()}getAudioDevices(e){return d(this,rt).getAudioInputDevices(e)}async setAudioDevice(e){await d(this,Ke).setDevice(e),e!=null&&e.deviceId&&q.selectedDevice("AUDIO",e),this.emit("AUDIO_TRACK_CHANGE"),this.emit("DEVICE_CHANGE",{device:e})}setupSpeaker(){return d(this,Mr).setupSpeaker()}async setSpeakerDevice(e){await d(this,Mr).setupSpeaker(e),e!=null&&e.deviceId&&q.selectedDevice("SPEAKER",e),this.emit("DEVICE_CHANGE",{device:e})}onVideoTrackChanged(){this.emit("VIDEO_TRACK_CHANGE")}onVideoTrackEnded(){this.emit("VIDEO_TRACK_CHANGE")}get rawVideoTrack(){return d(this,Ae).mediaTrack}get videoTrack(){return d(this,Ae).transformedMediaTrack}get videoEnabled(){return d(this,Ae).trackEnabled}async enableVideo(){if(!this.videoUpdateInProgress){this.videoUpdateInProgress=!0;try{await d(this,Ae).unmuteTrack()}catch(e){}finally{this.videoUpdateInProgress=!1}}}disableVideo(){d(this,Ae).disableTrack()}getVideoDevices(e){return d(this,rt).getVideoInputDevices(e)}async setVideoDevice(e){await d(this,Ae).setDevice(e),e!=null&&e.deviceId&&q.selectedDevice("VIDEO",e),this.emit("VIDEO_TRACK_CHANGE"),this.emit("DEVICE_CHANGE",{device:e})}async updateVideoConstraints(e){await d(this,Ae).updateConstraints(e)}onScreenShareEnded(){this.emit("SCREENSHARE_ENDED")}get screenShareTracks(){return{audio:d(this,nr).audioMediaTrack,video:d(this,nr).videoMediaTrack}}get screenShareEnabled(){return d(this,nr).trackEnabled}async enableScreenShare(){await d(this,nr).enableScreenShare()}async disableScreenShare(){d(this,nr).disableScreenShare()}async updateScreenshareConstraints(e){await d(this,nr).updateConstraints(e)}getSpeakerDevices(e){return d(this,rt).getAudioOutputDevices(e)}addAudioMiddleware(e){return d(this,Ke).addMiddleware(e)}removeAudioMiddleware(e){return d(this,Ke).removeMiddleware(e)}removeAllAudioMiddlewares(){return d(this,Ke).removeAllMiddlewares()}addVideoMiddleware(e){return d(this,Ae).addMiddleware(e)}removeVideoMiddleware(e){return d(this,Ae).removeMiddleware(e)}removeAllVideoMiddlewares(){return d(this,Ae).removeAllMiddlewares()}setVideoMiddlewareGlobalConfig(e){return d(this,Ae).setVideoMiddlewareGlobalConfig(e)}destruct(){d(this,Ke).disableTrack(),d(this,Ae).disableTrack(),d(this,Ae).terminateMiddlewareWebWorker(),d(this,nr).disableScreenShare(),d(this,rt).destruct()}async onDeviceChange(e,s){var n,i;this.emit("DEVICE_LIST_UPDATED",e),!(s||!d(this,Ga))&&((n=e==null?void 0:e.added)==null||n.forEach(async a=>{var o;a&&!Yu(a)&&(a.kind==="audioinput"&&((o=this.audioTrack)==null?void 0:o.enabled)===!0?await this.setAudioDevice(a):a.kind==="audiooutput"&&await this.setSpeakerDevice(a))}),(i=e==null?void 0:e.removed)==null||i.forEach(async a=>{var o;if(a.kind==="audiooutput"&&((o=this.getCurrentDevices().speaker)==null?void 0:o.deviceId)===a.deviceId){const c=(await this.getSpeakerDevices()).find(l=>l.deviceId!==a.deviceId);c&&await this.setSpeakerDevice(c)}}))}removeAllTracks(){this.destruct()}removeAudioTrack(){d(this,Ke).disableTrack()}removeVideoTrack(){d(this,Ae).disableTrack(),d(this,Ae).terminateMiddlewareWebWorker()}async removeDocumentEventListeners(){document.removeEventListener("visibilitychange",this.onVisibilityChange)}}rt=new WeakMap,Ke=new WeakMap,Ae=new WeakMap,Mr=new WeakMap,nr=new WeakMap,Ga=new WeakMap,Od=new WeakMap,Gt([v.trace("MediaHandler.setupStreams")],xt.prototype,"setupStreams",1),Gt([v.trace("MediaHandler.enableAudio")],xt.prototype,"enableAudio",1),Gt([v.trace("MediaHandler.disableAudio")],xt.prototype,"disableAudio",1),Gt([v.trace("MediaHandler.setAudioDevice")],xt.prototype,"setAudioDevice",1),Gt([v.trace("MediaHandler.enableVideo")],xt.prototype,"enableVideo",1),Gt([v.trace("MediaHandler.disableVideo")],xt.prototype,"disableVideo",1),Gt([v.trace("MediaHandler.setVideoDevice")],xt.prototype,"setVideoDevice",1),Gt([v.trace("MediaHandler.updateVideoConstraints")],xt.prototype,"updateVideoConstraints",1),Gt([v.trace("MediaHandler.enableScreenShare")],xt.prototype,"enableScreenShare",1),Gt([v.trace("MediaHandler.disableScreenShare")],xt.prototype,"disableScreenShare",1),Gt([v.trace("MediaHandler.updateScreenshareConstraints")],xt.prototype,"updateScreenshareConstraints",1),Gt([v.trace("MediaHandler.destruct")],xt.prototype,"destruct",1),Gt([v.trace("MediaHandler.onDeviceChange")],xt.prototype,"onDeviceChange",1);function Qc(r,t,e){switch(!0){case Re.isChromiumBased():switch(t){case"NotAllowedError":return e.includes("by system")?"SYSTEM_DENIED":r==="screenshare"?"CANCELED":"DENIED";case"NotReadableError":default:return"COULD_NOT_START"}case Re.isSafari():switch(t){case"NotAllowedError":return"DENIED";default:return"COULD_NOT_START"}case Re.isFirefox():switch(t){case"NotFoundError":case"NotReadableError":return"SYSTEM_DENIED";case"NotAllowedError":return"DENIED";case"AbortError":default:return"COULD_NOT_START"}default:return"COULD_NOT_START"}}const HO=["virtual","emulator","krisp","solstice conference","teams","loom","zoom","manycam","blackhole","displayport","xsplit","wirecast","vMix","elgato","epiphan","voice changer","voicemod","morphvoxx"];function Yu(r){var e,s;const t=(e=r.label)==null?void 0:e.toLowerCase();return((s=Re._bowser)==null?void 0:s.getOSName())==="macOS"&&t.includes("iphone")?(u.log("isVirtualDevice::ignore_macos_continuity"),!0):HO.some(n=>t==null?void 0:t.includes(n))}async function qO(r,t){if(!(r!=null&&r.length))return t;const e=new AudioContext,s=await Promise.all(r==null?void 0:r.map(a=>a(e))),n=e.createMediaStreamSource(new MediaStream([t])),i=e.createMediaStreamDestination();try{let a=n;for(let o=0;o<s.length;o+=1)a.connect(s[o]),a=s[o];a.connect(i)}catch(a){return u.error("getTransformedAudioTrack::middleware_execution_failed",{error:a}),t}return i.stream.getAudioTracks()[0]}const jO=r=>(t,e)=>(r.set(t,e),e),bv=Number.MAX_SAFE_INTEGER===void 0?9007199254740991:Number.MAX_SAFE_INTEGER,Cv=536870912,Rv=Cv*2,GO=(r,t)=>e=>{const s=t.get(e);let n=s===void 0?e.size:s<Rv?s+1:0;if(!e.has(n))return r(e,n);if(e.size<Cv){for(;e.has(n);)n=Math.floor(Math.random()*Rv);return r(e,n)}if(e.size>bv)throw new Error("Congratulations, you created a collection of unique numbers which uses all available integers!");for(;e.has(n);)n=Math.floor(Math.random()*bv);return r(e,n)},Pv=new WeakMap,WO=jO(Pv),Xc=GO(WO,Pv),JO=r=>r.method!==void 0&&r.method==="call",KO=r=>r.error===null&&typeof r.id=="number",Zc=((r,t)=>{let e=null;return()=>{if(e!==null)return e;const s=new Blob([t],{type:"application/javascript; charset=utf-8"}),n=URL.createObjectURL(s);return e=r(n),setTimeout(()=>URL.revokeObjectURL(n)),e}})(r=>{const t=new Map([[0,()=>{}]]),e=new Map([[0,()=>{}]]),s=new Map,n=new Worker(r);return n.addEventListener("message",({data:l})=>{if(JO(l)){const{params:{timerId:p,timerType:h}}=l;if(h==="interval"){const f=t.get(p);if(typeof f=="number"){const g=s.get(f);if(g===void 0||g.timerId!==p||g.timerType!==h)throw new Error("The timer is in an undefined state.")}else if(typeof f!="undefined")f();else throw new Error("The timer is in an undefined state.")}else if(h==="timeout"){const f=e.get(p);if(typeof f=="number"){const g=s.get(f);if(g===void 0||g.timerId!==p||g.timerType!==h)throw new Error("The timer is in an undefined state.")}else if(typeof f!="undefined")f(),e.delete(p);else throw new Error("The timer is in an undefined state.")}}else if(KO(l)){const{id:p}=l,h=s.get(p);if(h===void 0)throw new Error("The timer is in an undefined state.");const{timerId:f,timerType:g}=h;s.delete(p),g==="interval"?t.delete(f):e.delete(f)}else{const{error:{message:p}}=l;throw new Error(p)}}),{clearInterval:l=>{const p=Xc(s);s.set(p,{timerId:l,timerType:"interval"}),t.set(l,p),n.postMessage({id:p,method:"clear",params:{timerId:l,timerType:"interval"}})},clearTimeout:l=>{const p=Xc(s);s.set(p,{timerId:l,timerType:"timeout"}),e.set(l,p),n.postMessage({id:p,method:"clear",params:{timerId:l,timerType:"timeout"}})},setInterval:(l,p=0)=>{const h=Xc(t);return t.set(h,()=>{l(),typeof t.get(h)=="function"&&n.postMessage({id:null,method:"set",params:{delay:p,now:performance.now(),timerId:h,timerType:"interval"}})}),n.postMessage({id:null,method:"set",params:{delay:p,now:performance.now(),timerId:h,timerType:"interval"}}),h},setTimeout:(l,p=0)=>{const h=Xc(e);return e.set(h,l),n.postMessage({id:null,method:"set",params:{delay:p,now:performance.now(),timerId:h,timerType:"timeout"}}),h}}},`(()=>{"use strict";const e=new Map,t=new Map,r=(e,t)=>{let r,o;const i=performance.now();r=i,o=e-Math.max(0,i-t);return{expected:r+o,remainingDelay:o}},o=(e,t,r,i)=>{const s=performance.now();s>r?postMessage({id:null,method:"call",params:{timerId:t,timerType:i}}):e.set(t,setTimeout(o,r-s,e,t,r,i))};addEventListener("message",(i=>{let{data:s}=i;try{if("clear"===s.method){const{id:r,params:{timerId:o,timerType:i}}=s;if("interval"===i)(t=>{const r=e.get(t);if(void 0===r)throw new Error('There is no interval scheduled with the given id "'.concat(t,'".'));clearTimeout(r),e.delete(t)})(o),postMessage({error:null,id:r});else{if("timeout"!==i)throw new Error('The given type "'.concat(i,'" is not supported'));(e=>{const r=t.get(e);if(void 0===r)throw new Error('There is no timeout scheduled with the given id "'.concat(e,'".'));clearTimeout(r),t.delete(e)})(o),postMessage({error:null,id:r})}}else{if("set"!==s.method)throw new Error('The given method "'.concat(s.method,'" is not supported'));{const{params:{delay:i,now:n,timerId:a,timerType:d}}=s;if("interval"===d)((t,i,s)=>{const{expected:n,remainingDelay:a}=r(t,s);e.set(i,setTimeout(o,a,e,i,n,"interval"))})(i,a,n);else{if("timeout"!==d)throw new Error('The given type "'.concat(d,'" is not supported'));((e,i,s)=>{const{expected:n,remainingDelay:a}=r(e,s);t.set(i,setTimeout(o,a,t,i,n,"timeout"))})(i,a,n)}}}}catch(e){postMessage({error:{message:e.message},id:s.id,result:null})}}))})();`),kv=r=>Zc().clearInterval(r),zO=r=>Zc().clearTimeout(r),Iv=(r,t)=>Zc().setInterval(r,t),YO=Object.freeze(Object.defineProperty({__proto__:null,clearInterval:kv,clearTimeout:zO,setInterval:Iv,setTimeout:(r,t)=>Zc().setTimeout(r,t)},Symbol.toStringTag,{value:"Module"}));class QO{constructor(){E(this,An,void 0)}terminateMiddlewareWebWorker(){if(d(this,An))try{kv(d(this,An)),y(this,An,void 0)}catch(t){u.debug("WorkerTimers::terminateMiddlewareWebWorker::failed")}}async getTransformedVideoTrack(t,e,s){if(!(t!=null&&t.length))return e;const n=document.createElement("canvas"),i=await Promise.all(t==null?void 0:t.map(h=>h({canvas:n,WorkerTimers:YO})));if(s.disablePerFrameCanvasRendering)return n.captureStream().getVideoTracks()[0];const a=document.createElement("video"),o=new MediaStream;o.addTrack(e);const c=n.getContext("2d");a.srcObject=o,a.autoplay=!0,this.terminateMiddlewareWebWorker();const l=async()=>{if(e.enabled===!1||e.readyState==="ended"){this.terminateMiddlewareWebWorker(),a.remove(),n.remove();return}try{c.drawImage(a,0,0);for(let h=0;h<i.length;h+=1)typeof i[h]=="function"&&await i[h](n,c)}catch(h){u.error("getTransformedVideoTrack::middleware_execution_failed",{error:h})}};try{a.play()}catch(h){}return a.addEventListener("play",()=>{n.width=a.width||e.getSettings().width,n.height=a.width||e.getSettings().height,y(this,An,Iv(l,50))},!1),n.captureStream().getVideoTracks()[0]}}An=new WeakMap;const Av={gross:{width:{ideal:192},height:{ideal:144}},qvga:{width:{ideal:384},height:{ideal:288}},pvga:{width:{ideal:480},height:{ideal:360}},vga:{width:{ideal:640},height:{ideal:480}},hd:{width:{ideal:1280},height:{ideal:720}},hd_cropped:{width:{ideal:900},height:{ideal:720}},fhd:{width:{ideal:1920},height:{ideal:1080}}},Mv={320:[{rid:"q",maxBitrate:25e4,maxFramerate:24,scalabilityMode:"L1T1"}],640:[{rid:"q",scaleResolutionDownBy:2,maxBitrate:25e4,maxFramerate:24,scalabilityMode:"L1T1"},{rid:"h",maxBitrate:7e5,maxFramerate:30,scalabilityMode:"L1T1"}],1280:[{rid:"q",scaleResolutionDownBy:2,maxBitrate:5e5,maxFramerate:24,scalabilityMode:"L1T1"},{rid:"h",maxBitrate:13e5,maxFramerate:30,scalabilityMode:"L1T1"}]};var le=(r=>(r.WEBCAM="webcam",r.WEBCAM_BACKUP="webcam_backup",r.MIC="mic",r.SCREENSHARE_VIDEO="screenshare_video",r.SCREENSHARE_AUDIO="screenshare_audio",r))(le||{});const XO=Nb(),di=fr(XO.config.media);function ZO(r){var e,s;const t={};return r.audio&&(t.audio={enableStereo:(e=r.audio.enableStereo)!=null?e:!1,enableHighBitrate:(s=r.audio.enableHighBitrate)!=null?s:!1}),t.video=r.video.quality,t}class eN{constructor(t,e){E(this,Mn,void 0);E(this,Nd,void 0);m(this,"getScreenShareConstraints",()=>{var l,p,h,f,g,_,w,R,D,x,B;const t=(l=d(this,Mn))==null?void 0:l.screenshare,e=(h=(p=t==null?void 0:t.width)==null?void 0:p.max)!=null?h:1920,s=(g=(f=t==null?void 0:t.height)==null?void 0:f.max)!=null?g:1080,n=(w=(_=t==null?void 0:t.frameRate)==null?void 0:_.max)!=null?w:5;let i=(D=(R=t==null?void 0:t.frameRate)==null?void 0:R.ideal)!=null?D:5;const a=t==null?void 0:t.displaySurface,o=t==null?void 0:t.selfBrowserSurface;J.getValue(Z.VAL_MIN_FRAMERATE)&&(i=parseInt((x=J.getValue(Z.VAL_MIN_FRAMERATE))==null?void 0:x.toString(),10));let c={width:{max:e},height:{max:s},frameRate:{ideal:i,max:n}};if(J.hasFeature(Z.SCREENSHARE_CONSTRAINTS)){const b=(B=J.getValue(Z.SCREENSHARE_CONSTRAINTS))==null?void 0:B.toString();c=JSON.parse(b)}return a!==void 0&&["monitor","browser","window"].includes(a)&&(c={...c,displaySurface:a}),o!==void 0&&(c={...c,selfBrowserSurface:o}),{audio:!0,video:c}});m(this,"getAudioConstraints",t=>{var i,a,o,c,l,p,h,f;const e={},s=(i=d(this,Mn))==null?void 0:i.audio,n=s!=null&&s.enableStereo?2:1;return Re.isFirefox()||Re.isWebKitBased()?(e.audio={deviceId:t,autoGainControl:(a=s==null?void 0:s.autoGainControl)!=null?a:!0,echoCancellation:(o=s==null?void 0:s.echoCancellation)!=null?o:!0,noiseSuppression:(c=s==null?void 0:s.noiseSupression)!=null?c:!0,channelCount:n},e):(e.audio={},e.audio.optional=[t?{sourceId:t}:{sourceId:"default"},{channelCount:n},{echoCancellation:(l=s==null?void 0:s.echoCancellation)!=null?l:!0},{googEchoCancellation:(p=s==null?void 0:s.echoCancellation)!=null?p:!0},{googAutoGainControl:(h=s==null?void 0:s.autoGainControl)!=null?h:!0},{googNoiseSuppression:(f=s==null?void 0:s.noiseSupression)!=null?f:!0},{googHighpassFilter:!0}],e)});m(this,"getVideoConstraints",t=>{var i,a,o,c;const e={},s=(i=d(this,Mn))==null?void 0:i.video;let n=Av.vga;if(typeof s=="string"?n=Av[s]:s!==void 0&&(n.height.ideal=s.height.ideal,n.width.ideal=s.width.ideal),n.frameRate={ideal:(o=(a=n.frameRate)==null?void 0:a.ideal)!=null?o:24},Re.isChromiumBased()&&(n.frameRate.max=30),J.hasFeature(Z.VIDEO_CONSTRAINTS)){const l=(c=J.getValue(Z.VIDEO_CONSTRAINTS))==null?void 0:c.toString();n=JSON.parse(l)}return e.video=n,typeof e.video=="boolean"||(t?e.video.deviceId={exact:t}:e.video.facingMode="user"),e});y(this,Nd,t),y(this,Mn,e)}getUpdatedVideoConstraints(t){return t}}Mn=new WeakMap,Nd=new WeakMap;class Qu extends Error{constructor(e,s,n){super(s);m(this,"constraints");m(this,"name");this.name=e,this.constraints=n}}class tN{constructor(){m(this,"permissions");this.permissions={audio:"NOT_REQUESTED",video:"NOT_REQUESTED",screenshare:"NOT_REQUESTED"}}async getAudioInputDevices(t){let e=t;return t||(e=await this.getAvailableDevices()),e.filter(s=>s.kind==="audioinput")}async getVideoInputDevices(t){let e=t;return t||(e=await this.getAvailableDevices()),e.filter(s=>s.kind==="videoinput")}async getAudioOutputDevices(t){let e=t;return t||(e=await this.getAvailableDevices()),e.filter(s=>s.kind==="audiooutput")}}var rN=Object.defineProperty,sN=Object.getOwnPropertyDescriptor,vr=(r,t,e,s)=>{for(var n=s>1?void 0:s?sN(t,e):t,i=r.length-1,a;i>=0;i--)(a=r[i])&&(n=(s?a(t,e,n):a(n))||n);return s&&n&&rN(t,e,n),n};let Wt=($y=class extends tN{constructor(t,e){super();m(this,"availableDevices");E(this,Li,void 0);E(this,ir,void 0);E(this,Ld,void 0);y(this,Ld,t),y(this,ir,new eN(t,e)),y(this,Li,new AbortController),this.availableDevices=[],this.getAvailableDevices()}get constraintsBuilder(){return d(this,ir)}async destruct(){var t;(t=d(this,Li))==null||t.abort()}handlePermissionErrors(t,e){const s=Qc(t,e.name,e.message);return this.permissions[t]=s,P.emit(k.MEDIA_PERMISSION_ERROR,{message:s,constraints:e.constraints,kind:t}),s}async getAudioAndVideoTrack(t,e){const s={audio:d(this,ir).getAudioConstraints(t).audio,video:d(this,ir).getVideoConstraints(e).video};try{u.info("getUserMediaWithoutTimeout::requesting_user_media",{constraints:JSON.stringify(s)});const n=await navigator.mediaDevices.getUserMedia(s);u.info("getUserMediaWithoutTimeout::received_user_media",{constraints:JSON.stringify(s)});const i=n.getAudioTracks()[0];let a=n.getVideoTracks()[0];if(this.permissions.audio="ACCEPTED",this.permissions.video="ACCEPTED",J.hasFeature(Z.OBS_QUALITY)&&a.label.includes("OBS Virtual")){const l=(await this.getVideoInputDevices()).find(p=>p.label.includes("OBS Virtual"));a=await this.getVideoTrack(l.deviceId)}return P.emit(k.MEDIA_PERMISSION_UPDATE,{message:this.permissions.audio,kind:"audio"}),P.emit(k.MEDIA_PERMISSION_UPDATE,{message:this.permissions.video,kind:"video"}),{audioTrack:i,videoTrack:a}}catch(n){throw u.error("WebMediaInterface.getAudioAndVideoTrack",{error:n}),new I("Couldnt fetch audio and video track","1605")}}async getAudioTrack(t,e){let s=await this.getAudioInputDevices();if(s.length===0)throw this.permissions.audio="NO_DEVICES_AVAILABLE",P.emit(k.MEDIA_PERMISSION_UPDATE,{message:this.permissions.audio,kind:"audio"}),new I("No audio devices available","1606");const n=async i=>{let a;try{s=s.filter(c=>c.deviceId!==i),a=d(this,ir).getAudioConstraints(i),u.info("getUserMediaWithoutTimeout::requesting_user_media",{constraints:JSON.stringify(a)});const[o]=(await navigator.mediaDevices.getUserMedia(a)).getAudioTracks();return u.info("getUserMediaWithoutTimeout::received_user_media",{constraints:JSON.stringify(a)}),o}catch(o){const c=Qc("audio",o.name,o.message),l=new Qu(o.name,o.message,a);if(c==="COULD_NOT_START"){const p=s.shift();if(!p)throw l;u.info("getAudioTrack::gum_failed",{constraints:JSON.stringify(a),error:o});const h=d(this,ir).getAudioConstraints(p.deviceId);return u.info("getAudioTrack::retrying_gum_for_next_device",{constraints:JSON.stringify(h)}),n(p.deviceId)}throw l}};try{const i=await n(e);return i.enabled=!t,this.permissions.audio!=="ACCEPTED"&&(this.permissions.audio="ACCEPTED",P.emit(k.MEDIA_PERMISSION_UPDATE,{message:this.permissions.audio,kind:"audio"})),i}catch(i){throw i.constraints&&this.handlePermissionErrors("audio",i),new I(i.message,"1601")}}async getVideoTrack(t){var o;const e=J.hasFeature(Z.OBS_QUALITY),s=(o=await this.getCurrentDeviceLabel(t))==null?void 0:o.includes("OBS Virtual"),n=e&&s,i=await this.getVideoInputDevices();if(i.length===0)throw this.permissions.video="NO_DEVICES_AVAILABLE",P.emit(k.MEDIA_PERMISSION_UPDATE,{message:this.permissions.video,kind:"video"}),new I("No video devices available","1607");const a=async c=>{try{let l=c;const{video:p}=l;n&&typeof p!="boolean"&&(l={video:{deviceId:p.deviceId}}),u.info("getUserMediaWithoutTimeout::requesting_user_media",{constraints:JSON.stringify(l)});const[h]=(await navigator.mediaDevices.getUserMedia(l)).getVideoTracks();if(n&&typeof p!="boolean"&&typeof p.width=="object"){const{width:f,height:g}=h.getSettings(),{ideal:_}=p.width;h.applyConstraints({width:{ideal:_},height:{ideal:Math.floor(g*_/f)},frameRate:p.frameRate})}return u.info("getUserMediaWithoutTimeout::received_user_media",{constraints:JSON.stringify(l)}),h}catch(l){const p=Qc("video",l.name,l.message),h=new Qu(l.name,l.message,c);if(p==="COULD_NOT_START"){const f=i.shift();if(!f)throw h;u.info("getVideoTrack::gum_failed",{constraints:JSON.stringify(c),error:l});const g=d(this,ir).getVideoConstraints(f.deviceId);return u.info("getVideoTrack::retrying_gum_for_next_device",{constraints:JSON.stringify(g)}),a({video:g.video})}throw h}};try{const c=d(this,ir).getVideoConstraints(t),l=await a(c);return this.permissions.video!=="ACCEPTED"&&(this.permissions.video="ACCEPTED",P.emit(k.MEDIA_PERMISSION_UPDATE,{message:this.permissions.video,kind:"video"})),l}catch(c){throw c.constraints&&this.handlePermissionErrors("video",c),new I(c.message,"1602")}}async getScreenShareTracks(){const t=async e=>{try{u.info("getDisplayMediaWithoutTimeout::requesting_display_media",{constraints:JSON.stringify(e)}),q.screenShareRequested();const s=await navigator.mediaDevices.getDisplayMedia(e);return u.info("getDisplayMediaWithoutTimeout::received_display_media",{constraints:JSON.stringify(e)}),s}catch(s){const n=Qc("video",s.name,s.message),i=new Qu(s.name,s.message,e),a={video:!0};if(WR(e,a)||!J.hasFeature(Z.SCREEENSHARE_CONSTRAINTS_RETRY))throw i;if(n==="COULD_NOT_START")return t(a);throw i}};try{const e=d(this,ir).getScreenShareConstraints(),s=await t(e);return this.permissions.screenshare!=="ACCEPTED"&&(this.permissions.screenshare="ACCEPTED",P.emit(k.MEDIA_PERMISSION_UPDATE,{message:this.permissions.screenshare,kind:"screenshare"})),{audioTrack:s.getAudioTracks()[0],videoTrack:s.getVideoTracks()[0]}}catch(e){throw e.constraints&&this.handlePermissionErrors("screenshare",e),new I(e.message,"1612")}}async getCurrentDeviceLabel(t){const e=await this.getDevice(t||"default");return e==null?void 0:e.label}async getAvailableDevices(){try{const t=await navigator.mediaDevices.enumerateDevices();return this.availableDevices=t,t}catch(t){throw u.error("enumerate_devices_failed",{error:t}),new I("Failed to get available devices","1609")}}async getAvailableDevicesByKind(t){try{return(await navigator.mediaDevices.enumerateDevices()).filter(({kind:e})=>t===e)}catch(e){throw u.error("enumerate_devices_failed",{error:e}),new I("Failed to get available devices by kind","1609")}}async getDevice(t){try{return(await navigator.mediaDevices.enumerateDevices()).filter(s=>s.deviceId===t)[0]}catch(e){throw u.error("enumerate_devices_failed",{error:e}),new I("Failed to get device","1609")}}async onDeviceChange(t){Re.supportsDeviceChangeEvent()&&navigator.mediaDevices.addEventListener("devicechange",async e=>{var l,p;const s=h=>`${h.kind}-${h.deviceId}-${h.groupId}`,n=this.availableDevices,i=new Set(n.map(h=>s(h))),a=await this.getAvailableDevices(),o=new Set(a.map(h=>s(h))),c={added:a.filter(h=>!i.has(s(h))),removed:n.filter(h=>!o.has(s(h))),devices:a};if((l=c.added)!=null&&l.length||(p=c.removed)!=null&&p.length){u.info("repopulated_full_device_list",{devices:JSON.stringify(a)});const h=[...c.added,...c.removed];h.some(f=>f.kind==="audioinput")&&q.devices("AUDIO",a==null?void 0:a.filter(f=>f.kind==="audioinput")),h.some(f=>f.kind==="videoinput")&&q.devices("VIDEO",a==null?void 0:a.filter(f=>f.kind==="videoinput")),h.some(f=>f.kind==="audiooutput")&&q.devices("SPEAKER",a==null?void 0:a.filter(f=>f.kind==="audiooutput")),t(e,c,!1)}},{signal:d(this,Li).signal})}},Li=new WeakMap,ir=new WeakMap,Ld=new WeakMap,$y);vr([v.trace("WebMediaInterface.destruct")],Wt.prototype,"destruct",1),vr([v.trace("WebMediaInterface.handlePermissionErrors")],Wt.prototype,"handlePermissionErrors",1),vr([v.trace("WebMediaInterface.getAudioAndVideoTrack")],Wt.prototype,"getAudioAndVideoTrack",1),vr([v.trace("WebMediaInterface.getAudioTrack")],Wt.prototype,"getAudioTrack",1),vr([v.trace("WebMediaInterface.getVideoTrack")],Wt.prototype,"getVideoTrack",1),vr([v.trace("WebMediaInterface.getScreenShareTracks")],Wt.prototype,"getScreenShareTracks",1),vr([v.trace("WebMediaInterface.getAvailableDevices")],Wt.prototype,"getAvailableDevices",1),vr([v.trace("WebMediaInterface.getAvailableDevicesByKind")],Wt.prototype,"getAvailableDevicesByKind",1),vr([v.trace("WebMediaInterface.getDevice")],Wt.prototype,"getDevice",1),vr([v.trace("WebMediaInterface.onDeviceChange")],Wt.prototype,"onDeviceChange",1),Wt=vr([mt("1600")],Wt);const Dv=Wt,_a={setItem:(r,t)=>{try{localStorage.setItem(r,t)}catch(e){u.error("LocalStorage::setItem::crashed",{error:e,localStorage:{key:r,value:t}})}},getItem:r=>{try{return localStorage.getItem(r)}catch(t){u.error("LocalStorage::getItem::crashed",{error:t,localStorage:{key:r}})}return null}},nN=(r=0)=>new Promise(t=>setTimeout(t,r)),iN=(r,t,e)=>{const s=typeof e=="number"?e:250,n=r.createMediaStreamSource(t),i=r.createAnalyser();i.fftSize=2048,n.connect(i);const a=new Uint8Array(i.fftSize);let o=!1;setTimeout(()=>{o=!0},s);function c(){return o?Promise.resolve(!0):(i.getByteTimeDomainData(a),a.some(l=>l!==128&&l!==0)?Promise.resolve(!1):nN().then(c))}return c().then(l=>(n.disconnect(),l),l=>{throw n.disconnect(),l})},aN=typeof AudioContext!="undefined"?AudioContext:null;class Xu{constructor(t){m(this,"_AudioContext");m(this,"audioContext");m(this,"_audioContextRefContainers");const e={AudioContext:aN,...t};Object.defineProperties(this,{_AudioContext:{value:e.AudioContext},audioContext:{value:null,writable:!0},_audioContextRefContainers:{value:new Set},AudioContextProvider:{enumerable:!0,value:Xu}})}getOrCreate(t){if(!this._audioContextRefContainers.has(t)&&(this._audioContextRefContainers.add(t),this._AudioContext&&!this.audioContext))try{this.audioContext=new this._AudioContext}catch(e){}return this.audioContext}release(t){this._audioContextRefContainers.has(t)&&(this._audioContextRefContainers.delete(t),!this._audioContextRefContainers.size&&this.audioContext&&(this.audioContext.close(),this.audioContext=null))}}const Ov=new Xu,oN=3,cN=250;function dN(r){const t={},e=Ov.getOrCreate(t);let s=oN;function n(){return s-=1,iN(e,r.srcObject,cN).then(i=>i?s>0?n():!0:!1).catch(()=>!0)}return n().finally(()=>{Ov.release(t)})}async function Nv(r){const t=new Audio,e=new MediaStream;e.addTrack(r),t.srcObject=e;let s=!1;try{const n=t.play();n&&await n,s=await dN(t),s&&u.info("checkIfAudioTrackIsSilent::silence_detected")}catch(n){u.error("checkIfAudioTrackIsSilent::failed_to_detect_silence",{error:n})}finally{t.pause(),t.remove()}return s}var lN=Object.defineProperty,uN=Object.getOwnPropertyDescriptor,Lv=(r,t,e,s)=>{for(var n=s>1?void 0:s?uN(t,e):t,i=r.length-1,a;i>=0;i--)(a=r[i])&&(n=(s?a(t,e,n):a(n))||n);return s&&n&&lN(t,e,n),n};let ed=class extends si{constructor(t,e,s){var n;super();m(this,"constructorName",this.constructor.name);m(this,"userSelectedDevice");m(this,"mediaInterface");m(this,"isNonPreferredDevice");m(this,"_mediaTrack");m(this,"transformedMediaTrack");m(this,"middlewares",[]);m(this,"currentDevice");m(this,"userPreferredDeviceKey",`Dyte::${this.constructorName}::UserDeviceID`);m(this,"setUserPreferredDevice",t=>_a.setItem(this.userPreferredDeviceKey,t));m(this,"getUserPreferredDevice",()=>_a.getItem(this.userPreferredDeviceKey));this.mediaInterface=t,e&&this.setMediaTrack(e),this.userSelectedDevice=(n=this.getUserPreferredDevice())!=null?n:void 0,this.isNonPreferredDevice=s,this.onTrackEnded=this.onTrackEnded.bind(this),this.onTrackMuted=this.onTrackMuted.bind(this)}disableTrack(){var t,e;this.removeMediaTrackListeners(),(t=this._mediaTrack)==null||t.stop(),this._mediaTrack=void 0,(e=this.transformedMediaTrack)==null||e.stop(),this.transformedMediaTrack=void 0}get mediaTrack(){return this._mediaTrack}async setMediaTrack(t){const e=s=>{u.error(`${this.constructorName}.setMediaTrack.error`,{error:s})};try{this.disableTrack()}catch(s){e(s)}this._mediaTrack=await this.conditionallyChangeTrack(t),await this.setTransformedTrack();try{this.addMediaTrackListeners(),await this.setCurrentDevice()}catch(s){e(s)}}get trackEnabled(){return!!this.mediaTrack&&this.mediaTrack.readyState==="live"&&this.mediaTrack.enabled}muteTrack(){if(!this.mediaTrack){u.warn("BaseMediaHandler.muteTrack Tried muting with no track present");return}this.transformedMediaTrack&&(this.transformedMediaTrack.enabled=!1),this.mediaTrack.enabled=!1}async unmuteTrack(){try{this.mediaTrack?this.mediaTrack.enabled=!0:await this.enableTrack(!1)}catch(t){throw u.error(`${this.constructorName}.unmuteTrack.error`,{error:t}),this.disableTrack(),new I("Failed to unmute track","1611")}}getCurrentDeviceId(){var e,s;const{kind:t}=this.mediaTrack;switch(t){case"audio":{const n=this.mediaTrack.getConstraints();return this.userSelectedDevice?(s=(e=n==null?void 0:n.deviceId)!=null?e:n==null?void 0:n.advanced[0].deviceId)!=null?s:this.mediaTrack.getSettings().deviceId:this.mediaTrack.getSettings().deviceId}default:return this.mediaTrack.getSettings().deviceId}}async setCurrentDevice(){var e;if(!this.mediaTrack){this.currentDevice=void 0;return}const t=this.getCurrentDeviceId();((e=this.currentDevice)==null?void 0:e.deviceId)!==t&&(this.currentDevice=await this.mediaInterface.getDevice(t))}async addMiddleware(t){if(Re.isWebKitBased()&&!J.hasFeature(Z.ALLOW_SAFARI_MEDIA_MIDDLEWARES))return{success:!1,message:"Middlewares are not supported in this WebKit engine based browser."};if(this.middlewares.includes(t))return{success:!1,message:"This middleware has been applied, already. Skipping."};try{return this.middlewares.push(t),this.trackEnabled&&await this.setTransformedTrack(),{success:!0,message:"Successfully added the middleware."}}catch(e){return u.error("While adding middleware",{error:e}),this.removeMiddleware(t),{success:!1,message:e==null?void 0:e.message}}}async removeMiddleware(t){const e=this.middlewares.indexOf(t,0);if(e>-1)try{return this.middlewares.splice(e,1),await this.setTransformedTrack(!0),{success:!0,message:"Successfully removed the middleware."}}catch(s){return u.error("While removing middleware",{error:s}),{success:!1,message:s==null?void 0:s.message}}return{success:!1,message:"No such middleware was found. Skipping."}}async removeAllMiddlewares(){var t;if((t=this.middlewares)!=null&&t.length)try{return this.middlewares=[],await this.setTransformedTrack(!0),{success:!0,message:"Successfully removed all the middlewares."}}catch(e){return u.error("While removing all the middlewares",{error:e}),{success:!1,message:e==null?void 0:e.message}}return{success:!1,message:"No middlewares were found. Skipping."}}addMediaTrackListeners(){var t,e,s;this.mediaTrack&&(u.info(`${this.constructorName}.addMediaTrackListeners for deviceId ${(e=(t=this.mediaTrack)==null?void 0:t.getSettings())==null?void 0:e.deviceId} of type ${(s=this.mediaTrack)==null?void 0:s.kind}`),this.mediaTrack.addEventListener("ended",this.onTrackEnded),this.mediaTrack.addEventListener("mute",this.onTrackMuted))}removeMediaTrackListeners(){var t,e,s;this.mediaTrack&&(u.info(`${this.constructorName}.removeMediaTrackListeners for deviceId ${(e=(t=this.mediaTrack)==null?void 0:t.getSettings())==null?void 0:e.deviceId} of type ${(s=this.mediaTrack)==null?void 0:s.kind}`),u.info(`${this.constructorName}.removeMediaTrackListeners`),this.mediaTrack.removeEventListener("ended",this.onTrackEnded),this.mediaTrack.removeEventListener("mute",this.onTrackMuted))}};Lv([v.trace("BaseMediaHandler.unmuteTrack")],ed.prototype,"unmuteTrack",1),ed=Lv([mt("1600")],ed);const xv=ed;var hN=Object.defineProperty,pN=Object.getOwnPropertyDescriptor,Zu=(r,t,e,s)=>{for(var n=s>1?void 0:s?pN(t,e):t,i=r.length-1,a;i>=0;i--)(a=r[i])&&(n=(s?a(t,e,n):a(n))||n);return s&&n&&hN(t,e,n),n};const eh="[Dyte]nonSilentDeviceLabels";class td extends xv{async setDevice(t){if(!t)throw u.warn("AudioMediaHandler.setDevice No device received"),new I("No device received!","1603");if(t.kind!=="audioinput")throw u.warn("AudioMediaHandler.setDevice Received non audio device"),new I("Non audio device received while setting device!","1603");try{const e=this.trackEnabled;await this.setMediaTrack(await this.mediaInterface.getAudioTrack(!e,this.userSelectedDevice)),this.userSelectedDevice=void 0}catch(e){throw u.error("AudioMediaHandler.setDevice.error",{error:e}),this.disableTrack(),new I(e.message,"1604")}}async enableTrack(t){if(this.trackEnabled){u.warn("AudioMediaHandler.enableTrack Track already enabled!");return}const e=await this.mediaInterface.getAudioTrack(t,this.userSelectedDevice);await this.setMediaTrack(e)}async setTransformedTrack(t){var e;if(!t&&!((e=this.middlewares)!=null&&e.length)){this.transformedMediaTrack=this.mediaTrack;return}try{this.transformedMediaTrack=await qO(this.middlewares,this.mediaTrack),this.emit("trackChanged")}catch(s){u.error("AudioMediaHandler.setTransformedTrack",{error:s}),this.transformedMediaTrack=this.mediaTrack}}async onTrackEnded(){u.info("AudioMediaHandler.TrackEnded"),this.emit("trackEnded");const t=this.mediaTrack.enabled;this.disableTrack(),await this.enableTrack(!t),await this.setTransformedTrack(),this.emit("trackChanged")}onTrackMuted(){u.info("AudioMediaHandler.TrackMuted"),this.emit("trackMuted")}async conditionallyChangeTrack(t){var o;if(!t||this.userSelectedDevice)return t;let e=t;const s=await this.mediaInterface.getAudioInputDevices(),n=this.isNonPreferredDevice?s.filter(c=>c&&!this.isNonPreferredDevice(c)):s;if(!(n!=null&&n.length))return e;n.find(c=>c.deviceId===t.getSettings().deviceId)||(e.stop(),u.info("localmediahandler::setupstreams::found_audio_non_preferred"),e=await this.mediaInterface.getAudioTrack(!1,n[0].deviceId));const i=JSON.parse(_a.getItem(eh));if(i!=null&&i.devices.some(c=>c.label===e.label))return e;if(!await Nv(e)){const c=(o=i==null?void 0:i.devices.concat({label:e.label}))!=null?o:[{label:e.label}];return _a.setItem(eh,JSON.stringify({devices:c})),e}u.info("AudioMediaHandler.conditionallyChangeTrack.DetectedSilentTrack");const a=e.getSettings().deviceId;return n.filter(c=>c.deviceId!==a).some(async c=>{if(e=await this.mediaInterface.getAudioTrack(!1,c.deviceId),!await Nv(e)){const l=i.devices.concat({label:e.label});return _a.setItem(eh,JSON.stringify({devices:l})),u.info("AudioMediaHandler.conditionallyChangeTrack.SuccesfullyChangedTrack"),!0}return u.info("AudioMediaHandler.conditionallyChangeTrack.AnotherSilentTrackFound"),!1}),e}}Zu([v.trace("AudioMediaHandler.setTransformedTrack")],td.prototype,"setTransformedTrack",1),Zu([v.trace("AudioMediaHandler.onTrackEnded")],td.prototype,"onTrackEnded",1),Zu([v.trace("AudioMediaHandler.conditionallyChangeTrack")],td.prototype,"conditionallyChangeTrack",1);const mN=td;class fN{constructor(t){E(this,xi,void 0);m(this,"currentDevice");y(this,xi,t)}async setupSpeaker(t){var n,i;if(!(d(this,xi)instanceof Dv))return;let e=t;if(t||([e]=(await d(this,xi).getAvailableDevicesByKind("audiooutput")).filter(o=>!Yu(o))),!e)throw new I("No speaker found","1608");if(((n=this.currentDevice)==null?void 0:n.deviceId)===e.deviceId)return;this.currentDevice=e;const s=document.querySelectorAll("audio");(i=s[0])!=null&&i.setSinkId&&s.forEach(async a=>{if(typeof a.sinkId!="undefined"&&this.currentDevice.deviceId&&a.sinkId!==this.currentDevice.deviceId)try{await a.setSinkId(this.currentDevice.deviceId)}catch(o){}})}}xi=new WeakMap;const gN=fN;class vN extends si{constructor(e){super();m(this,"mediaInterface");m(this,"audioMediaTrack");m(this,"videoMediaTrack");this.mediaInterface=e}get trackEnabled(){return!!this.videoMediaTrack}async enableScreenShare(){var e,s;try{const{audioTrack:n,videoTrack:i}=await this.mediaInterface.getScreenShareTracks();if(this.audioMediaTrack=n,this.videoMediaTrack=i,this.addMediaTrackListeners(),((s=(e=this.mediaInterface)==null?void 0:e.permissions)==null?void 0:s.screenshare)==="ACCEPTED")return;this.mediaInterface.permissions&&(this.mediaInterface.permissions.screenshare="ACCEPTED",P.emit(k.MEDIA_PERMISSION_UPDATE,{message:this.mediaInterface.permissions.screenshare,kind:"screenshare"}))}catch(n){}}disableScreenShare(){var e,s;this.removeMediaTrackListeners(),(e=this.audioMediaTrack)==null||e.stop(),(s=this.videoMediaTrack)==null||s.stop(),this.videoMediaTrack=void 0,this.audioMediaTrack=void 0}async updateConstraints(e){if(!this.videoMediaTrack)throw new I("No media track enabled!","1610");const s=this.mediaInterface;if(!s.constraintsBuilder)throw new I("update constraints not supported for non web clients","1100");try{this.videoMediaTrack.applyConstraints(s.constraintsBuilder.getUpdatedVideoConstraints(e)),this.addMediaTrackListeners()}catch(n){u.error("ScreenShareHandler.updateConstraints.error",{error:n})}}addMediaTrackListeners(){var e,s;(e=this.videoMediaTrack)==null||e.addEventListener("ended",this.onTrackEnded.bind(this)),Re.isWebKitBased()&&((s=this.videoMediaTrack)==null||s.addEventListener("mute",this.onTrackEnded.bind(this)))}removeMediaTrackListeners(){var e,s;(e=this.videoMediaTrack)==null||e.removeEventListener("ended",this.onTrackEnded),(s=this.videoMediaTrack)==null||s.removeEventListener("mute",this.onTrackEnded)}onTrackEnded(){this.emit("trackEnded")}}const yN=vN;var TN=Object.defineProperty,SN=Object.getOwnPropertyDescriptor,rd=(r,t,e,s)=>{for(var n=s>1?void 0:s?SN(t,e):t,i=r.length-1,a;i>=0;i--)(a=r[i])&&(n=(s?a(t,e,n):a(n))||n);return s&&n&&TN(t,e,n),n};class wa extends xv{constructor(e,s,n){super(e,s,n);E(this,Fi,void 0);E(this,Wa,{disablePerFrameCanvasRendering:!1});y(this,Fi,new QO)}async setDevice(e){if(!e)throw u.warn("VideoMediaHandler.setDevice No device received"),new I("No device received!","1603");if(e.kind!=="videoinput")throw u.warn("VideoMediaHandler.setDevice Received non video device",{devices:[e]}),new I("Non video device received while setting video device!","1603");if(!(this.mediaTrack&&this.mediaTrack.enabled)){u.warn("VideoMediaHandler.setDevice Tried switching device with video disabled",{devices:[e]}),this.currentDevice=e;return}try{await this.setMediaTrack(await this.mediaInterface.getVideoTrack(this.userSelectedDevice))}catch(s){throw u.error("VideoMediaHandler.setDevice.error",{error:s}),this.disableTrack(),new I("Failed to change device","1600")}}async enableTrack(){if(this.trackEnabled){u.warn("VideoMediaHandler.enableTrack Track already enabled!");return}await this.setMediaTrack(await this.mediaInterface.getVideoTrack(this.userSelectedDevice))}async setTransformedTrack(e){var s;if(!e&&!((s=this.middlewares)!=null&&s.length)){this.transformedMediaTrack=this.mediaTrack;return}try{this.transformedMediaTrack=await d(this,Fi).getTransformedVideoTrack(this.middlewares,this.mediaTrack,d(this,Wa)),this.emit("trackChanged")}catch(n){u.error("VideoMediaHandler.setTransformedTrack",{error:n}),this.transformedMediaTrack=this.mediaTrack}}async setVideoMiddlewareGlobalConfig(e){y(this,Wa,e)}async updateConstraints(e){if(!this._mediaTrack)throw new I("No media track enabled!","1610");const s=this.mediaInterface;if(!s.constraintsBuilder)throw new I("update constraints not supported for non web clients","1100");try{this._mediaTrack.applyConstraints(s.constraintsBuilder.getUpdatedVideoConstraints(e)),await this.setTransformedTrack(),this.addMediaTrackListeners(),await this.setCurrentDevice()}catch(n){u.error("VideoMediaHandler.updateConstraints.error",{error:n})}}terminateMiddlewareWebWorker(){d(this,Fi).terminateMiddlewareWebWorker()}async onTrackEnded(){u.info("VideoMediaHandler.TrackEnded"),this.disableTrack(),this.emit("trackEnded")}onTrackMuted(){u.info("VideoMediaHandler.TrackMuted"),this.emit("trackMuted")}async conditionallyChangeTrack(e){if(!e||this.userSelectedDevice)return e;let s=e;const n=await this.mediaInterface.getVideoInputDevices(),i=this.isNonPreferredDevice?n.filter(a=>!this.isNonPreferredDevice(a)):n;return!(i!=null&&i.length)||window.FAST_DYTE||i.find(a=>a.deviceId===e.getSettings().deviceId)||(s.stop(),u.info("localmediahandler::setupstreams::found_video_non_preferred"),s=await this.mediaInterface.getVideoTrack(i[0].deviceId)),s}}Fi=new WeakMap,Wa=new WeakMap,rd([v.trace("VideoMediaHandler.setTransformedTrack")],wa.prototype,"setTransformedTrack",1),rd([v.trace("VideoMediaHandler.setVideoMiddlewareGlobalConfig")],wa.prototype,"setVideoMiddlewareGlobalConfig",1),rd([v.trace("VideoMediaHandler.onTrackEnded")],wa.prototype,"onTrackEnded",1),rd([v.trace("VideoMediaHandler.conditionallyChangeTrack")],wa.prototype,"conditionallyChangeTrack",1);const EN=wa,Fv=fr(Fl()),Ui=class{constructor(t){E(this,Ft,void 0);E(this,Dn,void 0);E(this,Ja,void 0);E(this,$i,void 0);if(!t)throw new I("Could not load preset.","0904");y(this,Ft,t.config),y(this,Ja,t.name),y(this,Dn,t.ui||fr(Fl().ui)),y(this,$i,t.permissions.plugins.config)}static fromResponse(t){return new Ui(t)}static default(){return new Ui(Fv)}static init(t,e=!0){return!t||e?new Ui(Fv):new Ui(t)}get setupScreen(){return{isEnabled:!0}}get waitingRoom(){return{isEnabled:!0}}get controlBar(){return{isEnabled:!0,elements:{chat:!0,fullscreen:!0,invite:!1,layout:!1,participants:!0,plugins:!0,polls:!0,reactions:!1,screenshare:!0}}}get header(){return{isEnabled:!0,elements:{logo:d(this,Dn).designTokens.logo,timer:!0,title:!0,participantCount:!0,changeLayout:!1}}}get pipMode(){return!0}get viewType(){return d(this,Ft).viewType}get livestreamViewerQualities(){return d(this,Ft).livestreamViewerQualities||[]}get maxVideoStreams(){return d(this,Ft).maxVideoStreams}get maxScreenShareCount(){return d(this,Ft).maxScreenshareCount}get plugins(){return[]}get disabledPlugins(){return Object.keys(d(this,$i)).filter(t=>d(this,$i)[t].disabled)}get designTokens(){return d(this,Dn).designTokens}get configDiff(){return d(this,Dn).configDiff}get mediaConstraints(){var t,e,s,n,i,a,o,c,l,p,h,f,g,_,w,R,D,x,B,b,Q,te,ce,he;return{audio:{enableStereo:(n=(s=(e=(t=d(this,Ft))==null?void 0:t.media)==null?void 0:e.audio)==null?void 0:s.enableStereo)!=null?n:di.audio.enableStereo,enableHighBitrate:(c=(o=(a=(i=d(this,Ft))==null?void 0:i.media)==null?void 0:a.audio)==null?void 0:o.enableHighBitrate)!=null?c:di.audio.enableHighBitrate},video:{quality:(f=(h=(p=(l=d(this,Ft))==null?void 0:l.media)==null?void 0:p.video)==null?void 0:h.quality)!=null?f:di.video.quality,frameRate:(R=(w=(_=(g=d(this,Ft))==null?void 0:g.media)==null?void 0:_.video)==null?void 0:w.frameRate)!=null?R:di.video.frameRate},screenshare:{quality:(b=(B=(x=(D=d(this,Ft))==null?void 0:D.media)==null?void 0:x.screenshare)==null?void 0:B.quality)!=null?b:di.screenshare.quality,frameRate:(he=(ce=(te=(Q=d(this,Ft))==null?void 0:Q.media)==null?void 0:te.screenshare)==null?void 0:ce.frameRate)!=null?he:di.screenshare.frameRate}}}get name(){return d(this,Ja)}};let th=Ui;Ft=new WeakMap,Dn=new WeakMap,Ja=new WeakMap,$i=new WeakMap;var _N=Object.defineProperty,wN=Object.getOwnPropertyDescriptor,$v=(r,t,e,s)=>{for(var n=s>1?void 0:s?wN(t,e):t,i=r.length-1,a;i>=0;i--)(a=r[i])&&(n=(s?a(t,e,n):a(n))||n);return s&&n&&_N(t,e,n),n};class rh extends qt{constructor(e){super();E(this,Vi,void 0);m(this,"state","IDLE");m(this,"playbackUrl");m(this,"ingestionCredentials");m(this,"viewerCount");y(this,Vi,e),this.viewerCount=0}setLivestreamState(e){const s=this.state;this.state=e,s!==e&&this.emitCurrentLivestreamState()}emitCurrentLivestreamState(){this.emit("livestreamUpdate",this.state)}async start(e={manualIngestion:!1}){if(!d(this,Vi).permissions.canLivestream)throw u.error("DyteLivestream::start::permission_denied"),new I("User does not have permission to start livestreaming","1901");this.setLivestreamState("STARTING");try{const s=tt(),{playbackUrl:n,ingestionCredentials:i}=await s.startLivestreaming(e);this.playbackUrl=n,this.ingestionCredentials=i,e!=null&&e.manualIngestion&&this.setLivestreamState("WAITING_ON_MANUAL_INGESTION")}catch(s){throw u.error("DyteRecording::stop::livestream_failed_to_start",{error:s}),this.setLivestreamState("IDLE"),new I("Error while starting livestream","1900")}}async stop(){if(!d(this,Vi).permissions.canLivestream)throw u.error("DyteLivestream::stop::permission_denied"),new I("User does not have permission to stop livestreaming","1901");if(this.state!=="LIVESTREAMING"&&this.state!=="WAITING_ON_MANUAL_INGESTION")throw u.error("DyteLivestream::stop::inconsistent_state"),new I("Livestream not started yet","1902");try{this.setLivestreamState("STOPPING"),await tt().stopLivestreaming()}catch(e){throw u.error("DyteLivestream::stop::livestream_failed_to_stop",{error:e}),this.setLivestreamState("STOPPING"),new I("Error while stopping livestream","1900")}}}Vi=new WeakMap,$v([v.trace("livestream.start")],rh.prototype,"start",1),$v([v.trace("livestream.stop")],rh.prototype,"stop",1);var bN=Object.defineProperty,CN=Object.getOwnPropertyDescriptor,RN=(r,t,e,s)=>{for(var n=s>1?void 0:s?CN(t,e):t,i=r.length-1,a;i>=0;i--)(a=r[i])&&(n=(s?a(t,e,n):a(n))||n);return s&&n&&bN(t,e,n),n};class Uv{constructor(t,e){m(this,"livestream");E(this,Bi,void 0);E(this,Hi,void 0);E(this,ns,void 0);y(this,Hi,t),this.livestream=new rh(t),y(this,ns,e),this.setupEvents()}async fetchInitialLivestreamingState(){const t=tt(),{status:e,playbackUrl:s,manualIngest:n,ingestionCredentials:i}=await t.getActiveLivestream();this.livestream.playbackUrl=s,this.livestream.ingestionCredentials=i,e==="LIVE"&&this.livestream.setLivestreamState("LIVESTREAMING"),e==="INVOKED"&&n&&this.livestream.setLivestreamState("WAITING_ON_MANUAL_INGESTION")}setupEvents(){d(this,ns).on(U.startedLivestream,async t=>{this.livestream.playbackUrl=t.playbackUrl,this.livestream.setLivestreamState("LIVESTREAMING");try{d(this,Hi).permissions.canLivestream&&await this.fetchInitialLivestreamingState()}catch(e){u.error("Error: LivestreamController.fetchLivestream during startedLivestream re-fetch")}}),d(this,ns).on(U.livestreamingInvoked,async t=>{if(t.manualIngest){this.livestream.setLivestreamState("WAITING_ON_MANUAL_INGESTION");try{d(this,Hi).permissions.canLivestream&&await this.fetchInitialLivestreamingState()}catch(e){u.error("Error: LivestreamController.fetchLivestream during livestreamingInvoked re-fetch")}}}),d(this,ns).on(U.stoppedLivestream,()=>{this.livestream.setLivestreamState("IDLE"),this.livestream.playbackUrl=void 0,this.livestream.ingestionCredentials=void 0}),d(this,ns).on(U.erroredLivestream,()=>{this.livestream.setLivestreamState("IDLE"),this.livestream.playbackUrl=void 0}),d(this,ns).on(U.roomPeerCount,t=>{this.livestream.viewerCount=t.count,this.livestream.emit("viewerCountUpdate",t.count)}),P.on(k.PEER_JOINED_INTERNAL,async t=>{var e;((e=t.flags)==null?void 0:e.hiddenParticipant)===!0&&t.recorderType==="LIVESTREAMER"&&(y(this,Bi,t.id),this.livestream.setLivestreamState("LIVESTREAMING"))}),P.on(k.PEER_CLOSED,t=>{t.id===d(this,Bi)&&(y(this,Bi,void 0),this.livestream.setLivestreamState("IDLE"))}),P.onAsync(k.LEAVE_MEDIA_ROOM,async()=>{this.livestream.playbackUrl||(u.info("Fetching livestreaming state on leave stage"),await this.fetchInitialLivestreamingState())}),P.on(k.SOCKET_SERVICE_ROOM_JOINED,async()=>{try{await this.fetchInitialLivestreamingState()}catch(t){u.error("Error: LivestreamController.fetchLivestream")}})}}Bi=new WeakMap,Hi=new WeakMap,ns=new WeakMap,RN([v.trace("LivestreamController.setupEvents")],Uv.prototype,"setupEvents",1);var PN=Object.defineProperty,kN=Object.getOwnPropertyDescriptor,ba=(r,t,e,s)=>{for(var n=s>1?void 0:s?kN(t,e):t,i=r.length-1,a;i>=0;i--)(a=r[i])&&(n=(s?a(t,e,n):a(n))||n);return s&&n&&PN(t,e,n),n};class li{constructor({name:t,socketHandler:e,meetingId:s}){E(this,xd);m(this,"name","");E(this,Et,{});E(this,xs,"");E(this,Fs,void 0);m(this,"rateLimitConfig",{maxInvocations:5,period:1});m(this,"bulkRateLimitConfig",{maxInvocations:5,period:1});m(this,"listeners",{});this.name=t,y(this,Fs,e),y(this,xs,s)}async set(t,e,s=!0,n=!1){d(this,Et)[t]=e,s&&this.remoteSet(t,e),n&&(this.listeners[t]&&this.listeners[t].forEach(i=>i({[t]:d(this,Et)[t]})),this.listeners["*"]&&this.listeners["*"].forEach(i=>i({[t]:d(this,Et)[t]})))}remoteSet(t,e){d(this,Fs).storeInsertKeys(d(this,xs),this.name,[{key:t,payload:e}])}async bulkSet(t){t.forEach(({key:e,payload:s})=>{d(this,Et)[e]=s}),d(this,Fs).storeInsertKeys(d(this,xs),this.name,t)}async update(t,e,s=!0){qe(this,xd,zy).call(this,t,e,s)}async delete(t,e=!0,s=!1){if(d(this,Et)[t]&&delete d(this,Et)[t],e)return d(this,Fs).storeDeleteKeys(d(this,xs),this.name,[{key:t}]);s&&(this.listeners[t]&&(this.listeners[t].forEach(n=>n({[t]:void 0})),delete this.listeners[t]),this.listeners["*"]&&this.listeners["*"].forEach(n=>n({[t]:void 0})))}async bulkDelete(t){return t.forEach(({key:e})=>{d(this,Et)[e]&&delete d(this,Et)[e]}),d(this,Fs).storeDeleteKeys(d(this,xs),this.name,t)}get(t){if(d(this,Et)[t])return d(this,Et)[t]}getAll(){return d(this,Et)}get rateLimits(){return this.rateLimitConfig}updateRateLimits(t,e){this.rateLimitConfig.maxInvocations=t,this.rateLimitConfig.period=e}get bulkRateLimits(){return this.bulkRateLimitConfig}updateBulkRateLimits(t,e){this.bulkRateLimitConfig.maxInvocations=t,this.bulkRateLimitConfig.period=e}subscribe(t,e){if(this.listeners[t]){this.listeners[t].push(e);return}this.listeners[t]=[e]}unsubscribe(t,e){var s;if(e){this.listeners[t]=((s=this.listeners[t])==null?void 0:s.filter(n=>n!==e))||[];return}this.listeners[t]&&delete this.listeners[t]}populate(t){y(this,Et,t)}}Et=new WeakMap,xs=new WeakMap,Fs=new WeakMap,xd=new WeakSet,zy=function(t,e,s=!0){let n;const i=d(this,Et)[t],a=Object.prototype.toString.call(e),o=Object.prototype.toString.call(i);if(a!==o){this.set(t,e);return}switch(o){case"[object Array]":n=[...i,...e];break;case"[object Object]":n={...i,...e};break;case"[object Map]":n=new Map([...i,...e]);break;case"[object Set]":n=new Set([...i,...e]);break;default:n=e;break}this.set(t,n,s)},ba([Lt(ai,"rateLimitConfig")],li.prototype,"remoteSet",1),ba([Lt(ai,"bulkRateLimitConfig")],li.prototype,"bulkSet",1),ba([Lt(ai,"rateLimitConfig")],li.prototype,"update",1),ba([Lt(ai,"rateLimitConfig")],li.prototype,"delete",1),ba([Lt(ai,"bulkRateLimitConfig")],li.prototype,"bulkDelete",1);class IN{constructor(t,e){E(this,Ka);E(this,Fd);m(this,"stores",new Map);E(this,On,void 0);E(this,Nn,"");E(this,za,void 0);E(this,$s,new Map);y(this,On,e),y(this,Nn,t.getValue("meetingId")),y(this,za,t),qe(this,Fd,Yy).call(this)}create(t){const e=new li({name:t,socketHandler:d(this,On),meetingId:d(this,Nn)});return d(this,On).storeGetKeys(d(this,Nn),t,[]),new Promise((n,i)=>{const a=setTimeout(()=>i(Error("Failed")),3e3);d(this,$s).set(t,{rejectTimeout:a,resolve:n,store:e})})}}On=new WeakMap,Nn=new WeakMap,Ka=new WeakSet,Ih=function(){return d(this,za).getValue("peerId")},za=new WeakMap,$s=new WeakMap,Fd=new WeakSet,Yy=function(){[G.storeInsertKeys,G.storeGetKeys,G.storeDeleteKeys].forEach(t=>{d(this,On).on(t,async e=>{var i,a;if(e.pluginId!==d(this,Nn))return;const s=(i=e.storeItems)==null?void 0:i.map(o=>{var c;return{timestamp:o.timestamp,peerId:o.peerId,payload:JSON.parse((c=o.payload)!=null&&c.length?new TextDecoder().decode(o.payload):"{}"),key:o.storeKey}});if(t===G.storeGetKeys){const o=d(this,$s).get(e.storeName),c=this.stores.get(e.storeName)||(o==null?void 0:o.store);d(this,$s).get(e.storeName)&&(this.stores.set(e.storeName,o.store),o.resolve(c),clearTimeout(o.rejectTimeout),d(this,$s).delete(e.storeName)),s.forEach(l=>{c.set(l.key,l.payload,!1,!1)});return}const n=this.stores.get(e.storeName)||((a=d(this,$s).get(e.storeName))==null?void 0:a.store);n!==void 0&&(t===G.storeInsertKeys&&s.forEach(({key:o,peerId:c,payload:l})=>{c!==d(this,Ka,Ih)&&n.set(o,l,!1,!0)}),t===G.storeDeleteKeys&&s.forEach(({key:o,peerId:c})=>{c!==d(this,Ka,Ih)&&n.delete(o,!1,!0)}))})})};function un(r){var t,e,s,n,i,a,o,c,l,p,h,f,g;return r?{media:{audio:{enabled:r.audioEnabled,trackId:(t=r.audioTrack)==null?void 0:t.id,permission:"mediaPermissions"in r?(e=r.mediaPermissions)==null?void 0:e.audio:null},video:{enabled:r.videoEnabled,trackId:(s=r.videoTrack)==null?void 0:s.id,permission:"mediaPermissions"in r?(n=r.mediaPermissions)==null?void 0:n.video:null},screenshare:{enabled:r.screenShareEnabled,permission:"mediaPermissions"in r?(i=r.mediaPermissions)==null?void 0:i.screenshare:null,audio:{enabled:(o=(a=r.screenShareTracks)==null?void 0:a.audio)==null?void 0:o.enabled,trackId:(l=(c=r.screenShareTracks)==null?void 0:c.audio)==null?void 0:l.id},video:{enabled:(h=(p=r.screenShareTracks)==null?void 0:p.video)==null?void 0:h.enabled,trackId:(g=(f=r.screenShareTracks)==null?void 0:f.video)==null?void 0:g.id}}}}:{}}var AN=Object.defineProperty,MN=Object.getOwnPropertyDescriptor,ui=(r,t,e,s)=>{for(var n=s>1?void 0:s?MN(t,e):t,i=r.length-1,a;i>=0;i--)(a=r[i])&&(n=(s?a(t,e,n):a(n))||n);return s&&n&&AN(t,e,n),n};const DN=.8,ON=1.2;let Jr=(Uy=class extends qt{constructor(t,e,s,n){super();E(this,Ln);E(this,Gi);E(this,Qa);m(this,"id");m(this,"userId");m(this,"name");m(this,"picture");m(this,"isHost");m(this,"customParticipantId");m(this,"flags");m(this,"device");m(this,"videoTrack");m(this,"audioTrack");m(this,"screenShareTracks");m(this,"videoEnabled");m(this,"audioEnabled");m(this,"screenShareEnabled");m(this,"producers");m(this,"manualProducerConfig");E(this,qi,void 0);m(this,"supportsRemoteControl",!1);E(this,ji,void 0);m(this,"presetName");E(this,Us,void 0);E(this,is,void 0);E(this,Ya,void 0);E(this,Vs,new Map);E(this,as,1);E(this,$d,ti(t=>{if(!this.videoTrack)return;const{clientWidth:e,clientHeight:s}=t,{width:n,height:i}=this.videoTrack.getSettings();if(!n||!i)return;const a=i/s,o=n/e,c=Math.max(a,o);c>ON&&d(this,as)===1?(y(this,as,0),P.emit(k.MAX_SPATIAL_LAYER_CHANGE,{peerId:this.id,maxSpatialLayer:d(this,as)})):c<DN&&d(this,as)===0&&(y(this,as,1),P.emit(k.MAX_SPATIAL_LAYER_CHANGE,{peerId:this.id,maxSpatialLayer:d(this,as)}))},2e3));y(this,Us,t);const{id:i,userId:a,displayName:o,device:c,picture:l,isHost:p,flags:h,clientSpecificId:f,stageStatus:g,customParticipantId:_,audioMuted:w,audioTrack:R,videoEnabled:D=!1,videoTrack:x,producers:B,metadata:b}=e;this.id=i,this.userId=a,this.name=o,this.device=c,this.picture=l,this.isHost=p,this.flags=h,this.manualProducerConfig=oP,y(this,ji,g!=null?g:"ON_STAGE"),this.customParticipantId=_!=null?_:f,this.audioEnabled=!w,this.audioTrack=R,this.videoEnabled=D,this.videoTrack=x,this.screenShareTracks={audio:void 0,video:void 0},this.producers=B!=null?B:[],this.presetName=b==null?void 0:b.preset_name,y(this,qi,!1),y(this,is,s),y(this,Ya,n),this.setupEvents(),this.updateVideo=this.updateVideo.bind(this),qe(this,Qa,Ah).call(this)}get clientSpecificId(){return this.customParticipantId}get stageStatus(){return d(this,ji)}get mediaJoined(){return d(this,Us).getValue("connectionHandler").mediaJoined}get socketJoined(){return d(this,Us).getValue("connectionHandler").socketJoined}setVideoEnabled(t,e=!0){this.videoEnabled=t,e&&(u.info("DyteParticipant::setVideoEnabled::videoUpdate",{...un(this)}),this.emit("videoUpdate",{videoEnabled:this.videoEnabled,videoTrack:this.videoTrack}))}setAudioEnabled(t,e=!0){this.audioEnabled=t,e&&(u.info("DyteParticipant::setAudioEnabled::audioUpdate",{...un(this)}),this.emit("audioUpdate",{audioEnabled:this.audioEnabled,audioTrack:this.audioTrack}))}setScreenShareEnabled(t,e=!0){this.screenShareEnabled=t,e&&this.emit("screenShareUpdate",{screenShareEnabled:this.screenShareEnabled,screenShareTracks:this.screenShareTracks})}setupEvents(){this.on("videoUpdate",qe(this,Qa,Ah))}async pin(){if(!this.mediaJoined)throw new I("Can`t pin participant without joining room","1205");if(!d(this,is).permissions.pinParticipant)throw new I("You do not have permission to pin participants.","1201");return d(this,Ln,Vo).pinPeer(this.id)}async unpin(){if(!this.mediaJoined)throw new I("Can`t unpin participant without joining room","1205");if(!d(this,is).permissions.pinParticipant)throw new I("You do not have permission to unpin participants.","1201");return d(this,Ln,Vo).pinPeer(null)}setIsPinned(t,e=!0){var n;y(this,qi,t);const s=t?"pinned":"unpinned";(n=d(this,Gi,Jd))==null||n.updateSource(this.id,{pinned:t}),e&&this.emit(s,this)}async disableAudio(){const t=this.id;if(u.info("DyteParticipant::disable_audio",{dyteParticipant:{id:t}}),!this.mediaJoined)throw new I("Can`t disable participant audio without joining room","1205");if(d(this,is).permissions.canDisableParticipantAudio)return d(this,Ln,Vo).disableAudio(t);throw u.error("DyteParticipant::unauthorized_disable_audio",{dyteParticipant:{id:t}}),new I("Unauthorized: User does not have permission to disable participant audio.","1201")}async kick(){const t=this.id;if(u.info("DyteParticipant::kick",{dyteParticipant:{id:t}}),!this.socketJoined)throw new I("Can`t kick participant without joining room","1205");if(d(this,is).permissions.kickParticipant){await P.emitAsync(k.KICK_PEER,{peerId:t});return}throw u.error("DyteParticipant::unauthorized_kick",{dyteParticipant:{id:t}}),new I("Unauthorized: User does not have permission to kick participants.","1201")}async disableVideo(){const t=this.id;if(u.info("DyteParticipant::disable_video",{dyteParticipant:{id:t}}),!this.mediaJoined)throw new I("Can`t disable participant video without joining room","1205");if(d(this,is).permissions.canDisableParticipantVideo)return d(this,Ln,Vo).disableVideo(t);throw u.error("DyteParticipant::unauthorized_disable_video",{dyteParticipant:{id:t}}),new I("Unauthorized: User does not have permission to disable participant video.","1201")}async getPermissions(){return d(this,Ya).getUserPermissions(this.userId)}setStageStatus(t){y(this,ji,t),this.emit("stageStatusUpdate",this)}get isPinned(){return d(this,qi)}registerVideoElement(t){var s,n,i,a;let e;(n=(s=d(this,Vs).get(t))==null?void 0:s.observer)==null||n.disconnect(),"ResizeObserver"in window&&(e=new ResizeObserver(()=>d(this,$d).call(this,t)),e.observe(t)),d(this,Vs).set(t,{observer:e}),this.updateVideo(t),(a=d(this,Gi,Jd))==null||a.addSource(this.id,t,this.videoEnabled,this.isPinned,this.name,this.picture,(i=this.raised)!=null?i:!1)}deregisterVideoElement(t){var e,s,n;t.srcObject=void 0,(s=(e=d(this,Vs).get(t))==null?void 0:e.observer)==null||s.disconnect(),d(this,Vs).delete(t),(n=d(this,Gi,Jd))==null||n.removeSource(this.id)}updateVideo(t){var e;if(this.videoEnabled){if(this.videoTrack==null)return;const s=(e=t.srcObject)==null?void 0:e.getTracks()[0];if((s==null?void 0:s.id)===this.videoTrack.id)return;const n=new MediaStream;n.addTrack(this.videoTrack),t.srcObject=n}else t.srcObject=void 0;t.style.display=this.videoEnabled?"block":"none"}},qi=new WeakMap,ji=new WeakMap,Us=new WeakMap,Ln=new WeakSet,Vo=function(){return d(this,Us).getValue("roomNodeClient")},is=new WeakMap,Ya=new WeakMap,Vs=new WeakMap,Gi=new WeakSet,Jd=function(){return d(this,Us).getValue("pip")},as=new WeakMap,$d=new WeakMap,Qa=new WeakSet,Ah=function(){Array.from(d(this,Vs).keys()).forEach(this.updateVideo)},Uy);ui([v.trace("DyteParticipant.disableAudio")],Jr.prototype,"disableAudio",1),ui([v.trace("DyteParticipant.kick")],Jr.prototype,"kick",1),ui([v.trace("DyteParticipant.disableVideo")],Jr.prototype,"disableVideo",1),ui([v.trace("DyteParticipant.getPermissions")],Jr.prototype,"getPermissions",1),ui([v.trace("DyteParticipant.setStageStatus")],Jr.prototype,"setStageStatus",1),Jr=ui([mt("1200")],Jr);class Ca extends Sv{constructor(t){const{onAddEvent:e="participantJoined",onDeleteEvent:s="participantLeft",onClearEvent:n="participantsCleared"}=t!=null?t:{};super({onAddEvent:e,onDeleteEvent:s,onClearEvent:n})}add(t,e=!0){return this.has(t.id)&&Object.is(this.get(t.id),t)===!1&&this.delete(t.id),super.add(t,e)}clear(t=!0,e=!1){return super.clear(t,e)}delete(t,e=!0,s=!1){return super.delete(t,e,s)}}class NN extends si{constructor(){super();E(this,Bs,void 0);y(this,Bs,new Map)}__set(e,s){return d(this,Bs).set(e,s)}__clear(){return d(this,Bs).clear()}get(e){return d(this,Bs).get(e)}toArray(){return Array.from(d(this,Bs).values())}}Bs=new WeakMap;class LN{constructor(){m(this,"_orderedArray");m(this,"_map");this._map=new Map,this._orderedArray=[]}add(t,e){if(!this._map.has(t))return this._map.set(t,{peerId:t,priority:e}),this._orderedArray.splice(Math.max(e-1,0),0,t),this.index(t);const s=this.index(t);this.delete(t);const n=this.add(t,e);return s!==n?n:-1}delete(t){if(this._map.has(t)){const e=this.index(t);this._map.delete(t),this._orderedArray.splice(e,1)}}index(t){return this._map.has(t)?this._orderedArray.indexOf(t):-1}[Symbol.iterator](){return this._orderedArray[Symbol.iterator]()}}class xN{constructor(){m(this,"_activeSpeakerPeers");m(this,"_compulsoryPeers");this._activeSpeakerPeers=new LN,this._compulsoryPeers=new Set}add(t,e){if(!t)return-1;if(e<0)return this._compulsoryPeers.add(t),0;if(this.compulsoryPeers.includes(t)&&(e>0||e===246267631)){if(u.info("DyteSelectedPeer::removing_compulsory_peer",{selectedPeer:{peerId:t}}),this._removeFromCompulsoryPeer(t),e===246267631)return-1}else if(e===229490415)return this.delete(t),-1;return this._activeSpeakerPeers.add(t,e)}delete(t){u.info("DyteSelectedPeer::deleting_peer_from_selectedPeer",{selectedPeer:{peerId:t}}),this._removeFromCompulsoryPeer(t),this._activeSpeakerPeers.delete(t)}index(t){return this._activeSpeakerPeers.index(t)}get peers(){return Array.from(new Set(this.compulsoryPeers.concat(this.activeSpeakerPeers)))}get compulsoryPeers(){return Array.from(this._compulsoryPeers.values())}get activeSpeakerPeers(){return Array.from(this._activeSpeakerPeers)}_removeFromCompulsoryPeer(t){this._compulsoryPeers.delete(t)}}const Vv=new xN;var FN=Object.defineProperty,$N=Object.getOwnPropertyDescriptor,Jt=(r,t,e,s)=>{for(var n=s>1?void 0:s?$N(t,e):t,i=r.length-1,a;i>=0;i--)(a=r[i])&&(n=(s?a(t,e,n):a(n))||n);return s&&n&&FN(t,e,n),n};const UN=["ACTIVE_GRID","PAGINATED","MANUAL"];let kt=(Vy=class extends qt{constructor(t,e,s){super();E(this,os);m(this,"waitlisted");m(this,"joined");m(this,"active");m(this,"videoSubscribed");m(this,"audioSubscribed");m(this,"pinned");m(this,"all");E(this,Dr,void 0);E(this,xn,void 0);E(this,$t,void 0);m(this,"rateLimitConfig",{maxInvocations:5,period:1});m(this,"viewMode");m(this,"currentPage");m(this,"lastActiveSpeaker");m(this,"selectedPeers",Vv);y(this,Dr,t),y(this,xn,e),y(this,$t,s),this.waitlisted=new Ca,this.joined=new Ca,this.videoSubscribed=new Ca,this.audioSubscribed=new Ca,this.active=this.videoSubscribed,this.pinned=new Ca,this.all=new NN,this.viewMode="ACTIVE_GRID",this.currentPage=0,this.setupEvents()}get pip(){return d(this,Dr).getValue("pip")}get socketJoined(){var t;return((t=d(this,Dr).getValue("connectionHandler"))==null?void 0:t.socketJoined)===!0}get mediaJoined(){var t;return((t=d(this,Dr).getValue("connectionHandler"))==null?void 0:t.mediaJoined)===!0}get rateLimits(){return this.rateLimitConfig}updateRateLimits(t,e){this.rateLimitConfig.maxInvocations=t,this.rateLimitConfig.period=e}setupEvents(){P.on(k.E2EE_ACTIVE_CONSUMER,({peerId:t})=>{var e;((e=d(this,Dr).getValue("modules").e2ee)==null?void 0:e.enabled)!==!0&&this.emit("media_decode_error",{reason:`Got encrypted media for participantId ${t}, but encryption wasn't enabled in init.defaults`,code:"1702"})})}get count(){return this.joined.size}get maxActiveParticipantsCount(){var t;return(t=d(this,os,Gn))==null?void 0:t.maxPreferredStreams}setMaxActiveParticipantsCount(t){if(t<0||t>24)throw new I("0 <= Max active participants count limit <= 24","1203");d(this,os,Gn).maxPreferredStreams=t,this.mediaJoined&&P.emit(k.UPDATE_ACTIVE)}get pageCount(){if(this.viewMode==="PAGINATED"){const t=this.selectedPeers.compulsoryPeers.length,e=this.joined.toArray().filter(s=>s.stageStatus==="ON_STAGE");return Math.ceil((e.length-t)/Math.max(this.maxActiveParticipantsCount-t,1))}return 0}acceptWaitingRoomRequest(t){var s,n;if(!this.socketJoined)throw new I("Can`t accept waiting room request without joining room","1205");const e=(n=(s=this.waitlisted.get(t))==null?void 0:s.userId)!=null?n:t;return d(this,$t).acceptWaitingRoomRequest([e])}async acceptAllWaitingRoomRequest(t){const e=t.map(s=>{var n,i;return(i=(n=this.waitlisted.get(s))==null?void 0:n.userId)!=null?i:s});return d(this,$t).acceptWaitingRoomRequest(e)}async rejectWaitingRoomRequest(t){var s,n;if(!this.socketJoined)throw new I("Can`t reject waiting room request without joining room","1205");const e=(n=(s=this.waitlisted.get(t))==null?void 0:s.userId)!=null?n:t;d(this,$t).rejectWaitingRoomRequest([e])}async setViewMode(t){if(u.info("DyteParticipants::set_view_mode",{pageNavigation:{viewMode:t,currentPage:this.currentPage,pageCount:this.pageCount,maxActiveParticipantsCount:this.maxActiveParticipantsCount}}),!(s=>UN.includes(s))(t))throw u.error("DyteParticipants::setViewMode::invalid_view_mode",{pageNavigation:{viewMode:t,currentPage:this.currentPage,pageCount:this.pageCount,maxActiveParticipantsCount:this.maxActiveParticipantsCount}}),new I(`Invalid view mode: ${t}. Try ACTIVE_GRID, PAGINATED or MANUAL.`,"1207");if(this.viewMode===t){u.info("DyteParticipants::setViewMode::view_mode_same_as_previous");return}if(t==="MANUAL")throw new I("Manual Subscription is not enabled for your Organization. Please contact support.","1208");this.viewMode=t,t==="PAGINATED"?(this.currentPage=1,P.emit(k.UPDATE_ACTIVE,{page:this.currentPage})):t==="ACTIVE_GRID"&&(this.currentPage=0,P.emit(k.UPDATE_ACTIVE)),this.emit("viewModeChanged",{viewMode:t,currentPage:this.currentPage,pageCount:this.pageCount})}async subscribe(t,e=["audio","video","screenshareAudio","screenshareVideo"]){if(this.viewMode!=="MANUAL")throw new I("MANUAL subscription mode was not activated.","1206");const s=[];t.forEach(n=>{const i=this.joined.get(n);if(i){if(e.includes("audio")){i.manualProducerConfig={...i.manualProducerConfig,audio:!0},this.videoSubscribed.add(i);const a=i.producers.find(o=>o.kind==="audio"&&!o.screenShare);a&&s.push(a)}if(e.includes("video")){i.manualProducerConfig={...i.manualProducerConfig,video:!0},this.audioSubscribed.add(i);const a=i.producers.find(o=>o.kind==="video"&&!o.screenShare);a&&s.push(a)}if(e.includes("screenshareAudio")){i.manualProducerConfig={...i.manualProducerConfig,screenshareAudio:!0};const a=i.producers.find(o=>o.kind==="audio"&&o.screenShare);s.push(a)}if(e.includes("screenshareVideo")){i.manualProducerConfig={...i.manualProducerConfig,screenshareVideo:!0};const a=i.producers.find(o=>o.kind==="video"&&o.screenShare);s.push(a)}}}),await d(this,os,Gn).createConsumers(s)}async unsubscribe(t,e=["audio","video","screenshareAudio","screenshareVideo"]){if(this.viewMode!=="MANUAL")throw new I("MANUAL subscription mode was not activated.","1206");const s=[];t.forEach(n=>{const i=this.joined.get(n);if(i){if(e.includes("audio")){i.manualProducerConfig={...i.manualProducerConfig,audio:!1};const a=i.producers.find(o=>o.kind==="audio"&&!o.screenShare);a&&s.push(a)}if(e.includes("video")){i.manualProducerConfig={...i.manualProducerConfig,video:!1};const a=i.producers.find(o=>o.kind==="video"&&!o.screenShare);a&&s.push(a)}if(e.includes("screenshareAudio")){i.manualProducerConfig={...i.manualProducerConfig,screenshareAudio:!1};const a=i.producers.find(o=>o.kind==="audio"&&o.screenShare);s.push(a)}if(e.includes("screenshareVideo")){i.manualProducerConfig={...i.manualProducerConfig,screenshareVideo:!1};const a=i.producers.find(o=>o.kind==="video"&&o.screenShare);s.push(a)}}}),await d(this,os,Gn).closeConsumers(s)}getPeerIdsForCurrentPage(){u.info("DyteParticipants::getPeerIdsForCurrentPage()",{pageNavigation:{viewMode:this.viewMode,currentPage:this.currentPage,pageCount:this.pageCount,maxActiveParticipantsCount:this.maxActiveParticipantsCount}});const{compulsoryPeers:t}=this.selectedPeers,e=t.filter(o=>this.joined.has(o)),s=Array.from(this.pinned.keys()).filter(o=>!e.includes(o)),n=Array.from(this.joined.toArray().filter(o=>o.stageStatus==="ON_STAGE").map(o=>o.id)),i=Math.max((this.currentPage-1)*(this.maxActiveParticipantsCount-e.length-s.length)),a=this.currentPage*(this.maxActiveParticipantsCount-e.length-s.length);return e.concat(s,n.slice(i,a))}async setPage(t){if(u.info("DyteParticipants::set_page",{pageNavigation:{settingPage:t,viewMode:this.viewMode,currentPage:this.currentPage,pageCount:this.pageCount,maxActiveParticipantsCount:this.maxActiveParticipantsCount}}),this.viewMode==="PAGINATED"){if(!Number.isInteger(t))throw u.error("DyteParticipants::invalid_page_number"),new I(`Invalid page: ${t}. Page must be an integer and greater than 0 and less than or equal to .pageCount`,"1202");this.currentPage=t,P.emit(k.UPDATE_ACTIVE,{page:t}),this.emit("pageChanged",{viewMode:this.viewMode,currentPage:this.currentPage,pageCount:this.pageCount})}}async disableAllAudio(t){if(u.info("DyteParticipants::disable_all_audio",{actions:{disableAllAudio:{allowUnmute:t}}}),!this.mediaJoined)throw new I("Can`t disable all audio without joining room","1205");if(d(this,xn).permissions.canAllowParticipantAudio)return d(this,os,Gn).muteAll(t);throw u.error("DyteParticipants::unauthorized_disable_all_audio",{actions:{disableAllAudio:{allowUnmute:t}}}),new I("Unauthorized: User does not have permission to disable peer audio.","1201")}async disableAllVideo(){if(u.info("DyteParticipants::disable_all_video"),!this.mediaJoined)throw new I("Can`t disable all video without joining room","1205");if(d(this,xn).permissions.canAllowParticipantVideo)return d(this,os,Gn).muteAllVideo();throw u.error("DyteParticipants::unauthorized_disable_all_video"),new I("Unauthorized: User does not have permission to disable peer video.","1201")}async disableAudio(t){this.joined.get(t).disableAudio()}async disableVideo(t){this.joined.get(t).disableVideo()}async kick(t){await P.emitAsync(k.KICK_PEER,{peerId:t})}async kickAll(){if(u.info("DyteParticipants::kick_all"),d(this,Dr).getValue("viewType")!=="LIVESTREAM"&&!this.socketJoined)throw new I("Can`t kick all without joining room","1205");if(!d(this,xn).permissions.kickParticipant)throw u.error("DyteParticipants::unauthorized_kick_all"),new I("Unauthorized: User does not have permission to kick peers.","1201");const e=J.hasFeature(Z.PROPAGATE_KICK_ALL);d(this,$t).kickAll(e)}async broadcastMessage(t,e,s){if(u.info("DyteParticipants::broadcastMessage"),!this.socketJoined)throw new I("Can`t broadcast message without joining room","1205");if(!(t!=null&&t.trim()))throw new I("`type` must be a non-empty string.","1209");if(s)if("meetingIds"in s)await d(this,$t).broadcastToMeetings(t,s.meetingIds,e);else{let n=[];"participantIds"in s?n=s.participantIds:n=this.joined.toArray().filter(i=>{var a;return(a=s.presetNames)==null?void 0:a.includes(i.presetName)}).map(i=>i.id),await d(this,$t).broadcastToPeers(t,n,e)}else await d(this,$t).broadcastMessage(t,e)}async getAllJoinedPeers(t,e,s){return(await d(this,$t).getRoomPeers(t,e,s)).peers.map(Kr.formatSocketServiceMessage)}async updatePermissions(t,e){const s=this.joined.toArray().filter(i=>t.includes(i.id)).map(i=>i.userId),n=[...new Set(s)];if(!n.length)throw new I("Cannot update permissions, no valid userIDs found","1204");d(this,$t).updatePermissions(n,e)}async getParticipantsInMeetingPreJoin(){return d(this,$t).getRoomPeersNonPaginated()}},Dr=new WeakMap,os=new WeakSet,Gn=function(){return d(this,Dr).getValue("roomNodeClient")},xn=new WeakMap,$t=new WeakMap,Vy);Jt([v.trace("DyteParticipants.setViewMode")],kt.prototype,"setViewMode",1),Jt([v.trace("DyteParticipants.setPage")],kt.prototype,"setPage",1),Jt([v.trace("DyteParticipants.disableAllAudio")],kt.prototype,"disableAllAudio",1),Jt([v.trace("DyteParticipants.disableAllVideo")],kt.prototype,"disableAllVideo",1),Jt([v.trace("DyteParticipants.disablePeerAudio")],kt.prototype,"disableAudio",1),Jt([v.trace("DyteParticipants.disablePeerVideo")],kt.prototype,"disableVideo",1),Jt([v.trace("DyteParticipants.kickPeer")],kt.prototype,"kick",1),Jt([v.trace("DyteParticipants.kickAll")],kt.prototype,"kickAll",1),Jt([v.trace("DyteParticipants.broadcastMessage"),Lt(ai,"rateLimitConfig")],kt.prototype,"broadcastMessage",1),Jt([v.trace("DyteParticipants.getAllJoinedPeers"),Lt({maxInvocations:10,period:60})],kt.prototype,"getAllJoinedPeers",1),Jt([v.trace("DyteParticipant.updatePermissions"),Lt({maxInvocations:1e3,period:60})],kt.prototype,"updatePermissions",1),Jt([v.trace("DyteParticipants.getParticipantsInMeetingPreJoin")],kt.prototype,"getParticipantsInMeetingPreJoin",1),kt=Jt([mt("1200")],kt);var Xt=(r=>(r.NEW="new",r.CONNECTING="connecting",r.RECONNECTING="reconnecting",r.DISCONNECTED="disconnected",r.CONNECTED="connected",r.FAILED="failed",r))(Xt||{}),Zt=(r=>(r[r.HIVE=1]="HIVE",r[r.ROOM_NODE=2]="ROOM_NODE",r[r.CF=3]="CF",r))(Zt||{}),VN=Object.defineProperty,BN=Object.getOwnPropertyDescriptor,hn=(r,t,e,s)=>{for(var n=s>1?void 0:s?BN(t,e):t,i=r.length-1,a;i>=0;i--)(a=r[i])&&(n=(s?a(t,e,n):a(n))||n);return s&&n&&VN(t,e,n),n};const Bv=class{constructor(r,t,e,s){m(this,"participants");m(this,"self");m(this,"selectedPeers",Vv);m(this,"maxSpatialLayerUpdates",new Map);m(this,"consumerPeerMap");m(this,"events");m(this,"roomSocketHandler");m(this,"context");m(this,"videoPeerConsumerMap",new Map);m(this,"updateConsumerSpatialLayers",ti(()=>{const r={},t=new Map(this.maxSpatialLayerUpdates);this.maxSpatialLayerUpdates.clear(),Array.from(t.entries()).forEach(([e,s])=>{r[s]===void 0&&(r[s]={layer:s,consumerIds:[]}),r[s].consumerIds.push(e)}),Object.keys(r).forEach(e=>{const s=r[e];u.log(`Switching max spatial layer to ${s.layer}`,{consumerIds:s.consumerIds}),this.roomNodeClient.switchConsumersToLayer(s.consumerIds,s.layer)})},2e3));m(this,"updateConsumers",(r,t)=>{let e=Promise.resolve();t.length>0&&(u.info("Closing consumers for producers",{producers:t}),e=this.roomNodeClient.closeConsumers(t)),e.then(()=>{r.length!==0&&(u.info("Consuming producers",{producers:r}),this.roomNodeClient.createConsumers(r).catch(s=>u.error("Error activating peers",{error:s})))}).catch(s=>u.error("Error deactivating peers",{error:s}))});m(this,"updateConsumersDebounced",ti(this.updateConsumers,200,{trailing:!0}));switch(this.context=r,this.roomSocketHandler=e,this.participants=new kt(r,t,this.roomSocketHandler),this.self=t,this.consumerPeerMap=new Map,s){case Zt.HIVE:{this.events=Te;break}case Zt.CF:{this.events=Pe;break}default:this.events=Te}t.config.viewType!=="CHAT"&&this.setupEventsGlobal(),this.setupEvents()}get roomNodeClient(){return this.context.getValue("roomNodeClient")}get mediaJoined(){var r;return((r=this.roomNodeClient)==null?void 0:r.mediaJoined)===!0}get pip(){return this.context.getValue("pip")}setupEvents(){this.roomSocketHandler.on(U.getWaitingRoomRequests,this.waitingRoomRequestHandler.bind(this)),P.on(k.SOCKET_PEERS,async r=>{const t=J.hasFeature(Z.DEBUG_SOCKET_JOIN);if(t){const e=r&&(r==null?void 0:r.length)<20?{peers:JSON.stringify(r.map(s=>s.peerId))}:void 0;u.info("Processing socket peers",e)}r==null||r.forEach(e=>{e.waitlisted||this.onParticipantJoined(this.fromSocketService(e))}),t&&u.info("Processed socket peers")}),this.roomSocketHandler.on(this.events.peerJoinedBroadcast,({participant:r})=>{J.hasFeature(Z.DEBUG_SOCKET_JOIN)&&u.info("events.peerJoinedBroadcast",{peers:r.peerId}),this.onMediaJoined(r.peerId,r.producerStates,r.capabilities)}),this.roomSocketHandler.on(U.leaveRoom,r=>{var e;const{peerId:t}=r.peer;(e=this.roomNodeClient)==null||e.handlePeerLeaving(t)}),this.roomSocketHandler.on(this.events.selfJoinComplete,({participants:r,selectedPeers:t,roomState:e})=>{if(J.hasFeature(Z.DEBUG_SOCKET_JOIN)){const i=r&&(r==null?void 0:r.length)<20?{peers:JSON.stringify(r.map(a=>a.peerId))}:void 0;u.info("events.selfJoinComplete",i)}r.forEach(({peerId:i,producerStates:a,capabilities:o})=>this.onMediaJoined(i,a,o));const{audioPeers:s,compulsoryPeers:n}=t!=null?t:{};e.pinnedPeerIds.length!==0&&this.onParticipantPinned(e.pinnedPeerIds[0]),this.computeActivateParticipants(s!=null?s:[],n),P.emit(k.UPDATE_ACTIVE,{createAllConsumers:!0})}),P.on(k.MAX_SPATIAL_LAYER_CHANGE,({peerId:r,maxSpatialLayer:t})=>{const e=this.videoPeerConsumerMap.get(r);e&&(this.maxSpatialLayerUpdates.set(e,t),this.updateConsumerSpatialLayers())}),P.on(k.NEW_PRODUCER,({peerId:r,producer:t})=>{const e=this.participants.joined.get(r);if(!e){u.warn("ParticipantController::NEW_PRODUCER::participant not found",{producer:{id:t==null?void 0:t.producerId,kind:t==null?void 0:t.kind,status:"UNKNOWN",appData:{screenShare:t==null?void 0:t.screenShare}},dyteParticipant:{id:r}});return}if(e.producers.push(t),u.info("ParticipantController::NEW_PRODUCER::producer_added_to_participant",{producer:{id:t==null?void 0:t.producerId,peerId:r,kind:t==null?void 0:t.kind,status:"UNKNOWN",appData:{screenShare:t==null?void 0:t.screenShare}}}),this.participants.viewMode==="MANUAL"){let s=!1;const n=t.kind==="audio",i=t.kind==="video",a=e.manualProducerConfig;(n&&(a.audio&&!t.screenShare||a.screenshareAudio&&t.screenShare)||i&&(a.video&&!t.screenShare||a.screenshareVideo&&t.screenShare))&&(s=!0),s?this.roomNodeClient.createConsumers([t]):u.info("ParticipantController::NEW_PRODUCER::not_consuming_producer",{producer:{id:t==null?void 0:t.producerId,peerId:r,kind:t==null?void 0:t.kind,status:"UNKNOWN",appData:{screenShare:t==null?void 0:t.screenShare}}});return}(t==null?void 0:t.kind)==="audio"&&this.participants.audioSubscribed.get(r)||(t==null?void 0:t.kind)==="video"&&this.participants.videoSubscribed.get(r)||t!=null&&t.screenShare?this.roomNodeClient.createConsumers([t]).catch(s=>{u.error("ParticipantController::createConsumer failed",{error:s})}):u.info("ParticipantController::NEW_PRODUCER::not_consuming_producer",{producer:{id:t==null?void 0:t.producerId,peerId:r,kind:t==null?void 0:t.kind,status:"UNKNOWN",appData:{screenShare:t==null?void 0:t.screenShare}}})}),P.on(k.PRODUCER_CLOSED,({peerId:r,producerId:t})=>{const e=this.participants.joined.get(r);if(!e){u.warn("ParticipantController::NEW_PRODUCER::participant not found",{dyteParticipant:{id:r}});return}e.producers=e.producers.filter(s=>s.producerId!==t)}),P.on(k.PRODUCER_TOGGLE,({peerId:r,producerId:t,paused:e,kind:s})=>{const n=this.participants.joined.get(r);if(n){s==="audio"&&n.setAudioEnabled(!e);const i=n.producers.find(a=>a.producerId===t);i&&(i.pause=e)}}),this.roomSocketHandler.on(this.events.globalPeerPinBroadcast,r=>{let t;if(r&&(t=r.participantId),!this.mediaJoined)return;const e=t;this.onParticipantPinned(e);const s=this.participants.joined.get(e);s&&this.roomNodeClient.activatePeers(s.producers).catch(n=>{u.error("unable to create consumers",{error:n})})}),this.roomSocketHandler.on(this.events.selectedPeer,({audioPeers:r,compulsoryPeers:t})=>{this.mediaJoined&&this.onSelectedPeers(t.concat(r))}),this.roomSocketHandler.on(this.events.selectedPeerDiff,({entries:r})=>{if(!this.mediaJoined)return;const t=r.map(e=>({peerId:e.peerId,priority:e.priority}));this.updateActiveParticipantsWithPriorities(t,!0)})}waitingRoomRequestHandler(r){const t=r.requests.filter(s=>!this.participants.waitlisted.toArray().find(n=>n.userId===s.userId)),e=this.participants.waitlisted.toArray().filter(s=>!r.requests.find(n=>n.userId===s.userId));t.forEach(s=>this.participants.waitlisted.add(new Jr(this.context,{id:s.peerId,displayName:s.displayName,audioMuted:!0,videoEnabled:!1,audioTrack:void 0,videoTrack:void 0,stageStatus:"OFF_STAGE",userId:s.userId,flags:{},isHost:!1,customParticipantId:s.customParticipantId,picture:s.picture,metadata:{preset_name:s.presetName}},this.self,this.roomSocketHandler))),e.forEach(s=>this.participants.waitlisted.delete(s.id))}get maxPreferredStreams(){return this.participants.maxActiveParticipantsCount}async selectPagePeers(r){const{compulsoryPeers:t}=this.selectedPeers,e=t.filter(c=>this.participants.joined.has(c)),s=Array.from(this.participants.pinned.keys()).filter(c=>!e.includes(c)),n=Array.from(this.participants.joined.toArray().filter(c=>c.stageStatus==="ON_STAGE").map(c=>c.id)),i=Math.max((r-1)*(this.roomNodeClient.maxPreferredStreams-e.length-s.length)),a=r*(this.roomNodeClient.maxPreferredStreams-e.length-s.length);return e.concat(s,n.slice(i,a))}async selectActivePeers(){const r=new Map,t=Array.from(this.participants.joined.toArray().filter(l=>l.stageStatus==="ON_STAGE").map(l=>(r.set(l.id,!0),l.id))),e=this.selectedPeers.peers,s=this.participants.pinned.toArray().reduce((l,p)=>(p.stageStatus!=="ON_STAGE"?this.participants.pinned.delete(p.id):l.push(p.id),l),[]),n=this.self.stageStatus==="ON_STAGE"?1:0,i=this.participants.maxActiveParticipantsCount-n,a=new Set(e.concat(s).filter(l=>l!==this.self.id&&r.has(l)));let o=Array.from(a);const c=i-a.size;if(c>=0){const l=t.filter(p=>!a.has(p)&&p!==this.self.id).slice(0,c);o=Array.from(a).concat(l)}else o=o.slice(0,i);return o}async updateActive(r,t){const{page:e,createAllConsumers:s}=t!=null?t:{};let{strategies:n}=t!=null?t:{},i,a;switch(r){case"PAGINATED":{if(!e)return;i=await this.selectPagePeers(e),u.debug("ParticipantController::updateActive::updating_current_page_peers",{peerIds:i}),n!=null||(n={video:this.updateParticipantsMap.bind(this)}),a=this.updateConsumersDebounced;break}case"ACTIVE_GRID":{i=await this.selectActivePeers(),u.debug("ParticipantController::updateActive::updating_current_selected_peers",{peerIds:i}),n!=null||(n={video:this.updateParticipantsMapMinReplacement.bind(this),audio:this.updateParticipantsMap.bind(this)}),a=this.updateConsumers;break}default:throw new Error(`View mode ${r} not supported`)}let o,c;const l=this.updateGrid(i,n);s?(o=this.mapPeerIdsToProducers(i,["audio","video","screenshare"]),c=[]):(o=[...this.mapPeerIdsToProducers([...l.video.add],["video"]),...this.mapPeerIdsToProducers([...l.audio.add],["audio"])],c=[...this.mapPeerIdsToProducers([...l.video.remove],["video"]),...this.mapPeerIdsToProducers([...l.audio.remove],["audio"])]),!(o.length===0&&c.length===0)&&a(o,c)}computeActivateParticipants(r,t){const e=r.map((n,i)=>({peerId:n,priority:i+1})),s=t==null?void 0:t.map((n,i)=>({peerId:n,priority:-(i+1)}));e.push(...s!=null?s:[]),e.length>0&&this.updateActiveParticipantsWithPriorities(e)}fromSocketService(r){const t=Bv.formatSocketServiceMessage(r);return new Jr(this.context,{...t,isHost:!1,videoEnabled:!1,audioMuted:!0,videoTrack:void 0,audioTrack:void 0},this.self,this.roomSocketHandler)}updatePipSource(r,t){var e,s;t?(e=this.pip)==null||e.enableSource(r):(s=this.pip)==null||s.disableSource(r)}onMediaJoined(r,t,e){if(!this.mediaJoined||r===this.self.id)return;const s=this.participants.joined.get(r);if(!s){u.warn(`Recieved media.peerJoinedBroadcast for non-existent peer ${r}`);return}t.forEach(n=>{n.kind===hr.AUDIO&&!n.screenShare?s.setAudioEnabled(!n.pause):n.kind===hr.VIDEO&&!n.screenShare&&(s.setVideoEnabled(!n.pause),this.updatePipSource(s.id,!n.pause)),s.producers.push({...n,producingTransportId:n.producingTransportId,kind:n.kind===hr.AUDIO?"audio":"video",producingPeerId:r,mimeType:n.mimeType})}),this.roomNodeClient.handlePeerCapabilities(r,e),this.roomNodeClient.shareWebcam(this.self.videoTrack)}updateParticipantsMapMinReplacement(r,t){const e=Array.from(r.keys()),s=new Map(r),n=[],i=[],a=new Set(t),o=[];return e.forEach((c,l)=>{(!a.has(c)||!this.participants.joined.get(c))&&o.push(l)}),t.forEach(c=>{if(r.get(c))return;if(e.length<t.length){e.push(c),n.push(c);return}const l=o.shift();i.push(e[l]),e[l]=c,n.push(e[l])}),e.forEach((c,l)=>{a.has(c)||i.concat(e.splice(l,1))}),Array.from(r.keys()).forEach(c=>{r.delete(c,!a.has(c))}),e.forEach(c=>{if(!this.participants.joined.get(c)){u.warn("updateActiveParticipants::participant_not_in_joined_list",{dyteParticipant:{id:c}});return}r.add(this.participants.joined.get(c),!s.get(c))}),r.emit("participantsUpdate"),[n,i]}updateParticipantsMap(r,t){const e=Array.from(r.keys()),s=[],n=[];return e.forEach(i=>{t.includes(i)||(r.delete(i,!0),n.push(i))}),t.forEach(i=>{r.get(i)||(r.add(this.participants.joined.get(i)),s.push(i))}),r.emit("participantsUpdate"),[s,n]}updatePinnedParticipants(){this.participants.pinned.forEach(r=>{r.setIsPinned(!1),this.participants.pinned.delete(r.id)})}setupEventsGlobal(){this.roomSocketHandler.on(U.joinRoom,({peer:r})=>{if(!r.waitlisted){const t=J.hasFeature(Z.DEBUG_SOCKET_JOIN);t&&u.info("Processing socket join",{peers:r.peerId}),this.onParticipantJoined(this.fromSocketService(r)),t&&u.info("Processed socket join",{peers:r.peerId})}}),this.roomSocketHandler.on(U.leaveRoom,r=>{this.selectedPeers.delete(r.peer.peerId),this.onParticipantLeave(r.peer.peerId)}),P.on(k.SOCKET_SERVICE_ROOM_JOINED,()=>{this.self.permissions.acceptWaitingRequests&&this.roomSocketHandler.getWaitingRoomRequests()}),this.self.permissions.on("permissionsUpdate",r=>{const{acceptWaitingRequests:t}=r;t!==void 0&&(t?this.roomSocketHandler.getWaitingRoomRequests():this.participants.waitlisted.clear())}),P.on(k.SOCKET_SERVICE_DISCONNECTED,()=>{this.participants.joined.clear(),this.participants.videoSubscribed.clear(),this.participants.audioSubscribed.clear(),this.participants.pinned.clear(),this.participants.currentPage=0,this.participants.viewMode="ACTIVE_GRID",this.participants.emit("viewModeChanged",{viewMode:"ACTIVE_GRID",currentPage:this.participants.currentPage,pageCount:this.participants.pageCount})}),P.on(k.CONSUMER_PAUSED,({id:r})=>{this.processConsumerPaused(r)}),P.on(k.CONSUMER_RESUMED,({id:r})=>{this.processConsumerResumed(r)}),P.on(k.NEW_CONSUMER,({id:r})=>{this.processNewConsumer(r)}),P.on(k.CONSUMER_CLOSED,({id:r})=>{this.processConsumerClosed(r)}),P.on(k.ROOM_MESSAGE,async({payload:r,type:t,timestamp:e})=>{this.participants.emit("broadcastedMessage",{type:t,payload:r,timestamp:e})}),P.on(k.MESSAGE,async({payload:r,type:t,timestamp:e})=>{t!=="spotlight"&&this.participants.emit("broadcastedMessage",{type:t,payload:r,timestamp:e})}),P.on(k.LOW_CONSUMER_SCORE,({peerId:r,score:t,kind:e})=>{const s=this.participants.joined.get(r);s&&(s.emit("poorConnection",{score:t,kind:e}),this.participants.emit("poorConnection",{participantId:r,score:t,kind:e}))}),P.on(k.CONSUMER_SCORE_UPDATE,({score:r,kind:t,appData:e,peerId:s,scoreStats:n})=>{var o;const i=t==="video"&&((o=e==null?void 0:e.screenShare)!=null?o:!1),a=this.participants.joined.get(s);a&&(a.emit("mediaScoreUpdate",{kind:t,isScreenshare:i,score:r,participantId:s,scoreStats:n}),this.participants.emit("mediaScoreUpdate",{kind:t,isScreenshare:i,score:r,participantId:s,scoreStats:n}))}),P.onAsync(k.KICK_PEER,async({peerId:r})=>{const t=this.participants.joined.get(r);await this.roomNodeClient.kick(r),await this.roomSocketHandler.kick(r),t?t.emit("kicked"):this.participants.joined.emit("kicked",{id:r})}),P.on(k.UPDATE_ACTIVE,async({page:r,createAllConsumers:t}={})=>{await this.updateActive(r?"PAGINATED":"ACTIVE_GRID",{page:r,createAllConsumers:t})})}async onParticipantPinned(r){if(!r){this.self.isPinned&&this.self.setIsPinned(!1),this.participants.pinned.size!==0&&this.updatePinnedParticipants();return}if(r===this.self.id){this.participants.pinned.size!==0&&this.updatePinnedParticipants(),this.self.setIsPinned(!0);return}const t=this.participants.joined.get(r);this.self.isPinned&&this.self.setIsPinned(!1),this.updatePinnedParticipants(),t.setIsPinned(!0),this.participants.pinned.add(t)}async onParticipantJoined(r){var e,s,n;if(this.self.id!==r.id&&!((e=r.flags)!=null&&e.recorder)&&!((s=r.flags)!=null&&s.hidden_participant)&&!((n=r.flags)!=null&&n.hiddenParticipant)&&(this.participants.videoSubscribed.delete(r.id),this.participants.audioSubscribed.delete(r.id),this.participants.joined.add(r),this.participants.waitlisted.delete(r.id),r.stageStatus==="REQUESTED_TO_JOIN_STAGE"&&P.emit(k.UPDATE_STAGE_REQUESTS,{request:{displayName:r.name,userId:r.userId,peerId:r.id},add:!0})),P.emit(k.PEER_JOINED_INTERNAL,r),this.self.config.viewType===Ct.Webinar&&r.stageStatus!=="ON_STAGE"||this.roomNodeClient===void 0||this.participants.videoSubscribed.size>=this.roomNodeClient.maxPreferredStreams)return;const t=this.participants.currentPage;this.updateActive(t?"PAGINATED":"ACTIVE_GRID",{page:t})}async onParticipantLeave(r){const t=this.participants.joined.get(r);this.participants.joined.delete(r,!0,!0),this.participants.pinned.delete(r,!0,!0),this.participants.waitlisted.delete(r,!0,!0),t&&t.stageStatus==="REQUESTED_TO_JOIN_STAGE"&&P.emit(k.UPDATE_STAGE_REQUESTS,{request:{displayName:t.name,userId:t.userId,peerId:t.id},add:!1});const{currentPage:e}=this.participants,s=this.maxPreferredStreams*(e-1),n=this.participants.videoSubscribed.get(r);s===0?this.participants.setViewMode("ACTIVE_GRID"):this.participants.joined.size<=s?e===2?this.participants.setViewMode("ACTIVE_GRID"):this.participants.setPage(e-1):n&&this.updateActive(e?"PAGINATED":"ACTIVE_GRID",{page:e})}processMedia(r){var p;const t=this.roomNodeClient.getConsumers(),{peerId:e,kind:s,appData:n,remotelyPaused:i,track:a,producerId:o,rtpReceiver:c}=(p=t.get(r))!=null?p:{};if(!e)return u.warn("processMedia::Peer ID is undefined",{consumer:{id:r,kind:s,peerId:e,appData:{supportsRemoteControl:!!(n!=null&&n.supportsRemoteControl),screenShare:!!(n!=null&&n.screenShare)},remotelyPaused:i,producerId:o}}),{};const l=n;return s==="video"&&l.screenShare!==!0&&this.videoPeerConsumerMap.set(e,r),u.info("ParticipantController::processMedia",{consumer:{id:r,peerId:e,kind:s,appData:l,remotelyPaused:i,producerId:o}}),this.consumerPeerMap.set(r,{type:s,peerId:e,appData:l,remotelyPaused:i,producerId:o}),{peerId:e,kind:s,appData:l,remotelyPaused:i,track:a,producerId:o,rtpReceiver:c}}processConsumerClosed(r){const{peerId:t,type:e,appData:s,remotelyPaused:n,producerId:i}=this.consumerPeerMap.get(r)||{},a=this.participants.joined.get(t);if(u.info("ParticipantController::processConsumerClosed",{consumer:{id:r,peerId:t,appData:s,kind:e,remotelyPaused:n,producerId:i}}),this.consumerPeerMap.delete(r),e==="video"&&s.screenShare!==!0&&this.videoPeerConsumerMap.delete(t),!a)return;const o=[];s&&s.screenShare?(a.setScreenShareEnabled(!1),q.consumerSharedMediaState(r,{screen:!1}),a.screenShareTracks.video&&o.push(a.screenShareTracks.video.id),a.screenShareTracks.audio&&o.push(a.screenShareTracks.audio.id),a.screenShareTracks={audio:void 0,video:void 0}):e==="audio"?(a.setAudioEnabled(!1),a.audioTrack&&o.push(a.audioTrack.id),q.consumerSharedMediaState(r,{audio:!1}),a.audioTrack=void 0):e==="video"&&(a.setVideoEnabled(!1),this.updatePipSource(a.id,!1),a.videoTrack&&o.push(a.videoTrack.id),q.consumerSharedMediaState(r,{video:!1}),a.videoTrack=void 0),s.e2ee&&o.forEach(c=>{P.emit(k.E2EE_INACTIVE_CONSUMER,{peerId:t,trackId:c})})}processConsumerResumed(r){const{peerId:t,kind:e,appData:s,track:n,remotelyPaused:i,producerId:a,rtpReceiver:o}=this.processMedia(r);if(!t)return;u.info("ParticipantController::processConsumerResumed",{consumer:{id:r,peerId:t,kind:e,appData:s,remotelyPaused:i,producerId:a}});const c=this.participants.joined.get(t);if(c){if(s.e2ee&&P.emit(k.E2EE_ACTIVE_CONSUMER,{peerId:t,rtpReceiver:o,track:n}),s.screenShare){e==="video"?c.screenShareTracks.video=n:e==="audio"&&(c.screenShareTracks.audio=n),c.setScreenShareEnabled(!0),q.consumerSharedMediaState(r,{screen:!0});return}e==="video"?(c.videoTrack=n,c.setVideoEnabled(!0),this.updatePipSource(c.id,!0),q.consumerSharedMediaState(r,{video:!0})):e==="audio"&&(c.audioTrack=n,c.setAudioEnabled(c.audioEnabled),q.consumerSharedMediaState(r,{audio:c.audioEnabled}))}}processConsumerPaused(r){u.info(`ParticipantController::processConsumerPaused called for consumerId: ${r}`);const{peerId:t,kind:e,track:s,appData:n,remotelyPaused:i,producerId:a}=this.processMedia(r);if(!t)return;u.info("ParticipantController::processConsumerPaused",{consumer:{id:r,peerId:t,kind:e,appData:n,remotelyPaused:i,producerId:a}});const o=this.participants.joined.get(t);o&&(s&&n.e2ee&&P.emit(k.E2EE_INACTIVE_CONSUMER,{peerId:t,trackId:s.id}),e==="video"?(o.videoTrack=s,o.setVideoEnabled(!1),this.updatePipSource(o.id,!1),q.consumerSharedMediaState(r,{video:!1})):e==="audio"&&(o.audioTrack=s,o.setAudioEnabled(o.audioEnabled),q.consumerSharedMediaState(r,{audio:o.audioEnabled})))}processNewConsumer(r){const{peerId:t,kind:e,remotelyPaused:s,track:n,appData:i,producerId:a,rtpReceiver:o}=this.processMedia(r);if(!t)return;u.info("ParticipantController::processNewConsumer",{consumer:{id:r,peerId:t,kind:e,remotelyPaused:s,appData:i,producerId:a}});const c=this.participants.joined.get(t);if(c){if(i.screenShare){e==="video"?c.screenShareTracks.video=n:e==="audio"&&(c.screenShareTracks.audio=n),(!s||this.self.permissions.isRecorder||J.hasFeature(Z.SCREEENSHARE_ERR_HACK))&&c.setScreenShareEnabled(!0),i.supportsRemoteControl&&(c.supportsRemoteControl=!0),this.participants.broadcastMessage("screenshareConsumerCreated",{producerId:a,peerId:t,screenShare:!0,consumerId:r,consumerPeerId:this.self.id}),u.info("ParticipantController::newScreenshareConsumer::screenshareConsumerCreated",{consumer:{id:r,peerId:t,kind:e,remotelyPaused:s,appData:i,producerId:a}});return}e==="video"?(c.videoTrack=n,s||(c.setVideoEnabled(!0),this.updatePipSource(c.id,!0)),q.consumerSharedMediaState(r,{video:!s})):e==="audio"&&(c.audioTrack=n,s||c.setAudioEnabled(!0),q.consumerSharedMediaState(r,{audio:!s})),!s&&i.e2ee&&P.emit(k.E2EE_ACTIVE_CONSUMER,{peerId:t,rtpReceiver:o,track:n})}}static formatSocketServiceMessage(r){var e,s,n,i,a,o;if(!r)return;const t=Wu(r.stageType);return{id:r.peerId,userId:r.userId,name:r.displayName,displayName:r.displayName,stageType:t,customParticipantId:r.customParticipantId,presetId:r.presetId,picture:r.displayPictureUrl,waitlisted:r.waitlisted,stageStatus:t,metadata:{preset_name:(e=r.flags)==null?void 0:e.presetName},recorderType:(s=r.flags)==null?void 0:s.recorderType,flags:{hiddenParticipant:(n=r.flags)==null?void 0:n.hiddenParticipant,hidden_participant:(i=r.flags)==null?void 0:i.hiddenParticipant,recorder:((a=r.flags)==null?void 0:a.recorderType)!==void 0&&((o=r.flags)==null?void 0:o.recorderType)!=="NONE"}}}mapPeerIdsToProducers(r,t){const e=(n,i)=>n.filter(({kind:a,screenShare:o})=>i.includes(a)||o&&i.includes("screenshare"));return r.flatMap(n=>{const i=this.participants.joined.get(n);if(i)return e(i.producers,t)}).filter(n=>!!n)}updateGrid(r,t){let e=[],s=[],n=[],i=[];return t.video&&([e,n]=t.video(this.participants.videoSubscribed,r)),t.audio&&([s,i]=t.audio(this.participants.audioSubscribed,r)),{video:{add:e,remove:n},audio:{add:s,remove:i}}}async onSelectedPeers(r,t){this.participants.viewMode==="ACTIVE_GRID"&&this.computeActivateParticipants(r,t)}updateActiveParticipantsWithPriorities(r,t=!1){if(!this.mediaJoined){u.warn("Skipped::ParticipantController::updateActiveParticipantsWithPriorities",{roomJoined:this.mediaJoined});return}r.forEach(s=>{this.selectedPeers.add(s.peerId,s.priority)});const e=this.selectedPeers.activeSpeakerPeers.at(0);e!==void 0&&e!==this.participants.lastActiveSpeaker&&(this.participants.lastActiveSpeaker=e,this.participants.emit("activeSpeaker",{peerId:e,volume:1})),t&&(this.participants.viewMode==="ACTIVE_GRID"?this.updateActive("ACTIVE_GRID"):this.participants.viewMode==="PAGINATED"&&this.updateActive("ACTIVE_GRID",{strategies:{audio:this.updateParticipantsMap.bind(this)}}))}};let Kr=Bv;hn([v.trace("ParticipantController.setupEvents")],Kr.prototype,"setupEvents",1),hn([v.trace("ParticipantController.setupEvents")],Kr.prototype,"setupEventsGlobal",1),hn([v.trace("ParticipantController.processMedia")],Kr.prototype,"processMedia",1),hn([v.trace("ParticipantController.processConsumerClosed")],Kr.prototype,"processConsumerClosed",1),hn([v.trace("ParticipantController.processConsumerResumed")],Kr.prototype,"processConsumerResumed",1),hn([v.trace("ParticipantController.processConsumerPaused")],Kr.prototype,"processConsumerPaused",1),hn([v.trace("ParticipantController.processNewConsumer")],Kr.prototype,"processNewConsumer",1);const Se=fr(Fl().permissions),Ki=class extends qt{constructor(e,s,n,i=!1){super();E(this,Mt);E(this,H,void 0);E(this,Wi,void 0);E(this,Ji,void 0);E(this,Ud,e=>{var l,p,h;const{chat:s,connectedMeetings:n,plugins:i,polls:a,media:o,...c}=e;if(s&&(s.private&&vs(d(this,H).chat.private,s.private),s.public&&vs(d(this,H).chat.public,s.public),this.emit("chatUpdate")),n&&vs(d(this,H).connectedMeetings,n),o){const f=_=>{switch(_){case Ts.NONE:return j.Allowed;case Ts.ALLOWED:return j.Allowed;case Ts.NOT_ALLOWED:return j.NotAllowed;case Ts.CAN_REQUEST:return j.CanRequest;default:return}},g={audio:void 0,video:void 0,screenshare:void 0};(l=o.audio)!=null&&l.canProduce&&(g.audio={canProduce:f(o.audio.canProduce)}),(p=o.video)!=null&&p.canProduce&&(g.video={canProduce:f(o.video.canProduce)}),(h=o.screenshare)!=null&&h.canProduce&&(g.screenshare={canProduce:f(o.screenshare.canProduce)}),vs(d(this,H).media,g)}i&&(vs(d(this,H).plugins,i),this.emit("pluginsUpdate")),a&&(vs(d(this,H).polls,a),this.emit("pollsUpdate")),Object.keys(c).length!==0&&vs(d(this,H),c),this.emit("permissionsUpdate",e)});if(!s)throw u.error("DytePermissionsPreset::load_preset_permissions_failed"),new I("Could not load preset permissions.","0904");y(this,Ji,e),y(this,Wi,n),y(this,H,s),i&&this.setupEvents()}setupEvents(){P.on(k.UPDATE_PERMISSIONS,d(this,Ud))}static fromResponse(e,s,n){return new Ki(n,e,s,!0)}static default(e,s){return new Ki(e,Se,s)}static init(e,s,n){let i;return n?i=new Ki(e,n,s,!0):i=new Ki(e,Se,s),i}get mediaRoomType(){const{sfu:e}=d(this,Ji).getValue("roomNodeOptions");return e===Zt.CF?"CF":"HIVE"}get stageEnabled(){var e;return((e=d(this,H))==null?void 0:e.stageEnabled)||d(this,Wi)===Ct.Webinar||d(this,Wi)===Ct.Livestream}get acceptStageRequests(){var e,s;return this.stageEnabled?((e=d(this,H))==null?void 0:e.acceptStageRequests)||((s=d(this,H))==null?void 0:s.canAcceptProductionRequests):!1}get stageAccess(){var e,s,n;return((e=d(this,H))==null?void 0:e.stageAccess)===j.NotAllowed?j.NotAllowed:((s=d(this,H))==null?void 0:s.stageAccess)===j.CanRequest?j.CanRequest:((n=d(this,H))==null?void 0:n.stageAccess)===j.Allowed||d(this,H).media.audio.canProduce===j.Allowed||d(this,H).media.video.canProduce===j.Allowed||d(this,H).media.screenshare.canProduce===j.Allowed?j.Allowed:d(this,H).media.audio.canProduce===j.CanRequest||d(this,H).media.video.canProduce===j.CanRequest||d(this,H).media.screenshare.canProduce===j.CanRequest?j.CanRequest:j.NotAllowed}get acceptWaitingRequests(){var e,s;return(s=(e=d(this,H))==null?void 0:e.acceptWaitingRequests)!=null?s:Se.acceptWaitingRequests}get requestProduceVideo(){var e,s,n;return((n=(s=(e=d(this,H))==null?void 0:e.media)==null?void 0:s.video)==null?void 0:n.canProduce)===j.CanRequest}get requestProduceAudio(){var e,s,n;return((n=(s=(e=d(this,H))==null?void 0:e.media)==null?void 0:s.audio)==null?void 0:n.canProduce)===j.CanRequest}get requestProduceScreenshare(){var e,s,n;return((n=(s=(e=d(this,H))==null?void 0:e.media)==null?void 0:s.screenshare)==null?void 0:n.canProduce)===j.CanRequest}get canAllowParticipantAudio(){var e,s;return(s=(e=d(this,H))==null?void 0:e.disableParticipantAudio)!=null?s:Se.disableParticipantAudio}get canAllowParticipantScreensharing(){var e,s;return(s=(e=d(this,H))==null?void 0:e.canAcceptProductionRequests)!=null?s:Se.canAcceptProductionRequests}get canAllowParticipantVideo(){var e,s;return(s=(e=d(this,H))==null?void 0:e.disableParticipantVideo)!=null?s:Se.disableParticipantVideo}get canDisableParticipantAudio(){return this.canAllowParticipantAudio}get canDisableParticipantVideo(){return this.canAllowParticipantVideo}get kickParticipant(){var e,s;return(s=(e=d(this,H))==null?void 0:e.kickParticipant)!=null?s:Se.kickParticipant}get pinParticipant(){var e,s;return(s=(e=d(this,H))==null?void 0:e.pinParticipant)!=null?s:Se.pinParticipant}get canRecord(){var e,s;return(s=(e=d(this,H))==null?void 0:e.canRecord)!=null?s:Se.canRecord}get waitingRoomType(){var e,s;return(s=(e=d(this,H))==null?void 0:e.waitingRoomType)!=null?s:Se.waitingRoomType}get waitingRoomBehaviour(){var e,s;return(s=(e=d(this,H))==null?void 0:e.waitingRoomType)!=null?s:Se.waitingRoomType}get plugins(){var e,s;return(s=(e=d(this,H))==null?void 0:e.plugins)!=null?s:Se.plugins}get polls(){var e,s;return(s=(e=d(this,H))==null?void 0:e.polls)!=null?s:Se.polls}get produceVideo(){return this.canProduceVideo}get requestProduce(){return d(this,H).media.audio.canProduce===j.CanRequest||d(this,H).media.video.canProduce===j.CanRequest||d(this,H).media.screenshare.canProduce===j.CanRequest}get canProduceVideo(){var s;const e=(s=d(this,H).media.video.canProduce)!=null?s:Se.media.video.canProduce;return this.stageEnabled&&(d(this,Mt,zt)==="ACCEPTED_TO_JOIN_STAGE"||d(this,Mt,zt)==="ON_STAGE")&&e===j.CanRequest?j.Allowed:this.stageEnabled&&(d(this,Mt,zt)==="OFF_STAGE"||d(this,Mt,zt)==="REQUESTED_TO_JOIN_STAGE")&&e===j.Allowed?j.NotAllowed:e}get produceScreenshare(){return this.canProduceScreenshare}get canProduceScreenshare(){var s;const e=(s=d(this,H).media.screenshare.canProduce)!=null?s:Se.media.screenshare.canProduce;return this.stageEnabled&&(d(this,Mt,zt)==="ACCEPTED_TO_JOIN_STAGE"||d(this,Mt,zt)==="ON_STAGE")&&e===j.CanRequest?j.Allowed:this.stageEnabled&&(d(this,Mt,zt)==="OFF_STAGE"||d(this,Mt,zt)==="REQUESTED_TO_JOIN_STAGE")&&e===j.Allowed?j.NotAllowed:e}get produceAudio(){return this.canProduceAudio}get canProduceAudio(){var s;const e=(s=d(this,H).media.audio.canProduce)!=null?s:Se.media.audio.canProduce;return this.stageEnabled&&(d(this,Mt,zt)==="ACCEPTED_TO_JOIN_STAGE"||d(this,Mt,zt)==="ON_STAGE")&&e===j.CanRequest?j.Allowed:this.stageEnabled&&(d(this,Mt,zt)==="OFF_STAGE"||d(this,Mt,zt)==="REQUESTED_TO_JOIN_STAGE")&&e===j.Allowed?j.NotAllowed:e}get chatPublic(){var e,s,n;return(n=(s=(e=d(this,H))==null?void 0:e.chat)==null?void 0:s.public)!=null?n:Se.chat.public}get chatPrivate(){var e,s,n;return(n=(s=(e=d(this,H))==null?void 0:e.chat)==null?void 0:s.private)!=null?n:Se.chat.private}get chatChannel(){var e,s,n;return(n=(s=(e=d(this,H))==null?void 0:e.chat)==null?void 0:s.channel)!=null?n:Se.chat.channel}get chatMessage(){var e,s,n;return(n=(s=(e=d(this,H))==null?void 0:e.chat)==null?void 0:s.message)!=null?n:Se.chat.message}get connectedMeetings(){var e,s;return(s=(e=d(this,H))==null?void 0:e.connectedMeetings)!=null?s:Se==null?void 0:Se.connectedMeetings}get hiddenParticipant(){var e,s;return(s=(e=d(this,H))==null?void 0:e.hiddenParticipant)!=null?s:Se.hiddenParticipant}get showParticipantList(){var e;return(e=d(this,H).showParticipantList)!=null?e:Se.showParticipantList}get canChangeParticipantRole(){var e,s;return(s=(e=d(this,H))==null?void 0:e.canChangeParticipantPermissions)!=null?s:Se.canChangeParticipantPermissions}get canChangeParticipantPermissions(){var e,s;return(s=(e=d(this,H))==null?void 0:e.canChangeParticipantPermissions)!=null?s:Se.canChangeParticipantPermissions}get canChangeTheme(){return!1}get canPresent(){return d(this,H).media.audio.canProduce===j.Allowed||d(this,H).media.video.canProduce===j.Allowed||d(this,H).media.screenshare.canProduce===j.Allowed}get acceptPresentRequests(){return this.acceptStageRequests}get canEditDisplayName(){var e;return(e=d(this,H).canEditDisplayName)!=null?e:!1}get maxScreenShareCount(){return 1}get isRecorder(){return d(this,H).isRecorder}get canSpotlight(){return d(this,H).canSpotlight}get canLivestream(){return d(this,H).canLivestream}get transcriptionEnabled(){return d(this,H).transcriptionEnabled}};let sh=Ki;H=new WeakMap,Wi=new WeakMap,Ji=new WeakMap,Ud=new WeakMap,Mt=new WeakSet,zt=function(){return d(this,Ji).getValue("stageStatus")};class HN extends qt{constructor(){super(...arguments);m(this,"localMediaHandler");E(this,wh,void 0)}async updatePermission(){var c,l;const e=(p,h)=>{this.mediaPermissions[p]=h;const f={message:this.mediaPermissions[p],kind:p};h==="DENIED"?P.emit(k.MEDIA_PERMISSION_ERROR,f):P.emit(k.MEDIA_PERMISSION_UPDATE,f)};if(Re.getName()==="firefox")return;const s="microphone",n="camera",i=await((c=navigator==null?void 0:navigator.permissions)==null?void 0:c.query({name:s})),a=await((l=navigator==null?void 0:navigator.permissions)==null?void 0:l.query({name:n})),o=(p,h)=>{switch(h){case"granted":e(p,"ACCEPTED");break;case"denied":e(p,"DENIED");break;case"prompt":e(p,"NOT_REQUESTED");break}this.localMediaHandler.repopulateAvailableDevices()};i&&(i.onchange=()=>o("audio",i.state)),a&&(a.onchange=()=>o("video",a.state))}async populateMediaPermissionsInCallstats({message:e,kind:s}){switch(s){case"audio":{q.mediaPermission("AUDIO",e),q.mediaPermission("SPEAKER",e);break}case"video":{q.mediaPermission("VIDEO",e);break}case"screenshare":{q.mediaPermission("SCREENSHARE",e);break}}}async init(e={},s=!1,n=null){var i,a,o,c,l,p;if(Re.init(),!this.localMediaHandler)try{let h=!0;if(n!=null&&n.getValue("defaults").mediaHandler)h=!1,this.localMediaHandler=n.getValue("defaults").mediaHandler.localMediaHandler;else if(navigator.RNLocalMediaHandlerImpl){const{RNLocalMediaHandlerImpl:f}=navigator;this.localMediaHandler=await f.init()}else this.localMediaHandler=new xt(n,e.constraints,(i=n==null?void 0:n.getValue("defaults"))==null?void 0:i.isNonPreferredDevice,(a=n==null?void 0:n.getValue("defaults"))==null?void 0:a.autoSwitchAudioDevice);if(P.on(k.MEDIA_PERMISSION_UPDATE,async f=>{if(this.populateMediaPermissionsInCallstats({message:f.message,kind:f.kind}),f.message==="NOT_REQUESTED")switch(f==null?void 0:f.kind){case"audio":this.rawAudioTrack&&(u.info("Disabling audio due to media permission update"),this.disableAudio());break;case"video":this.rawVideoTrack&&(u.info("Disabling video due to media permission update"),this.disableVideo());break;default:break}this.emit("mediaPermissionUpdate",f)}),P.on(k.MEDIA_PERMISSION_ERROR,async f=>{const{kind:g,message:_,constraints:w}=f;this.populateMediaPermissionsInCallstats({message:_,kind:g}),g==="audio"?(u.info(`Disabling audio due to media permission error  skipping: ${this.localMediaHandler.audioUpdateInProgress}`),this.localMediaHandler.audioUpdateInProgress===!1&&this.disableAudio()):g==="video"&&(u.info(`Disabling video due to media permission error skipping: ${this.localMediaHandler.videoUpdateInProgress}`),this.localMediaHandler.videoUpdateInProgress===!1&&this.disableVideo()),u.error("SelfController::mediaPermissionError",{error:{message:_},constraints:w,mediaPermissionsErrors:{kind:g,message:_}}),this.emit("mediaPermissionError",f),this.emit("mediaPermissionUpdate",{message:_,kind:g})}),h){u.info(`Setting up DyteSelfMedia streams using media handler. audio:${(o=e==null?void 0:e.audio)!=null?o:!0} video:${(c=e==null?void 0:e.video)!=null?c:!0}`);const f=this.localMediaHandler.setupStreams({video:(l=e==null?void 0:e.video)!=null?l:!0,audio:(p=e==null?void 0:e.audio)!=null?p:!0});s||await f}}catch(h){u.error("DyteSelf::init::Failed To Setup Streams",{error:{name:h.name,message:h.message}})}}get audioTrack(){return this.localMediaHandler.audioTrack}get rawAudioTrack(){return this.localMediaHandler.rawAudioTrack}get mediaPermissions(){return this.localMediaHandler.permissions}async addAudioMiddleware(e){return this.localMediaHandler.addAudioMiddleware(e)}async removeAudioMiddleware(e){return this.localMediaHandler.removeAudioMiddleware(e)}async removeAllAudioMiddlewares(){return this.localMediaHandler.removeAllAudioMiddlewares()}get videoTrack(){return this.localMediaHandler.videoTrack}get rawVideoTrack(){return this.localMediaHandler.rawVideoTrack}async addVideoMiddleware(e){return this.localMediaHandler.addVideoMiddleware(e)}async setVideoMiddlewareGlobalConfig(e={disablePerFrameCanvasRendering:!1}){return this.localMediaHandler.setVideoMiddlewareGlobalConfig(e)}async removeVideoMiddleware(e){return this.localMediaHandler.removeVideoMiddleware(e)}async removeAllVideoMiddlewares(){return this.localMediaHandler.removeAllVideoMiddlewares()}get screenShareTracks(){return this.localMediaHandler.screenShareTracks}get audioEnabled(){return this.localMediaHandler.audioEnabled}get videoEnabled(){return this.localMediaHandler.videoEnabled}get screenShareEnabled(){return this.localMediaHandler.screenShareEnabled}async enableAudio(){await this.localMediaHandler.enableAudio(),this.emit("audioUpdate",{audioEnabled:this.audioEnabled,audioTrack:this.audioTrack})}async enableVideo(){await this.localMediaHandler.enableVideo(),this.emit("videoUpdate",{videoEnabled:this.videoEnabled,videoTrack:this.videoTrack})}async disableAudio(){this.localMediaHandler.disableAudio(),this.emit("audioUpdate",{audioEnabled:this.audioEnabled,audioTrack:this.audioTrack})}async enableScreenShare(){await this.localMediaHandler.enableScreenShare(),this.emit("screenShareUpdate",{screenShareEnabled:this.screenShareEnabled,screenShareTracks:this.screenShareTracks})}async disableScreenShare(){await this.localMediaHandler.disableScreenShare(),this.emit("screenShareUpdate",{screenShareEnabled:this.screenShareEnabled,screenShareTracks:this.screenShareTracks})}async disableVideo(){await this.localMediaHandler.disableVideo(),this.emit("videoUpdate",{videoEnabled:this.videoEnabled,videoTrack:this.videoTrack})}getCurrentDevices(){return this.localMediaHandler.getCurrentDevices()}async getAudioDevices(){return await this.localMediaHandler.getAudioDevices()}async getVideoDevices(){return await this.localMediaHandler.getVideoDevices()}async getSpeakerDevices(){return await this.localMediaHandler.getSpeakerDevices()}getDeviceById(e,s){let n;return s==="audio"?n="audioinput":s==="video"?n="videoinput":s==="speaker"&&(n="audiooutput"),this.localMediaHandler.getDeviceById(e,n)}async setDevice(e){switch(e.kind){case"audioinput":try{await this.localMediaHandler.setAudioDevice(e)}catch(s){}finally{this.emit("audioUpdate",{audioEnabled:this.audioEnabled,audioTrack:this.audioTrack})}break;case"audiooutput":await this.localMediaHandler.setSpeakerDevice(e);break;case"videoinput":try{await this.localMediaHandler.setVideoDevice(e)}catch(s){}finally{this.emit("videoUpdate",{videoEnabled:this.videoEnabled,videoTrack:this.videoTrack})}break}this.emit("deviceUpdate",{device:e})}}wh=new WeakMap;const Ra={},_s={executeWithLock({methodName:r,lockName:t,timeout:e}){return(s,n,i)=>{const a=i.value;return i.value=function(...c){if(Ra[t]){const h=new Error(`Unsupported concurrent calls on Dyte method: ${r}.`);throw h.name="UnsupportedConcurrentMethodExecution",u.error("DyteLocker::UnsupportedConcurrentMethodExecution",{error:{stack:h.stack},dyteLocker:{methodName:r,lockName:t}}),h}Ra[t]=!0;const l=setTimeout(()=>delete Ra[t],e),p=a.apply(this,c);return Promise.resolve(p).then(()=>{delete Ra[t],clearTimeout(l)}).catch(()=>{delete Ra[t],clearTimeout(l)}),p},i}}};var qN=Object.defineProperty,jN=Object.getOwnPropertyDescriptor,It=(r,t,e,s)=>{for(var n=s>1?void 0:s?jN(t,e):t,i=r.length-1,a;i>=0;i--)(a=r[i])&&(n=(s?a(t,e,n):a(n))||n);return s&&n&&qN(t,e,n),n};let ot=(By=class extends HN{constructor(t,e,s,n,i){var a;super();E(this,Hs);E(this,st);E(this,ze);E(this,Xa);m(this,"name");m(this,"picture");m(this,"customParticipantId");m(this,"waitlistStatus");E(this,zi,void 0);E(this,Dt,void 0);E(this,Yi,void 0);m(this,"role");m(this,"userId");m(this,"organizationId");m(this,"supportsRemoteControl",!1);m(this,"device");E(this,Or,void 0);m(this,"hidden",!1);m(this,"presetName");m(this,"roomState","init");E(this,Qi,new Set);E(this,Xi,new Set);y(this,Or,t),this.userId=e.id,this.name=e.name,this.picture=e.picture,this.customParticipantId=(a=e.customParticipantId)!=null?a:e.clientSpecificId,this.waitlistStatus="none",y(this,Dt,s),y(this,zi,n),this.hidden=!1,y(this,Yi,!1),this.organizationId=e.organizationId,this.supportsRemoteControl=Re.isElectron(),this.device=Re.getDeviceInfo(),this.presetName=i,n.viewType!==Ct.Chat&&this.updatePermission(),this.updateVideo=this.updateVideo.bind(this),qe(this,Xa,Mh).call(this)}get stageStatus(){return d(this,Or).getValue("stageStatus")}get id(){return d(this,Or).getValue("peerId")}static async __init__(t,e,s,n,i,a=!1){var h,f,g,_,w;let o=(f=(h=t.getValue("defaults"))==null?void 0:h.audio)!=null?f:!0,c=(_=(g=t.getValue("defaults"))==null?void 0:g.video)!=null?_:!0;s.canProduceAudio!=="ALLOWED"&&(o=!1),s.canProduceVideo!=="ALLOWED"&&(c=!1);const l=new ot(t,e,s,n,i);if(n.viewType===Ct.Chat)return l;const p=ZO(n.mediaConstraints);return vs(p,(w=t.getValue("defaults"))==null?void 0:w.mediaConfiguration),await l.init({audio:o,video:c,constraints:p},a,t),l.setupEvents(),l}cleanupEvents(){this.removeAllListeners("videoUpdate"),this.localMediaHandler.removeAllListeners("AUDIO_TRACK_CHANGE"),this.localMediaHandler.removeAllListeners("VIDEO_TRACK_CHANGE"),this.localMediaHandler.removeAllListeners("DEVICE_CHANGE"),this.localMediaHandler.removeAllListeners("DEVICE_LIST_UPDATED"),this.localMediaHandler.removeAllListeners("SCREENSHARE_TRACK_CHANGE"),this.localMediaHandler.removeAllListeners("SCREENSHARE_ENDED"),this.localMediaHandler.removeAllListeners("AUDIO_TRACK_SILENT"),this.localMediaHandler.removeAllListeners("FORCE_MUTE_AUDIO"),this.localMediaHandler.removeAllListeners("FORCE_MUTE_VIDEO"),d(this,Dt).removeAllListeners("permissionsUpdate")}setupEvents(){this.on("videoUpdate",qe(this,Xa,Mh)),this.localMediaHandler.on("AUDIO_TRACK_CHANGE",async()=>{if(u.info("DyteSelf::setupEvents::AUDIO_TRACK_CHANGE",{...un(this)}),d(this,ze,it)&&this.audioEnabled)try{await d(this,st,pt).shareMic(this.audioTrack)}catch(t){u.error("DyteSelf::setupEvents::Error while sharing mic",{error:t}),this.localMediaHandler.disableAudio()}this.emit("audioUpdate",{audioEnabled:this.audioEnabled,audioTrack:this.audioTrack})}),this.localMediaHandler.on("VIDEO_TRACK_CHANGE",async()=>{if(u.info("DyteSelf::setupEvents::VIDEO_TRACK_CHANGE",{...un(this)}),d(this,ze,it)&&this.rawVideoTrack===void 0)u.info("DyteSelf::VIDEO_TRACK_CHANGE::Forcing_disable_video"),this.disableVideo();else if(this.videoEnabled&&d(this,ze,it))try{const t=await d(this,st,pt).shareWebcam(this.videoTrack);t&&t.id!==this.videoTrack.id&&J.hasFeature(Z.EXP_RESHARE)&&await d(this,st,pt).shareWebcam(this.videoTrack)}catch(t){u.error("DyteSelf::setupEvents::failed shareWebcam",{error:t}),this.videoEnabled&&await this.localMediaHandler.disableVideo()}this.emit("videoUpdate",{videoEnabled:this.videoEnabled,videoTrack:this.videoTrack})}),this.localMediaHandler.on("DEVICE_CHANGE",async({device:t})=>{this.emit("deviceUpdate",{device:t})}),this.localMediaHandler.on("DEVICE_LIST_UPDATED",t=>{this.emit("deviceListUpdate",t)}),this.localMediaHandler.on("SCREENSHARE_TRACK_CHANGE",async()=>{if(!d(this,ze,it)){u.error("DyteSelf.SCREENSHARE_TRACK_CHANGE.LocalMediaInitialized_WithoutRoomNode");return}if(this.screenShareEnabled)try{await d(this,st,pt).shareScreen(this.screenShareTracks)}catch(t){u.error("DyteSelf::setupEvents::Error while sharing screen",{error:t}),this.screenShareEnabled&&await this.localMediaHandler.disableScreenShare()}u.info("DyteSelf::setupEvents::SCREENSHARE_TRACK_CHANGE",{...un(this)}),this.emit("screenShareUpdate",{screenShareEnabled:this.screenShareEnabled,screenShareTracks:this.screenShareTracks})}),this.localMediaHandler.on("SCREENSHARE_ENDED",async()=>{u.log("Disabling screenshare due to SCREENSHARE_ENDED"),await this.disableScreenShare(),u.info("DyteSelf::setupEvents::SCREENSHARE_ENDED",{...un(this)})}),this.localMediaHandler.on("AUDIO_TRACK_SILENT",()=>{q.mediaTrackMuted("AUDIO")}),this.localMediaHandler.on("FORCE_MUTE_AUDIO",()=>{this.disableAudio()}),this.localMediaHandler.on("FORCE_MUTE_VIDEO",async()=>{d(this,ze,it)&&await d(this,st,pt).pauseWebcam(),this.emit("videoUpdate",{videoEnabled:this.videoEnabled,videoTrack:this.videoTrack}),q.videoOff()}),d(this,Dt).on("permissionsUpdate",t=>{var e,s,n;(e=t==null?void 0:t.media)!=null&&e.audio&&d(this,Dt).canProduceAudio!==j.Allowed&&(this.disableAudio(),u.info(`Disabled audio due to dynamic preset change: canProduceAudio: ${this.permissions.canProduceAudio}`)),(s=t==null?void 0:t.media)!=null&&s.video&&d(this,Dt).canProduceVideo!==j.Allowed&&(this.disableVideo(),u.info(`Disabled video due to dynamic preset change: canProduceVideo: ${this.permissions.canProduceVideo}`)),(n=t==null?void 0:t.media)!=null&&n.screenshare&&d(this,Dt).canProduceScreenshare!==j.Allowed&&(this.disableScreenShare(),u.info(`Disabled screenshare due to dynamic preset change: canProduceScreenshare: ${this.permissions.canProduceScreenshare}`))})}get permissions(){return d(this,Dt)}get config(){return d(this,zi)}get roomJoined(){var t;return d(this,zi).viewType===Ct.Livestream&&this.stageStatus!=="ON_STAGE"?((t=d(this,Or).getValue("connectionHandler"))==null?void 0:t.socketJoined)===!0:d(this,ze,it)}setName(t){if(!t)throw new I("Name cannot be empty.","1103");this.name=t}async setupTracks(t={}){t.forceReset,await this.disableAudio(),await this.disableVideo(),this.localMediaHandler.removeAudioTrack(),this.localMediaHandler.removeVideoTrack(),t.audio&&await this.enableAudio(),t.video&&await this.enableVideo()}async destructMediaHandler(){return this.localMediaHandler.destruct()}async removeDocumentEventListeners(){return this.localMediaHandler.removeDocumentEventListeners()}async enableAudio(){if(this.permissions.canProduceAudio!==j.NotAllowed&&!(d(this,Dt).canProduceAudio===j.CanRequest&&(this.stageStatus==="OFF_STAGE"||this.stageStatus==="REQUESTED_TO_JOIN_STAGE"))&&!this.audioEnabled){if(q.audioOn(),await this.localMediaHandler.enableAudio(),d(this,ze,it)&&this.stageStatus==="ON_STAGE"){if(this.audioTrack)try{await d(this,st,pt).shareMic(this.audioTrack)}catch(t){u.error("DyteSelf::enableAudio::Error while sharing mic",{error:t}),this.localMediaHandler.disableAudio()}if(!this.audioEnabled)return;d(this,st,pt).unmuteSelf()}this.emit("audioUpdate",{audioEnabled:this.audioEnabled,audioTrack:this.audioTrack})}}async enableVideo(){if(d(this,Dt).canProduceVideo!==j.NotAllowed&&!(d(this,Dt).canProduceVideo===j.CanRequest&&(this.stageStatus==="OFF_STAGE"||this.stageStatus==="REQUESTED_TO_JOIN_STAGE"))&&!this.videoEnabled){if(q.videoOn(),await this.localMediaHandler.enableVideo(),d(this,ze,it)&&this.stageStatus==="ON_STAGE")try{await d(this,st,pt).shareWebcam(this.videoTrack)}catch(t){u.error("DyteSelf::enableVideo::Error while sharing video",{error:t}),this.videoEnabled&&this.localMediaHandler.disableVideo()}this.emit("videoUpdate",{videoEnabled:this.videoEnabled,videoTrack:this.videoTrack}),u.info("DyteSelf.enableVideo",{...un(this)})}}async updateVideoConstraints(t){if(!this.localMediaHandler.updateVideoConstraints)throw new I("Unsupported","1102");await this.localMediaHandler.updateVideoConstraints(t)}async enableScreenShare(){if(!d(this,ze,it))throw new I("Can`t enable screenshare without joining room","1105");if(d(this,Dt).canProduceScreenshare!==j.NotAllowed&&!(d(this,Dt).canProduceScreenshare===j.CanRequest&&(this.stageStatus==="OFF_STAGE"||this.stageStatus==="REQUESTED_TO_JOIN_STAGE"))&&!this.screenShareEnabled&&(await this.localMediaHandler.enableScreenShare(),this.screenShareTracks.audio||this.screenShareTracks.video)){try{await d(this,st,pt).shareScreen(this.screenShareTracks)}catch(t){u.error("DyteSelf::enableScreenShare::Error while sharing screen",{error:t}),this.screenShareEnabled&&await this.localMediaHandler.disableScreenShare()}this.emit("screenShareUpdate",{screenShareEnabled:this.screenShareEnabled,screenShareTracks:this.screenShareTracks})}}async updateScreenshareConstraints(t){if(!this.localMediaHandler.updateScreenshareConstraints)throw new I("Unsupported","1102");await this.localMediaHandler.updateScreenshareConstraints(t)}async disableAudio(){this.audioEnabled&&(this.localMediaHandler.disableAudio(),d(this,ze,it)&&d(this,st,pt).muteSelf(),this.emit("audioUpdate",{audioEnabled:this.audioEnabled,audioTrack:this.audioTrack}),q.audioOff())}async disableVideo(){this.videoEnabled&&(await this.localMediaHandler.disableVideo(),d(this,ze,it)&&await d(this,st,pt).pauseWebcam(),this.emit("videoUpdate",{videoEnabled:this.videoEnabled,videoTrack:this.videoTrack}),q.videoOff())}async disableScreenShare(){this.screenShareEnabled&&(await this.localMediaHandler.disableScreenShare(),d(this,ze,it)&&await d(this,st,pt).disableScreenShare(),this.emit("screenShareUpdate",{screenShareEnabled:this.screenShareEnabled,screenShareTracks:this.screenShareTracks}))}getAllDevices(){return this.localMediaHandler.getAllDevices()}setIsPinned(t,e=!0){var n;y(this,Yi,t);const s=t?"pinned":"unpinned";(n=d(this,Hs,sa))==null||n.updateSource(this.id,{pinned:t}),e&&this.emit(s,this)}get isPinned(){return d(this,Yi)}async pin(){if(!d(this,ze,it))throw new I("Can`t pin participants without joining room","1105");return this.show(),d(this,st,pt).pinPeer(this.id)}async unpin(){if(!d(this,ze,it))throw new I("Can`t unpin participants without joining room","1105");return d(this,st,pt).pinPeer(null)}async hide(){if(!d(this,ze,it))throw new I("Can`t toggle participant tile without joining room","1105");this.hidden=!0,this.emit("toggleTile",{hidden:this.hidden})}show(){if(!d(this,ze,it))throw new I("Can`t toggle participant tile without joining room","1105");this.hidden=!1,this.emit("toggleTile",{hidden:this.hidden})}async setDevice(t){var s,n,i;if(!t)throw new I("No device selected","1104");const e=this.getCurrentDevices();if(t.deviceId&&(((s=e==null?void 0:e.audio)==null?void 0:s.deviceId)===t.deviceId||((n=e==null?void 0:e.video)==null?void 0:n.deviceId)===t.deviceId||((i=e==null?void 0:e.speaker)==null?void 0:i.deviceId)===t.deviceId)&&(u.warn("DyteSelf.setDevice.setting_to_in_use_device",{devices:[t]}),J.hasFeature(Z.SKIP_SETTING_IN_USE_DEVICE)))throw new I("Cannot set device currently in use","1106");switch(t.kind){case"audioinput":try{await this.localMediaHandler.setAudioDevice(t)}catch(a){d(this,ze,it)&&await d(this,st,pt).muteSelf(),this.emit("audioUpdate",{audioEnabled:this.audioEnabled,audioTrack:this.audioTrack})}break;case"audiooutput":await this.localMediaHandler.setSpeakerDevice(t);break;case"videoinput":try{await this.localMediaHandler.setVideoDevice(t)}catch(a){d(this,ze,it)&&await d(this,st,pt).pauseWebcam(),this.emit("videoUpdate",{videoEnabled:this.videoEnabled,videoTrack:this.videoTrack})}break}}cleanUpTracks(){var t,e,s,n;(t=this.audioTrack)==null||t.stop(),(e=this.rawAudioTrack)==null||e.stop(),(s=this.videoTrack)==null||s.stop(),(n=this.rawVideoTrack)==null||n.stop()}registerVideoElement(t,e=!1){var s,n;e?d(this,Qi).add(t):d(this,Xi).add(t),this.updateVideo(t),e||(n=d(this,Hs,sa))==null||n.addSource(this.id,t,this.videoEnabled,this.isPinned,this.name,this.picture,(s=this.raised)!=null?s:!1)}deregisterVideoElement(t,e=!1){t.srcObject=void 0,e?d(this,Qi).delete(t):(d(this,Xi).delete(t),d(this,Hs,sa).removeSource(this.id))}updateVideo(t,e=!1){var s,n,i;if(this.videoEnabled){if(this.videoTrack==null)return;const a=(s=t.srcObject)==null?void 0:s.getTracks()[0];if((a==null?void 0:a.id)===this.videoTrack.id)return;const o=new MediaStream;o.addTrack(this.videoTrack),t.srcObject=o,e||(n=d(this,Hs,sa))==null||n.enableSource(this.id)}else t.srcObject=void 0,e||(i=d(this,Hs,sa))==null||i.disableSource(this.id);t.style.display=this.videoEnabled?"block":"none"}},zi=new WeakMap,Dt=new WeakMap,Yi=new WeakMap,Or=new WeakMap,Hs=new WeakSet,sa=function(){return d(this,Or).getValue("pip")},st=new WeakSet,pt=function(){return d(this,Or).getValue("roomNodeClient")},ze=new WeakSet,it=function(){var t;return((t=d(this,Or).getValue("connectionHandler"))==null?void 0:t.mediaJoined)===!0},Qi=new WeakMap,Xi=new WeakMap,Xa=new WeakSet,Mh=function(){Array.from(d(this,Xi)).forEach(t=>this.updateVideo(t,!1)),Array.from(d(this,Qi)).forEach(t=>this.updateVideo(t,!0))},By);It([v.trace("DyteSelf.cleanupEvents")],ot.prototype,"cleanupEvents",1),It([v.trace("DyteSelf.setupEvents")],ot.prototype,"setupEvents",1),It([v.trace("DyteSelf.setupTracks")],ot.prototype,"setupTracks",1),It([v.trace("DyteSelf.destructMediaHandler")],ot.prototype,"destructMediaHandler",1),It([v.trace("DyteSelf.removeDocumentEventListeners")],ot.prototype,"removeDocumentEventListeners",1),It([_s.executeWithLock({methodName:"meeting.self.enableAudio",lockName:"DyteSelf.toggleAudio",timeout:3e3}),v.trace("DyteSelf.enableAudio")],ot.prototype,"enableAudio",1),It([_s.executeWithLock({methodName:"meeting.self.enableVideo",lockName:"DyteSelf.toggleVideo",timeout:3e3}),v.trace("DyteSelf.enableVideo")],ot.prototype,"enableVideo",1),It([v.trace("DyteSelf.updateVideoConstraints")],ot.prototype,"updateVideoConstraints",1),It([v.trace("DyteSelf.enableScreenShare"),_s.executeWithLock({methodName:"meeting.self.enableScreenShare",lockName:"DyteSelf.toggleScreenShare",timeout:3e3})],ot.prototype,"enableScreenShare",1),It([v.trace("DyteSelf.updateScreenshareConstraints")],ot.prototype,"updateScreenshareConstraints",1),It([_s.executeWithLock({methodName:"meeting.self.disableAudio",lockName:"DyteSelf.toggleAudio",timeout:3e3}),v.trace("DyteSelf.disableAudio")],ot.prototype,"disableAudio",1),It([_s.executeWithLock({methodName:"meeting.self.disableVideo",lockName:"DyteSelf.toggleVideo",timeout:3e3}),v.trace("DyteSelf.disableVideo")],ot.prototype,"disableVideo",1),It([_s.executeWithLock({methodName:"meeting.self.disableScreenShare",lockName:"DyteSelf.toggleScreenShare",timeout:3e3}),v.trace("DyteSelf.disableScreenShare")],ot.prototype,"disableScreenShare",1),It([v.trace("DyteSelf.setDevice")],ot.prototype,"setDevice",1),ot=It([mt("1100")],ot);var pn={},sd={},nd={},GN={get exports(){return nd},set exports(r){nd=r}},nh,Hv;function WN(){if(Hv)return nh;Hv=1;var r=1e3,t=r*60,e=t*60,s=e*24,n=s*7,i=s*365.25;nh=function(p,h){h=h||{};var f=typeof p;if(f==="string"&&p.length>0)return a(p);if(f==="number"&&isFinite(p))return h.long?c(p):o(p);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(p))};function a(p){if(p=String(p),!(p.length>100)){var h=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(p);if(h){var f=parseFloat(h[1]),g=(h[2]||"ms").toLowerCase();switch(g){case"years":case"year":case"yrs":case"yr":case"y":return f*i;case"weeks":case"week":case"w":return f*n;case"days":case"day":case"d":return f*s;case"hours":case"hour":case"hrs":case"hr":case"h":return f*e;case"minutes":case"minute":case"mins":case"min":case"m":return f*t;case"seconds":case"second":case"secs":case"sec":case"s":return f*r;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return f;default:return}}}}function o(p){var h=Math.abs(p);return h>=s?Math.round(p/s)+"d":h>=e?Math.round(p/e)+"h":h>=t?Math.round(p/t)+"m":h>=r?Math.round(p/r)+"s":p+"ms"}function c(p){var h=Math.abs(p);return h>=s?l(p,h,s,"day"):h>=e?l(p,h,e,"hour"):h>=t?l(p,h,t,"minute"):h>=r?l(p,h,r,"second"):p+" ms"}function l(p,h,f,g){var _=h>=f*1.5;return Math.round(p/f)+" "+g+(_?"s":"")}return nh}function JN(r){e.debug=e,e.default=e,e.coerce=c,e.disable=i,e.enable=n,e.enabled=a,e.humanize=WN(),e.destroy=l,Object.keys(r).forEach(p=>{e[p]=r[p]}),e.names=[],e.skips=[],e.formatters={};function t(p){let h=0;for(let f=0;f<p.length;f++)h=(h<<5)-h+p.charCodeAt(f),h|=0;return e.colors[Math.abs(h)%e.colors.length]}e.selectColor=t;function e(p){let h,f=null,g,_;function w(...R){if(!w.enabled)return;const D=w,x=Number(new Date),B=x-(h||x);D.diff=B,D.prev=h,D.curr=x,h=x,R[0]=e.coerce(R[0]),typeof R[0]!="string"&&R.unshift("%O");let b=0;R[0]=R[0].replace(/%([a-zA-Z%])/g,(te,ce)=>{if(te==="%%")return"%";b++;const he=e.formatters[ce];if(typeof he=="function"){const Ne=R[b];te=he.call(D,Ne),R.splice(b,1),b--}return te}),e.formatArgs.call(D,R),(D.log||e.log).apply(D,R)}return w.namespace=p,w.useColors=e.useColors(),w.color=e.selectColor(p),w.extend=s,w.destroy=e.destroy,Object.defineProperty(w,"enabled",{enumerable:!0,configurable:!1,get:()=>f!==null?f:(g!==e.namespaces&&(g=e.namespaces,_=e.enabled(p)),_),set:R=>{f=R}}),typeof e.init=="function"&&e.init(w),w}function s(p,h){const f=e(this.namespace+(typeof h=="undefined"?":":h)+p);return f.log=this.log,f}function n(p){e.save(p),e.namespaces=p,e.names=[],e.skips=[];let h;const f=(typeof p=="string"?p:"").split(/[\s,]+/),g=f.length;for(h=0;h<g;h++)f[h]&&(p=f[h].replace(/\*/g,".*?"),p[0]==="-"?e.skips.push(new RegExp("^"+p.slice(1)+"$")):e.names.push(new RegExp("^"+p+"$")))}function i(){const p=[...e.names.map(o),...e.skips.map(o).map(h=>"-"+h)].join(",");return e.enable(""),p}function a(p){if(p[p.length-1]==="*")return!0;let h,f;for(h=0,f=e.skips.length;h<f;h++)if(e.skips[h].test(p))return!1;for(h=0,f=e.names.length;h<f;h++)if(e.names[h].test(p))return!0;return!1}function o(p){return p.toString().substring(2,p.toString().length-2).replace(/\.\*\?$/,"*")}function c(p){return p instanceof Error?p.stack||p.message:p}function l(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return e.enable(e.load()),e}var KN=JN;(function(r,t){t.formatArgs=s,t.save=n,t.load=i,t.useColors=e,t.storage=a(),t.destroy=(()=>{let c=!1;return()=>{c||(c=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function e(){return typeof window!="undefined"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document!="undefined"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window!="undefined"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function s(c){if(c[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+c[0]+(this.useColors?"%c ":" ")+"+"+r.exports.humanize(this.diff),!this.useColors)return;const l="color: "+this.color;c.splice(1,0,l,"color: inherit");let p=0,h=0;c[0].replace(/%[a-zA-Z%]/g,f=>{f!=="%%"&&(p++,f==="%c"&&(h=p))}),c.splice(h,0,l)}t.log=console.debug||console.log||(()=>{});function n(c){try{c?t.storage.setItem("debug",c):t.storage.removeItem("debug")}catch(l){}}function i(){let c;try{c=t.storage.getItem("debug")}catch(l){}return!c&&typeof process!="undefined"&&"env"in process&&(c=process.env.DEBUG),c}function a(){try{return localStorage}catch(c){}}r.exports=KN(t);const{formatters:o}=r.exports;o.j=function(c){try{return JSON.stringify(c)}catch(l){return"[UnexpectedJSONParseError]: "+l.message}}})(GN,nd);var zN=Me&&Me.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(sd,"__esModule",{value:!0}),sd.Logger=void 0;const hi=zN(nd),pi="awaitqueue";class YN{constructor(t){t?(this._debug=(0,hi.default)(`${pi}:${t}`),this._warn=(0,hi.default)(`${pi}:WARN:${t}`),this._error=(0,hi.default)(`${pi}:ERROR:${t}`)):(this._debug=(0,hi.default)(pi),this._warn=(0,hi.default)(`${pi}:WARN`),this._error=(0,hi.default)(`${pi}:ERROR`)),this._debug.log=console.info.bind(console),this._warn.log=console.warn.bind(console),this._error.log=console.error.bind(console)}get debug(){return this._debug}get warn(){return this._warn}get error(){return this._error}}sd.Logger=YN,Object.defineProperty(pn,"__esModule",{value:!0});var id=pn.AwaitQueue=pn.AwaitQueueRemovedTaskError=pn.AwaitQueueStoppedError=void 0;const QN=sd,ws=new QN.Logger;class ih extends Error{constructor(t){super(t!=null?t:"AwaitQueue stopped"),this.name="AwaitQueueStoppedError",typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,ih)}}pn.AwaitQueueStoppedError=ih;class ad extends Error{constructor(t){super(t!=null?t:"AwaitQueue task removed"),this.name="AwaitQueueRemovedTaskError",typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,ad)}}pn.AwaitQueueRemovedTaskError=ad;class XN{constructor(){this.pendingTasks=new Map,this.nextTaskId=0,this.stopping=!1}get size(){return this.pendingTasks.size}async push(t,e){if(e=e!=null?e:t.name,ws.debug(`push() [name:${e}]`),typeof t!="function")throw new TypeError("given task is not a function");if(e)try{Object.defineProperty(t,"name",{value:e})}catch(s){}return new Promise((s,n)=>{const i={id:this.nextTaskId++,task:t,name:e,enqueuedAt:Date.now(),executedAt:void 0,completed:!1,resolve:a=>{if(i.completed)return;i.completed=!0,this.pendingTasks.delete(i.id),ws.debug(`resolving task [name:${i.name}]`),s(a);const[o]=this.pendingTasks.values();o&&!o.executedAt&&this.execute(o)},reject:a=>{if(!i.completed&&(i.completed=!0,this.pendingTasks.delete(i.id),ws.debug(`rejecting task [name:${i.name}]: %s`,String(a)),n(a),!this.stopping)){const[o]=this.pendingTasks.values();o&&!o.executedAt&&this.execute(o)}}};this.pendingTasks.set(i.id,i),this.pendingTasks.size===1&&this.execute(i)})}stop(){ws.debug("stop()"),this.stopping=!0;for(const t of this.pendingTasks.values())ws.debug(`stop() | stopping task [name:${t.name}]`);this.stopping=!1}remove(t){ws.debug(`remove() [taskIdx:${t}]`);const e=Array.from(this.pendingTasks.values())[t];if(!e){ws.debug(`stop() | no task with given idx [taskIdx:${t}]`);return}e.reject(new ad)}dump(){const t=Date.now();let e=0;return Array.from(this.pendingTasks.values()).map(s=>({idx:e++,task:s.task,name:s.name,enqueuedTime:s.executedAt?s.executedAt-s.enqueuedAt:t-s.enqueuedAt,executionTime:s.executedAt?t-s.executedAt:0}))}async execute(t){if(ws.debug(`execute() [name:${t.name}]`),t.executedAt)throw new Error("task already being executed");t.executedAt=Date.now();try{const e=await t.task();t.resolve(e)}catch(e){t.reject(e)}}}id=pn.AwaitQueue=XN;var qv={},od={},ZN={get exports(){return od},set exports(r){od=r}},jv=ZN.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(r){return r.encoding?"rtpmap:%d %s/%s/%s":r.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(r){return r.address!=null?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(r){return r.subtype!=null?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(r){return"extmap:%d"+(r.direction?"/%s":"%v")+(r["encrypt-uri"]?" %s":"%v")+" %s"+(r.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(r){return r.sessionConfig!=null?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(r){var t="candidate:%s %d %s %d %s %d typ %s";return t+=r.raddr!=null?" raddr %s rport %d":"%v%v",t+=r.tcptype!=null?" tcptype %s":"%v",r.generation!=null&&(t+=" generation %d"),t+=r["network-id"]!=null?" network-id %d":"%v",t+=r["network-cost"]!=null?" network-cost %d":"%v",t}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(r){var t="ssrc:%d";return r.attribute!=null&&(t+=" %s",r.value!=null&&(t+=":%s")),t}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(r){return r.maxMessageSize!=null?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(r){return r.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(r){return"imageattr:%s %s %s"+(r.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(r){return"simulcast:%s %s"+(r.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(r){return"ts-refclk:%s"+(r.clksrcExt!=null?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(r){var t="mediaclk:";return t+=r.id!=null?"id=%s %s":"%v%s",t+=r.mediaClockValue!=null?"=%s":"",t+=r.rateNumerator!=null?" rate=%s":"",t+=r.rateDenominator!=null?"/%s":"",t}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};Object.keys(jv).forEach(function(r){var t=jv[r];t.forEach(function(e){e.reg||(e.reg=/(.*)/),e.format||(e.format="%s")})}),function(r){var t=function(o){return String(Number(o))===o?Number(o):o},e=function(o,c,l,p){if(p&&!l)c[p]=t(o[1]);else for(var h=0;h<l.length;h+=1)o[h+1]!=null&&(c[l[h]]=t(o[h+1]))},s=function(o,c,l){var p=o.name&&o.names;o.push&&!c[o.push]?c[o.push]=[]:p&&!c[o.name]&&(c[o.name]={});var h=o.push?{}:p?c[o.name]:c;e(l.match(o.reg),h,o.names,o.name),o.push&&c[o.push].push(h)},n=od,i=RegExp.prototype.test.bind(/^([a-z])=(.*)/);r.parse=function(o){var c={},l=[],p=c;return o.split(/(\r\n|\r|\n)/).filter(i).forEach(function(h){var f=h[0],g=h.slice(2);f==="m"&&(l.push({rtp:[],fmtp:[]}),p=l[l.length-1]);for(var _=0;_<(n[f]||[]).length;_+=1){var w=n[f][_];if(w.reg.test(g))return s(w,p,g)}}),c.media=l,c};var a=function(o,c){var l=c.split(/=(.+)/,2);return l.length===2?o[l[0]]=t(l[1]):l.length===1&&c.length>1&&(o[l[0]]=void 0),o};r.parseParams=function(o){return o.split(/;\s?/).reduce(a,{})},r.parseFmtpConfig=r.parseParams,r.parsePayloads=function(o){return o.toString().split(" ").map(Number)},r.parseRemoteCandidates=function(o){for(var c=[],l=o.split(" ").map(t),p=0;p<l.length;p+=3)c.push({component:l[p],ip:l[p+1],port:l[p+2]});return c},r.parseImageAttributes=function(o){return o.split(" ").map(function(c){return c.substring(1,c.length-1).split(",").reduce(a,{})})},r.parseSimulcastStreamList=function(o){return o.split(";").map(function(c){return c.split(",").map(function(l){var p,h=!1;return l[0]!=="~"?p=t(l):(p=t(l.substring(1,l.length)),h=!0),{scid:p,paused:h}})})}}(qv);var ah=od,e1=/%[sdv%]/g,t1=function(r){var t=1,e=arguments,s=e.length;return r.replace(e1,function(n){if(t>=s)return n;var i=e[t];switch(t+=1,n){case"%%":return"%";case"%s":return String(i);case"%d":return Number(i);case"%v":return""}})},Pa=function(r,t,e){var s=t.format instanceof Function?t.format(t.push?e:e[t.name]):t.format,n=[r+"="+s];if(t.names)for(var i=0;i<t.names.length;i+=1){var a=t.names[i];t.name?n.push(e[t.name][a]):n.push(e[t.names[i]])}else n.push(e[t.name]);return t1.apply(null,n)},r1=["v","o","s","i","u","e","p","c","b","t","r","z","a"],s1=["i","c","b","a"],n1=function(r,t){t=t||{},r.version==null&&(r.version=0),r.name==null&&(r.name=" "),r.media.forEach(function(i){i.payloads==null&&(i.payloads="")});var e=t.outerOrder||r1,s=t.innerOrder||s1,n=[];return e.forEach(function(i){ah[i].forEach(function(a){a.name in r&&r[a.name]!=null?n.push(Pa(i,a,r)):a.push in r&&r[a.push]!=null&&r[a.push].forEach(function(o){n.push(Pa(i,a,o))})})}),r.media.forEach(function(i){n.push(Pa("m",ah.m[0],i)),s.forEach(function(a){ah[a].forEach(function(o){o.name in i&&i[o.name]!=null?n.push(Pa(a,o,i)):o.push in i&&i[o.push]!=null&&i[o.push].forEach(function(c){n.push(Pa(a,o,c))})})})}),n.join(`\r
`)+`\r
`},mn=qv,i1=n1,Gv=i1,cd=mn.parse;mn.parseParams,mn.parseFmtpConfig,mn.parsePayloads,mn.parseRemoteCandidates,mn.parseImageAttributes,mn.parseSimulcastStreamList;var zr=(r=>(r.INITIALIZING="INITIALIZING",r.INITIALIZED="INITIALIZED",r.NOT_INITIALIZED="NOT_INITIALIZED",r))(zr||{});class Wv extends ne.EventEmitter{}class fn extends ne.EventEmitter{constructor(){super(),this.setMaxListeners(1/0)}safeEmit(t,...e){const s=this.listenerCount(t);try{return this.emit(t,...e)}catch(n){return u.error(`EnhancedEventEmitter:: safeEmit() | event listener ${t} threw an error`,{error:n}),Boolean(s)}}async safeEmitAsPromise(t,...e){const s={}.EVENT_PROMISE_TIMEOUT?parseInt({}.EVENT_PROMISE_TIMEOUT,10):1e4;return this.safeEmitAsPromiseWithTimeout(t,s,...e)}async safeEmitAsPromiseWithTimeout(t,e,...s){return new Promise((n,i)=>{setTimeout(i,e,"event request timeout");try{this.emit(t.toString(),...s,n,i)}catch(a){u.error(`EnhancedEventEmitter:: safeEmitAsPromise() | event listener for event ${t.toString()} threw an error [event:%s]:%o`,{error:a}),i(a)}})}}class oh extends fn{constructor(){super();m(this,"_mapMidTransceiver",new Map);m(this,"_enableHighBitrate",!1);m(this,"_enableStereo",!1);this._mapMidTransceiver=new Map,this._enableHighBitrate=!1}get midTransceiverMap(){return this._mapMidTransceiver}}class ch extends oh{constructor(){super();m(this,"_direction");m(this,"_pc");m(this,"_sendWebStream",new MediaStream);m(this,"_sendScreenShareStream",new MediaStream);m(this,"_transportReady",!1)}static createFactory(){return()=>new ch}get name(){return"Chrome74"}get pc(){return this._pc}close(){if(u.debug("close()"),this._pc)try{this._pc.close()}catch(e){u.error("pc.close()",e)}}init({direction:e,iceServers:s,iceTransportPolicy:n,additionalSettings:i,proprietaryConstraints:a,onTrackHandler:o}){this._direction=e,this._pc=new RTCPeerConnection({iceServers:s||[],iceTransportPolicy:n||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan",...i},a),o&&this._pc.addEventListener("track",c=>{o(c)}),this._addEventListeners()}async connect(){const e=this._pc.createDataChannel("dyte"),s=await this._pc.createOffer();return await this._pc.setLocalDescription(s),u.info(`connect offer: ${JSON.stringify(s)}`),{offerSdp:s,callback:async i=>{u.debug(`Chrome74::connect() | calling pc.setRemoteDescription() [answer:${JSON.stringify(i)}]`),await this._pc.setRemoteDescription(i),e.close()}}}async updateIceServers(e){u.debug("updateIceServers()");const s=this._pc.getConfiguration();s.iceServers=e,this._pc.setConfiguration(s)}async restartIce(){u.debug("restartIce()");const e=await this.pc.createOffer({iceRestart:!0});return u.debug(`restartIce() | calling pc.setLocalDescription() [offer:${JSON.stringify(e)}]`),{offerSdp:e,callback:async n=>{u.info(`restartIce() | calling pc.setRemoteDescription() [answer:${JSON.stringify(n)}]`),await this._pc.setRemoteDescription(n)}}}async getTransportStats(){return this._pc.getStats()}async send({track:e,encodings:s,codecOptions:n,screenShare:i}){this._assertSendDirection(),u.debug(`send() [kind:${e.kind}, track.id:${e.id}]`);const a=this._pc.addTransceiver(e,{direction:"sendonly",streams:[i?this._sendScreenShareStream:this._sendWebStream],sendEncodings:s});if(!navigator.isReactNative){u.debug("creating new transceiver");const l=RTCRtpSender.getCapabilities(e.kind);u.info(`senders available params: ${JSON.stringify(l)}`);const p=[];n&&n.length&&n.forEach(h=>{var g;const f=l.codecs.find(_=>_.mimeType.includes(h.name));if(h.parameters){u.debug(`codecOption.parameters:${JSON.stringify(h.parameters)}`);const _=((g=f.sdpFmtpLine)==null?void 0:g.split(";"))||[];_.push(...h.parameters);const w=Array.from(new Set(_).values());f.sdpFmtpLine=w.join(";")}p.push(f)}),u.info(`selected codecs: ${JSON.stringify(p)}`),a.setCodecPreferences(p)}const o=await this._pc.createOffer();if(!this._transportReady)throw new Error("webrtc transport not connected");if(await this._pc.setLocalDescription(o),n&&n.findIndex(({name:l})=>l==="opus")>=0){const l=this._enableStereo,p=this._enableHighBitrate?l?128e3:64e3:l?64e3:32e3;o.sdp=o.sdp.replace("minptime=10;useinbandfec=1",`minptime=10;useinbandfec=1;usedtx=1${l?"":";stereo=1;sprop-stereo=1"};maxaveragebitrate=${p}`),o.sdp+=`a=rtcp-fb:111 nack\r
`}const c=async l=>(u.debug(`send() | calling pc.setRemoteDescription() [answer:${JSON.stringify(l)}]`),await this._pc.setRemoteDescription(l),this.midTransceiverMap.set(a.mid,a),a.mid);return u.debug(`send() | calling pc.setLocalDescription() [offer: ${JSON.stringify(o,void 0,2)}]`),{offerSdp:o,callback:c,sender:a.sender,mid:a.mid}}async stopSending(e){this._assertSendDirection(),u.debug(`stopSending() [localId:${e}]`);const s=this.midTransceiverMap.get(e);if(!s)throw new Error("associated RTCRtpTransceiver not found");s.sender.replaceTrack(null),this._pc.removeTrack(s.sender),s.direction="inactive";const n=await this._pc.createOffer();return u.debug(`stopSending() | calling pc.setLocalDescription() [offer:${JSON.stringify(n)}]`),await this._pc.setLocalDescription(n),{offerSdp:n,callback:async a=>{u.debug(`stopSending() | calling pc.setRemoteDescription() [answer:${JSON.stringify(a)}]`),await this._pc.setRemoteDescription(a),this.midTransceiverMap.delete(e)}}}async replaceTrack(e,s){this._assertSendDirection(),s?u.debug(`replaceTrack() [localId:${e}, track.id:${s.id}]`):u.debug(`replaceTrack() [localId:${e}, no track]`);const n=this.midTransceiverMap.get(e);if(!n)throw new Error("associated RTCRtpTransceiver not found");await n.sender.replaceTrack(s)}async setMaxSpatialLayer(e,s){this._assertSendDirection(),u.debug(`setMaxSpatialLayer() [localId:${e}, spatialLayer:${s}]`);const n=this.midTransceiverMap.get(e);if(!n)throw new Error("associated RTCRtpTransceiver not found");const i=n.sender.getParameters();i.encodings.forEach((a,o)=>{o<=s?a.active=!0:a.active=!1}),await n.sender.setParameters(i)}async setRtpEncodingParameters(e,s){this._assertSendDirection(),u.debug(`setRtpEncodingParameters() [localId:${e}, params:${JSON.stringify(s)}]`);const n=this.midTransceiverMap.get(e);if(!n)throw new Error("associated RTCRtpTransceiver not found");const i=n.sender.getParameters();i.encodings.forEach((a,o)=>{i.encodings[o]={...a,...s}}),await n.sender.setParameters(i)}getSenderStats(e){this._assertSendDirection();const s=this.midTransceiverMap.get(e);if(!s)throw new Error("associated RTCRtpTransceiver not found");return s.sender.getStats()}async stopReceiving(e){throw this._assertRecvDirection(),u.debug(`stopReceiving() [localId:${e}]`),Error("method not implemented")}async pauseReceiving(e){throw this._assertRecvDirection(),u.debug(`pauseReceiving() [localId:${e}]`),Error("method not implemented")}async resumeReceiving(e){throw this._assertRecvDirection(),u.debug(`resumeReceiving() [localId:${e}]`),Error("method not implemented")}async getReceiverStats(e){this._assertRecvDirection();const s=this.midTransceiverMap.get(e);if(!s)throw new Error("associated RTCRtpTransceiver not found");return s.receiver.getStats()}_assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}_assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}async _generateOffer(){const e=await this._pc.createOffer();return await this._pc.setLocalDescription(e),e}async _setAnswer(e){u.debug(`setAnswer() | calling pc.setRemoteDescription() [answer:${JSON.stringify(e)}]`),await this._pc.setRemoteDescription(e)}_addEventListeners(){this._pc.addEventListener("iceconnectionstatechange",()=>{switch(this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected"),this._transportReady=!0;break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed");break;default:u.warn("unknown state");break}}),this._pc.addEventListener("icecandidate",e=>{e.candidate&&this.emit("@icecandidate",{candidate:e.candidate})}),this._pc.addEventListener("negotiationneeded",()=>{this.emit("@negotiationneeded",{}),u.debug("negotiationneeded")}),this._pc.addEventListener("icegatheringstatechange",()=>{switch(this._pc.iceGatheringState){case"gathering":u.debug("icegatheringstatechange | gathering"),this.emit("@icegatheringstatechange","gathering");break;case"complete":u.debug("icegatheringstatechange | complete"),this.emit("@icegatheringstatechange","complete");break;default:u.warn("unknown state");break}}),this._pc.addEventListener("icecandidateerror",e=>{u.error("icecandidateerror",{error:{code:e.errorCode,message:e.errorText}})}),this._pc.addEventListener("datachannel",e=>{u.info("data channel created: ",{rtcChannel:{label:e.channel.label}});const{channel:s}=e;s.onopen=()=>{u.info("data channel open: ",{rtcChannel:{label:e.channel.label}}),this.safeEmit("dc_open",e.channel)},s.onclose=()=>{u.warn("data channel closed: ",{rtcChannel:{label:e.channel.label}})},s.onerror=()=>{u.error("data channel error: ",{rtcChannel:{label:e.channel.label}})},s.onmessage=n=>{this.safeEmit("datachannel",e.channel,String.fromCharCode(...new Uint8Array(n.data)))}})}}class dd extends oh{constructor(e){super();m(this,"_direction");m(this,"_pc");m(this,"_sendWebStream",new MediaStream);m(this,"_sendScreenShareStream",new MediaStream);m(this,"_transportReady",!1);m(this,"supportsSendEncodings",!1);this.supportsSendEncodings=e.supportsSendEncodings}static createFactory(e){return()=>new dd(e)}get name(){return"Firefox60"}get pc(){return this._pc}close(){if(u.debug("Firefox60::close()"),this._pc)try{this._pc.close()}catch(e){u.error("Firefox60::pc.close()",{error:e})}}init({direction:e,iceServers:s,iceTransportPolicy:n,additionalSettings:i,proprietaryConstraints:a,onTrackHandler:o}){u.debug("Firefox60::init()"),this._direction=e,this._pc=new RTCPeerConnection({iceServers:s||[],iceTransportPolicy:n||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",...i},a),o&&this._pc.addEventListener("track",c=>{o(c)}),this._addEventListeners()}async connect(){const e=this._pc.createDataChannel("dyte"),s=await this._pc.createOffer();return u.info(`Firefox60::connect offer: ${JSON.stringify(s)}`),await this._pc.setLocalDescription(s),{offerSdp:s,callback:async i=>{u.debug(`Firefox60::connect() | calling pc.setRemoteDescription() [answer:${JSON.stringify(i)}]`),await this._pc.setRemoteDescription(i),e.close()}}}async updateIceServers(e){throw u.debug("Firefox60::updateIceServers()"),new Error("not supported")}async restartIce(){u.debug("Firefox60::restartIce()");const e=await this.pc.createOffer({iceRestart:!0});return u.debug(`Firefox60::restartIce() | calling pc.setLocalDescription() [offer:${JSON.stringify(e)}]`),{offerSdp:e,callback:async n=>{u.info(`Firefox60::restartIce() | calling pc.setRemoteDescription() [answer:${JSON.stringify(n)}]`),await this._pc.setRemoteDescription(n)}}}async getTransportStats(){return this._pc.getStats()}async send({track:e,encodings:s,codecOptions:n,screenShare:i}){this._assertSendDirection(),u.debug(`Firefox60::send() [kind:${e.kind}, track.id:${e.id}]`);const a=this.supportsSendEncodings&&s!==void 0?{sendEncodings:s}:{},o=this._pc.addTransceiver(e,{direction:"sendonly",streams:[i?this._sendScreenShareStream:this._sendWebStream],...a});if(!this.supportsSendEncodings&&s){s.reverse();const h=o.sender.getParameters();h.encodings=s,await o.sender.setParameters(h)}const c=(h,f)=>{var B;const g=cd(h),_=g.media[g.media.length-1],w=_.rtp.filter(b=>f.some(Q=>Q.name===b.codec)),R=_.fmtp.filter(b=>w.some(Q=>Q.payload===b.payload)),D=(B=_.rtcpFb)==null?void 0:B.filter(b=>w.some(Q=>Q.payload===b.payload)),x=w.map(b=>b.payload);return g.media[g.media.length-1].rtp=w,g.media[g.media.length-1].fmtp=R,g.media[g.media.length-1].rtcpFb=D,g.media[g.media.length-1].payloads=x.join(" "),Gv(g)},l=await this._pc.createOffer();if(l.sdp=c(l.sdp,n),!this._transportReady)throw new Error("webrtc transport not connected");if(u.debug(`send() | calling pc.setLocalDescription() [offer:${JSON.stringify(l)}]`),await this._pc.setLocalDescription(l),e.kind==="audio"){const h=this._enableStereo,f=this._enableHighBitrate?h?128e3:64e3:h?64e3:32e3;l.sdp=l.sdp.replace("minptime=10;useinbandfec=1",`minptime=10;useinbandfec=1;usedtx=1${this.supportsSendEncodings?"":`${h?"":";stereo=1;sprop-stereo=1"};maxaveragebitrate=${f}`}`)}return{offerSdp:l,callback:async h=>(u.debug(`send() | calling pc.setRemoteDescription() [answer:${JSON.stringify(h)}]`),await this._pc.setRemoteDescription(h),this.midTransceiverMap.set(o.mid,o),o.mid),sender:o.sender,mid:o.mid}}async stopSending(e){this._assertSendDirection(),u.debug(`Firefox60::stopSending() [localId:${e}]`);const s=this.midTransceiverMap.get(e);if(!s)throw new Error("associated transceiver not found");s.sender.replaceTrack(null),this._pc.removeTrack(s.sender),s.direction="inactive";const n=await this._pc.createOffer();return u.debug(`stopSending() | calling pc.setLocalDescription() [offer:${JSON.stringify(n)}]`),await this._pc.setLocalDescription(n),{offerSdp:n,callback:async a=>{u.debug(`stopSending() | calling pc.setRemoteDescription() [answer:${JSON.stringify(a)}]`),await this._pc.setRemoteDescription(a),this.midTransceiverMap.delete(e)}}}async replaceTrack(e,s){this._assertSendDirection(),s?u.debug(`replaceTrack() [localId:${e}, track.id:${s.id}]`):u.debug(`Firefox60::replaceTrack() [localId:${e}, no track]`);const n=this.midTransceiverMap.get(e);if(!n)throw new Error("associated RTCRtpTransceiver not found");await n.sender.replaceTrack(s)}async setMaxSpatialLayer(e,s){this._assertSendDirection(),u.debug(`setMaxSpatialLayer() [localId:${e}, spatialLayer:${s}]`);const n=this.midTransceiverMap.get(e);if(!n)throw new Error("associated RTCRtpTransceiver not found");const i=n.sender.getParameters(),a=i.encodings.length-1-s;i.encodings.forEach((o,c)=>{c>=a?o.active=!0:o.active=!1}),await n.sender.setParameters(i)}async setRtpEncodingParameters(e,s){this._assertSendDirection(),u.debug(`setRtpEncodingParameters() [localId:${e}, params:${JSON.stringify(s)}]`);const n=this.midTransceiverMap.get(e);if(!n)throw new Error("associated RTCRtpTransceiver not found");const i=n.sender.getParameters();i.encodings.forEach((a,o)=>{i.encodings[o]={...a,...s}}),await n.sender.setParameters(i)}getSenderStats(e){this._assertSendDirection();const s=this.midTransceiverMap.get(e);if(!s)throw new Error("associated RTCRtpTransceiver not found");return s.sender.getStats()}async stopReceiving(e){this._assertRecvDirection(),u.debug(`Firefox60::stopReceiving() [localId:${e}]`);const s=this.midTransceiverMap.get(e);if(!s)throw new Error("associated RTCRtpTransceiver not found");s.direction="inactive",u.info(`Firefox60::active transcievers: ${JSON.stringify(this._pc.getTransceivers())}`);const n=await this._pc.createOffer();return u.debug(`Firefox60::stopRecieving() | calling pc.setLocalDescription() [offer:${JSON.stringify(n)}]`),await this._pc.setLocalDescription(n),{offerSdp:n,callback:async a=>{u.debug(`Firefox60::stopRecieving() | calling pc.setRemoteDescription() [answer:${JSON.stringify(a)}]`),await this._pc.setRemoteDescription(a),this.midTransceiverMap.delete(e)}}}async pauseReceiving(e){this._assertRecvDirection(),u.debug(`Firefox60::pauseReceiving() [localId:${e}]`);const s=this.midTransceiverMap.get(e);if(!s)throw new Error("associated RTCRtpTransceiver not found");s.direction="inactive";const n=await this._pc.createOffer();return u.debug(`pauseReceiving() | calling pc.setLocalDescription() [offer:${JSON.stringify(n)}]`),await this._pc.setLocalDescription(n),{offerSdp:n,callback:async a=>{u.debug(`pauseReceiving() | calling pc.setRemoteDescription() [answer:${JSON.stringify(a)}]`),await this._pc.setRemoteDescription(a)}}}async resumeReceiving(e){this._assertRecvDirection(),u.debug(`Firefox60::resumeReceiving() [localId:${e}]`);const s=this.midTransceiverMap.get(e);if(!s)throw new Error("associated RTCRtpTransceiver not found");s.direction="recvonly";const n=await this._generateOffer();return u.debug(`resumeReceiving() | calling pc.setLocalDescription() [offer:${JSON.stringify(n)}]`),{offerSdp:n,callback:async a=>{u.debug(`resumeReceiving() | calling pc.setRemoteDescription() [answer:${JSON.stringify(a)}]`),await this._pc.setRemoteDescription(a)}}}async getReceiverStats(e){this._assertRecvDirection();const s=this.midTransceiverMap.get(e);if(!s)throw new Error("associated RTCRtpTransceiver not found");return s.receiver.getStats()}_assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}_assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}async _generateOffer(){const e=await this._pc.createOffer();return await this._pc.setLocalDescription(e),e}async _setAnswer(e){u.debug(`_setAnswer() | calling pc.setRemoteDescription() [answer:${JSON.stringify(e)}]`),await this._pc.setRemoteDescription(e)}_addEventListeners(){this._pc.addEventListener("datachannel",e=>{u.info("Firefox60::data channel created: ",{rtcChannel:{label:e.channel.label}});const{channel:s}=e;s.onopen=()=>{u.info("Firefox60::data channel open: ",{rtcChannel:{label:e.channel.label}}),this.safeEmit("dc_open",e.channel)},s.onclose=()=>{u.warn("data channel closed: ",{rtcChannel:{label:e.channel.label}})},s.onerror=()=>{u.error("Firefox60::data channel error: ",{rtcChannel:{label:e.channel.label}})},s.onmessage=async n=>{const i=await n.data.arrayBuffer();this.safeEmit("datachannel",e.channel,String.fromCharCode(...new Uint8Array(i)))}}),this._pc.addEventListener("iceconnectionstatechange",()=>{switch(this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected"),this._transportReady=!0;break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed");break;default:u.warn("unknown state");break}}),this._pc.addEventListener("icecandidate",e=>{e.candidate&&this.emit("@icecandidate",{candidate:e.candidate})}),this._pc.addEventListener("negotiationneeded",()=>{this.emit("@negotiationneeded",{}),u.debug("Firefox60::negotiationneeded")}),this._pc.addEventListener("icegatheringstatechange",()=>{switch(this._pc.iceGatheringState){case"gathering":u.debug("Firefox60::icegatheringstatechange | gathering"),this.emit("@icegatheringstatechange","gathering");break;case"complete":u.debug("Firefox60::icegatheringstatechange | complete"),this.emit("@icegatheringstatechange","complete");break;default:u.warn("unknown state");break}}),this._pc.addEventListener("icecandidateerror",e=>{u.error("icecandidateerror",{error:{code:e.errorCode,message:e.errorText}})})}}class dh extends oh{constructor(){super();m(this,"_direction");m(this,"_pc");m(this,"_sendWebStream",new MediaStream);m(this,"_sendScreenShareStream",new MediaStream);m(this,"_transportReady",!1)}static createFactory(){return()=>new dh}get name(){return"Chrome74"}get pc(){return this._pc}close(){if(u.debug("Safari12::close()"),this._pc)try{this._pc.close()}catch(e){u.error("Safari12::pc.close()",e)}}init({direction:e,iceServers:s,iceTransportPolicy:n,additionalSettings:i,proprietaryConstraints:a,onTrackHandler:o}){u.debug("Safari12::init()"),this._direction=e,this._pc=new RTCPeerConnection({iceServers:s||[],iceTransportPolicy:n||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",...i},a),o&&this._pc.addEventListener("track",c=>{o(c)}),this._addEventListeners()}async connect(){const e=this._pc.createDataChannel("dyte"),s=await this._pc.createOffer();return u.info(`Safari12::connect offer: ${JSON.stringify(s)}`),await this._pc.setLocalDescription(s),{offerSdp:s,callback:async i=>{u.debug(`Safari12::connect() | calling pc.setRemoteDescription() [answer: ${JSON.stringify(i)}]`),await this._pc.setRemoteDescription(i),e.close()}}}async updateIceServers(e){u.debug("Safari12::updateIceServers()");const s=this._pc.getConfiguration();s.iceServers=e,this._pc.setConfiguration(s)}async restartIce(){u.debug("Safari12::restartIce()");const e=await this.pc.createOffer({iceRestart:!0});return u.debug(`restartIce() | calling pc.setLocalDescription() [offer:${JSON.stringify(e)}]`),{offerSdp:e,callback:async n=>{u.info(`restartIce() | calling pc.setRemoteDescription() [answer:${JSON.stringify(n)}]`),await this._pc.setRemoteDescription(n)}}}async getTransportStats(){return this._pc.getStats()}async send({track:e,encodings:s,codecOptions:n,screenShare:i}){this._assertSendDirection(),u.debug(`Safari12::send() [kind: ${e.kind}, track.id: ${e.id}]`),u.debug("Safari12::creating new transceiver");const a=this._pc.addTransceiver(e,{direction:"sendonly",streams:[i?this._sendScreenShareStream:this._sendWebStream],sendEncodings:s}),o=RTCRtpSender.getCapabilities(e.kind);u.info(`Safari12::senders available params: ${JSON.stringify(o)}`);const c=[];n&&n.length>0&&n.forEach(h=>{var g;const f=o.codecs.find(_=>_.mimeType.includes(h.name));if(h.parameters){u.info(`Safari12::codecOption.parameters:, ${JSON.stringify(h.parameters)}`);const _=((g=f.sdpFmtpLine)==null?void 0:g.split(";"))||[];_.push(...h.parameters);const w=[...new Set(_).values()];f.sdpFmtpLine=w.join(";")}c.push(f)}),u.info(`Safari12::selected codecs: ${JSON.stringify(c)}`),a.setCodecPreferences(c);const l=await this._pc.createOffer();if(!this._transportReady)throw new Error("webrtc transport not connected");if(await this._pc.setLocalDescription(l),e.kind==="audio"){const h=this._enableStereo,f=this._enableHighBitrate?h?128e3:64e3:h?64e3:32e3;l.sdp=l.sdp.replace("minptime=10;useinbandfec=1",`minptime=10;useinbandfec=1;usedtx=1${h?"":";stereo=1;sprop-stereo=1"};maxaveragebitrate=${f}`)}return{offerSdp:l,callback:async h=>(u.debug(`Safari12::send() | calling pc.setRemoteDescription() [answer:${JSON.stringify(h)}]`),await this._pc.setRemoteDescription(h),this.midTransceiverMap.set(a.mid,a),a.mid),sender:a.sender,mid:a.mid}}async stopSending(e){this._assertSendDirection(),u.debug(`Safari12::stopSending() [localId:${e}]`);const s=this.midTransceiverMap.get(e);if(!s)throw new Error("associated RTCRtpTransceiver not found");s.sender.replaceTrack(null),this._pc.removeTrack(s.sender),s.direction="inactive";const n=await this._pc.createOffer();return u.debug(`Safari12::stopSending() | calling pc.setLocalDescription() [offer:${JSON.stringify(n)}]`),await this._pc.setLocalDescription(n),{offerSdp:n,callback:async a=>{u.debug(`Safari12::stopSending() | calling pc.setRemoteDescription() [answer:${JSON.stringify(a)}]`),await this._pc.setRemoteDescription(a),this.midTransceiverMap.delete(e)}}}async replaceTrack(e,s){this._assertSendDirection(),s?u.debug(`Safari12::replaceTrack() [localId:${e}, track.id:${s.id}]`):u.debug(`Safari12::replaceTrack() [localId:${e}, no track]`);const n=this.midTransceiverMap.get(e);if(!n)throw new Error("associated RTCRtpTransceiver not found");await n.sender.replaceTrack(s)}async setMaxSpatialLayer(e,s){this._assertSendDirection(),u.debug(`setMaxSpatialLayer() [localId:${e}, spatialLayer:${s}]`);const n=this.midTransceiverMap.get(e);if(!n)throw new Error("associated RTCRtpTransceiver not found");const i=n.sender.getParameters();i.encodings.forEach((a,o)=>{o<=s?a.active=!0:a.active=!1}),await n.sender.setParameters(i)}async setRtpEncodingParameters(e,s){this._assertSendDirection(),u.debug(`setRtpEncodingParameters() [localId:${e}, params:${JSON.stringify(s)}]`);const n=this.midTransceiverMap.get(e);if(!n)throw new Error("associated RTCRtpTransceiver not found");const i=n.sender.getParameters();i.encodings.forEach((a,o)=>{i.encodings[o]={...a,...s}}),await n.sender.setParameters(i)}getSenderStats(e){this._assertSendDirection();const s=this.midTransceiverMap.get(e);if(!s)throw new Error("associated RTCRtpTransceiver not found");return s.sender.getStats()}async receive(e){this._assertRecvDirection(),u.debug(`recieve() | calling pc.setLocalDescription() [answer:${JSON.stringify(e)}]`);const s=this._pc.getTransceivers().at(-1);return u.info("Safari12::Transceiver is now receiving"),this.midTransceiverMap.set(s.mid,s),{track:s.receiver.track,localId:s.mid}}async stopReceiving(e){this._assertRecvDirection(),u.debug(`Safari12::stopReceiving() [localId:${e}]`);const s=this.midTransceiverMap.get(e);if(!s)throw new Error("associated RTCRtpTransceiver not found");s.direction="inactive",u.info(`Safari12::active transcievers: ${JSON.stringify(this._pc.getTransceivers())}`);const n=await this._pc.createOffer();return u.debug(`stopRecieving() | calling pc.setLocalDescription() [offer:${JSON.stringify(n)}]`),await this._pc.setLocalDescription(n),{offerSdp:n,callback:async a=>{u.debug(`stopRecieving() | calling pc.setRemoteDescription() [answer:${JSON.stringify(a)}]`),await this._pc.setRemoteDescription(a),this.midTransceiverMap.delete(e)}}}async pauseReceiving(e){this._assertRecvDirection(),u.debug(`Safari12::pauseReceiving() [localId:${e}]`);const s=this.midTransceiverMap.get(e);if(!s)throw new Error("associated RTCRtpTransceiver not found");s.direction="inactive";const n=await this._pc.createOffer();return u.debug(`pauseReceiving() | calling pc.setLocalDescription() [offer:${JSON.stringify(n)}]`),await this._pc.setLocalDescription(n),{offerSdp:n,callback:async a=>{u.debug(`pauseReceiving() | calling pc.setRemoteDescription() [answer:${JSON.stringify(a)}]`),await this._pc.setRemoteDescription(a)}}}async resumeReceiving(e){this._assertRecvDirection(),u.debug(`Safari12::resumeReceiving() [localId:${e}]`);const s=this.midTransceiverMap.get(e);if(!s)throw new Error("associated RTCRtpTransceiver not found");s.direction="recvonly";const n=await this._generateOffer();return u.debug(`Safari12::resumeReceiving() | calling pc.setLocalDescription() [offer:${JSON.stringify(n)}]`),{offerSdp:n,callback:async a=>{u.debug(`Safari12::resumeReceiving() | calling pc.setRemoteDescription() [answer:${JSON.stringify(a)}]`),await this._pc.setRemoteDescription(a)}}}async getReceiverStats(e){this._assertRecvDirection();const s=this.midTransceiverMap.get(e);if(!s)throw new Error("associated RTCRtpTransceiver not found");return s.receiver.getStats()}_assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}_assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}async _generateOffer(){const e=await this._pc.createOffer();return await this._pc.setLocalDescription(e),e}async _setAnswer(e){u.debug(`Safari12::_setAnswer() | calling pc.setRemoteDescription() [answer:${JSON.stringify(e)}]`),await this._pc.setRemoteDescription(e)}_addEventListeners(){this._pc.addEventListener("iceconnectionstatechange",()=>{switch(this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected"),this._transportReady=!0;break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed");break;default:u.warn("Safari12::unknown state");break}}),this._pc.addEventListener("icecandidate",e=>{e.candidate&&this.emit("@icecandidate",{candidate:e.candidate})}),this._pc.addEventListener("negotiationneeded",()=>{this.emit("@negotiationneeded",{}),u.debug("Safari12::negotiationneeded")}),this._pc.addEventListener("icegatheringstatechange",()=>{switch(this._pc.iceGatheringState){case"gathering":u.debug("Safari12::icegatheringstatechange | gathering"),this.emit("@icegatheringstatechange","gathering");break;case"complete":u.debug("Safari12::icegatheringstatechange | complete"),this.emit("@icegatheringstatechange","complete");break;default:u.warn("Safari12::unknown state");break}}),this._pc.addEventListener("icecandidateerror",e=>{u.error("icecandidateerror",{error:{code:e.errorCode,message:e.errorText}})}),this._pc.ondatachannel=e=>{u.info("Safari12::data channel created: ",{rtcChannel:{label:e.channel.label}});const{channel:s}=e;s.onopen=()=>{u.info("Safari12::data channel open: ",{rtcChannel:{label:e.channel.label}}),this.safeEmit("dc_open",e.channel)},s.onclose=()=>{u.warn("Safari12::data channel closed: ",{rtcChannel:{label:e.channel.label}})},s.onerror=()=>{u.error("Safari12::data channel error: ",{rtcChannel:{label:e.channel.label}})},s.onmessage=async n=>{const i=String.fromCharCode(...new Uint8Array(n.data));this.safeEmit("datachannel",e.channel,i)}}}}function a1(r,t){const e=new Error(t);return e.name=r,e}class ka extends I{constructor(t){super(t),this.name="UnsupportedError",Error.hasOwnProperty("captureStackTrace")?Error.captureStackTrace(this,ka):this.stack=new Error(t).stack}}class vt extends I{constructor(t){super(t),this.name="InvalidStateError",Error.hasOwnProperty("captureStackTrace")?Error.captureStackTrace(this,vt):this.stack=new Error(t).stack}}class Jv extends I{constructor(t){super(t),this.name="TransportConnectionError",Error.hasOwnProperty("captureStackTrace")?Error.captureStackTrace(this,vt):this.stack=new Error(t).stack}}class Kv extends I{constructor(t){super(t),this.name="DataChannelRequestError",Error.hasOwnProperty("captureStackTrace")?Error.captureStackTrace(this,vt):this.stack=new Error(t).stack}}function o1(r,t){return typeof r=="undefined"?t:typeof window!="undefined"&&Object.getOwnPropertyDescriptor(window,"structuredClone")?structuredClone(r):JSON.parse(JSON.stringify(r))}class c1 extends fn{constructor({id:e,localId:s,producerId:n,producingPeerId:i,producingTransportId:a,handler:o,track:c,appData:l,paused:p,reuseTrack:h,rtpReceiver:f,mimeType:g}){super();E(this,co);E(this,Vd);E(this,Bd);m(this,"rtpReceiver");m(this,"observer");m(this,"sessionDescription");E(this,Za,void 0);E(this,eo,void 0);E(this,to,void 0);E(this,ro,void 0);E(this,so,void 0);E(this,Nr,void 0);E(this,no,void 0);E(this,io,void 0);E(this,Er,void 0);E(this,Fn,void 0);E(this,ao,void 0);E(this,oo,void 0);y(this,Za,e),y(this,eo,s),y(this,io,o),y(this,oo,l),y(this,ao,i),y(this,ro,a),y(this,Nr,!1),y(this,to,n),y(this,Er,c),y(this,Fn,p!=null?p:!1),y(this,no,h),y(this,so,g),this.observer=new fn,this.rtpReceiver=f,qe(this,Vd,Qy).call(this)}get id(){return d(this,Za)}get peerId(){return d(this,ao)}get localId(){return d(this,eo)}get producerId(){return d(this,to)}get producingTransportId(){return d(this,ro)}get closed(){return d(this,Nr)}get kind(){return d(this,Er).kind}get track(){return d(this,Er)}get paused(){return d(this,Fn)}get remotelyPaused(){return this.paused}get appData(){return d(this,oo)}get mimeType(){return d(this,so)}close(e){d(this,Nr)||(u.debug("Consumer::close() with reason:",{consumer:{id:this.id,appData:this.appData,peerId:this.peerId,closureReason:e,kind:this.kind}}),y(this,Nr,!0),d(this,no)||qe(this,Bd,Xy).call(this),this.emit("close",e),this.observer.safeEmit("close",e))}async getStats(){if(d(this,Nr))throw new vt("closed");return d(this,io).getReceiverStats(this.localId)}pause(){if(u.debug("consumer::pause()",{consumer:{id:this.id,appData:this.appData,peerId:this.peerId,kind:this.kind}}),d(this,Nr)){u.error("consumer::pause() | Consumer closed",{consumer:{id:this.id,appData:this.appData,peerId:this.peerId,kind:this.kind}});return}y(this,Fn,!0),d(this,Er).enabled=!1,this.observer.safeEmit("pause")}resume(){if(u.debug("consumer::resume()",{consumer:{id:this.id,appData:this.appData,peerId:this.peerId,kind:this.kind}}),d(this,Nr)){u.error("Consumer::resume() | Consumer closed",{consumer:{id:this.id,appData:this.appData,peerId:this.peerId,kind:this.kind}});return}y(this,Fn,!1),d(this,Er).enabled=!0,this.observer.safeEmit("resume")}}Za=new WeakMap,eo=new WeakMap,to=new WeakMap,ro=new WeakMap,so=new WeakMap,Nr=new WeakMap,no=new WeakMap,io=new WeakMap,Er=new WeakMap,Fn=new WeakMap,ao=new WeakMap,oo=new WeakMap,co=new WeakSet,Dh=function(){u.debug('Consumer::track "ended" event',{consumer:{id:this.id,appData:this.appData,peerId:this.peerId,kind:this.kind}}),this.safeEmit("trackended"),this.observer.safeEmit("trackended")},Vd=new WeakSet,Qy=function(){d(this,Er).addEventListener("ended",qe(this,co,Dh).bind(this))},Bd=new WeakSet,Xy=function(){try{d(this,Er).removeEventListener("ended",qe(this,co,Dh)),d(this,Er).stop()}catch(e){u.error("Consumer::destroyTrack()",{consumer:{id:this.id,appData:this.appData,peerId:this.peerId,kind:this.kind},error:e})}};class d1 extends fn{constructor({id:e,localId:s,track:n,stopTracks:i,disableTrackOnPause:a,zeroRtpOnPause:o,handler:c,appData:l,rtpSender:p}){super();m(this,"_id");m(this,"_localId");m(this,"_closed",!1);m(this,"_handler");m(this,"_track");m(this,"_kind");m(this,"_paused");m(this,"_maxSpatialLayer");m(this,"_stopTracks");m(this,"_disableTrackOnPause");m(this,"_zeroRtpOnPause");m(this,"_appData");m(this,"observer");m(this,"rtpSender");this._id=e,this._localId=s,this._track=n,this._kind=n.kind,this._paused=a?!n.enabled:!1,this._maxSpatialLayer=void 0,this._stopTracks=i,this._disableTrackOnPause=a,this._zeroRtpOnPause=o,this._appData=l||{},this._onTrackEnded=this._onTrackEnded.bind(this),this._handler=c,this.rtpSender=p,this.observer=new fn,this._handleTrack()}get id(){return this._id}get localId(){return this._localId}get closed(){return this._closed}get kind(){return this._kind}get track(){return this._track}get paused(){return this._paused}get maxSpatialLayer(){return this._maxSpatialLayer}get appData(){return this._appData}set appData(e){throw new Error("cannot override appData object")}async close(e){if(this._closed)return;if(u.debug("Producer::close() with reason:"),this._closed=!0,this._destroyTrack(),e===uh){this.observer.emit("close");return}const{offerSdp:s,callback:n}=await this._handler.stopSending(this.localId);this.observer.emit("close");const{answer:i}=await this.safeEmitAsPromise("close",{offer:s,reason:e});n(i)}async getStats(){if(this._closed)throw new vt("closed");return this._handler.getSenderStats(this.localId)}pause(){u.debug("Producer::pause()",{producer:{id:this.id,appData:this.appData,kind:this.kind}}),this._closed&&u.error("Producer::pause() | Producer closed",{producer:{id:this.id,appData:this.appData,kind:this.kind}}),this._paused=!0,this._track&&this._disableTrackOnPause&&(this._track.enabled=!1),this._zeroRtpOnPause&&this._handler.replaceTrack(this.localId,null),this.observer.emit("pause")}resume(){if(u.debug("Producer::resume()",{producer:{id:this.id,appData:this.appData,kind:this.kind}}),this._closed){u.error("Producer::resume() | Producer closed",{producer:{id:this.id,appData:this.appData,kind:this.kind}});return}this._paused=!1,this._track&&this._disableTrackOnPause&&(this._track.enabled=!0),this._zeroRtpOnPause&&this._handler.replaceTrack(this.localId,this._track),this.observer.emit("resume")}async replaceTrack({track:e}){if(u.debug("Producer::replaceTrack()",{producer:{id:this.id,appData:this.appData,kind:this.kind,trackId:e==null?void 0:e.id}}),this._closed){if(e&&this._stopTracks)try{e.stop()}catch(s){u.error("Producer::replaceTrack",{producer:{id:this.id,appData:this.appData,kind:this.kind,trackId:e==null?void 0:e.id},error:s})}throw new vt("closed")}else if(e&&e.readyState==="ended")throw new vt("track ended");if(e===this._track){u.debug("replaceTrack() | same track, ignored",{producer:{id:this.id,appData:this.appData,kind:this.kind,trackId:e==null?void 0:e.id}});return}(!this._zeroRtpOnPause||!this._paused)&&await this._handler.replaceTrack(this.localId,e),this._destroyTrack(),this._track=e,this._handleTrack()}async setMaxSpatialLayer(e){if(this._closed)throw new vt("closed");if(this._kind!=="video")throw new ka("not a video Producer");if(typeof e!="number")throw new TypeError("invalid spatialLayer");await this._handler.setMaxSpatialLayer(this.localId,e),this._maxSpatialLayer=e}async setRtpEncodingParameters(e){if(this._closed)throw new vt("closed");if(typeof e!="object")throw new TypeError("invalid params");await this._handler.setRtpEncodingParameters(this.localId,e)}_onTrackEnded(){u.debug('Producer::track "ended" event',{producer:{id:this.id,appData:this.appData,kind:this.kind,trackId:this.track.id}}),this.observer.emit("trackended"),this.safeEmit("trackended",this.track.id)}_handleTrack(){this._track&&this._track.addEventListener("ended",this._onTrackEnded)}_destroyTrack(){var e;if(this._track)try{this._track.removeEventListener("ended",this._onTrackEnded),this._stopTracks&&this._track.stop()}catch(s){u.error("Producer::_destroyTrack",{producer:{id:this.id,appData:this.appData,kind:this.kind,trackId:(e=this._track)==null?void 0:e.id},error:s})}}}function zv(r){return typeof r=="object"&&!Array.isArray(r)&&r!==null}function lh(r){return Math.random().toString(36).substring(2,2+r)}const ld=1;function Yv(r){const t=r;return delete t.payload._bolt,t}function l1(r){return r.payload&&zv(r.payload)}function ud(r){var t,e;return l1(r)&&(e=(t=r.payload._bolt)==null?void 0:t.id)!=null?e:""}const Zi=class extends ne.EventEmitter{constructor(e,s,n){super();m(this,"channel");m(this,"queue");m(this,"serverProtocolVersion");E(this,qs,new Map);m(this,"respond",(e,s,n=!1)=>{let i;n?i=Zi.createErrorResponse(e,s):i=Zi.createResponse(e,s),this.channel.send(JSON.stringify(i))});m(this,"notify",e=>{const s=Zi.createNotification(e);this.channel.send(JSON.stringify(s))});m(this,"request",async e=>{const s=Zi.createRequest(e),n=new Promise((i,a)=>{const o=1e3*(5+.1*this.queue.size),{id:c}=s.payload._bolt,l={id:c,method:s.type,resolve:p=>{this.queue.delete(c)&&(clearTimeout(l.timer),i(p))},timer:setTimeout(()=>{this.queue.delete(c)&&a(new Error(`request timeout for message id: ${c}`))},o),cancel:p=>{this.queue.delete(c)&&(clearTimeout(l.timer),a(p))}};this.queue.set(c,l)});return this.channel.send(JSON.stringify(s)),n});m(this,"send",e=>{const s=JSON.stringify(e),n=16384;if(s.length>n){const i=n-200,a=Math.ceil(s.length/i),o=[];for(let l=0;l<a;l+=1){const p=l*i,h=(l+1)*i;o.push(s.slice(p,h))}const c=Jn();for(let l=0;l<a;l+=1){const p=o[l],f=JSON.stringify({id:c,count:a,chunkIndex:l,chunk:p});u.debug(`Sending message chunk over dc: ${f}`),this.channel.send(f)}}else u.debug(`Sending message over dc: ${s}`),this.channel.send(s)});m(this,"processMessage",e=>{var n;d(this,qs).has(e.id)||d(this,qs).set(e.id,[]);const s=d(this,qs).get(e.id);if(s[e.chunkIndex]=e,(s==null?void 0:s.length)===e.count&&!s.some(i=>i===void 0)){const i=d(this,qs).get(e.id),a=i==null?void 0:i.reduce((c,l)=>c+l.chunk,"");d(this,qs).delete(e.id);const o=JSON.parse(a);if(!o.payload||!zv(o.payload))throw new Error("corrupted incoming message over dc",{cause:{code:"CORRUPT_DC_MESSAGE",values:o}});if(this.processBoltHandshake(o))return;if(this.serverProtocolVersion=(n=o.payload._bolt)==null?void 0:n.version,!this.processResponseMsg(o))return o}});m(this,"processResponseMsg",e=>{const{id:s}=e.payload._bolt,n=this.queue.get(s);return n?(u.debug(`resolving pending request with id: ${s}, complete response: ${JSON.stringify(e)}`),e.type==="error"?n.cancel(Yv(e)):n.resolve(Yv(e)),!0):!1});m(this,"processBoltHandshake",e=>{var s,n;return e.type==="_bolt"||e.type==="handshake"?(this.respond((n=(s=e.payload._bolt)==null?void 0:s.id)!=null?n:lh(8),{type:"_bolt",payload:{message:"pong"}}),!0):!1});this.label=s,this.transportId=n,this.channel=e,this.queue=new Map}};let gn=Zi;qs=new WeakMap,m(gn,"createRequest",e=>{var s;if((s=e.payload)!=null&&s._bolt)throw new Error("rpc fields are internal values");return{type:e.type,payload:{...e.payload,_bolt:{id:lh(8),type:"REQUEST",version:ld}}}}),m(gn,"createResponse",(e,s)=>{var n;if((n=s.payload)!=null&&n._bolt)throw new Error("rpc fields are internal values");return{type:s.type,payload:{...s.payload,_bolt:{id:e,type:"RESPONSE",version:ld}}}}),m(gn,"createNotification",e=>{var s;if((s=e.payload)!=null&&s._bolt)throw new Error("rpc fields are internal values");return{type:e.type,payload:{...e.payload,bolt:{id:lh(8),type:"NOTIFY",version:ld}}}}),m(gn,"createErrorResponse",(e,s)=>({type:"error",payload:{error:s.message,_bolt:{id:e,type:"RESPONSE",version:ld}}}));function Qv(r){if(Promise.allSettled)return Promise.allSettled(r);const t=r.map(e=>e.then(s=>({status:"fulfilled",value:s})).catch(s=>({status:"rejected",reason:s})));return Promise.all(t)}const Xv=r=>new Promise(t=>setTimeout(t,r));async function bs(r,t){return new Promise(async(e,s)=>{const{strategy:n,maxRetryCount:i,delayTime:a}={strategy:"linear",maxRetryCount:3,delayTime:10,...t};let o=0,c,l=!1;const p=h=>{l=!0,s(h)};for(;o<i;){try{const h=await r(o,p);return e(h)}catch(h){if(c=h,l)break;if(o<i)n==="linear"?await Xv(a*(o+1)):n==="exponential"&&await Xv(a*(o+Math.max(0,o-1)));else break}o+=1}return s(c)})}const uh="transport closed";class u1 extends fn{constructor(e,{id:s,direction:n,handlerFactory:i,iceServers:a,iceTransportPolicy:o,proprietaryConstraints:c,additionalSettings:l,appData:p,config:h}){var g,_;super();m(this,"awaitQueue");m(this,"observer");E(this,$n,void 0);m(this,"id");m(this,"serverId");m(this,"closed",!1);m(this,"direction");m(this,"maxSctpMessageSize");m(this,"handler");m(this,"connectionState","new");m(this,"producers");m(this,"consumers");m(this,"datachannels");m(this,"connected",!1);m(this,"eventsDCReadyPromise");m(this,"eventsDCReadyPromiseResolver");m(this,"eventsDCFailureTimer");m(this,"transportConnectionPromise");m(this,"consumerTrackEvents");m(this,"unknownTracksMap");m(this,"consumerTrackPool");m(this,"appData");u.debug(`constructor() [id: ${s}, direction: ${n}]`),y(this,$n,e),this.id=s,this.direction=n;const f=o1(l,{});delete f.iceServers,delete f.iceTransportPolicy,delete f.bundlePolicy,delete f.rtcpMuxPolicy,delete f.sdpSemantics,this.producers=new Map,this.consumers=new Map,this.datachannels=new Map,this.consumerTrackEvents=new Map,this.consumerTrackPool=new Map,this.unknownTracksMap=new Map,this.awaitQueue=new id,this.observer=new fn,this.handler=i(),this.handler._enableHighBitrate=(g=h==null?void 0:h.enableHighBitrate)!=null?g:!1,this.handler._enableStereo=(_=h==null?void 0:h.enableStereo)!=null?_:!1,this.handler.init({onTrackHandler:this._ontrack.bind(this),direction:n,iceServers:a,iceTransportPolicy:o,additionalSettings:l,proprietaryConstraints:c}),this.appData=p||{},this.transportConnectionPromise=new Promise(w=>{this.observer.once("connected",()=>{w(!0)}),this.observer.once("disconnect",()=>{w(!1)}),this.observer.once("close",()=>{w(!1)})}),this.eventsDCReadyPromise=new Promise(w=>{this.eventsDCReadyPromiseResolver=w}),this.handler.on("@connectionstatechange",w=>{w!==this.connectionState&&(u.debug(`connection state changed to ${w}`),this.connectionState=w,w==="connected"&&(this.connected=!0,this.observer.emit("connected")),w==="disconnected"&&(this.connected=!1,this.observer.emit("disconnect")),(w==="failed"||w==="closed")&&(this.connected=!1,this.observer.emit("close")),this.closed||this.safeEmit("connectionstatechange",w))}),this.handler.on("@icecandidate",({candidate:w})=>{this.closed||this.safeEmit("icecandidate",w)}),this.handler.on("dc_open",w=>{let R=this.datachannels.get(w.label);R||(R||(R=new gn(w,w.label,this.serverId),this.datachannels.set(w.label,R)),this.eventsDCFailureTimer=setTimeout(()=>{w.label==="events"&&(this.eventsDCReadyPromiseResolver(!1),this.safeEmit("dc_error",w.label))},5e3))}),this.handler.on("datachannel",(w,R)=>{w.label==="events"&&(this.eventsDCReadyPromiseResolver(!0),this.eventsDCFailureTimer&&clearTimeout(this.eventsDCFailureTimer));const D=this.datachannels.get(w.label);if(!D){u.error("unregistered datachannel for message",{rtcChannel:{label:w.label,message:R}});return}try{const x=JSON.parse(R);u.debug("datachannel message chunk recieved",{dataChannelMessageChunk:{id:x.id,count:x.count,chunkIndex:x.chunkIndex,chunk:x.chunk,transprtId:this.serverId}});const B=D.processMessage(x);if(!B)return;u.debug(`datachannel message with id:${x.id} on transport:${this.serverId}complete - ${JSON.stringify(B)}`),this.emit(`datachannel:${w.label}`,D.label,B)}catch(x){u.error("error parsing message",{error:x})}})}get isConnected(){return this.transportConnectionPromise}setServerId(e){this.serverId=e}getDatachannel(e){return this.datachannels.get(e)}get isEventsDCReady(){return this.eventsDCReadyPromise}close(){this.closed||(u.debug("Transport close called"),this.connected=!1,this.closed=!0,this.handler.close(),Array.from(this.producers.values()).forEach(e=>{e.close(uh).catch(()=>{})}),this.producers.clear(),Array.from(this.consumers.values()).forEach(e=>{e.close(uh)}),this.consumers.clear(),this.consumerTrackPool.clear(),this.consumerTrackEvents.clear(),this.emit("close"),this.observer.emit("close"))}async getStats(){if(this.closed)throw new vt("closed");return this.handler.getTransportStats()}async connect(){try{const{offerSdp:e,callback:s}=await this.handler.connect(),{answer:n}=await this.safeEmitAsPromise("connect",{offer:e});if(await s(n),!await this.isConnected)throw new Error("ice connection failed");if(d(this,$n)===Zt.HIVE&&!await this.isEventsDCReady)throw new Error("events datachannel not open")}catch(e){throw u.error("transport failed to connect:",e),e}}async restartIce(){if(u.debug("restartIce()"),this.closed)throw new vt("closed");return this.handler.restartIce()}async updateIceServers({iceServers:e}={}){if(u.debug("updateIceServers()"),this.closed)throw new vt("closed");return this.handler.updateIceServers(e)}async produce({track:e,encodings:s,codecOptions:n,stopTracks:i=!0,disableTrackOnPause:a=!0,zeroRtpOnPause:o=!1,appData:c={}}={}){if(u.debug(`produce() [track:${e.id}]`),e){if(this.direction!=="send")throw new ka("not a sending Transport");if(e.readyState==="ended")throw new vt("track ended");if(this.listenerCount("connect")===0&&this.connectionState==="new")throw new TypeError('no "connect" listener set into this transport');if(this.listenerCount("produce")===0)throw new TypeError('no "produce" listener set into this transport');if(c&&typeof c!="object")throw new TypeError("if given, appData must be an object")}else throw new TypeError("missing track");if(!await this.isConnected)return Promise.reject(new Error("Transport not connected"));const{producerId:l,localId:p,rtpSender:h}=await this.awaitQueue.push(async()=>{const{offerSdp:g,callback:_,sender:w,mid:R}=await this.handler.send({track:e,encodings:s,codecOptions:n,screenShare:c==null?void 0:c.screenShare}),{answer:D,producerId:x}=await this.safeEmitAsPromise("produce",{offer:g,kind:e.kind,paused:a?!e.enabled:!1,appData:{...c||{},mid:R},codecOptions:n}),B=await _(D);return{producerId:x,localId:B,rtpSender:w}},"producer"),f=new d1({id:l,localId:p,track:e,stopTracks:i,disableTrackOnPause:a,zeroRtpOnPause:o,appData:c,handler:this.handler,rtpSender:h});return this.producers.set(l,f),f.observer.on("close",()=>{this.producers.delete(f.id)}),this.emit("newproducer",f),this.observer.emit("newproducer",f),f}async consume(e){if(u.debug(`consume() producers: ${JSON.stringify(e)}`),this.closed)throw new vt("closed");if(this.direction!=="recv")throw new ka("not a receiving transport");if(this.listenerCount("connect")===0&&this.connectionState==="new")throw new TypeError('no "connect" listener set into this transport');if(!await this.isConnected)throw new Jv("transport not connected");const s=[];if(d(this,$n)===Zt.HIVE){let n;try{n=await this.createConsumersOverDataChannel(e)}catch(i){throw new Kv(i.message)}n.forEach((i,a)=>{const{consumerId:o,trackId:c,screenShare:l,paused:p,streamId:h,kind:f,appData:g,producingTransportId:_,producingPeerId:w,mimeType:R}=i;s.push(this.consumerCreationTask({consumerId:o,trackId:c,streamId:h,kind:f,producerId:a,producingPeerId:w,producingTransportId:_,paused:p,screenShare:l,appData:g,mimeType:R}))})}else{u.info("consumePeer:",{producers:e});const{consumersMap:n,sessionDescription:i}=await this.safeEmitAsPromise("consume_peer",{producers:e});n.forEach((a,o)=>{const{consumerId:c,trackId:l,screenShare:p,paused:h,streamId:f,kind:g,appData:_,producingPeerId:w,producingTransportId:R}=a;s.push(this.consumerCreationTask({consumerId:c,trackId:l,streamId:f,kind:g,producerId:o,producingPeerId:w,producingTransportId:R,paused:h,screenShare:p,appData:_}))}),await this.safeEmitAsPromise("negotiate",{description:i})}return Qv(s)}async setRemoteOffer(e){await this.setRemoteDescription(e);const s=await this.handler.pc.createAnswer(),n=cd(s.sdp);return n.media=n.media.map(i=>{if(i.type==="audio"){const a={...i},o=a.fmtp.find(l=>l.payload===111);return o&&(o.config+=";stereo=1;sprop-stereo=1"),a.rtcpFb||(a.rtcpFb=[]),a.rtcpFb.some(l=>l.type==="nack")||a.rtcpFb.push({payload:parseInt(a.payloads,10),type:"nack"}),a}return i}),s.sdp=Gv(n),await this.setLocalDescription(s),s}_ontrack(e){const{track:s,transceiver:n,streams:i}=e;u.info(`track event received [trackId: ${s.id}]`);let a;d(this,$n)===Zt.HIVE?a=`${i[0].id}:${s.kind}`:a=`${n.mid}:${s.kind}`,s.addEventListener("ended",()=>{u.info(`rtc consumer track ended [trackId: ${s.id}]`),this.consumerTrackPool.delete(s.id),this.unknownTracksMap.delete(a)}),this.consumerTrackPool.set(s.id,[s,n]);const o=this.consumerTrackEvents.get(a);o?(o(s,n),this.consumerTrackEvents.delete(a)):(u.warn(`track event handler not found ${a}`),this.unknownTracksMap.set(a,e))}sendErrorOverDC(e,s,n){const i=this.getDatachannel(e);if(!i)throw new Error("datachannel not found",{cause:{code:"DC_NOT_FOUND",values:{label:e}}});i.respond(s,n,!0)}sendResponseOverDC(e,s,n){const i=this.getDatachannel(e);if(!i)throw new Error("datachannel not found",{cause:{code:"DC_NOT_FOUND",values:{label:e}}});i.respond(s,n)}async consumerCreationTask({consumerId:e,producerId:s,producingPeerId:n,producingTransportId:i,streamId:a,trackId:o,paused:c,screenShare:l,appData:p,kind:h,mimeType:f}){const g=`${a}:${h}`,_={consumerId:e,producerId:s,producingPeerId:n,producingTransportId:i,streamId:a,trackId:o,appData:p,kind:h,paused:c,screenShare:l,name:"consumer creation task error",message:"consumer creation failed"};return new Promise(async(R,D)=>{const x=setTimeout(()=>{this.consumerTrackEvents.delete(g),_.isTimedout=!0,D(_)},5e3),B=(te,ce)=>{try{if(te.readyState==="ended")clearTimeout(x),D(_);else{const he=te;he.enabled=!0,this.handler.midTransceiverMap.set(ce.mid,ce);const Ne=new c1({id:e,localId:ce.mid,track:he,paused:c,producerId:s,producingPeerId:n,producingTransportId:i,handler:this.handler,appData:{...p,screenShare:l,peerId:n},reuseTrack:!0,rtpReceiver:ce.receiver,mimeType:f});this.consumers.set(e,Ne),Ne.once("close",()=>{this.consumers.delete(Ne.id),this.handler.midTransceiverMap.delete(ce.mid)}),u.info("consumer created for ",{consumer:{id:e,kind:h,appData:{screenShare:l},peerId:n,producerId:s}}),this.observer.emit("newconsumer",Ne),clearTimeout(x),R(Ne)}}catch(he){u.warn("error while creating consumer:",he),clearTimeout(x),D(_)}},b=this.consumerTrackPool.get(e);if((b==null?void 0:b.length)===2){B(b[0],b[1]);return}const Q=this.unknownTracksMap.get(g);Q?(this.unknownTracksMap.delete(g),B(Q.track,Q.transceiver)):this.consumerTrackEvents.set(g,B)})}async setRemoteDescription(e){await this.handler.pc.setRemoteDescription(e)}async setLocalDescription(e){u.debug(`${this.direction}() {transportId: ${this.serverId}} | calling pc.setLocalDescription() [offer:${JSON.stringify(e)}]`),await this.handler.pc.setLocalDescription(e)}async retryFailedConsumerCreationTasks(e){return Qv(e.map(async s=>bs(async n=>(n>0&&u.warn(`retrying failed consumer creation task: ${JSON.stringify(s)}`),this.consumerCreationTask({...s})))))}async createConsumersOverDataChannel(e){const s=this.getDatachannel("events");if(!s)throw a1("DC_NOT_READY","events datachannel not ready");if(!e||e&&e.length===0)throw new Error("list of producers is required");const i={type:"create_consumer",payload:{producers:e.map(({producerId:l,producingTransportId:p,kind:h,mimeType:f})=>({producerId:l,producingTransportId:p,preferredCodec:{...h==="video"&&f?{video:f}:{},...h==="audio"&&f?{audio:f}:{}}}))}},a=new Map;e.forEach(l=>a.set(l.producerId,l));const o=(await s.request(i)).payload;u.info(`createConsumersOverDataChannel::response ${JSON.stringify(o)}`);const c=new Map;return Object.entries(o).forEach(([l,p])=>{const h=a.get(p.producerId);if(!h){u.error(`unknown entry in create consumer response, producerId: ${p.producerId}`,{consumerState:p});return}c.set(p.producerId,{consumerId:l,producingTransportId:h.producingTransportId,producingPeerId:h.producingPeerId,kind:h.kind,paused:h.pause,streamId:p.streamId,trackId:p.trackId,screenShare:h.screenShare,mimeType:h.mimeType,appData:{}})}),c}}$n=new WeakMap;function h1(){if(typeof navigator=="object"&&navigator.product==="ReactNative"){if(typeof RTCPeerConnection=="undefined"){u.warn("Device::this._detectDevice() | unsupported ReactNative without RTCPeerConnection");return}return u.debug("Device::this._detectDevice() | ReactNative handler chosen"),"Chrome74"}if(typeof navigator=="object"&&typeof navigator.userAgent=="string"){const r=navigator.userAgent,t=Bf.getParser(r),e=t.getEngine();if(t.satisfies({chrome:">=74",chromium:">=74","microsoft edge":">=88"}))return"Chrome74";if(t.satisfies({chrome:">=70",chromium:">=70"}))return"Chrome70";if(t.satisfies({chrome:">=67",chromium:">=67"}))return"Chrome67";if(t.satisfies({chrome:">=55",chromium:">=55"}))return"Chrome55";if(t.satisfies({firefox:">=110"}))return"Firefox110";if(t.satisfies({firefox:">=60"}))return"Firefox60";if(t.satisfies({ios:{OS:">=14.3",firefox:">=30.0"}})||t.satisfies({safari:">=12.0"})&&typeof RTCRtpTransceiver!="undefined"&&RTCRtpTransceiver.prototype.hasOwnProperty("currentDirection"))return"Safari12";if(t.satisfies({safari:">=11"}))return"Safari11";if(t.satisfies({"microsoft edge":">=11"})&&t.satisfies({"microsoft edge":"<=18"}))return"Edge11";if(e.name&&e.name.toLowerCase()==="blink"){const s=r.match(/(?:(?:Chrome|Chromium))[ /](\w+)/i);if(s){const n=Number(s[1]);return n>=74?"Chrome74":n>=70?"Chrome70":n>=67?"Chrome67":"Chrome55"}return"Chrome74"}if(e.name.toLowerCase()==="webkit"&&t.getOS().name.toLowerCase()==="ios")return typeof RTCRtpTransceiver!="undefined"&&RTCRtpTransceiver.prototype.hasOwnProperty("currentDirection")?"Safari12":"Safari11";u.warn("Device::this._detectDevice() | browser not supported");return}u.warn("Device::this._detectDevice() | unknown device")}class Zv{constructor(t,{handlerName:e,handlerFactory:s}={}){m(this,"handlerFactory");m(this,"_handlerName");m(this,"_observer");E(this,lo,void 0);if(u.debug("constructor()"),y(this,lo,t),e&&s)throw new TypeError("just one of handlerName or handlerInterface can be given");if(s)this.handlerFactory=s;else{if(e)u.debug(`Device::constructor() | handler given: ${e}`);else if(e=h1(),e)u.debug(`Device::constructor() | detected handler: ${e}`);else throw new Error("device not supported");switch(e){case"Chrome74":this.handlerFactory=ch.createFactory();break;case"Safari12":this.handlerFactory=dh.createFactory();break;case"Firefox60":this.handlerFactory=dd.createFactory({supportsSendEncodings:!1});break;case"Firefox110":this.handlerFactory=dd.createFactory({supportsSendEncodings:!0});break;default:throw new TypeError(`unknown handlerName "${e}"`)}}const n=this.handlerFactory();this._handlerName=n.name,n.close(),this._observer=new ne}get handlerName(){return this._handlerName}createSendTransport({iceServers:t,iceTransportPolicy:e,additionalSettings:s,proprietaryConstraints:n,appData:i,config:a}){return u.debug("Device::createSendTransport()"),this.createTransport({direction:"send",iceServers:t,iceTransportPolicy:e,additionalSettings:s,proprietaryConstraints:n,appData:i,config:a})}createRecvTransport({iceServers:t,iceTransportPolicy:e,additionalSettings:s,proprietaryConstraints:n,appData:i}){return u.debug("Device::createRecvTransport()"),this.createTransport({direction:"recv",iceServers:t,iceTransportPolicy:e,additionalSettings:s,proprietaryConstraints:n,appData:i})}createTransport({direction:t,iceServers:e,iceTransportPolicy:s,additionalSettings:n,proprietaryConstraints:i,appData:a,config:o}){const c=Jn(),l=new u1(d(this,lo),{id:c,direction:t,iceServers:e,iceTransportPolicy:s,additionalSettings:n,proprietaryConstraints:i,appData:a,handlerFactory:this.handlerFactory,config:o});return this._observer.emit("newtransport",l),l}}lo=new WeakMap;class p1{constructor(t){E(this,_t,void 0);y(this,_t,t)}async joinRoom(t,e,s,n=!1,i=null){const a={roomUuid:t,displayName:e,capabilities:s,prejoined:n};return i&&(a.location=i),(await d(this,_t).sendMessagePromiseWithTimeout({event:Te.joinRoom,protobuf:Tg.toBinary(a),timeout:5e3})).payload}async connectTransport(t){const e=(await d(this,_t).sendMessagePromise(Te.createWebRTCTransport,pg.toBinary(t))).payload,{transportId:s,description:n}=_u.fromBinary(e),i={sdp:n==null?void 0:n.sdp,type:n.type};return{transportId:s,answer:i}}async produce(t){var i,a;const e=(await d(this,_t).sendMessagePromise(Te.produce,_g.toBinary(t))).payload,s=Dg.fromBinary(e);return{answer:{sdp:(i=s==null?void 0:s.description)==null?void 0:i.sdp,type:(a=s==null?void 0:s.description)==null?void 0:a.type},producerId:s.producerId}}async consume(t){const e=(await d(this,_t).sendMessagePromise(Te.consume,Eg.toBinary(t))).payload,{consumerIdsMap:{map:s}}=Mg.fromBinary(e);return s}async closeProducer(t){const e=(await d(this,_t).sendMessagePromise(Te.closeProducer,wg.toBinary(t))).payload,{description:s}=Og.fromBinary(e);return s}async closeConsumer(t){return(await d(this,_t).sendMessagePromise(Te.closeConsumer,bg.toBinary(t))).payload}async hostControlForPeer(t,e){const s={audio:e==="audio",screeShare:!1,video:e==="video",participantId:t},n=(await d(this,_t).sendMessagePromise(Te.hostControlPeer,Pg.toBinary(s))).payload;if(!n)return!1;const{status:i}=xg.fromBinary(n);return i==="success"}async hostControlForAll(t){const e={audio:t==="audio",screenShare:!1,video:t==="video"},s=(await d(this,_t).sendMessagePromise(Te.hostControlAllPeers,kg.toBinary(e))).payload;if(!s)return!1;const{status:n}=Fg.fromBinary(s);return n==="success"}async kickAll(){const t={propagateKickAcrossRooms:!1},e=(await d(this,_t).sendMessagePromise(Te.kickAll,wu.toBinary(t))).payload;if(!e)return!1;const{status:s}=Lg.fromBinary(e);return s==="success"}async kickPeer(t){const e=(await d(this,_t).sendMessagePromise(Te.kickPeer,Cg.toBinary(t))).payload;if(!e)return!1;const{status:s}=Ng.fromBinary(e);return s==="success"}async changeDisplayName(t){const e=(await d(this,_t).sendMessagePromise(Te.changeDisplayName,Rg.toBinary(t))).payload;if(!e)return!1;const{status:s}=$g.fromBinary(e);return s==="success"}async notifySelfJoinComplete(){const t={},e=(await d(this,_t).sendMessagePromise(Te.selfJoinComplete,Sg.toBinary(t))).payload;return Uc.fromBinary(e)}}_t=new WeakMap;const m1=2e3;class ey extends Wv{constructor(e,s){super();E(this,Un);m(this,"_device");m(this,"_sendTransport");m(this,"_recvTransport");m(this,"_consumers");m(this,"_producers");m(this,"_producerStatus");m(this,"_producerIdToConsumerIdMap");m(this,"_socket");m(this,"_socketHandler");m(this,"_metrics",{sendTransportFailureCount:0,recvTransportFailureCount:0,consumerCreationFailureCount:0,producerCreationFailureCount:0,lastConnectionTime:0});m(this,"_transportDisconnectedTimer");m(this,"_iceTransportPolicy","all");m(this,"_producerNotReadyFailureCount",0);m(this,"transportState");m(this,"transportDisconnected");E(this,Lr,void 0);y(this,Lr,e),this._device=new Zv(Zt.HIVE),this._socket=s,d(this,Un,Bo).mediaState={recv:{state:Xt.NEW,reconnected:!1},send:{state:Xt.NEW,reconnected:!1}},this.transportDisconnected={recv:!1,send:!1},this._socketHandler=new p1(s),this.reset()}get socket(){return this._socket}get producers(){return this._producers}get consumers(){return this._consumers}get producerIdToConsumerIdMap(){return this._producerIdToConsumerIdMap}get socketHandler(){return this._socketHandler}get sendTransport(){return this._sendTransport}get recvTransport(){return this._recvTransport}reset(){this._producers=new Map,this._consumers=new Map,this._producerStatus=new Map,this._producerIdToConsumerIdMap=new Map,this._transportDisconnectedTimer={recv:void 0,send:void 0}}async setupTransports(e){var a,o,c,l,p,h,f,g;J.hasFeature(Z.FORCE_RELAY)&&(u.info("Forcing relay"),this._iceTransportPolicy="relay");const n=await tt().getICEServers().catch(_=>(u.warn(`failed to get iceservers from server: ${_.message}`),[])),i=[];if(e.send){const _=this.createSendTransport({iceServers:n,additionalSettings:{encodedInsertableStreams:(a=d(this,Lr).getValue("modules").e2ee)==null?void 0:a.enabled},config:{enableHighBitrate:(l=(c=(o=d(this,Lr).getValue("defaults").mediaConfiguration)==null?void 0:o.audio)==null?void 0:c.enableHighBitrate)!=null?l:!1,enableStereo:(f=(h=(p=d(this,Lr).getValue("defaults").mediaConfiguration)==null?void 0:p.audio)==null?void 0:h.enableStereo)!=null?f:!1},iceTransportPolicy:this._iceTransportPolicy});i.push(_)}if(e.recv){const _=this.createRecvTransport({iceServers:n,additionalSettings:{encodedInsertableStreams:(g=d(this,Lr).getValue("modules").e2ee)==null?void 0:g.enabled},iceTransportPolicy:this._iceTransportPolicy});i.push(_)}await Promise.all(i)}stopAllTransports(){var e,s,n,i;u.info("closing all the transports"),(e=this._sendTransport)==null||e.close(),(s=this._sendTransport)==null||s.removeAllListeners(),(n=this._recvTransport)==null||n.close(),(i=this._recvTransport)==null||i.removeAllListeners(),this._sendTransport=void 0,this._recvTransport=void 0,this.reset()}async createSendTransport(e){var n,i;u.info("sendTransport::initializing_transport",{transport:{id:(n=this._sendTransport)==null?void 0:n.id,serverId:(i=this._sendTransport)==null?void 0:i.serverId,type:"send"}});const s=this._device.createSendTransport(e);this._transportDisconnectedTimer.send=void 0,u.info("sendTransport::initialized_transport",{transport:{id:s==null?void 0:s.id,serverId:s==null?void 0:s.serverId,type:"send"}}),this.handleTransport(s),u.info("sendTransport::connecting_transport",{transport:{id:s==null?void 0:s.id,serverId:s==null?void 0:s.serverId,type:"send"}});try{await bs(async(a,o)=>{var c,l;if(this._sendTransport&&this._sendTransport.connected){u.info("sendTransport::already_exists_in_connected_state",{transport:{id:(c=this._sendTransport)==null?void 0:c.id,serverId:(l=this._sendTransport)==null?void 0:l.serverId,type:"send"}});return}if(!this.socket.isConnected){o(new Error("socket is not connected"));return}if(s.connectionState==="closed"){o(new Error("transport is closed"));return}a>0&&u.debug(`retrying transport connect, count: ${a}`,{transport:{id:s.id,serverId:s.serverId,type:"send"}});try{await s.connect()}catch(p){if(u.error(`failed to connect send transport: ${s.id}`,{error:p,transport:{id:s.id,serverId:s.serverId,type:"send"},country:v.location.country}),p.message==="ice connection failed"){o(p);return}throw this._metrics.sendTransportFailureCount+=1,p}},{delayTime:100,strategy:"exponential",maxRetryCount:J.hasFeature(Z.ENABLE_HIVE_INFINITE_RETRIES)?1/0:3}),u.info("sendTransport::connected_transport",{transport:{id:s==null?void 0:s.id,serverId:s==null?void 0:s.serverId,type:"send"}}),this._producerNotReadyFailureCount=0,this._sendTransport=s,q.configureSendTransport(s)}catch(a){throw u.error(`failed to connect send transport after retry:${s.id}`,{error:a,transport:{id:s==null?void 0:s.id,serverId:s==null?void 0:s.serverId,type:"send"}}),s.close(),s.removeAllListeners(),this._metrics.sendTransportFailureCount+=1,this.handleErrors("rejoin"),a}}async createRecvTransport(e){var n,i,a;u.info("recvTransport::initializing_transport",{transport:{id:(n=this._recvTransport)==null?void 0:n.id,serverId:(i=this._recvTransport)==null?void 0:i.serverId,type:"recv"}});const s=this._device.createRecvTransport({...e,additionalSettings:{...(a=e.additionalSettings)!=null?a:{},rtcAudioJitterBufferMaxPackets:25,rtcAudioJitterBufferFastAccelerate:!0,rtcAudioJitterBufferMinDelayMs:20}});this._transportDisconnectedTimer.recv=void 0,u.info("recvTransport::initialized_transport",{transport:{id:s==null?void 0:s.id,serverId:s==null?void 0:s.serverId,type:"recv"}}),this.handleTransport(s),u.info("recvTransport::connecting_transport",{transport:{id:s==null?void 0:s.id,serverId:s==null?void 0:s.serverId,type:"recv"}});try{await bs(async(o,c)=>{var l,p;if(this._recvTransport&&this._recvTransport.connected){u.info("recvTransport::already_exists_in_connected_state",{transport:{id:(l=this._recvTransport)==null?void 0:l.id,serverId:(p=this._recvTransport)==null?void 0:p.serverId,type:"recv"}});return}if(!this.socket.isConnected){c(new Error("socket is not connected"));return}if(s.connectionState==="closed"){c(new Error("transport is closed"));return}o>0&&u.debug(`retrying transport connect, count: ${o}`,{transport:{id:s==null?void 0:s.id,serverId:s==null?void 0:s.serverId,type:"recv"}});try{await s.connect()}catch(h){if(u.error(`fail to connect recv transport: ${s.id}`,{error:h,transport:{id:s==null?void 0:s.id,serverId:s==null?void 0:s.serverId,type:"recv"},country:v.location.country}),h.message==="ice connection failed"){c(h);return}throw this._metrics.recvTransportFailureCount+=1,h}},{delayTime:100,strategy:"exponential",maxRetryCount:J.hasFeature(Z.ENABLE_HIVE_INFINITE_RETRIES)?1/0:3}),u.info("recvTransport::connected_transport",{transport:{id:s==null?void 0:s.id,serverId:s==null?void 0:s.serverId,type:"recv"}}),this.producerIdToConsumerIdMap.clear(),this._recvTransport=s,q.configureRecvTransport(s)}catch(o){throw u.error(`failed to connect recv transport after retry:${s.id}`,{error:o,transport:{id:s==null?void 0:s.id,serverId:s==null?void 0:s.serverId,type:"recv"}}),s.close(),s.removeAllListeners(),this._metrics.recvTransportFailureCount+=1,this.handleErrors("rejoin"),o}}handleTransport(e){const{direction:s,id:n}=e,i=s==="recv";e.on("connect",async({offer:a},o,c)=>{try{const l={consuming:i,description:{sdp:a.sdp,type:a.type,target:i?jt.SUBSCRIBER:jt.PUBLISHER}},{transportId:p,answer:h}=await this._socketHandler.connectTransport(l);e.setServerId(p),o({answer:h})}catch(l){u.error(`${i?"consumer":"producer"} transport connection error:`,{error:l,transport:{id:n,serverId:e.serverId,type:s},country:v.location.country}),c(l)}}),e.on("connectionstatechange",async a=>{this.updateTransportState({state:a,direction:s}),u.info(`${i?"consumer":"producer"} transport connectionState:`,{transport:{id:n,serverId:e.serverId,type:s,status:a}});const o=()=>{const c=this._transportDisconnectedTimer[s];c!==void 0&&(clearTimeout(c),this._transportDisconnectedTimer[s]=void 0)};switch(a){case"connected":o(),this._metrics.lastConnectionTime=performance.now();break;case"disconnected":this._transportDisconnectedTimer[s]=setTimeout(()=>{this.triggerTransportReconnection(e)},m1);break;case"failed":if(e.closed)return;o(),this.triggerTransportReconnection(e);break}}),e.on("icecandidate",async a=>{u.debug("sending icecandidate:",{iceCandidate:a})}),e.on("datachannel:events",async(a,o)=>{var c,l;u.debug("got data channel message on event:",{rtcChannel:{label:a,message:o}});try{switch(o.type){case"negotiation":{e.awaitQueue.push(async()=>this.negotiateOverDC(o,ud(o),a,e));break}case"handshake":{const p={type:"handshake",payload:{message:"pong"}};e.sendResponseOverDC(a,ud(o),p);break}case"consumer_toggle":{this.handleConsumerToggle(o.payload);break}case"hub-disconnect":{u.debug(`media hub disconnected, full_reconnect: ${(c=o.payload)==null?void 0:c.full_reconnect}`),((l=o.payload)==null?void 0:l.full_reconnect)===!0&&this.handleErrors("rejoin");break}case"error":{this.handleErrorOverDC(o.payload,e.id);break}default:u.warn(`unknown event received from hive node, event: ${o.type}`);break}}catch(p){u.error(`Unable to handle the incoming datachannel message on channel ${a}`)}}),e.on("dc_error",()=>{e.direction==="recv"&&(u.warn("events datachannel did not open in 5s",{country:v.location.country}),this.handleErrors("reconnectRecvTransport"))}),e.on("negotiate",async({description:a},o,c)=>{try{const l={sdp:a==null?void 0:a.sdp,type:a==null?void 0:a.type},p=await this.negotiate(e,l);o({answer:p})}catch(l){u.error("negotiate error:",{transport:{id:e.id,serverId:e.serverId,type:e.direction},error:l}),c(l)}}),i||e.on("produce",async({offer:a,kind:o,paused:c,appData:l,codecOptions:p},h,f)=>{var R,D;const _=cd(a.sdp).media.filter(x=>o==="video"?x.type==="video":x.type==="audio").at(-1).msid,w={description:{sdp:a.sdp,type:a.type,target:jt.PUBLISHER},paused:c,kind:o,msid:_,appData:JSON.stringify(l),screenShare:(R=l.screenShare)!=null?R:!1,mimeType:`${o}/${(D=p[0])==null?void 0:D.name}`};try{const{answer:x,producerId:B}=await this._socketHandler.produce(w);h({answer:x,producerId:B})}catch(x){u.error("create producer error:",x),f(x)}})}async createProducer(e,s,n){var a;if(this._sendTransport===void 0||this._sendTransport.closed)return null;u.info("createProducer::initializing_producer",{producer:{id:"TO_BE_CREATED",kind:e,status:"initializing",appData:s==null?void 0:s.appData}});const i=this._producerStatus.get(e);if((i==null?void 0:i.trackId)===s.track.id&&(i==null?void 0:i.status)===zr.INITIALIZING)return u.info("createProducer::producer getting initializing",{producer:{id:"GETTING_CREATED",status:"initializing",kind:e,appData:s==null?void 0:s.appData}}),null;this._producerStatus.set(e,{trackId:s.track.id,status:zr.INITIALIZING});try{const o=await this._sendTransport.produce(s);return(a=s.appData)!=null&&a.e2ee&&P.emit(k.E2EE_ACTIVE_PRODUCER,o),u.info("createProducer::initialized_producer",{producer:{id:o==null?void 0:o.id,kind:e,status:"producing",appData:s==null?void 0:s.appData}}),o.on("close",async({offer:c,reason:l},p)=>{u.info("producer::closing",{debuggingHint:l,producer:{id:o==null?void 0:o.id,kind:e,status:"closing",appData:s==null?void 0:s.appData}});const h={producerId:o.id,description:{sdp:c.sdp,type:c.type,target:jt.PUBLISHER}};try{const f=await this._socketHandler.closeProducer(h),g={sdp:f==null?void 0:f.sdp,type:f==null?void 0:f.type};u.info("producer::closed",{producer:{id:o==null?void 0:o.id,kind:e,status:"closed",appData:s==null?void 0:s.appData}}),p({answer:g})}catch(f){u.error("producer close error",f)}this._producerStatus.delete(e),this._producers.delete(e),n(),this.reconfigureWebcamLayers()}),o.on("trackended",()=>{u.info("producer::trackended",{producer:{id:o==null?void 0:o.id,kind:e,status:"UNKNOWN",appData:o==null?void 0:o.appData}}),[le.MIC,le.WEBCAM,le.WEBCAM_BACKUP].includes(e)||n()}),this._producers.set(e,o),this._producerStatus.set(e,{trackId:s.track.id,status:zr.INITIALIZED}),this.reconfigureWebcamLayers(),o.track}catch(o){throw this._producerStatus.set(e,{status:zr.NOT_INITIALIZED,trackId:s.track.id}),u.error("createProducer::transport_initialization_failed",{producer:{id:"FAILED_TO_CREATE",kind:e,status:"failed",appData:s==null?void 0:s.appData,error:o}}),this._metrics.producerCreationFailureCount+=1,o}}async reconfigureWebcamLayers(){if(!J.hasFeature(Z.DISABLE_WEBCAM_LAYERS_ON_SCREENSHARE))return;const e=this.producers.get(le.WEBCAM);e&&await this._switchProducerSpatialLayer(e,this.producers.get(le.SCREENSHARE_VIDEO)?0:3);const s=this.producers.get(le.WEBCAM_BACKUP);s&&await this._switchProducerSpatialLayer(s,this.producers.get(le.SCREENSHARE_VIDEO)?0:3)}async _switchProducerSpatialLayer(e,s){try{u.debug("switching layer of webcam producer to:",{media:{video:{layer:s}},producer:{id:e.id,kind:e.kind,appData:e.appData}}),await e.setMaxSpatialLayer(s)}catch(n){u.error("failed to switch spatial layer",{error:n})}}_initConsumer(e){e&&(e.observer.on("close",async s=>{u.debug("consumer closed",{consumer:{closureReason:s,id:e.id,kind:e.kind,appData:e.appData}}),this._consumers.delete(e.id),P.emit(k.CONSUMER_CLOSED,{id:e.id})}),this._consumers.set(e.id,e),this.producerIdToConsumerIdMap.set(e.producerId,e.id),P.emit(k.NEW_CONSUMER,{id:e.id,appData:e.appData,peerId:e.peerId}))}async createConsumers(e){if(this._recvTransport===void 0||this._recvTransport.closed||!this._recvTransport.connected)return;if(e.every(a=>this.getProducer(a.producerId))){u.warn("Cancelled consumer creation for local producer");return}const n=3,i=async(a,o=0)=>{try{return await this._recvTransport.consume(a)}catch(c){if(c instanceof Kv){if(this._metrics.consumerCreationFailureCount+=1,o<=n)return i(a,o+1);throw c}throw c instanceof Jv&&(this._metrics.recvTransportFailureCount+=1),u.error("Error in consume request",c),c}};try{let a=await i(e);await bs(async o=>{o>0&&u.warn(`retrying consumers: attempt: ${o}`,{peerIds:e.map(({producingPeerId:l})=>l)});const c=[];a.forEach((l,p)=>{if(l.status==="rejected"){this._metrics.consumerCreationFailureCount+=1,c.push(e[p]);return}this._initConsumer(l.value)}),c.length&&(a=await i(c))})}catch(a){u.error("failed to create consumers",{error:a}),this._metrics.consumerCreationFailureCount+=1,this.handleErrors("reconnectRecvTransport")}}async pauseProducer(e){const s=this._producers.get(e);if(!s){u.warn(`producer type: ${e} not found`);return}s.pause(),s.appData.e2ee&&P.emit(k.E2EE_INACTIVE_PRODUCER,s),u.info(`Paused the producer of type: ${s.kind}`,{producer:{id:s.id,kind:s.kind,appData:s.appData}})}async resumeProducer(e){const s=this._producers.get(e);if(!s){u.warn(`producer type: ${e} not found`);return}s.resume(),u.info(`Resumed the producer of type: ${s.kind}`,{producer:{id:s.id,kind:s.kind,appData:s.appData}})}async replaceTrack(e,s){const n=this._producers.get(e);if(!n){u.warn(`producer type: ${e} not found`);return}await n.replaceTrack({track:s}),u.info(`Replaced track for the producer of type: ${n.kind}`,{producer:{id:n.id,kind:n.kind,appData:n.appData,trackId:s.id}})}async removeProducer(e,s){const n=this._producers.get(e);if(!n){u.warn(`producer type: ${e} not found`);return}s&&n.track.stop(),await this.sendTransport.awaitQueue.push(n.close.bind(n),"producer").then(()=>{d(this,Lr).getValue("modules").e2ee.enabled&&P.emit(k.E2EE_INACTIVE_PRODUCER,n)}).catch(i=>{u.error("failed to close producer on server",{error:i,producer:n})})}async pauseConsumer(e){const s=this._consumers.get(e);if(!s){u.warn(`consumer with id: ${e} not found`);return}this.toggleConsumerOverDC(e,!0),u.info(`Paused the consumer of type: ${s.kind}`,{consumer:{id:s.id,kind:s.kind,appData:s.appData}})}async pauseConsumerOverSocket(e){try{const s={consumerId:e.id,pause:!0};await this.socket.sendMessagePromise(Te.toggleConsumer,$c.toBinary(s)),e.pause(),P.emit(k.CONSUMER_PAUSED,{id:e.id}),u.info(`Paused the consumer of type: ${e.kind} over socket`,{consumer:{id:e.id,kind:e.kind,appData:e.appData}})}catch(s){u.error("error on pausing consumer",{error:s,consumer:{id:e.id,kind:e.kind,appData:e.appData}})}}async toggleConsumerOverDC(e,s){const n={type:"consumer_toggle",payload:{consumerId:e,mute:s}},i=this._recvTransport.getDatachannel("events");if(!i){u.warn("recvTransport:: events datachannel not found");return}await i.request(n),u.info(`HiveSFUHandler::consumer toggled, consumerId: ${e}, muted: ${s}`)}async resumeConsumer(e){const s=this._consumers.get(e);if(!s){u.warn(`consumer with id: ${e} not found`);return}if(!s.paused){u.warn(`consumer with id:${e} is not paused so not resuming`);return}try{const n={consumerId:e,pause:!1};await this.socket.sendMessagePromise(Te.toggleConsumer,$c.toBinary(n)),s.resume(),P.emit(k.CONSUMER_RESUMED,{id:s.id}),u.info(`Resumed the consumer of type: ${s.kind}`,{consumer:{id:s.id,kind:s.kind,appData:s.appData}})}catch(n){u.error("error on resuming consumer",n)}}async closeConsumer(e,s){return this.closeConsumers([e],s)}async closeConsumers(e,s=!1){u.info(`Closing consumers: ${JSON.stringify(e)} with force: ${s}`);let n=!0;const i=e.filter(c=>this._consumers.get(c)?!0:(u.warn(`consumer with id: ${c} not found`),!1));if(!i.length)return;const a={consumerIds:i},o=async()=>{var c;return(c=this._recvTransport)==null?void 0:c.awaitQueue.push(async()=>{await this._socketHandler.closeConsumer(a)},"close_consumer").catch(l=>{u.warn("error on closing consumer:",{error:l}),n=s})};s?o():await o(),n&&i.forEach(c=>{const l=this.consumers.get(c);l&&(this.producerIdToConsumerIdMap.delete(l.producerId),l.close(s?"force closed":void 0))})}async cleanupConsumers(e){u.debug("cleaning up all consumers");const s=[];this._consumers.forEach(n=>{e?n.peerId===e&&s.push(n.id):s.push(n.id)}),this.closeConsumers(s,!0)}async stopAllProducers(){u.info("stopping all available producers"),this._producers.forEach((e,s)=>{u.debug(`closing producer type: ${s}`,{producer:{id:e==null?void 0:e.id,kind:e.kind,appData:e.appData}}),e.close()})}getProducer(e){return Array.from(this.producers.values()).filter(s=>s.id===e).at(0)}hasProducer(e){return this.getProducer(e)!==void 0}async negotiate(e,s){u.debug(`setting remote offer : ${JSON.stringify(s)} on ${e.direction} transport`,{transport:{id:e.id,serverId:e.serverId,type:e.direction}});const n=await e.setRemoteOffer(s),i={transportId:e.serverId,description:{sdp:n.sdp,type:n.type,target:jt.SUBSCRIBER}};return u.debug(`sending renegotiate request: ${JSON.stringify(i)} on ${e.direction} transport`,{transport:{id:e.id,serverId:e.serverId,type:e.direction}}),await this.socket.sendMessagePromise(Te.renegotiateSessionDescription,mg.toBinary(i)),u.info("renegotiation done",{transport:{id:e.id,serverId:e.serverId,type:e.direction}}),n}async negotiateOverDC(e,s,n,i){const{sdp:a}=e.payload,o={sdp:a,type:"offer"};try{u.debug(`got offer over dc: ${a} for transport: ${i.id}`);const c=await i.setRemoteOffer(o),l={type:"answer",payload:{type:c.type,sdp:c.sdp}};u.debug(`datachannel answer: ${JSON.stringify(l)}`),i.sendResponseOverDC(n,s,l)}catch(c){u.error("datachannel:events::Error:",c),c.code!=="DC_NOT_FOUND"&&i.sendErrorOverDC(n,s,c)}}handleConsumerToggle(e){const{mute:s,trackId:n}=e;u.info(`consumer toggled for trackId: ${n} muted: ${s}`);const i=this.consumers.get(n);if(!i){u.warn(`consumer with trackId: ${n} not found`);return}i.paused!==s&&(u.debug("consumer state is not same",{consumer:{id:i.id,remotelyPaused:i.paused}}),s?(i.pause(),P.emit(k.CONSUMER_PAUSED,{id:i.id})):(i.resume(),P.emit(k.CONSUMER_RESUMED,{id:i.id})))}async handleErrorOverDC(e,s){u.error(`got error over dc: ${JSON.stringify(e)} for transport: ${s}`);const{type:n,error:i,id:a}=e;switch(n){case"consumer":{this._metrics.consumerCreationFailureCount+=1,u.error(`Error in consumer creation, this should not happen: ${n}, ${i}, ${a}`);return}case"producer":{if(i==="ready-fail"){if(this._producerNotReadyFailureCount>=2){this.handleErrors("reconnectSendTransport");return}this._producerNotReadyFailureCount+=1,this._metrics.producerCreationFailureCount+=1;const[o]=Array.from(this.producers.entries()).find(c=>c[1].id===a);if(!o)return;await this.removeProducer(o).catch(c=>{u.error("failed to remove ready-fail producer:",{error:c,producer:{id:a,kind:o,appData:null}})})}else i==="general-failure"&&this.handleErrors("reconnectSendTransport");u.error(`Unrecognized error: ${n}, ${i}, ${a}`);break}default:u.error(`Unrecognized error: ${n}, ${i}, ${a}`)}}async handleErrors(e){switch(e){case"rejoin":{u.warn("rejoining room"),this.emit("rejoin");break}case"reconnectSendTransport":{u.warn("reconnecting send transport"),this.triggerTransportReconnection(this._sendTransport);break}case"reconnectRecvTransport":{this.triggerTransportReconnection(this._recvTransport);break}default:u.error(`Could not handle error, unrecognized action ${e}`)}}triggerTransportReconnection(e){u.info("triggerTransportReconnection::reconnecting_transport",{transport:{type:e.direction,id:e.id,serverId:e.serverId}});const s=J.hasFeature(Z.ENABLE_HIVE_TRANSPORT_RECONNECTION_ON_ICE_FAILED),n=J.hasFeature(Z.HIVE_TRANSPORT_FORCE_RELAY_ON_ICE_FAILED);if(!s)return;const i=e.direction==="send"?"sendTransportFailureCount":"recvTransportFailureCount";n&&this._socket.isConnected&&(this._metrics[i]>2&&(u.warn("Multiple disconnections, forcing relay"),this._iceTransportPolicy="relay"),this._metrics[i]+=1),this.updateTransportState({state:Xt.RECONNECTING,direction:e.direction}),this.emit("reconnect_transport",e)}async switchConsumersToLayer(e,s){const n=this._recvTransport.getDatachannel("events");if(!n){u.warn("events datachannel not found");return}const i={type:"switch_consumer_layer",payload:{consumerIds:e,layer:s}};await n.request(i),u.info(`HiveSFUHandler::consumer id: ${e} layer switched to ${s}`)}updateTransportState(e){const{state:s,direction:n}=e;s==="disconnected"&&(this.transportDisconnected[n]=!0),d(this,Un,Bo).mediaState[n]={state:s,reconnected:s==="connected"?this.transportDisconnected[n]:d(this,Un,Bo).mediaState[n].reconnected},s==="connected"&&(this.transportDisconnected[n]=!1),P.emit(k.TRANSPORT_STATE_UPDATE,{transport:n,...d(this,Un,Bo).mediaState[n]})}}Un=new WeakSet,Bo=function(){return d(this,Lr).getValue("connectionHandler")},Lr=new WeakMap;function f1(r){return r.map(t=>({channels:t.channels,clockRate:t.clockRate,mimeType:t.mimeType,sdpFmtpLine:t.sdpFmtpLine}))}function g1(r){return r.map(t=>({uri:t.uri}))}function hd(r){return{codecs:f1(r.codecs),headerExtensions:g1(r.headerExtensions)}}function v1(r){const t=RTCRtpReceiver.getCapabilities("audio"),e=RTCRtpReceiver.getCapabilities("video"),s=RTCRtpSender.getCapabilities("audio"),n=RTCRtpSender.getCapabilities("video");r&&(e.codecs=e.codecs.filter(({mimeType:c})=>r===c),n.codecs=n.codecs.filter(({mimeType:c})=>r===c));const i={audio:hd(t),video:hd(e)};return{sender:{audio:hd(s),video:hd(n)},receiver:i}}class y1{constructor(t){E(this,wt,void 0);y(this,wt,t)}async joinRoom(t,e,s,n=!1,i=null){const a={roomUuid:t,displayName:e,prejoined:n,capabilities:s};return i&&(a.location=i),(await d(this,wt).sendMessagePromiseWithTimeout({event:Pe.joinRoom,protobuf:Tg.toBinary(a),timeout:5e3})).payload}async connectTransport(t){const e=(await d(this,wt).sendMessagePromise(Pe.createWebRTCTransport,pg.toBinary(t))).payload,{transportId:s,description:n}=_u.fromBinary(e),i={sdp:n==null?void 0:n.sdp,type:n.type};return{transportId:s,answer:i}}async produce(t){var i,a;const e=(await d(this,wt).sendMessagePromise(Pe.produce,_g.toBinary(t))).payload,s=Dg.fromBinary(e);return{answer:{sdp:(i=s==null?void 0:s.description)==null?void 0:i.sdp,type:(a=s==null?void 0:s.description)==null?void 0:a.type},producerId:s.producerId}}async consume(t){const e=(await d(this,wt).sendMessagePromise(Pe.consume,Ik.toBinary(t))).payload,{consumerIdsMap:{map:s},description:n}=Mg.fromBinary(e);return{consumerStateMap:s,sessionDescription:n}}async closeProducer(t){const e=(await d(this,wt).sendMessagePromise(Pe.closeProducer,wg.toBinary(t))).payload,{description:s}=Og.fromBinary(e);return s}async closeConsumer(t){return(await d(this,wt).sendMessagePromise(Pe.closeConsumer,bg.toBinary(t))).payload}async hostControlForPeer(t,e){const s={audio:e==="audio",screeShare:!1,video:e==="video",participantId:t},n=(await d(this,wt).sendMessagePromise(Pe.hostControlPeer,Pg.toBinary(s))).payload;if(!n)return!1;const{status:i}=xg.fromBinary(n);return i==="success"}async hostControlForAll(t){const e={audio:t==="audio",screenShare:!1,video:t==="video"},s=(await d(this,wt).sendMessagePromise(Pe.hostControlAllPeers,kg.toBinary(e))).payload;if(!s)return!1;const{status:n}=Fg.fromBinary(s);return n==="success"}async kickAll(){const t={propagateKickAcrossRooms:!1},e=(await d(this,wt).sendMessagePromise(Pe.kickAll,wu.toBinary(t))).payload;if(!e)return!1;const{status:s}=Lg.fromBinary(e);return s==="success"}async kickPeer(t){const e=(await d(this,wt).sendMessagePromise(Pe.kickPeer,Cg.toBinary(t))).payload;if(!e)return!1;const{status:s}=Ng.fromBinary(e);return s==="success"}async changeDisplayName(t){const e=(await d(this,wt).sendMessagePromise(Pe.changeDisplayName,Rg.toBinary(t))).payload;if(!e)return!1;const{status:s}=$g.fromBinary(e);return s==="success"}async notifySelfJoinComplete(){const t={},e=(await d(this,wt).sendMessagePromise(Pe.selfJoinComplete,Sg.toBinary(t))).payload;return Uc.fromBinary(e)}}wt=new WeakMap;const T1=2e3;class S1 extends Wv{constructor(e,s){super();E(this,Vn);m(this,"_device");m(this,"_sendTransport");m(this,"_recvTransport");m(this,"_consumers");m(this,"_producers");m(this,"_producerStatus");m(this,"_producerIdToConsumerIdMap");m(this,"_socket");m(this,"_socketHandler");m(this,"_totalTransportReconnectionCount");m(this,"_transportReconnectFailureCount");m(this,"_consumerCreationFailureCount");m(this,"_producerNotReadyFailureCount");m(this,"_consumerNotBoundFailureCount");m(this,"_transportDisconnectedTimer");m(this,"_iceTransportPolicy","all");m(this,"_transportConnectionFailCount",0);m(this,"lastConnectionTime",0);m(this,"transportDisconnected");E(this,xr,void 0);y(this,xr,e),this._device=new Zv(Zt.CF),this._socket=s,d(this,Vn,Ho).mediaState={recv:{state:Xt.NEW,reconnected:!1},send:{state:Xt.NEW,reconnected:!1}},this.transportDisconnected={recv:!1,send:!1},this._socketHandler=new y1(s),this.reset()}get socket(){return this._socket}get producers(){return this._producers}get consumers(){return this._consumers}get producerIdToConsumerIdMap(){return this._producerIdToConsumerIdMap}get socketHandler(){return this._socketHandler}get sendTransport(){return this._sendTransport}get recvTransport(){return this._recvTransport}reset(){this._producers=new Map,this._consumers=new Map,this._producerStatus=new Map,this._producerIdToConsumerIdMap=new Map,this._transportReconnectFailureCount=0,this._consumerCreationFailureCount=0,this._totalTransportReconnectionCount=0,this._producerNotReadyFailureCount=0,this._consumerNotBoundFailureCount=0,this._transportDisconnectedTimer={consuming:void 0,producing:void 0}}async setupTransports(e){var a,o,c,l,p,h,f,g;const n=await tt().getICEServers().catch(_=>(u.warn(`failed to get iceservers from server: ${_.message}`),[])),i=[];if(e.send){const _=this.createSendTransport({iceServers:n,additionalSettings:{encodedInsertableStreams:(a=d(this,xr).getValue("modules").e2ee)==null?void 0:a.enabled},config:{enableHighBitrate:(l=(c=(o=d(this,xr).getValue("defaults").mediaConfiguration)==null?void 0:o.audio)==null?void 0:c.enableHighBitrate)!=null?l:!1,enableStereo:(f=(h=(p=d(this,xr).getValue("defaults").mediaConfiguration)==null?void 0:p.audio)==null?void 0:h.enableStereo)!=null?f:!1},iceTransportPolicy:this._iceTransportPolicy}).then(()=>u.debug("Created send transport"));i.push(_)}if(e.recv){const _=this.createRecvTransport({iceServers:n,additionalSettings:{encodedInsertableStreams:(g=d(this,xr).getValue("modules").e2ee)==null?void 0:g.enabled},iceTransportPolicy:this._iceTransportPolicy}).then(()=>u.debug("Created recv transport"));i.push(_)}await Promise.all(i)}stopAllTransports(){var e,s,n,i;u.info(" closing all the transports"),(e=this._sendTransport)==null||e.close(),(s=this._sendTransport)==null||s.removeAllListeners(),(n=this._recvTransport)==null||n.close(),(i=this._recvTransport)==null||i.removeAllListeners(),this._sendTransport=void 0,this._recvTransport=void 0,this.reset()}async createSendTransport(e){var n,i,a,o;if(this._sendTransport&&this._sendTransport.connected){u.info("sendTransport::already_exists_in_connected_state",{transport:{id:(n=this._sendTransport)==null?void 0:n.id,serverId:(i=this._sendTransport)==null?void 0:i.serverId,type:"send"}});return}u.info("sendTransport::initializing_transport",{transport:{id:(a=this._sendTransport)==null?void 0:a.id,serverId:(o=this._sendTransport)==null?void 0:o.serverId,type:"send"}});const s=this._device.createSendTransport(e);this._transportDisconnectedTimer.producing=void 0,u.info("sendTransport::initialized_transport",{transport:{id:s==null?void 0:s.id,serverId:s==null?void 0:s.serverId,type:"send"}}),this.handleTransport(s,!1),u.info("sendTransport::connecting_transport",{transport:{id:s==null?void 0:s.id,serverId:s==null?void 0:s.serverId,type:"send"}});try{await bs(async(c,l)=>{this.socket.isConnected||l(new Error("socket is not connected")),s.connectionState==="closed"&&l(new Error("transport is closed")),c>0&&u.debug(`retrying transport connect, count: ${c}`,{transport:{id:s.id,serverId:s.serverId,type:"send"}});try{await s.connect()}catch(p){throw u.error(`failed to connect send transport: ${s.id}`,{error:p,transport:{id:s.id,serverId:s.serverId,type:"send"}}),p.message==="ice connection failed"&&l(p),p}},{delayTime:100,strategy:"exponential",maxRetryCount:J.hasFeature(Z.ENABLE_CF_INFINITE_RETRIES)?1/0:3}),u.info("sendTransport::connected_transport",{transport:{id:s==null?void 0:s.id,serverId:s==null?void 0:s.serverId,type:"send"}}),this._transportReconnectFailureCount=Math.max(0,this._transportReconnectFailureCount-1),this._producerNotReadyFailureCount=0,this._sendTransport=s,q.configureSendTransport(s)}catch(c){throw u.error(`failed to connect send transport after retry:${s.id}`,{error:c,transport:{id:s==null?void 0:s.id,serverId:s==null?void 0:s.serverId,type:"send"}}),s.close(),s.removeAllListeners(),this._transportReconnectFailureCount+=1,this.handleFailure(),c}}async createRecvTransport(e){var n,i,a,o,c;if(this._recvTransport&&this._recvTransport.connected){u.info("recvTransport::already_exists_in_connected_state",{transport:{id:(n=this._recvTransport)==null?void 0:n.id,serverId:(i=this._recvTransport)==null?void 0:i.serverId,type:"recv"}});return}u.info("recvTransport::initializing_transport",{transport:{id:(a=this._recvTransport)==null?void 0:a.id,serverId:(o=this._recvTransport)==null?void 0:o.serverId,type:"recv"}});const s=this._device.createRecvTransport({...e,additionalSettings:{...(c=e.additionalSettings)!=null?c:{},rtcAudioJitterBufferMaxPackets:25,rtcAudioJitterBufferFastAccelerate:!0,rtcAudioJitterBufferMinDelayMs:20}});this._transportDisconnectedTimer.consuming=void 0,u.info("recvTransport::initialized_transport",{transport:{id:s==null?void 0:s.id,serverId:s==null?void 0:s.serverId,type:"recv"}}),this.handleTransport(s,!0),u.info("recvTransport::connecting_transport",{transport:{id:s==null?void 0:s.id,serverId:s==null?void 0:s.serverId,type:"recv"}});try{await bs(async(l,p)=>{this.socket.isConnected||p(new Error("socket is not connected")),s.connectionState==="closed"&&p(new Error("transport is closed")),l>0&&u.debug(`retrying transport connect, count: ${l}`,{transport:{id:s==null?void 0:s.id,serverId:s==null?void 0:s.serverId,type:"recv"}});try{await s.connect()}catch(h){throw u.error(`fail to connect recv transport: ${s.id}`,{error:h,transport:{id:s==null?void 0:s.id,serverId:s==null?void 0:s.serverId,type:"recv"}}),h.message==="ice connection failed"&&p(h),h}},{delayTime:100,strategy:"exponential",maxRetryCount:J.hasFeature(Z.ENABLE_CF_INFINITE_RETRIES)?1/0:3}),u.info("recvTransport::connected_transport",{transport:{id:s==null?void 0:s.id,serverId:s==null?void 0:s.serverId,type:"recv"}}),this._transportReconnectFailureCount=Math.max(0,this._transportReconnectFailureCount-1),this._consumerCreationFailureCount=0,this._consumerNotBoundFailureCount=0,this.producerIdToConsumerIdMap.clear(),this._recvTransport=s,q.configureRecvTransport(s)}catch(l){throw u.error(`failed to connect recv transport after retry:${s.id}`,{error:l,transport:{id:s==null?void 0:s.id,serverId:s==null?void 0:s.serverId,type:"recv"}}),s.close(),s.removeAllListeners(),this._transportReconnectFailureCount+=1,this.handleFailure(),l}}handleTransport(e,s){if(e.on("connect",async({offer:n},i,a)=>{try{const o={consuming:s,description:{sdp:n.sdp,type:n.type,target:s?jt.SUBSCRIBER:jt.PUBLISHER}},{transportId:c,answer:l}=await this._socketHandler.connectTransport(o);e.setServerId(c),i({answer:l})}catch(o){u.error(`${s?"consumer":"producer"} transport connection error:`,{error:o,transport:{id:e==null?void 0:e.id,serverId:e==null?void 0:e.serverId,type:s?"recv":"send"}}),a(o)}}),e.on("connectionstatechange",async n=>{this.updateTransportState({state:n,direction:s?"recv":"send"}),u.info(`${s?"consumer":"producer"} transport connectionState:`,{transport:{id:e==null?void 0:e.id,serverId:e==null?void 0:e.serverId,type:s?"recv":"send",status:n}});const i=()=>{this._transportDisconnectedTimer[s?"consuming":"producing"]!==void 0&&(clearTimeout(this._transportDisconnectedTimer[s?"consuming":"producing"]),this._transportDisconnectedTimer[s?"consuming":"producing"]=void 0)};switch(n){case"connected":i(),this.lastConnectionTime=performance.now();break;case"disconnected":this._transportDisconnectedTimer[s?"consuming":"producing"]=setTimeout(()=>{this.triggerTransportReconnection(e,s)},T1);break;case"failed":if(e.closed)return;i(),this.triggerTransportReconnection(e,s);break}}),e.on("icecandidate",async n=>{u.debug("sending icecandidate:",{iceCandidate:n})}),e.on("datachannel:events",async(n,i)=>{var a,o;u.debug("got data channel message on event:",{rtcChannel:{label:n,message:i}});try{switch(i.type){case"negotiation":{this.negotiateOverDC(i,ud(i),n,e);break}case"handshake":{const c={type:"handshake",payload:{message:"pong"}};e.sendResponseOverDC(n,ud(i),c);break}case"consumer_toggle":{this.handleConsumerToggle(i.payload);break}case"hub-disconnect":{u.debug(`media hub disconnected, full_reconnect: ${(a=i.payload)==null?void 0:a.full_reconnect}`),((o=i.payload)==null?void 0:o.full_reconnect)===!0&&this.emit("rejoin");break}case"error":{this.handleErrorOverDC(i.payload,e.id);break}default:u.warn(`unknown event received from cf node, event: ${i.type}`);break}}catch(c){u.error(`Unable to handle the incoming datachannel message on channel ${n}`)}}),e.on("dc_error",()=>{e.direction==="recv"&&(u.warn("events datachannel did not open in 5s"),this.handleFailure())}),e.on("negotiate",async({description:n},i,a)=>{try{const o={sdp:n==null?void 0:n.sdp,type:n==null?void 0:n.type},c=await this.negotiate(e,o);i({answer:c})}catch(o){u.error("negotiate error:",{transport:{id:e.id,serverId:e.serverId,type:e.direction},error:o}),a(o)}}),!s){e.on("produce",async({offer:n,kind:i,paused:a,appData:o,codecOptions:c},l,p)=>{var _,w;const f=cd(n.sdp).media.filter(R=>i==="video"?R.type==="video":R.type==="audio").at(-1).msid,g={description:{sdp:n.sdp,type:n.type,target:jt.PUBLISHER},paused:a,kind:i,msid:f,appData:JSON.stringify(o),screenShare:(_=o.screenShare)!=null?_:!1,mimeType:`${i}/${(w=c[0])==null?void 0:w.name}`};try{const{answer:R,producerId:D}=await this._socketHandler.produce(g);l({answer:R,producerId:D})}catch(R){u.error("create producer error:",{error:R}),p(R)}});return}e.on("consume_peer",async({producers:n},i,a)=>{const o=new Map,c=[];n.forEach(l=>{const{producingPeerId:p,producerId:h}=l;o.set(h,p),c.push({producingPeerId:p,producerId:h})});try{const l=await this._socketHandler.consume({requests:c});u.debug("consumePeer response:",{consumerStateMap:l.consumerStateMap});const p=new Map;Object.entries(l.consumerStateMap).forEach(([h,f])=>{var _,w,R;let g={};try{g=JSON.parse(f.producerState.appData)}catch(D){}p.set(h,{consumerId:f.consumerId,trackId:(_=f.producerTrack)==null?void 0:_.trackId,streamId:f.producerTrack.streamId,kind:f.producerState.kind===hr.VIDEO?"video":"audio",appData:g,screenShare:(w=f.producerState)==null?void 0:w.screenShare,paused:(R=f.producerState)==null?void 0:R.pause,producingPeerId:o.get(h)})}),i({sessionDescription:l.sessionDescription,consumersMap:p})}catch(l){u.error("consumePeer error:",{error:l}),a(l)}})}async createProducer(e,s,n){var a;if(this._sendTransport===void 0||this._sendTransport.closed)return null;u.info("createProducer::initializing_producer",{producer:{id:"TO_BE_CREATED",kind:e,status:"initializing",appData:s==null?void 0:s.appData}});const i=this._producerStatus.get(e);if((i==null?void 0:i.trackId)===s.track.id&&(i==null?void 0:i.status)===zr.INITIALIZING)return u.info("createProducer::producer getting initializing",{producer:{id:"GETTING_CREATED",status:"initializing",kind:e,appData:s==null?void 0:s.appData}}),null;this._producerStatus.set(e,{trackId:s.track.id,status:zr.INITIALIZING});try{const o=await this._sendTransport.produce(s);return(a=s.appData)!=null&&a.e2ee&&P.emit(k.E2EE_ACTIVE_PRODUCER,o),u.info("createProducer::initialized_producer",{producer:{id:o==null?void 0:o.id,kind:e,status:"producing",appData:s==null?void 0:s.appData}}),o.on("close",async({offer:c,reason:l},p)=>{u.info("producer::closing",{debuggingHint:l,producer:{id:o==null?void 0:o.id,kind:e,status:"closing",appData:s==null?void 0:s.appData}});const h={producerId:o.id,description:{sdp:c.sdp,type:c.type,target:jt.PUBLISHER}};try{const f=await this._socketHandler.closeProducer(h),g={sdp:f==null?void 0:f.sdp,type:f==null?void 0:f.type};u.info("producer::closed",{producer:{id:o==null?void 0:o.id,kind:e,status:"closed",appData:s==null?void 0:s.appData}}),p({answer:g})}catch(f){u.error("producer close error",f)}this._producerStatus.delete(e),this._producers.delete(e),n(),this.reconfigureWebcamLayers()}),o.on("trackended",()=>{u.info("producer::trackended",{producer:{id:o==null?void 0:o.id,kind:e,status:"UNKNOWN",appData:o==null?void 0:o.appData}}),[le.MIC,le.WEBCAM].includes(e)||n()}),this._producers.set(e,o),this._producerStatus.set(e,{trackId:s.track.id,status:zr.INITIALIZED}),this.reconfigureWebcamLayers(),o.track}catch(o){throw this._producerStatus.set(e,{status:zr.NOT_INITIALIZED,trackId:s.track.id}),u.error("createProducer::transport_initialization_failed",{producer:{id:"FAILED_TO_CREATE",kind:e,status:"failed",appData:s==null?void 0:s.appData,error:o}}),o}}async reconfigureWebcamLayers(){if(!J.hasFeature(Z.DISABLE_WEBCAM_LAYERS_ON_SCREENSHARE))return;const e=this.producers.get(le.WEBCAM);e&&await this._switchProducerSpatialLayer(e,this.producers.get(le.SCREENSHARE_VIDEO)?0:3)}async _switchProducerSpatialLayer(e,s){try{u.debug("switching layer of webcam producer to:",{media:{video:{layer:s}},producer:{id:e.id,kind:e.kind,appData:e.appData}}),await e.setMaxSpatialLayer(s)}catch(n){u.error("failed to switch spatial layer",{error:n})}}_initConsumer(e){e&&(e.observer.on("close",async s=>{u.debug("consumer closed",{consumer:{closureReason:s,id:e.id,kind:e.kind,appData:e.appData}}),this._consumers.delete(e.id),P.emit(k.CONSUMER_CLOSED,{id:e.id})}),this._consumers.set(e.id,e),this.producerIdToConsumerIdMap.set(e.producerId,e.id),P.emit(k.NEW_CONSUMER,{id:e.id,appData:e.appData,peerId:e.peerId}))}async createConsumers(e){if(this._recvTransport===void 0||this._recvTransport.closed||!this._recvTransport.connected)return;if(e.every(n=>this.getProducer(n.producerId))){u.warn("why are you creating a consumer for local producer?");return}await bs(async n=>{n>0&&u.debug(`retrying consume call, retryCount: ${n}`),(await this._recvTransport.consume(e).catch(a=>{throw u.error("failed to consume:",{error:a}),a})).forEach(a=>{a.status==="rejected"?(u.error("consumer creation task is failing",a.reason),this._consumerCreationFailureCount+=1,setTimeout(this.handleFailure.bind(this),0)):this._initConsumer(a.value)})}).catch(n=>{u.error("create consumer failed after retries",{error:n}),this._consumerCreationFailureCount+=1,this.handleFailure()})}async pauseProducer(e){const s=this._producers.get(e);if(!s){u.warn(`producer type: ${e} not found`);return}s.pause(),s.appData.e2ee&&P.emit(k.E2EE_INACTIVE_PRODUCER,s),u.info(`Paused the producer of type: ${s.kind}`,{producer:{id:s.id,kind:s.kind,appData:s.appData}})}async resumeProducer(e){const s=this._producers.get(e);if(!s){u.warn(`producer type: ${e} not found`);return}s.resume(),u.info(`Resumed the producer of type: ${s.kind}`,{producer:{id:s.id,kind:s.kind,appData:s.appData}})}async replaceTrack(e,s){const n=this._producers.get(e);if(!n){u.warn(`producer type: ${e} not found`);return}await n.replaceTrack({track:s}),u.info(`Replaced track for the producer of type: ${n.kind}`,{producer:{id:n.id,kind:n.kind,appData:n.appData,trackId:s.id}})}async removeProducer(e,s){const n=this._producers.get(e);if(!n){u.warn(`producer type: ${e} not found`);return}s&&n.track.stop(),await this.sendTransport.awaitQueue.push(n.close.bind(n),"producer").then(()=>{d(this,xr).getValue("modules").e2ee.enabled&&P.emit(k.E2EE_INACTIVE_PRODUCER,n)}).catch(i=>{u.error("failed to close producer on server",i)})}async pauseConsumer(e){const s=this._consumers.get(e);if(!s){u.warn(`consumer with id: ${e} not found`);return}this.toggleConsumerOverDC(e,!0),u.info(`Paused the consumer of type: ${s.kind}`,{consumer:{id:s.id,kind:s.kind,appData:s.appData}})}async pauseConsumerOverSocket(e){try{const s={consumerId:e.id,pause:!0};await this.socket.sendMessagePromise(Pe.toggleConsumer,$c.toBinary(s)),e.pause(),P.emit(k.CONSUMER_PAUSED,{id:e.id}),u.info(`Paused the consumer of type: ${e.kind} over socket`,{consumer:{id:e.id,kind:e.kind,appData:e.appData}})}catch(s){u.error("error on pausing consumer",{error:s,consumer:{id:e.id,kind:e.kind,appData:e.appData}})}}async toggleConsumerOverDC(e,s){const n={type:"consumer_toggle",payload:{consumerId:e,mute:s}},i=this._recvTransport.getDatachannel("events");if(!i){u.warn("recvTransport:: events datachannel not found");return}await i.request(n),u.info(`HiveSFUHandler::consumer toggled, consumerId: ${e}, muted: ${s}`)}async resumeConsumer(e){const s=this._consumers.get(e);if(!s){u.warn(`consumer with id: ${e} not found`);return}if(!s.paused){u.warn(`consumer with id:${e} is not paused so not resuming`);return}try{const n={consumerId:e,pause:!1};await this.socket.sendMessagePromise(Pe.toggleConsumer,$c.toBinary(n)),s.resume(),P.emit(k.CONSUMER_RESUMED,{id:s.id}),u.info(`Resumed the consumer of type: ${s.kind}`,{consumer:{id:s.id,kind:s.kind,appData:s.appData}})}catch(n){u.error("error on resuming consumer",n)}}async closeConsumer(e,s){return this.closeConsumers([e],s)}async closeConsumers(e,s=!1){u.info(`Closing consumers: ${JSON.stringify(e)} with force: ${s}`);let n=!0;const i=e.filter(c=>this._consumers.get(c)?!0:(u.warn(`consumer with id: ${c} not found`),!1));if(!i.length)return;const a={consumerIds:i},o=async()=>{var c;return(c=this._recvTransport)==null?void 0:c.awaitQueue.push(async()=>{await this._socketHandler.closeConsumer(a)},"close_consumer").catch(l=>{u.warn("error on closing consumer:",{error:l}),n=s})};s?o():await o(),n&&i.forEach(c=>{const l=this.consumers.get(c);this.producerIdToConsumerIdMap.delete(l.producerId),l.close(s?"force closed":void 0)})}async cleanupConsumers(e){u.debug("cleaning up all consumers");const s=[];this._consumers.forEach(n=>{e?n.peerId===e&&s.push(n.id):s.push(n.id)}),this.closeConsumers(s,!0)}async stopAllProducers(){u.info("stopping all available producers"),this._producers.forEach((e,s)=>{u.debug(`closing producer type: ${s}`,{producer:{id:e==null?void 0:e.id,kind:e.kind,appData:e.appData}}),e.close()})}getProducer(e){return Array.from(this.producers.values()).filter(s=>s.id===e).at(0)}hasProducer(e){return this.getProducer(e)!==void 0}async negotiate(e,s){u.debug(`setting remote offer : ${JSON.stringify(s)} on ${e.direction} transport`,{transport:{id:e.id,serverId:e.serverId,type:e.direction}});const n=await e.setRemoteOffer(s),i={transportId:e.serverId,description:{sdp:n.sdp,type:n.type,target:jt.SUBSCRIBER}};return u.debug(`sending renegotiate request: ${JSON.stringify(i)} on ${e.direction} transport`,{transport:{id:e.id,serverId:e.serverId,type:e.direction}}),await this.socket.sendMessagePromise(Pe.renegotiateSessionDescription,mg.toBinary(i)),u.info("renegotiation done",{transport:{id:e.id,serverId:e.serverId,type:e.direction}}),n}async negotiateOverDC(e,s,n,i){const{sdp:a}=e.payload,o={sdp:a,type:"offer"};try{u.debug(`got offer over dc: ${a} for transport: ${i.id}`);const c=await i.setRemoteOffer(o),l={type:"answer",payload:{type:c.type,sdp:c.sdp}};u.debug(`datachannel answer: ${JSON.stringify(l)}`),i.sendResponseOverDC(n,s,l)}catch(c){u.error("datachannel:events::Error:",c),c.code!=="DC_NOT_FOUND"&&i.sendErrorOverDC(n,s,c)}}handleConsumerToggle(e){const{mute:s,trackId:n}=e;u.info(`consumer toggled for trackId: ${n} muted: ${s}`);const i=this.consumers.get(n);if(!i){u.warn(`consumer with trackId: ${n} not found`);return}i.paused!==s&&(u.debug("consumer state is not same",{consumer:{id:i.id,remotelyPaused:i.paused}}),s?(i.pause(),P.emit(k.CONSUMER_PAUSED,{id:i.id})):(i.resume(),P.emit(k.CONSUMER_RESUMED,{id:i.id})))}async handleErrorOverDC(e,s){u.error(`got error over dc: ${JSON.stringify(e)} for transport: ${s}`);const{type:n,error:i,id:a}=e;if(n==="consumer"){if(i==="bind-fail"){if(this._consumerNotBoundFailureCount>=2){this.handleFailure();return}this._consumerNotBoundFailureCount+=1;const o=this.consumers.get(a);if(!o)return;try{await this.closeConsumer(o.id),await this.createConsumers([{kind:o.kind,pause:o.paused,producerId:o.producerId,producingTransportId:o.producingTransportId,screenShare:o.appData.screenShare,producingPeerId:o.peerId}])}catch(c){u.error("failed to recreate consumer on downtrack bound failure,",{consumer:{id:o.id,producerId:o.producerId,kind:o.kind,appData:o.appData}})}}}else if(n==="producer")if(i==="ready-fail"){if(this._producerNotReadyFailureCount>=2){this.handleFailure();return}this._producerNotReadyFailureCount+=1;const[o]=Array.from(this.producers.entries()).find(c=>c[1].id===a);if(!o)return;await this.removeProducer(o).catch(c=>{u.error("failed to remove ready-fail producer:",{error:c,producer:{id:a,kind:o,appData:null}})})}else i==="general-failure"&&(this.updateTransportState({state:Xt.RECONNECTING,direction:"send"}),this.emit("reconnect_transport",this._sendTransport))}async handleFailure(){if(this._transportReconnectFailureCount>0||this._totalTransportReconnectionCount>3){u.warn("transport failure detected"),J.hasFeature(Z.ENABLE_CF_EXPERIMENTAL_FAIL_RECOVERY)&&(u.debug("rejoining room"),this.emit("rejoin"));return}(this._consumerCreationFailureCount>0||this._consumerNotBoundFailureCount>=2)&&(u.warn("consumer creation failure detected or consumer not bound failure increased"),J.hasFeature(Z.ENABLE_CF_EXPERIMENTAL_FAIL_RECOVERY)&&(u.debug("reconnecting recv transport"),this._totalTransportReconnectionCount+=1,this.updateTransportState({state:Xt.RECONNECTING,direction:"recv"}),this.emit("reconnect_transport",this._recvTransport))),this._producerNotReadyFailureCount>=2&&(u.warn("producer receiver not getting added needs to reconnect send transport"),this._totalTransportReconnectionCount+=1,this.updateTransportState({state:Xt.RECONNECTING,direction:"send"}),this.emit("reconnect_transport",this._sendTransport))}triggerTransportReconnection(e,s){u.info("triggerTransportReconnection:: reconnecting transport",{transport:{type:e.direction,id:e.id,serverId:e.serverId}});const n=J.hasFeature(Z.ENABLE_CF_TRANSPORT_RECONNECTION_ON_ICE_FAILED),i=J.hasFeature(Z.CF_TRANSPORT_FORCE_RELAY_ON_ICE_FAILED);n&&(i&&this._socket.isConnected&&(performance.now()-this.lastConnectionTime>2e4&&(this._transportConnectionFailCount=0),this._transportConnectionFailCount>2&&(u.warn("Multiple disconnections, forcing relay"),this._iceTransportPolicy="relay"),this._transportConnectionFailCount+=1),this.updateTransportState({state:Xt.RECONNECTING,direction:s?"recv":"send"}),this.emit("reconnect_transport",e))}async switchConsumersToLayer(e,s){const n=this._recvTransport.getDatachannel("events");if(!n){u.warn("events datachannel not found");return}const i={type:"switch_consumer_layer",payload:{consumerIds:e,layer:s}};await n.request(i),u.info(`CFSFUHandler::consumer id: ${e} layer switched to ${s}`)}updateTransportState(e){const{state:s,direction:n}=e;s==="disconnected"&&(this.transportDisconnected[n]=!0),d(this,Vn,Ho).mediaState[n]={state:s,reconnected:s==="connected"?this.transportDisconnected[n]:d(this,Vn,Ho).mediaState[n].reconnected},s==="connected"&&(this.transportDisconnected[n]=!1),P.emit(k.TRANSPORT_STATE_UPDATE,{transport:n,...d(this,Vn,Ho).mediaState[n]})}}Vn=new WeakSet,Ho=function(){return d(this,xr).getValue("connectionHandler")},xr=new WeakMap;var E1=Object.defineProperty,_1=Object.getOwnPropertyDescriptor,ae=(r,t,e,s)=>{for(var n=s>1?void 0:s?_1(t,e):t,i=r.length-1,a;i>=0;i--)(a=r[i])&&(n=(s?a(t,e,n):a(n))||n);return s&&n&&E1(t,e,n),n};const Ir=["video/VP9","video/VP8"];class ie{constructor(t,e,s){E(this,$r);m(this,"meetingId");m(this,"roomName");m(this,"meetingTitle");m(this,"context");m(this,"authToken");m(this,"roomNodeUrl");m(this,"legacyMode");m(this,"e2ee");E(this,uo,void 0);E(this,ho,void 0);E(this,bt,void 0);E(this,re,void 0);E(this,ea,void 0);E(this,ut,void 0);E(this,Fr,void 0);E(this,Bn,void 0);E(this,Hn,void 0);E(this,js,void 0);E(this,po,void 0);E(this,mo,void 0);E(this,fo,void 0);E(this,cs,void 0);E(this,Gs,void 0);E(this,ta,void 0);E(this,qn,void 0);E(this,jn,void 0);m(this,"partialJoinRoomPromise");var l,p;this.context=t;const{meetingId:n,authToken:i,legacyMode:a,socket:o,meetingTitle:c}=s;switch(this.mediaJoined=!1,this.meetingId=n,this.roomName=n,this.authToken=i,this.legacyMode=a,this.meetingTitle=c,y(this,qn,new Map([["video/VP9",new Set],["video/VP8",new Set]])),y(this,jn,new Map([["video/VP9",new Set],["video/VP8",new Set]])),e){case Zt.HIVE:{y(this,ut,Te),y(this,re,new ey(t,o));break}case Zt.CF:{y(this,ut,Pe),y(this,re,new S1(t,o));break}default:y(this,ut,Te),y(this,re,new ey(t,o))}y(this,bt,o),y(this,Fr,!1),y(this,Gs,6),y(this,cs,new Set),y(this,Bn,!1),y(this,Hn,0),y(this,js,new id),this.e2ee=(p=(l=t.getValue("modules").e2ee)==null?void 0:l.enabled)!=null?p:!1,q.legacySwitch(a),this.handleSocketEvents(),this.handleSFUEvents(),this.handleCallstatsEvents(),y(this,po,ti(async()=>{if(!d(this,$r,zs).mediaJoinAttempted)return;const{roomJoined:h}=await this.joinRoom(this.peerDisplayName,this.roomUUID,{},!0,!0);h&&(P.emit(k.RESET_PRODUCER_STATE),P.emit(k.ROOM_NODE_RECONNECTED))},5e3,{leading:!0,maxWait:1e3})),y(this,mo,ti(async h=>{h.close(),h.removeAllListeners(),await this.sfuHandler.setupTransports({send:!0}),u.info("send transport reconected!"),P.emit(k.RESET_PRODUCER_STATE)},1e3)),y(this,fo,ti(async h=>{h.close(),h.removeAllListeners(),await this.sfuHandler.setupTransports({recv:!0}),u.info("recv transport reconnected!"),P.emit(k.UPDATE_ACTIVE,{createAllConsumers:!0})},1e3))}get peerId(){return this.context.getValue("peerId")}get peerDisplayName(){return d(this,ho)}get roomUUID(){return d(this,uo)}get maxPreferredStreams(){return d(this,Gs)}set maxPreferredStreams(t){y(this,Gs,t)}get mediaState(){return d(this,$r,zs).mediaState}get sfuHandler(){return d(this,re)}get rejoinRoom(){return d(this,po)}get mediaJoined(){return d(this,$r,zs).mediaJoined}set mediaJoined(t){d(this,$r,zs).mediaJoined=t}reset(t=!0){var e,s,n,i;(s=(e=d(this,re))==null?void 0:e.cleanupConsumers)==null||s.call(e),(i=(n=d(this,re))==null?void 0:n.stopAllProducers)==null||i.call(n),d(this,cs).clear(),t&&(this.partialJoinRoomPromise=void 0,d(this,js).stop(),d(this,re).stopAllTransports(),d(this,re).reset(),y(this,js,new id))}async reconnectTransport(t){u.info(`MediaNodeClient::Room joining state: ${d(this,Fr)}`),!(!t||d(this,Fr))&&(t.direction==="send"?await d(this,mo).call(this,t):await d(this,fo).call(this,t))}async setupTransports(){await d(this,re).setupTransports({send:!0,recv:!0})}async stopAllProducers(){await d(this,re).stopAllProducers()}async joinRoom(t,e,s={},n=!1,i=!1){d(this,$r,zs).mediaJoinAttempted=!0,y(this,Fr,!0),this.reset(n);const a=tt().ipInfo;if(a!=null&&a.loc&&!d(this,ta)){const c=a.loc.split(",");y(this,ta,{latitude:parseFloat(c[0]),longitude:parseFloat(c[1])})}let o;try{return o=await d(this,js).push(()=>this._joinRoom(t,e,s,i,d(this,ta)),"joinRoom"),o}catch(c){o={roomJoined:!1}}return o.roomJoined||P.emit(k.ROOM_NODE_FAILED),o}async _partialJoinRoom(t,e,s=!1,n=void 0){var l;const{ipInfo:i}=tt();let a=n;if(i!=null&&i.loc&&!n){const[p,h]=i.loc.split(",").map(parseFloat);a={latitude:p,longitude:h}}const o=(l=J.getValue(Z.FORCE_VIDEO_CODEC))==null?void 0:l.toString(),c=v1(o);y(this,ea,c),y(this,Gs,this.context.getValue("maxPreferredStreams")),await bs(async(p,h)=>{if(!d(this,bt).isConnected){h(new Error("socket is not connected"));return}p>0&&u.warn(`retrying sending join room request, count: ${p}`);try{await this.sfuHandler.socketHandler.joinRoom(e,t,c,s,a)}catch(f){throw u.error("failed to send join room request, error:",{error:f}),f}},{delayTime:1e3,strategy:"exponential",maxRetryCount:J.hasFeature(Z.ENABLE_HIVE_INFINITE_RETRIES)?1/0:3}),await this.setupTransports()}async partialJoinRoom(t,e,s=!1,n=void 0){return this.partialJoinRoomPromise=d(this,js).push(()=>this._partialJoinRoom(t,e,s,n)),this.partialJoinRoomPromise}async _joinRoom(t,e,s={},n=!1,i=null){y(this,ho,t);try{this.partialJoinRoomPromise?await this.partialJoinRoomPromise:await this._partialJoinRoom(t,e,n,i)}catch(a){u.error("error in partial join room",{error:a})}finally{this.partialJoinRoomPromise=void 0}try{return navigator.product!=="ReactNative"&&setTimeout(async()=>{const c={userId:this.context.getValue("userId"),peerId:this.peerId,roomUUID:e,roomViewType:"groupCall",deviceInfo:{...Re.getDeviceInfo(),userAgent:navigator.userAgent,memory:navigator.deviceMemory,cpus:navigator.hardwareConcurrency},sdkName:this.context.getValue("sdkName"),sdkVersion:this.context.getValue("sdkVersion"),metaData:{},permissions:{}};q.roomJoined(c)}),{roomJoined:await this.completeJoinRoom()}}catch(a){return u.error("error on sending join room request",{error:a}),{roomJoined:!1}}}async completeJoinRoom(){try{this.mediaJoined=!0;const{maxPreferredStreams:t,roomState:e}=await this.sfuHandler.socketHandler.notifySelfJoinComplete();return y(this,uo,e.roomUuid),y(this,Bn,!0),y(this,Fr,!1),y(this,Gs,t!=null?t:6),!0}catch(t){return u.error("error on completing join room:",{error:t}),this.mediaJoined=!1,!1}}async leaveRoom(){d(this,re).stopAllTransports(),y(this,Bn,!1),d(this,$r,zs).mediaJoinAttempted=!1;const t={closeRoom:!1};d(this,bt).sendMessagePromise(d(this,ut).leaveRoom,Ck.toBinary(t)).then(e=>{var n;((n=rI.fromBinary(e.payload))==null?void 0:n.closed)||u.warn("weird state on peer closed and should not happen")}).catch(e=>{u.error("error on sending leave room request",{error:e})}),q.callEnded(),v.destruct()}getConsumers(){return d(this,re).consumers}async activatePeers(t){return this.createConsumers(t)}async deactivatePeers(t,e="default"){const s=new Set;t.forEach(i=>{i.screenShare&&i.kind==="video"&&s.add(i.producingPeerId)});const n=e==="default"?t.filter(i=>!s.has(i.producingPeerId)).filter(i=>i.kind!=="audio"):t;await Promise.all(n.map(i=>{const a=this.sfuHandler.producerIdToConsumerIdMap.get(i.producerId);if(!a){u.warn(`consumer not found in deactivate producers: ${i.producerId}`);return}return this.sfuHandler.closeConsumer(a)}))}async createConsumers(t){return t.length===0?Promise.resolve():this.sfuHandler.createConsumers(t)}async pauseConsumers(t){t.forEach(e=>{this.sfuHandler.pauseConsumer(e)})}async resumeConsumers(t){t.forEach(e=>{this.sfuHandler.resumeConsumer(e)})}async closeConsumers(t){if(!t.length)return;const e=t.reduce((s,n)=>{const i=this.sfuHandler.producerIdToConsumerIdMap.get(n.producerId);return i?(s.push(i),s):(u.warn(`consumer not found in deactivate producers: ${n.producerId}`),s)},[]);await this.sfuHandler.closeConsumers(e)}async _shareWebcam(t,e){var o;const s=e==="video/VP9"?le.WEBCAM:le.WEBCAM_BACKUP;if(d(this,re).producers.has(s)){const c=d(this,re).producers.get(s);if(!c.closed&&!navigator.isReactNative)return await c.replaceTrack({track:t}),await this.resumeWebcam(s),t;await this.disableWebcam(e)}const n={track:t,codecOptions:[{name:e.split("/")[1]}],appData:{screenShare:!1,e2ee:this.e2ee},stopTracks:!1};if(!Cc(this.context,"disableSimulcast")&&J.hasFeature(Z.ENABLE_HIVE_SIMULCAST)){let c=t.getConstraints().width;c in Mv||(c=320),n.encodings=Mv[c],((o=n.encodings)==null?void 0:o.length)===1&&u.info("Simulcast will not be used for the webcam producer")}else u.info("Simulcast will not be used for the webcam producer");const a=()=>{u.info("Disabling video due to the producer closure"),this.disableWebcam(e)};return d(this,re).createProducer(le.WEBCAM,n,a)}async shareWebcam(t){if(t===void 0)return null;if(J.hasFeature(Z.FORCE_VIDEO_CODEC)){const e=J.getValue(Z.FORCE_VIDEO_CODEC).toString();if(e)return u.debug(`Calling _shareWebcam with forced video codec: ${e}`),this._shareWebcam(t,e)}return await Promise.all(Ir.map(e=>{var s,n;return((n=(s=d(this,ea).sender)==null?void 0:s.video)==null?void 0:n.codecs.findIndex(i=>i.mimeType===e))>=0&&d(this,jn).get(e).size>0?(u.debug(`Calling _shareWebcam with video codec: ${e}`),this._shareWebcam(t,e)):t})),t}async shareScreen(t){const{video:e,audio:s}=t;if(e===void 0)return;const n={track:e,codecOptions:[{name:"VP8"}],appData:{screenShare:!0,e2ee:this.e2ee,supportsRemoteControl:Re.isElectron()},stopTracks:!1};let i=()=>{u.info("Disabling screenShare due to the producer closure"),this.disableScreenShare()};if(await d(this,re).createProducer(le.SCREENSHARE_VIDEO,n,i),s){const a={track:s,codecOptions:[{name:"opus"}],appData:{screenShare:!0,e2ee:this.e2ee,supportsRemoteControl:Re.isElectron()},stopTracks:!1,zeroRtpOnPause:!0};i=()=>{},await d(this,re).createProducer(le.SCREENSHARE_AUDIO,a,i)}q.screenShareStart()}async shareMic(t){try{if(t===void 0)throw new vt("track undefined");if(d(this,re).producers.has(le.MIC)){const n=d(this,re).producers.get(le.MIC);if(!n.closed&&!navigator.isReactNative){await n.replaceTrack({track:t}),await this.resumeMic();return}await d(this,re).removeProducer(le.MIC,!1)}const e={track:t,encodings:[{priority:"high"}],codecOptions:[{name:"opus"}],appData:{e2ee:this.e2ee},stopTracks:!1,zeroRtpOnPause:!0},s=()=>{u.info("Disabling audio due to the producer closure"),this.disableMic()};await d(this,re).createProducer(le.MIC,e,s)}catch(e){throw new I(e)}}pauseMic(){const t=d(this,re).producers.get(le.MIC);if(!t){u.error("pauseMic::could_not_find_mic_producer");return}if(t.paused){u.info("pauseMic::mic_producer_already_paused");return}t.pause();const e={producerId:t.id,pause:!0};d(this,bt).sendMessage(d(this,ut).toggleProducer,Fc.toBinary(e))}async pauseWebcam(){const t=d(this,re).producers.get(le.WEBCAM),e=d(this,re).producers.get(le.WEBCAM_BACKUP);if(!t){u.error("pauseWebcam::could_not_find_webcam_producer");return}const s=n=>{const i={producerId:n.id,pause:!0};d(this,bt).sendMessage(d(this,ut).toggleProducer,Fc.toBinary(i))};t.pause(),s(t),e&&(e.pause(),s(e))}async resumeMic(){const t=d(this,re).producers.get(le.MIC);if(!t){u.error("resumeMic::could_not_find_mic_producer");return}if(!t.pause){u.info("resumeMic::mic_producer_already_resumed");return}t.resume(),t.appData.e2ee&&P.emit(k.E2EE_ACTIVE_PRODUCER,t);const e={producerId:t.id,pause:!1};d(this,bt).sendMessage(d(this,ut).toggleProducer,Fc.toBinary(e))}async resumeWebcam(t=le.WEBCAM){const e=d(this,re).producers.get(t);if(!e){u.error("resumeWebcam::could_not_find_webcam_producer");return}e.resume(),e.appData.e2ee&&P.emit(k.E2EE_ACTIVE_PRODUCER,e);const s={producerId:e.id,pause:!1};d(this,bt).sendMessage(d(this,ut).toggleProducer,Fc.toBinary(s))}async disableWebcam(t){const e=t==="video/VP9"?le.WEBCAM:le.WEBCAM_BACKUP;await d(this,re).removeProducer(e)}async disableMic(){await d(this,re).removeProducer(le.MIC)}async disableScreenShare(){u.info("screen_sharing_stopped"),q.screenShareStop(),await d(this,re).removeProducer(le.SCREENSHARE_VIDEO),await d(this,re).removeProducer(le.SCREENSHARE_AUDIO),d(this,cs).clear()}async muteSelf(){this.pauseMic()}async unmuteSelf(){}async resetVideoProducers(t,e){t&&(await d(this,re).removeProducer(le.WEBCAM,!1),await d(this,re).removeProducer(le.WEBCAM_BACKUP,!1),this.shareWebcam(t)),e&&(await d(this,re).removeProducer(le.SCREENSHARE_VIDEO,!1),this.shareScreen({video:e}))}async changeDisplayName(t,e){const s={displayName:t,participantId:e!=null?e:this.peerId};if(!await this.sfuHandler.socketHandler.changeDisplayName(s))throw new Error("failed to change display name!")}async kick(t){const e={participantId:t};if(!await this.sfuHandler.socketHandler.kickPeer(e))throw new Error("failed to kickout the participant!")}async kickAll(){if(!await this.sfuHandler.socketHandler.kickAll())throw new Error("failed to kickout all participant!")}async muteAll(t){if(!await this.sfuHandler.socketHandler.hostControlForAll("audio"))throw new Error("failed to mute all participant")}async muteAllVideo(){if(!await this.sfuHandler.socketHandler.hostControlForAll("video"))throw new Error("failed to mute all video participant")}async disableAudio(t){if(!await this.sfuHandler.socketHandler.hostControlForPeer(t,"audio"))throw new Error("failed to mute given participant")}async disableVideo(t){if(!await this.sfuHandler.socketHandler.hostControlForPeer(t,"video"))throw new Error("failed to mute video of given participant")}async pinPeer(t){const e={participantId:t!=null?t:""};try{await d(this,bt).sendMessagePromise(d(this,ut).globalPinPeer,Ok.toBinary(e))}catch(s){u.error("Error in pinning peer:",{error:s})}}validateScreenShare(t){return this.peerId===t.peerId&&this.sfuHandler.hasProducer(t.producerId)&&d(this,cs).add(t.consumerPeerId),d(this,cs).size}async switchConsumersToLayer(t,e){this.sfuHandler.switchConsumersToLayer(t,e)}async handleSocketEvents(){d(this,bt).on(d(this,ut).peerProducerCreateBroadcast,({payload:t})=>{var e,s;if(this.mediaJoined)try{const{participantId:n,producerState:i}=CI.fromBinary(t);if(n===this.peerId)return;if(i!=null&&i.mimeType||(i.mimeType=i.kind===hr.AUDIO?"audio/opus":"video/VP8"),i.kind===hr.VIDEO&&!i.screenShare&&((s=(e=d(this,ea).receiver)==null?void 0:e.video)==null?void 0:s.codecs.findIndex(a=>a.mimeType===Ir[0]))>=0&&d(this,qn).get(Ir[0]).has(n)&&i.mimeType!==Ir[0]){u.warn(`Ignoring producer: ${i.producerId}`);return}u.info(`producer created broadcast: ${n}, producer state: ${i}`),P.emit(k.NEW_PRODUCER,{peerId:n,producer:{...i,kind:i.kind===hr.AUDIO?"audio":"video",producingPeerId:n}})}catch(n){u.error("error in peer-producer-create-broadcast",{error:n})}}),d(this,bt).on(d(this,ut).peerProducerToggleBroadcast,({payload:t})=>{if(this.mediaJoined)try{const{participantId:e,initiatorParticipantId:s,producerState:{kind:n,pause:i,producerId:a}}=Bg.fromBinary(t),o=n===hr.AUDIO?"audio":"video";if(u.info(`producer toggle broadcast: ${e}, producerId: ${a}, kind:${o}, paused:${i} payload: ${JSON.stringify(Bg.fromBinary(t))}`),e===this.peerId&&s!==this.peerId&&i&&P.emit(o==="audio"?k.MUTE_SELF:k.MUTE_SELF_VIDEO),e===this.peerId)return;P.emit(k.PRODUCER_TOGGLE,{peerId:e,producerId:a,paused:i,kind:o}),Array.from(this.getConsumers().values()).filter(l=>l.producerId===a).forEach(l=>{l.paused!==i&&(u.debug(`consumer state mismatched for ${l.id}. updating consumer pause state ${l.paused} to ${i}`),i?(l.pause(),P.emit(k.CONSUMER_PAUSED,{id:l.id})):(l.resume(),P.emit(k.CONSUMER_RESUMED,{id:l.id})))})}catch(e){u.error("error in producer toggle broadcast handler",{error:e})}}),d(this,bt).on(d(this,ut).peerLeaveBroadcast,({payload:t})=>{if(this.mediaJoined)try{const{participantId:e}=Cu.fromBinary(t);if(e===this.peerId)return;u.info(`peer left broadcast:${e}`),d(this,cs).delete(e),this.sfuHandler.cleanupConsumers(e),P.emit(k.PEER_CLOSED,{id:e})}catch(e){u.error("error in peer left broadcast",{error:e})}}),d(this,bt).on(d(this,ut).peerProducerCloseBroadcast,({payload:t})=>{if(this.mediaJoined)try{const{participantId:e,producerState:{producerId:s}}=kI.fromBinary(t);if(e===this.peerId)return;u.info(`producer closed broadcast:${e}`),P.emit(k.PRODUCER_CLOSED,{peerId:e,producerId:s});const n=this.sfuHandler.producerIdToConsumerIdMap.get(s);if(!n){u.warn(`no consumer found for producer:${s}`);return}u.info(`closing consumer ${n}, producer id: ${s}`),this.sfuHandler.closeConsumer(n).then(()=>{u.info(`closed consumer: ${n}`),this.sfuHandler.producerIdToConsumerIdMap.delete(s),P.emit(k.CONSUMER_CLOSED,{id:n})}).catch(i=>{u.error("error closing consumer",{error:i})})}catch(e){u.error("error on producer close broadcast",{error:e})}}),d(this,bt).on(d(this,ut).mediaRoomTerminationBroadcastResponse,()=>{!this.mediaJoined&&!d(this,Fr)&&!d(this,Bn)||(u.warn("media hub termination broadcast received, rejoining room"),P.emit(k.ROOM_NODE_DISCONNECTED),this.rejoinRoom())})}handleSFUEvents(){d(this,re).on("reconnect_transport",async t=>{try{await this.reconnectTransport(t),u.info(`transport reconnected [id:${t.id}]`)}catch(e){u.error("error on reconnection transports",{error:e})}}),d(this,re).on("rejoin",t=>{var e;if(((e=d(this,$r,zs).socketState)==null?void 0:e.state)!=="connected"){u.warn("Ignoring rejoin attempt because socket is not connected");return}if(d(this,Hn)>3&&!t){u.warn("cannot rejoin more already rejoined 3 times");return}if(d(this,Fr)&&!t){u.warn("room joining in progress, cannot start rejoining");return}y(this,Hn,d(this,Hn)+1),u.warn(`rejoining the room because transports are failing. [rejoinCount: ${d(this,Hn)}]`),this.mediaJoined=!1,P.emit(k.ROOM_NODE_DISCONNECTED),this.rejoinRoom()})}handleCallstatsEvents(){q.onConsumerScore(t=>{t.forEach((e,s)=>{const n=this.sfuHandler.consumers.get(s);n&&P.emit(k.CONSUMER_SCORE_UPDATE,{id:s,kind:n.kind,peerId:n.peerId,score:e.score,scoreStats:e})})}),q.onProducerScore(t=>{t.forEach((e,s)=>{const n=Array.from(this.sfuHandler.producers.values()).find(i=>i.id===s);n&&P.emit(k.PRODUCER_SCORE_UPDATE,{id:s,kind:n.kind,appData:n.appData,score:e.score,scoreStats:e})})})}handlePeerCapabilities(t,e){var s,n,i,a;for(let o=0;o<=Ir.length;o+=1){const c=Ir[o];if(((n=(s=e==null?void 0:e.receiver)==null?void 0:s.video)==null?void 0:n.codecs.findIndex(l=>l.mimeType===c))>=0||o===Ir.length-1){d(this,jn).get(c).add(t);break}}for(let o=0;o<=Ir.length;o+=1){const c=Ir[o];if(((a=(i=e==null?void 0:e.sender)==null?void 0:i.video)==null?void 0:a.codecs.findIndex(l=>l.mimeType===c))>=0||o===Ir.length-1){d(this,qn).get(c).add(t);break}}}handlePeerLeaving(t){d(this,qn).forEach(e=>e.delete(t)),d(this,jn).forEach((e,s)=>{e.delete(t),e.size===0&&this.disableWebcam(s)})}}uo=new WeakMap,ho=new WeakMap,bt=new WeakMap,re=new WeakMap,ea=new WeakMap,ut=new WeakMap,Fr=new WeakMap,Bn=new WeakMap,Hn=new WeakMap,js=new WeakMap,po=new WeakMap,mo=new WeakMap,fo=new WeakMap,cs=new WeakMap,Gs=new WeakMap,ta=new WeakMap,qn=new WeakMap,jn=new WeakMap,$r=new WeakSet,zs=function(){return this.context.getValue("connectionHandler")},ae([v.trace("MediaNodeClient.reset",{country:v.location.country})],ie.prototype,"reset",1),ae([v.trace("MediaNodeClient.reconnect",{country:v.location.country})],ie.prototype,"reconnectTransport",1),ae([v.trace("MediaNodeClient.setupTransport")],ie.prototype,"setupTransports",1),ae([v.trace("MediaNodeClient.stopAllProducers")],ie.prototype,"stopAllProducers",1),ae([v.trace("MediaNodeClient.joinRoom")],ie.prototype,"joinRoom",1),ae([v.trace("MediaNodeClient.completeJoinRoom")],ie.prototype,"completeJoinRoom",1),ae([v.trace("MediaNodeClient.leaveRoom")],ie.prototype,"leaveRoom",1),ae([v.trace("MediaNodeClient.activatePeers")],ie.prototype,"activatePeers",1),ae([v.trace("MediaNodeClient.deactivatePeers")],ie.prototype,"deactivatePeers",1),ae([v.trace("MediaNodeClient.createConsumers")],ie.prototype,"createConsumers",1),ae([v.trace("MediaNodeClient.pauseConsumers")],ie.prototype,"pauseConsumers",1),ae([v.trace("MediaNodeClient.resumeConsumers")],ie.prototype,"resumeConsumers",1),ae([v.trace("MediaNodeClient.closeConsumers")],ie.prototype,"closeConsumers",1),ae([v.trace("MediaNodeClient._shareWebcam")],ie.prototype,"_shareWebcam",1),ae([v.trace("MediaNodeClient.shareWebcam")],ie.prototype,"shareWebcam",1),ae([v.trace("MediaNodeClient.shareScreen")],ie.prototype,"shareScreen",1),ae([v.trace("MediaNodeClient.shareMic")],ie.prototype,"shareMic",1),ae([v.trace("MediaNodeClient.pauseMic")],ie.prototype,"pauseMic",1),ae([v.trace("MediaNodeClient.pauseWebcam")],ie.prototype,"pauseWebcam",1),ae([v.trace("MediaNodeClient.resumeMic")],ie.prototype,"resumeMic",1),ae([v.trace("MediaNodeClient.resumeWebcam")],ie.prototype,"resumeWebcam",1),ae([v.trace("MediaNodeClient.disableWebcam")],ie.prototype,"disableWebcam",1),ae([v.trace("HiveClient.disableMic")],ie.prototype,"disableMic",1),ae([v.trace("HiveClient.disableScreenShare")],ie.prototype,"disableScreenShare",1),ae([v.trace("MediaNodeClient.muteSelf")],ie.prototype,"muteSelf",1),ae([v.trace("MediaNodeClient.resetVideoProducers")],ie.prototype,"resetVideoProducers",1),ae([v.trace("MediaNodeClient.changeDisplayName")],ie.prototype,"changeDisplayName",1),ae([v.trace("MediaNodeClient.kickPeer")],ie.prototype,"kick",1),ae([v.trace("MediaNodeClient.kickAllPeers")],ie.prototype,"kickAll",1),ae([v.trace("MediaNodeClient.muteAll")],ie.prototype,"muteAll",1),ae([v.trace("MediaNodeClient.muteAllVideo")],ie.prototype,"muteAllVideo",1),ae([v.trace("MediaNodeClient.disableAudio")],ie.prototype,"disableAudio",1),ae([v.trace("MediaNodeClient.disableVideo")],ie.prototype,"disableVideo",1),ae([v.trace("MediaNodeClient.pinPeer")],ie.prototype,"pinPeer",1),ae([v.trace("MediaNodeClient.validateScreenShare")],ie.prototype,"validateScreenShare",1);function w1(r,t,e){const s=r.getValue("roomNodeClient");if(s){if(s)return s;throw new Error("Room node client already set up.")}const n=new ie(r,t,e);return r.setValue("roomNodeClient",n),n}function b1(r){const t=r.getValue("roomNodeClient");try{t==null||t.leaveRoom()}catch(e){u.error("roomNodeClient::cleanupRoomNodeClient")}r.setValue("roomNodeClient",void 0)}function ty(r,t,e){return w1(r,e,t)}function ry(r){return b1(r)}var C1=Object.defineProperty,R1=Object.getOwnPropertyDescriptor,P1=(r,t,e,s)=>{for(var n=s>1?void 0:s?R1(t,e):t,i=r.length-1,a;i>=0;i--)(a=r[i])&&(n=(s?a(t,e,n):a(n))||n);return s&&n&&C1(t,e,n),n};let vn;const sy=(Hy=class{constructor(r,t){m(this,"socket");E(this,go,void 0);y(this,go,t),this.socket=r,this.handleSocketEvents()}static create(r,t){return vn||(vn=new sy(r,t)),vn}static cleanup(){var r;try{(r=vn==null?void 0:vn.socket)==null||r.disconnect()}catch(t){u.error("roomSocketHandler::cleanup")}vn=void 0}async joinRoom(r){var s;this.socket.joinAttempted=!0;const t={capabilities:[],peer:{displayName:(s=r.name)!=null?s:"Participant",customParticipantId:r.customParticipantId,peerId:r.id,userId:r.userId,displayPictureUrl:r.picture,waitlisted:!1},roomUuid:""},e=this.socket.sendMessagePromise(U.joinRoom,sA.toBinary(t));try{const{peer:n}=ni.fromBinary((await e).payload);d(this,go).getValue("connectionHandler").socketJoined=!0,P.emit(k.SOCKET_SERVICE_ROOM_JOINED,{peer:n});const i=this.getRoomState(),a=this.getRoomPeersNonPaginated(),[{room:o},{peers:c}]=await Promise.all([i,a]);return P.emit(k.ROOM_STATE,o),P.emit(k.SOCKET_PEERS,c),{peer:n}}catch(n){throw u.error("RoomSocketHandler.joinRoom.failed",{error:n}),new I("Error: RoomSocketHandler.joinRoom failed.","0002",n)}}async getAllAddedParticipants(){try{return BA.fromBinary((await this.socket.sendMessagePromise(U.getAllAddedParticipants)).payload).participants.map(({id:t,...e})=>({...e,userId:t}))}catch(r){return[]}}async getRoomPeers(r,t,e){let s;try{const n={seachQuery:r,limit:t,offset:e},i=await this.socket.sendMessagePromise(U.getRoomPeersInfo,JI.toBinary(n));s=Iu.fromBinary(i.payload)}catch(n){u.error("getRoomPeers::binary_decode_error",{error:n})}return s}async getRoomPeersNonPaginated(){let r;try{const t=await this.socket.sendMessagePromise(U.getRoomPeersInfo);r=Iu.fromBinary(t.payload)}catch(t){u.error("getRoomJoinedPeers::binary_decode_error",{error:t})}return r}async getStagePeers(){let r;try{const t=await this.socket.sendMessagePromise(U.getRoomPeersInfo);r=Iu.fromBinary(t.payload)}catch(t){u.error("getRoomJoinedPeers::binary_decode_error",{error:t})}return r}async getPeerInfo(r){let t;try{const e=await this.socket.sendMessagePromise(U.getPeerInfo,Jg.toBinary({peerId:r}));t=ni.fromBinary(e.payload)}catch(e){u.error("getPeerInfo::binary_decode_error",{error:e})}return t}async getRoomState(){let r=Wg.create();try{const t=await this.socket.sendMessagePromise(U.getRoomInfo);r=Wg.fromBinary(t.payload)}catch(t){u.error("getRoomState::binary_decode_error",{error:t})}return r}async getRoomStageState(){let r=Xg.create();try{const t=await this.socket.sendMessagePromise(U.getRoomStageState);r=Xg.fromBinary(t.payload)}catch(t){u.error("getRoomStageState::binary_decode_error",{error:t})}return r}async broadcastMessage(r,t){const e={type:r,payload:new TextEncoder().encode(JSON.stringify(t)),timestamp:Date.now(),ids:[]};return this.socket.sendMessagePromise(U.broadcastMessage,Ta.toBinary(e))}async broadcastToMeetings(r,t,e){const s={type:r,payload:new TextEncoder().encode(JSON.stringify(e)),timestamp:Date.now(),ids:t,broadcastType:1};return this.socket.sendMessagePromise(U.broadcastToEntity,Ta.toBinary(s))}async broadcastToPeers(r,t,e){const s={type:r,payload:new TextEncoder().encode(JSON.stringify(e)),timestamp:Date.now(),ids:t,broadcastType:0};return this.socket.sendMessage(U.broadcastToEntity,Ta.toBinary(s))}async leaveRoom(){this.socket.joinAttempted=!1,this.socket.sendMessagePromise(U.leaveRoom,iA.toBinary({}))}async kick(r){const t={peerIds:[r]};this.socket.sendMessage(U.kick,GA.toBinary(t))}async kickAll(r=!1){const t={propagateKickAcrossRooms:r};this.socket.sendMessage(U.kickAll,wu.toBinary(t))}getWaitingRoomRequests(){this.socket.sendMessage(U.getWaitingRoomRequests)}acceptWaitingRoomRequest(r){const t={userIds:r};this.socket.sendMessage(U.acceptWaitingRoomRequests,KA.toBinary(t))}rejectWaitingRoomRequest(r){const t={userIds:r};this.socket.sendMessage(U.denyWaitingRoomRequests,YA.toBinary(t))}async updatePermissions(r,t){const e={updatePeersPresets:[]};return r.forEach(s=>{e.updatePeersPresets.push({userIds:s,patch:t})}),this.socket.sendMessagePromise(Gc.updateUserPreset,C0.toBinary(e))}handleSocketEvents(){this.socket.on(U.broadcastMessage,({payload:r})=>{try{const t=Ta.fromBinary(r);P.emit(k.ROOM_MESSAGE,{payload:JSON.parse(new TextDecoder().decode(t.payload)),type:t.type,timestamp:t.timestamp})}catch(t){u.error("failed to decode broadcast message:",t)}}),this.socket.on(U.broadcastToEntity,({payload:r})=>{try{const t=Ta.fromBinary(r);P.emit(k.MESSAGE,{payload:JSON.parse(new TextDecoder().decode(t.payload)),type:t.type,timestamp:t.timestamp})}catch(t){u.error("failed to decode peer broadcast message:",t)}})}on(r,t){let e,s;switch(r){case U.joinRoom:case U.leaveRoom:case U.kick:case U.kickAll:{e=ni.fromBinary.bind(ni),s=ni.create();break}case U.getWaitingRoomRequests:{e=(n,i)=>n?Qg.fromBinary(n,i):{requests:[]},s=Qg.create();break}case U.recordingPaused:case U.recordingStarted:case U.recordingStopped:{e=lv.fromBinary.bind(lv);break}case Gc.updateUserPreset:{e=ev.fromBinary.bind(ev);break}case Pe.peerJoinedBroadcast:case Te.peerJoinedBroadcast:{e=Ug.fromBinary.bind(Ug);break}case Pe.selfJoinComplete:case Te.selfJoinComplete:{e=Uc.fromBinary.bind(Uc);break}case Pe.globalPeerPinBroadcast:case Te.globalPeerPinBroadcast:{e=Hg.fromBinary.bind(Hg);break}case Pe.selectedPeer:case Te.selectedPeer:{e=bu.fromBinary.bind(bu);break}case Pe.selectedPeerDiff:case Te.selectedPeerDiff:{e=Ag.fromBinary.bind(Ag);break}case Pe.leaveRoom:case Te.leaveRoom:{e=Cu.fromBinary.bind(Cu);break}}this.socket.on(r,({payload:n})=>{let i=s;if(!e)return t(void 0);try{i=e(n)}catch(a){u.error("roomSocketHandler::on::binary_decode_error",{error:a})}return t(i)})}async getUserPermissions(r){const t={userIds:[r]};try{const e=await this.socket.sendMessagePromise(Gc.getUserPresets,y0.toBinary(t)),s=_0.fromBinary(e.payload).peerPresets[0],n=new TextDecoder().decode(s.preset),i=JSON.parse(n).permissions;return{chat:i.chat,polls:i.polls,plugins:i.plugins}}catch(e){throw u.error("Error in getting user preset",{error:e}),e}}},go=new WeakMap,Hy);let pd=sy;P1([v.trace("RoomSocketHandler.joinRoom")],pd.prototype,"joinRoom",1);var k1=Object.defineProperty,I1=Object.getOwnPropertyDescriptor,yn=(r,t,e,s)=>{for(var n=s>1?void 0:s?I1(t,e):t,i=r.length-1,a;i>=0;i--)(a=r[i])&&(n=(s?a(t,e,n):a(n))||n);return s&&n&&k1(t,e,n),n};const ny=(qy=class{constructor(r,t,e,s){E(this,Ut);m(this,"self");m(this,"authToken");E(this,Ws,void 0);m(this,"viewType");E(this,_r,void 0);E(this,ht,void 0);const{socket:n}=e,i=r.getValue("authToken");this.self=t,y(this,ht,r),this.viewType=s,this.authToken=i,y(this,Ws,n),y(this,_r,e),t.config.viewType!==Ct.Chat&&this.setupEvents()}get peerId(){return d(this,ht).getValue("peerId")}get mediaJoined(){return d(this,ht).getValue("connectionHandler").mediaJoined}static async init(r,t,e,s,n){const i=tt(),a=r.getValue("peerId"),o=!!r.getValue("cachedUserDetails"),c=await ot.__init__(r,e,s,n,n.name,o);if(navigator.product!=="ReactNative"){const l=!J.hasFeature(Z.PRECALL_BANDWIDTH_TEST);setTimeout(async()=>{const p=await c.getAllDevices();u.info("populated_full_device_list",{devices:JSON.stringify(p)}),q.devices("AUDIO",p==null?void 0:p.filter(h=>h.kind==="audioinput")),q.devices("VIDEO",p==null?void 0:p.filter(h=>h.kind==="videoinput")),q.devices("SPEAKER",p==null?void 0:p.filter(h=>h.kind==="audiooutput")),u.info("Callstats:: initializing");try{await q.initialize({peerId:a,engineName:Re.getDeviceInfo().engineName,env:r.getValue("env"),iceServers:await i.getICEServers(),apiBase:r.getValue("apiBase"),flags:J.getAllFlags(),logger:u,apiHostnames:zf(r),skipConnectivityChecks:l}),u.info("Callstats:: initialized")}catch(h){u.error("Callstats:: initialization failed",{error:h})}},0)}else u.info("Callstats:: Skipped initialization due to navigator product being ReactNative.");return new ny(r,c,t,n.viewType)}async shareMediaTracks(){var o;const{audioTrack:r,videoTrack:t,permissions:e,audioEnabled:s,videoEnabled:n,screenShareEnabled:i,screenShareTracks:a}=this.self;if(e.canProduceAudio&&s)try{await d(this,Ut,cr).shareMic(r)}catch(c){this.self.disableAudio()}if(e.canProduceVideo&&n)try{const c=await d(this,Ut,cr).shareWebcam(t);c&&c.id!==t.id&&J.hasFeature(Z.EXP_RESHARE)&&await d(this,Ut,cr).shareWebcam(c)}catch(c){this.self.disableVideo()}if(e.canProduceScreenshare&&i)try{await((o=d(this,Ut,cr))==null?void 0:o.shareScreen({video:a.video,audio:a.audio}))}catch(c){this.self.disableScreenShare()}}async kickHandler(r){let t="kicked";(r==null?void 0:r.kickType)==="kickAll"&&(t="ended"),this.leaveRoom(t)}waitlistedHandler(){u.info("SelController.waitlisted"),this.self.waitlistStatus="waiting",this.self.roomState="waitlisted",this.self.emit("waitlisted")}waitlistAcceptHandler(){if(u.info("SelController.waitlistAccepted"),this.self.waitlistStatus==="accepted"){u.warn("SelfController.WAITLIST_ACCEPTED.UserAlreadyAccepted");return}this.self.waitlistStatus="accepted",this.joinRoom()}waitlistRejectedHandler(){if(u.info("SelfController.waitlistRejected"),this.self.waitlistStatus==="rejected"){u.warn("SelfController.WAITLIST_REJECTED.UserAlreadyRejected");return}this.self.waitlistStatus="rejected",this.leaveRoom("rejected")}async resetSelf(r){q.callEnded(),d(this,Ut,cr).reset(),r&&await this.joinRoom(r)}setupEvents(){P.on(k.RESET_PRODUCER_STATE,async()=>{this.mediaJoined&&this.shareMediaTracks()}),P.on(k.ROOM_NODE_RECONNECTED,()=>{this.self.roomState="joined",this.self.emit("roomJoined",{reconnected:!0})}),P.on(k.ROOM_NODE_DISCONNECTED,()=>{this.self.roomState!=="disconnected"&&(this.self.roomState="disconnected",this.self.emit("roomLeft",{state:"disconnected"}))}),P.on(k.ROOM_NODE_FAILED,()=>{this.self.roomState="failed",this.self.emit("roomLeft",{state:"failed"})}),P.on(k.SOCKET_SERVICE_RECONNECTED,({wasJoinAttempted:r})=>{r===!1&&(this.self.roomState="init"),this.resetSelf(r)}),P.on(k.SOCKET_SERVICE_DISCONNECTED,({joinAttempted:r})=>{if(this.self.roomState==="disconnected")return;let{peerId:t}=this;r&&J.hasFeature(Z.REFRESH_ID_ON_DISCONNECTION)&&(t=Jn()),d(this,Ws).updateURL(t),v.resetPeerId(t),tt().setHeader("dyte-tracing-id",t),rn.remapContext(t,d(this,ht)),this.self.roomState="disconnected",this.self.emit("roomLeft",{state:"disconnected"})}),P.on(k.SOCKET_SERVICE_FAILED,()=>{this.self.roomState="failed",this.self.emit("roomLeft",{state:"failed"})}),d(this,_r).on(U.waitingRoomRequestAccepted,()=>{this.waitlistAcceptHandler()}),d(this,_r).on(Gc.updateUserPreset,r=>{r.updatePeersPresets.forEach(t=>{t.userIds===this.self.userId&&P.emit(k.UPDATE_PERMISSIONS,t.patch)})}),d(this,_r).on(U.waitingRoomRequestDenied,()=>{this.waitlistRejectedHandler()}),d(this,_r).on(U.kick,()=>{this.kickHandler({kickType:"kick"})}),d(this,_r).on(U.kickAll,()=>{this.kickHandler({kickType:"kickAll"})}),P.onAsync(k.JOIN_MEDIA_ROOM,this.joinMediaRoom.bind(this)),P.on(k.PRODUCER_SCORE_UPDATE,({score:r,kind:t,appData:e,scoreStats:s})=>{var i;const n=(i=e==null?void 0:e.screenShare)!=null?i:!1;this.self.emit("mediaScoreUpdate",{kind:t,isScreenshare:n,score:r,participantId:this.self.id,scoreStats:s})}),P.on(k.MUTE_SELF,async()=>{this.self.audioEnabled&&(await this.self.disableAudio(),q.audioOff())}),P.on(k.MUTE_SELF_VIDEO,async()=>{this.self.videoEnabled&&(await this.self.disableVideo(),q.videoOff())}),P.onAsync(k.LEAVE_MEDIA_ROOM,this.leaveMediaRoom.bind(this)),P.on(k.PIP_HANGUP,this.leaveRoom.bind(this))}async joinRoom(r=!1){try{const{peer:t}=await d(this,_r).joinRoom(this.self);d(this,_r).socket.flush();const e=Wu(t.stageType);if(d(this,ht).setValue("stageStatus",e,!1),t.waitlisted){this.waitlistedHandler();return}await this.joinMediaRoom(r),d(this,ht).notify("stageStatus")}catch(t){throw u.error("Error in joinRoom",{error:t}),t}}async leaveRoom(r="left"){var t,e;if(r==="rejected"){try{(t=d(this,Ws))==null||t.disconnect()}catch(s){u.error("SelfController::leaveRoom::socketDisconnect")}this.self.roomState=r,this.self.emit("roomLeft",{state:r});return}this.self.setIsPinned(!1),d(this,ht).setValue("stageStatus","OFF_STAGE",!1),await this.leaveMediaRoom(r),d(this,ht).notify("stageStatus");try{(e=d(this,Ws))==null||e.disconnect()}catch(s){u.error("SelfController::leaveRoom::socketDisconnect")}ry(d(this,ht)),pd.cleanup(),this.self.roomState=r,this.self.emit("roomLeft",{state:r})}partialMediaRoom(){var r;return(r=d(this,Ut,cr))==null?void 0:r.partialJoinRoom(this.self.name,d(this,ht).getValue("meetingId"),void 0)}async joinMediaRoom(r=!1){var p,h;const{peerId:t,viewType:e,meetingId:s,authToken:n,stageStatus:i,roomNodeOptions:a}=d(this,ht).getAllValues(),{sfu:o,roomNodeUrl:c,meetingTitle:l}=a;try{if(e===Ct.Livestream){if(i!=="ON_STAGE"){this.self.roomState="joined",this.self.emit("roomJoined",{reconnected:r});return}ty(d(this,ht),{socket:d(this,Ws),peerId:t,meetingId:s,authToken:n,roomNodeUrl:c,meetingTitle:l},o)}const{roomJoined:f}=(h=await((p=d(this,Ut,cr))==null?void 0:p.joinRoom(this.self.name,s,{audio:this.self.audioEnabled,video:this.self.videoEnabled,screen:this.self.screenShareEnabled},r,r)))!=null?h:{};if(!f)return;i==="ON_STAGE"&&await this.shareMediaTracks(),this.self.roomState="joined",this.self.emit("roomJoined",{reconnected:r})}catch(f){throw u.error("Error:SelfController.mediaRoomJoin",f),new I("Error: could not join media room","0002")}}async leaveMediaRoom(r){const t=d(this,ht).getValue("viewType");r!=="connected-meeting"&&await this.cleanupSelf(),!(r==="stageLeft"&&t===Ct.Webinar)&&d(this,Ut,cr)&&(d(this,Ut,cr).mediaJoined&&r!=="disconnected"&&await d(this,Ut,cr).leaveRoom(),!(r==="stageLeft"&&t===Ct.Livestream)&&(d(this,Ut,cr).mediaJoined=!1))}async cleanupSelf(){await this.self.disableAudio(),await this.self.disableVideo(),await this.self.disableScreenShare(),this.self.cleanUpTracks(),this.self.destructMediaHandler(),navigator.isReactNative||this.self.removeDocumentEventListeners()}},Ws=new WeakMap,_r=new WeakMap,ht=new WeakMap,Ut=new WeakSet,cr=function(){return d(this,ht).getValue("roomNodeClient")},qy);let Cs=ny;yn([v.trace("SelfController.resetSelf")],Cs.prototype,"resetSelf",1),yn([v.trace("SelfController.setupEvents")],Cs.prototype,"setupEvents",1),yn([v.trace("SelfController.joinRoom")],Cs.prototype,"joinRoom",1),yn([v.trace("SelfController.leaveRoom")],Cs.prototype,"leaveRoom",1),yn([v.trace("SelfController.joinMediaRoom")],Cs.prototype,"joinMediaRoom",1),yn([v.trace("SelfController.leaveMediaRoom")],Cs.prototype,"leaveMediaRoom",1),yn([v.trace("SelfController.init")],Cs,"init",1);class A1{constructor(t){E(this,vo,void 0);y(this,vo,t)}on(t,e){let s;t===U.roomPeerCount?s=jg.fromBinary.bind(jg):s=av.fromBinary.bind(av),d(this,vo).on(t,({payload:n})=>{const i=s(n);return e(i)})}}vo=new WeakMap;class M1{constructor(t){E(this,yo,void 0);y(this,yo,t)}on(t,e){let s,n;switch(t){case U.transcript:{s=Ru.fromBinary.bind(Ru),n=Ru.create();break}default:{u.debug("AISocketHandler switch case hit default, event not accounted for.");break}}d(this,yo).on(t,({payload:i})=>{let a=n;try{a=s(i)}catch(o){u.error("chatSocketHandler::on::binary_decode_error",{error:o})}return e(a)})}}yo=new WeakMap;var D1=Object.defineProperty,O1=Object.getOwnPropertyDescriptor,hh=(r,t,e,s)=>{for(var n=s>1?void 0:s?O1(t,e):t,i=r.length-1,a;i>=0;i--)(a=r[i])&&(n=(s?a(t,e,n):a(n))||n);return s&&n&&D1(t,e,n),n};class md{constructor(t){E(this,ds,void 0);y(this,ds,t)}getPolls(){return d(this,ds).sendMessagePromise(Gr.getPolls)}createPoll(t,e,s=!1,n=!1){const i={anonymous:s,hideVotes:n,question:t,options:e};return d(this,ds).sendMessage(Gr.createPoll,vD.toBinary(i))}votePoll(t,e){const s={index:e,pollId:t};return d(this,ds).sendMessage(Gr.votePoll,TD.toBinary(s))}on(t,e){let s,n;switch(t){case Gr.updatePoll:case Gr.createPoll:case Gr.votePoll:{s=Uu.fromBinary.bind(Uu),n=Uu.create();break}}d(this,ds).on(t,({payload:i})=>{let a=n;try{a=s(i)}catch(o){u.error("pollSocketHandler::on::binary_decode_error",{error:o})}return e(a)})}removeListeners(t){d(this,ds).removeListeners(t)}}ds=new WeakMap,hh([v.trace("PollSocketHandler.getPolls")],md.prototype,"getPolls",1),hh([v.trace("PollSocketHandler.createPoll")],md.prototype,"createPoll",1),hh([v.trace("PollSocketHandler.votePoll")],md.prototype,"votePoll",1);class N1{constructor(t){E(this,Vt,void 0);y(this,Vt,t)}async getStageRequests(){const{payload:t}=await d(this,Vt).sendMessagePromise(U.getStageRequests);return t?$u.fromBinary(t):{stageRequests:[]}}requestAccess(){d(this,Vt).sendMessage(U.requestStageAccess)}cancelRequestAccess(){d(this,Vt).sendMessage(U.cancelStageRequest)}async grantAccess(t){const e={userIds:t};d(this,Vt).sendMessage(U.grantStageAccess,oD.toBinary(e))}async denyAccess(t){const e={userIds:t};d(this,Vt).sendMessage(U.denyStageAccess,dD.toBinary(e))}joinStage(){return d(this,Vt).sendMessagePromise(U.joinStage,void 0,void 0,U.peerStageStatusUpdate)}leaveStage(t){const e={userIds:[t]};return d(this,Vt).sendMessagePromise(U.leaveStage,cv.toBinary(e),void 0,U.peerStageStatusUpdate)}kick(t){const e={userIds:t};return d(this,Vt).sendMessagePromise(U.leaveStage,cv.toBinary(e))}on(t,e){let s;switch(t){case U.grantStageAccess:case U.denyStageAccess:{s=void 0;break}case U.getStagePeers:{s=ov.fromBinary.bind(ov);break}case U.getStageRequests:case U.requestStageAccess:case U.cancelStageRequest:{s=$u.fromBinary.bind($u);break}case U.peerStageStatusUpdate:{s=qg.fromBinary.bind(qg);break}}d(this,Vt).on(t,({payload:n,id:i})=>{if(!n||!s)return e(void 0,i);const a=s(n);return e(a,i)})}async getPeerInfo(t){const e=await d(this,Vt).sendMessagePromise(U.getPeerInfo,Jg.toBinary({peerId:t}));return ni.fromBinary(e.payload)}}Vt=new WeakMap;class L1{constructor(t){E(this,nt,void 0);y(this,nt,t)}addPlugin(t,e){d(this,nt).sendMessage(G.addPlugin,bM.toBinary({pluginId:t,staggered:e}))}removePlugin(t){d(this,nt).sendMessage(G.removePlugin,RM.toBinary({pluginId:t,staggered:!1}))}async getActivePlugins(){const{payload:t}=await d(this,nt).sendMessagePromise(G.getPlugins);return t?zM.fromBinary(t):{plugins:[]}}customPluginEventToRoom(t,e,s){const n={pluginId:t,pluginData:new TextEncoder().encode(JSON.stringify(e))};d(this,nt).sendMessage(G.customPluginEventToRoom,xM.toBinary(n),s)}customPluginEventToPeers(t,e,s,n){const i={pluginId:t,peerIds:e,pluginData:new TextEncoder().encode(JSON.stringify(s))};d(this,nt).sendMessage(G.customPluginEventToPeers,$M.toBinary(i),n)}enablePluginForRoom(t,e){d(this,nt).sendMessage(G.enablePluginForRoom,kM.toBinary({pluginId:t}),e)}enablePluginForPeers(t,e,s){d(this,nt).sendMessage(G.enablePluginForPeers,DM.toBinary({pluginId:t,peerIds:e}),s)}disablePluginForRoom(t,e){d(this,nt).sendMessage(G.disablePluginForRoom,AM.toBinary({pluginId:t}),e)}disablePluginForPeers(t,e,s){d(this,nt).sendMessage(G.disablePluginForPeers,NM.toBinary({pluginId:t,peerIds:e}),s)}storeInsertKeys(t,e,s,n){const i={pluginId:t,storeName:e,insertKeys:s.map(a=>({storeKey:a.key,payload:new TextEncoder().encode(JSON.stringify(a.payload))}))};d(this,nt).sendMessage(G.storeInsertKeys,rv.toBinary(i),n)}storeGetKeys(t,e,s,n){const i={pluginId:t,storeName:e,getKeys:s.map(a=>({storeKey:a.key}))};d(this,nt).sendMessage(G.storeGetKeys,HM.toBinary(i),n)}storeDeleteKeys(t,e,s,n){const i={pluginId:t,storeName:e,deleteKeys:s.map(a=>({storeKey:a.key}))};d(this,nt).sendMessage(G.storeDeleteKeys,jM.toBinary(i),n)}storeDelete(t,e,s){d(this,nt).sendMessage(G.storeDelete,WM.toBinary({pluginId:t,storeName:e}),s)}getPluginDataOld(t,e){u.info("getPluginDataOld",{plugin:{id:t,storeName:e}})}storePluginDataOld(t,e,s){const n={pluginId:t,storeName:e,insertKeys:[{storeKey:s.key,payload:new TextEncoder().encode(JSON.stringify(s))}]};d(this,nt).sendMessage(G.storeInsertKeys,rv.toBinary(n))}on(t,e){let s;switch(t){case G.addPlugin:case G.enablePluginForPeers:case G.enablePluginForRoom:{s=Fu.fromBinary.bind(Fu);break}case G.removePlugin:case G.disablePluginForPeers:case G.disablePluginForRoom:{s=sv.fromBinary.bind(sv);break}case G.customPluginEventToPeers:case G.customPluginEventToRoom:{s=iv.fromBinary.bind(iv);break}case G.storeInsertKeys:case G.storeGetKeys:case G.storeDeleteKeys:case G.storeDelete:{s=nv.fromBinary.bind(nv);break}}d(this,nt).on(t,({payload:n,id:i})=>{const a=s(n);return e(a,i)})}}nt=new WeakMap;var x1=Object.defineProperty,F1=(r,t,e)=>t in r?x1(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,$1=(r,t,e)=>(F1(r,typeof t!="symbol"?t+"":t,e),e),ph=(r,t,e)=>{if(!t.has(r))throw TypeError("Cannot "+e)},L=(r,t,e)=>(ph(r,t,"read from private field"),e?e.call(r):t.get(r)),ke=(r,t,e)=>{if(t.has(r))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(r):t.set(r,e)},me=(r,t,e,s)=>(ph(r,t,"write to private field"),s?s.call(r,e):t.set(r,e),e),De=(r,t,e)=>(ph(r,t,"access private method"),e),Rs,Tn,Sn,Ve,En,Oe,We,Ps,ct,Yr,ks,yr,mi,Qr,mh,iy,Ia,fd,fh,ay,gh,oy,gd,vh,yh,cy,Aa,vd,Ma,yd,Td,Th,fi,Da,Oa,Sd,Sh={exports:{}},gi=typeof Reflect=="object"?Reflect:null,dy=gi&&typeof gi.apply=="function"?gi.apply:function(t,e,s){return Function.prototype.apply.call(t,e,s)},Ed;gi&&typeof gi.ownKeys=="function"?Ed=gi.ownKeys:Object.getOwnPropertySymbols?Ed=function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:Ed=function(t){return Object.getOwnPropertyNames(t)};function U1(r){console&&console.warn&&console.warn(r)}var ly=Number.isNaN||function(t){return t!==t};function ge(){ge.init.call(this)}Sh.exports=ge,Sh.exports.once=q1,ge.EventEmitter=ge,ge.prototype._events=void 0,ge.prototype._eventsCount=0,ge.prototype._maxListeners=void 0;var uy=10;function _d(r){if(typeof r!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof r)}Object.defineProperty(ge,"defaultMaxListeners",{enumerable:!0,get:function(){return uy},set:function(r){if(typeof r!="number"||r<0||ly(r))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+r+".");uy=r}}),ge.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},ge.prototype.setMaxListeners=function(t){if(typeof t!="number"||t<0||ly(t))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t+".");return this._maxListeners=t,this};function hy(r){return r._maxListeners===void 0?ge.defaultMaxListeners:r._maxListeners}ge.prototype.getMaxListeners=function(){return hy(this)},ge.prototype.emit=function(t){for(var e=[],s=1;s<arguments.length;s++)e.push(arguments[s]);var n=t==="error",i=this._events;if(i!==void 0)n=n&&i.error===void 0;else if(!n)return!1;if(n){var a;if(e.length>0&&(a=e[0]),a instanceof Error)throw a;var o=new Error("Unhandled error."+(a?" ("+a.message+")":""));throw o.context=a,o}var c=i[t];if(c===void 0)return!1;if(typeof c=="function")dy(c,this,e);else for(var l=c.length,p=vy(c,l),s=0;s<l;++s)dy(p[s],this,e);return!0};function py(r,t,e,s){var n,i,a;if(_d(e),i=r._events,i===void 0?(i=r._events=Object.create(null),r._eventsCount=0):(i.newListener!==void 0&&(r.emit("newListener",t,e.listener?e.listener:e),i=r._events),a=i[t]),a===void 0)a=i[t]=e,++r._eventsCount;else if(typeof a=="function"?a=i[t]=s?[e,a]:[a,e]:s?a.unshift(e):a.push(e),n=hy(r),n>0&&a.length>n&&!a.warned){a.warned=!0;var o=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");o.name="MaxListenersExceededWarning",o.emitter=r,o.type=t,o.count=a.length,U1(o)}return r}ge.prototype.addListener=function(t,e){return py(this,t,e,!1)},ge.prototype.on=ge.prototype.addListener,ge.prototype.prependListener=function(t,e){return py(this,t,e,!0)};function V1(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function my(r,t,e){var s={fired:!1,wrapFn:void 0,target:r,type:t,listener:e},n=V1.bind(s);return n.listener=e,s.wrapFn=n,n}ge.prototype.once=function(t,e){return _d(e),this.on(t,my(this,t,e)),this},ge.prototype.prependOnceListener=function(t,e){return _d(e),this.prependListener(t,my(this,t,e)),this},ge.prototype.removeListener=function(t,e){var s,n,i,a,o;if(_d(e),n=this._events,n===void 0)return this;if(s=n[t],s===void 0)return this;if(s===e||s.listener===e)--this._eventsCount===0?this._events=Object.create(null):(delete n[t],n.removeListener&&this.emit("removeListener",t,s.listener||e));else if(typeof s!="function"){for(i=-1,a=s.length-1;a>=0;a--)if(s[a]===e||s[a].listener===e){o=s[a].listener,i=a;break}if(i<0)return this;i===0?s.shift():B1(s,i),s.length===1&&(n[t]=s[0]),n.removeListener!==void 0&&this.emit("removeListener",t,o||e)}return this},ge.prototype.off=ge.prototype.removeListener,ge.prototype.removeAllListeners=function(t){var e,s,n;if(s=this._events,s===void 0)return this;if(s.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):s[t]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete s[t]),this;if(arguments.length===0){var i=Object.keys(s),a;for(n=0;n<i.length;++n)a=i[n],a!=="removeListener"&&this.removeAllListeners(a);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(e=s[t],typeof e=="function")this.removeListener(t,e);else if(e!==void 0)for(n=e.length-1;n>=0;n--)this.removeListener(t,e[n]);return this};function fy(r,t,e){var s=r._events;if(s===void 0)return[];var n=s[t];return n===void 0?[]:typeof n=="function"?e?[n.listener||n]:[n]:e?H1(n):vy(n,n.length)}ge.prototype.listeners=function(t){return fy(this,t,!0)},ge.prototype.rawListeners=function(t){return fy(this,t,!1)},ge.listenerCount=function(r,t){return typeof r.listenerCount=="function"?r.listenerCount(t):gy.call(r,t)},ge.prototype.listenerCount=gy;function gy(r){var t=this._events;if(t!==void 0){var e=t[r];if(typeof e=="function")return 1;if(e!==void 0)return e.length}return 0}ge.prototype.eventNames=function(){return this._eventsCount>0?Ed(this._events):[]};function vy(r,t){for(var e=new Array(t),s=0;s<t;++s)e[s]=r[s];return e}function B1(r,t){for(;t+1<r.length;t++)r[t]=r[t+1];r.pop()}function H1(r){for(var t=new Array(r.length),e=0;e<t.length;++e)t[e]=r[e].listener||r[e];return t}function q1(r,t){return new Promise(function(e,s){function n(a){r.removeListener(t,i),s(a)}function i(){typeof r.removeListener=="function"&&r.removeListener("error",n),e([].slice.call(arguments))}yy(r,t,i,{once:!0}),t!=="error"&&j1(r,n,{once:!0})})}function j1(r,t,e){typeof r.on=="function"&&yy(r,"error",t,e)}function yy(r,t,e,s){if(typeof r.on=="function")s.once?r.once(t,e):r.on(t,e);else if(typeof r.addEventListener=="function")r.addEventListener(t,function n(i){s.once&&r.removeEventListener(t,n),e(i)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof r)}var G1=Sh.exports;class W1 extends T{constructor(){super("message.v1.SocketMessage",[{no:1,name:"event",kind:"scalar",T:13},{no:2,name:"id",kind:"scalar",opt:!0,T:9},{no:3,name:"payload",kind:"scalar",opt:!0,T:12},{no:4,name:"metadata",kind:"scalar",opt:!0,T:12}])}}const Ty=new W1;class Sy{static encode(t){return Ty.toBinary(t)}static decode(t){return Ty.fromBinary(new Uint8Array(t))}}function J1(r,t){return Math.floor(Math.random()*(t-r+1)+r)}class K1{constructor(t={}){$1(this,"opts"),ke(this,Rs,void 0),this.opts={initialTimeout:t.initialTimeout||1e3,maxTimeout:t.maxTimeout||1e4,factor:t.factor||2},me(this,Rs,0)}async wait(){me(this,Rs,L(this,Rs)+1);const t=J1(0,Math.min(this.opts.maxTimeout,this.opts.initialTimeout*2**L(this,Rs)));await new Promise(e=>{setTimeout(e,t)})}getAttempts(){return L(this,Rs)}reset(){me(this,Rs,0)}}Rs=new WeakMap;const Is={debug:0,info:1,warn:2,error:3};class z1{constructor(t){ke(this,Tn,void 0),ke(this,Sn,void 0),me(this,Tn,console),me(this,Sn,t)}debug(...t){Is[L(this,Sn)]>Is.debug||L(this,Tn).debug("[Sockrates]:",...t)}info(...t){Is[L(this,Sn)]>Is.info||L(this,Tn).info("[Sockrates]:",...t)}warn(...t){Is[L(this,Sn)]>Is.warn||L(this,Tn).warn("[Sockrates]:",...t)}error(...t){Is[L(this,Sn)]>Is.error||L(this,Tn).error("[Sockrates]:",...t)}}Tn=new WeakMap,Sn=new WeakMap;var Ey=(r=>(r[r.CONNECTING=0]="CONNECTING",r[r.OPEN=1]="OPEN",r[r.CLOSING=2]="CLOSING",r[r.CLOSED=3]="CLOSED",r))(Ey||{});const Y1="2",Q1="3";class X1{constructor(t,e){ke(this,mh),ke(this,Ia),ke(this,fh),ke(this,gh),ke(this,gd),ke(this,yh),ke(this,Aa),ke(this,Ma),ke(this,Td),ke(this,fi),ke(this,Oa),ke(this,Ve,void 0),ke(this,En,void 0),ke(this,Oe,void 0),ke(this,We,void 0),ke(this,Ps,void 0),ke(this,ct,void 0),ke(this,Yr,void 0),ke(this,ks,void 0),ke(this,yr,void 0),ke(this,mi,void 0),ke(this,Qr,void 0);var s,n,i,a,o,c,l,p,h,f,g,_,w,R,D,x,B,b,Q;me(this,En,t),me(this,Ps,[]),me(this,ct,new G1),me(this,Yr,!0),me(this,yr,!1),me(this,Oe,e!=null?e:{}),(n=(s=L(this,Oe)).autoReconnect)!=null||(s.autoReconnect=!0),(a=(i=L(this,Oe)).retryConnectionInterval)!=null||(i.retryConnectionInterval=1e3),(c=(o=L(this,Oe)).pingTimeout)!=null||(o.pingTimeout=3e4),(p=(l=L(this,Oe)).connectionTimeout)!=null||(l.connectionTimeout=5e3),(f=(h=L(this,Oe)).debug)!=null||(h.debug=!0),(_=(g=L(this,Oe)).maxReconnectionAttempts)!=null||(g.maxReconnectionAttempts=10),(R=(w=L(this,Oe)).disconnectOnPingTimeout)!=null||(w.disconnectOnPingTimeout=!0),(x=(D=L(this,Oe)).queueOnDisconnect)!=null||(D.queueOnDisconnect=!1),(b=(B=L(this,Oe)).flushOnReconnect)!=null||(B.flushOnReconnect=!1),me(this,ks,{code:void 0,reason:void 0}),me(this,We,(Q=L(this,Oe).logger)!=null?Q:new z1(L(this,Oe).debug?"debug":"info")),me(this,Qr,new K1)}get readyState(){var t;return(t=L(this,Ve))==null?void 0:t.readyState}get url(){return L(this,En)}updateURL(t){me(this,En,t),De(this,yh,cy).call(this)}get config(){return L(this,Oe)}get sendQueue(){return L(this,Ps)}flush(){if(!L(this,Oe).queueOnDisconnect)return!1;const t=[];return L(this,Ps).forEach(e=>{this.send(e.event,e.id,e.payload,e.metadata)||t.push(e)}),me(this,Ps,t),L(this,Ps)}async connect(t=!1){if(!t&&[0,1].includes(this.readyState)){L(this,We).debug("Websocket was already connecting or connected.");return}if(L(this,Yr)!==!1)return new Promise((e,s)=>{De(this,fi,Da).call(this),De(this,Oa,Sd).call(this);try{me(this,Ve,new WebSocket(De(this,mh,iy).call(this,L(this,En)))),L(this,Ve).binaryType="arraybuffer",L(this,We).debug("Connecting to",L(this,En));const n=setTimeout(()=>{L(this,We).debug("Connection timeout. Closing socket"),me(this,Yr,!0),De(this,Oa,Sd).call(this),L(this,Ve).close(3001,"Connection Timeout"),L(this,Oe).autoReconnect&&!L(this,yr)&&(L(this,ct).emit("reconnecting"),De(this,Aa,vd).call(this)),s(new Error("Connection timed out!"))},L(this,Oe).connectionTimeout);L(this,Ve).onopen=()=>{L(this,We).debug(`Ready State: ${Ey[L(this,Ve).readyState]}`),n&&clearTimeout(n),De(this,Td,Th).call(this),me(this,ks,{code:void 0,reason:void 0}),L(this,ct).emit("connected"),L(this,Oe).flushOnReconnect&&this.flush(),e()},L(this,Ve).onclose=i=>{try{n&&clearTimeout(n);const{code:a,reason:o}=i;s(o),L(this,We).debug("Socket closed. Close event:",i),L(this,We).debug("Connection closed code:",a),L(this,We).debug("Connection closed reason:",o),L(this,yr)||De(this,gd,vh).call(this,a,o)}catch(a){De(this,Ia,fd).call(this,a)}},L(this,Ve).onerror=i=>{De(this,Ia,fd).call(this,i)},L(this,Ve).onmessage=i=>De(this,fh,ay).call(this,i)}catch(n){De(this,Ia,fd).call(this,n,s)}})}send(t,e,s,n){const i={event:t,id:e,payload:s,metadata:n};if(L(this,Oe).queueOnDisconnect&&(!L(this,Ve)||L(this,Ve).readyState!==1))return L(this,We).debug("Queuing message since socket is not connected!",i),L(this,Ps).push(i),!1;const a=Sy.encode(i);return De(this,Ma,yd).call(this,a)}emit(t,e,s,n){return this.send(t,e,s,n)}sendRaw(t){return De(this,Ma,yd).call(this,t)}receive(t,e){return L(this,ct).on(t.toString(),e)}on(t,e){if(typeof t=="string"&&(t==="connected"||t==="disconnected"||t==="errored"||t==="reconnected"||t==="reconnecting"||t==="reconnectAttempt"||t==="reconnectFailure"||t==="failed")){L(this,ct).on(t,e);return}this.receive(t,e)}removeAllListeners(){L(this,ct).removeAllListeners()}removeReceiver(t,e){this.removeListener(t,e)}removeListener(t,e){L(this,ct).removeListener(t.toString(),e)}removeReceivers(t){this.removeListeners(t)}removeListeners(t){L(this,ct).listeners(t.toString()).map(e=>this.removeListener(t,e))}disconnect(){me(this,Yr,!1),De(this,fi,Da).call(this),this.removeAllListeners(),me(this,ks,{code:1e3,reason:"Sockrates disconnect method called"}),L(this,Ve).close(1e3,"Sockrates disconnect method called.")}}Ve=new WeakMap,En=new WeakMap,Oe=new WeakMap,We=new WeakMap,Ps=new WeakMap,ct=new WeakMap,Yr=new WeakMap,ks=new WeakMap,yr=new WeakMap,mi=new WeakMap,Qr=new WeakMap,mh=new WeakSet,iy=function(r){if(r.startsWith("ws://")||r.startsWith("wss://"))return r;if(r.startsWith("https://"))return`wss://${r.substring(8)}`;if(r.startsWith("http://"))return`ws://${r.substring(7)}`;throw new Error("Invalid URL. URL must start with http(s):// or ws(s)://.")},Ia=new WeakSet,fd=function(r,t){L(this,We).error("Error:",{error:r}),L(this,ct).emit("errored",{error:r}),t==null||t(r)},fh=new WeakSet,ay=function(r){if(De(this,Td,Th).call(this),r.data===Y1){L(this,We).debug("Received ping from server"),De(this,Ma,yd).call(this,Q1);return}const t=Sy.decode(r.data),{id:e,payload:s}=t;L(this,We).debug("Received message",{event:t.event,messageID:e}),L(this,ct).emit(t.event.toString(),{id:e,payload:s})},gh=new WeakSet,oy=function(){return L(this,Ve).readyState===1},gd=new WeakSet,vh=function(r,t){me(this,ks,{reason:t,code:r}),L(this,ct).emit("disconnected",{code:r,reason:t})},yh=new WeakSet,cy=function(){const{reason:r,code:t}=L(this,ks);t&&t!==1e3&&L(this,Yr)&&L(this,Oe).autoReconnect&&!L(this,yr)&&(L(this,We).debug(`Triggering reconnection due to ${r}.`),L(this,ct).emit("reconnecting"),De(this,Aa,vd).call(this))},Aa=new WeakSet,vd=async function(r=!0){if(r&&L(this,yr)){L(this,We).debug("Reconnect called when already in a reconnect loop. Ignoring.");return}if(L(this,yr)||L(this,Qr).reset(),L(this,Oe).maxReconnectionAttempts!==null&&L(this,Qr).getAttempts()>=L(this,Oe).maxReconnectionAttempts){L(this,ct).emit("failed"),me(this,yr,!1);return}me(this,yr,!0),De(this,Oa,Sd).call(this),De(this,fi,Da).call(this);try{if(await L(this,Qr).wait(),L(this,Yr)===!1)return;if(L(this,We).debug(`Reconnection attempt ${L(this,Qr).getAttempts()}`),L(this,ct).emit("reconnectAttempt",{attempt:L(this,Qr).getAttempts()}),await this.connect(),!De(this,gh,oy).call(this))throw Error("Reconnect Failed");me(this,yr,!1),me(this,ks,{code:void 0,reason:void 0}),L(this,ct).emit("reconnected")}catch(t){L(this,We).debug("Failed to reconnect."),L(this,ct).emit("reconnectFailure",{attempt:L(this,Qr).getAttempts()}),De(this,Aa,vd).call(this,!1)}},Ma=new WeakSet,yd=function(r){try{return L(this,Ve).send(r),!0}catch(t){return L(this,We).error(t.message),!1}},Td=new WeakSet,Th=function(){this.config.disconnectOnPingTimeout&&(L(this,We).debug("Resetting ping timeout"),De(this,fi,Da).call(this),me(this,mi,setTimeout(()=>{var r;L(this,We).debug("Disconnecting the socket due to ping timeout"),me(this,Yr,!0);const t=3002,e="Ping timeout";(r=L(this,Ve))==null||r.close(t,e),De(this,gd,vh).call(this,t,e)},L(this,Oe).pingTimeout)))},fi=new WeakSet,Da=function(){L(this,mi)&&(clearTimeout(L(this,mi)),me(this,mi,void 0))},Oa=new WeakSet,Sd=function(){L(this,Ve)&&(L(this,Ve).onopen=void 0,L(this,Ve).onerror=void 0,L(this,Ve).onmessage=void 0,L(this,Ve).onclose=void 0)};var Z1=Object.defineProperty,eL=Object.getOwnPropertyDescriptor,wd=(r,t,e,s)=>{for(var n=s>1?void 0:s?eL(t,e):t,i=r.length-1,a;i>=0;i--)(a=r[i])&&(n=(s?a(t,e,n):a(n))||n);return s&&n&&Z1(t,e,n),n};const _y=65535,tL=3e3,wy=(jy=class{constructor(r,{peerId:t,meetingId:e,authToken:s,capabilities:n}){E(this,$e);E(this,To);E(this,So);E(this,Js,void 0);E(this,Fe,void 0);m(this,"roomName");m(this,"authToken");m(this,"capabilities");E(this,ar,void 0);E(this,ls,void 0);var i;if(!t||!e||!s)throw new I("peerId, meetingId, or authToken can not be empty","0404");y(this,ar,void 0),y(this,ls,r),this.capabilities=n,this.roomName=e,this.authToken=s,y(this,Js,qe(this,To,Oh).call(this,t)),y(this,Fe,new X1(d(this,Js),{autoReconnect:!0,disconnectOnPingTimeout:(i=n.includes("PING"))!=null?i:!1,queueOnDisconnect:!0,flushOnReconnect:!1,logger:u})),this.handleSocketConnectionEvents()}get joinAttempted(){return d(this,$e,Qe).socketJoinAttempted}set joinAttempted(r){d(this,$e,Qe).socketJoinAttempted=r}get peerId(){return d(this,ls).getValue("peerId")}updateURL(r){r!==this.peerId&&(y(this,Js,qe(this,To,Oh).call(this,r)),u.debug("SocketService:: Connection URL updated.")),d(this,Fe).updateURL(d(this,Js))}static getSocketEdgeDomain(r){return ri({servicePrefix:"socket-edge",baseURI:r})}get url(){return d(this,Js)}async connect(){d(this,$e,Qe).socketJoinAttempted=!0,await d(this,Fe).connect(),d(this,$e,Qe).socketJoinAttempted=!0,d(this,$e,Qe).socketState={state:"connected",reconnected:!1,reconnectionAttempt:void 0}}async disconnect(){d(this,$e,Qe).socketJoinAttempted=!1,d(this,Fe).disconnect(),d(this,$e,Qe).socketJoinAttempted=!0,d(this,$e,Qe).socketState={state:"disconnected",reconnected:!1,reconnectionAttempt:void 0}}get isConnected(){try{return d(this,Fe).readyState===1}catch(r){return!1}}sendMessage(r,t,e){const s={};return v.injectContext(s),d(this,Fe).send(r,e!=null?e:qe(this,So,Nh).call(this),t,new TextEncoder().encode(JSON.stringify(s)))}sendMessagePromise(r,t,e,s){const n=parseInt({}.SOCKET_SERVICE_MESSAGE_REQUEST_TIMEOUT,10)||2e4;return this.sendMessagePromiseWithTimeout({event:r,timeout:n,protobuf:t,messageId:e,resp:s})}sendMessagePromiseWithTimeout({event:r,timeout:t,protobuf:e,messageId:s,resp:n}){const i=n!=null?n:r;return new Promise((a,o)=>{const c=(g,_)=>{d(this,Fe).removeListener(i,g),d(this,Fe).removeListener(_y,_),d(this,Fe).removeListener(Te.errorResponse,_),d(this,Fe).removeListener(Pe.errorResponse,_)},l=s!=null?s:qe(this,So,Nh).call(this),p={};v.injectContext(p);const h=({id:g,payload:_})=>{if(l===g){let w;try{const R=Wk.fromBinary(_);w=new Error(R.errorMessage)}catch(R){w=new Error("failed to parse error message",{cause:R});try{const D=VI.fromBinary(_);w=new Error(D.message)}catch(D){w=new Error("failed to parse error message",{cause:D})}}o(w),c(f,h)}},f=({id:g,payload:_})=>{l===g&&(a({id:g,payload:_}),c(f,h))};d(this,Fe).on(i,f),d(this,Fe).on(_y,h),d(this,Fe).on(Te.errorResponse,h),d(this,Fe).on(Pe.errorResponse,h),setTimeout(()=>{c(f,h),o(new Error(`request timeout for callback eventId:${r}`))},t),d(this,Fe).send(r,l,e,new TextEncoder().encode(JSON.stringify(p)))})}on(r,t){d(this,Fe).on(r,t)}onStateEvent(r,t){d(this,Fe).on(r,t)}removeListener(r,t){d(this,Fe).removeListener(r,t)}removeListeners(r){d(this,Fe).removeListeners(r)}flush(){return d(this,Fe).flush()}handleSocketConnectionEvents(){this.onStateEvent("connected",async()=>{u.info("SocketService::Connected to socket-edge"),d(this,ar)&&(clearTimeout(d(this,ar)),y(this,ar,void 0)),d(this,$e,Qe).updateSocketConnectionState("connected")}),this.onStateEvent("disconnected",({code:r,reason:t})=>{var n;u.info("SocketService::Disconnected from socket-edge",{error:{code:r,reason:t},country:v.location.country});const{recv:e,send:s}=(n=d(this,$e,Qe).mediaState)!=null?n:{};e!=null&&e.state&&(e==null?void 0:e.state)!==Xt.CONNECTED||s!=null&&s.state&&(s==null?void 0:s.state)!==Xt.CONNECTED?P.emit(k.SOCKET_SERVICE_DISCONNECTED,{joinAttempted:d(this,$e,Qe).joinAttempted}):y(this,ar,setTimeout(()=>{P.emit(k.SOCKET_SERVICE_DISCONNECTED,{joinAttempted:d(this,$e,Qe).joinAttempted}),y(this,ar,void 0)},tL)),d(this,$e,Qe).updateSocketConnectionState("disconnected")}),this.onStateEvent("reconnecting",async()=>{u.info("SocketService::Reconnecting to socket-edge",{country:v.location.country}),d(this,$e,Qe).updateSocketConnectionState("reconnecting")}),this.onStateEvent("reconnectAttempt",async({attempt:r})=>{u.info("SocketService::Attempting to reconnect to socket-edge",{socket:{retryAttempt:r}}),d(this,$e,Qe).updateSocketConnectionState("reconnectAttempt",r)}),this.onStateEvent("reconnectFailure",({attempt:r})=>{u.info("SocketService::Reconnect attempt to socket-edge failed",{socket:{retryAttempt:r}}),d(this,$e,Qe).updateSocketConnectionState("reconnectFailure",r)}),this.onStateEvent("reconnected",async()=>{u.info("SocketService::Reconnected to socket-edge",{connectionState:{joinAttempted:d(this,$e,Qe).mediaJoinAttempted}}),d(this,ar)&&(clearTimeout(d(this,ar)),y(this,ar,void 0)),P.emit(k.SOCKET_SERVICE_RECONNECTED,{wasJoinAttempted:d(this,$e,Qe).mediaJoinAttempted}),d(this,$e,Qe).updateSocketConnectionState("reconnected")}),this.onStateEvent("failed",async()=>{u.info("SocketService::Failed to connect to socket-edge",{country:v.location.country}),P.emit(k.SOCKET_SERVICE_FAILED),d(this,$e,Qe).updateSocketConnectionState("failed")})}},Js=new WeakMap,Fe=new WeakMap,$e=new WeakSet,Qe=function(){return d(this,ls).getValue("connectionHandler")},ar=new WeakMap,ls=new WeakMap,To=new WeakSet,Oh=function(r){let t=wy.getSocketEdgeDomain(d(this,ls).getValue("baseURI"));typeof Cc(d(this,ls),"socket_server_base")=="string"&&(t=Cc(d(this,ls),"socket_server_base"));const e=`wss://${t}`,s=new URL(`${e}/ws`),n=this.peerId,i={roomID:this.roomName,peerID:r,authToken:this.authToken,useMediaV2:!0,...n!==r&&{oldPeerID:n},ping:this.capabilities.includes("PING"),capabilities:this.capabilities.map(a=>Vc[a]).join(" "),joinWithDetails:!0};return Object.entries(i).forEach(([a,o])=>{s.searchParams.append(a,o.toString())}),s.href},So=new WeakSet,Nh=function(){return`${this.peerId}-${(Math.random()+1).toString(36).substring(7)}`},jy);let Na=wy;wd([v.trace("SocketService.connect")],Na.prototype,"connect",1),wd([v.trace("SocketService.disconnect")],Na.prototype,"disconnect",1),wd([v.trace("SocketService.sendMessagePromise")],Na.prototype,"sendMessagePromise",1),wd([v.trace("SocketService.sendMessagePromiseWithTimeout")],Na.prototype,"sendMessagePromiseWithTimeout",1);const Ks=class{static handleConnectedRoomsDumpRaw({payload:t}){var i;const e=pA.fromBinary(t),s=e.meetings.map(a=>{var o;return{id:a.id,title:a.title,participants:(o=a.participants)!=null?o:[]}});return{parentMeeting:{id:e.parentMeeting.id,title:e.parentMeeting.title,participants:(i=e.parentMeeting.participants)!=null?i:[]},meetings:s}}static handleTransferPeerRaw({payload:t}){const e=UA.fromBinary(t);return{authToken:e.authToken,meetingId:e.meetingId}}static handleMovedPeerRaw({payload:t}){const e=Yg.fromBinary(t);return{meetingId:e.meetingId,customParticipantId:e.customParticipantId}}static handleConnectedRoomsUpdatedRaw({payload:t}){return zg.fromBinary(t).payloads.map(s=>({id:s.id,title:s.title}))}static handleConnectedRoomsDeletedRaw({payload:t}){return IA.fromBinary(t).payloads}static async getConnectedRoomsDump(){const t=await Ks.socketService.sendMessagePromise(U.getConnectedRoomsDump);return Ks.handleConnectedRoomsDumpRaw(t)}static async createConnectedRooms(t){const{payload:e}=await Ks.socketService.sendMessagePromise(U.createConnectedRooms,vA.toBinary({payloads:t}));return zg.fromBinary(e).payloads.map(n=>({id:n.id,title:n.title}))}static async updateConnectedRooms(t){}static async disableConnectedRooms(t){const e=t.map(n=>({id:n})),s=await Ks.socketService.sendMessagePromise(U.deleteConnectedRooms,PA.toBinary({payloads:e}));return Ks.handleConnectedRoomsDeletedRaw(s)}static async movePeersBetweenRooms(t){try{const e=await Ks.socketService.sendMessagePromise(U.movePeers,LA.toBinary({sourceMeetingId:t.sourceMeetingId,destinationMeetingId:t.destinationMeetingId,participants:t.participants}));return new TextDecoder().decode(e.payload).includes("error")?{success:!1,error:"failed to move participants"}:{success:!0}}catch(e){return{success:!1,error:e}}}};let Ie=Ks;m(Ie,"socketService"),m(Ie,"currentMeetingId");var rL=Object.defineProperty,sL=Object.getOwnPropertyDescriptor,bd=(r,t,e,s)=>{for(var n=s>1?void 0:s?sL(t,e):t,i=r.length-1,a;i>=0;i--)(a=r[i])&&(n=(s?a(t,e,n):a(n))||n);return s&&n&&rL(t,e,n),n};const _n=class{constructor(r,t){m(this,"apiBase");m(this,"selfController");m(this,"pollController");m(this,"chatController");m(this,"metaController");m(this,"storesManager");m(this,"stageController");m(this,"pluginController");m(this,"internalsController");m(this,"recordingController");m(this,"livestreamController");m(this,"participantController");this.apiBase=r,this.storesManager=t.storesManager,this.metaController=t.metaController,this.selfController=t.selfController,this.chatController=t.chatController,this.pollController=t.pollController,this.stageController=t.stageController,this.pluginController=t.pluginController,this.recordingController=t.recordingController,this.internalsController=t.internalsController,this.participantController=t.participantController,this.livestreamController=t.livestreamController}static async init(r){var R,D;const{peerId:t,apiBase:e,authToken:s,meetingId:n,organizationId:i,cachedUserDetails:a}=r.getAllValues();if(P.reset(),pd.cleanup(),ry(r),Re.isSupported()===!1)throw new I("Browser not supported","0010",!0);const o=QD(r,{authToken:s,baseURL:e,cachedUserDetails:a});o.setRoomName(n),o.setRoomUUID(n),o.setOrganizationId(i),o.setHeader("dyte-tracing-id",t),r.setValue("apiClient",o);const c=new OO;r.setValue("connectionHandler",c);const l=_n.createSocketService(r),p=l.connect(),h=o.getPlugins();let f=Zt.HIVE,g;try{const x=await _n.getRoomMetadata(),{meetingTitle:B,roomNodeUrl:b}=x;({sfu:f,userResponse:g}=x),r.setValue("presetName",g.preset.name),r.setValue("roomNodeOptions",{sfu:f,meetingTitle:B,roomNodeUrl:b})}catch(x){u.error("Failed to get room metadata",{error:x})}try{await _n.setupFlagsmith(r)}catch(x){u.error("Failed to setup flagsmith",{error:x})}v.location.country=(R=o.ipInfo)==null?void 0:R.country;const{theme:_,controllers:w}=await _n.setupControllers(l,r,g,h);_O(_)&&_n.createRoomNodeClient(r,l),TP();try{await p,(D=w.selfController.partialMediaRoom())==null||D.catch(x=>{u.error("[Controller]: Failed to queue partial media room promise:",{error:x})})}catch(x){u.error("[Controller]: Failed to connect to socket server:",{error:x})}return new _n(e,w)}static async getRoomMetadata(){const r=tt(),[{roomNodeUrl:t,meetingTitle:e,sfu:s},n]=await Promise.all([r.getRoomNodeData(),r.getUserDetails()]);return{sfu:s,roomNodeUrl:t,meetingTitle:e,userResponse:n}}static async setupFlagsmith(r){var c;const{peerId:t,baseURI:e,overrides:s,meetingId:n,organizationId:i}=r.getAllValues(),a=vP(n),o={entity:pu.PEER,clientId:i,isAnonUser:!i,sdkVersion:r.getValue("sdkVersion"),presetName:r.getValue("presetName"),meetingHash:a,roomName:n,...Re.getDeviceInfo(),isReactNative:navigator.isReactNative};try{const l=(c=s==null?void 0:s.whitelabelled_flags_endpoint)==null||c?ri({servicePrefix:"flags",baseURI:e}):"edge.api.flagsmith.com";await J.identify(`${pu.PEER}_${t}`,JSON.parse(JSON.stringify(o)),!1,5e3,l,u),u.info("flagsmith::allFlags",{flags:JSON.stringify(J.getAllFlags())},!0)}catch(l){u.error("Failed to fetch flagsmith flags")}}static async setupControllers(r,t,e,s){var $,M,et;const n=t.getValue("modules"),{preset:i,participant:a}=e,o=t.getValue("defaults"),{sfu:c,meetingTitle:l}=t.getValue("roomNodeOptions"),p=th.init(i,!n.theme),{viewType:h,mediaConstraints:{audio:f}}=p;t.setValue("viewType",h),t.setValue("defaults",{mediaConfiguration:{audio:{enableHighBitrate:($=f.enableHighBitrate)!=null?$:!1,enableStereo:(M=f.enableStereo)!=null?M:!1}},...o});const g=sh.init(t,h,i.permissions);t.setValue("maxPreferredStreams",Re.isMobile()?p.maxVideoStreams.mobile:p.maxVideoStreams.desktop);let _,w,R,D,x,B,b,Q;const te=new M1(r);Ie.socketService=r;const ce=new md(r),he=new Qt(r),Ne=new N1(r),de=pd.create(r,t),He=new L1(r),A=new A1(r),S=new on(r),C=await Cs.init(t,de,a,g,p),V=await yv.init(t,C.self,de,te,l);if(n.participant&&(Q=new Kr(t,C.self,de,c)),(et=n.e2ee)!=null&&et.enabled&&n.e2ee.manager.init(u,P),n.chat&&(w=await gr.init(t,he,S,C.self,Q.participants)),n.internals&&(x=await zu.init()),n.livestream&&p.viewType===Ct.Livestream&&J.hasFeature(Z.LIVESTREAM)&&(b=new Uv(C.self,A)),p.viewType!==Ct.Chat){if(n.poll&&(_=await mv.init(t,C.self,ce)),n.recording&&(B=new wv(t,C.self,de)),n.stage&&(R=new Tv(t,Ne,de,C.self,Q.participants)),n.plugin){if(!Q)throw new I("The plugin module cannot be initialized without the `participant` module","0102");const us=await s;D=await Sa.init(t,us,He,he,w==null?void 0:w.chat,C.self,Q.participants)}if(n.pip){const us=await fu._init(t,C.self);t.setValue("pip",us)}}const Ye={storesManager:new IN(t,He),pollController:_,selfController:C,metaController:V,chatController:w,stageController:R,pluginController:D,recordingController:B,internalsController:x,livestreamController:b,participantController:Q};return{theme:p,permissions:g,controllers:Ye}}static createRoomNodeClient(r,t){const{peerId:e,meetingId:s,authToken:n,roomNodeOptions:i}=r.getAllValues(),{sfu:a,roomNodeUrl:o,meetingTitle:c}=i;return ty(r,{socket:t,peerId:e,meetingId:s,authToken:n,roomNodeUrl:o,meetingTitle:c},a)}static createSocketService(r){const{peerId:t,meetingId:e,authToken:s}=r.getAllValues(),n=["PING"];return new Na(r,{peerId:t,meetingId:e,authToken:s,capabilities:n})}};let La=_n;bd([v.trace("Controller.init")],La,"init",1),bd([v.trace("setupFlagsmith")],La,"setupFlagsmith",1),bd([v.trace("Controller.createRoomNodeClient")],La,"createRoomNodeClient",1),bd([v.trace("Controller.createSocketService")],La,"createSocketService",1);var nL=Object.defineProperty,iL=Object.getOwnPropertyDescriptor,aL=(r,t,e,s)=>{for(var n=s>1?void 0:s?iL(t,e):t,i=r.length-1,a;i>=0;i--)(a=r[i])&&(n=(s?a(t,e,n):a(n))||n);return s&&n&&nL(t,e,n),n};class by extends qt{constructor(e,s){super();E(this,Eo,void 0);m(this,"meetings",[]);m(this,"parentMeeting",null);E(this,Hd,void 0);y(this,Hd,e),y(this,Eo,s.self)}get supportsConnectedMeetings(){return d(this,Eo).id!==""}get isActive(){return this.meetings.length!==0}get currentMeetingId(){return Ie.currentMeetingId}validateConnectedMeetingsAction(){if(!this.supportsConnectedMeetings)throw new Error(`You are not allowed to perform this action.
Please connect with Dyte team to move you to V2 APIs & to enable connected meetings.`)}async getConnectedMeetings(){return this.validateConnectedMeetingsAction(),await Ie.getConnectedRoomsDump()}async createMeetings(e){return this.validateConnectedMeetingsAction(),(await Ie.createConnectedRooms(e)).map(n=>({id:n.id,title:n.title}))}async updateMeetings(e){this.validateConnectedMeetingsAction(),await Ie.updateConnectedRooms(e.map(s=>({meetingId:s.id,title:s.title})))}async deleteMeetings(e){this.validateConnectedMeetingsAction();const s=this.meetings.map(i=>e.includes(i.id)&&i.participants.length!==0?this.moveParticipants(i.id,this.parentMeeting.id,i.participants.map(a=>a.id)):Promise.resolve());return await Promise.all(s),await Ie.disableConnectedRooms(e)}async moveParticipants(e,s,n){this.validateConnectedMeetingsAction();const i=await Ie.movePeersBetweenRooms({sourceMeetingId:e,destinationMeetingId:s,participants:n.map(a=>({id:a}))});return i.success&&this.moveSuccessHandler(e,s,n),i}async moveParticipantsWithCustomPreset(e,s,n){this.validateConnectedMeetingsAction();const i=await Ie.movePeersBetweenRooms({sourceMeetingId:e,destinationMeetingId:s,participants:n});return i.success&&this.moveSuccessHandler(e,s,n.map(a=>a.id)),i}moveSuccessHandler(e,s,n){const i=new Map;[...this.parentMeeting.participants,...this.meetings.flatMap(a=>a.participants)].forEach(a=>i.set(a.id,a)),s===this.parentMeeting.id&&(this.parentMeeting.participants=this.parentMeeting.participants.concat(n.map(a=>i.get(a)))),e===this.parentMeeting.id&&(this.parentMeeting.participants=this.parentMeeting.participants.filter(a=>!n.includes(a.id))),this.meetings=this.meetings.map(a=>{if(s===a.id){const o=a.participants.concat(n.map(c=>i.get(c)));return{...a,participants:o}}if(e===a.id){const o=a.participants.filter(c=>!n.includes(c.id));return{...a,participants:o}}return a})}}Eo=new WeakMap,Hd=new WeakMap,aL([Lt({maxInvocations:60,period:60})],by.prototype,"getConnectedMeetings",1);var oL=Object.defineProperty,cL=Object.getOwnPropertyDescriptor,Eh=(r,t,e,s)=>{for(var n=s>1?void 0:s?cL(t,e):t,i=r.length-1,a;i>=0;i--)(a=r[i])&&(n=(s?a(t,e,n):a(n))||n);return s&&n&&oL(t,e,n),n};const As=(bh=class{constructor(r,t,e){m(this,"connectedMeetings");E(this,ra,void 0);E(this,or,void 0);E(this,qd,void 0);y(this,qd,r),y(this,ra,e),this.connectedMeetings=new by(r,t),this.setCurrentMeeting(t)}static init(r,t,e){return As.instance||(As.instance=new As(r,t,e)),As.instance.connectedMeetings.supportsConnectedMeetings&&(As.instance.setupEvents(),t.self.once("roomJoined",()=>As.instance.getConnectedMeetings())),As.instance}setCurrentMeeting(r){y(this,or,r),Ie.currentMeetingId=r.meta.meetingId}getConnectedMeetings(){this.connectedMeetings.getConnectedMeetings()}setupEvents(){Ie.socketService&&(Ie.socketService.on(U.getConnectedRoomsDump,this.handleConnectedRoomsDump.bind(this)),Ie.socketService.on(U.transferPeer,this.handleTransferPeer.bind(this)),Ie.socketService.on(U.movedPeer,this.handleMovedPeer.bind(this)),Ie.socketService.on(U.connectedRoomsUpdated,this.handleConnectedRoomsUpdated.bind(this)),Ie.socketService.on(U.connectedRoomsDeleted,this.handleConnectedRoomsDeleted.bind(this)))}handleTransferPeer(r){const t=Ie.handleTransferPeerRaw(r);return this.switchMeeting(t)}async switchMeeting({authToken:r,meetingId:t}){var n,i,a,o;if(!this.connectedMeetings.supportsConnectedMeetings)throw new Error(`You are not allowed to perform this action.
Please connect with Dyte team to move you to V2 APIs & to enable connected meetings.`);u.info("ConnectedMeetingsController::switchMeeting:: asking ui-kit to show switching breakout UI"),this.connectedMeetings.emit("changingMeeting",t);const e={video:d(this,or).self.videoEnabled,audio:d(this,or).self.audioEnabled};try{d(this,or).self.cleanupEvents(),await d(this,or).leave("connected-meeting")}catch(c){u.error(`ConnectedMeetingsController:: switchMeeting:: issues in leaving previous meeting. Meeting Id: ${(i=(n=d(this,or))==null?void 0:n.meta)==null?void 0:i.meetingId}`,{error:c})}Ie.socketService=void 0,u.info(`ConnectedMeetingsController::switchMeeting:: initializing new meeting. Meeting Id: ${t}`);const s=await Ry.init({...d(this,ra),cachedUserDetails:null,defaults:{...d(this,ra).defaults,...e,mediaHandler:d(this,or).self},authToken:r});u.info(`ConnectedMeetingsController::switchMeeting:: initialized new meeting. Meeting Id: ${(a=s==null?void 0:s.meta)==null?void 0:a.meetingId}`);try{const{hidden:c}=d(this,or).self;s.self.setName(d(this,or).self.name),await s.join(),c&&s.self.hide()}catch(c){u.error("ConnectedMeetingsController.joinRoom",{error:c})}return u.info(`ConnectedMeetingsController::switchMeeting:: asking ui-kit to show in-meeting ui of newly joined meeting id: ${(o=s==null?void 0:s.meta)==null?void 0:o.meetingId}`),this.connectedMeetings.emit("meetingChanged",s),this.setCurrentMeeting(s),s}handleConnectedRoomsDump(r){const t=Ie.handleConnectedRoomsDumpRaw(r);this.connectedMeetings.meetings=t.meetings.map(e=>({id:e.id,title:e.title,participants:e.participants||[]})),this.connectedMeetings.parentMeeting={id:t.parentMeeting.id,title:t.parentMeeting.title,participants:t.parentMeeting.participants},this.emitStateUpdate()}handleMovedPeer(r){return Ie.handleMovedPeerRaw(r)}handleConnectedRoomsUpdated(r){const t=Ie.handleConnectedRoomsUpdatedRaw(r),e=new Map;this.connectedMeetings.meetings.forEach(s=>{e.set(s.id,s)}),t.forEach(s=>{e.has(s.id)?e.get(s.id).title=s.title:e.set(s.id,{...s,participants:[]})}),this.connectedMeetings.meetings=Array.from(e.values()),this.emitStateUpdate()}handleConnectedRoomsDeleted(r){const e=Ie.handleConnectedRoomsDeletedRaw(r).map(s=>s.id);this.connectedMeetings.meetings=this.connectedMeetings.meetings.filter(s=>!e.includes(s.id)),this.emitStateUpdate()}emitStateUpdate(){this.connectedMeetings.emit("stateUpdate",{meetings:this.connectedMeetings.meetings,parentMeeting:this.connectedMeetings.parentMeeting})}},ra=new WeakMap,or=new WeakMap,qd=new WeakMap,m(bh,"instance"),bh);let Cd=As;Eh([v.trace("ConnectedMeetingsController.getConnectedMeetings")],Cd.prototype,"getConnectedMeetings",1),Eh([v.trace("ConnectedMeetingsController.setupEvents")],Cd.prototype,"setupEvents",1),Eh([v.trace("ConnectedMeetingsController.switchMeeting")],Cd.prototype,"switchMeeting",1);class dL{constructor(){m(this,"battery");m(this,"init",async()=>{try{"getBattery"in navigator&&(this.battery=await navigator.getBattery(),this.battery.addEventListener("chargingchange",this.updateChargeInfo),this.battery.addEventListener("levelchange",this.updateLevelInfo),this.updateLevelInfo(),this.updateChargeInfo())}catch(t){u.error("Error getting battery",t)}});m(this,"updateChargeInfo",()=>{var t;u.log(`Battery charging? ${(t=this.battery)!=null&&t.charging?"Yes":"No"}`)});m(this,"updateLevelInfo",()=>{if(!this.battery){u.log("Battery level: Not known");return}u.log(`Battery level: ${this.battery.level*100}%`)});m(this,"cleanup",()=>{var t,e;"getBattery"in navigator&&((t=this.battery)==null||t.removeEventListener("chargingchange",this.updateChargeInfo),(e=this.battery)==null||e.removeEventListener("levelchange",this.updateLevelInfo))})}}const Cy=new dL;function lL(r,t){try{const{meetingId:e,orgId:s,participantId:n}=JSON.parse(atob(r.split(".")[1]));if(!e)throw Error(`Received V1 auth token ${r}`);let i="dyte.io";t&&(i=t);const a=`https://api.${i}`;return{meetingId:e,orgId:s,participantId:n,baseURI:i,apiBase:a}}catch(e){throw u.error("constants::decodeAuthToken",{error:e,debuggingHint:`Unable to decode auth token: ${r}`},!0),new I("Invalid auth token","0004")}}var uL=Object.defineProperty,hL=Object.getOwnPropertyDescriptor,Rd=(r,t,e,s)=>{for(var n=s>1?void 0:s?hL(t,e):t,i=r.length-1,a;i>=0;i--)(a=r[i])&&(n=(s?a(t,e,n):a(n))||n);return s&&n&&uL(t,e,n),n};let Ms=(Gy=class{constructor(t,e){E(this,jd);E(this,dt,void 0);E(this,_o,void 0);E(this,wo,void 0);y(this,wo,t),y(this,dt,e)}static async init(t){var p,h,f,g,_;mP(),Re.init();const e=Jn();Cy.init();const{authToken:s,baseURI:n}=t,{meetingId:i,...a}=lL(s,n);window.__zone_symbol__DISABLE_WRAPPING_UNCAUGHT_PROMISE_REJECTION=!0;const o=Ms.setupContext(e,t,i,a);v.meetingMetadata.roomName=i,v.meetingMetadata.userId=a.participantId,v.meetingMetadata.organizationId=a.orgId,v.init(o,(h=(p=t.modules)==null?void 0:p.tracing)!=null?h:!0),u.info("DyteClient::init::options",{dyteClientInitOptions:{...t,authToken:`${(f=t.authToken)==null?void 0:f.slice(0,10)}...
${(g=t.authToken)==null?void 0:g.slice(-10)}`}});const c=await La.init(o),l=new Ms(o,c);return qe(_=l,jd,Zy).call(_,t),l}static setupContext(t,e,s,n){var o;const i=rn.createContext(t,e),a={...cP,...e==null?void 0:e.modules};return i.setValue("peerId",t),i.setValue("modules",a),i.setValue("sdkName","web-core"),i.setValue("meetingId",s),i.setValue("apiBase",n.apiBase),i.setValue("baseURI",n.baseURI),i.setValue("userId",n.participantId),i.setValue("organizationId",n.orgId),i.setValue("authToken",e.authToken),i.setValue("overrides",(o=e.overrides)!=null?o:{}),i.setValue("env",dP({baseURI:n.baseURI})),i.setValue("defaults",e.defaults||{audio:!0,video:!0}),i.setValue("onError",e.onError||(()=>{})),i.setValue("cachedUserDetails",fr(e.cachedUserDetails)),i.setValue("sdkVersion","2.5.0-staging.5"),i}async join(){const{selfController:t}=d(this,dt);return t.self.roomJoined?null:t.joinRoom()}async leave(t){Cy.cleanup();const{selfController:e}=d(this,dt);return e.leaveRoom(t)}get participants(){var t;return(t=d(this,dt).participantController)==null?void 0:t.participants}get self(){var t;return(t=d(this,dt).selfController)==null?void 0:t.self}get meta(){var t;return(t=d(this,dt).metaController)==null?void 0:t.meta}get ai(){var t;return(t=d(this,dt).metaController)==null?void 0:t.ai}get plugins(){var t;return(t=d(this,dt).pluginController)==null?void 0:t.plugins}get chat(){var t;return(t=d(this,dt).chatController)==null?void 0:t.chat}get polls(){var t;return(t=d(this,dt).pollController)==null?void 0:t.polls}get connectedMeetings(){var t;return(t=d(this,_o))==null?void 0:t.connectedMeetings}get recording(){var t;return(t=d(this,dt).recordingController)==null?void 0:t.recording}get livestream(){var t;return(t=d(this,dt).livestreamController)==null?void 0:t.livestream}get stage(){var t;return(t=d(this,dt).stageController)==null?void 0:t.stage}get stores(){return d(this,dt).storesManager}get __internals__(){var t;return(t=d(this,dt).internalsController)==null?void 0:t.internals}async joinRoom(){return this.join()}async leaveRoom(t){return this.leave(t)}},dt=new WeakMap,_o=new WeakMap,wo=new WeakMap,jd=new WeakSet,Zy=function(t){y(this,_o,Cd.init(d(this,wo),this,t))},Gy);Rd([mt("0002"),_s.executeWithLock({methodName:"meeting.join",lockName:"DyteClient.join",timeout:3e3})],Ms.prototype,"join",1),Rd([mt("0003")],Ms.prototype,"leave",1),Rd([mt("0001"),_s.executeWithLock({methodName:"DyteClient.init",lockName:"DyteClient.init",timeout:3e3})],Ms,"init",1),Ms=Rd([mt("0000")],Ms);const Ry=Ms;return Ry}();
